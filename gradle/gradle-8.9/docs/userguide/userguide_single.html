<!DOCTYPE html>
<html lang="">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="description" content="Single-page Gradle User Manual for Gradle 8.9">
<title>Gradle User Manual: Version 8.9</title>
<style>
/*
 * Copyright 2018 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* Custom Admonition Blocks */
:root {
    --gradle-blue: #209BC4;
    --gradle-bg-dark: #010002;
    --gradle-bg-gray: #F8F8F8;
    --gradle-bg-white: #FFFFFF;
    --gradle-blue: #209BC4;
    --gradle-blue-lite: #4DC9C0;
    --gradle-blue-dark: #1b3262;
    --gradle-blue-darker: #19274f;
    --button-gradient-angle: 160deg;

	--caution-color: #e40046;
	--caution-on-color: #fff;
	--important-color: #802392;
	--important-on-color: #fff;
	--note-color: #2d7dd2;
	--note-on-color: #fff;
	--tip-color: #43b929;
	--tip-on-color: #fff;
	--warning-color: #f70;
	--warning-on-color: #fff;
	--admonition-background: #fafafa;

	--doc-icon-filter: invert(14.5%);
	--rem-base: 18;

	--black-color: #000;
	--white-color: #fff;
	--text-color: #02303A;
	--title-color: #02303A;
	--header-color: rgba(0, 0, 0, 0.85);
	--footer-color: rgba(0, 0, 0, 0.8);
	--code-color: #f7f7f8;
	--code-text-color: rgba(0, 0, 0, 0.9);
	--code-link-color: #021274;
	--num-color: rgba(0, 0, 0, 0.8);
	--nav-color: #f8f8f7;
	--table-color: #f7f8f7;
	--box-shadow-color: rgba(0, 0, 0, .15);
	--top-header-color: #fff;
	--footer-white-color: #fff;
	--footer-text-color: #fff;
	--quoteblock-color: #7a2518;
	--menu-burger-color: #fff;

	.dark-mode {
		--admonition-background: #2a2929;
		--black-color: #fff;
		--white-color: #121212;
		--text-color: #aaa;
		--title-color: #fff;
		--header-color: rgba(255, 255, 255, 0.85);
		--footer-color: #242526;
		--code-color: #1f1f1f;
		--code-text-color: rgba(255, 255, 255, 0.9);
		--code-link-color: #1fafcc;
		--num-color: #fff;
		--nav-color: #121212;
		--table-color: #121212;
		--box-shadow-color: rgba(255, 255, 255, .15);
		--top-header-color: #242526;
		--footer-white-color: #242526;
		--footer-text-color: #aaa;
		--quoteblock-color: #1DA2BD;
		--menu-burger-color: #242526;


	}
}

/* Lato (normal, regular) */
@font-face {
	font-family: Lato;
	font-weight: 400;
	font-style: normal;
	src: url("https://assets.gradle.com/lato/fonts/lato-normal/lato-normal.woff2") format("woff2"),
		url("https://assets.gradle.com/lato/fonts/lato-normal/lato-normal.woff") format("woff");
}

/* Lato (normal, italic) */
@font-face {
	font-display: swap;
	font-family: Lato;
	font-weight: 400;
	font-style: italic;
	src: url("https://assets.gradle.com/lato/fonts/lato-normal-italic/lato-normal-italic.woff2") format("woff2"),
		url("https://assets.gradle.com/lato/fonts/lato-normal-italic/lato-normal-italic.woff") format("woff");
}

/* Lato (bold, regular) */
@font-face {
	font-display: swap;
	font-family: Lato;
	font-weight: 500;
	font-style: normal;
	src: url("https://assets.gradle.com/lato/fonts/lato-semibold/lato-semibold.woff2") format("woff2"),
		url("https://assets.gradle.com/lato/fonts/lato-semibold/lato-semibold.woff") format("woff");
}

/* Lato (bold, regular) */
@font-face {
	font-display: swap;
	font-family: Lato;
	font-weight: 800;
	font-style: normal;
	src: url("https://assets.gradle.com/lato/fonts/lato-heavy/lato-heavy.woff2") format("woff2"),
		url("https://assets.gradle.com/lato/fonts/lato-heavy/lato-heavy.woff") format("woff");
}

/* BEGIN asciidoc.css */

/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
	display: block;
}

/** Correct `inline-block` display not defined in IE 8/9. */
audio,
canvas,
video {
	display: inline-block;
}

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) {
	display: none;
	height: 0;
}

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden],
template {
	display: none;
}

script {
	display: none !important;
}

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html {
	font-family: sans-serif;
	/* 1 */
	-ms-text-size-adjust: 100%;
	/* 2 */
	-webkit-text-size-adjust: 100%;
	/* 2 */
}

/** Remove default margin. */
body {
	margin: 0;
}

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a {
	background: transparent;
}

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus {
	outline: thin dotted;
}

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active,
a:hover {
	outline: 0;
}

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 {
	font-size: 2em;
	margin: 0.67em 0;
}

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] {
	border-bottom: 1px dotted;
}

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b,
strong {
	font-weight: bold;
}

/** Address styling not present in Safari 5 and Chrome. */
dfn {
	font-style: italic;
}

/** Address differences between Firefox and other browsers. */
hr {
	-moz-box-sizing: content-box;
	box-sizing: content-box;
	height: 0;
}

/** Address styling not present in IE 8/9. */
mark {
	background: #ff0;
	color: var(--black-color);
}

/** Correct font family set oddly in Safari 5 and Chrome. */
code,
kbd,
pre,
samp {
	font-family: monospace, serif;
	font-size: 1em;
}

/** Improve readability of pre-formatted text in all browsers. */
pre {
	white-space: pre-wrap;
}

/** Set consistent quote types. */
q {
	quotes: "\201C""\201D""\2018""\2019";
}

/** Address inconsistent and variable font size in all browsers. */
small {
	font-size: 80%;
}

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub,
sup {
	font-size: 75%;
	line-height: 0;
	position: relative;
	vertical-align: baseline;
}

sup {
	top: -0.5em;
}

sub {
	bottom: -0.25em;
}

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img {
	border: 0;
}

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) {
	overflow: hidden;
}

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure {
	margin: 0;
}

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset {
	border: 1px solid #c0c0c0;
	margin: 0 2px;
	padding: 0.35em 0.625em 0.75em;
}

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend {
	border: 0;
	/* 1 */
	padding: 0;
	/* 2 */
}

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button,
input,
select,
textarea {
	font-family: inherit;
	/* 1 */
	font-size: 100%;
	/* 2 */
	margin: 0;
	/* 3 */
}

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button,
input {
	line-height: normal;
}

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button,
select {
	text-transform: none;
}

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button,
html input[type="button"],
input[type="reset"],
input[type="submit"] {
	-webkit-appearance: button;
	/* 2 */
	cursor: pointer;
	/* 3 */
}

/** Re-set default cursor for disabled elements. */
button[disabled],
html input[disabled] {
	cursor: default;
}

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"],
input[type="radio"] {
	box-sizing: border-box;
	/* 1 */
	padding: 0;
	/* 2 */
}

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] {
	-webkit-appearance: textfield;
	/* 1 */
	-moz-box-sizing: content-box;
	-webkit-box-sizing: content-box;
	/* 2 */
	box-sizing: content-box;
}

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
	-webkit-appearance: none;
}

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner,
input::-moz-focus-inner {
	border: 0;
	padding: 0;
}

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea {
	overflow: auto;
	/* 1 */
	vertical-align: top;
	/* 2 */
}

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table {
	border-collapse: collapse;
	border-spacing: 0;
}

meta.foundation-mq-small {
	font-family: "only screen and (min-width: 768px)";
	width: 768px;
}

meta.foundation-mq-medium {
	font-family: "only screen and (min-width:1280px)";
	width: 1280px;
}

meta.foundation-mq-large {
	font-family: "only screen and (min-width:1440px)";
	width: 1440px;
}

*,
*:before,
*:after {
	-moz-box-sizing: border-box;
	-webkit-box-sizing: border-box;
	box-sizing: border-box;
}

html,
body {
	font-size: 100%;
}

body {
	background: var(--white-color);
	color: var(--num-color);
	padding: 0;
	margin: 0;
	font-family: "Noto Serif", "DejaVu Serif", serif;
	font-weight: normal;
	font-style: normal;
	line-height: 1;
	position: relative;
	cursor: auto;
}

a:hover {
	cursor: pointer;
}

img,
object,
embed {
	max-width: 100%;
	height: auto;
}

object,
embed {
	height: 100%;
}

img {
	-ms-interpolation-mode: bicubic;
}

#map_canvas img,
#map_canvas embed,
#map_canvas object,
.map_canvas img,
.map_canvas embed,
.map_canvas object {
	max-width: none !important;
}

.left {
	float: left !important;
}

.right {
	float: right !important;
}

.text-left {
	text-align: left !important;
}

.text-right {
	text-align: right !important;
}

.text-center {
	text-align: center !important;
}

.text-justify {
	text-align: justify !important;
}

.hide {
	display: none;
}

.antialiased {
	-webkit-font-smoothing: antialiased;
}

img {
	display: inline-block;
	vertical-align: middle;
}

textarea {
	height: auto;
	min-height: 50px;
}

select {
	width: 100%;
}

object,
svg {
	display: inline-block;
	vertical-align: middle;
}

.center {
	margin-left: auto;
	margin-right: auto;
}

.spread {
	width: 100%;
}

p.lead,
.paragraph.lead>p,
#preamble>.sectionbody>.paragraph:first-of-type p {
	font-size: 1.21875em;
	line-height: 1.6;
}

.subheader,
.admonitionblock td.content>.title,
.audioblock>.title,
.exampleblock>.title,
.imageblock>.title,
.listingblock>.title,
.literalblock>.title,
.stemblock>.title,
.openblock>.title,
.paragraph>.title,
.quoteblock>.title,
table.tableblock>.title,
.verseblock>.title,
.videoblock>.title,
.dlist>.title,
.olist>.title,
.ulist>.title,
.qlist>.title,
.hdlist>.title {
	line-height: 1.45;
	color: #7a2518;
	font-weight: normal;
	margin-top: 0;
	margin-bottom: 0.25em;
}

/* Typography resets */
div,
dl,
dt,
dd,
ul,
ol,
li,
h1,
h2,
h3,
#toctitle,
.sidebarblock>.content>.title,
h4,
h5,
h6,
pre,
form,
p,
blockquote,
th,
td {
	margin: 0;
	padding: 0;
	direction: ltr;
}

/* Default Link Styles */
a {
	color: #2156a5;
	text-decoration: underline;
	line-height: inherit;
}

a:hover,
a:focus {
	color: #1d4b8f;
}

a img {
	border: none;
}

/* Default paragraph styles */
p {
	font-family: inherit;
	font-weight: normal;
	font-size: 1em;
	line-height: 1.6;
	margin-bottom: 1.25em;
	text-rendering: optimizeLegibility;
}

p aside {
	font-size: 0.875em;
	line-height: 1.35;
	font-style: italic;
}

/* Default header styles */
h1,
h2,
h3,
#toctitle,
.sidebarblock>.content>.title,
h4,
h5,
h6 {
	font-family: "Open Sans", "DejaVu Sans", sans-serif;
	font-weight: 300;
	font-style: normal;
	color: #ba3925;
	text-rendering: optimizeLegibility;
	margin-top: 1em;
	margin-bottom: 0.5em;
	line-height: 1.0125em;
}

h1 small,
h2 small,
h3 small,
#toctitle small,
.sidebarblock>.content>.title small,
h4 small,
h5 small,
h6 small {
	font-size: 60%;
	color: #e99b8f;
	line-height: 0;
}

h1 {
	font-size: 2.125em;
}

h2 {
	font-size: 1.6875em;
}

h3,
#toctitle,
.sidebarblock>.content>.title {
	font-size: 1.375em;
}

h4 {
	font-size: 1.125em;
}

h5 {
	font-size: 1.125em;
}

h6 {
	font-size: 1em;
}

hr {
	border: solid #ddddd8;
	border-width: 1px 0 0;
	clear: both;
	margin: 1.25em 0 1.1875em;
	height: 0;
}

/* Helpful Typography Defaults */
em,
i {
	font-style: italic;
	line-height: inherit;
}

strong,
b {
	font-weight: bold;
	line-height: inherit;
}

small {
	font-size: 60%;
	line-height: inherit;
}

code {
	font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
	font-weight: normal;
	color: var(--code-text-color);
}

a code {
	color: var(--code-link-color);
}

/* Lists */
ul,
ol,
dl {
	font-size: 1em;
	line-height: 1.6;
	margin-bottom: 1.25em;
	list-style-position: outside;
	font-family: inherit;
}

ul,
ol {
	margin-left: 1.5em;
}

ul.no-bullet,
ol.no-bullet {
	margin-left: 1.5em;
}

/* Unordered Lists */
ul li ul,
ul li ol {
	margin-left: 1.25em;
	margin-bottom: 0;
	font-size: 1em;
	/* Override nested font-size change */
}

ul.square li ul,
ul.circle li ul,
ul.disc li ul {
	list-style: inherit;
}

ul.square {
	list-style-type: square;
}

ul.circle {
	list-style-type: circle;
}

ul.disc {
	list-style-type: disc;
}

ul.no-bullet {
	list-style: none;
}

/* Ordered Lists */
ol li ul,
ol li ol {
	margin-left: 1.25em;
	margin-bottom: 0;
}

/* Definition Lists */
dl dt {
	margin-bottom: 0.3125em;
	font-weight: bold;
}

dl dd {
	margin-bottom: 1.25em;
}

/* Abbreviations */
abbr,
acronym {
	text-transform: uppercase;
	font-size: 90%;
	color: var(--num-color);
	border-bottom: 1px dotted #dddddd;
	cursor: help;
}

abbr {
	text-transform: none;
}

/* Blockquotes */
blockquote {
	margin: 0 0 1.25em;
	padding: 0.5625em 1.25em 0 1.1875em;
	border-left: 1px solid #dddddd;
}

blockquote cite {
	display: block;
	font-size: 0.9375em;
	color: rgba(0, 0, 0, 0.6);
}

blockquote cite:before {
	content: "\2014 \0020";
}

blockquote cite a,
blockquote cite a:visited {
	color: rgba(0, 0, 0, 0.6);
}

blockquote,
blockquote p {
	line-height: 1.6;
	color: var(--header-color);
}

/* Microformats */
.vcard {
	display: inline-block;
	margin: 0 0 1.25em 0;
	border: 1px solid #dddddd;
	padding: 0.625em 0.75em;
}

.vcard li {
	margin: 0;
	display: block;
}

.vcard .fn {
	font-weight: bold;
	font-size: 0.9375em;
}

.vevent .summary {
	font-weight: bold;
}

.vevent abbr {
	cursor: auto;
	text-decoration: none;
	font-weight: bold;
	border: none;
	padding: 0 0.0625em;
}

@media only screen and (min-width: 768px) {

	h1,
	h2,
	h3,
	#toctitle,
	.sidebarblock>.content>.title,
	h4,
	h5,
	h6 {
		line-height: 1.2;
	}

	h1 {
		font-size: 2.75em;
	}

	h2 {
		font-size: 2.3125em;
	}

	h3,
	#toctitle,
	.sidebarblock>.content>.title {
		font-size: 1.6875em;
	}

	h4 {
		font-size: 1.4375em;
	}
}

/* Tables */
table {
	background: var(--white-color);
	margin-bottom: 1.25em;
	border: solid 1px #dedede;
}

table thead,
table tfoot {
	background: var(--table-color);
	font-weight: bold;
}

table thead tr th,
table thead tr td,
table tfoot tr th,
table tfoot tr td {
	padding: 0.5em 0.625em 0.625em;
	font-size: inherit;
	color: var(--num-color);
	text-align: left;
}

table tr th,
table tr td {
	padding: 0.5625em 0.625em;
	font-size: inherit;
	color: var(--num-color);
}

table tr.even,
table tr.alt,
table tr:nth-of-type(even) {
	background: var(--nav-color);
}

table thead tr th,
table tfoot tr th,
table tbody tr td,
table tr td,
table tfoot tr td {
	display: table-cell;
	line-height: 1.6;
}

body {
	tab-size: 4;
}

h1,
h2,
h3,
#toctitle,
.sidebarblock>.content>.title,
h4,
h5,
h6 {
	line-height: 1.2;
	word-spacing: -0.05em;
}

h1 strong,
h2 strong,
h3 strong,
#toctitle strong,
.sidebarblock>.content>.title strong,
h4 strong,
h5 strong,
h6 strong {
	font-weight: 400;
}

.clearfix:before,
.clearfix:after,
.float-group:before,
.float-group:after {
	content: " ";
	display: table;
}

.clearfix:after,
.float-group:after {
	clear: both;
}

*:not(pre)>code {
	font-size: 0.9375em;
	font-style: normal !important;
	letter-spacing: 0;
	padding: 0.1em 0.5ex;
	word-spacing: -0.15em;
	background-color: var(--code-color);
	-webkit-border-radius: 4px;
	border-radius: 4px;
	line-height: 1.45;
	text-rendering: optimizeSpeed;
	word-wrap: break-word;
}

*:not(pre)>code.nobreak {
	word-wrap: normal;
}

*:not(pre)>code.nowrap {
	white-space: nowrap;
}

pre,
pre>code {
	line-height: 1.45;
	color: var(--code-text-color);
	font-family: "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace;
	font-weight: normal;
	text-rendering: optimizeSpeed;
}

em em {
	font-style: normal;
}

strong strong {
	font-weight: normal;
}

.keyseq {
	color: rgba(51, 51, 51, 0.8);
}

kbd {
	font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
	display: inline-block;
	color: var(--num-color);
	font-size: 0.65em;
	line-height: 1.45;
	background-color: #f7f7f7;
	border: 1px solid #ccc;
	-webkit-border-radius: 3px;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset;
	box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset;
	margin: 0 0.15em;
	padding: 0.2em 0.5em;
	vertical-align: middle;
	position: relative;
	top: -0.1em;
	white-space: nowrap;
}

.keyseq kbd:first-child {
	margin-left: 0;
}

.keyseq kbd:last-child {
	margin-right: 0;
}

.menuseq,
.menu {
	color: var(--num-color);
}

b.button:before,
b.button:after {
	position: relative;
	top: -1px;
	font-weight: normal;
}

b.button:before {
	content: "[";
	padding: 0 3px 0 2px;
}

b.button:after {
	content: "]";
	padding: 0 2px 0 3px;
}

p a>code:hover {
	color: var(--code-text-color);
}

#header,
#content,
#footnotes,
#footer {
	width: 100%;
	margin-left: auto;
	margin-right: auto;
	margin-top: 0;
	margin-bottom: 0;
	max-width: 62.5em;
	*zoom: 1;
	position: relative;
	padding-left: 0.9375em;
	padding-right: 0.9375em;
}

#header:before,
#header:after,
#content:before,
#content:after,
#footnotes:before,
#footnotes:after,
#footer:before,
#footer:after {
	content: " ";
	display: table;
}

#header:after,
#content:after,
#footnotes:after,
#footer:after {
	clear: both;
}

#content {
	margin-top: 1.25em;
}

#content:before {
	content: none;
}

#header>h1:first-child {
	color: var(--header-color);
	margin-top: 2.25rem;
	margin-bottom: 0;
}

#header>h1:first-child+#toc {
	margin-top: 8px;
	border-top: 1px solid #ddddd8;
}

#header>h1:only-child,
body.toc2 #header>h1:nth-last-child(2) {
	border-bottom: 1px solid #ddddd8;
	padding-bottom: 8px;
}

#header .details {
	border-bottom: 1px solid #ddddd8;
	line-height: 1.45;
	padding-top: 0.25em;
	padding-bottom: 0.25em;
	padding-left: 0.25em;
	color: rgba(0, 0, 0, 0.6);
	display: -ms-flexbox;
	display: -webkit-flex;
	display: flex;
	-ms-flex-flow: row wrap;
	-webkit-flex-flow: row wrap;
	flex-flow: row wrap;
}

#header .details span:first-child {
	margin-left: -0.125em;
}

#header .details span.email a {
	color: var(--header-color);
}

#header .details br {
	display: none;
}

#header .details br+span:before {
	content: "\00a0\2013\00a0";
}

#header .details br+span.author:before {
	content: "\00a0\22c5\00a0";
	color: var(--header-color);
}

#header .details br+span#revremark:before {
	content: "\00a0|\00a0";
}

#header #revnumber {
	text-transform: capitalize;
}

#header #revnumber:after {
	content: "\00a0";
}

#content>h1:first-child:not([class]) {
	color: var(--header-color);
	border-bottom: 1px solid #ddddd8;
	padding-bottom: 8px;
	margin-top: 0;
	padding-top: 1rem;
	margin-bottom: 1.25rem;
}

#toc {
	border-bottom: 1px solid #efefed;
	padding-bottom: 0.5em;
}

#toc>ul {
	margin-left: 0.125em;
}

#toc ul.sectlevel0>li>a {
	font-style: italic;
}

#toc ul.sectlevel0 ul.sectlevel1 {
	margin: 0.5em 0;
}

#toc ul {
	font-family: "Open Sans", "DejaVu Sans", sans-serif;
	list-style-type: none;
}

#toc li {
	line-height: 1.3334;
	margin-top: 0.3334em;
}

#toc a {
	text-decoration: none;
}

#toc a:active {
	text-decoration: underline;
}

#toctitle {
	color: #7a2518;
	font-size: 1.2em;
}

@media only screen and (min-width: 768px) {
	#toctitle {
		font-size: 1.375em;
	}

	body.toc2 {
		padding-left: 15em;
		padding-right: 0;
	}

	#toc.toc2 {
		margin-top: 0 !important;
		background-color: var(--nav-color);
		position: fixed;
		width: 15em;
		left: 0;
		top: 0;
		border-right: 1px solid #efefed;
		border-top-width: 0 !important;
		border-bottom-width: 0 !important;
		z-index: 1000;
		padding: 1.25em 1em;
		height: 100%;
		overflow: auto;
	}

	#toc.toc2 #toctitle {
		margin-top: 0;
		margin-bottom: 0.8rem;
		font-size: 1.2em;
	}

	#toc.toc2>ul {
		font-size: 0.9em;
		margin-bottom: 0;
	}

	#toc.toc2 ul ul {
		margin-left: 0;
		padding-left: 1em;
	}

	#toc.toc2 ul.sectlevel0 ul.sectlevel1 {
		padding-left: 0;
		margin-top: 0.5em;
		margin-bottom: 0.5em;
	}

	body.toc2.toc-right {
		padding-left: 0;
		padding-right: 15em;
	}

	body.toc2.toc-right #toc.toc2 {
		border-right-width: 0;
		border-left: 1px solid #efefed;
		left: auto;
		right: 0;
	}
}

@media only screen and (min-width: 1280px) {
	body.toc2 {
		padding-left: 20em;
		padding-right: 0;
	}

	#toc.toc2 {
		width: 20em;
	}

	#toc.toc2 #toctitle {
		font-size: 1.375em;
	}

	#toc.toc2>ul {
		font-size: 0.95em;
	}

	#toc.toc2 ul ul {
		padding-left: 1.25em;
	}

	body.toc2.toc-right {
		padding-left: 0;
		padding-right: 20em;
	}
}

#content #toc {
	border-style: solid;
	border-width: 1px;
	border-color: #e0e0dc;
	margin-bottom: 1.25em;
	padding: 1.25em;
	background: var(--nav-color);
	-webkit-border-radius: 4px;
	border-radius: 4px;
}

#content #toc> :first-child {
	margin-top: 0;
}

#content #toc> :last-child {
	margin-bottom: 0;
}

#footer {
	max-width: 100%;
	background-color: var(--num-color);
	padding: 1.25em;
}

#footer-text {
	color: rgba(255, 255, 255, 0.8);
	line-height: 1.44;
}

.sect1 {
	padding-bottom: 0.625em;
}

@media only screen and (min-width: 768px) {
	.sect1 {
		padding-bottom: 1.25em;
	}
}

.sect1+.sect1 {
	border-top: 1px solid #efefed;
}

#content h1>a.anchor,
h2>a.anchor,
h3>a.anchor,
#toctitle>a.anchor,
.sidebarblock>.content>.title>a.anchor,
h4>a.anchor,
h5>a.anchor,
h6>a.anchor {
	position: absolute;
	z-index: 1001;
	width: 1.5ex;
	margin-left: -1.5ex;
	display: block;
	text-decoration: none !important;
	visibility: hidden;
	text-align: center;
	font-weight: normal;
}

#content h1>a.anchor:before,
h2>a.anchor:before,
h3>a.anchor:before,
#toctitle>a.anchor:before,
.sidebarblock>.content>.title>a.anchor:before,
h4>a.anchor:before,
h5>a.anchor:before,
h6>a.anchor:before {
	content: "\00A7";
	font-size: 0.85em;
	display: block;
	padding-top: 0.1em;
}

#content h1:hover>a.anchor,
#content h1>a.anchor:hover,
h2:hover>a.anchor,
h2>a.anchor:hover,
h3:hover>a.anchor,
#toctitle:hover>a.anchor,
.sidebarblock>.content>.title:hover>a.anchor,
h3>a.anchor:hover,
#toctitle>a.anchor:hover,
.sidebarblock>.content>.title>a.anchor:hover,
h4:hover>a.anchor,
h4>a.anchor:hover,
h5:hover>a.anchor,
h5>a.anchor:hover,
h6:hover>a.anchor,
h6>a.anchor:hover {
	visibility: visible;
}

#content h1>a.link,
h2>a.link,
h3>a.link,
#toctitle>a.link,
.sidebarblock>.content>.title>a.link,
h4>a.link,
h5>a.link,
h6>a.link {
	color: #ba3925;
	text-decoration: none;
}

#content h1>a.link:hover,
h2>a.link:hover,
h3>a.link:hover,
#toctitle>a.link:hover,
.sidebarblock>.content>.title>a.link:hover,
h4>a.link:hover,
h5>a.link:hover,
h6>a.link:hover {
	color: #a53221;
}

.audioblock,
.imageblock,
.literalblock,
.listingblock,
.stemblock,
.videoblock {
	margin-bottom: 1.25em;
}

.admonitionblock td.content>.title,
.audioblock>.title,
.exampleblock>.title,
.imageblock>.title,
.listingblock>.title,
.literalblock>.title,
.stemblock>.title,
.openblock>.title,
.paragraph>.title,
.quoteblock>.title,
table.tableblock>.title,
.verseblock>.title,
.videoblock>.title,
.dlist>.title,
.olist>.title,
.ulist>.title,
.qlist>.title,
.hdlist>.title {
	text-rendering: optimizeLegibility;
	text-align: left;
	font-family: "Noto Serif", "DejaVu Serif", serif;
	font-size: 1rem;
	font-style: italic;
}

table.tableblock>caption.title {
	white-space: nowrap;
	overflow: visible;
	max-width: 0;
}

.paragraph.lead>p,
#preamble>.sectionbody>.paragraph:first-of-type p {
	color: var(--header-color);
}

table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p {
	font-size: inherit;
}

/* Custom SVG logos coloring */
path {
	fill="#02303A";
}

.dark-mode path {
	fill: white;
}

/* Custom scroll bar */
/* Works on Firefox */
.docs-navigation {
	scrollbar-width: auto;
	scrollbar-color: #686868 #e7e7e9;
}

/* Works on Chrome, Edge, and Safari */
.docs-navigation::-webkit-scrollbar {
	width: 12px;
}

.docs-navigation::-webkit-scrollbar-track {
	background: #e7e7e9;
}

.docs-navigation::-webkit-scrollbar-thumb {
	background-color: #686868;
	border-radius: 20px;
	border: 3px #686868;
}

.dark-mode {
    /* Works on Firefox */
    * {
      scrollbar-width: auto;
      scrollbar-color: #686868 #242526;
    }

    /* Works on Chrome, Edge, and Safari */
    *::-webkit-scrollbar {
      width: auto;
    }

    *::-webkit-scrollbar-track {
      background: #242526;
    }

    *::-webkit-scrollbar-thumb {
      background-color: #686868;
      border-radius: 20px;
      border: 3px #686868;
    }
}

/* Custom Admonition Blocks - Icons from https://github.com/primer/octicons */
.admonitionblock td div:last-of-type p {
	margin-bottom: 0em !important;
}

.admonitionblock {
	margin: 1.4rem 0 0
}

.admonitionblock i {
	font-family: inherit;
}

.admonitionblock i.fa {
	background: no-repeat 50%/1em 1em;
	display: inline-block;
	filter: var(--doc-icon-filter);
	font-style: normal;
	height: 1em;
	-webkit-hyphens: none;
	hyphens: none;
	vertical-align: -.125em;
	width: 1em
}

.admonitionblock p,
.admonitionblock td.content {
	font-size: 1rem;
}

.admonitionblock td.content>.title+*,
.admonitionblock td.content>:not(.title):first-child {
	margin-top: 0
}

.admonitionblock pre {
	font-size: calc(15/var(--rem-base)*1rem)
}

.admonitionblock>table {
	position: relative;
	table-layout: fixed;
	border: none;
	width: 100%
}

.admonitionblock td.content {
	word-wrap: anywhere;
	background: var(--admonition-background);
	padding: 1rem 1rem 1rem 1rem;
	width: 100%;
	border-radius: 4px;
}

.admonitionblock td.icon {
	background: linear-gradient(90deg, rgba(0, 0, 0, .2) 0, rgba(0, 0, 0, .2)) no-repeat 0 /2.075em 100%;
	border-radius: .5em;
	font-size: calc(15/var(--rem-base)*1rem);
	left: 0;
	line-height: 1;
	padding: .25em .075em;
	position: absolute;
	top: 0;
	transform: translate(-.5rem, -50%)
}

.admonitionblock td.icon i {
	align-items: center;
	background-position-x: .5em;
	display: inline-flex;
	filter: invert(100%);
	padding-left: 2em;
	vertical-align: initial;
	width: auto
}

.admonitionblock td.icon i::after {
	content: attr(title);
	filter: invert(100%);
	font-style: normal;
	font-weight: bold;
	margin: -.05em;
	padding: 0 .5em;
	text-transform: uppercase
}

.admonitionblock.caution td.icon {
	background-color: var(--caution-color);
	color: var(--caution-on-color)
}

.admonitionblock.caution td.icon i {
	background-image: url(./img/octicons-16.svg#view-flame)
}

.admonitionblock.important td.icon {
	background-color: var(--important-color);
	color: var(--important-on-color)
}

.admonitionblock.important td.icon i {
	background-image: url(./img/octicons-16.svg#view-stop)
}

.admonitionblock.note td.icon {
	background-color: var(--note-color);
	color: var(--note-on-color)
}

.admonitionblock.note td.icon i {
	background-image: url(./img/octicons-16.svg#view-info)
}

.admonitionblock.tip td.icon {
	background-color: var(--tip-color);
	color: var(--tip-on-color)
}

.admonitionblock.tip td.icon i {
	background-image: url(./img/octicons-16.svg#view-light-bulb)
}

.admonitionblock.warning td.icon {
	background-color: var(--warning-color);
	color: var(--warning-on-color)
}

.admonitionblock.warning td.icon i {
	background-image: url(./img/octicons-16.svg#view-alert)
}

/* Custom collapsible block */
details summary {
	width: 100%;
	padding: 1rem 0;
	border-top: 1px solid gray;
	position: relative;
	cursor: pointer;
	list-style: none;
}

details summary:after {
	content: "+";
	color: var(--black-color);
	position: absolute;
	font-size: 1.75rem;
	line-height: 0;
	margin-top: 0.3rem;
	right: 0;
	font-weight: 400;
	transform-origin: center;
	transition: 200ms linear;
}

details[open] summary:after {
	transform: rotate(45deg);
	font-size: 2rem;
}

details summary {
	outline: 0;
}

details p {
	font-size: 0.95rem;
	margin: 0 0 1rem;
	padding-top: 1rem;
}

.exampleblock>.content {
	border-style: solid;
	border-width: 1px;
	border-color: #e6e6e6;
	margin-bottom: 1.25em;
	padding: 1.25em;
	background: var(--white-color);
	-webkit-border-radius: 4px;
	border-radius: 4px;
}

.exampleblock>.content> :first-child {
	margin-top: 0;
}

.exampleblock>.content> :last-child {
	margin-bottom: 0;
}

.sidebarblock {
	border-style: solid;
	border-width: 1px;
	border-color: #e0e0dc;
	margin-bottom: 1.25em;
	padding: 1.25em;
	background: var(--nav-color);
	-webkit-border-radius: 4px;
	border-radius: 4px;
}

.sidebarblock> :first-child {
	margin-top: 0;
}

.sidebarblock> :last-child {
	margin-bottom: 0;
}

.sidebarblock>.content>.title {
	color: #7a2518;
	margin-top: 0;
	text-align: center;
}

.exampleblock>.content> :last-child> :last-child,
.exampleblock>.content .olist>ol>li:last-child> :last-child,
.exampleblock>.content .ulist>ul>li:last-child> :last-child,
.exampleblock>.content .qlist>ol>li:last-child> :last-child,
.sidebarblock>.content> :last-child> :last-child,
.sidebarblock>.content .olist>ol>li:last-child> :last-child,
.sidebarblock>.content .ulist>ul>li:last-child> :last-child,
.sidebarblock>.content .qlist>ol>li:last-child> :last-child {
	margin-bottom: 0;
}

.literalblock pre,
.listingblock pre:not(.highlight),
.listingblock pre[class="highlight"],
.listingblock pre[class^="highlight "],
.listingblock pre.CodeRay,
.listingblock pre.prettyprint {
	background: var(--code-color);
}

.sidebarblock .literalblock pre,
.sidebarblock .listingblock pre:not(.highlight),
.sidebarblock .listingblock pre[class="highlight"],
.sidebarblock .listingblock pre[class^="highlight "],
.sidebarblock .listingblock pre.CodeRay,
.sidebarblock .listingblock pre.prettyprint {
	background: #f2f1f1;
}

.literalblock pre,
.literalblock pre[class],
.listingblock pre,
.listingblock pre[class] {
	-webkit-border-radius: 4px;
	border-radius: 4px;
	word-wrap: break-word;
	padding: 1em;
	font-size: 0.8125em;
}

.literalblock pre.nowrap,
.literalblock pre[class].nowrap,
.listingblock pre.nowrap,
.listingblock pre[class].nowrap {
	overflow-x: auto;
	white-space: pre;
	word-wrap: normal;
}

@media only screen and (min-width: 768px) {

	.literalblock pre,
	.literalblock pre[class],
	.listingblock pre,
	.listingblock pre[class] {
		font-size: 0.90625em;
	}
}

@media only screen and (min-width: 1280px) {

	.literalblock pre,
	.literalblock pre[class],
	.listingblock pre,
	.listingblock pre[class] {
		font-size: 1em;
	}
}

.literalblock.output pre {
	color: var(--code-color);
	background-color: var(--code-text-color);
}

.listingblock pre.highlightjs {
	padding: 0;
}

.listingblock pre.highlightjs>code {
	padding: 1em;
	-webkit-border-radius: 4px;
	border-radius: 4px;
}

.listingblock pre.prettyprint {
	border-width: 0;
}

.listingblock>.content {
	position: relative;
}

.listingblock code[data-lang]:before {
	display: none;
	content: attr(data-lang);
	position: absolute;
	font-size: 0.75em;
	top: 0.425rem;
	right: 0.5rem;
	line-height: 1;
	text-transform: uppercase;
	color: #999;
}

.listingblock:hover code[data-lang]:before {
	display: block;
}

.listingblock.terminal pre .command:before {
	content: attr(data-prompt);
	padding-right: 0.5em;
	color: #999;
}

.listingblock.terminal pre .command:not([data-prompt]):before {
	content: "$";
}

table.pyhltable {
	border-collapse: separate;
	border: 0;
	margin-bottom: 0;
	background: none;
}

table.pyhltable td {
	vertical-align: top;
	padding-top: 0;
	padding-bottom: 0;
	line-height: 1.45;
}

table.pyhltable td.code {
	padding-left: .75em;
	padding-right: 0;
}

pre.pygments .lineno,
table.pyhltable td:not(.code) {
	color: #999;
	padding-left: 0;
	padding-right: .5em;
	border-right: 1px solid #ddddd8;
}

pre.pygments .lineno {
	display: inline-block;
	margin-right: .25em;
}

table.pyhltable .linenodiv {
	background: none !important;
	padding-right: 0 !important;
}

.quoteblock {
	margin: 0 1em 1.25em 1.5em;
	display: table;
}

.quoteblock>.title {
	margin-left: -1.5em;
	margin-bottom: 0.75em;
}

.quoteblock blockquote,
.quoteblock blockquote p {
	color: var(--header-color);
	font-size: 1.15rem;
	line-height: 1.75;
	word-spacing: 0.1em;
	letter-spacing: 0;
	font-style: italic;
	text-align: justify;
}

.quoteblock blockquote {
	margin: 0;
	padding: 0;
	border: 0;
}

.quoteblock blockquote:before {
	content: "\201c";
	float: left;
	font-size: 2.75em;
	font-weight: bold;
	line-height: 0.6em;
	margin-left: -0.6em;
	color: var(--quoteblock-color);
	text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.quoteblock blockquote>.paragraph:last-child p {
	margin-bottom: 0;
}

.quoteblock .attribution {
	margin-top: 0.5em;
	margin-right: 0.5ex;
	text-align: right;
}

.quoteblock .quoteblock {
	margin-left: 0;
	margin-right: 0;
	padding: 0.5em 0;
	border-left: 3px solid rgba(0, 0, 0, 0.6);
}

.quoteblock .quoteblock blockquote {
	padding: 0 0 0 0.75em;
}

.quoteblock .quoteblock blockquote:before {
	display: none;
}

.verseblock {
	margin: 0 1em 1.25em 1em;
}

.verseblock pre {
	font-family: "Open Sans", "DejaVu Sans", sans;
	font-size: 1.15rem;
	color: var(--header-color);
	font-weight: 300;
	text-rendering: optimizeLegibility;
}

.verseblock pre strong {
	font-weight: 400;
}

.verseblock .attribution {
	margin-top: 1.25rem;
	margin-left: 0.5ex;
}

.quoteblock .attribution,
.verseblock .attribution {
	font-size: 0.9375em;
	line-height: 1.45;
	font-style: italic;
}

.quoteblock .attribution br,
.verseblock .attribution br {
	display: none;
}

.quoteblock .attribution cite,
.verseblock .attribution cite {
	display: block;
	letter-spacing: -0.025em;
	color: rgba(0, 0, 0, 0.6);
}

.quoteblock.abstract {
	margin: 0 0 1.25em 0;
	display: block;
}

.quoteblock.abstract blockquote,
.quoteblock.abstract blockquote p {
	text-align: left;
	word-spacing: 0;
}

.quoteblock.abstract blockquote:before,
.quoteblock.abstract blockquote p:first-of-type:before {
	display: none;
}

table.tableblock {
	max-width: 100%;
	border-collapse: separate;
}

table.tableblock td>.paragraph:last-child p>p:last-child,
table.tableblock th>p:last-child,
table.tableblock td>p:last-child {
	margin-bottom: 0;
}

table.tableblock,
th.tableblock,
td.tableblock {
	border: 0 solid #dedede;
}

table.grid-all th.tableblock,
table.grid-all td.tableblock {
	border-width: 0 1px 1px 0;
}

table.grid-all tfoot>tr>th.tableblock,
table.grid-all tfoot>tr>td.tableblock {
	border-width: 1px 1px 0 0;
}

table.grid-cols th.tableblock,
table.grid-cols td.tableblock {
	border-width: 0 1px 0 0;
}

table.grid-all *>tr>.tableblock:last-child,
table.grid-cols *>tr>.tableblock:last-child {
	border-right-width: 0;
}

table.grid-rows th.tableblock,
table.grid-rows td.tableblock {
	border-width: 0 0 1px 0;
}

table.grid-all tbody>tr:last-child>th.tableblock,
table.grid-all tbody>tr:last-child>td.tableblock,
table.grid-all thead:last-child>tr>th.tableblock,
table.grid-rows tbody>tr:last-child>th.tableblock,
table.grid-rows tbody>tr:last-child>td.tableblock,
table.grid-rows thead:last-child>tr>th.tableblock {
	border-bottom-width: 0;
}

table.grid-rows tfoot>tr>th.tableblock,
table.grid-rows tfoot>tr>td.tableblock {
	border-width: 1px 0 0 0;
}

table.frame-all {
	border-width: 1px;
}

table.frame-sides {
	border-width: 0 1px;
}

table.frame-topbot {
	border-width: 1px 0;
}

th.halign-left,
td.halign-left {
	text-align: left;
}

th.halign-right,
td.halign-right {
	text-align: right;
}

th.halign-center,
td.halign-center {
	text-align: center;
}

th.valign-top,
td.valign-top {
	vertical-align: top;
}

th.valign-bottom,
td.valign-bottom {
	vertical-align: bottom;
}

th.valign-middle,
td.valign-middle {
	vertical-align: middle;
}

table thead th,
table tfoot th {
	font-weight: bold;
}

tbody tr th {
	display: table-cell;
	line-height: 1.6;
	background: var(--table-color);
}

tbody tr th,
tbody tr th p,
tfoot tr th,
tfoot tr th p {
	color: var(--num-color);
	font-weight: bold;
}

p.tableblock>code:only-child {
	background: none;
	padding: 0;
}

p.tableblock {
	font-size: 1em;
}

td>div.verse {
	white-space: pre;
}

ol {
	margin-left: 1.75em;
}

ul li ol {
	margin-left: 1.5em;
}

dl dd {
	margin-left: 1.125em;
}

dl dd:last-child,
dl dd:last-child> :last-child {
	margin-bottom: 0;
}

ol>li p,
ul>li p,
ul dd,
ol dd,
.olist .olist,
.ulist .ulist,
.ulist .olist,
.olist .ulist {
	margin-bottom: 0.625em;
}

ul.unstyled,
ol.unnumbered,
ul.checklist,
ul.none {
	list-style-type: none;
}

ul.unstyled,
ol.unnumbered,
ul.checklist {
	margin-left: 0.625em;
}

ul.checklist li>p:first-child>.fa-square-o:first-child,
ul.checklist li>p:first-child>.fa-check-square-o:first-child {
	width: 1em;
	font-size: 0.85em;
}

ul.checklist li>p:first-child>input[type="checkbox"]:first-child {
	width: 1em;
	position: relative;
	top: 1px;
}

ul.inline {
	margin: 0 auto 0.625em auto;
	margin-left: -1.375em;
	margin-right: 0;
	padding: 0;
	list-style: none;
	overflow: hidden;
}

ul.inline>li {
	list-style: none;
	float: left;
	margin-left: 1.375em;
	display: block;
}

ul.inline>li>* {
	display: block;
}

.unstyled dl dt {
	font-weight: normal;
	font-style: normal;
}

ol.arabic {
	list-style-type: decimal;
}

ol.decimal {
	list-style-type: decimal-leading-zero;
}

ol.loweralpha {
	list-style-type: lower-alpha;
}

ol.upperalpha {
	list-style-type: upper-alpha;
}

ol.lowerroman {
	list-style-type: lower-roman;
}

ol.upperroman {
	list-style-type: upper-roman;
}

ol.lowergreek {
	list-style-type: lower-greek;
}

.hdlist>table,
.colist>table {
	border: 0;
	background: none;
}

.hdlist>table>tbody>tr,
.colist>table>tbody>tr {
	background: none;
}

td.hdlist1,
td.hdlist2 {
	vertical-align: top;
	padding: 0 0.625em;
}

td.hdlist1 {
	font-weight: bold;
	padding-bottom: 1.25em;
}

.literalblock+.colist {
	margin-top: -0.5em;
}

.colist>table tr>td:first-of-type {
	padding: 0 0.75em;
	line-height: 1;
}

.colist>table tr>td:first-of-type img {
	max-width: initial;
}

.colist>table tr>td:last-of-type {
	padding: 0.25em 0;
}

.thumb,
.th {
	line-height: 0;
	display: inline-block;
	border: solid 4px var(--white-color);
	-webkit-box-shadow: 0 0 0 1px #dddddd;
	box-shadow: 0 0 0 1px #dddddd;
}

.imageblock.left,
.imageblock[style*="float: left"] {
	margin: 0.25em 0.625em 1.25em 0;
}

.imageblock.right,
.imageblock[style*="float: right"] {
	margin: 0.25em 0 1.25em 0.625em;
}

.imageblock>.title {
	margin-bottom: 0;
}

.imageblock.thumb,
.imageblock.th {
	border-width: 6px;
}

.imageblock.thumb>.title,
.imageblock.th>.title {
	padding: 0 0.125em;
}

.image.left,
.image.right {
	margin-top: 0.25em;
	margin-bottom: 0.25em;
	display: inline-block;
	line-height: 0;
}

.image.left {
	margin-right: 0.625em;
}

.image.right {
	margin-left: 0.625em;
}

a.image {
	text-decoration: none;
	display: inline-block;
}

a.image object {
	pointer-events: none;
}

sup.footnote,
sup.footnoteref {
	font-size: 0.875em;
	position: static;
	vertical-align: super;
}

sup.footnote a,
sup.footnoteref a {
	text-decoration: none;
}

sup.footnote a:active,
sup.footnoteref a:active {
	text-decoration: underline;
}

#footnotes {
	padding-top: 0.75em;
	padding-bottom: 0.75em;
	margin-bottom: 0.625em;
}

#footnotes hr {
	width: 20%;
	min-width: 6.25em;
	margin: -0.25em 0 0.75em 0;
	border-width: 1px 0 0 0;
}

#footnotes .footnote {
	padding: 0 0.375em 0 0.225em;
	line-height: 1.3334;
	font-size: 0.875em;
	margin-left: 1.2em;
	text-indent: -1.05em;
	margin-bottom: 0.2em;
}

#footnotes .footnote a:first-of-type {
	font-weight: bold;
	text-decoration: none;
}

#footnotes .footnote:last-of-type {
	margin-bottom: 0;
}

#content #footnotes {
	margin-top: -0.625em;
	margin-bottom: 0;
	padding: 0.75em 0;
}

.gist .file-data>table {
	border: 0;
	background: var(--white-color);
	width: 100%;
	margin-bottom: 0;
}

.gist .file-data>table td.line-data {
	width: 99%;
}

div.unbreakable {
	page-break-inside: avoid;
}

.big {
	font-size: larger;
}

.small {
	font-size: smaller;
}

.underline {
	text-decoration: underline;
}

.overline {
	text-decoration: overline;
}

.line-through {
	text-decoration: line-through;
}

.green {
    color: #006000;
}

.red {
    color: #bf0000;
}

.yellow {
    color: #bfbf00;
}

span.icon>.fa {
	cursor: default;
}

.conum[data-value] {
	display: inline-block;
	color: var(--white-color) !important;
	background-color: var(--num-color);
	-webkit-border-radius: 100px;
	border-radius: 100px;
	text-align: center;
	font-size: 0.75em;
	width: 1.67em;
	height: 1.67em;
	line-height: 1.67em;
	font-family: "Open Sans", "DejaVu Sans", sans-serif;
	font-style: normal;
	font-weight: bold;
}

.conum[data-value] * {
	color: var(--white-color) !important;
}

.conum[data-value]+b {
	display: none;
}

.conum[data-value]:after {
	content: attr(data-value);
}

pre .conum[data-value] {
	position: relative;
	top: -0.125em;
}

b.conum * {
	color: inherit !important;
}

.conum:not([data-value]):empty {
	display: none;
}

dt,
th.tableblock,
td.content,
div.footnote {
	text-rendering: optimizeLegibility;
}

h1,
h2,
p,
td.content,
span.alt {
	letter-spacing: -0.01em;
}

p strong,
td.content strong,
div.footnote strong {
	letter-spacing: -0.005em;
}

p,
blockquote,
dt,
td.content,
span.alt {
	font-size: 1.0625rem;
}

p {
	margin-bottom: 1.25rem;
}

.sidebarblock p,
.sidebarblock dt,
.sidebarblock td.content,
p.tableblock {
	font-size: 1em;
}

.exampleblock>.content {
	background-color: #fffef7;
	border-color: #e0e0dc;
	-webkit-box-shadow: 0 1px 4px #e0e0dc;
	box-shadow: 0 1px 4px #e0e0dc;
}

.print-only {
	display: none !important;
}

@media print {
	@page {
		margin: 1.25cm 0.75cm;
	}

	* {
		-webkit-box-shadow: none !important;
		box-shadow: none !important;
		text-shadow: none !important;
	}

	a {
		color: inherit !important;
		text-decoration: underline !important;
	}

	a.bare,
	a[href^="#"],
	a[href^="mailto:"] {
		text-decoration: none !important;
	}

	a[href^="http:"]:not(.bare):after,
	a[href^="https:"]:not(.bare):after {
		content: "(" attr(href) ")";
		display: inline-block;
		font-size: 0.875em;
		padding-left: 0.25em;
	}

	abbr[title]:after {
		content: " (" attr(title) ")";
	}

	pre,
	blockquote,
	tr,
	img,
	object,
	svg {
		page-break-inside: avoid;
	}

	thead {
		display: table-header-group;
	}

	svg {
		max-width: 100%;
	}

	p,
	blockquote,
	dt,
	td.content {
		font-size: 1em;
		orphans: 3;
		widows: 3;
	}

	h2,
	h3,
	#toctitle,
	.sidebarblock>.content>.title,
	#toctitle,
	.sidebarblock>.content>.title {
		page-break-after: avoid;
	}

	#toc,
	.sidebarblock,
	.exampleblock>.content {
		background: none !important;
	}

	#toc {
		border-bottom: 1px solid #ddddd8 !important;
		padding-bottom: 0 !important;
	}

	.sect1 {
		padding-bottom: 0 !important;
	}

	.sect1+.sect1 {
		border: 0 !important;
	}

	#header>h1:first-child {
		margin-top: 1.25rem;
	}

	body.book #header {
		text-align: center;
	}

	body.book #header>h1:first-child {
		border: 0 !important;
		margin: 2.5em 0 1em 0;
	}

	body.book #header .details {
		border: 0 !important;
		display: block;
		padding: 0 !important;
	}

	body.book #header .details span:first-child {
		margin-left: 0 !important;
	}

	body.book #header .details br {
		display: block;
	}

	body.book #header .details br+span:before {
		content: none !important;
	}

	body.book #toc {
		border: 0 !important;
		text-align: left !important;
		padding: 0 !important;
		margin: 0 !important;
	}

	body.book #toc,
	body.book #preamble,
	body.book h1.sect0,
	body.book .sect1>h2 {
		page-break-before: always;
	}

	.listingblock code[data-lang]:before {
		display: block;
	}

	#footer {
		background: none !important;
		padding: 0 0.9375em;
	}

	#footer-text {
		color: rgba(0, 0, 0, 0.6) !important;
		font-size: 0.9em;
	}

	.hide-on-print {
		display: none !important;
	}

	.print-only {
		display: block !important;
	}

	.hide-for-print {
		display: none !important;
	}

	.show-for-print {
		display: inherit !important;
	}
}

/* END asciidoc.css */

html,
body {
	margin: 0;
	padding: 0;
}

html {
	font-size: 16px;
	font-weight: 400;
	line-height: 1.5;
}

body {
	color: var(--text-color);
	background-color: var(--white-color);
	font-family: "Lato", "Helvetica Neue", Arial, sans-serif;
	line-height: 1.5;
	-webkit-text-size-adjust: 100%;
	-ms-text-size-adjust: 100%;
}

/* Links */
a {
	color: #1DA2BD;
	text-decoration: none;
}

a:hover,
a:focus {
	text-decoration: underline;
}

#content a[href^='../dsl/'],
#content a[href^='../kotlin-dsl/'],
#content a[href^='../javadoc/'] {
	font-family: 'Inconsolata', monospace;
	font-style: normal;
	border-bottom: 1px dotted rgba(29, 162, 189, 0.5);
	padding: 0 1px;
}

#content a[href^='../dsl/']:hover,
#content a[href^='../dsl/']:focus,
#content a[href^='../kotlin-dsl/']:hover,
#content a[href^='../kotlin-dsl/']:focus,
#content a[href^='../javadoc/']:hover,
#content a[href^='../javadoc/']:focus {
	text-decoration: none;
}

/* Copy */

p {
	font-size: 1rem;
}

pre,
pre>code,
code {
	font-family: 'Inconsolata', monospace;
}

h1,
h2,
h3,
h4,
h5,
h6,
#toctitle,
.sidebarblock>.content>.title {
	font-family: inherit;
	font-weight: 500;
	color: inherit;
}

h1 {
	font-size: 2rem;
}

h2 {
	font-size: 1.5rem;
}

h3 {
	font-size: 1.125rem;
}

h4 {
	font-size: 1.0625rem;
}

h5,
h6 {
	font-size: 1rem;
}

b,
strong {
	font-weight: 500;
}

dl {
	margin: 0 0 1.25rem 1.5rem;
}

.dlist dt code {
	color: var(--text-color);
	font-size: 1em;
	font-weight: bold;
}

.dlist p {
	margin-bottom: 0.625rem;
}

.sr-only {
	border: 0;
	clip: rect(0, 0, 0, 0);
	height: 1px;
	margin: -1px;
	overflow: hidden;
	padding: 0;
	position: absolute;
	width: 1px;
}

/* Layout */
.main-content>.appendix,
.main-content>.book,
.main-content>.chapter,
.main-content>.footer {
	background-color: var(--white-color);
	border-radius: 5px;
	max-width: 45rem;
	padding: 1.5rem;
}

@media screen and (max-width: 45em) {
	.footer {
		max-width: 100%;
	}

	.main-content>.appendix,
	.main-content>.book,
	.main-content>.chapter {
		margin-top: 0;
		margin-bottom: 0;
	}
}

/* Override asciidoc styles */
#header {
	position: static;
}

#header,
#content {
	padding: 0;
}

#header .details {
	/* TODO: Pretty sure there's a way to avoid Asciidoc generating details */
	display: none;
}

p {
	color: var(--text-color);
}

h1,
h2,
p,
p strong,
td.content,
td.content strong,
div.footnote strong,
span.alt {
	letter-spacing: normal;
}

.subheader,
.admonitionblock td.content>.title,
.audioblock>.title,
.exampleblock>.title,
.imageblock>.title,
.listingblock>.title,
.literalblock>.title,
.stemblock>.title,
.openblock>.title,
.paragraph>.title,
.quoteblock>.title,
table.tableblock>.title,
.verseblock>.title,
.videoblock>.title,
.dlist>.title,
.olist>.title,
.ulist>.title,
.qlist>.title,
.hdlist>.title {
	color: inherit;
	font-family: inherit;
}

.listingblock .title,
.listingblock .title code {
	font-style: normal;
	font-weight: bold;
}

.imageblock,
.videoblock {
	padding: 0.25em;
}

p.lead,
.paragraph.lead>p,
#preamble>.sectionbody>.paragraph:first-of-type p {
	font-size: 1.0625rem;
}

.paragraph.lead>p,
#preamble>.sectionbody>.paragraph:first-of-type p {
	color: inherit;
}

.sect1 {
	padding-bottom: 0;
}

.sect1+.sect1 {
	border: 0 none;
}

.verseblock pre {
	font-family: "Lato", Arial, sans-serif;
}

td.hdlist1 {
	padding-bottom: 0.625rem;
}

td.hdlist2 p {
	margin-bottom: 0.625rem;
}

body.book #header>h1 {
	border: 0;
}

#header>h1:first-child {
	margin-top: 0;
}

#content a.link {
	color: var(--title-color);
}

.highlight .com {
	color: #777;
}

.listingblock pre.highlightjs>code {
	overflow-x: auto;
}

.listingblock pre.highlight {
	overflow-x: auto;
}

.listingblock pre.highlight>code {
	white-space: pre;
}

.conum[data-value] {
	font-family: "Lato", Arial, sans-serif;
}

.colist>table tr>td:first-of-type {
	padding-top: 0.25em;
	padding-bottom: 0.25em;
	line-height: 1.4;
	vertical-align: baseline;
}

/*
 * Samples
 */
.exampleblock>.content {
	background-color: inherit;
	border: 0 none;
	box-shadow: none;
	padding: 0;
	padding-bottom: 0.7rem;
	margin-bottom: 0;
}

.exampleblock>.content .title {
	background-color: var(--code-color);
	border-top: 1px solid #ccc;
	font-family: 'Inconsolata', monospace;
	margin: 0;
	padding: 1em 1em 0;
}

.exampleblock>.title>a {
	text-decoration: none;
	color: var(--num-color);
}

.exampleblock .listingblock {
	margin: 0;
}

/*
 * Ensure that blocks of code do not wrap by applying the behavior of `[listing%nowrap]` by default.
 *
 * These styles are copied from a CSS ruleset in asciidoctor.css that has the same group of
 * selectors except that they end with `.nowrap`.
 */
.openblock .content {
	background: var(--admonition-background);
	margin-bottom: 1.25em;
	padding: 1em 1em 0em 1em;
	border-radius: 4px;
	overflow: auto !important;
}

.literalblock pre,
.literalblock pre[class],
.listingblock pre,
.listingblock pre[class] {
	overflow-x: auto;
	white-space: pre;
	word-wrap: normal;
}

/*
 * This CSS ruleset solves: https://github.com/gradle/guides/issues/113#issuecomment-314826749.
 */
.literalblock pre::after,
.literalblock pre[class]::after,
.listingblock pre::after,
.listingblock pre[class]::after {
	content: "";
}

.quoteblock blockquote,
.quoteblock blockquote p {
	text-align: left;
	text-align: start;
}

div.screenshot {
	box-shadow: 0 0 20px 1px rgba(0, 0, 0, 0.2);
	margin-left: auto;
	margin-right: auto;
	width: 90%;
}

.inset {
	box-shadow: 0 0 1px 1px rgba(0, 0, 0, 0.1);
	padding: 1em;
}

.image.inline-icon img {
	vertical-align: sub;
}

/* TOC */
#header>h1:first-child+#toc {
	background: none;
	border: 0 none;
	margin-top: 0;
}

#toc,
#content #toc {
	border: 0 none;
}

#toc>ul {
	margin-left: 0;
	font-family: inherit;
}

#toc>ul>li {
	line-height: 1.25;
	margin-top: 0;
	padding-bottom: 0.5rem;
}

#toc>ul>li:last-of-type {
	padding-bottom: 0;
}

#toc a {
	font-style: normal;
}

#toc a:hover,
#toc a:focus,
#toc a:hover code,
#toc a:focus code {
	color: #1DA2BD;
}

#toc a:active {
	text-decoration: none;
}

/* Site header specific styles */
.hamburger {
	background-color: transparent;
	background-image: none;
	border: none;
	border-radius: 4px;
	cursor: pointer;
	margin-left: auto;
	padding: 11px 10px;
}

.hamburger:focus {
	outline: 0;
}

.hamburger__bar {
	display: block;
	width: 22px;
	height: 2px;
	background-color: var(--black-color);
	border-radius: 1px;
}

.hamburger__bar+.hamburger__bar {
	margin-top: 4px;
}

.site-header {
	background-color: var(--top-header-color);
}

/* Override javadoc styles */
.site-header div {
	font-family: 'Lato', Arial, sans-serif;
}

.site-header__navigation-header a {
	align-self: center;
	border-bottom: 0 none;
	height: 36px;
}

.site-header .site-header-version {
	align-self: center;
	color: #1da2bd;
	font-size: 20px;
	padding-left: 1px;
	margin-top: 22px;
}

.site-header__navigation {
    z-index: 2;
	display: flex;
	flex-direction: column;
}

.site-header__navigation-header {
	display: flex;
	flex: 0 0 auto;
	margin-left: 12px;
}

.site-header__navigation-collapsible {
	flex: 1 1 auto;
	height: 210px;
	overflow: visible;
	transition: height 0.3s ease;
}

.site-header__navigation-items {
	display: flex;
	flex-direction: column;
	flex-wrap: wrap;
	align-items: flex-start;
	max-height: 210px;
	/* This matches the collapsible height above */
	margin: 0 20px;
	padding-top: 12px;
	padding-left: 0;
	list-style-type: none;
}

.site-header__navigation-item {
	flex: 0 1 auto;
	font-size: 16px;
	width: 250px;
}

.site-header__navigation-item .site-header__navigation-link {
	position: relative;
	display: inline-block;
	cursor: pointer;
	width: 100%;
	padding: 5px;
	line-height: 20px;
	border: 0 none;
	color: var(--text-color);
	text-decoration: none;
	transition: none;
	-o-transition: none;
	-moz-transition: none;
	-webkit-transition: none;
}

.site-header__navigation-item .site-header__navigation-link:hover {
	color: #1DA2BD;
}

.site-header__navigation-item .site-header__navigation-link.active {
	font-weight: 500;
}

/* Navigation submenu styles */
.site-header__navigation-submenu-section {
	position: relative;
}

.site-header__navigation-submenu-section .site-header__down-arrow {
	width: 8px;
	height: 8px;
	margin-left: 2px;
	margin-top: 0;
}

.site-header__navigation-submenu-section .site-header__navigation-link:hover path {
	fill: none;
}

.site-header__navigation-submenu-section .site-header__navigation-submenu .site-header__navigation-submenu-item-link:hover {
	color: #1DA2BD;
}

.site-header__navigation-submenu-section .site-header__navigation-submenu {
	display: none;
	width: 170px;
	background-color: var(--menu-burger-color);
	top: 40px;
	left: 7px;
	/* NOTE: This must match the padding of .site-header__navigation-link */
	padding: 3px 10px 6px 10px;
	z-index: 100;
}

.site-header__navigation-submenu-section .site-header__navigation-submenu .site-header__navigation-submenu-item-link {
	width: 100%;
	color: var(--text-color);
	white-space: nowrap;
	display: inline-block;
	padding-top: 3px;
	border: 0 none;
	transition: none;
	-o-transition: none;
	-moz-transition: none;
	-webkit-transition: none;
}

.site-header__navigation-submenu-section .site-header__navigation-submenu .site-header__navigation-submenu-item-link .site-header__navigation-submenu-item-link-text {
	display: inline-block;
	font-size: 16px;
}

.site-header__navigation-submenu-section.open .site-header__navigation-submenu {
	display: block;
}

/* Top navigation mobile styles */
@media (max-width: 1023px) {
	.site-header__navigation-collapsible--collapse {
		height: 0;
		overflow-y: hidden;
	}

	.site-header__navigation-submenu-section .site-header__navigation-submenu {
		padding: 0 1rem 0.5rem 1.5rem;
		display: block;
		top: 30px !important;
		left: 0 !important;
	}

	.site-header__navigation-item,
	.site-header__navigation-submenu-section .site-header__navigation-submenu .site-header__navigation-submenu-item-link .site-header__navigation-submenu-item-link-text {
		font-size: 18px;
	}

	.site-header {
		padding: 5px 12px;
	}

	.site-header-version {
		display: none;
	}

	.site-footer__navigation {
		flex-direction: column;
	}

	.site-footer__links {
		flex-wrap: wrap;
	}

	.site-footer__link-group {
		margin-bottom: 1rem;
	}
}

/* Top navigation desktop styles */
@media (min-width: 1024px) {
	.site-header {
		-webkit-box-shadow: 0 2px 4px 0 var(--box-shadow-color);
		-moz-box-shadow: 0 2px 4px 0 var(--box-shadow-color);
		box-shadow: 0 2px 4px 0 var(--box-shadow-color);
		z-index: 2;
	}

	.dark-mode {
		.site-header {
			-webkit-box-shadow: none;
			-moz-box-shadow: none;
			box-shadow: none;
			z-index: 2;
		}
	}

	/*
      Pushes the section headings to just below the top nav bar when a user
      navigates directly to section anchors.
     */
	#content h2[id],
	#content h3[id],
	#content h4[id],
	#content h5[id] {
		padding-top: 60px;
	}

	#content h2[id] {
		/* Little extra room above h2s */
		margin-top: -1em;
	}

	#content h3[id],
	#content h4[id],
	#content h5[id] {
		margin-top: -60px;
	}

	.site-header__navigation {
		flex-direction: row;
	}

	.site-header__navigation-button {
		display: none;
	}

	.site-header__navigation-items {
		flex-direction: row;
		align-items: center;
		float: right;
		width: auto;
		padding-top: 0;
	}

	.site-header__navigation-item {
		width: auto;
	}

	.site-header__navigation-item .site-header__navigation-link {
		padding: 15px 18px;
	}

	.site-header__navigation-item:last-of-type .site-header__navigation-link {
		padding-right: 0;
	}

	.site-header__navigation-link--button {
		padding: 6px 12px;
	}

	.site-header__navigation-collapsible {
		height: auto;
	}

	.site-header__navigation-submenu-section .site-header__navigation-submenu {
		position: absolute;
		border: 1px solid #9a9a9a;
		border-radius: 3px;
	}

	.site-header__navigation-submenu-section:hover .site-header__navigation-submenu {
		display: block;
	}

	/*
      Pushes the section headings to just below the top nav bar when a user
      navigates directly to section anchors. It doesn't work if you try
      to apply the padding and margin to the `h` elements directly.
     */
	.chapter a[name],
	.chapter .anchor {
		padding-top: 60px;
		margin-top: -60px;
		text-decoration: none;
		border: none;
		display: inline-block;
	}
}

/* Side Navigation styles */
/* Docs Navigation */
.docs-navigation {
	border-right: 1px solid #e7e7e9;
}

.docs-navigation .search-container {
	display: none;
	margin-bottom: 1rem;
}

.docs-navigation a {
	color: var(--text-color);
	display: block;
	font-size: .95rem;
	position: relative;
}

.docs-navigation a:focus {
	outline: none;
}

.docs-navigation a:hover {
	color: #35c1e4;
	text-decoration: none;
}

.docs-navigation a code {
	color: var(--text-color);
	overflow-wrap: break-word;
	padding: 0;
	word-break: break-all;
}

.docs-navigation a.active {
	color: #06A0CE;
	outline: 0;
	border: none;
	-moz-outline-style: none;
}

.docs-navigation a.active:hover {
	color: #35c1e4;
	text-decoration: underline;
}

.docs-navigation ul {
	list-style-type: none;
	margin: 0;
	padding: 0;
}

.docs-navigation li>ul>li a {
	font-size: 14px;
	color: #7d7d7d;
}

.docs-navigation ul:last-of-type {
	margin-bottom: 0;
}

.docs-navigation li {
	margin-top: 0.3334em;
	line-height: 1.3334;
}

.docs-navigation li:last-of-type {
	margin-bottom: 0;
}

.docs-navigation .nav-dropdown:before {
	content: '\2023';
	font-size: 28px;
	position: absolute;
	margin-left: -14px;
	margin-top: -8px;
}

.docs-navigation .nav-dropdown.expanded:before {
	transform: rotate(90deg);
}

.docs-navigation>ul ul,
.docs-navigation>ul ul ul {
	display: none;
	height: 0;
	margin-left: 1rem;
}

.docs-navigation>ul ul:target,
.docs-navigation>ul ul:target ul,
.docs-navigation>ul .nav-dropdown.expanded~ul {
	display: block;
	height: auto;
}

.docs-navigation h3 {
	font-size: .95rem;
	font-weight: 600;
	line-height: 1.5;
	margin: 1.5em 0 0;
}

.docs-navigation .docs-home-link {
	position: relative;
}

@media screen and (min-width: 45rem) {
	.main-content {
		display: flex;
	}
}

/* User guide navigation appears for desktops */
@media screen and (min-width: 64rem) {
	.docs-navigation {
		flex: 0 0 auto;
		width: 13.75rem;
	}

	.main-content>.appendix,
	.main-content>.book,
	.main-content>.chapter {
		flex: 0 0 auto;
		margin: 0 auto;
	}
}

/**
 * For mobile devices, we show navigation at bottom of page.
 *
 * This is the simplest solution to this issue.
 */
@media not screen and (min-width: 64rem) {
	/* Repeat the class twice to prioritize our mobile classes! */

	.content.content {
		/* Make the height equal to
           the real height of content */
		overflow: visible;
	}

	.main-content {
		/* Main content show first */
		flex-direction: column-reverse;
	}

	.docs-navigation.docs-navigation {
		/* Fill the main container */
		width: 100%;

		/* Don't clip the navigation container */
		overflow: visible;
	}
}

/* Userguide Meta */
.chapter-meta {
	float: right;
	text-align: right;
}

.chapter-meta .edit-link {
	color: #999;
	font-size: 0.9em;
	padding-right: 3px;
}

.chapter-meta .edit-link svg {
	margin-right: 1px;
}

/* Clever use of RTL to fill in all stars to left of hover position */
.rating {
	direction: rtl;
}

.rating>.star {
	cursor: pointer;
	display: table-cell;
	padding: 3px;
}

.rating>.star:hover>svg>g,
.rating>.star:hover~.star>svg>g,
.rating>.star.selected>svg>g,
.rating>.star.selected~.star>svg>g {
	fill: #999;
}

/* Footer styles */
.site-footer {}

.site-footer__navigation {
	display: flex;
	padding: 30px 12px;
	max-width: 62.5rem;
	margin: 0 auto;
	padding-left: 5rem;
}

@media not screen and (min-width: 64rem) {
	.site-footer__navigation {
		/* same to nav.docs-navigation for mobiles */
		padding: 20px 20px 20px 26px;
	}
}

.site-footer__links {
	display: flex;
	flex: 1 1 auto;
}

.site-footer__links .site-footer__links-list {
	list-style-type: none;
	margin: 0;
}

.site-footer__links .site-footer__links-list a {
	color: #ddd;
}

.site-footer__link-group {
	flex: 1 1 auto;
	flex-basis: 175px;
}

.site-footer__link-group header {
	color: var(--footer-text-color);
}

.site-footer__subscribe-newsletter .newsletter-form__header h5 {
	color: var(--footer-text-color);
	margin-top: 0;
}

.site-footer__subscribe-newsletter p {
	font-size: 0.875rem;
	margin: 2px 0 0 2px;
	opacity: 0.7;
}

.site-footer__subscribe-newsletter .disclaimer {
	color: #ddd;
	font-size: 0.75rem;
	opacity: 0.55;
}

.site-footer__subscribe-newsletter .newsletter-form {
	padding-top: 6px;
	display: flex;
	justify-content: flex-start;
}

.site-footer__subscribe-newsletter .email,
.site-footer__subscribe-newsletter .submit {
	height: 40px;
}

.site-footer__subscribe-newsletter .email {
	line-height: 40px;
	width: 250px;
	color: #1DA2BD;
	font-size: 16px;
	padding-left: 20px;
	border-top-left-radius: 4px;
	border-bottom-left-radius: 4px;
	border-style: none;
}

.site-footer__subscribe-newsletter .submit {
	font-family: inherit;
	font-size: inherit;
	line-height: inherit;
	width: 100px;
	background-color: #1BA8CB;
	color: var(--white-color);
	font-weight: 500;
	border-top-right-radius: 4px;
	border-bottom-right-radius: 4px;
	border-style: none;
	cursor: pointer;
	transition: all .3s ease;
}

/* Secondary footer (below) */
.site-footer-secondary {
	background-color: var(--footer-white-color);
	border-top: 1px solid #e7e7e9;
	width: 100%;
	z-index: 1;
}

.dark-mode {
	.site-footer-secondary {
		background-color: var(--footer-white-color);
		border-top: none;
		width: 100%;
		z-index: 1;
	}
}

.site-footer-secondary__contents {
	display: flex;
	align-items: center;
	justify-content: space-between;
	max-width: 75rem;
	margin-left: auto;
	margin-right: auto;
	font-size: 0.875rem;
	padding: 0.5rem 0.75rem;
}

/*
 * 1. Value is the largest computed width among 'site-footer__copy' and 'site-footer__links'.
 */
.site-footer__copy,
.site-footer__secondary-links {
	flex-grow: 0;
	flex-basis: 280px;
	/* 1. */
}

/*
 * 1. 'flex-shrink: 1' is applied to the element with the smallest computed width among
 *    'site-footer__copy' and 'site-footer__links'.
 */
.site-footer__copy {
	flex-shrink: 1;
	/* 1. */
}

.site-footer__logo {
	flex: 0 0 auto;
	margin-right: 10px;
	margin-left: 10px;
}

.site-footer__logo svg {
	width: 35px;
	height: 35px;
}

/*
 * 1. 'flex-shrink: 0' is applied to the element with the largest computed width among
 *    'site-footer__copy' and 'site-footer__links'.
 */
.site-footer__secondary-links {
	flex-shrink: 0;
	/* 1 */
	text-align: right;
	white-space: nowrap;
}

.site-footer-secondary a {
	color: #999;
}

.site-footer-secondary__links a:not(:last-child) {
	padding-right: 10px;
}

.site-footer-secondary__links a:not(:first-child) {
	padding-left: 10px;
}

@media all and (max-width: 29.99rem) {

	.site-footer__rights,
	.site-footer-secondary__links {
		display: none;
	}

	.site-footer__logo {
		order: 1;
		text-align: left;
	}

	.site-footer__copy {
		order: 2;
		text-align: right;
	}
}

/* Avoid the footer taking up much of the screen on short displays */
@media all and (max-height: 56.25rem) {
	.site-footer__navigation {
		margin: 1.5rem auto 0 auto;
		padding-top: 0;
		padding-bottom: 0;
	}
}

@media screen and (min-width: 84.375rem) {
	.ui-logos .ui-logo {
		box-shadow: 0 6px 15px 1px rgba(0, 0, 0, 0.56);
	}
}

/* User Manual Home */
.technology-logos,
.ui-logos {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	justify-content: space-around;
}

.technology-logo,
.ui-logo {
	flex: 0 1 auto;
}

.ui-logo {
	width: 224px;
	height: 135px;
	margin: 12px;
}

/* Samples download button */
.download {
	display: flex;
}

.download a {
	border-style: solid;
	border-width: 1px;
	text-decoration: none;
	padding: 5px;
	display: block;
	width: 10em;
	margin: 5px;
}

.download ul {
	list-style: none;
	list-style-type: none;
}

.download li {
	float: right;
}

.docs-navigation {
	width: 18rem;
	padding: 20px 20px 20px 26px;
	background: var(--nav-color);
	overflow-y: scroll;
	overflow-x: auto;
}

.layout {
	display: flex;
	flex-direction: column;
	overflow: hidden;
	height: 100vh;
}

.main-content {
	overflow-y: auto;
	overflow-x: auto;
	display: flex;
}

.content {
	flex: 1 1 auto;
	overflow: auto;
	padding-left: 0;
	padding-right: 0;
}

.content .chapter {
	padding: 2rem 2.4rem;
}

#toc a:active {
	font-weight: 500;
}

.site-header {
	margin-bottom: 1rem;
}

.site-header__navigation-submenu-item {
	padding: 2px 0;
}

.site-footer {
	background-color: var(--footer-color);
	padding: 20px 0 40px 0;
}

#header {
	margin-left: 0;
}

#header>h1:first-child {
	margin-bottom: 40px;
}

@media screen and (min-width: 64rem) {
	#header {
		margin-bottom: 20px;
	}

	.site-header {
		margin-bottom: 0;
		z-index: 2;
	}

	.site-header__navigation-header {
		margin-top: -7px;
	}

	.site-header__navigation-submenu-section:after {
		content: '\2023';
		font-size: 28px;
		position: absolute;
		transform: rotate(90deg);
		margin-right: 10px;
		top: 5px;
		right: -7px;
	}

	.site-footer__navigation {
		flex-wrap: wrap;
	}

	.site-footer__link-group {
		flex: 1 1 auto;
	}

	.site-footer__links {
		margin-bottom: 1rem;

	}
}

@media screen and (min-width: 75rem) {
	.content .chapter {
		box-sizing: content-box;
	}

	#content {
		padding-right: 260px;
		margin: 0;
	}

	/* #toc here must be referenced as #header #toc
            since we don't want to change single page #toc */
	#header #toc {
		position: fixed;
		margin: 0 auto;
		padding-bottom: 0;
		right: 0;
		top: 65px;
		width: 260px;
		z-index: 1;
		overflow: auto;
		border-radius: 0 0 5px 0;
		max-height: calc(100% - 118px);
		margin-right: 15px;
	}

	#header #toctitle {
		margin-top: 1.3em;
	}

	#header #toc>ul {
		/* margin-left have to increase if you change border thickness of active toc item */
		margin-left: 1px;
		border-left: 1px solid #666;
		margin-bottom: 0;
		padding-right: 10px;
		padding-bottom: 0.5rem;
		background-color: var(--white-color);
	}

	#header #toc>ul>li,
	#toc>ul>li:last-of-type {
		padding: 0.5rem 0;
		margin: 0;
	}

	#header #toc a {
		padding-left: 10px;
		font-weight: 400;
		color: var(--text-color);
		font-size: .95rem;
		display: inline-block;
	}

	#header #toc a.active {
		font-weight: 500;
		border-left: 3px solid #01303a;
		margin-left: -2px;
		padding-left: 9px;
	}

	.site-footer__navigation {
		flex-wrap: wrap;
		margin-left: auto;
		padding-left: 3rem;
	}

	.site-footer__link-group {
		flex: 0.15 1 auto;
	}

	.site-footer__subscribe-newsletter {
		/* A fix so subscribe disclaimer does not go under long ToC */
		max-width: calc(100% - 17rem);
	}
}

@media screen and (min-width: 80rem) {
	.site-footer__subscribe-newsletter {
		max-height: none;
	}
}

@media screen and (min-width: 100rem) {
	.content .chapter {
		max-width: 60.5rem;
	}

	#header {
		margin: 0 auto;
	}

	#content {
		padding-right: 0;
		margin: 0 auto;
	}

	#header #toc {
		right: initial;
		margin-left: 62.5rem;
	}

	.site-footer__navigation {
		padding-left: 0;
	}

	.site-footer__link-group {
		flex: 0.2 1 auto;
	}
}

@media screen and (min-width: 112rem) {
	.content .chapter {
		max-width: 62.5rem;
		margin: 0 auto;
		padding-right: 3.5rem;
		position: relative;
		left: -130px;
	}

	#header #toc {
		right: initial;
		margin-left: 64.5rem;
	}

	.site-footer__link-group {
		flex: 0.2 1 auto;
	}
}


@supports (-moz-appearance:meterbar) and (background-blend-mode:difference, normal) {

	/* Firefox only */
	.site-header__navigation-submenu-section:after {
		top: 2px;
		right: -4px;
	}
}

/* Added dark mode and other items for outdated Prettify.css */
code[data-lang="text"] .pln,
code[data-lang="text"] .str,
code[data-lang="text"] .kwd,
code[data-lang="text"] .com,
code[data-lang="text"] .typ,
code[data-lang="text"] .lit,
code[data-lang="text"] .pun,
code[data-lang="text"] .opn,
code[data-lang="text"] .clo,
code[data-lang="text"] .tag,
code[data-lang="text"] .atn,
code[data-lang="text"] .atv,
code[data-lang="text"] .dec,
code[data-lang="text"] .var,
code[data-lang="text"] .fun {
	color: #000;
}

.dark-mode {

	code[data-lang="text"] .pln,
	code[data-lang="text"] .str,
	code[data-lang="text"] .kwd,
	code[data-lang="text"] .com,
	code[data-lang="text"] .typ,
	code[data-lang="text"] .lit,
	code[data-lang="text"] .pun,
	code[data-lang="text"] .opn,
	code[data-lang="text"] .clo,
	code[data-lang="text"] .tag,
	code[data-lang="text"] .atn,
	code[data-lang="text"] .atv,
	code[data-lang="text"] .dec,
	code[data-lang="text"] .var,
	code[data-lang="text"] .fun {
		color: #fff !important;
	}
}

.dark-mode {
    .com       { color: #909090 !important; }
    .str, .tag { color: #90a959 !important; }
    .kwd, .atv { color: #d28445 !important; }
    .typ       { color: #f4bf75 !important; }
    .lit, .atn { color: #6a9fb5 !important; }
    .pun, .pln,
    .opn, .clo { color: #d0d0d0 !important; }
    .dec, .var { color: #aa759f !important; }
}

.dark-mode {
	li.L1,
	li.L3,
	li.L5,
	li.L7,
	li.L9 {
		background: #111 !important;
	}
}

/* DPE University button*/
/* CSS */
.badge-wrapper {
    padding-top: 0px;
    padding-bottom: 20px;
    a {
        text-decoration: none;
    }
    a:link {
        text-decoration: none;
    }
    a:visited {
        text-decoration: none;
    }
    a:hover {
        text-decoration: none;
    }
    a:active {
        text-decoration: none;
    }
}
.badge {
    background-color: var(--black-color);
    height: 24px;
    border-radius: 12px;
    border-color: var(--black-color);
    border-style: solid;
    border-width: 1px;
    padding: 5px;
    a {
        color: var(--gradle-blue);
    }
}
.badge-type {
    border-radius: 8px;
    margin-right: 10px;
    padding-left: 10px;
    padding-right: 10px;
}
.badge-text {
    color: var(--white-color);
}
.button--blue {
  color: white;
  border-color: transparent;
  &:hover {
    color: white;
  }
}
.button--blue {
  background: var(--gradle-blue);
  background: linear-gradient(var(--button-gradient-angle), var(--gradle-blue) 0%, var(--gradle-blue-lite) 100%);
  &:hover {
    background: var(--gradle-blue-lite);
  }
}

/* Custom Download button*/
/* CSS */
.button-9 {
	appearance: button;
	backface-visibility: hidden;
	background-color: #209BC4;
	border-radius: 6px;
	border-width: 0;
	box-shadow: rgba(50, 50, 93, .1) 0 0 0 1px inset, rgba(50, 50, 93, .1) 0 2px 5px 0, rgba(0, 0, 0, .07) 0 1px 1px 0;
	box-sizing: border-box;
	color: #fff;
	cursor: pointer;
	font-family: -apple-system, system-ui, "Segoe UI", Roboto, "Helvetica Neue", Ubuntu, sans-serif;
	font-size: 100%;
	height: 44px;
	line-height: 1.15;
	margin: 12px 12px 12px 0px;
	outline: none;
	overflow: hidden;
	padding: 0 25px;
	position: relative;
	text-align: center;
	text-transform: none;
	transform: translateZ(0);
	transition: all .2s, box-shadow .08s ease-in;
	user-select: none;
	-webkit-user-select: none;
	touch-action: manipulation;
	width: 25%;
}

.button-9:disabled {
	cursor: default;
}

.button-9:focus {
	box-shadow: rgba(50, 50, 93, .1) 0 0 0 1px inset, rgba(50, 50, 93, .2) 0 6px 15px 0, rgba(0, 0, 0, .1) 0 2px 2px 0, rgba(50, 151, 211, .3) 0 0 0 4px;
}

.button-9-sect {
	padding-bottom: 1.25em;
}

/* Theme toggle switch button */
/* Switch */
.switch {
	position: relative;
	display: inline-block;
	width: 60px;
	height: 34px;
	align-self: center;
}

.switch input {
	opacity: 0;
	width: 0;
	height: 0;
}

.slider {
	position: absolute;
	cursor: pointer;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background-color: #ccc;
	-webkit-transition: 0.4s;
	transition: 0.4s;
}

.slider:before {
	position: absolute;
	content: "";
	height: 26px;
	width: 26px;
	left: 4px;
	bottom: 4px;
	background-color: white;
	-webkit-transition: 0.4s;
	transition: 0.4s;
}

input:checked+.slider {
	background-color: #2196f3;
}

input:checked+.slider:before {
	-webkit-transform: translateX(26px);
	-ms-transform: translateX(26px);
	transform: translateX(26px);
}

/* Rounded sliders */
.slider {
	border-radius: 30px;
}

.slider:before {
	border-radius: 50%;
}

</style>
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<meta name="adoc-src-path" content="userguide_single.adoc">
<link crossorigin href="//assets.gradle.com" rel="preconnect">
<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet"/>

<meta name="twitter:site" content="@gradle">
<meta name="twitter:creator" content="@gradle">
<meta name="twitter:image" content="https://gradle.org/images/gradle-256x256.png">
<meta name="twitter:url" content="https://docs.gradle.org/8.9/userguide/userguide_single.html">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<meta name="twitter:description" content="Single-page Gradle User Manual for Gradle 8.9">
<meta name="twitter:title" content="Gradle User Manual: Version 8.9">

<style type="text/css">.multi-language-selector .language-option[data-lang='groovy'],
.exampleblock[data-lang=groovy] > .content .title {
    background-image: url('data:image/svg+xml;base64,PHN2Zw0KICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIg0KICAgd2lkdGg9IjYxNC4wNjA4NSINCiAgIGhlaWdodD0iMzAzLjU5ODYiDQogICB2ZXJzaW9uPSIxLjEiPg0KICA8Zw0KICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMzUuMzk2NTk5LC0zMC41NTgxOTYpIj4NCiAgICA8cGF0aA0KICAgICAgIGQ9Im0gMTU0Ljk3Njg3LDMzMi42OTE2MiBjIDAsLTAuODA1ODcgMTAuODMxMjMsLTE4LjYyMTcyIDI0LjA2OTQsLTM5LjU5MDc2IDEzLjIzODE5LC0yMC45NjkwNSAyMi42NjA1NywtMzguNjIwNjYgMjAuOTM4NjcsLTM5LjIyNTc3IC0xLjcyMTkxLC0wLjYwNTEgLTcuNjc5OTIsMC40ODU2NyAtMTMuMjQwMDIsMi40MjM5MyAtMTYuNzQ1MjQsNS44Mzc0MyAtMjAuMTg2MDUsNC4yOTAxNiAtMzIuNjkzMDgsLTE0LjcwMTU1IC0xMy41MzI2NSwtMjAuNTQ5MDYgLTE0LjAxNzI0LC0yMi42Njk4MyAtNi45NjE1OCwtMzAuNDY2MjQgNC42MDg3NiwtNS4wOTI1NiA0LjMzMTU5LC02LjI3OTY3IC0zLjIzMTksLTEzLjg0MzE2IC00LjU1MDA5LC00LjU1MDEgLTguMjcyODksLTkuNjQzMDkgLTguMjcyODksLTExLjMxNzc2IDAsLTIuODE2NzkgLTMwLjk5MTQ1LC0xNS41ODkzMyAtNzkuOTg5NDk2LC0zMi45NjYxNSAtMTEuMTA5NjYsLTMuOTM5OTcgLTIwLjE5OTM3NSwtNy44MjkyOCAtMjAuMTk5Mzc1LC04LjY0MjkxIDAsLTAuODEzNjYgMjMuNDcwNzM4LC0xLjAwNDc2IDUyLjE1NzE5MSwtMC40MjQ2OSBsIDUyLjE1NzIxLDEuMDU0NjYgNS4wOTEyNywtOC4wMzAwMSBjIDIxLjUxNjQ0LC0zMy45MzU5MiA1NC4wMDk1MiwtNjQuNTg4MjEyIDY4LjQ2NzA1LC02NC41ODgyMTIgMy4wMTA2LDAgOS4xMjE0MSwyLjg2OTE4IDEzLjU3OTUzLDYuMzc1OTQ1IDcuMjU5NDYsNS43MTAyODMgOC4yNTY1LDkuMjQ4NjMyIDkuNTQ5OTQsMzMuODkxOTY3IDAuNzk0MywxNS4xMzM4MiAyLjQyNDIyLDI4LjQ5NjAxIDMuNjIxOTgsMjkuNjkzNzkgMS4xOTc3NSwxLjE5Nzc2IDQuOTk3NjksLTAuMzc0MjUgOC40NDQzMSwtMy40OTMzOSA0LjQwMTQsLTMuOTgzMjMgOS4wMzQ4NCwtNS4wNjMxMyAxNS41Njc2MSwtMy42MjgzIDYuNzY3NTYsMS40ODY0MSAxMC42MjcxLDAuNDY4OTUgMTQuMTY5MzgsLTMuNzM1NDMgNS4zMTM2LC02LjMwNjY2IDMxLjkwNTk2LC00OC45MzcyMDEgMzEuOTA1OTYsLTUxLjE0ODc0NCAwLC0wLjc1MTU4OCA1LjI2NTA5LC05Ljc1NzMwNiAxMS43MDAyMywtMjAuMDEyNzAzIDYuNDM1MDksLTEwLjI1NTM5NyAxMy44NDY2NCwtMjIuMDgwNjMxIDE2LjQ3MDA3LC0yNi4yNzgyODMgNC42NjU1OCwtNy40NjUyMDEgNS4zOTY2LC02LjU4MTczNSAzMy40MjY5Miw0MC4zOTg3MzYgMjguOTQxMjEsNDguNTA3MTY0IDQ0LjUxNzY3LDY2LjQwNjU1NCA1Mi4zMTU3LDYwLjExNzYzNCA1LjQ0MiwtNC4zODg4OSAzNC4wMDA1NSwtNC42Mzc5NCA0MS45ODI0NiwtMC4zNjYxNCA0LjUzNjY1LDIuNDI3OTMgNy40MTkxNiwyLjM5NjEgOS45MjQ4NCwtMC4xMDk2MiA1LjIwMDA3LC01LjIwMDA2IDE3LjY0OTgyLC00LjI5NDM3IDIwLjkwNDEyLDEuNTIwNzggMi41NjM5Myw0LjU4MTQ2IDMuMjE3ODQsNC41ODE0NiA3LjAyMDE0LDAgMi4zMDYwNiwtMi43Nzg2NyA5LjEzNjE5LC01LjA1MjA4IDE1LjE3ODAzLC01LjA1MjA4IDguNTM4ODQsMCAxMS43OTMzNiwxLjc3MzY3IDE0LjYxNDAzLDcuOTY0MzcgbCAzLjYyODgxLDcuOTY0MzYgNTYuMDkyMDMsLTEuOTg1OCBjIDMwLjg1MDYyLC0xLjA5MjIyIDU2LjA5MjA0LC0xLjI4Njg4IDU2LjA5MjA0LC0wLjQzMjU1IDAsMC44NTQyNyAtMjIuOTA2MDgsMTAuMDcxOTUgLTUwLjkwMjQxLDIwLjQ4MzcxIC0yNy45OTYzMiwxMC40MTE3MiAtNTEuMzY3LDE5LjI0MzA1IC01MS45MzQ4NCwxOS42MjUxMiAtMC41Njc4NSwwLjM4MjA3IDAuNjk4NDcsOS40OTI3MyAyLjgxNDA1LDIwLjI0NTg4IDUuNTA0NTcsMjcuOTc5MTcgMS45MTQ1OCw0Ni42MjU4OSAtMTEuOTI2MjksNjEuOTQ2MDQgLTYuMjA5LDYuODcyNjMgLTE2LjI4MzM4LDE0LjE0Mzk1IC0yMi4zODc1MywxNi4xNTg0OSAtNi4xMDQxNSwyLjAxNDU0IC0xMS4wOTg0NCw0LjM4NjE0IC0xMS4wOTg0NCw1LjI3MDE5IDAsMC44ODQwNiA2LjUxNTI1LDExLjY3ODkzIDE0LjQ3ODM1LDIzLjk4ODU5IDcuOTYzMDksMTIuMzA5NjkgMTMuMjgyOCwyMi4zODEyNSAxMS44MjE1MiwyMi4zODEyNSAtMi4zODUwNCwwIC02MC40Njk4NywtMjIuNDQyMzggLTE1MC43ODg5OCwtNTguMjYwNyAtMTcuODA5LC03LjA2MjU4IC0zNC4wMjY4MywtMTIuODQxMDkgLTM2LjAzOTYxLC0xMi44NDEwOSAtMy43NTM2MywwIC0zNi4xNjY5LDEyLjI4NjYyIC0xMzEuMjI0MjMsNDkuNzQyMDYgLTU1LjEyNTI1LDIxLjcyMTAzIC01Ny4yOTIxNywyMi40NzM0OCAtNTcuMjkyMTcsMTkuODk0NTEgeiBtIDExMy4xMTY0OCwtNTEuMjUyNjUgYyAyOS4zMjk0OSwtMTEuMzk1MDYgNTguNDE2NTcsLTIyLjUzMDggNjQuNjM3OTgsLTI0Ljc0NjA3IDEwLjcwMDY4LC0zLjgxMDE5IDE0LjI3OTE4LC0yLjg1NDkzIDY2LjI1Mzk0LDE3LjY4NjM0IDMwLjIxODI1LDExLjk0Mjc0IDYwLjAzMjUyLDIzLjU3NTg3IDY2LjI1MzkyLDI1Ljg1MTM0IDYuMjIxNDEsMi4yNzU1MiAxOS4wNDMxNyw3LjIyMDU5IDI4LjQ5Mjc1LDEwLjk4OTA4IDEwLjc3NTAzLDQuMjk3MDQgMTYuMjgyNTEsNS4zMzE2NiAxNC43NzEwOCwyLjc3NDg0IC0xNi44ODM3LC0yOC41NjExMyAtMTcuMzk5OCwtMjkuMDM3MTYgLTI5LjEwMDgzLC0yNi44NDIwNSAtMTQuMTEzNjEsMi42NDc3MiAtMjIuODc4OTcsLTAuMDY4NSAtMjcuMzgzNjksLTguNDg1NTQgLTIuOTIxMTIsLTUuNDU4MTYgLTIuMDI5NDQsLTguMTI3NTkgNS4yNTQ0MiwtMTUuNzMwMzEgMTAuODQ4ODcsLTExLjMyMzc3IDkuMTQ0NTcsLTIxLjc0MTQ0IC00Ljg0NDI5LC0yOS42MTA5OSAtNS4zNjc2NCwtMy4wMTk1OSAtMTIuMTQwNTksLTEwLjQ4MzcyIC0xNS4wNTEwMiwtMTYuNTg2OTcgbCAtNS4yOTE2OSwtMTEuMDk2ODIgLTExLjM0NTUxLDcuNjk5MjggYyAtMTMuOTQ0NTgsOS40NjMwNCAtMzAuOTUwNjIsOS45NTA2MyAtNDUuMTQ3NjQsMS4yOTQ0OCBsIC0xMC40NjQ4OCwtNi4zODA2NSAtMTIuMTU4NDEsOC4yNjI4NCBjIC0xMi4xNzQ2Miw4LjI3Mzg2IC0yNi4xOTEwOCw5LjM0MjggLTQwLjQzNzUyLDMuMDgzOTIgLTMuOTI0OTgsLTEuNzI0MzkgLTUuNjU1ODMsLTEuMDU0MTUgLTUuNjU1ODMsMi4xOTAwOCAwLDIuNTcxMTggLTMuNzA0MjksNi4zNjI2NSAtOC4yMzE4MSw4LjQyNTUzIC0xMy41NzQyLDYuMTg0NzkgLTI2LjgyMTA3LDQuNTQyNDcgLTM1LjgwMjI5LC00LjQzODc1IGwgLTguMTg5NDQsLTguMTg5NDQgLTYuNjA5ODIsOC40MDMwMyBjIC0zLjYzNTM5LDQuNjIxNjYgLTEyLjA0OTUyLDExLjgzNjk4IC0xOC42OTgwNSwxNi4wMzM5OCAtOC4yMjk2NSw1LjE5NTE4IC0xOC40MTc0MSwxNy44NzE4MiAtMzEuOTE2NCwzOS43MTM2MSAtMTAuOTA1NDksMTcuNjQ1NDYgLTE5LjgyODE2LDMyLjk4MDQyIC0xOS44MjgxNiwzNC4wNzc3NiAwLDEuMDk3MyA4LjM2MjU1LC0xLjUyNzM2IDE4LjU4MzQyLC01LjgzMjU5IDEwLjIyMDg5LC00LjMwNTIxIDQyLjU4MDI4LC0xNy4xNTA4NyA3MS45MDk3NywtMjguNTQ1OTMgeiBtIDI0OC43NjcyOSwtMTIuMjU4NDYgYyAyMi4yNTU1NywtMTIuNTA4MzMgMjcuNDE0MjQsLTM1LjY0ODA4IDE3LjU3Njg1LC03OC44NDMxOCAtOC4yMjE0LC0zNi4wOTk2MSAtMTIuMzI1NSwtNDcuOTEzMjcgLTE3LjE5NDk0LC00OS40OTU5NyAtMy4zNjkwMiwtMS4wOTUwMyAtMy44ODY3NCwwLjEwNjk5IC0xLjk4ODU4LDQuNjE2MzUgMTIuMzE1MTYsMjkuMjU3NzEgMTIuOTk5NjMsNDMuOTQ2NjIgMi4yNDAyMiw0OC4wNzU0MSAtNy4zOTE1MSwyLjgzNjQyIC0xNS4yMzIzOSwtNy43OTA3NSAtMjEuMzk5MDIsLTI5LjAwMzI2IC00Ljc3NTEyLC0xNi40MjU4NyAtOS43Njg2MSwtMjMuODI4MzcgLTEzLjUzMzg3LC0yMC4wNjMxMSAtMC45MDE1NywwLjkwMTYgMC42Nzg0OCw2LjEyMTE3IDMuNTExMjQsMTEuNTk5MTMgMi44MzI3Myw1LjQ3NzkgNi43MTcyMSwyMS45NzQ1NSA4LjYzMjE3LDM2LjY1OTIgMS45MTQ5NywxNC42ODQ2MiA1LjYxMzg1LDMwLjA2MDczIDguMjE5NzMsMzQuMTY5MTIgNi43NzE5OCwxMC42NzY2MSAxNy41NTEyOCw4LjEwMzYgMjQuNTIzODIsLTUuODUzODQgNi44OTM3MywtMTMuNzk5NzUgNy42NzI4NCwtNC42MDc4MSAwLjk2OTMsMTEuNDM2MDIgLTYuOTYwNzQsMTYuNjU5MzcgLTI3LjYzNDQyLDIxLjY1NDgxIC01MS41ODQxOCwxMi40NjQ0MiAtMy44MzMzLC0xLjQ3MDk2IC01LjEzMDM5LDAuMDUxNSAtNS4xMzAzOSw2LjAyMDk3IDAsNC4zOTQzMSAtMi45MzYxOCwxMS43MjI0NSAtNi41MjQ4OCwxNi4yODQ3IGwgLTYuNTI0ODgsOC4yOTUwNiA4Ljk0ODgxLDEuNTExMjMgYyAxNS40NDk0NSwyLjYwOTA5IDM2LjYzMzI4LC0wLjc3NjQyIDQ5LjI1ODYsLTcuODcyMjUgeiBtIC0zMjAuMzY2NSwtMjcuNTM3MzMgYyA0Ni40NTk2NSwtMTMuMzU0NSA1NC43NjE4OCwtMjguOTMwOTMgMzkuMzI4ODUsLTczLjc4NzgyIC0zLjU4MTg1LC0xMC40MTA3OSAtNi41MTI0MywtMjEuNjA5NzEgLTYuNTEyNDMsLTI0Ljg4NjU0IDAsLTExLjE1NzEyIC01LjYxMTUyLC02LjAwMTYxIC05LjgxNzEzLDkuMDE5NDMgLTUuNTYyMDMsMTkuODY1NjEgLTIyLjI5MTE1LDM2Ljc1MDUzIC0zNi4zNDUxNiwzNi42ODM2NCAtMTIuMjA1NDcsLTAuMDU4MiAtMTYuMTgyNTEsLTIuMjgwMDggLTIxLjIyMzc4LC0xMS44NTc2OCAtOS4wNDc0OCwtMTcuMTg4ODIgMC44MTQ2OSwtNDMuNTY3OTcgMjUuOTY5NTQsLTY5LjQ2MjcyIDE4LjQyNDMxLC0xOC45NjYzMDQgMjguNDg4OTMsLTIwLjY4Mzk2NSAyOC40ODg5MywtNC44NjIwNSAwLDI0LjY3MzIgLTE3LjAxMTM0LDYwLjk5NDcgLTI1Ljk3MzA5LDU1LjQ1NjA0IC00LjM4MjA1LC0yLjcwODI2IC0zLjY3MTM4LC0xNC42Njc1MiAxLjQxNzIyLC0yMy44NTAwOSA0LjMyNzM1LC03LjgwODgyIDMuNDQ4MTQsLTE5LjcwNzcxIC0xLjQ1NjIsLTE5LjcwNzcxIC01LjY4Njg5LDAgLTE2Ljk0NTQ3LDIwLjcxMTk2IC0xOC40MzMxOCwzMy45MTA3NCAtMS4zMTUxNSwxMS42NjgyNiAtMC40OTI4NiwxNC41MDU0NSA1LjA2NjUyLDE3LjQ4MDcyIDE5LjQ4MjQ0LDEwLjQyNjcgNDUuMDA1MzEsLTIxLjM5NTQ1IDQ2LjI5MDgzLC01Ny43MTU4NCAwLjY3NTA0LC0xOS4wNzMxODEgLTMuMDE2NzYsLTI0LjQ0MTEwNSAtMTQuNzc5MDYsLTIxLjQ4ODk1MSAtMTcuMTE4NzksNC4yOTY1NDMgLTYzLjIzNDgzLDYzLjc4NjY0MSAtNjMuMjM0ODMsODEuNTczNDYxIDAsMTMuOTEyOCA2Ljk4NzM3LDIzLjY5NzI4IDE5LjI4ODI3LDI3LjAwOTYgMjAuOTE0MTksNS42MzE2MiA0MS4xMzUzOSwtNC4zNzM4OSA1NS40NjMzLC0yNy40NDMzOCBsIDYuMDIxNzUsLTkuNjk1NzEgMC4wMTMyLDEzLjE3MjIzIGMgMC4wMTYyLDE5LjA3MzggLTEyLjQyNjE5LDI5LjEyNzQgLTUxLjY5ODE3LDQxLjc2NzkzIC05Ljc3NjQ5LDMuMTQ2OCAtMTguMTgzMzIsNi4wNTQ0MSAtMTguNjgxOCw2LjQ2MTM3IC0xLjgyMDU2LDEuNDg2MzIgMTYuNjg3MzksMjcuNDc1NzEgMTkuNTY2NDQsMjcuNDc1NzEgMS42MzI2MiwwIDExLjE5MTE1LC0yLjM2MzU5IDIxLjI0MTIzLC01LjI1MjM4IHogTSA0NzYuNDExLDIxNy45NjMwMSBjIDQuNjYzNDcsLTUuMTUzMSA1LjQ4NTUxLC0xMC43NTEwMyA0LjQ4NTc5LC0zMC41NDgyMyAtMS4wODczOSwtMjEuNTMzMzEgLTIuMjc3NDYsLTI1LjMzODUxIC0xMC42NjE0MywtMzQuMDg5NDkgLTE1LjE0ODgyLC0xNS44MTE5NCAtMzMuODYxMjMsLTExLjc3ODI4IC0yMi45MDgxOSw0LjkzODE0IDUuODIyNTYsOC44ODYzNyAxMi45MjU0LDcuMzY4NjQgMTAuNDE2NDEsLTIuMjI1ODEgLTEuOTk4NjQsLTcuNjQyNzYgMS43Mjk5OCwtNy44NDM1OCA4LjIyODM5LC0wLjQ0MzIyIDEyLjE5MzAxLDEzLjg4NTM3IDkuMTE1MzQsMzMuMTI2OTggLTUuMjk4NiwzMy4xMjY5OCAtOS44NjcxNiwwIC0xMi45NDE5NSwtNC4yMzE3NiAtMTkuMzczNTMsLTI2LjY2MzE4IC0yLjkzMDU5LC0xMC4yMjA4NyAtNi40OTk2NCwtMTguNTgzNDMgLTcuOTMxMjcsLTE4LjU4MzQzIC00Ljc2ODk5LDAgLTYuODkyODcsNC4yMDg3OCAtMy45MjcyMSw3Ljc4MjQgMS42MTA4OCwxLjk0MTEgNi4wNzIxOCwxNS44OTEyNyA5LjkxNDA0LDMxLjAwMDQxIDkuNjY5MDMsMzguMDI1OTYgMjMuMTc2NjYsNTEuMDQxNDUgMzcuMDU1NiwzNS43MDU0MyB6IG0gLTE4My43NzEyNSwwLjYwMzk1IGMgMS45ODk3OCwtMS4zMzUgMi44OTk3NSwtNy42NDg5MyAyLjA3ODY1LC0xNC40MjMgLTEuMzI0NDksLTEwLjkyNzAyIC0yLjA2NjYyLC0xMS43MjQxIC03Ljk3MjcsLTguNTYzMjcgLTguNDg3MzMsNC41NDIyNyAtMTcuNjA4MzksLTQuMDYzNTEgLTIwLjcwMjIyLC0xOS41MzI2IC0yLjM0NzA3LC0xMS43MzUzOCAtMy4wNjUyNiwtMTEuNTA0ODkgMTQuMDI1NzYsLTQuNTAxNDkgMi4xNDI4OCwwLjg3ODA4IDcuNTk2NzEsLTIuMTA0MDIgMTIuMTE5NjMsLTYuNjI2OTQgOC4yNzQwOCwtOC4yNzQwOCAxMC45OTgwMiwtMTguMjEyOTkgNC45OTE1NiwtMTguMjEyOTkgLTEuNzc3NTQsMCAtMy4yMzE5LDEuNDU0MzYgLTMuMjMxOSwzLjIzMTkgMCw0LjY0OTIzIC04Ljg0MjMxLDMuOTg5ODIgLTEwLjgzNDY1LC0wLjgwNzk3IC0xLjE2MjI0LC0yLjc5ODc5IC0zLjYzODA3LC0xLjgwNTkxIC04LjA1OTE1LDMuMjMxOSAtMy41MDk4NSwzLjk5OTQ4IC03Ljc5NjczLDcuMjcxNzggLTkuNTI2NDEsNy4yNzE3OCAtMS43Mjk2OSwwIC00LjA2NTYsLTMuMjcyMyAtNS4xOTA4OCwtNy4yNzE3OCAtMS45NzE5NSwtNy4wMDg1NiAtMi4yMTM2NiwtNy4wNTI3NyAtNi42NzczNywtMS4yMjE2OSAtMy45MTA2LDUuMTA4NTQgLTMuOTQ1NTcsNi43MzU4MyAtMC4yMjQ2MSwxMC40NTY2MSAzLjk0MDYyLDMuOTQwNjQgMTEuNDI2MTUsMzAuODcxMDIgMTEuNDI2MTUsNDEuMTA3NDQgMCwxMi43Mjg2NyAxNy41MjkzMywyMi43MzgzMiAyNy43NzgzLDE1Ljg2MjEgeiBtIDU4Ljk0MzA5LC0xNi44NzUzMSBjIDEyLjE0NTY3LC0xMi4xNDU2NyAxNS43NDQ1MiwtMzAuMzUxNDMgOS4xMjk0MywtNDYuMTgzNTcgLTUuMTcwMTYsLTEyLjM3Mzk3IC0xNC4xNDQ2NiwtMTcuMDA1MTYgLTI2Ljc5ODc4LC0xMy44MjkxOCAtOS40MDI2MywyLjM1OTkxIC0yMy43MjMxMSwyOS43NzY1OSAtMjMuNzczODcsNDUuNTE1MzYgLTAuMDc5MiwyNC41MjkwMiAyMy4yNTA1MywzMi42OTAwNSA0MS40NDMyMiwxNC40OTczOSB6IG0gLTIyLjA4MzQxLC0xOS40MzQwNyBjIC0zLjU1NTEsLTMuNTU1MSAtNi40MTc1NSwtMTAuNDYzMjggLTYuMzYxMDIsLTE1LjM1MTUzIDAuMDkzNCwtOC4wNzk2NSAwLjQ5MzE1LC04LjM3MzUgNC4zOTYxOSwtMy4yMzE5IDQuODI0NjQsNi4zNTU2OSAxMy4zOTc5Nyw3LjQ1NjY2IDE2LjY4MjQxLDIuMTQyMzIgMS4xOTQzMiwtMS45MzI0MSAwLjU1Mjk1LC01LjEzMjAyIC0xLjQyNTIsLTcuMTEwMTcgLTUuMDgxMzIsLTUuMDgxMzIgLTQuNDY1NjEsLTExLjk5OTYzIDEuMDY3OTIsLTExLjk5OTYzIDYuMTUxMzcsMCAxNC43MjY3OSwxMi41MTQ3NyAxNC43MjY3OSwyMS40OTE5MSAwLDYuNjA2NzQgLTEzLjQ0NDQsMjAuNTIyOCAtMTkuODI3MjQsMjAuNTIyOCAtMS41Mzc4NSwwIC01LjcwNDc2LC0yLjkwODcyIC05LjI1OTg1LC02LjQ2MzggeiBtIDg2LjM0ODk3LDE4LjU4MzQxIGMgMTMuNDEwNzQsLTE0LjYwMjYzIDEyLjEwMzc2LC0zNy4wOTggLTMuMDk4MjUsLTUzLjMyNjM0IC03Ljg1MDU3LC04LjM4MDYgLTI1LjI5Mjk4LC05LjgyNTUyIC0zMi40MzE4NSwtMi42ODY2NCAtNi41ODc2MSw2LjU4NzYxIC0xMy4xNjQ2NSwzMi40OTMwMyAtMTAuNzIxMjIsNDIuMjI4NDEgNS4yMTEyMiwyMC43NjMxOCAzMi40MDA0MSwyOC44NjY1MiA0Ni4yNTEzMiwxMy43ODQ1NyB6IG0gLTI3LjQ1NTY1LC0yMy42MTQ1MiBjIC01LjMwNjIzLC0zLjcxNjY0IC03LjEyOTQxLC04LjE0OTc0IC02Ljk3ODA2LC0xNi45Njc0NyAwLjE2OTM1LC05Ljg2MDMzIDAuNjg0MywtMTAuNzQ5ODEgMi45NjE0NSwtNS4xMTQxNSAzLjM0NTczLDguMjgwMzIgMTAuMzYyOTIsMTEuNDA3MzQgMTYuNTE4MTQsNy4zNjA5IDMuODE3NTMsLTIuNTA5NjMgMy42MzkyOSwtMy42OTU5NyAtMS4xMDEwNCwtNy4zMjkwNyAtNi4zMjE4OSwtNC44NDUyMyAtNy41NTUwOCwtMTEuNzAxOTEgLTIuMTA0NjUsLTExLjcwMTkxIDQuODczNjQsMCAyMi4zMDQwMiwxOS4wNjY2NiAyMi4zMDQwMiwyNC4zOTc3OCAwLDUuMjAzMTYgLTEyLjM3NzM5LDE0LjM4NTAzIC0xOS4zOTEzOSwxNC4zODUwMyAtMi43NjQwNSwwIC04LjI1NzksLTIuMjY0MDIgLTEyLjIwODQ3LC01LjAzMTExIHogbSAxODkuOTYyOTIsLTE0LjI4ODg3IDMzLjkzNDk1LC0xMi43MzY4MiAtMzYuMzU4ODgsLTAuMTMxMjUgYyAtMzIuNTM5MiwtMC4xMTczNiAtMzYuMzU0MjQsMC40NjMwNyAtMzYuMzE0NzUsNS41MjQ3NSAwLjA0MDEsNS4xMjc1NyAzLjMzMDczLDIwLjI4Mzk1IDQuMzcyNywyMC4xMzk2NyAwLjIzNzIyLC0wLjAzMjkgMTUuNzAxNzcsLTUuNzkxMjQgMzQuMzY1OTgsLTEyLjc5NjQ4IHogbSAtNDQzLjQ5MzQzLC0yLjI3OTMgMy40NjgyNSwtMTAuMjg3NjEgLTMwLjQ2Njg2LC0xLjAyNDA0IGMgLTE2Ljc1Njc0NCwtMC41NjMyMiAtMzAuNDYzNTg0LC0wLjEzMjEzIC0zMC40NTk1OCwwLjk1ODA0IDAuMDA1OCwxLjU5NTEzIDUyLjUwNjU3LDIyLjEwNzA3IDUzLjY2MTc0LDIwLjk2NTUyIDAuMTgwMzUsLTAuMTc4NCAxLjg4ODkyLC00Ljk1MzcyIDMuNzk2NDUsLTEwLjYxMTkxIHogbSAyMDguOTA5MiwtMzEuODg2OTUgYyA3LjE2NjY3LDEuMTQ2IDE1LjI0OTgxLDQuMDc5MjQgMTcuOTYyNTYsNi41MTgzNSA0LjIxMjc5LDMuNzg3ODMgNi4wNDUyOCwzLjUyOTY2IDEyLjU2MjA3LC0xLjc2OTg1IDQuMTk2NDMsLTMuNDEyNSA5LjY1MDI2LC02LjIwNDU3IDEyLjExOTYzLC02LjIwNDU3IDIuNDY5MzksMCA0LjQ4OTgyLC0wLjcxMzA4IDQuNDg5ODIsLTEuNTg0NjcgMCwtMy4wMDkxOCAtNDYuNTM5NTQsLTc5LjIxMjUyIC00OC4zMTQ0NywtNzkuMTA5NjEgLTIuMDg1LDAuMTIwODcyIC00OS43ODYwMyw4MC4wODc5OCAtNTEuMjU0NjQsODUuOTI0MzcgLTAuNjE2MzQsMi40NDk1MiAxLjMxODA0LDMuMzUzNzEgNS4wNzM2NCwyLjM3MTYgMy4zMzgzNiwtMC44NzMgNy45NTQxNiwwLjY4MzI2IDEwLjI1NzI3LDMuNDU4MzYgMy43MzU0LDQuNTAwODcgNS4yNjEwOCw0LjE0MjI5IDE0LjEzMDY4LC0zLjMyMDk3IDguNDI2NDcsLTcuMDkwNDEgMTEuOTMwOCwtOC4wNDg4IDIyLjk3MzQ0LC02LjI4MzAxIHoiDQogICAgICAgc3R5bGU9ImZpbGw6IzMzMzMzMztmaWxsLW9wYWNpdHk6MSIgLz4NCiAgICA8cGF0aA0KICAgICAgIHN0eWxlPSJmaWxsOiM2Mzk4YWE7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiDQogICAgICAgZD0ibSAzMDkuNTQ1NzksMTQwLjg3OTIyIGMgLTAuNTAwNzUsLTAuMjMzMTEgLTEuMTE4MDQsLTAuNzY3OTkgLTIuNTI3OCwtMi4xOTAzNSAtMS45MTE4OCwtMS45Mjg5NyAtMi42NzE4OCwtMi40OTAxMyAtNC4yNjEwOCwtMy4xNDYyOCAtMi4wODc5MSwtMC44NjIwNCAtNC4zNTQ5LC0xLjA5NDIzIC02LjQ4MjMxLC0wLjY2MzkxIC0xLjg5ODA4LDAuMzgzOTMgLTIuNDI0MzUsMC40MjUyNyAtMy4yODI0MiwwLjI1NzggLTEuNDMyMjQsLTAuMjc5NTMgLTEuOTQxNTcsLTEuMTQ5MjkgLTEuNTM1ODMsLTIuNjIyNzIgMC41MDU3MywtMS44MzY1NyA0LjMzNjkzLC04Ljk0MjU1IDEyLjAwODk5LC0yMi4yNzM4NyAxNS41ODM3LC0yNy4wNzg5ODggMzYuNTM2MjQsLTYxLjIyMDk2OCAzOC44NTA1NiwtNjMuMzA2NjYyIDAuMjU2MzEsLTAuMjMwOTk0IDAuMjY1LC0wLjIzMDk5NCAwLjUyMjQ4LDAgMS4zNzc2OCwxLjIzNTk3NiA5LjQ3NjIsMTMuNzI1ODg5IDIwLjU0MDM2LDMxLjY3ODI5OCAxNC45NjY5NiwyNC4yODUwMDQgMjcuNDExMDIsNDUuNjQzNzE0IDI3LjQxMTAyLDQ3LjA0NzcwNCAwLDAuODU3MjkgLTEuMzE2MDgsMS4zNzIxNSAtNC4wODU5MSwxLjU5ODQ1IC0zLjQ0MjI2LDAuMjgxMjQgLTcuNDI0NzgsMi4zMDE4OCAtMTIuODY4ODcsNi41MjkzNiAtMi41ODcxMiwyLjAwODk4IC0zLjY5MTI2LDIuNzU5MzMgLTQuOTUwNjIsMy4zNjQzOCAtMS4wNDkyOCwwLjUwNDExIC0xLjEzNjkyLDAuNTI0MzcgLTIuMjY4NTQsMC41MjQzNyAtMS4xMTM2OCwwIC0xLjIyNjYxLC0wLjAyNDkgLTIuMDk2MjMsLTAuNDYxMjggLTAuNTEyMTMsLTAuMjU3MDIgLTEuNTA0NjksLTAuOTQ5MyAtMi4yNDE1NSwtMS41NjM0MiAtMi4xNzg0OCwtMS44MTU2MSAtNC43OTkxOCwtMy4xMzYxNCAtOS4wNzE5NywtNC41NzEyNCAtNS40Mjk5NywtMS44MjM3NiAtMTEuMjQ0NTQsLTIuOTE4NCAtMTYuMTk1NTEsLTMuMDQ4OTYgLTMuOTA5MzQsLTAuMTAzMDggLTUuNzEyMDEsMC4yNDc5OCAtOC42NzYwMiwxLjY4OTYzIC0yLjQxOTg4LDEuMTc2OTggLTMuNTg2MjEsMi4wMTMxMSAtOS4xMjQ3NSw2LjU0MTQ1IC01LjYzMzc2LDQuNjA2MTcgLTcuNjM0NDIsNS41NjIwNSAtOS42NjQsNC42MTcyNSB6IiAvPg0KICAgIDxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzYzOThhYTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSINCiAgICAgICBkPSJtIDEyOC42Mzc4NiwxNzAuNzM5IGMgLTEwLjE1OSwtMi45NjA3IC00NS41MDMxNzEsLTE2LjkxOTYyIC01MC40NTA5MjQsLTE5LjkyNTIzIC0wLjY4MjkxNiwtMC40MTQ4NCAtMC43MzgwOTgsLTAuNDc3ODcgLTAuNTQzMjA3LC0wLjYyMDM4IDEuMTMxNTYzLC0wLjgyNzQxIDEyLjMzNzk4MywtMS4yMzkwMSAyNS4wMDQwMzEsLTAuOTE4MzYgNS4wNTEzMSwwLjEyNzg4IDM1LjUwMTMyLDEuMTMzMjMgMzUuNTUwOSwxLjE3Mzc3IDAuMDk5NywwLjA4MTUgLTYuNTIxNjQsMTkuMjg4OCAtNy4wMzA1MSwyMC4zOTQzMyAtMC4yMTI1MSwwLjQ2MTcgLTAuNjUwNjMsMC40NDM2NyAtMi41MzAyOSwtMC4xMDQxMyB6IiAvPg0KICAgIDxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzYzOThhYTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSINCiAgICAgICBkPSJtIDU0My42OTQxMywxNzUuMzEwNTUgYyAtMS4zODYyLC0yLjcxMjg3IC0zLjg4NzY5LC0xNC45NzA2NyAtMy45NjA3OCwtMTkuNDA4NTggLTAuMDI4NCwtMS43MjQyNCAwLjE4NjY3LC0yLjQyNzQxIDAuOTYwNiwtMy4xNDA4IDEuNzczNzgsLTEuNjM1MDEgNS4zNzkzOCwtMi4yMjMyIDE1LjI5MDE3LC0yLjQ5NDM0IDUuMDAzNDcsLTAuMTM2ODkgMjguMTAxOSwtMC4xNTc5NiA0NC40MTEyNywtMC4wNDA1IGwgMTEuNDI4NTksMC4wODIzIC0yNy41MTc3LDEwLjMxNDI3IGMgLTI1LjA5MjkyLDkuNDA1NCAtMzkuNjg0NzMsMTQuODQxMjYgLTQwLjIyNDkxLDE0Ljk4NDkgLTAuMTM1MTcsMC4wMzYgLTAuMjY5ODEsLTAuMDY3NCAtMC4zODcyNCwtMC4yOTcyMyBsIDAsMCB6IiAvPg0KICAgIDxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzYzOThhYTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSINCiAgICAgICBkPSJtIDE3OC4wODgzNSwzMTUuNTE0MzMgYyAwLC0wLjc3MDc4IDMuMjY4OSwtNi41MzMxIDExLjU1Mzk1LC0yMC4zNjY5OCAxOS44NTExOCwtMzMuMTQ2MzEgMjguOTI3MTUsLTQ1LjE2MDEyIDQwLjA3MjkyLC01My4wNDQyOSA5Ljk3MTI3LC03LjA1MzM3IDE1LjMwMjc5LC0xMS45Mjk0IDIxLjI0NTM5LC0xOS40MzAzMyBsIDMuNjY0MDksLTQuNjI0OTIgNC45Mzk5LDQuODU2NTIgYyA4LjY0Nzg0LDguNTAxODkgMTMuODYxMywxMC45NjY2OCAyMy4yOTcxNywxMS4wMTQzMiAxMS41NDA1OCwwLjA1ODMgMjQuMTc4NDksLTYuMzg4MSAyNC4xNzg0OSwtMTIuMzMyOTkgMCwtMS4zMzk4IDAuOTU0MDQsLTIuNzIyMzYgMS44Nzg1NywtMi43MjIzNiAwLjM5MTMyLDAgMi42MTY4NiwwLjY4MzY1IDQuOTQ1NjUsMS41MTkyMyA2LjA2OTkyLDIuMTc3OSA5LjYzMDI4LDIuOTY1NDggMTQuNjA5MTIsMy4yMzE2NSA0LjkzOTk4LDAuMjY0MDkgOC41NDg0OCwtMC4xNzA0IDEzLjM1ODE3LC0xLjYwODQxIDQuNzI1NjEsLTEuNDEyODggNy40NDcwOSwtMi44NTkwNSAxNS41OTgzMywtOC4yODg4MiA0LjEwNzYsLTIuNzM2MTggNy41OTk1NCwtNC45NzQ4NyA3Ljc1OTg4LC00Ljk3NDg3IDAuMTYwMzMsMCAzLjEyNTM0LDEuNzE4OTYgNi41ODg5LDMuODE5OTEgMy40NjM1NiwyLjEwMDk1IDcuNjI1NDIsNC4zODEzMyA5LjI0ODU5LDUuMDY3NTEgMTEuMDY4NjIsNC42NzkxOCAyMy4wMjQ0NSw0LjM3MzkgMzMuOTcxMjYsLTAuODY3NDEgMS45NTc5NSwtMC45Mzc0NyA2LjU2NzkzLC0zLjczMDc0IDEwLjI0NDQsLTYuMjA3MjcgMy42NzY0OCwtMi40NzY1MyA2LjczNjEzLC00LjQ0NTc2IDYuNzk5MjMsLTQuMzc2MDYgMC4wNjMxLDAuMDY5NyAxLjQ1NjA1LDIuOTIwOCAzLjA5NTQ0LDYuMzM1NzggMS42Mzk0LDMuNDE0OTggMy42OTg5NSw3LjI2NjcgNC41NzY3OSw4LjU1OTM3IDMuODAwMDEsNS41OTU3OCA4LjE3NTg4LDkuNzUxNDEgMTQuMDgzNDMsMTMuMzc0NjQgNi4wODEyMiwzLjcyOTc1IDkuODMyMDYsOC42ODY4IDEwLjIxODgyLDEzLjUwNTA3IDAuMzgzNjcsNC43Nzk2OCAtMS43MDMyOSw5LjAxOTM5IC03LjcyMTg5LDE1LjY4NzIxIC00LjY5NzQ3LDUuMjA0MTkgLTUuODczMyw3LjIzNTQgLTUuODYxMTMsMTAuMTI0OTEgMC4wMTIyLDIuODkyNjIgMS43MDEwMyw2LjIyODU0IDQuNjY5NjQsOS4yMjM3OSA0LjgwNTMzLDQuODQ4NDQgMTIuMzQ2MDUsNi4yODc3NyAyMy40MzUzNCw0LjQ3MzE5IDIuNDc0MDgsLTAuNDA0ODQgNS41OTQ3OSwtMC43Mzc1NyA2LjkzNDkxLC0wLjczOTM4IDQuMjg1NTEsLTAuMDA2IDYuOTAzMTksMi4wOTU5NSAxMS44OTI1MSw5LjU0ODU5IDMuNDQzNTEsNS4xNDM2NSAxMC45NzM5NiwxNy43NTUwOCAxMC45NzM5NiwxOC4zNzgzNiAwLDAuMzI0MDcgLTAuMzUxNDUsMC41NTIwOCAtMC44NTA5NywwLjU1MjA4IC0xLjA1MTA5LDAgLTUuNjIzMTQsLTEuMjQzOCAtOC45MzIxNCwtMi40Mjk5NCAtNC4zNDg1LC0xLjU1ODc1IC01Ny4yNzIzOCwtMjIuMDA1MjYgLTc0Ljc0Nzg2LC0yOC44Nzc5NSAtNDYuNjYzNSwtMTguMzUxNjIgLTYyLjAyODA1LC0yNC4yMTI0NiAtNjkuNTM2NTcsLTI2LjUyNDg5IC04LjExNDE3LC0yLjQ5ODk1IC0xMy42NDAyOSwtMy4wODUyMiAtMTguMTI2NjEsLTEuOTIzMDYgLTUuNTc5OTYsMS40NDU0NiAtODEuNzIwNjcsMzAuODY4ODggLTEyNi4xMzI0NSw0OC43NDE5NSAtMjEuOTMxMTksOC44MjYgLTI0LjY3NzQ5LDkuODc1NzcgLTI4Ljc4MTE2LDExLjAwMTU5IC0zLjI2MzAzLDAuODk1MjEgLTMuMTQ0MDcsMC44ODI5NCAtMy4xNDQwNywwLjMyNDI2IHoiIC8+DQogIDwvZz4NCjwvc3ZnPg==');
    background-position: 16px 80%;
    background-repeat: no-repeat;
    background-size: 20px 12px;
    padding-left: 2.5em;
}

.multi-language-selector .language-option[data-lang='kotlin'],
.exampleblock[data-lang=kotlin] > .content .title {
    background-image: url("data:image/svg+xml;utf8,<svg viewBox='0 0 8 8' xmlns='http://www.w3.org/2000/svg'><linearGradient id='g' gradientUnits='userSpaceOnUse' x1='8' y1='0' x2='0' y2='8'><stop offset='0' stop-color='%23e44857'/><stop offset='.4689' stop-color='%23c711e1'/><stop offset='1' stop-color='%237f52ff'/></linearGradient><polygon fill='url(%23g)' points='8 8 0 8 0 0 8 0 4 4'/></svg>");
    background-position: 17px 80%;
    background-repeat: no-repeat;
    background-size: 11px 11px;
    padding-left: 2.3em;
}

.multi-language-selector {
    display: block;
}

.multi-language-selector .language-option[data-lang='groovy'] {
    background-position: 20px center;
    padding-left: 32px;
}

.multi-language-selector .language-option[data-lang='kotlin'] {
    background-position: 30px center;
    padding-left: 27px;
}

.multi-language-selector .language-option {
    background-color: white;
    border: 1px solid #f7f7f8;
    border-radius: 4px 4px 0 0;
    cursor: pointer;
    display: inline-block;
    font-weight: normal;
    font-family: 'Lato', Arial, sans-serif;
    margin: 0;
    padding: 4px 20px;
    min-width: 130px;
    max-width: 320px;
    text-align: center;
    filter: grayscale(1);
    -webkit-filter: grayscale(1);
    opacity: 0.7;
}

.multi-language-selector .language-option.selected {
    background-color: #f7f7f8;
    color: #02303a;
    filter: none;
    -webkit-filter: none;
    opacity: 1;
}

.multi-language-text.hidden,
.multi-language-selector ~ .multi-language-sample.hidden {
    display: none;
}

.multi-language-sample {
    border-radius: 0 0 4px 4px;
}

.dark-mode {
    .multi-language-selector .language-option {
        background-color: #1f1f1f;
        border: 1px solid #1e1e22;
    }
    .multi-language-selector .language-option.selected {
        background-color: #2c2c2c;
        color: #056f86;
    }
}
</style><script type="text/javascript">function postProcessCodeBlocks() {
  // Assumptions:
  //  1) All siblings that are marked with class="multi-language-sample" should be grouped
  //  2) Only one language can be selected per domain (to allow selection to persist across all docs pages)
  //  3) There is exactly 1 small set of languages to choose from. This does not allow for multiple language preferences. For example, users cannot prefer both Kotlin and ZSH.
  //  4) Only 1 sample of each language can exist in the same collection.

  var GRADLE_DSLs = ["groovy", "kotlin"];
  var preferredBuildScriptLanguage = initPreferredBuildScriptLanguage();

  // Ensure preferred DSL is valid, defaulting to Kotlin DSL
  function initPreferredBuildScriptLanguage() {
    var lang = window.localStorage.getItem("preferred-gradle-dsl");
    if (GRADLE_DSLs.indexOf(lang) === -1) {
      window.localStorage.setItem("preferred-gradle-dsl", "kotlin");
      lang = "kotlin";
    }
    return lang;
  }

  function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
  }

  function processSampleEl(sampleEl, prefLangId) {
    var codeEl = sampleEl.querySelector("code[data-lang]");
    if (codeEl != null) {
      sampleEl.setAttribute("data-lang", codeEl.getAttribute("data-lang"));
      if (codeEl.getAttribute("data-lang") !== prefLangId) {
        sampleEl.classList.add("hidden");
      } else {
        sampleEl.classList.remove("hidden");
      }
    }
  }

  function switchSampleLanguage(languageId) {
    var multiLanguageSampleElements = [].slice.call(
      document.querySelectorAll(".multi-language-sample")
    );

    // Array of Arrays, each top-level array representing a single collection of samples
    var multiLanguageSets = [];
    for (var i = 0; i < multiLanguageSampleElements.length; i++) {
      var currentCollection = [multiLanguageSampleElements[i]];
      var currentSampleElement = multiLanguageSampleElements[i];
      processSampleEl(currentSampleElement, languageId);
      while (
        currentSampleElement.nextElementSibling != null &&
        currentSampleElement.nextElementSibling.classList.contains(
          "multi-language-sample"
        )
      ) {
        currentCollection.push(currentSampleElement.nextElementSibling);
        currentSampleElement = currentSampleElement.nextElementSibling;
        processSampleEl(currentSampleElement, languageId);
        i++;
      }

      multiLanguageSets.push(currentCollection);
    }

    multiLanguageSets.forEach(function (sampleCollection) {
      // Create selector element if not existing
      if (
        sampleCollection.length > 1 &&
        (sampleCollection[0].previousElementSibling == null ||
          !sampleCollection[0].previousElementSibling.classList.contains(
            "multi-language-selector"
          ))
      ) {
        var languageSelectorFragment = document.createDocumentFragment();
        var multiLanguageSelectorElement = document.createElement("div");
        multiLanguageSelectorElement.classList.add("multi-language-selector");
        languageSelectorFragment.appendChild(multiLanguageSelectorElement);

        sampleCollection.forEach(function (sampleEl) {
          var optionEl = document.createElement("code");
          var sampleLanguage = sampleEl.getAttribute("data-lang");
          optionEl.setAttribute("data-lang", sampleLanguage);
          optionEl.setAttribute("role", "button");
          optionEl.classList.add("language-option");

          optionEl.innerText = capitalizeFirstLetter(sampleLanguage);

          optionEl.addEventListener(
            "click",
            function updatePreferredLanguage(evt) {
              var preferredLanguageId = optionEl.getAttribute("data-lang");
              window.localStorage.setItem(
                "preferred-gradle-dsl",
                preferredLanguageId
              );

              // Record how far down the page the clicked element is before switching all samples
              var beforeOffset = evt.target.offsetTop;

              switchSampleLanguage(preferredLanguageId);

              // Scroll the window to account for content height differences between different sample languages
              window.scrollBy(0, evt.target.offsetTop - beforeOffset);
            }
          );
          multiLanguageSelectorElement.appendChild(optionEl);
        });
        sampleCollection[0].parentNode.insertBefore(
          languageSelectorFragment,
          sampleCollection[0]
        );
      }
    });

    [].slice
      .call(
        document.querySelectorAll(".multi-language-selector .language-option")
      )
      .forEach(function (optionEl) {
        if (optionEl.getAttribute("data-lang") === languageId) {
          optionEl.classList.add("selected");
        } else {
          optionEl.classList.remove("selected");
        }
      });

    [].slice
      .call(document.querySelectorAll(".multi-language-text"))
      .forEach(function (el) {
        if (!el.classList.contains("lang-" + languageId)) {
          el.classList.add("hidden");
        } else {
          el.classList.remove("hidden");
        }
      });
  }

  switchSampleLanguage(preferredBuildScriptLanguage);
}

document.addEventListener("DOMContentLoaded", function () {
  postProcessCodeBlocks();
});
</script>
</head>
<body class="book">
<div class="layout">
    <header class="site-layout__header site-header" itemscope="itemscope" itemtype="https://schema.org/WPHeader">
        <nav class="site-header__navigation" itemscope="itemscope" itemtype="https://schema.org/SiteNavigationElement">
            <div class="site-header__navigation-header">
                <a target="_top" class="logo" href="https://docs.gradle.org" title="Gradle Docs">
                    <svg width="139px" height="43px" viewBox="0 0 278 86" version="1.1" xmlns="http://www.w3.org/2000/svg">
                        <title>Gradle</title>
                        <path class="cls-1" d="M155,56.32V70.27a18.32,18.32,0,0,1-5.59,2.83,21.82,21.82,0,0,1-6.36.89,21.08,21.08,0,0,1-7.64-1.31A17.12,17.12,0,0,1,129.59,69a16.14,16.14,0,0,1-3.73-5.58,18.78,18.78,0,0,1-1.31-7.08,19.58,19.58,0,0,1,1.26-7.14A15.68,15.68,0,0,1,135,40a20.39,20.39,0,0,1,7.45-1.29,22,22,0,0,1,3.92.33,20.43,20.43,0,0,1,3.39.92,15.16,15.16,0,0,1,2.85,1.42A17.3,17.3,0,0,1,155,43.25l-1.84,2.91a1.72,1.72,0,0,1-1.12.84,2,2,0,0,1-1.5-.34L149,45.75a10.49,10.49,0,0,0-1.75-.79,14.33,14.33,0,0,0-2.17-.54,15.29,15.29,0,0,0-2.78-.22,11.91,11.91,0,0,0-4.61.86,9.66,9.66,0,0,0-3.52,2.46,10.9,10.9,0,0,0-2.24,3.84,14.88,14.88,0,0,0-.79,5,15.23,15.23,0,0,0,.85,5.28,11.06,11.06,0,0,0,2.38,3.94A10.15,10.15,0,0,0,138.05,68a14.28,14.28,0,0,0,8.25.44,17.1,17.1,0,0,0,2.94-1.09V61.14h-4.35a1.3,1.3,0,0,1-1-.35,1.15,1.15,0,0,1-.35-.85V56.32Zm10.47-2.93a10.53,10.53,0,0,1,2.72-3.45,5.77,5.77,0,0,1,3.72-1.25,4.5,4.5,0,0,1,2.72.74l-.38,4.41a1.18,1.18,0,0,1-.34.61,1,1,0,0,1-.61.18,6.76,6.76,0,0,1-1.06-.12,8.22,8.22,0,0,0-1.38-.12,5,5,0,0,0-1.74.28,4.37,4.37,0,0,0-1.37.83,5.55,5.55,0,0,0-1.07,1.3,12.26,12.26,0,0,0-.87,1.74V73.61H160V49.14h3.45a1.94,1.94,0,0,1,1.27.32,1.9,1.9,0,0,1,.48,1.16Zm11.36-.84A14.49,14.49,0,0,1,187,48.69a9.92,9.92,0,0,1,3.84.7,8.06,8.06,0,0,1,2.86,2,8.38,8.38,0,0,1,1.78,3,11.64,11.64,0,0,1,.61,3.82V73.61h-2.68a2.64,2.64,0,0,1-1.28-.25,1.72,1.72,0,0,1-.72-1l-.52-1.77a20.25,20.25,0,0,1-1.82,1.47,10.86,10.86,0,0,1-1.83,1.06,10.36,10.36,0,0,1-2,.66,12,12,0,0,1-2.4.22,9.64,9.64,0,0,1-2.86-.41,6.28,6.28,0,0,1-2.27-1.26,5.6,5.6,0,0,1-1.48-2.07,7.38,7.38,0,0,1-.52-2.89,5.7,5.7,0,0,1,.31-1.85,5.3,5.3,0,0,1,1-1.75,8.25,8.25,0,0,1,1.83-1.57,11.17,11.17,0,0,1,2.75-1.29,23.28,23.28,0,0,1,3.81-.9,36.77,36.77,0,0,1,5-.41V58.16a5.35,5.35,0,0,0-1.05-3.64,3.83,3.83,0,0,0-3-1.18,7.3,7.3,0,0,0-2.38.33,9.39,9.39,0,0,0-1.65.75l-1.3.75a2.52,2.52,0,0,1-1.3.34,1.7,1.7,0,0,1-1.05-.32,2.61,2.61,0,0,1-.69-.76Zm13.5,10.61a31.66,31.66,0,0,0-4.3.45,11,11,0,0,0-2.79.82,3.57,3.57,0,0,0-1.5,1.17,2.89,2.89,0,0,0,.47,3.67,3.93,3.93,0,0,0,2.39.67,7,7,0,0,0,3.14-.66,9.52,9.52,0,0,0,2.59-2Zm32.53-25V73.61h-3.6a1.39,1.39,0,0,1-1.48-1.07l-.5-2.36a12.4,12.4,0,0,1-3.4,2.74,9.17,9.17,0,0,1-4.47,1,7.95,7.95,0,0,1-6.55-3.26A11.61,11.61,0,0,1,201,66.79a19.71,19.71,0,0,1-.66-5.34,16.77,16.77,0,0,1,.74-5.06,12.21,12.21,0,0,1,2.13-4,9.88,9.88,0,0,1,3.31-2.69,9.64,9.64,0,0,1,4.34-1,8.63,8.63,0,0,1,3.51.64,9,9,0,0,1,2.6,1.74V38.17ZM217,55.39a5.94,5.94,0,0,0-2.18-1.72,6.54,6.54,0,0,0-2.54-.5,5.68,5.68,0,0,0-2.41.5A4.87,4.87,0,0,0,208,55.19a7.19,7.19,0,0,0-1.17,2.57,14.83,14.83,0,0,0-.4,3.69,16.34,16.34,0,0,0,.34,3.63,7.14,7.14,0,0,0,1,2.44,3.79,3.79,0,0,0,1.58,1.36,5,5,0,0,0,2.07.41,6,6,0,0,0,3.13-.76A9.19,9.19,0,0,0,217,66.36Zm17.67-17.22V73.61h-5.89V38.17ZM245.1,62.11a11.37,11.37,0,0,0,.67,3.26,6.54,6.54,0,0,0,1.38,2.27,5.39,5.39,0,0,0,2,1.33,7.26,7.26,0,0,0,2.61.44,8.21,8.21,0,0,0,2.47-.33,11.51,11.51,0,0,0,1.81-.74c.52-.27,1-.52,1.36-.74a2.31,2.31,0,0,1,1.13-.33,1.21,1.21,0,0,1,1.1.55L261.36,70a9.45,9.45,0,0,1-2.19,1.92,12.18,12.18,0,0,1-2.54,1.24,14,14,0,0,1-2.7.66,18.78,18.78,0,0,1-2.65.19,12.93,12.93,0,0,1-4.75-.85,10.65,10.65,0,0,1-3.82-2.5,11.8,11.8,0,0,1-2.55-4.1,15.9,15.9,0,0,1-.93-5.67,13.55,13.55,0,0,1,.81-4.71,11.34,11.34,0,0,1,2.33-3.84,11,11,0,0,1,3.69-2.59,12.31,12.31,0,0,1,4.93-1,11.86,11.86,0,0,1,4.27.74,9.25,9.25,0,0,1,3.36,2.16,9.84,9.84,0,0,1,2.21,3.48,13,13,0,0,1,.8,4.71,3.82,3.82,0,0,1-.29,1.8,1.19,1.19,0,0,1-1.1.46Zm11.23-3.55A7.28,7.28,0,0,0,256,56.4a5.16,5.16,0,0,0-1-1.77,4.44,4.44,0,0,0-1.63-1.21,5.68,5.68,0,0,0-2.3-.44,5.46,5.46,0,0,0-4,1.45,7.13,7.13,0,0,0-1.87,4.13ZM112.26,14a13.72,13.72,0,0,0-19.08-.32,1.27,1.27,0,0,0-.41.93,1.31,1.31,0,0,0,.38.95l1.73,1.73a1.31,1.31,0,0,0,1.71.12,7.78,7.78,0,0,1,4.71-1.57,7.87,7.87,0,0,1,5.57,13.43C96,40.2,81.41,9.66,48.4,25.37a4.48,4.48,0,0,0-2,6.29l5.66,9.79a4.49,4.49,0,0,0,6.07,1.67l.14-.08-.11.08,2.51-1.41a57.72,57.72,0,0,0,7.91-5.89,1.37,1.37,0,0,1,1.8-.06h0a1.29,1.29,0,0,1,0,2A59.79,59.79,0,0,1,62.11,44l-.09.05-2.51,1.4a7,7,0,0,1-3.47.91,7.19,7.19,0,0,1-6.23-3.57l-5.36-9.24C34.17,40.81,27.93,54.8,31.28,72.5a1.31,1.31,0,0,0,1.29,1.06h6.09A1.3,1.3,0,0,0,40,72.42a8.94,8.94,0,0,1,17.73,0A1.3,1.3,0,0,0,59,73.56h5.94a1.31,1.31,0,0,0,1.3-1.14,8.93,8.93,0,0,1,17.72,0,1.3,1.3,0,0,0,1.29,1.14h5.87a1.3,1.3,0,0,0,1.3-1.28c.14-8.28,2.37-17.79,8.74-22.55C123.15,33.25,117.36,19.12,112.26,14ZM89.79,38.92l-4.2-2.11h0a2.64,2.64,0,1,1,4.2,2.12Z"/>
                    </svg>
                </a>
                <div class="site-header__doc-type sr-only">User Manual</div>
                <div class="site-header-version"></div>
                <button type="button" aria-label="Navigation Menu" class="site-header__navigation-button hamburger">
                    <span class="hamburger__bar"></span>
                    <span class="hamburger__bar"></span>
                    <span class="hamburger__bar"></span>
                </button>
            </div>
            <div class="site-header__navigation-collapsible site-header__navigation-collapsible--collapse">
                <ul class="site-header__navigation-items">
                    <li id="theme-toggle" class="site-header__navigation-item">
                        <a class="site-header__navigation-link theme-toggle" title="Theme">
                            <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <title>Theme</title>
                                <path d="m12 22c5.5228475 0 10-4.4771525 10-10s-4.4771525-10-10-10-10 4.4771525-10 10 4.4771525 10 10 10zm0-1.5v-17c4.6944204 0 8.5 3.80557963 8.5 8.5 0 4.6944204-3.8055796 8.5-8.5 8.5z"/>
                            </svg>
                        </a>
                        <script type="text/javascript">
                            const themeToggleBtn = document.querySelector('.theme-toggle');
                            const theme = localStorage.getItem('theme');
                            theme && document.body.classList.add(theme);
                            const handleThemeToggle = () => {
                              if (document.body.classList.contains('dark-mode')) {
                                localStorage.setItem('theme', 'dark-mode');
                              } else {
                                localStorage.removeItem('theme');
                              }
                            };
                            themeToggleBtn.addEventListener('click', handleThemeToggle);
                        </script>
                    </li>
                    <li class="site-header__navigation-item site-header__navigation-submenu-section" tabindex="0">
                        <span class="site-header__navigation-link">
                            Community
                        </span>
                        <div class="site-header__navigation-submenu">
                            <div class="site-header__navigation-submenu-item" itemprop="name">
                                <a target="_top" class="site-header__navigation-submenu-item-link" href="https://gradle.org/" itemprop="url">
                                    <span class="site-header__navigation-submenu-item-link-text">Community Home</span>
                                </a>
                            </div>
                            <div class="site-header__navigation-submenu-item" itemprop="name">
                                <a target="_top" class="site-header__navigation-submenu-item-link" href="https://discuss.gradle.org/" itemprop="url">
                                    <span class="site-header__navigation-submenu-item-link-text">Community Forums</span>
                                </a>
                            </div>
                            <div class="site-header__navigation-submenu-item" itemprop="name">
                                <a target="_top" class="site-header__navigation-submenu-item-link" href="https://plugins.gradle.org" itemprop="url">
                                    <span class="site-header__navigation-submenu-item-link-text">Community Plugins</span>
                                </a>
                            </div>
                        </div>
                    </li>
                    <li class="site-header__navigation-item" itemprop="name">
                        <a target="_top" class="site-header__navigation-link" href="https://dpeuniversity.gradle.com/" itemprop="url">DPE University</a>
                    </li>
                    <li class="site-header__navigation-item" itemprop="name">
                        <a target="_top" class="site-header__navigation-link" href="https://gradle.org/training/" itemprop="url">Events</a>
                    </li>
                    <li class="site-header__navigation-item site-header__navigation-submenu-section" tabindex="0">
                        <span class="site-header__navigation-link">
                            News
                        </span>
                        <div class="site-header__navigation-submenu">
                            <div class="site-header__navigation-submenu-item" itemprop="name">
                                <a class="site-header__navigation-submenu-item-link" href="https://newsletter.gradle.org" itemprop="url">
                                    <span class="site-header__navigation-submenu-item-link-text">Newsletter</span>
                                </a>
                            </div>
                            <div class="site-header__navigation-submenu-item" itemprop="name">
                                <a class="site-header__navigation-submenu-item-link" href="https://blog.gradle.org" itemprop="url">
                                    <span class="site-header__navigation-submenu-item-link-text">Blog</span>
                                </a>
                            </div>
                            <div class="site-header__navigation-submenu-item">
                                <a class="site-header__navigation-submenu-item-link" href="https://twitter.com/gradle">
                                    <span class="site-header__navigation-submenu-item-link-text">Twitter</span>
                                </a>
                            </div>
                        </div>
                    </li>
                    <li class="site-header__navigation-item" itemprop="name">
                        <a target="_top" class="site-header__navigation-link" href="https://gradle.com/develocity" itemprop="url">Develocity</a>
                    </li>
                    <li class="site-header__navigation-item">
                        <a class="site-header__navigation-link" title="Gradle on GitHub" href="https://github.com/gradle/gradle">
                            <svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <title>Github</title>
                                <path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill-rule="evenodd";/>
                            </svg>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <!-- Primary Navigation -->
        <nav class="docs-navigation">
            <div class="search-container"></div>
            <h3 id="overview">Overview</h3>
            <ul>
                <li><a href="../userguide/userguide.html">What is Gradle?</a></li>
                <li><a href="../userguide/quick_start.html">Quick Start</a></li>
            </ul>

            <h3 id="what-is-new">Releases</h3>
            <ul>
                <li><a href="https://gradle.org/releases/">All Releases</a></li>
                <li><a href="../release-notes.html">Release Notes</a></li>
                <li><a href="../userguide/installation.html">Installing Gradle</a></li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#upgrading-gradle" aria-expanded="false" aria-controls="upgrading-gradle">Upgrading Gradle</a>
                    <ul id="upgrading-gradle">
                        <li><a href="../userguide/upgrading_version_8.html">version 8.X to latest</a></li>
                        <li><a href="../userguide/upgrading_version_7.html">version 7.X to 8.0</a></li>
                        <li><a href="../userguide/upgrading_version_6.html">version 6.X to 7.0</a></li>
                        <li><a href="../userguide/upgrading_version_5.html">version 5.X to 6.0</a></li>
                        <li><a href="../userguide/upgrading_version_4.html">version 4.X to 5.0</a></li>
                    </ul>
                </li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#migrating-to-gradle" aria-expanded="false" aria-controls="migrating-to-gradle">Migrating to Gradle</a>
                    <ul id="migrating-to-gradle">
                        <li><a href="../userguide/migrating_from_maven.html">from Maven</a></li>
                        <li><a href="../userguide/migrating_from_ant.html">from Ant</a></li>
                    </ul>
                </li>
                <li><a href="../userguide/troubleshooting.html">Troubleshooting</a></li>
                <li><a href="../userguide/compatibility.html">Compatibility Notes</a></li>
                <li><a href="../userguide/feature_lifecycle.html">Gradle's Feature Lifecycle</a></li>
            </ul>

            <h3 id="running-gradle-builds">Running Gradle Builds</h3>
            <ul>
                <li><a href="../userguide/getting_started_eng.html">Getting Started</a></li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#running-introduction" aria-expanded="false" aria-controls="introduction">Core Concepts</a>
                    <ul id="running-introduction">
                        <li><a href="../userguide/gradle_basics.html">1. Gradle Basics</a></li>
                        <li><a href="../userguide/gradle_wrapper_basics.html">2. Gradle Wrapper Basics</a></li>
                        <li><a href="../userguide/command_line_interface_basics.html">3. Command-Line Interface Basics</a></li>
                        <li><a href="../userguide/settings_file_basics.html">4. Settings File Basics</a></li>
                        <li><a href="../userguide/build_file_basics.html">5. Build File Basics</a></li>
                        <li><a href="../userguide/dependency_management_basics.html">6. Dependency Management Basics</a></li>
                        <li><a href="../userguide/task_basics.html">7. Task Basics</a></li>
                        <li><a href="../userguide/plugin_basics.html">8. Plugins Basics</a></li>
                        <li><a href="../userguide/gradle_optimizations.html">9. Incremental Builds + Caching</a></li>
                        <li><a href="../userguide/build_scans.html">10. Build Scans</a></li>

                    </ul>
                </li>
                <li><a class="nav-dropdown" data-toggle="collapse" aria-expanded="false">Tutorial</a>
                    <ul id="running-tutorial">
                        <li><a href="../userguide/part1_gradle_init.html">1. Initializing the Project</a></li>
                        <li><a href="../userguide/part2_gradle_tasks.html">2. Running Tasks</a></li>
                        <li><a href="../userguide/part3_gradle_dep_man.html">3. Understanding Dependencies</a></li>
                        <li><a href="../userguide/part4_gradle_plugins.html">4. Applying Plugins</a></li>
                        <li><a href="../userguide/part5_gradle_inc_builds.html">5. Exploring Incremental Builds</a></li>
                        <li><a href="../userguide/part6_gradle_caching.html">6. Enabling the Build Cache</a></li>
                        <li><a href="../userguide/part7_gradle_refs.html">7. Using Reference Materials</a></li>
                    </ul>
                </li>
                <li><a href="../userguide/gradle_ides.html">Gradle in the IDE</a></li>
                <li><a href="../userguide/continuous_builds.html">Continuous Build</a></li>
            </ul>

            <h3 id="authoring-gradle-builds">Authoring Gradle Builds</h3>
            <ul>
                <li><a href="../userguide/getting_started_dev.html">Getting Started</a></li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#learning-the-basics" aria-expanded="false" aria-controls="learning-the-basics">Learning the Basics</a>
                    <ul id="authoring-introduction">
                        <li><a href="../userguide/gradle_directories.html">1. Gradle Directories</a></li>
                        <li><a href="../userguide/intro_multi_project_builds.html">2. Multi-Project Builds</a></li>
                        <li><a href="../userguide/build_lifecycle.html">3. Gradle Build Lifecycle</a></li>
                        <li><a href="../userguide/writing_settings_files.html">4. Writing Settings Files</a></li>
                        <li><a href="../userguide/writing_build_scripts.html">5. Writing Build Scripts</a></li>
                        <li><a href="../userguide/tutorial_using_tasks.html">6. Using Tasks</a></li>
                        <li><a href="../userguide/writing_tasks.html">7. Writing Tasks</a></li>
                        <li><a href="../userguide/plugins.html">8. Using Plugins</a></li>
                        <li><a href="../userguide/writing_plugins.html">9. Writing Plugins</a></li>
                    </ul>
                </li>
                <li><a class="nav-dropdown" data-toggle="collapse" aria-expanded="false">Tutorial</a>
                    <ul id="authoring-tutorial">
                        <li><a href="../userguide/partr1_gradle_init.html">1. Initializing the Project</a></li>
                        <li><a href="../userguide/partr2_build_lifecycle.html">2. Understanding the Build Lifecycle</a></li>
                        <li><a href="../userguide/partr3_multi_project_builds.html">3. Multi-Project Builds</a></li>
                        <li><a href="../userguide/partr4_settings_file.html">4. Writing the Settings File</a></li>
                        <li><a href="../userguide/partr5_build_scripts.html">5. Writing a Build Script</a></li>
                        <li><a href="../userguide/partr6_writing_tasks.html">6. Writing Tasks</a></li>
                        <li><a href="../userguide/partr7_writing_plugins.html">7. Writing Plugins</a></li>
                    </ul>
                </li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#authoring-multi-project-builds" aria-expanded="false" aria-controls="authoring-multi-project-builds">Structuring Builds</a>
                    <ul id="authoring-multi-project-builds">
                        <li><a href="../userguide/multi_project_builds.html">Structuring Projects with Gradle</a></li>
                        <li><a href="../userguide/declaring_dependencies_between_subprojects.html">Declaring Dependencies between Subprojects</a></li>
                        <li><a href="../userguide/sharing_build_logic_between_subprojects.html">Sharing Build Logic between Subprojects</a></li>
                        <li><a href="../userguide/composite_builds.html">Composite Builds</a></li>
                        <li><a href="../userguide/multi_project_configuration_and_execution.html">Configuration on Demand</a></li>
                    </ul>
                </li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#developing-tasks" aria-expanded="false" aria-controls="developing-tasks">Developing Tasks</a>
                    <ul id="developing-tasks">
                        <li><a href="../userguide/more_about_tasks.html">Understanding Tasks</a></li>
                        <li><a href="../userguide/controlling_task_execution.html">Controlling Task Execution</a></li>
                        <li><a href="../userguide/organizing_tasks.html">Organizing Tasks</a></li>
                        <li><a href="../userguide/implementing_custom_tasks.html">Implementing Custom Tasks</a></li>
                        <li><a href="../userguide/lazy_configuration.html">Configuring Tasks Lazily</a></li>
                        <li><a href="../userguide/worker_api.html">Developing Parallel Tasks</a></li>
                        <li><a href="../userguide/custom_tasks.html">Developing Advanced Tasks</a></li>
                        <li><a href="../userguide/build_services.html">Using Shared Build Services</a></li>
                    </ul>
                </li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#developing-plugins" aria-expanded="false" aria-controls="developing-plugins">Developing Plugins</a>
                    <ul id="developing-plugins">
                        <li><a href="../userguide/custom_plugins.html">Understanding Plugins</a></li>
                        <li><a href="../userguide/implementing_gradle_plugins.html">Understanding Implementation Options</a></li>
                        <li><a href="../userguide/implementing_gradle_plugins_precompiled.html">Implementing Pre-compiled Script Plugins</a></li>
                        <li><a href="../userguide/implementing_gradle_plugins_binary.html">Implementing Binary Plugins</a></li>
                        <li><a href="../userguide/testing_gradle_plugins.html">Testing Plugins</a></li>
                        <li><a href="../userguide/publishing_gradle_plugins.html">Publishing Plugins</a></li>
                    </ul>
                </li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#gradle-properties" aria-expanded="false" aria-controls="gradle-properties">Understanding Gradle Types</a>
                    <ul id="gradle-properties-topics">
                        <li><a href="../userguide/properties_providers.html">Understanding Properties and Providers</a></li>
                        <li><a href="../userguide/collections.html">Understanding Collections</a></li>
                        <li><a href="../userguide/service_injection.html">Understanding Services and Service Injection</a></li>
                    </ul>
                </li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#other-developing-topics" aria-expanded="false" aria-controls="other-developing-topics">Other Topics</a>
                    <ul id="other-developing-topics">
                        <li><a href="../userguide/working_with_files.html">Working with Files</a></li>
                        <li><a href="../userguide/init_scripts.html">Initialization Scripts</a></li>
                        <li><a href="../userguide/dataflow_actions.html">Dataflow Actions</a></li>
                        <li><a href="../userguide/test_kit.html">Testing with TestKit</a></li>
                        <li><a href="../userguide/ant.html">Using Ant from Gradle</a></li>
                    </ul>
                </li>
                <li><a href="../userguide/directory_layout.html">Gradle-managed Directories</a></li>
                <li><a href="../userguide/build_environment.html">Configuring the Build Environment</a></li>
                <li><a href="../userguide/logging.html">Logging with Gradle</a></li>
            </ul>

            <h3 id="authoring-gradle-builds-java">Authoring JVM Builds</h3>
            <ul>
                <li><a href="../userguide/building_java_projects.html">Building Java &amp; JVM projects</a></li>
                <li><a href="../userguide/java_testing.html">Testing Java &amp; JVM projects</a></li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#java-toolchains" aria-expanded="false" aria-controls="java-toolchains">Java Toolchains</a>
                    <ul id="java-toolchains">
                        <li><a href="../userguide/toolchains.html">Toolchains for JVM projects</a></li>
                        <li><a href="../userguide/toolchain_plugins.html">Toolchain Resolver Plugins</a></li>
                    </ul>
                </li>
                <li><a href="../userguide/dependency_management_for_java_projects.html">Managing Dependencies</a></li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#jvm-plugins" aria-expanded="false" aria-controls="jvm-plugins">JVM Plugins</a>
                    <ul id="jvm-plugins">
                        <li><a href="../userguide/java_library_plugin.html">Java Library Plugin</a></li>
                        <li><a href="../userguide/application_plugin.html">Java Application Plugin</a></li>
                        <li><a href="../userguide/java_platform_plugin.html">Java Platform Plugin</a></li>
                        <li><a href="../userguide/groovy_plugin.html">Groovy Plugin</a></li>
                        <li><a href="../userguide/scala_plugin.html">Scala Plugin</a></li>
                    </ul>
                </li>
            </ul>

            <h3 id="managing-dependencies">Working with Dependencies</h3>
            <ul>
                <li><a href="../userguide/dependency_management_terminology.html">Terminology</a></li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#learning-the-basics-dependency-management" aria-expanded="false" aria-controls="learning-the-basics-dependency-management">Learning the Basics</a>
                    <ul id="learning-the-basics-dependency-management">
                        <li><a href="../userguide/core_dependency_management.html">What is Dependency Management?</a></li>
                        <li><a href="../userguide/declaring_repositories.html">Declaring Repositories</a></li>
                        <li><a href="../userguide/declaring_dependencies.html">Declaring Dependencies</a></li>
                        <li><a href="../userguide/library_vs_application.html">Understanding Library and Application Differences</a></li>
                        <li><a href="../userguide/viewing_debugging_dependencies.html">Viewing and Debugging Dependencies</a></li>
                        <li><a href="../userguide/dependency_resolution.html">Understanding Resolution</a></li>
                        <li><a href="../userguide/dependency_verification.html">Verifying dependencies</a></li>
                    </ul>
                </li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#declaring-dependency-versions" aria-expanded="false" aria-controls="declaring-dependency-versions">Declaring Versions</a>
                    <ul id="declaring-dependency-versions">
                        <li><a href="../userguide/single_versions.html">Declaring Versions and Ranges</a></li>
                        <li><a href="../userguide/rich_versions.html">Declaring Rich Versions</a></li>
                        <li><a href="../userguide/dynamic_versions.html">Handling Changing Versions</a></li>
                        <li><a href="../userguide/dependency_locking.html">Locking Versions</a></li>
                    </ul>
                </li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#controlling-transitive-dependencies" aria-expanded="false" aria-controls="controlling-transitive-dependencies">Controlling Transitives</a>
                    <ul id="controlling-transitive-dependencies">
                        <li><a href="../userguide/dependency_constraints.html">Upgrading Versions</a></li>
                        <li><a href="../userguide/dependency_downgrade_and_exclude.html">Downgrading and Excluding</a></li>
                        <li><a href="../userguide/platforms.html">Sharing Versions</a></li>
                        <li><a href="../userguide/dependency_version_alignment.html">Aligning Dependencies</a></li>
                        <li><a href="../userguide/dependency_capability_conflict.html">Handling Mutually Exclusive Dependencies</a></li>
                        <li><a href="../userguide/component_metadata_rules.html">Fixing Metadata</a></li>
                        <li><a href="../userguide/resolution_rules.html">Customizing Resolution</a></li>
                        <li><a href="../userguide/resolution_strategy_tuning.html">Preventing accidental upgrades</a></li>
                    </ul>
                </li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#modeling-features" aria-expanded="false" aria-controls="modeling-features">Producing and Consuming Variants of Libraries</a>
                    <ul id="modeling-features">
                        <li><a href="../userguide/component_capabilities.html">Declaring Capabilities of a Library</a></li>
                        <li><a href="../userguide/feature_variants.html">Modeling Feature Variants and Optional Dependencies</a></li>
                        <li><a href="../userguide/variant_model.html">Understanding Variant Selection</a></li>
                        <li><a href="../userguide/variant_attributes.html">Declaring Variant Attributes</a></li>
                        <li><a href="../userguide/cross_project_publications.html">Sharing Outputs of Projects</a></li>
                        <li><a href="../userguide/artifact_transforms.html">Transforming Artifacts</a></li>
                    </ul>
                </li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#publishing" aria-expanded="false" aria-controls="publishing">Publishing Libraries</a>
                    <ul id="publishing">
                        <li><a href="../userguide/publishing_setup.html">Setting up Publishing</a></li>
                        <li><a href="../userguide/publishing_gradle_module_metadata.html">Understanding Gradle Module Metadata</a></li>
                        <li><a href="../userguide/publishing_signing.html">Signing Artifacts</a></li>
                        <li><a href="../userguide/publishing_customization.html">Customizing Publishing</a></li>
                        <li><a href="../userguide/publishing_maven.html">Maven Publish Plugin</a></li>
                        <li><a href="../userguide/publishing_ivy.html">Ivy Publish Plugin</a></li>
                    </ul>
                </li>
            </ul>

            <h3 id="optimizing-build-performance">Optimizing Build Performance</h3>
            <ul>
                <li><a href="../userguide/performance.html">Improving Performance of Gradle Builds</a></li>
                <li><a href="../userguide/gradle_daemon.html">Gradle Daemon</a></li>
                <li><a href="../userguide/file_system_watching.html">File System Watching</a></li>
                <li><a href="../userguide/incremental_build.html">Incremental Build</a></li>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#build-cache" aria-expanded="false" aria-controls="optimizing-build-performance">Using the Build Cache</a>
                    <ul id="build-cache">
                        <li><a href="../userguide/build_cache.html">Enabling and Configuring</a></li>
                        <li><a href="../userguide/build_cache_use_cases.html">Why use the Build Cache?</a></li>
                        <li><a href="../userguide/build_cache_performance.html">Understanding the Impact</a></li>
                        <li><a href="../userguide/build_cache_concepts.html">Learning Basic Concepts</a></li>
                        <li><a href="../userguide/caching_java_projects.html">Caching Java Project</a></li>
                        <li><a href="../userguide/caching_android_projects.html">Caching Android Project</a></li>
                        <li><a href="../userguide/build_cache_debugging.html">Debugging Caching Issues</a></li>
                        <li><a href="../userguide/common_caching_problems.html">Troubleshooting</a></li>
                    </ul>
                </li>
                <li><a href="../userguide/configuration_cache.html">Using the Configuration Cache</a></li>
                <li><a href="../userguide/inspect.html">Inspecting Gradle Builds</a></li>
                <li><a href="../userguide/config_gradle.html">Configuring Gradle</a></li>
                <li><a href="../userguide/project_properties.html">Project Properties</a></li>
                <li><a href="../userguide/networking.html">Gradle Networking</a></li>
            </ul>

            <h3 id="authoring-gradle-builds-native">Authoring C++/Swift Builds</h3>
            <ul>
                <li><a href="../userguide/building_cpp_projects.html">Building C++ projects</a></li>
                <li><a href="../userguide/cpp_testing.html">Testing C++ projects</a></li>
                <li><a href="../userguide/building_swift_projects.html">Building Swift projects</a></li>
                <li><a href="../userguide/swift_testing.html">Testing Swift projects</a></li>
            </ul>

            <h3 id="reference">Reference</h3>
            <ul>
                <li><a class="nav-dropdown" data-toggle="collapse" href="#gradle-api" aria-expanded="false" aria-controls="gradle-api">Gradle DSLs and API</a>
                    <ul id="gradle-api">
                        <li><a href="../javadoc/index.html?overview-summary.html">Javadoc</a></li>
                        <li><a href="../userguide/groovy_build_script_primer.html">Groovy DSL Primer</a></li>
                        <li><a href="../dsl/index.html">Groovy DSL Reference</a></li>
                        <li><a href="../userguide/kotlin_dsl.html">Kotlin DSL Primer</a></li>
                        <li><a href="../kotlin-dsl/index.html" target="_blank">Kotlin DSL API</a></li>
                        <li><a href="../userguide/migrating_from_groovy_to_kotlin_dsl.html">Groovy to Kotlin DSL Migration</a></li>
                        <li><a href="../samples/index.html">Samples</a></li>
                    </ul>
                </li>
                <li><a href="https://community.gradle.org/cookbook/">Gradle Cookbook</a></li>
                <li><a href="../userguide/command_line_interface.html">Command-Line Interface</a></li>
                <li><a href="../userguide/gradle_wrapper.html">Gradle Wrapper</a></li>
                <li><a href="../userguide/plugin_reference.html">Core Plugins</a></li>
                <li id="third-party-integration"><a href="../userguide/third_party_integration.html">Gradle &amp; Third-party Tools</a></li>
                <li><a href="../userguide/userguide_single.html">User Manual Single Page</a></li>
                <li><a href="../userguide/userguide.pdf">User Manual PDF</a></li>
            </ul>
        </nav>
        <!-- End Primary Navigation -->

        <div class="content">
            <div class="chapter">
<div id="header">
<h1>Gradle User Manual: Version 8.9</h1>
<div class="details">
<span id="revnumber">version 8.9</span>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#part:about_gradle"><strong>OVERVIEW</strong></a>
<ul class="sectlevel2">
<li><a href="#what_is_gradle">Gradle User Manual</a></li>
<li><a href="#about_manual">The User Manual</a></li>
</ul>
</li>
<li><a href="#part:releases"><strong>RELEASES</strong></a>
<ul class="sectlevel2">
<li><a href="#installation">Installing Gradle</a></li>
<li><a href="#compatibility">Compatibility Matrix</a></li>
<li><a href="#feature_lifecycle">The Feature Lifecycle</a></li>
</ul>
</li>
<li><a href="#part:running_builds"><strong>RUNNING GRADLE BUILDS</strong></a></li>
<li><a href="#core_concepts">CORE CONCEPTS</a>
<ul class="sectlevel2">
<li><a href="#gradle">Gradle Basics</a></li>
<li><a href="#gradle_wrapper_basics">Gradle Wrapper Basics</a></li>
<li><a href="#command_line_interface_basics">Command-Line Interface Basics</a></li>
<li><a href="#settings_file_basics">Settings File Basics</a></li>
<li><a href="#build_file_basics">Build File Basics</a></li>
<li><a href="#dependency_management_basics">Dependency Management Basics</a></li>
<li><a href="#task_basics">Task Basics</a></li>
<li><a href="#plugin_basics">Plugin Basics</a></li>
<li><a href="#gradle_optimizations">Gradle Incremental Builds and Build Caching</a></li>
<li><a href="#build_scans">Build Scans</a></li>
</ul>
</li>
<li><a href="#other_topics">OTHER TOPICS</a>
<ul class="sectlevel2">
<li><a href="#continuous_builds">Continuous Builds</a></li>
</ul>
</li>
<li><a href="#part:authoring_builds"><strong>AUTHORING GRADLE BUILDS</strong></a></li>
<li><a href="#the_basics">THE BASICS</a>
<ul class="sectlevel2">
<li><a href="#gradle_directories">Gradle Directories</a></li>
<li><a href="#intro_multi_project_builds">Multi-Project Build Basics</a></li>
<li><a href="#build_lifecycle">Build Lifecycle</a></li>
<li><a href="#writing_settings_files">Writing Settings Files</a></li>
<li><a href="#writing_build_scripts">Writing Build Scripts</a></li>
<li><a href="#tutorial_using_tasks">Using Tasks</a></li>
<li><a href="#writing_tasks">Writing Tasks</a></li>
<li><a href="#using_plugins">Using Plugins</a></li>
<li><a href="#writing_plugins">Writing Plugins</a></li>
</ul>
</li>
<li><a href="#structuring_builds">STRUCTURING BUILDS</a>
<ul class="sectlevel2">
<li><a href="#multi_project_builds">Structuring Projects with Gradle</a></li>
<li><a href="#declaring_dependencies_between_subprojects">Declaring Dependencies between Subprojects</a></li>
<li><a href="#sharing_build_logic_between_subprojects">Sharing Build Logic between Subprojects</a></li>
<li><a href="#composite_builds">Composite Builds</a></li>
<li><a href="#configuration_and_execution">Configuration On Demand</a></li>
</ul>
</li>
<li><a href="#developing_tasks">DEVELOPING TASKS</a>
<ul class="sectlevel2">
<li><a href="#more_about_tasks">Understanding Tasks</a></li>
</ul>
</li>
<li><a href="#lazy_configuration">Configuring Tasks Lazily</a>
<ul class="sectlevel1">
<li><a href="#lazy_properties">Understanding Lazy properties</a></li>
<li><a href="#creating_property_provider">Creating a Property or Provider instance</a></li>
<li><a href="#connecting_properties_together">Connecting properties together</a></li>
<li><a href="#working_with_files_in_lazy_properties">Working with files</a></li>
<li><a href="#working_with_task_dependencies_in_lazy_properties">Working with task inputs and outputs</a></li>
<li><a href="#working_with_collections">Working with collections</a></li>
<li><a href="#working_with_maps">Working with maps</a></li>
<li><a href="#applying_conventions">Applying a convention to a property</a>
<ul class="sectlevel2">
<li><a href="#where_to_apply_conventions_from">Where to apply conventions from?</a></li>
</ul>
</li>
<li><a href="#unmodifiable_property">Making a property unmodifiable</a></li>
<li><a href="#lazy_configuration_faqs">Using the Provider API</a>
<ul class="sectlevel2">
<li><a href="#lazy_configuration_reference">Provider Files API Reference</a></li>
<li><a href="#property_files_api_reference">Property Files API Reference</a></li>
<li><a href="#lazy_collections_api_reference">Lazy Collections API Reference</a></li>
<li><a href="#lazy_objects_api_reference">Lazy Objects API Reference</a></li>
<li><a href="#tasks_parallel_worker">Developing Parallel Tasks</a></li>
<li><a href="#custom_tasks">Advanced Tasks</a></li>
</ul>
</li>
<li><a href="#developing_plugins">DEVELOPING PLUGINS</a>
<ul class="sectlevel2">
<li><a href="#custom_plugins">Understanding Plugins</a></li>
<li><a href="#implemention_plugins">Understanding Implementation Options for Plugins</a></li>
<li><a href="#implemention_precompiled_plugins">Implementing Pre-compiled Script Plugins</a></li>
<li><a href="#implemention_binary_plugins">Implementing Binary Plugins</a></li>
<li><a href="#testing_gradle_plugins">Testing Gradle plugins</a></li>
<li><a href="#publishing_portal">Publishing Plugins to the Gradle Plugin Portal</a></li>
</ul>
</li>
<li><a href="#other_topics_2">OTHER TOPICS</a>
<ul class="sectlevel2">
<li><a href="#directory_layout">Gradle-managed Directories</a></li>
<li><a href="#working_with_files">Working With Files</a></li>
<li><a href="#logging">Logging</a></li>
<li><a href="#build_environment">Configuring the Build Environment</a></li>
<li><a href="#init_scripts">Initialization Scripts</a></li>
<li><a href="#build_services">Using Shared Build Services</a></li>
<li><a href="#dataflow_action">Dataflow Actions</a></li>
<li><a href="#test_kit">Testing Build Logic with TestKit</a></li>
<li><a href="#ant">Using Ant from Gradle</a></li>
</ul>
</li>
<li><a href="#part:jvm_projects"><strong>AUTHORING JVM BUILDS</strong></a>
<ul class="sectlevel2">
<li><a href="#building_java_projects">Building Java &amp; JVM projects</a></li>
<li><a href="#java_testing">Testing in Java &amp; JVM projects</a></li>
<li><a href="#dependency_management_for_java_projects">Managing Dependencies of JVM Projects</a></li>
</ul>
</li>
<li><a href="#java_toolchains">JAVA TOOLCHAINS</a>
<ul class="sectlevel2">
<li><a href="#toolchains">Toolchains for JVM projects</a></li>
<li><a href="#toolchain_plugins">Toolchain Resolver Plugins</a></li>
</ul>
</li>
<li><a href="#jvm_plugins">JVM PLUGINS</a>
<ul class="sectlevel2">
<li><a href="#java_library_plugin">The Java Library Plugin</a></li>
<li><a href="#application_plugin">The Application Plugin</a></li>
<li><a href="#java_platform_plugin">The Java Platform Plugin</a></li>
<li><a href="#groovy_plugin">The Groovy Plugin</a></li>
<li><a href="#scala_plugin">The Scala Plugin</a></li>
</ul>
</li>
<li><a href="#part:dependency_management"><strong>WORKING WITH DEPENDENCIES</strong></a>
<ul class="sectlevel2">
<li><a href="#dependency_management_terminology">Dependency Management Terminology</a></li>
</ul>
</li>
<li><a href="#the_basics_2">THE BASICS</a>
<ul class="sectlevel2">
<li><a href="#dependency_management_in_gradle">Dependency Management</a></li>
<li><a href="#declaring-repositories">Declaring repositories</a></li>
<li><a href="#declaring-dependencies">Declaring dependencies</a></li>
<li><a href="#sec:understanding-diff-libraries-and-apps">Understanding the difference between libraries and applications</a></li>
<li><a href="#sec:debugging-build-scans">View and Debug Dependencies</a></li>
<li><a href="#understanding_dependency_resolution">Understanding dependency resolution</a></li>
<li><a href="#verifying-dependencies">Verifying dependencies</a></li>
</ul>
</li>
<li><a href="#declaring_versions">DECLARING VERSIONS</a>
<ul class="sectlevel2">
<li><a href="#single-version-declarations">Declaring Versions and Ranges</a></li>
<li><a href="#rich-version-constraints">Declaring Rich Versions</a></li>
<li><a href="#sec:dynamic_versions_and_changing_modules">Handling versions which change over time</a></li>
<li><a href="#dependency-locking">Locking dependency versions</a></li>
</ul>
</li>
<li><a href="#controlling_transitives">CONTROLLING TRANSITIVES</a>
<ul class="sectlevel2">
<li><a href="#dependency-constraints">Upgrading versions of transitive dependencies</a></li>
<li><a href="#downgrading_versions_and_excluding_dependencies">Downgrading versions and excluding dependencies</a></li>
<li><a href="#sec:sharing-dep-versions-between-projects">Sharing dependency versions between projects</a></li>
<li><a href="#version_alignment">Aligning dependency versions</a></li>
<li><a href="#sec:handling-mutually-exclusive-deps">Handling mutually exclusive dependencies</a></li>
<li><a href="#sec:component_metadata_rules">Fixing metadata with component metadata rules</a></li>
<li><a href="#resolution_rules">Customizing resolution of a dependency directly</a></li>
<li><a href="#resolution-strategy-safety-nets">Preventing accidental dependency upgrades</a></li>
</ul>
</li>
<li><a href="#producing_and_consuming_variants_of_libraries">PRODUCING AND CONSUMING VARIANTS OF LIBRARIES</a>
<ul class="sectlevel2">
<li><a href="#declaring-component-capabilities">Declaring Capabilities of a Library</a></li>
<li><a href="#feature_variants">Modeling library features</a></li>
<li><a href="#understanding-variant-selection">Understanding variant selection</a></li>
<li><a href="#variant_attributes">Working with Variant Attributes</a></li>
<li><a href="#cross_project_publications">Sharing outputs between projects</a></li>
<li><a href="#sec:abm_artifact_transforms">Transforming dependency artifacts on resolution</a></li>
</ul>
</li>
<li><a href="#publishing_libraries">PUBLISHING LIBRARIES</a>
<ul class="sectlevel2">
<li><a href="#publishing_components">Publishing a project as module</a></li>
<li><a href="#sec:understanding-gradle-module-md">Understanding Gradle Module Metadata</a></li>
<li><a href="#publishing_maven:signing">Signing artifacts</a></li>
<li><a href="#customizing_publishing">Customizing publishing</a></li>
<li><a href="#publishing_maven">The Maven Publish Plugin</a></li>
<li><a href="#publishing_ivy">The Ivy Publish Plugin</a></li>
</ul>
</li>
<li><a href="#part:optimizing_build_times"><strong>OPTIMIZING BUILD PERFORMANCE</strong></a>
<ul class="sectlevel2">
<li><a href="#performance_gradle">Improve the Performance of Gradle Builds</a></li>
<li><a href="#gradle_daemon">Gradle Daemon</a></li>
<li><a href="#sec:daemon_watch_fs">File System Watching</a></li>
<li><a href="#incremental_build">Incremental build</a></li>
<li><a href="#config_cache">Configuration cache</a></li>
<li><a href="#inspecting_build_scans">Inspecting Gradle Builds</a></li>
</ul>
</li>
<li><a href="#using_the_build_cache">USING THE BUILD CACHE</a>
<ul class="sectlevel2">
<li><a href="#build_cache">Build Cache</a></li>
<li><a href="#use_cases_cache">Use cases for the build cache</a></li>
<li><a href="#build_cache_performance">Build cache performance</a></li>
<li><a href="#important_concepts">Important concepts</a></li>
<li><a href="#caching_java_projects">Caching Java projects</a></li>
<li><a href="#caching_android_projects">Caching Android projects</a></li>
<li><a href="#debugging_and_diagnosing_cache_misses">Debugging and diagnosing cache misses</a></li>
<li><a href="#common-problems">Solving common problems</a></li>
</ul>
</li>
<li><a href="#part:reference"><strong>REFERENCE</strong></a>
<ul class="sectlevel2">
<li><a href="#command_line_interface">Command-Line Interface Reference</a></li>
<li><a href="#gradle_wrapper_reference">Gradle Wrapper Reference</a></li>
<li><a href="#plugin_reference">Gradle Plugin Reference</a></li>
<li><a href="#third_party_integration">Gradle &amp; Third-party Tools</a></li>
</ul>
</li>
<li><a href="#gradle_dsls_and_api">GRADLE DSLs and API</a>
<ul class="sectlevel2">
<li><a href="#groovy_build_script_primer">A Groovy Build Script Primer</a></li>
<li><a href="#kotlin_dsl">Gradle Kotlin DSL Primer</a></li>
</ul>
</li>
<li><a href="#license_information"><strong>LICENSE INFORMATION</strong></a>
<ul class="sectlevel2">
<li><a href="#license">License Information</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:about_gradle"><a class="anchor" href="#part:about_gradle"></a><a class="link" href="#part:about_gradle"><strong>OVERVIEW</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="what_is_gradle"><a class="anchor" href="#what_is_gradle"></a><a class="link" href="#what_is_gradle">Gradle User Manual</a></h3>
<div class="sect3">
<h4 id="gradle_overview"><a class="anchor" href="#gradle_overview"></a><a class="link" href="#gradle_overview">Gradle Build Tool</a></h4>
<div class="paragraph">
<p><span class="image left"><img src="img/gradle.png" alt="gradle"></span> Gradle Build Tool is a fast, dependable, and adaptable open-source <a href="https://en.wikipedia.org/wiki/Build_automation">build automation</a> tool with an elegant and extensible declarative build language.</p>
</div>
<div class="paragraph">
<p>In this User Manual, Gradle Build Tool is abbreviated <strong>Gradle</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="why_gradle"><a class="anchor" href="#why_gradle"></a><a class="link" href="#why_gradle">Why Gradle?</a></h4>
<div class="paragraph">
<p>Gradle is a widely used and mature tool with an active community and a strong developer ecosystem.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle is the most popular build system for the JVM and is the default system for Android and Kotlin Multi-Platform projects.
It has a rich community plugin ecosystem.</p>
</li>
<li>
<p>Gradle can automate a wide range of software build scenarios using either its built-in functionality, third-party plugins, or custom build logic.</p>
</li>
<li>
<p>Gradle provides a high-level, declarative, and expressive build language that makes it easy to read and write build logic.</p>
</li>
<li>
<p>Gradle is fast, scalable, and can build projects of any size and complexity.</p>
</li>
<li>
<p>Gradle produces dependable results while benefiting from optimizations such as incremental builds, build caching, and parallel execution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle, Inc. provides a free service called <a href="https://scans.gradle.com/">Build Scan®</a> that provides extensive information and insights about your builds.
You can view scans to identify problems or share them for debugging help.</p>
</div>
<div class="sect4">
<h5 id="supported_languages_and_frameworks"><a class="anchor" href="#supported_languages_and_frameworks"></a><a class="link" href="#supported_languages_and_frameworks">Supported Languages and Frameworks</a></h5>
<div class="paragraph">
<p>Gradle supports Android, Java, Kotlin Multiplatform, Groovy, Scala, Javascript, and C/C++.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/userguide-languages.png" alt="userguide languages">
</div>
</div>
</div>
<div class="sect4">
<h5 id="compatible_ides"><a class="anchor" href="#compatible_ides"></a><a class="link" href="#compatible_ides">Compatible IDEs</a></h5>
<div class="paragraph">
<p>All major IDEs support Gradle, including Android Studio, IntelliJ IDEA, Visual Studio Code, Eclipse, and NetBeans.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/userguide-ides.png" alt="userguide ides">
</div>
</div>
<div class="paragraph">
<p>You can also invoke Gradle via its <a href="#command_line_interface">command-line interface</a> (CLI) in your terminal or through your continuous integration (CI) server.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="education"><a class="anchor" href="#education"></a><a class="link" href="#education">Education</a></h4>
<div class="paragraph">
<p>The <strong><a href="#about_manual">Gradle User Manual</a></strong> is the official documentation for the Gradle Build Tool.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Getting Started Tutorial</strong> — <a href="getting_started_eng.html#introduction">Learn Gradle basics</a> and the benefits of building your App with Gradle.</p>
</li>
<li>
<p><strong>Training Courses</strong> — Head over to the <a href="https://gradle.org/courses/">courses page</a> to sign up for free Gradle training.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="support"><a class="anchor" href="#support"></a><a class="link" href="#support">Support</a></h4>
<div class="ulist">
<ul>
<li>
<p><strong>Forum</strong> — The fastest way to get help is through the <a href="https://discuss.gradle.org/">Gradle Forum</a>.</p>
</li>
<li>
<p><strong>Slack</strong> — Community members and core contributors answer questions directly on our <a href="https://gradle-community.slack.com/">Slack Channel</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="licenses"><a class="anchor" href="#licenses"></a><a class="link" href="#licenses">Licenses</a></h4>
<div class="paragraph legalnotice">
<p>Gradle Build Tool source code is open and licensed under the <a href="https://github.com/gradle/gradle/blob/master/LICENSE">Apache License 2.0</a>.
Gradle user manual and DSL reference manual are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="about_manual"><a class="anchor" href="#about_manual"></a><a class="link" href="#about_manual">The User Manual</a></h3>
<div class="paragraph">
<p>Explore our guides and examples to use Gradle.</p>
</div>
<div class="sect3">
<h4 id="releases"><a class="anchor" href="#releases"></a><a class="link" href="#releases">Releases</a></h4>
<div class="paragraph">
<p>Information on Gradle releases and how to install Gradle is found on the <a href="#installation">Installation page</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="content"><a class="anchor" href="#content"></a><a class="link" href="#content">Content</a></h4>
<div class="paragraph">
<p>The Gradle User Manual is broken down into the following sections:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="getting_started_eng.html#introduction">Running Gradle Builds</a> </dt>
<dd>
<p>Learn Gradle basics and how to use Gradle to build your project.</p>
</dd>
<dt class="hdlist1"><a href="#build_lifecycle">Authoring Gradle Builds</a> </dt>
<dd>
<p>Develop tasks and plugins to customize your build.</p>
</dd>
<dt class="hdlist1"><a href="#building_java_projects">Authoring JVM Builds</a> </dt>
<dd>
<p>Use Gradle with your Java project.</p>
</dd>
<dt class="hdlist1"><a href="#dependency_management_terminology">Working with Dependencies</a> </dt>
<dd>
<p>Add dependencies to your build.</p>
</dd>
<dt class="hdlist1"><a href="#performance_gradle">Optimizing Builds</a> </dt>
<dd>
<p>Use caches to optimize your build and understand the Gradle daemon, incremental builds and file system watching.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="reference"><a class="anchor" href="#reference"></a><a class="link" href="#reference">Reference</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Gradle&#8217;s API <a href="https://docs.gradle.org/8.9/javadoc/index.html" target="_blank" rel="noopener">Javadocs</a></p>
</li>
<li>
<p>Gradle&#8217;s <a href="https://docs.gradle.org/8.9/dsl/index.html" target="_blank" rel="noopener">Groovy DSL</a></p>
</li>
<li>
<p>Gradle&#8217;s <a href="https://docs.gradle.org/8.9/kotlin-dsl/index.html" target="_blank" rel="noopener">Kotlin DSL</a></p>
</li>
<li>
<p>Gradle&#8217;s <a href="#plugin_reference">Core Plugins</a></p>
</li>
</ol>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:releases"><a class="anchor" href="#part:releases"></a><a class="link" href="#part:releases"><strong>RELEASES</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="installation"><a class="anchor" href="#installation"></a><a class="link" href="#installation">Installing Gradle</a></h3>
<div class="sect3">
<h4 id="gs:installation"><a class="anchor" href="#gs:installation"></a><a class="link" href="#gs:installation">Gradle Installation</a></h4>
<div class="paragraph">
<p>If all you want to do is run an existing Gradle project, then you don&#8217;t need to install Gradle if the build uses the <a href="#gradle_wrapper_reference">Gradle Wrapper</a>.
This is identifiable by the presence of the <code>gradlew</code> or <code>gradlew.bat</code> files in the root of the project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.   // <b class="conum">(1)</b>
├── gradle
│   └── wrapper // <b class="conum">(2)</b>
├── gradlew         // <b class="conum">(3)</b>
├── gradlew.bat     // <b class="conum">(3)</b>
└── ⋮</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Project root directory.</p>
</li>
<li>
<p><a href="#gradle_wrapper_reference">Gradle Wrapper</a>.</p>
</li>
<li>
<p>Scripts for executing Gradle builds.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the <code>gradlew</code> or <code>gradlew.bat</code> files are already present in your project, <strong>you do not need to install Gradle</strong>.
But you need to make sure your system <a href="#sec:prerequisites">satisfies Gradle&#8217;s prerequisites</a>.</p>
</div>
<div class="paragraph">
<p>You can follow the steps in the <a href="upgrading_version_8.html#upgrading_version_8">Upgrading Gradle section</a> if you want to update the Gradle version for your project.
Please use the <a href="#sec:upgrading_wrapper">Gradle Wrapper</a> to upgrade Gradle.</p>
</div>
<div class="paragraph">
<p>Android Studio comes with a working installation of Gradle, so you <strong>don&#8217;t need to install Gradle separately when only working within that IDE</strong>.</p>
</div>
<div class="paragraph">
<p>If you do not meet the criteria above and decide to install Gradle on your machine, first check if Gradle is already installed by running <code>gradle -v</code> in your terminal.
If the command does not return anything, then Gradle is not installed, and you can follow the instructions below.</p>
</div>
<div class="paragraph">
<p>You can install Gradle Build Tool on Linux, macOS, or Windows.
The installation can be done manually or using a package manager like <a href="https://sdkman.io/">SDKMAN!</a> or <a href="https://brew.sh/">Homebrew</a>.</p>
</div>
<div class="paragraph">
<p>You can find all Gradle releases and their checksums on the <a href="https://gradle.org/releases">releases page</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:prerequisites"><a class="anchor" href="#sec:prerequisites"></a><a class="link" href="#sec:prerequisites">Prerequisites</a></h4>
<div class="paragraph">
<p>Gradle runs on all major operating systems. It requires <a href="https://jdk.java.net/">Java Development Kit</a> (JDK) version 8 or higher to run. You can check the <a href="#compatibility">compatibility matrix</a> for more information.</p>
</div>
<div class="paragraph">
<p>To check, run <code>java -version</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ java -version
openjdk version "11.0.18" 2023-01-17
OpenJDK Runtime Environment Homebrew (build 11.0.18+0)
OpenJDK 64-Bit Server VM Homebrew (build 11.0.18+0, mixed mode)</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ java version "1.8.0_151"
Java(TM) SE Runtime Environment (build 1.8.0_151-b12)
Java HotSpot(TM) 64-Bit Server VM (build 25.151-b12, mixed mode)</pre>
</div>
</div>
<div class="paragraph">
<p>Gradle uses the JDK it finds in your path, the JDK used by your IDE, or the JDK specified by your project.
In this example, the $PATH points to JDK17:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ echo $PATH
/opt/homebrew/opt/openjdk@17/bin</pre>
</div>
</div>
<div class="paragraph">
<p>You can also set the <code>JAVA_HOME</code> environment variable to point to a specific JDK installation directory.
This is especially useful when multiple JDKs are installed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ echo %JAVA_HOME%
C:\Program Files\Java\jdk1.7.0_80</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ echo $JAVA_HOME
/Library/Java/JavaVirtualMachines/jdk-16.jdk/Contents/Home</pre>
</div>
</div>
<div class="paragraph">
<p>Gradle supports <a href="https://kotlinlang.org/">Kotlin</a> and <a href="https://groovy-lang.org/">Groovy</a> as the main build languages.
Gradle ships with its own Kotlin and Groovy libraries, therefore they do not need to be installed.
Existing installations are ignored by Gradle.</p>
</div>
<div class="paragraph">
<p><a href="#compatibility">See the full compatibility notes for Java, Groovy, Kotlin, and Android.</a></p>
</div>
</div>
<div class="sect3">
<h4 id="linux_installation"><a class="anchor" href="#linux_installation"></a><a class="link" href="#linux_installation">Linux installation</a></h4>
<details id="ex-installing-with-a-package-manager">
<summary class="title"><a href="#ex-installing-with-a-package-manager">Installing with a package manager</a></summary>
<div class="content">
<div class="paragraph">
<p><a href="http://sdkman.io">SDKMAN!</a> is a tool for managing parallel versions of multiple Software Development Kits on most Unix-like systems (macOS, Linux, Cygwin, Solaris and FreeBSD).
Gradle is deployed and maintained by SDKMAN!:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ sdk install gradle</pre>
</div>
</div>
<div class="paragraph">
<p>Other package managers are available, but the version of Gradle distributed by them is not controlled by Gradle, Inc.
Linux package managers may distribute a modified version of Gradle that is incompatible or incomplete when compared to the official version.</p>
</div>
</div>
</details>
<details id="ex-installing-manually">
<summary class="title"><a href="#ex-installing-manually">Installing manually</a></summary>
<div class="content">
<div class="paragraph">
<p><strong>Step 1 - <a href="https://gradle.org/releases">Download</a> the latest Gradle distribution</strong></p>
</div>
<div class="paragraph">
<p>The distribution ZIP file comes in two flavors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Binary-only (bin)</p>
</li>
<li>
<p>Complete (all) with docs and sources</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We recommend downloading the bin file; it is a smaller file that is quick to download (and the latest documentation is available online).</p>
</div>
<div class="paragraph">
<p><strong>Step 2 - Unpack the distribution</strong></p>
</div>
<div class="paragraph">
<p>Unzip the distribution zip file in the directory of your choosing, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ mkdir /opt/gradle
❯ unzip -d /opt/gradle gradle-8.9-bin.zip
❯ ls /opt/gradle/gradle-8.9
LICENSE  NOTICE  bin  README  init.d  lib  media</pre>
</div>
</div>
<div id="sec:linux_macos_users_2" class="paragraph">
<p><strong>Step 3 - Configure your system environment</strong></p>
</div>
<div class="paragraph">
<p>To install Gradle, the path to the unpacked files needs to be in your Path.
Configure your <code>PATH</code> environment variable to include the <code>bin</code> directory of the unzipped distribution, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ export PATH=$PATH:/opt/gradle/gradle-8.9/bin</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you could also add the environment variable <code>GRADLE_HOME</code> and point this to the unzipped distribution.
Instead of adding a specific version of Gradle to your <code>PATH</code>, you can add <code>$GRADLE_HOME/bin</code> to your <code>PATH</code>.
When upgrading to a different version of Gradle, simply change the <code>GRADLE_HOME</code> environment variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>export GRADLE_HOME=/opt/gradle/gradle-8.9
export PATH=${GRADLE_HOME}/bin:${PATH}</pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="macos_installation"><a class="anchor" href="#macos_installation"></a><a class="link" href="#macos_installation">macOS installation</a></h4>
<details id="ex-installing-with-a-package-manager">
<summary class="title"><a href="#ex-installing-with-a-package-manager">Installing with a package manager</a></summary>
<div class="content">
<div class="paragraph">
<p><a href="http://sdkman.io">SDKMAN!</a> is a tool for managing parallel versions of multiple Software Development Kits on most Unix-like systems (macOS, Linux, Cygwin, Solaris and FreeBSD).
Gradle is deployed and maintained by SDKMAN!:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ sdk install gradle</pre>
</div>
</div>
<div class="paragraph">
<p>Using <a href="http://brew.sh">Homebrew</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ brew install gradle</pre>
</div>
</div>
<div class="paragraph">
<p>Using <a href="https://www.macports.org">MacPorts</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ sudo port install gradle</pre>
</div>
</div>
<div class="paragraph">
<p>Other package managers are available, but the version of Gradle distributed by them is not controlled by Gradle, Inc.</p>
</div>
</div>
</details>
<details id="ex-installing-manually">
<summary class="title"><a href="#ex-installing-manually">Installing manually</a></summary>
<div class="content">
<div class="paragraph">
<p><strong>Step 1 - <a href="https://gradle.org/releases">Download</a> the latest Gradle distribution</strong></p>
</div>
<div class="paragraph">
<p>The distribution ZIP file comes in two flavors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Binary-only (bin)</p>
</li>
<li>
<p>Complete (all) with docs and sources</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We recommend downloading the bin file; it is a smaller file that is quick to download (and the latest documentation is available online).</p>
</div>
<div class="paragraph">
<p><strong>Step 2 - Unpack the distribution</strong></p>
</div>
<div class="paragraph">
<p>Unzip the distribution zip file in the directory of your choosing, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ mkdir /usr/local/gradle
❯ unzip gradle-8.9-bin.zip -d /usr/local/gradle
❯ ls /usr/local/gradle/gradle-8.9
LICENSE	NOTICE	README	bin	init.d	lib</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Step 3 - Configure your system environment</strong></p>
</div>
<div class="paragraph">
<p>To install Gradle, the path to the unpacked files needs to be in your Path.
Configure your <code>PATH</code> environment variable to include the <code>bin</code> directory of the unzipped distribution, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ export PATH=$PATH:/usr/local/gradle/gradle-8.9/bin</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you could also add the environment variable <code>GRADLE_HOME</code> and point this to the unzipped distribution.
Instead of adding a specific version of Gradle to your <code>PATH</code>, you can add <code>$GRADLE_HOME/bin</code> to your <code>PATH</code>.
When upgrading to a different version of Gradle, simply change the <code>GRADLE_HOME</code> environment variable.</p>
</div>
<div class="paragraph">
<p>It&#8217;s a good idea to edit <code>.bash_profile</code> in your home directory to add <code>GRADLE_HOME</code> variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>export GRADLE_HOME=/usr/local/gradle/gradle-8.9
export PATH=$GRADLE_HOME/bin:$PATH</pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="windows_installation"><a class="anchor" href="#windows_installation"></a><a class="link" href="#windows_installation">Windows installation</a></h4>
<details id="ex-installing-manually">
<summary class="title"><a href="#ex-installing-manually">Installing manually</a></summary>
<div class="content">
<div class="paragraph">
<p><strong>Step 1 - <a href="https://gradle.org/releases">Download</a> the latest Gradle distribution</strong></p>
</div>
<div class="paragraph">
<p>The distribution ZIP file comes in two flavors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Binary-only (bin)</p>
</li>
<li>
<p>Complete (all) with docs and sources</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We recommend downloading the bin file.</p>
</div>
<div class="paragraph">
<p><strong>Step 2 - Unpack the distribution</strong></p>
</div>
<div class="paragraph">
<p>Create a new directory <code>C:\Gradle</code> with <strong>File Explorer</strong>.</p>
</div>
<div class="paragraph">
<p>Open a second <strong>File Explorer</strong> window and go to the directory where the Gradle distribution was downloaded. Double-click the ZIP archive to expose the content.
Drag the content folder <code>gradle-8.9</code> to your newly created <code>C:\Gradle</code> folder.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can unpack the Gradle distribution ZIP into <code>C:\Gradle</code> using the archiver tool of your choice.</p>
</div>
<div class="paragraph">
<p><strong>Step 3 - Configure your system environment</strong></p>
</div>
<div class="paragraph">
<p>To install Gradle, the path to the unpacked files needs to be in your Path.</p>
</div>
<div class="paragraph">
<p>In <strong>File Explorer</strong> right-click on the <code>This PC</code> (or <code>Computer</code>) icon, then click <code>Properties</code> &#8594; <code>Advanced System Settings</code> &#8594; <code>Environmental Variables</code>.</p>
</div>
<div class="paragraph">
<p>Under <code>System Variables</code> select <code>Path</code>, then click <code>Edit</code>.
Add an entry for <code>C:\Gradle\gradle-8.9\bin</code>.
Click <code>OK</code> to save.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can add the environment variable <code>GRADLE_HOME</code> and point this to the unzipped distribution.
Instead of adding a specific version of Gradle to your <code>Path</code>, you can add <code><em>%GRADLE_HOME%</em>\bin</code> to your <code>Path</code>.
When upgrading to a different version of Gradle, just change the <code>GRADLE_HOME</code> environment variable.</p>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="sec:running_and_testing_your_installation"><a class="anchor" href="#sec:running_and_testing_your_installation"></a><a class="link" href="#sec:running_and_testing_your_installation">Verify the installation</a></h4>
<div class="paragraph">
<p>Open a console (or a Windows command prompt) and run <code>gradle -v</code> to run gradle and display the version, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle -v

------------------------------------------------------------
Gradle 8.9
------------------------------------------------------------

Build time:    2024-06-17 18:10:00 UTC
Revision:      6028379bb5a8512d0b2c1be6403543b79825ef08

Kotlin:        1.9.23
Groovy:        3.0.21
Ant:           Apache Ant(TM) version 1.10.13 compiled on January 4 2023
Launcher JVM:  11.0.23 (Eclipse Adoptium 11.0.23+9)
Daemon JVM:    /Library/Java/JavaVirtualMachines/temurin-11.jdk/Contents/Home (no JDK specified, using current Java home)
OS:            Mac OS X 14.5 aarch64</pre>
</div>
</div>
<div class="paragraph">
<p>You can verify the integrity of the Gradle distribution by downloading the SHA-256 file (available from the <a href="https://gradle.org/releases">releases page</a>) and following these <a href="#sec:verification">verification instructions</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compatibility"><a class="anchor" href="#compatibility"></a><a class="link" href="#compatibility">Compatibility Matrix</a></h3>
<div class="paragraph">
<p>The sections below describe Gradle&#8217;s compatibility with several integrations.
Versions not listed here may or may not work.</p>
</div>
<div class="sect3">
<h4 id="java"><a class="anchor" href="#java"></a><a class="link" href="#java">Java</a></h4>
<div class="paragraph">
<p>A Java version between 8 and 22 is required to execute Gradle.
Java 23 and later versions are not yet supported.</p>
</div>
<div class="paragraph">
<p>Java 6 and 7 can be used for <a href="#sec:java_cross_compilation">compilation</a> but are deprecated for use with testing. Testing with Java 6 and 7 will not be supported in Gradle 9.0.</p>
</div>
<div class="paragraph">
<p>Any fully supported version of Java can be used for compilation or testing.
However, the latest Java version may only be supported for compilation or testing, not for running Gradle.
Support is achieved using <a href="#toolchains">toolchains</a> and applies to all tasks supporting toolchains.</p>
</div>
<div class="paragraph">
<p>See the table below for the Java version supported by a specific Gradle release:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Java Compatibility</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Java version</th>
<th class="tableblock halign-left valign-top">Support for toolchains</th>
<th class="tableblock halign-left valign-top">Support for running Gradle</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="kotlin"><a class="anchor" href="#kotlin"></a><a class="link" href="#kotlin">Kotlin</a></h4>
<div class="paragraph">
<p>Gradle is tested with Kotlin 1.6.10 through 2.0.0.
Beta and RC versions may or may not work.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Embedded Kotlin version</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Embedded Kotlin version</th>
<th class="tableblock halign-left valign-top">Minimum Gradle version</th>
<th class="tableblock halign-left valign-top">Kotlin Language version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.61</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.70</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.71</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4.20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4.31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5.21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5.31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.6.21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.7.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8.20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.9.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.9.20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.9.22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.9.23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="groovy"><a class="anchor" href="#groovy"></a><a class="link" href="#groovy">Groovy</a></h4>
<div class="paragraph">
<p>Gradle is tested with Groovy 1.5.8 through 4.0.0.</p>
</div>
<div class="paragraph">
<p>Gradle plugins written in Groovy must use Groovy 3.x for compatibility with Gradle and Groovy DSL build scripts.</p>
</div>
</div>
<div class="sect3">
<h4 id="android"><a class="anchor" href="#android"></a><a class="link" href="#android">Android</a></h4>
<div class="paragraph">
<p>Gradle is tested with Android Gradle Plugin 7.3 through 8.4.
Alpha and beta versions may or may not work.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="feature_lifecycle"><a class="anchor" href="#feature_lifecycle"></a><a class="link" href="#feature_lifecycle">The Feature Lifecycle</a></h3>
<div class="paragraph">
<p>Gradle is under constant development. New versions are delivered on a regular and frequent basis (approximately every six weeks) as described in <a href="#eol_support">the section on end-of-life support</a>.</p>
</div>
<div class="paragraph">
<p>Continuous improvement combined with frequent delivery allows new features to be available to users early.
Early users provide invaluable feedback, which is incorporated into the development process.</p>
</div>
<div class="paragraph">
<p>Getting new functionality into the hands of users regularly is a core value of the Gradle platform.</p>
</div>
<div class="paragraph">
<p>At the same time, API and feature stability are taken very seriously and considered a core value of the Gradle platform.
Design choices and automated testing are engineered into the development process and formalized by <a href="#backwards_compatibility">the section on backward compatibility</a>.</p>
</div>
<div class="paragraph">
<p>The Gradle <em>feature lifecycle</em> has been designed to meet these goals. It also communicates to users of Gradle what the state of a feature is.
The term <em>feature</em> typically means an API or DSL method or property in this context, but it is not restricted to this definition.
Command line arguments and modes of execution (e.g. the Build Daemon) are two examples of other features.</p>
</div>
<div class="sect3">
<h4 id="sec:states"><a class="anchor" href="#sec:states"></a><a class="link" href="#sec:states">Feature States</a></h4>
<div class="paragraph">
<p>Features can be in one of four states:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#sec:internal">Internal</a></p>
</li>
<li>
<p><a href="#sec:incubating_state">Incubating</a></p>
</li>
<li>
<p><a href="#sec:public">Public</a></p>
</li>
<li>
<p><a href="#sec:deprecated">Deprecated</a></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="sec:internal"><a class="anchor" href="#sec:internal"></a><a class="link" href="#sec:internal">1. Internal</a></h4>
<div class="paragraph">
<p><em>Internal</em> features are not designed for public use and are only intended to be used by Gradle itself. They can change in any way at any point in time without any notice.
Therefore, we recommend avoiding the use of such features.
<em>Internal</em> features are not documented.
If it appears in this User Manual, the DSL Reference, or the API Reference, then the feature is not <em>internal</em>.</p>
</div>
<div class="paragraph">
<p><em>Internal</em> features may evolve into public features.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:incubating_state"><a class="anchor" href="#sec:incubating_state"></a><a class="link" href="#sec:incubating_state">2. Incubating</a></h4>
<div class="paragraph">
<p>Features are introduced in the <em>incubating</em> state to allow real-world feedback to be incorporated into the feature before making it public.
It also gives users willing to test potential future changes early access.</p>
</div>
<div class="paragraph">
<p>A feature in an <em>incubating</em> state may change in future Gradle versions until it is no longer <em>incubating</em>.
Changes to <em>incubating</em> features for a Gradle release will be highlighted in the release notes for that release.
The <em>incubation</em> period for new features varies depending on the feature&#8217;s scope, complexity, and nature.</p>
</div>
<div class="paragraph">
<p>Features in <em>incubation</em> are indicated.
In the source code, all methods/properties/classes that are <em>incubating</em> are annotated with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Incubating.html">incubating</a>.
This results in a special mark for them in the DSL and API references.</p>
</div>
<div class="paragraph">
<p>If an <em>incubating</em> feature is discussed in this User Manual, it will be explicitly said to be in the <em>incubating</em> state.</p>
</div>
<div class="sect4">
<h5 id="feature_preview"><a class="anchor" href="#feature_preview"></a><a class="link" href="#feature_preview">Feature Preview API</a></h5>
<div class="paragraph">
<p>The feature preview API allows certain <em>incubating</em> features to be activated by adding <code>enableFeaturePreview('FEATURE')</code> in your <em>settings</em> file.
Individual preview features will be announced in release notes.</p>
</div>
<div class="paragraph">
<p>When <em>incubating</em> features are either promoted to <em>public</em> or removed, the feature preview flags for them become obsolete, have no effect, and should be removed from the settings file.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:public"><a class="anchor" href="#sec:public"></a><a class="link" href="#sec:public">3. Public</a></h4>
<div class="paragraph">
<p>The default state for a non-internal feature is <em>public</em>. Anything documented in the User Manual, DSL Reference, or API reference that is not explicitly said to be <em>incubating</em> or <em>deprecated</em> is considered <em>public</em>.
Features are said to be <strong>promoted</strong> from an <em>incubating</em> state to <em>public</em>.
The release notes for each release indicate which previously <em>incubating</em> features are being promoted by the release.</p>
</div>
<div class="paragraph">
<p>A <em>public</em> feature will <strong>never</strong> be removed or intentionally changed without undergoing <em>deprecation</em>.
All public features are subject to the backward compatibility policy.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:deprecated"><a class="anchor" href="#sec:deprecated"></a><a class="link" href="#sec:deprecated">4. Deprecated</a></h4>
<div class="paragraph">
<p>Some features may be replaced or become irrelevant due to the natural evolution of Gradle.
Such features will eventually be removed from Gradle after being <em>deprecated</em>.
A <em>deprecated</em> feature may become stale until it is finally removed according to the backward compatibility policy.</p>
</div>
<div class="paragraph">
<p><em>Deprecated</em> features are indicated to be so.
In the source code, all methods/properties/classes that are <em>deprecated</em> are annotated with &#8220;@java.lang.Deprecated&#8221; which is reflected in the DSL and API References.
In most cases, there is a replacement for the deprecated element, which will be described in the documentation.
Using a <em>deprecated</em> feature will result in a runtime warning in Gradle&#8217;s output.</p>
</div>
<div class="paragraph">
<p>The use of <em>deprecated</em> features should be avoided.
The release notes for each release indicate any features being <em>deprecated</em> by the release.</p>
</div>
</div>
<div class="sect3">
<h4 id="backwards_compatibility"><a class="anchor" href="#backwards_compatibility"></a><a class="link" href="#backwards_compatibility">Backward compatibility policy</a></h4>
<div class="paragraph">
<p>Gradle provides backward compatibility across major versions (e.g., <code>1.x</code>, <code>2.x</code>, etc.).
Once a public feature is introduced in a Gradle release, it will remain indefinitely unless deprecated.
Once deprecated, it may be removed in the next major release.
Deprecated features may be supported across major releases, but this is not guaranteed.</p>
</div>
</div>
<div class="sect3">
<h4 id="eol_support"><a class="anchor" href="#eol_support"></a><a class="link" href="#eol_support">Release end-of-life Policy</a></h4>
<div class="paragraph">
<p>Every day, a new nightly build of Gradle is created.</p>
</div>
<div class="paragraph">
<p>This contains all of the changes made through Gradle&#8217;s extensive continuous integration tests during that day.
Nightly builds may contain new changes that may or may not be stable.</p>
</div>
<div class="paragraph">
<p>The Gradle team creates a pre-release distribution called a release candidate (RC) for each minor or major release.
When no problems are found after a short time (usually a week), the release candidate is promoted to a general availability (GA) release.
If a regression is found in the release candidate, a new RC distribution is created, and the process repeats.
Release candidates are supported for as long as the release window is open, but they are not intended to be used for production.
Bug reports are greatly appreciated during the RC phase.</p>
</div>
<div class="paragraph">
<p>The Gradle team may create additional patch releases to replace the final release due to critical bug fixes or regressions.
For instance, Gradle 5.2.1 replaces the Gradle 5.2 release.</p>
</div>
<div class="paragraph">
<p>Once a release candidate has been made, all feature development moves on to the next release for the latest major version.
As such, each minor Gradle release causes the previous minor releases in the same major version to become end-of-life (EOL). EOL releases do not receive bug fixes or feature backports.</p>
</div>
<div class="paragraph">
<p>For major versions, Gradle will backport critical fixes and security fixes to the last minor in the previous major version.
For example, when Gradle 7 was the latest major version, several releases were made in the 6.x line, including Gradle 6.9 (and subsequent releases).</p>
</div>
<div class="paragraph">
<p>As such, each major Gradle release causes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The previous major version becomes maintenance only. It will only receive critical bug fixes and security fixes.</p>
</li>
<li>
<p>The major version before the previous one to become end-of-life (EOL), and that release line will not receive any new fixes.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:running_builds"><a class="anchor" href="#part:running_builds"></a><a class="link" href="#part:running_builds"><strong>RUNNING GRADLE BUILDS</strong></a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="core_concepts"><a class="anchor" href="#core_concepts"></a><a class="link" href="#core_concepts">CORE CONCEPTS</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="gradle"><a class="anchor" href="#gradle"></a><a class="link" href="#gradle">Gradle Basics</a></h3>
<div class="paragraph">
<p>Gradle <strong>automates building, testing, and deployment of software</strong> from information in <strong>build scripts</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-basic-1.png" alt="gradle basic 1">
</div>
</div>
<div class="sect3">
<h4 id="gradle_core_concepts"><a class="anchor" href="#gradle_core_concepts"></a><a class="link" href="#gradle_core_concepts">Gradle core concepts</a></h4>
<div class="sect4">
<h5 id="projects"><a class="anchor" href="#projects"></a><a class="link" href="#projects">Projects</a></h5>
<div class="paragraph">
<p>A Gradle <strong>project</strong> is a piece of software that can be built, such as an application or a library.</p>
</div>
<div class="paragraph">
<p><strong>Single project</strong> builds include a single project called the <strong>root project</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Multi-project</strong> builds include <strong>one root project</strong> and <strong>any number of subprojects</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="build_scripts"><a class="anchor" href="#build_scripts"></a><a class="link" href="#build_scripts">Build Scripts</a></h5>
<div class="paragraph">
<p><strong>Build scripts</strong> detail to Gradle what steps to take to build the project.</p>
</div>
<div class="paragraph">
<p>Each project can include one or more build scripts.</p>
</div>
</div>
<div class="sect4">
<h5 id="dependency_management"><a class="anchor" href="#dependency_management"></a><a class="link" href="#dependency_management">Dependency Management</a></h5>
<div class="paragraph">
<p><strong>Dependency management</strong> is an automated technique for declaring and resolving external resources required by a project.</p>
</div>
<div class="paragraph">
<p>Each project typically includes a number of external dependencies that Gradle will resolve during the build.</p>
</div>
</div>
<div class="sect4">
<h5 id="tasks"><a class="anchor" href="#tasks"></a><a class="link" href="#tasks">Tasks</a></h5>
<div class="paragraph">
<p><strong>Tasks are a basic unit of work</strong> such as compiling code or running your test.</p>
</div>
<div class="paragraph">
<p>Each project contains one or more tasks defined inside a build script or a plugin.</p>
</div>
</div>
<div class="sect4">
<h5 id="plugins"><a class="anchor" href="#plugins"></a><a class="link" href="#plugins">Plugins</a></h5>
<div class="paragraph">
<p>Plugins are used to <strong>extend Gradle&#8217;s capability</strong> and optionally contribute <strong>tasks</strong> to a project.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="gradle_project_structure"><a class="anchor" href="#gradle_project_structure"></a><a class="link" href="#gradle_project_structure">Gradle project structure</a></h4>
<div class="paragraph">
<p>Many developers will interact with Gradle for the first time through an existing project.</p>
</div>
<div class="paragraph">
<p>The presence of the <code>gradlew</code> and <code>gradlew.bat</code> files in the root directory of a project is a clear indicator that Gradle is used.</p>
</div>
<div class="paragraph">
<p>A Gradle project will look similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">project
├── gradle                              // <b class="conum">(1)</b>
│   ├── libs.versions.toml              // <b class="conum">(2)</b>
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew                             // <b class="conum">(3)</b>
├── gradlew.bat                         // <b class="conum">(3)</b>
├── settings.gradle(.kts)               // <b class="conum">(4)</b>
├── subproject-a
│   ├── build.gradle(.kts)              // <b class="conum">(5)</b>
│   └── src                             // <b class="conum">(6)</b>
└── subproject-b
    ├── build.gradle(.kts)              // <b class="conum">(5)</b>
    └── src                             // <b class="conum">(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Gradle directory to store wrapper files and more</p>
</li>
<li>
<p>Gradle version catalog for dependency management</p>
</li>
<li>
<p>Gradle wrapper scripts</p>
</li>
<li>
<p>Gradle settings file to define a root project name and subprojects</p>
</li>
<li>
<p>Gradle build scripts of the two subprojects - <code>subproject-a</code> and <code>subproject-b</code></p>
</li>
<li>
<p>Source code and/or additional files for the projects</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="invoking_gradle"><a class="anchor" href="#invoking_gradle"></a><a class="link" href="#invoking_gradle">Invoking Gradle</a></h4>
<div class="sect4">
<h5 id="ide"><a class="anchor" href="#ide"></a><a class="link" href="#ide">IDE</a></h5>
<div class="paragraph">
<p>Gradle is <a href="gradle_ides.html#gradle_ides">built-in to many IDEs</a> including Android Studio, IntelliJ IDEA, Visual Studio Code, Eclipse, and NetBeans.</p>
</div>
<div class="paragraph">
<p>Gradle can be automatically invoked when you build, clean, or run your app in the IDE.</p>
</div>
<div class="paragraph">
<p>It is recommended that you consult the manual for the IDE of your choice to learn more about how Gradle can be used and configured.</p>
</div>
</div>
<div class="sect4">
<h5 id="command_line"><a class="anchor" href="#command_line"></a><a class="link" href="#command_line">Command line</a></h5>
<div class="paragraph">
<p>Gradle can be invoked in the command line once <a href="#installation">installed</a>.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ gradle build</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Most projects do not use the installed version of Gradle.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="gradle_wrapper"><a class="anchor" href="#gradle_wrapper"></a><a class="link" href="#gradle_wrapper">Gradle Wrapper</a></h5>
<div class="paragraph">
<p>The Wrapper is a script that invokes a declared version of Gradle and is <strong>the recommended way to execute a Gradle build</strong>.
It is found in the project root directory as a <code>gradlew</code> or <code>gradlew.bat</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ gradlew build     // Linux or OSX
$ gradlew.bat build  // Windows</code></pre>
</div>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#gradle_wrapper_basics">Learn about the Gradle Wrapper</a> &gt;&gt;</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gradle_wrapper_basics"><a class="anchor" href="#gradle_wrapper_basics"></a><a class="link" href="#gradle_wrapper_basics">Gradle Wrapper Basics</a></h3>
<div class="paragraph">
<p>The <strong>recommended way to execute any Gradle build</strong> is with the Gradle Wrapper.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-basic-2.png" alt="gradle basic 2">
</div>
</div>
<div class="paragraph">
<p>The <em>Wrapper</em> script invokes a declared version of Gradle, downloading it beforehand if necessary.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/wrapper-workflow.png" alt="wrapper workflow">
</div>
</div>
<div class="paragraph">
<p>The Wrapper is available as a <code>gradlew</code> or <code>gradlew.bat</code> file.</p>
</div>
<div class="paragraph">
<p>The Wrapper provides the following benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Standardizes a project on a given Gradle version.</p>
</li>
<li>
<p>Provisions the same Gradle version for different users.</p>
</li>
<li>
<p>Provisions the Gradle version for different execution environments (IDEs, CI servers&#8230;&#8203;).</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="sec:using_the_wrapper"><a class="anchor" href="#sec:using_the_wrapper"></a><a class="link" href="#sec:using_the_wrapper">Using the Gradle Wrapper</a></h4>
<div class="paragraph">
<p>It is always recommended to execute a build with the Wrapper to ensure a reliable, controlled, and standardized execution of the build.</p>
</div>
<div class="paragraph">
<p>Depending on the operating system, you run <code>gradlew</code> or <code>gradlew.bat</code> instead of the <code>gradle</code> command.</p>
</div>
<div class="paragraph">
<p>Typical Gradle invocation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle build</pre>
</div>
</div>
<div class="paragraph">
<p>To run the Wrapper on a Linux or OSX machine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew build</pre>
</div>
</div>
<div class="paragraph">
<p>To run the Wrapper on Windows PowerShell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ .\gradlew.bat build</pre>
</div>
</div>
<div class="paragraph">
<p>The command is run in the same directory that the Wrapper is located in.
If you want to run the command in a different directory, you must provide the relative path to the Wrapper:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ../gradlew build</pre>
</div>
</div>
<div class="paragraph">
<p>The following console output demonstrates the use of the Wrapper on a Windows machine, in the command prompt (cmd), for a Java-based project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradlew.bat build

Downloading https://services.gradle.org/distributions/gradle-5.0-all.zip
.....................................................................................
Unzipping C:\Documents and Settings\Claudia\.gradle\wrapper\dists\gradle-5.0-all\ac27o8rbd0ic8ih41or9l32mv\gradle-5.0-all.zip to C:\Documents and Settings\Claudia\.gradle\wrapper\dists\gradle-5.0-al\ac27o8rbd0ic8ih41or9l32mv
Set executable permissions for: C:\Documents and Settings\Claudia\.gradle\wrapper\dists\gradle-5.0-all\ac27o8rbd0ic8ih41or9l32mv\gradle-5.0\bin\gradle

BUILD SUCCESSFUL in 12s
1 actionable task: 1 executed</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:view_the_wrapper"><a class="anchor" href="#sec:view_the_wrapper"></a><a class="link" href="#sec:view_the_wrapper">Understanding the Wrapper files</a></h4>
<div class="paragraph">
<p>The following files are part of the Gradle Wrapper:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">.
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar  // <b class="conum">(1)</b>
│       └── gradle-wrapper.properties   // <b class="conum">(2)</b>
├── gradlew // <b class="conum">(3)</b>
└── gradlew.bat // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>gradle-wrapper.jar</code>: This is a small JAR file that contains the Gradle Wrapper code. It is responsible for downloading and installing the correct version of Gradle for a project if it&#8217;s not already installed.</p>
</li>
<li>
<p><code>gradle-wrapper.properties</code>: This file contains configuration properties for the Gradle Wrapper, such as the distribution URL (where to download Gradle from) and the distribution type (ZIP or TARBALL).</p>
</li>
<li>
<p><code>gradlew</code>: This is a shell script (Unix-based systems) that acts as a wrapper around <code>gradle-wrapper.jar</code>. It is used to execute Gradle tasks on Unix-based systems without needing to manually install Gradle.</p>
</li>
<li>
<p><code>gradlew.bat</code>: This is a batch script (Windows) that serves the same purpose as <code>gradlew</code> but is used on Windows systems.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
You should never alter these files.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to view or update the Gradle version of your project, use the command line.
Do not edit the wrapper files manually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew --version
$ ./gradlew wrapper --gradle-version 7.2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cmd">$ gradlew.bat --version
$ gradlew.bat wrapper --gradle-version 7.2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consult the <a href="#gradle_wrapper_reference">Gradle Wrapper reference</a> to learn more.</p>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#command_line_interface_basics">Learn about the Gradle CLI</a> &gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="command_line_interface_basics"><a class="anchor" href="#command_line_interface_basics"></a><a class="link" href="#command_line_interface_basics">Command-Line Interface Basics</a></h3>
<div class="paragraph">
<p>The command-line interface is the primary <strong>method of interacting with Gradle</strong> outside the IDE.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-basic-2.png" alt="gradle basic 2">
</div>
</div>
<div class="paragraph">
<p>Use of the <a href="#gradle_wrapper_reference">Gradle Wrapper</a> is highly encouraged.</p>
</div>
<div class="paragraph">
<p>Substitute <code>./gradlew</code> (in macOS / Linux) or <code>gradlew.bat</code> (in Windows) for <code>gradle</code> in the following examples.</p>
</div>
<div class="paragraph">
<p>Executing Gradle on the command line conforms to the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle [taskName...] [--option-name...]</pre>
</div>
</div>
<div class="paragraph">
<p>Options are allowed <em>before</em> and <em>after</em> task names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle [--option-name...] [taskName...]</pre>
</div>
</div>
<div class="paragraph">
<p>If multiple tasks are specified, you should separate them with a space.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle [taskName1 taskName2...] [--option-name...]</pre>
</div>
</div>
<div class="paragraph">
<p>Options that accept values can be specified with or without <code>=</code> between the option and argument. The use of <code>=</code> is recommended.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle [...] --console=plain</pre>
</div>
</div>
<div class="paragraph">
<p>Options that enable behavior have long-form options with inverses specified with <code>--no-</code>. The following are opposites.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle [...] --build-cache
gradle [...] --no-build-cache</pre>
</div>
</div>
<div class="paragraph">
<p>Many long-form options have short-option equivalents. The following are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle --help
gradle -h</pre>
</div>
</div>
<div class="sect3">
<h4 id="command_line_usage"><a class="anchor" href="#command_line_usage"></a><a class="link" href="#command_line_usage">Command-line usage</a></h4>
<div class="paragraph">
<p>The following sections describe the use of the Gradle command-line interface.
Some plugins also add their own command line options.</p>
</div>
<div class="sect4">
<h5 id="command_line_executing_tasks"><a class="anchor" href="#command_line_executing_tasks"></a><a class="link" href="#command_line_executing_tasks">Executing tasks</a></h5>
<div class="paragraph">
<p>To execute a task called <code>taskName</code> on the root project, type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle :taskName</pre>
</div>
</div>
<div class="paragraph">
<p>This will run the single <code>taskName</code> and all of its <a href="#sec:task_dependencies">dependencies</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="disambiguate_task_options_from_built_in_options"><a class="anchor" href="#disambiguate_task_options_from_built_in_options"></a><a class="link" href="#disambiguate_task_options_from_built_in_options">Specify options for tasks</a></h5>
<div class="paragraph">
<p>To pass an option to a task, prefix the option name with <code>--</code> after the task name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle taskName --exampleOption=exampleValue</pre>
</div>
</div>
<div class="paragraph">
<p>Consult the <a href="#command_line_interface">Gradle Command Line Interface reference</a> to learn more.</p>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#settings_file_basics">Learn about the Settings file</a> &gt;&gt;</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="settings_file_basics"><a class="anchor" href="#settings_file_basics"></a><a class="link" href="#settings_file_basics">Settings File Basics</a></h3>
<div class="paragraph">
<p>The settings file is the <strong>entry point</strong> of every Gradle project.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-basic-3.png" alt="gradle basic 3">
</div>
</div>
<div class="paragraph">
<p>The primary purpose of the <em>settings file</em> is to add subprojects to your build.</p>
</div>
<div class="paragraph">
<p>Gradle supports single and multi-project builds.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For single-project builds, the settings file is optional.</p>
</li>
<li>
<p>For multi-project builds, the settings file is mandatory and declares all subprojects.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="sec:settings_file_script"><a class="anchor" href="#sec:settings_file_script"></a><a class="link" href="#sec:settings_file_script">Settings script</a></h4>
<div class="paragraph">
<p>The settings file is a script.
It is either a <code>settings.gradle</code> file written in Groovy or a <code>settings.gradle.kts</code> file in Kotlin.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/dsl/index.html" target="_blank" rel="noopener">Groovy DSL</a> and the <a href="https://docs.gradle.org/8.9/kotlin-dsl/index.html" target="_blank" rel="noopener">Kotlin DSL</a> are the only accepted languages for Gradle scripts.</p>
</div>
<div class="paragraph">
<p>The settings file is typically found in the root directory of the project.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at an example and break it down:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;root-project&quot;   // <b class="conum">(1)</b>

include(&quot;sub-project-a&quot;)            // <b class="conum">(2)</b>
include(&quot;sub-project-b&quot;)
include(&quot;sub-project-c&quot;)</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Define the project name.</p>
</li>
<li>
<p>Add subprojects.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">root-project</span><span class="delimiter">'</span></span>   // <b class="conum">(1)</b>

include(<span class="string"><span class="delimiter">'</span><span class="content">sub-project-a</span><span class="delimiter">'</span></span>)            // <b class="conum">(2)</b>
include(<span class="string"><span class="delimiter">'</span><span class="content">sub-project-b</span><span class="delimiter">'</span></span>)
include(<span class="string"><span class="delimiter">'</span><span class="content">sub-project-c</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Define the project name.</p>
</li>
<li>
<p>Add subprojects.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="1_define_the_project_name"><a class="anchor" href="#1_define_the_project_name"></a><a class="link" href="#1_define_the_project_name">1. Define the project name</a></h5>
<div class="paragraph">
<p>The settings file defines your project name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;root-project&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is only one root project per build.</p>
</div>
</div>
<div class="sect4">
<h5 id="2_add_subprojects"><a class="anchor" href="#2_add_subprojects"></a><a class="link" href="#2_add_subprojects">2. Add subprojects</a></h5>
<div class="paragraph">
<p>The settings file defines the structure of the project by including subprojects, if there are any:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;app&quot;)
include(&quot;business-logic&quot;)
include(&quot;data-model&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consult the <a href="#writing_settings_files">Writing Settings File</a> page to learn more.</p>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#build_file_basics">Learn about the Build scripts</a> &gt;&gt;</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build_file_basics"><a class="anchor" href="#build_file_basics"></a><a class="link" href="#build_file_basics">Build File Basics</a></h3>
<div class="paragraph">
<p>Generally, a build script details <strong>build configuration, tasks, and plugins</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-basic-4.png" alt="gradle basic 4">
</div>
</div>
<div class="paragraph">
<p>Every Gradle build comprises at least one <em>build script</em>.</p>
</div>
<div class="paragraph">
<p>In the build file, two types of dependencies can be added:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The libraries and/or plugins on which Gradle and the build script depend.</p>
</li>
<li>
<p>The libraries on which the project sources (i.e., source code) depend.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="sec:build_script"><a class="anchor" href="#sec:build_script"></a><a class="link" href="#sec:build_script">Build scripts</a></h4>
<div class="paragraph">
<p>The build script is either a <code>build.gradle</code> file written in Groovy or a <code>build.gradle.kts</code> file in Kotlin.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/dsl/index.html" target="_blank" rel="noopener">Groovy DSL</a> and the <a href="https://docs.gradle.org/8.9/kotlin-dsl/index.html" target="_blank" rel="noopener">Kotlin DSL</a> are the only accepted languages for Gradle scripts.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at an example and break it down:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;application&quot;)               // <b class="conum">(1)</b>
}

application {
    mainClass = &quot;com.example.Main&quot;  // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Add plugins.</p>
</li>
<li>
<p>Use convention properties.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">application</span><span class="delimiter">'</span></span>                // <b class="conum">(1)</b>
}

application {
    mainClass = <span class="string"><span class="delimiter">'</span><span class="content">com.example.Main</span><span class="delimiter">'</span></span>  // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Add plugins.</p>
</li>
<li>
<p>Use convention properties.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="1_add_plugins"><a class="anchor" href="#1_add_plugins"></a><a class="link" href="#1_add_plugins">1. Add plugins</a></h5>
<div class="paragraph">
<p>Plugins extend Gradle&#8217;s functionality and can contribute tasks to a project.</p>
</div>
<div class="paragraph">
<p>Adding a plugin to a build is called <em>applying</em> a plugin and makes additional functionality available.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;application&quot;)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>application</code> plugin facilitates creating an executable JVM application.</p>
</div>
<div class="paragraph">
<p>Applying the <a href="#application_plugin">Application plugin</a> also implicitly applies the <a href="java_plugin.html#java_plugin">Java plugin</a>.
The <code>java</code> plugin adds Java compilation along with testing and bundling capabilities to a project.</p>
</div>
</div>
<div class="sect4">
<h5 id="2_use_convention_properties"><a class="anchor" href="#2_use_convention_properties"></a><a class="link" href="#2_use_convention_properties">2. Use convention properties</a></h5>
<div class="paragraph">
<p>A plugin adds tasks to a project.
It also adds properties and methods to a project.</p>
</div>
<div class="paragraph">
<p>The <code>application</code> plugin defines tasks that package and distribute an application, such as the <code>run</code> task.</p>
</div>
<div class="paragraph">
<p>The Application plugin provides a way to declare the main class of a Java application, which is required to execute the code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    mainClass = &quot;com.example.Main&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the main class (i.e., the point where the program&#8217;s execution begins) is <code>com.example.Main</code>.</p>
</div>
<div class="paragraph">
<p>Consult the <a href="#writing_build_scripts">Writing Build Scripts</a> page to learn more.</p>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#dependency_management_basics">Learn about Dependency Management</a> &gt;&gt;</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dependency_management_basics"><a class="anchor" href="#dependency_management_basics"></a><a class="link" href="#dependency_management_basics">Dependency Management Basics</a></h3>
<div class="paragraph">
<p>Gradle has built-in support for <strong>dependency management</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-basic-7.png" alt="gradle basic 7">
</div>
</div>
<div class="paragraph">
<p>Dependency management is an automated technique for declaring and resolving external resources required by a project.</p>
</div>
<div class="paragraph">
<p>Gradle build scripts define the process to build projects that may require external dependencies.
Dependencies refer to JARs, plugins, libraries, or source code that support building your project.</p>
</div>
<div class="sect3">
<h4 id="version_catalog"><a class="anchor" href="#version_catalog"></a><a class="link" href="#version_catalog">Version Catalog</a></h4>
<div class="paragraph">
<p>Version catalogs provide a way to centralize your dependency declarations in a <code>libs.versions.toml</code> file.</p>
</div>
<div class="paragraph">
<p>The catalog makes sharing dependencies and version configurations between subprojects simple.
It also allows teams to enforce versions of libraries and plugins in large projects.</p>
</div>
<div class="paragraph">
<p>The version catalog typically contains four sections:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>[versions] to declare the version numbers that plugins and libraries will reference.</p>
</li>
<li>
<p>[libraries] to define the libraries used in the build files.</p>
</li>
<li>
<p>[bundles] to define a set of dependencies.</p>
</li>
<li>
<p>[plugins] to define plugins.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gradle/libs.versions.toml">[versions]
androidGradlePlugin = &quot;7.4.1&quot;
mockito = &quot;2.16.0&quot;

[libraries]
googleMaterial = { group = &quot;com.google.android.material&quot;, name = &quot;material&quot;, version = &quot;1.1.0-alpha05&quot; }
mockitoCore = { module = &quot;org.mockito:mockito-core&quot;, version.ref = &quot;mockito&quot; }

[plugins]
androidApplication = { id = &quot;com.android.application&quot;, version.ref = &quot;androidGradlePlugin&quot; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file is located in the <code>gradle</code> directory so that it can be used by Gradle and IDEs automatically.
The version catalog should be checked into source control: <code>gradle/libs.versions.toml</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="declaring_your_dependencies"><a class="anchor" href="#declaring_your_dependencies"></a><a class="link" href="#declaring_your_dependencies">Declaring Your Dependencies</a></h4>
<div class="paragraph">
<p>To add a dependency to your project, specify a dependency in the dependencies block of your <code>build.gradle(.kts)</code> file.</p>
</div>
<div class="paragraph">
<p>The following <code>build.gradle.kts</code> file adds a plugin and two dependencies to the project using the version catalog above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
   alias(libs.plugins.androidApplication)  // <b class="conum">(1)</b>
}

dependencies {
    // Dependency on a remote binary to compile and run the code
    implementation(libs.googleMaterial)    // <b class="conum">(2)</b>

    // Dependency on a remote binary to compile and run the test code
    testImplementation(libs.mockitoCore)   // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Applies the Android Gradle plugin to this project, which adds several features that are specific to building Android apps.</p>
</li>
<li>
<p>Adds the Material dependency to the project. Material Design provides components for creating a user interface in an Android App. This library will be used to compile and run the Kotlin source code in this project.</p>
</li>
<li>
<p>Adds the Mockito dependency to the project. Mockito is a mocking framework for testing Java code. This library will be used to compile and run the <em>test</em> source code in this project.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Dependencies in Gradle are grouped by <strong>configurations</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>material</code> library is added to the <code>implementation</code> configuration, which is used for compiling and running <em>production</em> code.</p>
</li>
<li>
<p>The <code>mockito-core</code> library is added to the <code>testImplementation</code> configuration, which is used for compiling and running <em>test</em> code.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There are many more configurations available.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="viewing_project_dependencies"><a class="anchor" href="#viewing_project_dependencies"></a><a class="link" href="#viewing_project_dependencies">Viewing Project Dependencies</a></h4>
<div class="paragraph">
<p>You can view your dependency tree in the terminal using the <code>./gradlew :app:dependencies</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew :app:dependencies

&gt; Task :app:dependencies

------------------------------------------------------------
Project ':app'
------------------------------------------------------------

implementation - Implementation only dependencies for source set 'main'. (n)
\--- com.google.android.material:material:1.1.0-alpha05 (n)

testImplementation - Implementation only dependencies for source set 'test'. (n)
\--- org.mockito:mockito-core:2.16.0 (n)

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consult the <a href="#dependency_management_terminology">Dependency Management chapter</a> to learn more.</p>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#task_basics">Learn about Tasks</a> &gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="task_basics"><a class="anchor" href="#task_basics"></a><a class="link" href="#task_basics">Task Basics</a></h3>
<div class="paragraph">
<p>A task represents some <strong>independent unit of work</strong> that a build performs, such as compiling classes, creating a JAR, generating Javadoc, or publishing archives to a repository.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-basic-5.png" alt="gradle basic 5">
</div>
</div>
<div class="paragraph">
<p>You run a Gradle <code>build</code> task using the <code>gradle</code> command or by invoking the Gradle Wrapper (<code>./gradlew</code> or <code>gradlew.bat</code>) in your project directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew build</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="available_tasks"><a class="anchor" href="#available_tasks"></a><a class="link" href="#available_tasks">Available tasks</a></h4>
<div class="paragraph">
<p>All available tasks in your project come from Gradle plugins and build scripts.</p>
</div>
<div class="paragraph">
<p>You can list all the available tasks in the project by running the following command in the terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew tasks</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Application tasks
-----------------
run - Runs this project as a JVM application

Build tasks
-----------
assemble - Assembles the outputs of this project.
build - Assembles and tests this project.

...

Documentation tasks
-------------------
javadoc - Generates Javadoc API documentation for the main source code.

...

Other tasks
-----------
compileJava - Compiles main Java source.

...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running_tasks"><a class="anchor" href="#running_tasks"></a><a class="link" href="#running_tasks">Running tasks</a></h4>
<div class="paragraph">
<p>The <code>run</code> task is executed with <code>./gradlew run</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew run

&gt; Task :app:compileJava
&gt; Task :app:processResources NO-SOURCE
&gt; Task :app:classes

&gt; Task :app:run
Hello World!

BUILD SUCCESSFUL in 904ms
2 actionable tasks: 2 executed</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example Java project, the output of the <code>run</code> task is a <code>Hello World</code> statement printed on the console.</p>
</div>
</div>
<div class="sect3">
<h4 id="task_dependency"><a class="anchor" href="#task_dependency"></a><a class="link" href="#task_dependency">Task dependency</a></h4>
<div class="paragraph">
<p>Many times, a task requires another task to run first.</p>
</div>
<div class="paragraph">
<p>For example, for Gradle to execute the <code>build</code> task, the Java code must first be compiled.
Thus, the <code>build</code> task <em>depends</em> on the <code>compileJava</code> task.</p>
</div>
<div class="paragraph">
<p>This means that the <code>compileJava</code> task will run <em>before</em> the <code>build</code> task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew build

&gt; Task :app:compileJava
&gt; Task :app:processResources NO-SOURCE
&gt; Task :app:classes
&gt; Task :app:jar
&gt; Task :app:startScripts
&gt; Task :app:distTar
&gt; Task :app:distZip
&gt; Task :app:assemble
&gt; Task :app:compileTestJava
&gt; Task :app:processTestResources NO-SOURCE
&gt; Task :app:testClasses
&gt; Task :app:test
&gt; Task :app:check
&gt; Task :app:build

BUILD SUCCESSFUL in 764ms
7 actionable tasks: 7 executed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Build scripts can optionally define task dependencies.
Gradle then automatically determines the task execution order.</p>
</div>
<div class="paragraph">
<p>Consult the <a href="#more_about_tasks">Task development chapter</a> to learn more.</p>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#plugin_basics">Learn about Plugins</a> &gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="plugin_basics"><a class="anchor" href="#plugin_basics"></a><a class="link" href="#plugin_basics">Plugin Basics</a></h3>
<div class="paragraph">
<p>Gradle is built on a plugin system.
Gradle itself is primarily composed of infrastructure, such as a sophisticated dependency resolution engine.
The rest of its functionality comes from plugins.</p>
</div>
<div class="paragraph">
<p>A plugin is a piece of software that <strong>provides additional functionality to the Gradle build system</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-basic-6.png" alt="gradle basic 6">
</div>
</div>
<div class="paragraph">
<p>Plugins can be applied to a Gradle build script to <strong>add new tasks, configurations, or other build-related capabilities</strong>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">The Java Library Plugin - <code>java-library</code> </dt>
<dd>
<p>Used to define and build Java libraries. It compiles Java source code with the <code>compileJava</code> task, generates Javadoc with the <code>javadoc</code> task, and packages the compiled classes into a JAR file with the <code>jar</code> task.</p>
</dd>
<dt class="hdlist1">The Google Services Gradle Plugin - <code>com.google.gms:google-services</code> </dt>
<dd>
<p>Enables Google APIs and Firebase services in your Android application with a configuration block called <code>googleServices{}</code> and a task called <code>generateReleaseAssets</code>.</p>
</dd>
<dt class="hdlist1">The Gradle Bintray Plugin - <code>com.jfrog.bintray</code> </dt>
<dd>
<p>Allows you to publish artifacts to Bintray by configuring the plugin using the <code>bintray{}</code> block.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="plugin_distribution"><a class="anchor" href="#plugin_distribution"></a><a class="link" href="#plugin_distribution">Plugin distribution</a></h4>
<div class="paragraph">
<p>Plugins are distributed in three ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Core plugins</strong> - Gradle develops and maintains a set of <a href="#plugin_reference">Core Plugins</a>.</p>
</li>
<li>
<p><strong>Community plugins</strong> - Gradle&#8217;s community shares plugins via the <a href="https://plugins.gradle.org">Gradle Plugin Portal</a>.</p>
</li>
<li>
<p><strong>Local plugins</strong> - Gradle enables users to create custom plugins using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Plugin.html">APIs</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="applying_plugins"><a class="anchor" href="#applying_plugins"></a><a class="link" href="#applying_plugins">Applying plugins</a></h4>
<div class="paragraph">
<p><strong>Applying</strong> a plugin to a project allows the plugin to extend the project&#8217;s capabilities.</p>
</div>
<div class="paragraph">
<p>You apply plugins in the build script using a <strong>plugin id</strong> (a globally unique identifier / name) and a version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">plugins {
    id «plugin id» version «plugin version»
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="1_core_plugins"><a class="anchor" href="#1_core_plugins"></a><a class="link" href="#1_core_plugins">1. Core plugins</a></h4>
<div class="paragraph">
<p>Gradle Core plugins are a set of plugins that are included in the Gradle distribution itself.
These plugins provide essential functionality for building and managing projects.</p>
</div>
<div class="paragraph">
<p>Some examples of core plugins include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>java</strong>: Provides support for building Java projects.</p>
</li>
<li>
<p><strong>groovy</strong>: Adds support for compiling and testing Groovy source files.</p>
</li>
<li>
<p><strong>ear</strong>: Adds support for building EAR files for enterprise applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Core plugins are unique in that they provide short names, such as <code>java</code> for the core <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/plugins/JavaPlugin.html">JavaPlugin</a>, when applied in build scripts.
They also do not require versions.
To apply the <code>java</code> plugin to a project:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;java&quot;)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are many <a href="#plugin_reference">Gradle Core Plugins</a> users can take advantage of.</p>
</div>
</div>
<div class="sect3">
<h4 id="2_community_plugins"><a class="anchor" href="#2_community_plugins"></a><a class="link" href="#2_community_plugins">2. Community plugins</a></h4>
<div class="paragraph">
<p>Community plugins are plugins developed by the Gradle community, rather than being part of the core Gradle distribution.
These plugins provide additional functionality that may be specific to certain use cases or technologies.</p>
</div>
<div class="paragraph">
<p>The <a href="https://plugins.gradle.org/plugin/org.springframework.boot">Spring Boot Gradle plugin</a> packages executable JAR or WAR archives, and runs <a href="https://spring.io/">Spring Boot</a> Java applications.</p>
</div>
<div class="paragraph">
<p>To apply the <code>org.springframework.boot</code> plugin to a project:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;org.springframework.boot&quot;) version &quot;3.1.5&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Community plugins can be published at the <a href="http://plugins.gradle.org/">Gradle Plugin Portal</a>, where other Gradle users can easily discover and use them.</p>
</div>
</div>
<div class="sect3">
<h4 id="3_local_plugins"><a class="anchor" href="#3_local_plugins"></a><a class="link" href="#3_local_plugins">3. Local plugins</a></h4>
<div class="paragraph">
<p>Custom or local plugins are developed and used within a specific project or organization.
These plugins are not shared publicly and are tailored to the specific needs of the project or organization.</p>
</div>
<div class="paragraph">
<p>Local plugins can encapsulate common build logic, provide integrations with internal systems or tools, or abstract complex functionality into reusable components.</p>
</div>
<div class="paragraph">
<p>Gradle provides users with the ability to develop custom plugins using APIs.
To create your own plugin, you&#8217;ll typically follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Define the plugin class:</strong> create a new class that implements the <code>Plugin&lt;Project&gt;</code> interface.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Define a 'HelloPlugin' plugin
class HelloPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        // Define the 'hello' task
        val helloTask = project.tasks.register(&quot;hello&quot;) {
            doLast {
                println(&quot;Hello, Gradle!&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Build and optionally publish your plugin:</strong> generate a JAR file containing your plugin code and optionally publish this JAR to a repository (local or remote) to be used in other projects.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Publish the plugin
plugins {
    `maven-publish`
}

publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
            from(components[&quot;java&quot;])
        }
    }
    repositories {
        mavenLocal()
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Apply your plugin:</strong> when you want to use the plugin, include the plugin ID and version in the <code>plugins{}</code> block of the build file.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Apply the plugin
plugins {
    id(&quot;com.example.hello&quot;) version &quot;1.0&quot;
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Consult the <a href="#custom_plugins">Plugin development chapter</a> to learn more.</p>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#gradle_optimizations">Learn about Incremental Builds and Build Caching</a> &gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gradle_optimizations"><a class="anchor" href="#gradle_optimizations"></a><a class="link" href="#gradle_optimizations">Gradle Incremental Builds and Build Caching</a></h3>
<div class="badge-wrapper">
    <a class="badge" href="https://dpeuniversity.gradle.com/app/courses/ec69d0b8-9171-4969-ac3e-82dea16f87b0/" target="_blank">
        <span class="badge-type button--blue">LEARN</span>
        <span class="badge-text">Incremental Builds and Build Caching with Gradle&nbsp;&nbsp;&nbsp;&gt;</span>
    </a>
</div>
<div class="paragraph">
<p>Gradle uses two main features to reduce build time: <strong>incremental builds</strong> and <strong>build caching</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-basic-8.png" alt="gradle basic 8">
</div>
</div>
<div class="sect3">
<h4 id="incremental_builds"><a class="anchor" href="#incremental_builds"></a><a class="link" href="#incremental_builds">Incremental builds</a></h4>
<div class="paragraph">
<p>An <strong>incremental build</strong> is a build that avoids running tasks whose inputs have not changed since the previous build.
Re-executing such tasks is unnecessary if they would only re-produce the same output.</p>
</div>
<div class="paragraph">
<p>For incremental builds to work, tasks must define their inputs and outputs.
Gradle will determine whether the input or outputs have changed at build time.
If they have changed, Gradle will execute the task.
Otherwise, it will skip execution.</p>
</div>
<div class="paragraph">
<p>Incremental builds are always enabled, and the best way to see them in action is to turn on <em>verbose mode</em>.
With verbose mode, each task state is labeled during a build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew compileJava --console=verbose

&gt; Task :buildSrc:generateExternalPluginSpecBuilders UP-TO-DATE
&gt; Task :buildSrc:extractPrecompiledScriptPluginPlugins UP-TO-DATE
&gt; Task :buildSrc:compilePluginsBlocks UP-TO-DATE
&gt; Task :buildSrc:generatePrecompiledScriptPluginAccessors UP-TO-DATE
&gt; Task :buildSrc:generateScriptPluginAdapters UP-TO-DATE
&gt; Task :buildSrc:compileKotlin UP-TO-DATE
&gt; Task :buildSrc:compileJava NO-SOURCE
&gt; Task :buildSrc:compileGroovy NO-SOURCE
&gt; Task :buildSrc:pluginDescriptors UP-TO-DATE
&gt; Task :buildSrc:processResources UP-TO-DATE
&gt; Task :buildSrc:classes UP-TO-DATE
&gt; Task :buildSrc:jar UP-TO-DATE
&gt; Task :list:compileJava UP-TO-DATE
&gt; Task :utilities:compileJava UP-TO-DATE
&gt; Task :app:compileJava UP-TO-DATE

BUILD SUCCESSFUL in 374ms
12 actionable tasks: 12 up-to-date</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you run a task that has been previously executed and hasn&#8217;t changed, then <code>UP-TO-DATE</code> is printed next to the task.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
To permanently enable verbose mode, add <code>org.gradle.console=verbose</code> to your <code>gradle.properties</code> file.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="build_caching"><a class="anchor" href="#build_caching"></a><a class="link" href="#build_caching">Build caching</a></h4>
<div class="paragraph">
<p>Incremental Builds are a great optimization that helps avoid work already done.
If a developer continuously changes a single file, there is likely no need to rebuild all the other files in the project.</p>
</div>
<div class="paragraph">
<p>However, what happens when the same developer switches to a new branch created last week?
The files are rebuilt, even though the developer is building something that has been built before.</p>
</div>
<div class="paragraph">
<p>This is where a <strong>build cache</strong> is helpful.</p>
</div>
<div class="paragraph">
<p>The build cache stores previous build results and restores them when needed.
It prevents the redundant work and cost of executing time-consuming and expensive processes.</p>
</div>
<div class="paragraph">
<p>When the build cache has been used to repopulate the local directory, the tasks are marked as <code>FROM-CACHE</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew compileJava --build-cache

&gt; Task :buildSrc:generateExternalPluginSpecBuilders UP-TO-DATE
&gt; Task :buildSrc:extractPrecompiledScriptPluginPlugins UP-TO-DATE
&gt; Task :buildSrc:compilePluginsBlocks UP-TO-DATE
&gt; Task :buildSrc:generatePrecompiledScriptPluginAccessors UP-TO-DATE
&gt; Task :buildSrc:generateScriptPluginAdapters UP-TO-DATE
&gt; Task :buildSrc:compileKotlin UP-TO-DATE
&gt; Task :buildSrc:compileJava NO-SOURCE
&gt; Task :buildSrc:compileGroovy NO-SOURCE
&gt; Task :buildSrc:pluginDescriptors UP-TO-DATE
&gt; Task :buildSrc:processResources UP-TO-DATE
&gt; Task :buildSrc:classes UP-TO-DATE
&gt; Task :buildSrc:jar UP-TO-DATE
&gt; Task :list:compileJava FROM-CACHE
&gt; Task :utilities:compileJava FROM-CACHE
&gt; Task :app:compileJava FROM-CACHE

BUILD SUCCESSFUL in 364ms
12 actionable tasks: 3 from cache, 9 up-to-date</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the local directory has been repopulated, the next execution will mark tasks as <code>UP-TO-DATE</code> and not <code>FROM-CACHE</code>.</p>
</div>
<div class="paragraph">
<p>The build cache allows you to share and reuse unchanged build and test outputs across teams.
This speeds up local and CI builds since cycles are not wasted re-building binaries unaffected by new code changes.</p>
</div>
<div class="paragraph">
<p>Consult the <a href="#build_cache">Build cache chapter</a> to learn more.</p>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#build_scans">Learn about Build Scans</a> &gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build_scans"><a class="anchor" href="#build_scans"></a><a class="link" href="#build_scans">Build Scans</a></h3>
<div class="badge-wrapper">
    <a class="badge" href="https://dpeuniversity.gradle.com/app/courses/b5069222-cfd0-4393-b645-7a2c713853d5/" target="_blank">
        <span class="badge-type button--blue">LEARN</span>
        <span class="badge-text">How to Use Build Scans&nbsp;&nbsp;&nbsp;&gt;</span>
    </a>
</div>
<div class="paragraph">
<p>A build scan is a <strong>representation of metadata captured</strong> as you run your build.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-basic-1.png" alt="gradle basic 1">
</div>
</div>
<div class="sect3">
<h4 id="build_scans_2"><a class="anchor" href="#build_scans_2"></a><a class="link" href="#build_scans_2">Build Scans</a></h4>
<div class="paragraph">
<p>Gradle captures your build metadata and sends it to the <a href="https://scans.gradle.com/">Build Scan Service</a>.
The service then transforms the metadata into information you can analyze and share with others.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/build-scan-1.png" alt="build scan 1">
</div>
</div>
<div class="paragraph">
<p>The information that scans collect can be an invaluable resource when troubleshooting, collaborating on, or optimizing the performance of your builds.</p>
</div>
<div class="paragraph">
<p>For example, with a build scan, it’s no longer necessary to copy and paste error messages or include all the details about your environment each time you want to ask a question on Stack Overflow, Slack, or the Gradle Forum.
Instead, copy the link to your latest build scan.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/build-scan-2.png" alt="build scan 2">
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable_build_scans"><a class="anchor" href="#enable_build_scans"></a><a class="link" href="#enable_build_scans">Enable Build Scans</a></h4>
<div class="paragraph">
<p>To enable build scans on a gradle command, add <code>--scan</code> to the command line option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text"> ./gradlew build --scan</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may be prompted to agree to the terms to use Build Scans.</p>
</div>
<div class="paragraph">
<p>Vist the <a href="https://scans.gradle.com/">Build Scans page</a> to learn more.</p>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="part1_gradle_init.html#part1_gradle_init">Start the Tutorial</a> &gt;&gt;</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="other_topics"><a class="anchor" href="#other_topics"></a><a class="link" href="#other_topics">OTHER TOPICS</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="continuous_builds"><a class="anchor" href="#continuous_builds"></a><a class="link" href="#continuous_builds">Continuous Builds</a></h3>
<div class="paragraph">
<p>Continuous Build allows you to automatically re-execute the requested tasks when file inputs change.
You can execute the build in this mode using the <code>-t</code> or <code>--continuous</code> command-line option.</p>
</div>
<div class="paragraph">
<p>For example, you can continuously run the <code>test</code> task and all dependent tasks by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle test --continuous</pre>
</div>
</div>
<div class="paragraph">
<p>Gradle will behave as if you ran <code>gradle test</code> after a change to sources or tests that contribute to the requested tasks.
This means unrelated changes (such as changes to build scripts) will not trigger a rebuild.
To incorporate build logic changes, the continuous build must be restarted manually.</p>
</div>
<div class="paragraph">
<p>Continuous build uses <a href="#sec:daemon_watch_fs">file system watching</a> to detect changes to the inputs.
If file system watching does not work on your system, then continuous build won&#8217;t work either.
In particular, continuous build does not work when using <code>--no-daemon</code>.</p>
</div>
<div class="paragraph">
<p>When Gradle detects a change to the inputs, it will not trigger the build immediately.
Instead, it will wait until no additional changes are detected for a certain period of time - the quiet period.
You can configure the quiet period in milliseconds by the Gradle property <code><a href="#sec:gradle_configuration_properties">org.gradle.continuous.quietperiod</a></code>.</p>
</div>
<div class="sect3">
<h4 id="terminating_continuous_build"><a class="anchor" href="#terminating_continuous_build"></a><a class="link" href="#terminating_continuous_build">Terminating Continuous Build</a></h4>
<div class="paragraph">
<p>If Gradle is attached to an interactive input source, such as a terminal, the continuous build can be exited by pressing <code>CTRL-D</code> (On Microsoft Windows, it is required to also press <code>ENTER</code> or <code>RETURN</code> after <code>CTRL-D</code>).</p>
</div>
<div class="paragraph">
<p>If Gradle is not attached to an interactive input source (e.g. is running as part of a script), the build process must be terminated (e.g. using the <code>kill</code> command or similar).</p>
</div>
<div class="paragraph">
<p>If the build is being executed via the Tooling API, the build can be cancelled using the Tooling API&#8217;s cancellation mechanism.</p>
</div>
</div>
<div class="sect3">
<h4 id="continuous_build_limitations"><a class="anchor" href="#continuous_build_limitations"></a><a class="link" href="#continuous_build_limitations">Limitations</a></h4>
<div class="paragraph">
<p>Under some circumstances, continuous build may not detect changes to inputs.</p>
</div>
<div class="sect4">
<h5 id="sec:continuous_build_missing_files"><a class="anchor" href="#sec:continuous_build_missing_files"></a><a class="link" href="#sec:continuous_build_missing_files">Creating input directories</a></h5>
<div class="paragraph">
<p>Sometimes, creating an input directory that was previously missing does not trigger a build, due to the way file system watching works.
For example, creating the <code>src/main/java</code> directory may not trigger a build.
Similarly, if the input is a <a href="#filtering_files">filtered file tree</a> and no files are matching the filter, the creation of matching files may not trigger a build.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:continuous_build_untracked"><a class="anchor" href="#sec:continuous_build_untracked"></a><a class="link" href="#sec:continuous_build_untracked">Inputs of untracked tasks</a></h5>
<div class="paragraph">
<p>Changes to the inputs of <a href="#sec:disable-state-tracking">untracked tasks</a> or tasks that have no outputs may not trigger a build.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:continuous_build_project_dir"><a class="anchor" href="#sec:continuous_build_project_dir"></a><a class="link" href="#sec:continuous_build_project_dir">Changes to files outside of project directories</a></h5>
<div class="paragraph">
<p>Gradle only watches for changes to files inside the project directory.
Changes to files outside the project directory will go undetected and not trigger a build.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:build_cycles"><a class="anchor" href="#sec:build_cycles"></a><a class="link" href="#sec:build_cycles">Build cycles</a></h5>
<div class="paragraph">
<p>Gradle starts watching for changes just before a task executes.
If a task modifies its own inputs while executing, Gradle will detect the change and trigger a new build.
If every time the task executes, the inputs are modified again, the build will be triggered again.
This isn&#8217;t unique to continuous build.
A task that modifies its own inputs will never be considered up-to-date when run "normally" without continuous build.</p>
</div>
<div class="paragraph">
<p>If your build enters a build cycle like this, you can track down the task by looking at the list of files reported changed by Gradle.
After identifying the file(s) that are changed during each build, you should look for a task that has that file as an input.
In some cases, it may be obvious (e.g., a Java file is compiled with <code>compileJava</code>).
In other cases, you can use <code>--info</code> logging to find the task that is out-of-date due to the identified files.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:authoring_builds"><a class="anchor" href="#part:authoring_builds"></a><a class="link" href="#part:authoring_builds"><strong>AUTHORING GRADLE BUILDS</strong></a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="the_basics"><a class="anchor" href="#the_basics"></a><a class="link" href="#the_basics">THE BASICS</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="gradle_directories"><a class="anchor" href="#gradle_directories"></a><a class="link" href="#gradle_directories">Gradle Directories</a></h3>
<div class="paragraph">
<p>Gradle uses two main directories to perform and manage its work: the <a href="#gradle_user_home">Gradle User Home directory</a> and the <a href="#project_root">Project Root directory</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/author-gradle-2.png" alt="author gradle 2">
</div>
</div>
<div class="sect3">
<h4 id="gradle_user_home"><a class="anchor" href="#gradle_user_home"></a><a class="link" href="#gradle_user_home">Gradle User Home directory</a></h4>
<div class="paragraph">
<p>By default, the Gradle User Home (<code>~/.gradle</code> or <code>C:\Users\&lt;USERNAME&gt;\.gradle</code>) stores global configuration properties, initialization scripts, caches, and log files.</p>
</div>
<div class="paragraph">
<p>It can be set with the environment variable <code>GRADLE_USER_HOME</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Not to be confused with the <code>GRADLE_HOME</code>, the optional installation directory for Gradle.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is roughly structured as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>├── caches                  // <b class="conum">(1)</b>
│   ├── 4.8                     // <b class="conum">(2)</b>
│   ├── 4.9                     // <b class="conum">(2)</b>
│   ├── ⋮
│   ├── jars-3                  // <b class="conum">(3)</b>
│   └── modules-2               // <b class="conum">(3)</b>
├── daemon // <b class="conum">(4)</b>
│   ├── ⋮
│   ├── 4.8
│   └── 4.9
├── init.d                  // <b class="conum">(5)</b>
│   └── my-setup.gradle
├── jdks                    // <b class="conum">(6)</b>
│   ├── ⋮
│   └── jdk-14.0.2+12
├── wrapper
│   └── dists                   // <b class="conum">(7)</b>
│       ├── ⋮
│       ├── gradle-4.8-bin
│       ├── gradle-4.9-all
│       └── gradle-4.9-bin
└── gradle.properties       // <b class="conum">(8)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Global cache directory (for everything that is not project-specific).</p>
</li>
<li>
<p>Version-specific caches (e.g., to support incremental builds).</p>
</li>
<li>
<p>Shared caches (e.g., for artifacts of dependencies).</p>
</li>
<li>
<p>Registry and logs of the <a href="#gradle_daemon">Gradle Daemon</a>.</p>
</li>
<li>
<p>Global <a href="#init_scripts">initialization scripts</a>.</p>
</li>
<li>
<p>JDKs downloaded by the <a href="#sec:provisioning">toolchain support</a>.</p>
</li>
<li>
<p>Distributions downloaded by the <a href="#gradle_wrapper_reference">Gradle Wrapper</a>.</p>
</li>
<li>
<p>Global <a href="#sec:gradle_configuration_properties">Gradle configuration properties</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Consult the <a href="#dir:gradle_user_home">Gradle Directories reference</a> to learn more.</p>
</div>
</div>
<div class="sect3">
<h4 id="project_root"><a class="anchor" href="#project_root"></a><a class="link" href="#project_root">Project Root directory</a></h4>
<div class="paragraph">
<p>The project root directory contains all source files from your project.</p>
</div>
<div class="paragraph">
<p>It also contains files and directories Gradle generates, such as <code>.gradle</code> and <code>build</code>.</p>
</div>
<div class="paragraph">
<p>While <code>.gradle</code> is usually checked into source control, the <code>build</code> directory contains the output of your builds as well as transient files Gradle uses to support features like incremental builds.</p>
</div>
<div class="paragraph">
<p>The anatomy of a typical project root directory looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>├── .gradle                 // <b class="conum">(1)</b>
│   ├── 4.8                     // <b class="conum">(2)</b>
│   ├── 4.9                     // <b class="conum">(2)</b>
│   └── ⋮
├── build                   // <b class="conum">(3)</b>
├── gradle
│   └── wrapper                 // <b class="conum">(4)</b>
├── gradle.properties       // <b class="conum">(5)</b>
├── gradlew                 // <b class="conum">(6)</b>
├── gradlew.bat             // <b class="conum">(6)</b>
├── settings.gradle.kts     // <b class="conum">(7)</b>
├── subproject-one          // <b class="conum">(8)</b>
|   └── build.gradle.kts        // <b class="conum">(9)</b>
├── subproject-two          // <b class="conum">(8)</b>
|   └── build.gradle.kts        // <b class="conum">(9)</b>
└── ⋮</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Project-specific cache directory generated by Gradle.</p>
</li>
<li>
<p>Version-specific caches (e.g., to support incremental builds).</p>
</li>
<li>
<p>The build directory of this project into which Gradle generates all build artifacts.</p>
</li>
<li>
<p>Contains the JAR file and configuration of the <a href="#gradle_wrapper_reference">Gradle Wrapper</a>.</p>
</li>
<li>
<p>Project-specific <a href="#sec:gradle_configuration_properties">Gradle configuration properties</a>.</p>
</li>
<li>
<p>Scripts for executing builds using the <a href="#gradle_wrapper_reference">Gradle Wrapper</a>.</p>
</li>
<li>
<p>The project&#8217;s <a href="#sec:settings_file_script">settings file</a> where the list of subprojects is defined.</p>
</li>
<li>
<p>Usually, a project is organized into one or multiple subprojects.</p>
</li>
<li>
<p>Each subproject has its own Gradle build script.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Consult the <a href="#dir:project_root">Gradle Directories reference</a> to learn more.</p>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#intro_multi_project_builds">Learn how to structure Multi-Project Builds</a> &gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="intro_multi_project_builds"><a class="anchor" href="#intro_multi_project_builds"></a><a class="link" href="#intro_multi_project_builds">Multi-Project Build Basics</a></h3>
<div class="paragraph">
<p>Gradle supports multi-project builds.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-basic-9.png" alt="gradle basic 9">
</div>
</div>
<div class="paragraph">
<p>While some small projects and monolithic applications may contain a single build file and source tree, it is often more common for a project to have been split into smaller, interdependent modules.
The word "interdependent" is vital, as you typically want to link the many modules together through a single build.</p>
</div>
<div class="paragraph">
<p>Gradle supports this scenario through <em>multi-project</em> builds.
This is sometimes referred to as a multi-module project.
Gradle refers to modules as subprojects.</p>
</div>
<div class="paragraph">
<p>A multi-project build consists of one root project and one or more subprojects.</p>
</div>
<div class="sect3">
<h4 id="sec:project_structure"><a class="anchor" href="#sec:project_structure"></a><a class="link" href="#sec:project_structure">Multi-Project structure</a></h4>
<div class="paragraph">
<p>The following represents the structure of a multi-project build that contains two subprojects:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/multi-project-structure.png" alt="multi project structure">
</div>
</div>
<div class="paragraph">
<p>The directory structure should look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>├── .gradle
│   └── ⋮
├── gradle
│   ├── libs.version.toml
│   └── wrapper
├── gradlew
├── gradlew.bat
├── settings.gradle.kts  // <b class="conum">(1)</b>
├── sub-project-1
│   └── build.gradle.kts // <b class="conum">(2)</b>
├── sub-project-2
│   └── build.gradle.kts // <b class="conum">(2)</b>
└── sub-project-3
    └── build.gradle.kts // <b class="conum">(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>settings.gradle.kts</code> file should include all subprojects.</p>
</li>
<li>
<p>Each subproject should have its own <code>build.gradle.kts</code> file.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="sec:project_standard"><a class="anchor" href="#sec:project_standard"></a><a class="link" href="#sec:project_standard">Multi-Project standards</a></h4>
<div class="paragraph">
<p>The Gradle community has two standards for multi-project build structures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong><a href="#sec:using_buildsrc">Multi-Project Builds using buildSrc</a></strong> - where <code>buildSrc</code> is a subproject-like directory at the Gradle project root containing all the build logic.</p>
</li>
<li>
<p><strong><a href="#composite_builds">Composite Builds</a></strong> - a build that includes other builds where <code>build-logic</code> is a build directory at the Gradle project root containing reusable build logic.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="img/multi-project-standards.png" alt="multi project standards">
</div>
</div>
<div class="sect4">
<h5 id="1_multi_project_builds_using_buildsrc"><a class="anchor" href="#1_multi_project_builds_using_buildsrc"></a><a class="link" href="#1_multi_project_builds_using_buildsrc">1. Multi-Project Builds using <code>buildSrc</code></a></h5>
<div class="paragraph">
<p>Multi-project builds allow you to organize projects with many modules, wire dependencies between those modules, and easily share common build logic amongst them.</p>
</div>
<div class="paragraph">
<p>For example, a build that has many modules called <code>mobile-app</code>, <code>web-app</code>, <code>api</code>, <code>lib</code>, and <code>documentation</code> could be structured as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">.
├── gradle
├── gradlew
├── settings.gradle.kts
├── buildSrc
│   ├── build.gradle.kts
│   └── src/main/kotlin/shared-build-conventions.gradle.kts
├── mobile-app
│   └── build.gradle.kts
├── web-app
│   └── build.gradle.kts
├── api
│   └── build.gradle.kts
├── lib
│   └── build.gradle.kts
└── documentation
    └── build.gradle.kts</code></pre>
</div>
</div>
<div class="paragraph">
<p>The modules will have dependencies between them such as <code>web-app</code> and <code>mobile-app</code> depending on <code>lib</code>.
This means that in order for Gradle to build <code>web-app</code> or <code>mobile-app</code>, it must build <code>lib</code> first.</p>
</div>
<div class="paragraph">
<p>In this example, the root settings file will look as follows:</p>
</div>
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;mobile-app&quot;, &quot;web-app&quot;, &quot;api&quot;, &quot;lib&quot;, &quot;documentation&quot;)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The order in which the subprojects (modules) are included does not matter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>buildSrc</code> directory is automatically recognized by Gradle.
It is a good place to define and maintain shared configuration or imperative build logic, such as custom tasks or plugins.</p>
</div>
<div class="paragraph">
<p><code>buildSrc</code> is automatically included in your build as a special subproject if a <code>build.gradle(.kts)</code> file is found under <code>buildSrc</code>.</p>
</div>
<div class="paragraph">
<p>If the <code>java</code> plugin is applied to the <code>buildSrc</code> project, the compiled code from <code>buildSrc/src/main/java</code> is put in the classpath of the root build script, making it available to any subproject (<code>web-app</code>, <code>mobile-app</code>, <code>lib</code>, etc&#8230;&#8203;) in the build.</p>
</div>
<div class="paragraph">
<p>Consult how to declare <a href="#sec:using_buildsrc">dependencies between subprojects</a> to learn more.</p>
</div>
</div>
<div class="sect4">
<h5 id="2_composite_builds"><a class="anchor" href="#2_composite_builds"></a><a class="link" href="#2_composite_builds">2. Composite Builds</a></h5>
<div class="paragraph">
<p>Composite Builds, also referred to as <em>included builds</em>, are best for sharing logic between builds (<em>not subprojects</em>) or isolating access to shared build logic (i.e., convention plugins).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take the previous example.
The logic in <code>buildSrc</code> has been turned into a project that contains plugins and can be published and worked on independently of the root project build.</p>
</div>
<div class="paragraph">
<p>The plugin is moved to its own build called <code>build-logic</code> with a build script and settings file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>.
├── gradle
├── gradlew
├── settings.gradle.kts
├── build-logic
│   ├── settings.gradle.kts
│   └── conventions
│       ├── build.gradle.kts
│       └── src/main/kotlin/shared-build-conventions.gradle.kts
├── mobile-app
│   └── build.gradle.kts
├── web-app
│   └── build.gradle.kts
├── api
│   └── build.gradle.kts
├── lib
│   └── build.gradle.kts
└── documentation
    └── build.gradle.kts</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The fact that <code>build-logic</code> is located in a subdirectory of the root project is irrelevant. The folder could be located outside the root project if desired.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The root settings file includes the entire <code>build-logic</code> <strong>build</strong>:</p>
</div>
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code>pluginManagement {
    includeBuild(&quot;build-logic&quot;)
}
include(&quot;mobile-app&quot;, &quot;web-app&quot;, &quot;api&quot;, &quot;lib&quot;, &quot;documentation&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consult how to <a href="#defining_composite_builds">create composite builds</a> with <code>includeBuild</code> to learn more.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:project_path"><a class="anchor" href="#sec:project_path"></a><a class="link" href="#sec:project_path">Multi-Project path</a></h4>
<div class="paragraph">
<p>A project path has the following pattern: it starts with an optional colon, which denotes the root project.</p>
</div>
<div class="paragraph">
<p>The root project, <code>:</code>, is the only project in a path not specified by its name.</p>
</div>
<div class="paragraph">
<p>The rest of a project path is a colon-separated sequence of project names, where the next project is a subproject of the previous project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>:sub-project-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see the project paths when running <code>gradle projects</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>------------------------------------------------------------
Root project 'project'
------------------------------------------------------------

Root project 'project'
+--- Project ':sub-project-1'
\--- Project ':sub-project-2'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Project paths usually reflect the filesystem layout, but there are exceptions.
Most notably for <a href="#defining_composite_builds">composite builds</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:identifying_project_structure"><a class="anchor" href="#sec:identifying_project_structure"></a><a class="link" href="#sec:identifying_project_structure">Identifying project structure</a></h4>
<div class="paragraph">
<p>You can use the <code>gradle projects</code> command to identify the project structure.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s use a multi-project build with the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; gradle -q projects</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Projects:

------------------------------------------------------------
Root project 'multiproject'
------------------------------------------------------------

Root project 'multiproject'
+--- Project ':api'
+--- Project ':services'
|    +--- Project ':services:shared'
|    \--- Project ':services:webservice'
\--- Project ':shared'

To see a list of the tasks of a project, run gradle &lt;project-path&gt;:tasks
For example, try running gradle :api:tasks</pre>
</div>
</div>
<div class="paragraph">
<p>Multi-project builds are collections of tasks you can run.
The difference is that you may want to control <em>which</em> project&#8217;s tasks get executed.</p>
</div>
<div class="paragraph">
<p>The following sections will cover your two options for executing tasks in a multi-project build.</p>
</div>
<div class="sect4">
<h5 id="sec:executing_tasks_by_name"><a class="anchor" href="#sec:executing_tasks_by_name"></a><a class="link" href="#sec:executing_tasks_by_name">Executing tasks by name</a></h5>
<div class="paragraph">
<p>The command <code>gradle test</code> will execute the <code>test</code> task in any subprojects relative to the current working directory that has that task.</p>
</div>
<div class="paragraph">
<p>If you run the command from the root project directory, you will run <code>test</code> in <em>api</em>, <em>shared</em>, <em>services:shared</em> and <em>services:webservice</em>.</p>
</div>
<div class="paragraph">
<p>If you run the command from the <em>services</em> project directory, you will only execute the task in <em>services:shared</em> and <em>services:webservice</em>.</p>
</div>
<div class="paragraph">
<p>The basic rule behind Gradle&#8217;s behavior is to <strong>execute all tasks down the hierarchy with <em>this</em> name</strong>.
And <strong>complain if there is <em>no</em> such task found</strong> in any of the subprojects traversed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Some task selectors, like <code>help</code> or <code>dependencies</code>, will only run the task on the project they are invoked on and not on all the subprojects to reduce the amount of information printed on the screen.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:executing_tasks_by_fully_qualified_name"><a class="anchor" href="#sec:executing_tasks_by_fully_qualified_name"></a><a class="link" href="#sec:executing_tasks_by_fully_qualified_name">Executing tasks by fully qualified name</a></h5>
<div class="paragraph">
<p>You can use a task&#8217;s fully qualified name to execute a specific task in a particular subproject.
For example: <code>gradle :services:webservice:build</code> will run the <code>build</code> task of the <em>webservice</em> subproject.</p>
</div>
<div class="paragraph">
<p>The fully qualified name of a task is its <a href="#sec:project_path">project path</a> plus the task name.</p>
</div>
<div class="paragraph">
<p>This approach works for any task, so if you want to know what tasks are in a particular subproject, use the <code>tasks</code> task, e.g. <code>gradle :services:webservice:tasks</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:multiproject_build_and_test"><a class="anchor" href="#sec:multiproject_build_and_test"></a><a class="link" href="#sec:multiproject_build_and_test">Multi-Project building and testing</a></h4>
<div class="paragraph">
<p>The <code>build</code> task is typically used to compile, test, and check a single project.</p>
</div>
<div class="paragraph">
<p>In multi-project builds, you may often want to do all of these tasks across various projects.
The <code>buildNeeded</code> and <code>buildDependents</code> tasks can help with this.</p>
</div>
<div class="paragraph">
<p>In <a href="#javadependencies_2">this example</a>, the <code>:services:person-service</code> project depends on both the <code>:api</code> and <code>:shared</code> projects.
The <code>:api</code> project also depends on the <code>:shared</code> project.</p>
</div>
<div class="paragraph">
<p>Assuming you are working on a single project, the <code>:api</code> project, you have been making changes but have not built the entire project since performing a <code>clean</code>.
You want to build any necessary supporting JARs but only perform code quality and unit tests on the parts of the project you have changed.</p>
</div>
<div class="paragraph">
<p>The <code>build</code> task does this:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>$ gradle :api:build

&gt; Task :shared:compileJava
&gt; Task :shared:processResources
&gt; Task :shared:classes
&gt; Task :shared:jar
&gt; Task :api:compileJava
&gt; Task :api:processResources
&gt; Task :api:classes
&gt; Task :api:jar
&gt; Task :api:assemble
&gt; Task :api:compileTestJava
&gt; Task :api:processTestResources
&gt; Task :api:testClasses
&gt; Task :api:test
&gt; Task :api:check
&gt; Task :api:build

BUILD SUCCESSFUL in 0s</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you have just gotten the latest version of the source from your version control system, which included changes in other projects that <code>:api</code> depends on, you might want to build all the projects you depend on AND test them too.</p>
</div>
<div class="paragraph">
<p>The <code>buildNeeded</code> task builds AND tests all the projects from the project dependencies of the <code>testRuntime</code> configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>$ gradle :api:buildNeeded

&gt; Task :shared:compileJava
&gt; Task :shared:processResources
&gt; Task :shared:classes
&gt; Task :shared:jar
&gt; Task :api:compileJava
&gt; Task :api:processResources
&gt; Task :api:classes
&gt; Task :api:jar
&gt; Task :api:assemble
&gt; Task :api:compileTestJava
&gt; Task :api:processTestResources
&gt; Task :api:testClasses
&gt; Task :api:test
&gt; Task :api:check
&gt; Task :api:build
&gt; Task :shared:assemble
&gt; Task :shared:compileTestJava
&gt; Task :shared:processTestResources
&gt; Task :shared:testClasses
&gt; Task :shared:test
&gt; Task :shared:check
&gt; Task :shared:build
&gt; Task :shared:buildNeeded
&gt; Task :api:buildNeeded

BUILD SUCCESSFUL in 0s</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You may want to refactor some part of the <code>:api</code> project used in other projects.
If you make these changes, testing only the <code>:api</code> project is insufficient.
You must test all projects that depend on the <code>:api</code> project.</p>
</div>
<div class="paragraph">
<p>The <code>buildDependents</code> task tests ALL the projects that have a project dependency (in the testRuntime configuration) on the specified project:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>$ gradle :api:buildDependents

&gt; Task :shared:compileJava
&gt; Task :shared:processResources
&gt; Task :shared:classes
&gt; Task :shared:jar
&gt; Task :api:compileJava
&gt; Task :api:processResources
&gt; Task :api:classes
&gt; Task :api:jar
&gt; Task :api:assemble
&gt; Task :api:compileTestJava
&gt; Task :api:processTestResources
&gt; Task :api:testClasses
&gt; Task :api:test
&gt; Task :api:check
&gt; Task :api:build
&gt; Task :services:person-service:compileJava
&gt; Task :services:person-service:processResources
&gt; Task :services:person-service:classes
&gt; Task :services:person-service:jar
&gt; Task :services:person-service:assemble
&gt; Task :services:person-service:compileTestJava
&gt; Task :services:person-service:processTestResources
&gt; Task :services:person-service:testClasses
&gt; Task :services:person-service:test
&gt; Task :services:person-service:check
&gt; Task :services:person-service:build
&gt; Task :services:person-service:buildDependents
&gt; Task :api:buildDependents

BUILD SUCCESSFUL in 0s</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Finally, you can build and test everything in all projects.
Any task you run in the root project folder will cause that same-named task to be run on all the children.</p>
</div>
<div class="paragraph">
<p>You can run <code>gradle build</code> to build and test ALL projects.</p>
</div>
<div class="paragraph">
<p>Consult the <a href="#multi_project_builds">Structuring Builds chapter</a> to learn more.</p>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#build_lifecycle">Learn about the Gradle Build Lifecycle</a> &gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build_lifecycle"><a class="anchor" href="#build_lifecycle"></a><a class="link" href="#build_lifecycle">Build Lifecycle</a></h3>
<div class="paragraph">
<p>As a build author, you define tasks and dependencies between tasks.
Gradle guarantees that these tasks will execute in order of their dependencies.</p>
</div>
<div class="paragraph">
<p>Your build scripts and plugins configure this dependency graph.</p>
</div>
<div class="paragraph">
<p>For example, if your project tasks include <code>build</code>, <code>assemble</code>, <code>createDocs</code>, your build script(s) can ensure that they are executed in the order <code>build</code> &#8594; <code>assemble</code> &#8594; <code>createDoc</code>.</p>
</div>
<div class="sect3">
<h4 id="task_graphs"><a class="anchor" href="#task_graphs"></a><a class="link" href="#task_graphs">Task Graphs</a></h4>
<div class="paragraph">
<p>Gradle builds the task graph <strong>before</strong> executing any task.</p>
</div>
<div class="paragraph">
<p>Across all projects in the build, tasks form a <a href="http://en.wikipedia.org/wiki/Directed_acyclic_graph" target="_blank" rel="noopener">Directed Acyclic Graph</a> (DAG).</p>
</div>
<div class="paragraph">
<p>This diagram shows two example task graphs, one abstract and the other concrete, with dependencies between tasks represented as arrows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/task-dag-examples.png" alt="task dag examples">
</div>
</div>
<div id="build_lifecycle_events" class="paragraph">
<p>Both plugins and build scripts contribute to the task graph via the <a href="#sec:task_dependencies">task dependency mechanism</a> and <a href="#sec:task_inputs_outputs">annotated inputs/outputs</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:build_phases"><a class="anchor" href="#sec:build_phases"></a><a class="link" href="#sec:build_phases">Build Phases</a></h4>
<div class="paragraph">
<p>A Gradle build has three distinct phases.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/author-gradle-1.png" alt="author gradle 1">
</div>
</div>
<div class="paragraph">
<p>Gradle runs these phases in order:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Phase 1. Initialization</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Detects the <code>settings.gradle(.kts)</code> file.</p>
</li>
<li>
<p>Creates a <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.initialization.Settings.html"><code>Settings</code></a> instance.</p>
</li>
<li>
<p>Evaluates the settings file to determine which projects (and included builds) make up the build.</p>
</li>
<li>
<p>Creates a <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html"><code>Project</code></a> instance for every project.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Phase 2. Configuration</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Evaluates the build scripts, <code>build.gradle(.kts)</code>, of every project participating in the build.</p>
</li>
<li>
<p>Creates a task graph for requested tasks.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Phase 3. Execution</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Schedules and executes the selected tasks.</p>
</li>
<li>
<p>Dependencies between tasks determine execution order.</p>
</li>
<li>
<p>Execution of tasks can occur in parallel.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="img/build-lifecycle-example.png" alt="build lifecycle example">
</div>
</div>
<div class="sect4">
<h5 id="example"><a class="anchor" href="#example"></a><a class="link" href="#example">Example</a></h5>
<div class="paragraph">
<p>The following example shows which parts of settings and build files correspond to various build phases:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;basic&quot;
println(&quot;This is executed during the initialization phase.&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">println(&quot;This is executed during the configuration phase.&quot;)

tasks.register(&quot;configured&quot;) {
    println(&quot;This is also executed during the configuration phase, because :configured is used in the build.&quot;)
}

tasks.register(&quot;test&quot;) {
    doLast {
        println(&quot;This is executed during the execution phase.&quot;)
    }
}

tasks.register(&quot;testBoth&quot;) {
    doFirst {
        println(&quot;This is executed first during the execution phase.&quot;)
    }
    doLast {
        println(&quot;This is executed last during the execution phase.&quot;)
    }
    println(&quot;This is executed during the configuration phase as well, because :testBoth is used in the build.&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">basic</span><span class="delimiter">'</span></span>
println <span class="string"><span class="delimiter">'</span><span class="content">This is executed during the initialization phase.</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println <span class="string"><span class="delimiter">'</span><span class="content">This is executed during the configuration phase.</span><span class="delimiter">'</span></span>

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">configured</span><span class="delimiter">'</span></span>) {
    println <span class="string"><span class="delimiter">'</span><span class="content">This is also executed during the configuration phase, because :configured is used in the build.</span><span class="delimiter">'</span></span>
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>) {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">This is executed during the execution phase.</span><span class="delimiter">'</span></span>
    }
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">testBoth</span><span class="delimiter">'</span></span>) {
        doFirst {
          println <span class="string"><span class="delimiter">'</span><span class="content">This is executed first during the execution phase.</span><span class="delimiter">'</span></span>
        }
        doLast {
          println <span class="string"><span class="delimiter">'</span><span class="content">This is executed last during the execution phase.</span><span class="delimiter">'</span></span>
        }
        println <span class="string"><span class="delimiter">'</span><span class="content">This is executed during the configuration phase as well, because :testBoth is used in the build.</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following command executes the <code>test</code> and <code>testBoth</code> tasks specified above.
Because Gradle only configures requested tasks and their dependencies, the <code>configured</code> task never configures:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">&gt; gradle test testBoth
This is executed during the initialization phase.

&gt; Configure project :
This is executed during the configuration phase.
This is executed during the configuration phase as well, because :testBoth is used in the build.

&gt; Task :test
This is executed during the execution phase.

&gt; Task :testBoth
This is executed first during the execution phase.
This is executed last during the execution phase.

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&gt; gradle test testBoth
This is executed during the initialization phase.

&gt; Configure project :
This is executed during the configuration phase.
This is executed during the configuration phase <span class="keyword">as</span> well, because :testBoth is used <span class="keyword">in</span> the build.

&gt; Task :test
This is executed during the execution phase.

&gt; Task :testBoth
This is executed first during the execution phase.
This is executed last during the execution phase.

BUILD SUCCESSFUL <span class="keyword">in</span> <span class="integer">0</span>s
<span class="integer">2</span> actionable <span class="key">tasks</span>: <span class="integer">2</span> executed</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:initialization"><a class="anchor" href="#sec:initialization"></a><a class="link" href="#sec:initialization">Phase 1. Initialization</a></h4>
<div class="paragraph">
<p>In the <strong>initialization phase</strong>, Gradle detects the set of projects (root and subprojects) and included builds participating in the build.</p>
</div>
<div class="paragraph">
<p>Gradle first evaluates the settings file, <code>settings.gradle(.kts)</code>, and instantiates a <code>Settings</code> object.
Then, Gradle instantiates <code>Project</code> instances for each project.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuration"><a class="anchor" href="#sec:configuration"></a><a class="link" href="#sec:configuration">Phase 2. Configuration</a></h4>
<div class="paragraph">
<p>In the <strong>configuration phase</strong>, Gradle adds tasks and other properties to the projects found by the initialization phase.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:execution"><a class="anchor" href="#sec:execution"></a><a class="link" href="#sec:execution">Phase 3. Execution</a></h4>
<div class="paragraph">
<p>In the <strong>execution phase</strong>, Gradle runs tasks.</p>
</div>
<div class="paragraph">
<p>Gradle uses the task execution graphs generated by the configuration phase to determine which tasks to execute.</p>
</div>
<div id="sec:task_execution" class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#writing_settings_files">Learn how to write Settings files</a> &gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="writing_settings_files"><a class="anchor" href="#writing_settings_files"></a><a class="link" href="#writing_settings_files">Writing Settings Files</a></h3>
<div class="paragraph">
<p>The settings file is the entry point of every Gradle build.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/author-gradle-7.png" alt="author gradle 7">
</div>
</div>
<div class="paragraph">
<p>Early in the Gradle Build lifecycle, the <a href="#sec:initialization">initialization phase</a> finds the settings file in your <a href="#dir:project_root">project root directory</a>.</p>
</div>
<div class="paragraph">
<p>When the settings file <code>settings.gradle(.kts)</code> is found, Gradle instantiates a <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.initialization.Settings.html"><code>Settings</code></a> object.</p>
</div>
<div class="paragraph">
<p>One of the purposes of the <code>Settings</code> object is to allow you to declare all the projects to be included in the build.</p>
</div>
<div class="sect3">
<h4 id="sec:settings_script"><a class="anchor" href="#sec:settings_script"></a><a class="link" href="#sec:settings_script">Settings Scripts</a></h4>
<div class="paragraph">
<p>The settings script is either a <code>settings.gradle</code> file in Groovy or a <code>settings.gradle.kts</code> file in Kotlin.</p>
</div>
<div class="paragraph">
<p>Before Gradle assembles the projects for a build, it creates a <code>Settings</code> instance and executes the settings file against it.</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="img/author-gradle-3.png" alt="Settings" width="500" height="63">
</div>
</div>
<div class="paragraph">
<p>As the settings script executes, it configures this <code>Settings</code>.
Therefore, the <em>settings file</em> defines the <code>Settings</code> object.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
There is a one-to-one correspondence between a <code>Settings</code> instance and a <code>settings.gradle(.kts)</code> file.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="the_settings_object"><a class="anchor" href="#the_settings_object"></a><a class="link" href="#the_settings_object">The <code>Settings</code> Object</a></h4>
<div class="paragraph">
<p>The <code>Settings</code> object is part of the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/initialization/Settings.html">Gradle API</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Groovy DSL, the <code>Settings</code> object documentation is found <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.initialization.Settings.html">here</a>.</p>
</li>
<li>
<p>In the Kotlin DSL, the <code>Settings</code> object documentation is found <a href="https://docs.gradle.org/8.9/kotlin-dsl/gradle/org.gradle.api.initialization/-settings/index.html">here</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Many top-level properties and blocks in a settings script are part of the Settings API.</p>
</div>
<div class="paragraph">
<p>For example, we can set the root project name in the settings script using the <code>Settings.rootProject</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">settings.rootProject.name = &quot;root&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which is usually shortened to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;root&quot;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="sec:standard_settings_properties"><a class="anchor" href="#sec:standard_settings_properties"></a><a class="link" href="#sec:standard_settings_properties">Standard <code>Settings</code> properties</a></h5>
<div class="paragraph">
<p>The <code>Settings</code> object exposes a standard set of properties in your settings script.</p>
</div>
<div class="paragraph">
<p>The following table lists a few commonly used properties:</p>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>buildCache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The build cache configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plugins</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The container of plugins that have been applied to the settings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rootDir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The root directory of the build. The root directory is the project directory of the root project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rootProject</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The root project of the build.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>settings</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns this settings object.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table lists a few commonly used methods:</p>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>include()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds the given projects to the build.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeBuild()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes a build at the specified path to the composite build.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="settings_script_structure"><a class="anchor" href="#settings_script_structure"></a><a class="link" href="#settings_script_structure">Settings Script structure</a></h4>
<div class="paragraph">
<p>A Settings script is a series of method calls to the Gradle API that often use <code>{ &#8230;&#8203; }</code>, a special shortcut in both the Groovy and Kotlin languages.
A <code>{ }</code> block is called a <em>lambda</em> in Kotlin or a <em>closure</em> in Groovy.</p>
</div>
<div class="paragraph">
<p>Simply put, the <code>plugins{ }</code> block is a method invocation in which a Kotlin <em>lambda</em> object or Groovy <em>closure</em> object is passed as the argument.
It is the short form for:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins(function() {
    id(&quot;plugin&quot;)
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Blocks are mapped to Gradle API methods.</p>
</div>
<div class="paragraph">
<p>The code inside the function is executed against a <code>this</code> object called a <em>receiver</em> in Kotlin lambda and a <em>delegate</em> in Groovy closure.
Gradle determines the correct <code>this</code> object and invokes the correct corresponding method.
The <code>this</code> of the method invocation <code>id("plugin")</code> object is of type <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/plugin/use/PluginDependenciesSpec.html"><code>PluginDependenciesSpec</code></a>.</p>
</div>
<div class="paragraph">
<p>The settings file is composed of Gradle API calls built on top of the DSLs.
Gradle executes the script line by line, top to bottom.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at an example and break it down:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {                                          // <b class="conum">(1)</b>
    repositories {
        gradlePluginPortal()
        google()
    }
}

plugins {                                                   // <b class="conum">(2)</b>
    id(&quot;org.gradle.toolchains.foojay-resolver-convention&quot;) version &quot;0.8.0&quot;
}

rootProject.name = &quot;root-project&quot;                           // <b class="conum">(3)</b>

dependencyResolutionManagement {                            // <b class="conum">(4)</b>
    repositories {
        mavenCentral()
    }
}

include(&quot;sub-project-a&quot;)                                    // <b class="conum">(5)</b>
include(&quot;sub-project-b&quot;)
include(&quot;sub-project-c&quot;)</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Define the location of plugins</p>
</li>
<li>
<p>Apply settings plugins.</p>
</li>
<li>
<p>Define the root project name.</p>
</li>
<li>
<p>Define dependency resolution strategies.</p>
</li>
<li>
<p>Add subprojects to the build.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {                                          // <b class="conum">(1)</b>
    repositories {
        gradlePluginPortal()
        google()
    }
}

plugins {                                                   // <b class="conum">(2)</b>
    id <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.toolchains.foojay-resolver-convention</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">0.8.0</span><span class="delimiter">'</span></span>
}

rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">root-project</span><span class="delimiter">'</span></span>                           // <b class="conum">(3)</b>

dependencyResolutionManagement {                            // <b class="conum">(4)</b>
    repositories {
        mavenCentral()
    }
}

include(<span class="string"><span class="delimiter">'</span><span class="content">sub-project-a</span><span class="delimiter">'</span></span>)                                    // <b class="conum">(5)</b>
include(<span class="string"><span class="delimiter">'</span><span class="content">sub-project-b</span><span class="delimiter">'</span></span>)
include(<span class="string"><span class="delimiter">'</span><span class="content">sub-project-c</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Define the location of plugins.</p>
</li>
<li>
<p>Apply settings plugins.</p>
</li>
<li>
<p>Define the root project name.</p>
</li>
<li>
<p>Define dependency resolution strategies.</p>
</li>
<li>
<p>Add subprojects to the build.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="1_define_the_location_of_plugins"><a class="anchor" href="#1_define_the_location_of_plugins"></a><a class="link" href="#1_define_the_location_of_plugins">1. Define the location of plugins</a></h5>
<div class="paragraph">
<p>The settings file can optionally manage plugin versions and repositories for your build with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/plugin/management/PluginManagementSpec.html"><code>pluginManagement</code></a>
It provides a centralized way to define which plugins should be used in your project and from which repositories they should be resolved.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    repositories {
        gradlePluginPortal()
        google()
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2_apply_settings_plugins"><a class="anchor" href="#2_apply_settings_plugins"></a><a class="link" href="#2_apply_settings_plugins">2. Apply settings plugins</a></h5>
<div class="paragraph">
<p>The settings file can optionally <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/plugin/use/PluginDependenciesSpec.html">apply plugins</a> that are required for configuring the settings of the project.
These are commonly the <a href="https://plugins.gradle.org/plugin/com.gradle.develocity">Develocity plugin</a> and the <a href="https://plugins.gradle.org/plugin/org.gradle.toolchains.foojay-resolver-convention">Toolchain Resolver plugin</a> in the example below.</p>
</div>
<div class="paragraph">
<p>Plugins applied in the settings file only affect the <code>Settings</code> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
  id(&quot;org.gradle.toolchains.foojay-resolver-convention&quot;) version &quot;0.8.0&quot;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="3_define_the_root_project_name"><a class="anchor" href="#3_define_the_root_project_name"></a><a class="link" href="#3_define_the_root_project_name">3. Define the root project name</a></h5>
<div class="paragraph">
<p>The settings file defines your project name using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/initialization/ProjectDescriptor.html"><code>rootProject.name</code> property</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;root-project&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is only one root project per build.</p>
</div>
</div>
<div class="sect4">
<h5 id="4_define_dependency_resolution_strategies"><a class="anchor" href="#4_define_dependency_resolution_strategies"></a><a class="link" href="#4_define_dependency_resolution_strategies">4. Define dependency resolution strategies</a></h5>
<div class="paragraph">
<p>The settings file can optionally <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/initialization/resolve/DependencyResolutionManagement.html">define rules and configurations</a> for dependency resolution across your project(s).
It provides a centralized way to manage and customize dependency resolution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.PREFER_PROJECT)
    repositories {
        mavenCentral()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also include version catalogs in this section.</p>
</div>
</div>
<div class="sect4">
<h5 id="5_add_subprojects_to_the_build"><a class="anchor" href="#5_add_subprojects_to_the_build"></a><a class="link" href="#5_add_subprojects_to_the_build">5. Add subprojects to the build</a></h5>
<div class="paragraph">
<p>The settings file defines the structure of the project by adding all the subprojects using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/initialization/Settings.html"><code>include</code></a> statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;app&quot;)
include(&quot;business-logic&quot;)
include(&quot;data-model&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also include entire builds using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/initialization/IncludedBuild.html"><code>includeBuild</code></a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="settings_file_scripting"><a class="anchor" href="#settings_file_scripting"></a><a class="link" href="#settings_file_scripting">Settings File Scripting</a></h4>
<div class="paragraph">
<p>There are many more properties and methods on the <code>Settings</code> object that you can use to configure your build.</p>
</div>
<div class="paragraph">
<p>It&#8217;s important to remember that while many Gradle scripts are typically written in short Groovy or Kotlin syntax, every item in the settings script is essentially invoking a method on the <code>Settings</code> object in the Gradle API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;app&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Is actually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">settings.include(&quot;app&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, the full power of the Groovy and Kotlin languages is available to you.</p>
</div>
<div class="paragraph">
<p>For example, instead of using <code>include</code> many times to add subprojects, you can iterate over the list of directories in the project root folder and include them automatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootDir.listFiles().filter { it.isDirectory &amp;&amp; (new File(it, &quot;build.gradle.kts&quot;).exists()) }.forEach {
    include(it.name)
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
This type of logic should be developed in a plugin.
</td>
</tr>
</table>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#writing_build_scripts">Learn how to write Build scripts</a> &gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="writing_build_scripts"><a class="anchor" href="#writing_build_scripts"></a><a class="link" href="#writing_build_scripts">Writing Build Scripts</a></h3>
<div class="paragraph">
<p>The initialization phase in the Gradle Build lifecycle finds the root project and subprojects included in your <a href="#dir:project_root">project root directory</a> using the settings file.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/author-gradle-6.png" alt="author gradle 6">
</div>
</div>
<div class="paragraph">
<p>Then, for each project included in the settings file, Gradle creates a <a href="https://docs.gradle.org/8.9/javadocorg/gradle/api/Project.html"><code>Project</code></a> instance.</p>
</div>
<div class="paragraph">
<p>Gradle then looks for a corresponding build script file, which is used in the configuration phase.</p>
</div>
<div class="sect3">
<h4 id="build_scripts_2"><a class="anchor" href="#build_scripts_2"></a><a class="link" href="#build_scripts_2">Build Scripts</a></h4>
<div class="paragraph">
<p>Every Gradle build comprises one or more <strong>projects</strong>; a <em>root</em> project and <em>subprojects</em>.</p>
</div>
<div class="paragraph">
<p>A project typically corresponds to a software component that needs to be built, like a library or an application.
It might represent a library JAR, a web application, or a distribution ZIP assembled from the JARs produced by other projects.</p>
</div>
<div class="paragraph">
<p>On the other hand, it might represent a thing to be done, such as deploying your application to staging or production environments.</p>
</div>
<div class="paragraph">
<p>Gradle scripts are written in either Groovy DSL or Kotlin DSL (domain-specific language).</p>
</div>
<div class="paragraph">
<p>A <strong>build script</strong> configures a <strong>project</strong> and is associated with an object of type <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Project.html"><code>Project</code></a>.</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="img/author-gradle-4.png" alt="Build" width="500" height="63">
</div>
</div>
<div class="paragraph">
<p>As the build script executes, it configures <code>Project</code>.</p>
</div>
<div class="paragraph">
<p>The build script is either a <code>*.gradle</code> file in Groovy or a <code>*.gradle.kts</code> file in Kotlin.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<em>Build scripts</em> configure <code>Project</code> objects and their children.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="the_project_object"><a class="anchor" href="#the_project_object"></a><a class="link" href="#the_project_object">The <code>Project</code> object</a></h4>
<div class="paragraph">
<p>The <code>Project</code> object is part of the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Project.html">Gradle API</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Groovy DSL, the <code>Project</code> object documentation is found <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html">here</a>.</p>
</li>
<li>
<p>In the Kotlin DSL, the <code>Project</code> object documentation is found <a href="https://docs.gradle.org/8.9/kotlin-dsl/gradle/org.gradle.api/-project/index.html">here</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Many top-level properties and blocks in a build script are part of the Project API.</p>
</div>
<div class="paragraph">
<p>For example, the following build script uses the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:name">Project.name</a> property to print the name of the project:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">println(name)
println(project.name)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println name
println project.name</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q check
project-api
project-api</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Both <code>println</code> statements print out the same property.</p>
</div>
<div class="paragraph">
<p>The first uses the top-level reference to the <code>name</code> property of the <code>Project</code> object.
The second statement uses the <code>project</code> property available to any build script, which returns the associated <code>Project</code> object.</p>
</div>
<div class="sect4">
<h5 id="sec:standard_project_properties"><a class="anchor" href="#sec:standard_project_properties"></a><a class="link" href="#sec:standard_project_properties">Standard project properties</a></h5>
<div class="paragraph">
<p>The <code>Project</code> object exposes a standard set of properties in your build script.</p>
</div>
<div class="paragraph">
<p>The following table lists a few commonly used properties:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the project directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully qualified name of the project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A description for the project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dependencies</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DependencyHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the dependency handler of the project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repositories</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RepositoryHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the repository handler of the project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>layout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ProjectLayout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides access to several important locations for a project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The group of this project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version of this project.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table lists a few commonly used methods:</p>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uri()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolves a file path to a URI, relative to the project directory of this project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>task()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a Task with the given name and adds it to this project.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="build_script_structure"><a class="anchor" href="#build_script_structure"></a><a class="link" href="#build_script_structure">Build Script structure</a></h4>
<div class="paragraph">
<p>The Build script is composed of <code>{ &#8230;&#8203; }</code>, a special object in both Groovy and Kotlin.
This object is called a <em>lambda</em> in Kotlin or a <em>closure</em> in Groovy.</p>
</div>
<div class="paragraph">
<p>Simply put, the <code>plugins{ }</code> block is a method invocation in which a Kotlin <em>lambda</em> object or Groovy <em>closure</em> object is passed as the argument.
It is the short form for:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>plugins(function() {
    id(&quot;plugin&quot;)
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Blocks are mapped to Gradle API methods.</p>
</div>
<div class="paragraph">
<p>The code inside the function is executed against a <code>this</code> object called a <em>receiver</em> in Kotlin lambda and a <em>delegate</em> in Groovy closure.
Gradle determines the correct <code>this</code> object and invokes the correct corresponding method.
The <code>this</code> of the method invocation <code>id("plugin")</code> object is of type <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/plugin/use/PluginDependenciesSpec.html"><code>PluginDependenciesSpec</code></a>.</p>
</div>
<div class="paragraph">
<p>The build script is essentially composed of Gradle API calls built on top of the DSLs.
Gradle executes the script line by line, top to bottom.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at an example and break it down:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {                                                               // <b class="conum">(1)</b>
    id(&quot;org.jetbrains.kotlin.jvm&quot;) version &quot;1.9.0&quot;
    id(&quot;application&quot;)
}

repositories {                                                          // <b class="conum">(2)</b>
    mavenCentral()
}

dependencies {                                                          // <b class="conum">(3)</b>
    testImplementation(&quot;org.jetbrains.kotlin:kotlin-test-junit5&quot;)
    testImplementation(&quot;org.junit.jupiter:junit-jupiter-engine:5.9.3&quot;)
    testRuntimeOnly(&quot;org.junit.platform:junit-platform-launcher&quot;)
    implementation(&quot;com.google.guava:guava:32.1.1-jre&quot;)
}

application {                                                           // <b class="conum">(4)</b>
    mainClass = &quot;com.example.Main&quot;
}

tasks.named&lt;Test&gt;(&quot;test&quot;) {                                             // <b class="conum">(5)</b>
    useJUnitPlatform()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Apply plugins to the build.</p>
</li>
<li>
<p>Define the locations where dependencies can be found.</p>
</li>
<li>
<p>Add dependencies.</p>
</li>
<li>
<p>Set properties.</p>
</li>
<li>
<p>Register and configure tasks.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {                                                               // <b class="conum">(1)</b>
    id <span class="string"><span class="delimiter">'</span><span class="content">org.jetbrains.kotlin.jvm</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">1.9.0</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">application</span><span class="delimiter">'</span></span>
}

repositories {                                                          // <b class="conum">(2)</b>
    mavenCentral()
}

dependencies {                                                          // <b class="conum">(3)</b>
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.jetbrains.kotlin:kotlin-test-junit5</span><span class="delimiter">'</span></span>
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.junit.jupiter:junit-jupiter-engine:5.9.3</span><span class="delimiter">'</span></span>
    testRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.platform:junit-platform-launcher</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:32.1.1-jre</span><span class="delimiter">'</span></span>
}

application {                                                           // <b class="conum">(4)</b>
    mainClass = <span class="string"><span class="delimiter">'</span><span class="content">com.example.Main</span><span class="delimiter">'</span></span>
}

tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>) {                                                   // <b class="conum">(5)</b>
    useJUnitPlatform()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Apply plugins to the build.</p>
</li>
<li>
<p>Define the locations where dependencies can be found.</p>
</li>
<li>
<p>Add dependencies.</p>
</li>
<li>
<p>Set properties.</p>
</li>
<li>
<p>Register and configure tasks.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="1_apply_plugins_to_the_build"><a class="anchor" href="#1_apply_plugins_to_the_build"></a><a class="link" href="#1_apply_plugins_to_the_build">1. Apply plugins to the build</a></h5>
<div class="paragraph">
<p>Plugins are used to extend Gradle. They are also used to modularize and reuse project configurations.</p>
</div>
<div class="paragraph">
<p>Plugins can be applied using the <code>PluginDependenciesSpec</code> plugins script block.</p>
</div>
<div class="paragraph">
<p>The plugins block is preferred:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>plugins {
    id(&quot;org.jetbrains.kotlin.jvm&quot;) version &quot;1.9.0&quot;
    id(&quot;application&quot;)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example, the <code>application</code> plugin, which is included with Gradle, has been applied, describing our project as a Java application.</p>
</div>
<div class="paragraph">
<p>The Kotlin gradle plugin, version 1.9.0, has also been applied.
This plugin is not included with Gradle and, therefore, has to be described using a <code>plugin id</code> and a <code>plugin version</code> so that Gradle can find and apply it.</p>
</div>
</div>
<div class="sect4">
<h5 id="2_define_the_locations_where_dependencies_can_be_found"><a class="anchor" href="#2_define_the_locations_where_dependencies_can_be_found"></a><a class="link" href="#2_define_the_locations_where_dependencies_can_be_found">2. Define the locations where dependencies can be found</a></h5>
<div class="paragraph">
<p>A project generally has a number of dependencies it needs to do its work.
Dependencies include plugins, libraries, or components that Gradle must download for the build to succeed.</p>
</div>
<div class="paragraph">
<p>The build script lets Gradle know where to look for the binaries of the dependencies.
More than one location can be provided:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>repositories {
    mavenCentral()
    google()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example, the <code>guava</code> library and the JetBrains Kotlin plugin (<code>org.jetbrains.kotlin.jvm</code>) will be downloaded from the <a href="https://repo.maven.apache.org/maven2/">Maven Central Repository</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="3_add_dependencies"><a class="anchor" href="#3_add_dependencies"></a><a class="link" href="#3_add_dependencies">3. Add dependencies</a></h5>
<div class="paragraph">
<p>A project generally has a number of dependencies it needs to do its work.
These dependencies are often libraries of precompiled classes that are imported in the project&#8217;s source code.</p>
</div>
<div class="paragraph">
<p>Dependencies are managed via <a href="#sub:terminology_configuration">configurations</a> and are retrieved from repositories.</p>
</div>
<div class="paragraph">
<p>Use the <code>DependencyHandler</code> returned by <code>Project.getDependencies()</code> method to manage the dependencies.
Use the <code>RepositoryHandler</code> returned by <code>Project.getRepositories()</code> method to manage the repositories.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>dependencies {
    implementation(&quot;com.google.guava:guava:32.1.1-jre&quot;)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example, the application code uses Google&#8217;s <code>guava</code> libraries.
Guava provides utility methods for collections, caching, primitives support, concurrency, common annotations, string processing, I/O, and validations.</p>
</div>
</div>
<div class="sect4">
<h5 id="4_set_properties"><a class="anchor" href="#4_set_properties"></a><a class="link" href="#4_set_properties">4. Set properties</a></h5>
<div class="paragraph">
<p>A plugin can add properties and methods to a project using extensions.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html"><code>Project</code></a> object has an associated <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/plugins/ExtensionContainer.html"><code>ExtensionContainer</code></a> object that contains all the settings and properties for the plugins that have been applied to the project.</p>
</div>
<div class="paragraph">
<p>In the example, the <code>application</code> plugin added an <code>application</code> property, which is used to detail the main class of our Java application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>application {
    mainClass = &quot;com.example.Main&quot;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="5_register_and_configure_tasks"><a class="anchor" href="#5_register_and_configure_tasks"></a><a class="link" href="#5_register_and_configure_tasks">5. Register and configure tasks</a></h5>
<div class="paragraph">
<p>Tasks perform some basic piece of work, such as compiling classes, or running unit tests, or zipping up a WAR file.</p>
</div>
<div class="paragraph">
<p>While tasks are typically defined in plugins, you may need to register or configure tasks in build scripts.</p>
</div>
<div class="paragraph">
<p><strong>Registering</strong> a task adds the task to your project.</p>
</div>
<div class="paragraph">
<p>You can register tasks in a project using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskContainer.html"><code>TaskContainer.register(java.lang.String)</code></a> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>tasks.register&lt;Zip&gt;(&quot;zip-reports&quot;) {
    from 'Reports/'
    include '*'
    archiveName 'Reports.zip'
    destinationDir(file('/dir'))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may have seen usage of the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskContainer.html"><code>TaskContainer.create(java.lang.String)</code></a> method <strong>which should be avoided</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>tasks.create&lt;Zip&gt;(&quot;zip-reports&quot;) {
    from 'Reports/'
    include '*'
    archiveName 'Reports.zip'
    destinationDir(file('/dir'))
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<code>register()</code>, which enables <a href="task_configuration_avoidance.html#task_configuration_avoidance">task configuration avoidance</a>, is preferred over <code>create()</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can locate a task to configure it using the <code>TaskCollection.named(java.lang.String)</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>tasks.named&lt;Test&gt;(&quot;test&quot;) {
    useJUnitPlatform()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example below configures the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.javadoc.Javadoc.html"><code>Javadoc</code></a> task to automatically generate HTML documentation from Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>tasks.named(&quot;javadoc&quot;).configure {
    exclude 'app/Internal*.java'
    exclude 'app/internal/*'
    exclude 'app/internal/*'
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="build_scripting"><a class="anchor" href="#build_scripting"></a><a class="link" href="#build_scripting">Build Scripting</a></h4>
<div class="paragraph">
<p>A build script is made up of zero or more statements and script blocks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>println(project.layout.projectDirectory);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Statements can include method calls, property assignments, and local variable definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>version = '1.0.0.GA'</code></pre>
</div>
</div>
<div class="paragraph">
<p>A script block is a method call which takes a closure/lambda as a parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>configurations {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The closure/lambda configures some delegate object as it executes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>repositories {
    google()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A build script is also a Groovy or a Kotlin script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;upper&quot;) {
    doLast {
        val someString = &quot;mY_nAmE&quot;
        println(&quot;Original: $someString&quot;)
        println(&quot;Upper case: ${someString.toUpperCase()}&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">upper</span><span class="delimiter">'</span></span>) {
    doLast {
        <span class="predefined-type">String</span> someString = <span class="string"><span class="delimiter">'</span><span class="content">mY_nAmE</span><span class="delimiter">'</span></span>
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Original: </span><span class="inline"><span class="inline-delimiter">$</span>someString</span><span class="delimiter">&quot;</span></span>
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Upper case: </span><span class="inline"><span class="inline-delimiter">${</span>someString.toUpperCase()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q upper
Original: mY_nAmE
Upper case: MY_NAME</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It can contain elements allowed in a Groovy or Kotlin script, such as method definitions and class definitions:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;count&quot;) {
    doLast {
        repeat(4) { print(&quot;$it &quot;) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">count</span><span class="delimiter">'</span></span>) {
    doLast {
        <span class="integer">4</span>.times { print <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span><span class="local-variable">it</span></span><span class="content"> </span><span class="delimiter">&quot;</span></span> }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q count
0 1 2 3 </pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:dynamic_tasks"><a class="anchor" href="#sec:dynamic_tasks"></a><a class="link" href="#sec:dynamic_tasks">Flexible task registration</a></h5>
<div class="paragraph">
<p>Using the capabilities of the Groovy or Kotlin language, you can register multiple tasks in a loop:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repeat(4) { counter -&gt;
    tasks.register(&quot;task$counter&quot;) {
        doLast {
            println(&quot;I'm task number $counter&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="integer">4</span>.times { counter -&gt;
    tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">task</span><span class="inline"><span class="inline-delimiter">$</span>counter</span><span class="delimiter">&quot;</span></span>) {
        doLast {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm task number </span><span class="inline"><span class="inline-delimiter">$</span>counter</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q task1
I'm task number 1</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:declaring_variables"><a class="anchor" href="#sec:declaring_variables"></a><a class="link" href="#sec:declaring_variables">Declare Variables</a></h5>
<div class="paragraph">
<p>Build scripts can declare two variables: <strong>local variables</strong> and <strong>extra properties</strong>.</p>
</div>
<div class="sect5">
<h6 id="sec:local_variables"><a class="anchor" href="#sec:local_variables"></a><a class="link" href="#sec:local_variables">Local Variables</a></h6>
<div class="paragraph multi-language-text lang-kotlin">
<p>Declare local variables with the <code>val</code> keyword. Local variables are only visible in the scope where they have been declared. They are a feature of the underlying Kotlin language.</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>Declare local variables with the <code>def</code> keyword. Local variables are only visible in the scope where they have been declared. They are a feature of the underlying Groovy language.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val dest = &quot;dest&quot;

tasks.register&lt;Copy&gt;(&quot;copy&quot;) {
    from(&quot;source&quot;)
    into(dest)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> dest = <span class="string"><span class="delimiter">'</span><span class="content">dest</span><span class="delimiter">'</span></span>

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copy</span><span class="delimiter">'</span></span>, Copy) {
    from <span class="string"><span class="delimiter">'</span><span class="content">source</span><span class="delimiter">'</span></span>
    into dest
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:extra_properties"><a class="anchor" href="#sec:extra_properties"></a><a class="link" href="#sec:extra_properties">Extra Properties</a></h6>
<div class="paragraph">
<p>Gradle&#8217;s enhanced objects, including projects, tasks, and source sets, can hold user-defined properties.</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>Add, read, and set extra properties via the owning object&#8217;s <code>extra</code> property. Alternatively, you can access extra properties via Kotlin delegated properties using <code>by extra</code>.</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>Add, read, and set extra properties via the owning object&#8217;s <code>ext</code> property. Alternatively, you can use an <code>ext</code> block to add multiple properties simultaneously.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;java-library&quot;)
}

val springVersion by extra(&quot;3.1.0.RELEASE&quot;)
val emailNotification by extra { &quot;build@master.org&quot; }

sourceSets.all { extra[&quot;purpose&quot;] = null }

sourceSets {
    main {
        extra[&quot;purpose&quot;] = &quot;production&quot;
    }
    test {
        extra[&quot;purpose&quot;] = &quot;test&quot;
    }
    create(&quot;plugin&quot;) {
        extra[&quot;purpose&quot;] = &quot;production&quot;
    }
}

tasks.register(&quot;printProperties&quot;) {
    val springVersion = springVersion
    val emailNotification = emailNotification
    val productionSourceSets = provider {
        sourceSets.matching { it.extra[&quot;purpose&quot;] == &quot;production&quot; }.map { it.name }
    }
    doLast {
        println(springVersion)
        println(emailNotification)
        productionSourceSets.get().forEach { println(it) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

ext {
    springVersion = <span class="string"><span class="delimiter">&quot;</span><span class="content">3.1.0.RELEASE</span><span class="delimiter">&quot;</span></span>
    emailNotification = <span class="string"><span class="delimiter">&quot;</span><span class="content">build@master.org</span><span class="delimiter">&quot;</span></span>
}

sourceSets.all { ext.purpose = <span class="predefined-constant">null</span> }

sourceSets {
    main {
        purpose = <span class="string"><span class="delimiter">&quot;</span><span class="content">production</span><span class="delimiter">&quot;</span></span>
    }
    test {
        purpose = <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>
    }
    plugin {
        purpose = <span class="string"><span class="delimiter">&quot;</span><span class="content">production</span><span class="delimiter">&quot;</span></span>
    }
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">printProperties</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> springVersion = springVersion
    <span class="keyword">def</span> emailNotification = emailNotification
    <span class="keyword">def</span> productionSourceSets = provider {
        sourceSets.matching { <span class="local-variable">it</span>.purpose == <span class="string"><span class="delimiter">&quot;</span><span class="content">production</span><span class="delimiter">&quot;</span></span> }.collect { <span class="local-variable">it</span>.name }
    }
    doLast {
        println springVersion
        println emailNotification
        productionSourceSets.get().each { println <span class="local-variable">it</span> }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q printProperties
3.1.0.RELEASE
build@master.org
main
plugin</pre>
</div>
</div>
</div>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>This example adds two extra properties to the <code>project</code> object via <code>by extra</code>. Additionally, this example adds a property named <code>purpose</code> to each source set by setting <code>extra["purpose"]</code> to <code>null</code>. Once added, you can read and set these properties via <code>extra</code>.</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>This example adds two extra properties to the <code>project</code> object via an <code>ext</code> block. Additionally, this example adds a property named <code>purpose</code> to each source set by setting <code>ext.purpose</code> to <code>null</code>. Once added, you can read and set all these properties just like predefined ones.</p>
</div>
<div class="paragraph">
<p>Gradle requires special syntax for adding a property so that it can fail fast. For example, this allows Gradle to recognize
when a script attempts to set a property that does not exist. You can access extra properties anywhere where you can
access their owning object. This gives extra properties a wider scope than local variables.
Subprojects can access extra properties on their parent projects.</p>
</div>
<div class="paragraph">
<p>For more information about extra properties, see
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.plugins.ExtraPropertiesExtension.html">ExtraPropertiesExtension</a> in the API documentation.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:configuring_arbitrary_objects"><a class="anchor" href="#sec:configuring_arbitrary_objects"></a><a class="link" href="#sec:configuring_arbitrary_objects">Configure Arbitrary Objects</a></h5>
<div class="paragraph">
<p>The example <code>greet()</code> task shows an example of arbitrary object configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">class UserInfo(
    var name: String? = null,
    var email: String? = null
)

tasks.register(&quot;greet&quot;) {
    val user = UserInfo().apply {
        name = &quot;Isaac Newton&quot;
        email = &quot;isaac@newton.me&quot;
    }
    doLast {
        println(user.name)
        println(user.email)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">UserInfo</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">String</span> email
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">greet</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> user = configure(<span class="keyword">new</span> UserInfo()) {
        name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Isaac Newton</span><span class="delimiter">&quot;</span></span>
        email = <span class="string"><span class="delimiter">&quot;</span><span class="content">isaac@newton.me</span><span class="delimiter">&quot;</span></span>
    }
    doLast {
        println user.name
        println user.email
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q greet
Isaac Newton
isaac@newton.me</pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:closure_delegate"><a class="anchor" href="#sec:closure_delegate"></a><a class="link" href="#sec:closure_delegate">Closure Delegates</a></h6>
<div class="paragraph">
<p>Each closure has a <code>delegate</code> object. Groovy uses this delegate to look up variable and method references to nonlocal variables and closure parameters.
Gradle uses this for <em>configuration closures</em>,
where the <code>delegate</code> object refers to the object being configured.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="keyword">assert</span> delegate == project.dependencies
    testImplementation(<span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.13</span><span class="delimiter">'</span></span>)
    delegate.testImplementation(<span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.13</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="script-default-imports"><a class="anchor" href="#script-default-imports"></a><a class="link" href="#script-default-imports">Default imports</a></h4>
<div class="paragraph">
<p>To make build scripts more concise, Gradle automatically adds a set of import statements to scripts.</p>
</div>
<div class="paragraph">
<p>As a result, instead of writing <code>throw new org.gradle.api.tasks.StopExecutionException()</code>, you can write <code>throw new StopExecutionException()</code> instead.</p>
</div>
<div class="paragraph">
<p>Gradle implicitly adds the following imports to each script:</p>
</div>
<div class="listingblock">
<div class="title">Gradle default imports</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.component.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.dsl.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.ivy.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.maven.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.query.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.repositories.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.result.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.transform.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.type.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.verification.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.attributes.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.attributes.java.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.attributes.plugin.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.cache.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.capabilities.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.component.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.configuration.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.credentials.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.distribution.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.distribution.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.execution.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.file.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.flow.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.initialization.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.initialization.definition.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.initialization.dsl.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.initialization.resolve.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.invocation.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.java.archives.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.jvm.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.launcher.cli.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.logging.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.logging.configuration.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.model.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.plugins.antlr.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.plugins.catalog.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.plugins.jvm.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.plugins.quality.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.plugins.scala.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.problems.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.project.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.ivy.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.ivy.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.ivy.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.maven.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.maven.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.maven.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reflect.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reporting.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reporting.components.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reporting.dependencies.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reporting.dependents.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reporting.model.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reporting.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.resources.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.services.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.specs.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.ant.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.application.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.bundling.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.compile.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.diagnostics.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.diagnostics.configurations.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.incremental.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.javadoc.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.options.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.scala.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.testing.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.testing.junit.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.testing.junitplatform.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.testing.testng.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.util.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.wrapper.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.toolchain.management.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.authentication.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.authentication.aws.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.authentication.http.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.build.event.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.buildconfiguration.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.buildinit.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.buildinit.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.buildinit.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.caching.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.caching.configuration.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.caching.http.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.caching.local.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.concurrent.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.external.javadoc.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ide.visualstudio.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ide.visualstudio.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ide.visualstudio.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ide.xcode.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ide.xcode.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ide.xcode.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ivy.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.application.scripts.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.application.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.toolchain.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.assembler.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.assembler.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.assembler.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.base.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.base.artifact.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.base.compile.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.base.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.base.sources.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.c.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.c.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.c.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.cpp.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.cpp.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.cpp.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.java.artifact.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.jvm.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.nativeplatform.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.nativeplatform.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.objectivec.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.objectivec.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.objectivec.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.objectivecpp.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.objectivecpp.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.objectivecpp.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.rc.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.rc.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.rc.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.scala.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.swift.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.swift.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.swift.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.maven.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.model.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.platform.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.cpp.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.cpp.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.cunit.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.cunit.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.cunit.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.googletest.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.googletest.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.xctest.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.xctest.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.xctest.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.toolchain.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.toolchain.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.normalization.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.platform.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.platform.base.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.platform.base.binary.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.platform.base.component.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.platform.base.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugin.devel.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugin.devel.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugin.devel.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugin.management.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugin.use.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.ear.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.ear.descriptor.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.ide.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.ide.api.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.ide.eclipse.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.ide.idea.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.signing.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.signing.signatory.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.signing.signatory.pgp.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.signing.type.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.signing.type.pgp.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.process.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.swiftpm.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.swiftpm.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.swiftpm.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.testing.base.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.testing.base.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.testing.jacoco.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.testing.jacoco.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.testing.jacoco.tasks.rules.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.testkit.runner.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.util.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.vcs.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.vcs.git.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.work.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.workers.*</span></code></pre>
</div>
</div>
<div id="sec:closures_as_the_last_parameter_in_a_method" class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#tutorial_using_tasks">Learn how to use Tasks</a> &gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tutorial_using_tasks"><a class="anchor" href="#tutorial_using_tasks"></a><a class="link" href="#tutorial_using_tasks">Using Tasks</a></h3>
<div class="paragraph">
<p>The work that Gradle can do on a project is defined by one or more <em>tasks</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/author-gradle-5.png" alt="author gradle 5">
</div>
</div>
<div class="paragraph">
<p>A task represents some independent unit of work that a build performs.
This might be compiling some classes, creating a JAR, generating Javadoc, or publishing some archives to a repository.</p>
</div>
<div class="paragraph">
<p>When a user runs <code>./gradlew build</code> in the command line, Gradle will execute the <code>build</code> task along with any other tasks it depends on.</p>
</div>
<div class="sect3">
<h4 id="list_available_tasks"><a class="anchor" href="#list_available_tasks"></a><a class="link" href="#list_available_tasks">List available tasks</a></h4>
<div class="paragraph">
<p>Gradle provides several default tasks for a project, which are listed by running <code>./gradlew tasks</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; Task :tasks

------------------------------------------------------------
Tasks runnable from root project 'myTutorial'
------------------------------------------------------------

Build Setup tasks
-----------------
init - Initializes a new Gradle build.
wrapper - Generates Gradle wrapper files.

Help tasks
----------
buildEnvironment - Displays all buildscript dependencies declared in root project 'myTutorial'.
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tasks either come from <strong>build scripts</strong> or <strong>plugins</strong>.</p>
</div>
<div class="paragraph">
<p>Once we apply a plugin to our project, such as the <code>application</code> plugin, additional tasks become available:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;application&quot;)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ ./gradlew tasks

&gt; Task :tasks

------------------------------------------------------------
Tasks runnable from project ':app'
------------------------------------------------------------

Application tasks
-----------------
run - Runs this project as a JVM application

Build tasks
-----------
assemble - Assembles the outputs of this project.
build - Assembles and tests this project.

Documentation tasks
-------------------
javadoc - Generates Javadoc API documentation for the main source code.

Other tasks
-----------
compileJava - Compiles main Java source.

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many of these tasks, such as <code>assemble</code>, <code>build</code>, and <code>run</code>, should be familiar to a developer.</p>
</div>
</div>
<div class="sect3">
<h4 id="task_classification"><a class="anchor" href="#task_classification"></a><a class="link" href="#task_classification">Task classification</a></h4>
<div class="paragraph">
<p>There are two classes of tasks that can be executed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Actionable tasks</strong> have some action(s) attached to do work in your build: <code>compileJava</code>.</p>
</li>
<li>
<p><strong>Lifecycle tasks</strong> are tasks with no actions attached: <code>assemble</code>, <code>build</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Typically, a <strong>lifecycle</strong> tasks depends on many <strong>actionable</strong> tasks, and is used to execute many tasks at once.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_registration"><a class="anchor" href="#sec:task_registration"></a><a class="link" href="#sec:task_registration">Task registration and action</a></h4>
<div class="paragraph">
<p>Let&#8217;s take a look at a simple "Hello World" task in a build script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    doLast {
        println(&quot;Hello world!&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example, the build script <strong>registers</strong> a single task called <code>hello</code> using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskContainer.html">TaskContainer</a> API, and adds an <strong>action</strong> to it.</p>
</div>
<div class="paragraph">
<p>If the tasks in the project are listed, the <code>hello</code> task is available to Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ ./gradlew app:tasks --all

&gt; Task :app:tasks

------------------------------------------------------------
Tasks runnable from project ':app'
------------------------------------------------------------

Other tasks
-----------
compileJava - Compiles main Java source.
compileTestJava - Compiles test Java source.
hello
processResources - Processes main resources.
processTestResources - Processes test resources.
startScripts - Creates OS-specific scripts to run the project as a JVM application.</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can execute the task in the build script with <code>./gradlew hello</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew hello
Hello world!</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When Gradle executes the <code>hello</code> task, it executes the <strong>action</strong> provided.
In this case, the action is simply a block containing some code: <code>println("Hello world!")</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="task_group_and_description"><a class="anchor" href="#task_group_and_description"></a><a class="link" href="#task_group_and_description">Task group and description</a></h4>
<div class="paragraph">
<p>The <code>hello</code> task from the previous section can be detailed with a <strong>description</strong> and assigned to a <strong>group</strong> with the following update:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    group = &quot;Custom&quot;
    description = &quot;A lovely greeting task.&quot;
    doLast {
        println(&quot;Hello world!&quot;)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the task is assigned to a group, it will be listed by <code>./gradlew tasks</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ ./gradlew tasks

&gt; Task :tasks

Custom tasks
------------------
hello - A lovely greeting task.</code></pre>
</div>
</div>
<div class="paragraph">
<p>To view information about a task, use the <code>help --task &lt;task-name&gt;</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$./gradlew help --task hello

&gt; Task :help
Detailed task information for hello

Path
:app:hello

Type
Task (org.gradle.api.Task)

Options
--rerun     Causes the task to be re-run even if up-to-date.

Description
A lovely greeting task.

Group
Custom</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see, the <code>hello</code> task belongs to the <code>custom</code> group.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_dependencies"><a class="anchor" href="#sec:task_dependencies"></a><a class="link" href="#sec:task_dependencies">Task dependencies</a></h4>
<div class="paragraph">
<p>You can declare tasks that depend on other tasks:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    doLast {
        println(&quot;Hello world!&quot;)
    }
}
tasks.register(&quot;intro&quot;) {
    dependsOn(&quot;hello&quot;)
    doLast {
        println(&quot;I'm Gradle&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>
    }
}
tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">intro</span><span class="delimiter">'</span></span>) {
    dependsOn tasks.hello
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm Gradle</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q intro
Hello world!
I'm Gradle</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The dependency of <code>taskX</code> to <code>taskY</code> may be declared before <code>taskY</code> is defined:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;taskX&quot;) {
    dependsOn(&quot;taskY&quot;)
    doLast {
        println(&quot;taskX&quot;)
    }
}
tasks.register(&quot;taskY&quot;) {
    doLast {
        println(&quot;taskY&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">taskX</span><span class="delimiter">'</span></span>) {
    dependsOn <span class="string"><span class="delimiter">'</span><span class="content">taskY</span><span class="delimiter">'</span></span>
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskX</span><span class="delimiter">'</span></span>
    }
}
tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">taskY</span><span class="delimiter">'</span></span>) {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskY</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q taskX
taskY
taskX</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>hello</code> task from the previous example is updated to include a dependency:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    group = &quot;Custom&quot;
    description = &quot;A lovely greeting task.&quot;
    doLast {
        println(&quot;Hello world!&quot;)
    }
    dependsOn(tasks.assemble)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>hello</code> task now depends on the <code>assemble</code> task, which means that Gradle must execute the <code>assemble</code> task <strong>before</strong> it can execute the <code>hello</code> task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ ./gradlew :app:hello

&gt; Task :app:compileJava UP-TO-DATE
&gt; Task :app:processResources NO-SOURCE
&gt; Task :app:classes UP-TO-DATE
&gt; Task :app:jar UP-TO-DATE
&gt; Task :app:startScripts UP-TO-DATE
&gt; Task :app:distTar UP-TO-DATE
&gt; Task :app:distZip UP-TO-DATE
&gt; Task :app:assemble UP-TO-DATE

&gt; Task :app:hello
Hello world!</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:manipulating_existing_tasks"><a class="anchor" href="#sec:manipulating_existing_tasks"></a><a class="link" href="#sec:manipulating_existing_tasks">Task configuration</a></h4>
<div class="paragraph">
<p>Once registered, tasks can be accessed via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskProvider.html">TaskProvider</a> API for further configuration.</p>
</div>
<div class="paragraph">
<p>For instance, you can use this to add dependencies to a task at runtime dynamically:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repeat(4) { counter -&gt;
    tasks.register(&quot;task$counter&quot;) {
        doLast {
            println(&quot;I'm task number $counter&quot;)
        }
    }
}
tasks.named(&quot;task0&quot;) { dependsOn(&quot;task2&quot;, &quot;task3&quot;) }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="integer">4</span>.times { counter -&gt;
    tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">task</span><span class="inline"><span class="inline-delimiter">$</span>counter</span><span class="delimiter">&quot;</span></span>) {
        doLast {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm task number </span><span class="inline"><span class="inline-delimiter">$</span>counter</span><span class="delimiter">&quot;</span></span>
        }
    }
}
tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">task0</span><span class="delimiter">'</span></span>) { dependsOn(<span class="string"><span class="delimiter">'</span><span class="content">task2</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">task3</span><span class="delimiter">'</span></span>) }</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q task0
I'm task number 2
I'm task number 3
I'm task number 0</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Or you can add behavior to an existing task:</p>
</div>
<div id="sec:hello_world" class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    doLast {
        println(&quot;Hello Earth&quot;)
    }
}
tasks.named(&quot;hello&quot;) {
    doFirst {
        println(&quot;Hello Venus&quot;)
    }
}
tasks.named(&quot;hello&quot;) {
    doLast {
        println(&quot;Hello Mars&quot;)
    }
}
tasks.named(&quot;hello&quot;) {
    doLast {
        println(&quot;Hello Jupiter&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello Earth</span><span class="delimiter">'</span></span>
    }
}
tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
    doFirst {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello Venus</span><span class="delimiter">'</span></span>
    }
}
tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello Mars</span><span class="delimiter">'</span></span>
    }
}
tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello Jupiter</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q hello
Hello Venus
Hello Earth
Hello Mars
Hello Jupiter</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The calls <code>doFirst</code> and <code>doLast</code> can be executed multiple times.
They add an action to the beginning or the end of the task&#8217;s actions list.
When the task executes, the actions in the action list are executed in order.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is an example of the <code>named</code> method being used to configure a task added by a plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">dokkaHtml</span><span class="delimiter">&quot;</span></span>) {
    outputDirectory.set(buildDir.resolve(<span class="string"><span class="delimiter">&quot;</span><span class="content">dokka</span><span class="delimiter">&quot;</span></span>))
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="task_types"><a class="anchor" href="#task_types"></a><a class="link" href="#task_types">Task types</a></h4>
<div class="paragraph">
<p>Gradle tasks are a subclass of <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Task.html"><code>Task</code></a>.</p>
</div>
<div class="paragraph">
<p>In the build script, the <code>HelloTask</code> class is created by extending <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/DefaultTask.html"><code>DefaultTask</code></a>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Extend the DefaultTask class to create a HelloTask class
abstract class HelloTask : DefaultTask() {
    @TaskAction
    fun hello() {
        println(&quot;hello from HelloTask&quot;)
    }
}

// Register the hello Task with type HelloTask
tasks.register&lt;HelloTask&gt;(&quot;hello&quot;) {
    group = &quot;Custom tasks&quot;
    description = &quot;A lovely greeting task.&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>hello</code> task is registered with the <strong>type</strong> <code>HelloTask</code>.</p>
</div>
<div class="paragraph">
<p>Executing our new <code>hello</code> task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ ./gradlew hello

&gt; Task :app:hello
hello from HelloTask</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the <code>hello</code> task is of type <code>HelloTask</code> instead of type <code>Task</code>.</p>
</div>
<div class="paragraph">
<p>The Gradle <code>help</code> task reveals the change:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ ./gradlew help --task hello

&gt; Task :help
Detailed task information for hello

Path
:app:hello

Type
HelloTask (Build_gradle$HelloTask)

Options
--rerun     Causes the task to be re-run even if up-to-date.

Description
A lovely greeting task.

Group
Custom tasks</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="built_in_task_types"><a class="anchor" href="#built_in_task_types"></a><a class="link" href="#built_in_task_types">Built-in task types</a></h4>
<div class="paragraph">
<p>Gradle provides many built-in task types with common and popular functionality, such as copying or deleting files.</p>
</div>
<div class="paragraph">
<p>This example task copies <code>*.war</code> files from the <code>source</code> directory to the <code>target</code> directory using the <code>Copy</code> built-in task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>tasks.register(&quot;copyTask&quot;,Copy) {
    from(&quot;source&quot;)
    into(&quot;target&quot;)
    include(&quot;*.war&quot;)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are many task types developers can take advantage of, including <code>GroovyDoc</code>, <code>Zip</code>, <code>Jar</code>, <code>JacocoReport</code>, <code>Sign</code>, or <code>Delete</code>, which are available in the link:<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.plugins.antlr.AntlrTask.html">DSL</a>.</p>
</div>
<div id="sec:build_script_external_dependencies" class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#writing_tasks">Learn how to write Tasks</a> &gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="writing_tasks"><a class="anchor" href="#writing_tasks"></a><a class="link" href="#writing_tasks">Writing Tasks</a></h3>
<div class="paragraph">
<p>Gradle tasks are created by extending <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/DefaultTask.html"><code>DefaultTask</code></a>.</p>
</div>
<div class="paragraph">
<p>However, the generic <code>DefaultTask</code> provides no action for Gradle.
If users want to extend the capabilities of Gradle and their build script, they must either use a <strong>built-in task</strong> or create a <strong>custom task</strong>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Built-in task</strong> - Gradle provides built-in utility tasks such as <code>Copy</code>, <code>Jar</code>, <code>Zip</code>, <code>Delete</code>, etc&#8230;&#8203;</p>
</li>
<li>
<p><strong>Custom task</strong> - Gradle allows users to subclass <code>DefaultTask</code> to create their own task types.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="sec:sample_task"><a class="anchor" href="#sec:sample_task"></a><a class="link" href="#sec:sample_task">Create a task</a></h4>
<div class="paragraph">
<p>The simplest and quickest way to create a <strong>custom</strong> task is in a build script:</p>
</div>
<div class="paragraph">
<p>To create a task, inherit from the <code>DefaultTask</code> class and implement a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskAction.html"><code>@TaskAction</code></a> handler:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class CreateFileTask : DefaultTask() {
    @TaskAction
    fun action() {
        val file = File(&quot;myfile.txt&quot;)
        file.createNewFile()
        file.writeText(&quot;HELLO FROM MY TASK&quot;)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CreateFileTask</code> implements a simple set of <strong>actions</strong>.
First, a file called "myfile.txt" is created in the main project.
Then, some text is written to the file.</p>
</div>
</div>
<div class="sect3">
<h4 id="register_a_task"><a class="anchor" href="#register_a_task"></a><a class="link" href="#register_a_task">Register a task</a></h4>
<div class="paragraph">
<p>A task is <strong>registered</strong> in the build script using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskContainer.html"><code>TaskContainer.register()</code></a> method, which allows it to be then used in the build logic.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class CreateFileTask : DefaultTask() {
    @TaskAction
    fun action() {
        val file = File(&quot;myfile.txt&quot;)
        file.createNewFile()
        file.writeText(&quot;HELLO FROM MY TASK&quot;)
    }
}

tasks.register&lt;CreateFileTask&gt;(&quot;createFileTask&quot;)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="task_group_and_description_2"><a class="anchor" href="#task_group_and_description_2"></a><a class="link" href="#task_group_and_description_2">Task group and description</a></h4>
<div class="paragraph">
<p>Setting the <strong>group</strong> and <strong>description</strong> properties on your tasks can help users understand how to use your task:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class CreateFileTask : DefaultTask() {
    @TaskAction
    fun action() {
        val file = File(&quot;myfile.txt&quot;)
        file.createNewFile()
        file.writeText(&quot;HELLO FROM MY TASK&quot;)
    }
}

tasks.register&lt;CreateFileTask&gt;(&quot;createFileTask&quot;, ) {
    group = &quot;custom&quot;
    description = &quot;Create myfile.txt in the current directory&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once a task is added to a group, it is visible when listing tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="task_input_and_outputs"><a class="anchor" href="#task_input_and_outputs"></a><a class="link" href="#task_input_and_outputs">Task input and outputs</a></h4>
<div class="paragraph">
<p>For the task to do useful work, it typically needs some <strong>inputs</strong>.
A task typically produces <strong>outputs</strong>.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class CreateFileTask : DefaultTask() {
    @Input
    val fileText = &quot;HELLO FROM MY TASK&quot;

    @Input
    val fileName = &quot;myfile.txt&quot;

    @OutputFile
    val myFile: File = File(fileName)

    @TaskAction
    fun action() {
        myFile.createNewFile()
        myFile.writeText(fileText)
    }
}

tasks.register&lt;CreateFileTask&gt;(&quot;createFileTask&quot;) {
    group = &quot;custom&quot;
    description = &quot;Create myfile.txt in the current directory&quot;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure_a_task"><a class="anchor" href="#configure_a_task"></a><a class="link" href="#configure_a_task">Configure a task</a></h4>
<div class="paragraph">
<p>A task is optionally <strong>configured</strong> in a build script using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskCollection.html"><code>TaskCollection.named()</code></a> method.</p>
</div>
<div class="paragraph">
<p>The <code>CreateFileTask</code> class is updated so that the text in the file is configurable:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class CreateFileTask : DefaultTask() {
    @get:Input
    abstract val fileText: Property&lt;String&gt;

    @Input
    val fileName = &quot;myfile.txt&quot;

    @OutputFile
    val myFile: File = File(fileName)

    @TaskAction
    fun action() {
        myFile.createNewFile()
        myFile.writeText(fileText.get())
    }
}

tasks.register&lt;CreateFileTask&gt;(&quot;createFileTask&quot;) {
    group = &quot;custom&quot;
    description = &quot;Create myfile.txt in the current directory&quot;
    fileText.convention(&quot;HELLO FROM THE CREATE FILE TASK METHOD&quot;) // Set convention
}

tasks.named&lt;CreateFileTask&gt;(&quot;createFileTask&quot;) {
    fileText.set(&quot;HELLO FROM THE NAMED METHOD&quot;) // Override with custom message
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>named()</code> method, we find the <code>createFileTask</code> task and set the text that will be written to the file.</p>
</div>
<div class="paragraph">
<p>When the task is executed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ ./gradlew createFileTask

&gt; Configure project :app

&gt; Task :app:createFileTask

BUILD SUCCESSFUL in 5s
2 actionable tasks: 1 executed, 1 up-to-date</code></pre>
</div>
</div>
<div class="paragraph">
<p>A text file called <code>myfile.txt</code> is created in the project root folder:</p>
</div>
<div class="listingblock">
<div class="title">myfile.txt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">HELLO FROM THE NAMED METHOD</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consult the <a href="#more_about_tasks">Developing Gradle Tasks chapter</a> to learn more.</p>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#using_plugins">Learn how to use Plugins</a> &gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using_plugins"><a class="anchor" href="#using_plugins"></a><a class="link" href="#using_plugins">Using Plugins</a></h3>
<div class="paragraph">
<p>Much of Gradle&#8217;s functionality is delivered via plugins, including core plugins distributed with Gradle, third-party plugins, and script plugins defined within builds.</p>
</div>
<div id="sec:what_plugins_do" class="paragraph">
<p>Plugins introduce new tasks (e.g., <code>JavaCompile</code>), domain objects (e.g., <code>SourceSet</code>), conventions (e.g., locating Java source at <code>src/main/java</code>), and extend core or other plugin objects.</p>
</div>
<div class="paragraph">
<p>Plugins in Gradle are essential for automating common build tasks, integrating with external tools or services, and tailoring the build process to meet specific project needs.
They also serve as the primary mechanism for organizing build logic.</p>
</div>
<div class="sect3">
<h4 id="benefits_of_plugins"><a class="anchor" href="#benefits_of_plugins"></a><a class="link" href="#benefits_of_plugins">Benefits of plugins</a></h4>
<div class="paragraph">
<p>Writing many tasks and duplicating configuration blocks in build scripts can get messy.
Plugins offer several advantages over adding logic directly to the build script:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Promotes Reusability</strong>: Reduces the need to duplicate similar logic across projects.</p>
</li>
<li>
<p><strong>Enhances Modularity</strong>: Allows for a more modular and organized build script.</p>
</li>
<li>
<p><strong>Encapsulates Logic</strong>: Keeps imperative logic separate, enabling more declarative build scripts.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="plugin_distribution_2"><a class="anchor" href="#plugin_distribution_2"></a><a class="link" href="#plugin_distribution_2">Plugin distribution</a></h4>
<div class="paragraph">
<p>You can leverage plugins from Gradle and the Gradle community or create your own.</p>
</div>
<div class="paragraph">
<p>Plugins are available in three ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Core plugins</strong> - Gradle develops and maintains a set of <a href="#plugin_reference">Core Plugins</a>.</p>
</li>
<li>
<p><strong>Community plugins</strong> - Gradle plugins shared in a remote repository such as Maven or the <a href="https://plugins.gradle.org">Gradle Plugin Portal</a>.</p>
</li>
<li>
<p><strong>Local plugins</strong> - Gradle enables users to create <strong>custom</strong> plugins using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Plugin.html">APIs</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="sec:types_of_plugins"><a class="anchor" href="#sec:types_of_plugins"></a><a class="link" href="#sec:types_of_plugins">Types of plugins</a></h4>
<div class="paragraph">
<p>Plugins can be implemented as <strong>binary plugins</strong>, <strong>precompiled script plugins</strong>, or <strong>script plugins</strong>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Binary Plugins </dt>
<dd>
<p>Binary plugins are compiled plugins typically written in Java or Kotlin DSL that are packaged as JAR files.
They are applied to a project using the <code>plugins {}</code> block.
They offer better performance and maintainability compared to script plugins or precompiled script plugins.</p>
</dd>
<dt class="hdlist1">Precompiled Script Plugins </dt>
<dd>
<p>Precompiled script plugins are Groovy DSL or Kotlin DSL scripts compiled and distributed as Java class files packaged in a library.
They are applied to a project using the <code>plugins {}</code> block.
They provide a way to reuse complex logic across projects and allow for better organization of build logic.</p>
</dd>
<dt class="hdlist1">Script Plugins </dt>
<dd>
<p>Script plugins are Groovy DSL or Kotlin DSL scripts that are applied directly to a Gradle build script using the <code>apply from:</code> syntax.
They are applied inline within a build script to add functionality or customize the build process.
They are simple to use.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A plugin often starts as a script plugin (because they are easy to write).
Then, as the code becomes more valuable, it&#8217;s migrated to a binary plugin that can be easily tested and shared between multiple projects or organizations.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:using_plugins"><a class="anchor" href="#sec:using_plugins"></a><a class="link" href="#sec:using_plugins">Using plugins</a></h4>
<div class="paragraph">
<p>To use the build logic encapsulated in a plugin, Gradle needs to perform two steps.
First, it needs to <strong>resolve</strong> the plugin, and then it needs to <strong>apply</strong> the plugin to the target, usually a <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html"><code>Project</code></a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Resolving</strong> a plugin means finding the correct version of the JAR that contains a given plugin and adding it to the script classpath.
Once a plugin is resolved, its API can be used in a build script.
Script plugins are self-resolving in that they are resolved from the specific file path or URL provided when applying them.
Core binary plugins provided as part of the Gradle distribution are automatically resolved.</p>
</li>
<li>
<p><strong>Applying</strong> a plugin means executing the plugin&#8217;s <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Plugin.html#apply-T-">Plugin.apply(T)</a> on a project.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <a href="#sec:plugins_block">plugins DSL</a> is recommended to resolve and apply plugins in one step.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:binary_plugin_locations"><a class="anchor" href="#sec:binary_plugin_locations"></a><a class="link" href="#sec:binary_plugin_locations">Resolving plugins</a></h4>
<div class="paragraph">
<p>Gradle provides the <strong>core plugins</strong> (e.g., <code>JavaPlugin</code>, <code>GroovyPlugin</code>, <code>MavenPublishPlugin</code>, etc.) as part of its distribution, which means they are automatically resolved.</p>
</div>
<div class="paragraph">
<p>Core plugins are applied in a build script using the plugin name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">plugins {
    id «plugin name»
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">plugins {
    id(&quot;java&quot;)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Non-core plugins must be resolved before they can be applied.
Non-core plugins are identified by a unique ID and a version in the build file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">plugins {
    id «plugin id» version «plugin version»
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the location of the plugin must be specified in the settings file:</p>
</div>
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
    repositories {
        gradlePluginPortal()
        maven {
            url <span class="string"><span class="delimiter">'</span><span class="content">https://maven.example.com/plugins</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are additional considerations for resolving and applying plugins:</p>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#</th>
<th class="tableblock halign-left valign-top">To</th>
<th class="tableblock halign-left valign-top">Use</th>
<th class="tableblock halign-left valign-top">For example:</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:plugins_block">1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apply a <strong>core</strong>, <strong>community</strong> or <strong>local</strong> plugin to a specific project.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:plugins_block">The <code>plugins</code> block in the build file</a></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
  id(&quot;org.barfuin.gradle.taskinfo&quot;) version &quot;2.1.0&quot;
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:buildsrc_plugins_dsl">2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apply common <strong>core</strong>, <strong>community</strong> or <strong>local</strong> plugin to multiple subprojects.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:buildsrc_plugins_dsl">A build script in the <code>buildSrc</code> directory</a></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;org.barfuin.gradle.taskinfo&quot;) version &quot;2.1.0&quot;
}
repositories {
    mavenCentral()
}
dependencies {
    implementation(Libs.Kotlin.coroutines)
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:applying_plugins_buildscript">3</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apply a <strong>core</strong>, <strong>community</strong> or <strong>local</strong> plugin needed <em>for the build script itself</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:applying_plugins_buildscript">The <code>buildscript</code> block in the build file</a></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildscript {
  repositories {
    maven {
      url = uri(&quot;https://plugins.gradle.org/m2/&quot;)
    }
  }
  dependencies {
    classpath(&quot;org.barfuin.gradle.taskinfo:gradle-taskinfo:2.1.0&quot;)
  }
}
plugins {
  id(&quot;org.barfuin.gradle.taskinfo&quot;) version &quot;2.1.0&quot;
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:script_plugins">4</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apply a <strong>local</strong> script plugins.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:script_plugins">The legacy <code>apply()</code> method in the build file</a></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(plugin = &quot;org.barfuin.gradle.taskinfo&quot;)
apply&lt;MyPlugin&gt;()</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:plugins_block"><a class="anchor" href="#sec:plugins_block"></a><a class="link" href="#sec:plugins_block">1. Applying plugins using the <code>plugins{}</code> block</a></h4>
<div class="paragraph">
<p>The plugin DSL provides a concise and convenient way to declare plugin dependencies.</p>
</div>
<div id="sec:binary_plugins" class="paragraph">
<p>The plugins block configures an instance of <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/plugin/use/PluginDependenciesSpec.html"><code>PluginDependenciesSpec</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="build.gradle.kts">plugins {
    application                                     // by name
    java                                            // by name
    id(&quot;java&quot;)                                      // by id - recommended
    id(&quot;org.jetbrains.kotlin.jvm&quot;) version &quot;1.9.0&quot;  // by id - recommended
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Core Gradle plugins are unique in that they provide short names, such as <code>java</code> for the core <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/plugins/JavaPlugin.html">JavaPlugin</a>.</p>
</div>
<div class="paragraph">
<p>To apply a core plugin, the short <strong>name</strong> can be used:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>All other binary plugins must use the fully qualified form of the plugin id (e.g., <code>com.github.foo.bar</code>).</p>
</div>
<div class="paragraph">
<p>To apply a community plugin from <a href="http://plugins.gradle.org">Gradle plugin portal</a>, the fully qualified <strong>plugin id</strong>, a globally unique identifier, must be used:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.jfrog.bintray&quot;) version &quot;1.8.5&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">com.jfrog.bintray</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">1.8.5</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/plugin/use/PluginDependenciesSpec.html"><code>PluginDependenciesSpec</code></a> for more information on using the Plugin DSL.</p>
</div>
<div class="sect4">
<h5 id="plugins_dsl_limitations"><a class="anchor" href="#plugins_dsl_limitations"></a><a class="link" href="#plugins_dsl_limitations">Limitations of the plugins DSL</a></h5>
<div class="paragraph">
<p>The plugins DSL provides a convenient syntax for users and the ability for Gradle to determine which plugins are used quickly.
This allows Gradle to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Optimize the loading and reuse of plugin classes.</p>
</li>
<li>
<p>Provide editors with detailed information about the potential properties and values in the build script.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, the DSL requires that plugins be defined statically.</p>
</div>
<div class="paragraph">
<p>There are some key differences between the <code>plugins {}</code> block mechanism and the "traditional" <code>apply()</code> method mechanism.
There are also some constraints and possible limitations.</p>
</div>
<div class="sect5">
<h6 id="sec:constrained_syntax"><a class="anchor" href="#sec:constrained_syntax"></a><a class="link" href="#sec:constrained_syntax">Constrained Syntax</a></h6>
<div class="paragraph">
<p>The <code>plugins {}</code> block does not support arbitrary code.</p>
</div>
<div class="paragraph">
<p>It is constrained to be idempotent (produce the same result every time) and side effect-free (safe for Gradle to execute at any time).</p>
</div>
<div class="paragraph">
<p>The form is:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(«plugin id»)                             // <b class="conum">(1)</b>
    id(«plugin id») version «plugin version»    // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>for core Gradle plugins or plugins already available to the build script</p>
</li>
<li>
<p>for binary Gradle plugins that need to be resolved</p>
</li>
</ol>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="error">«</span>plugin id<span class="error">»</span>                            // <b class="conum">(1)</b>
    id <span class="error">«</span>plugin id<span class="error">»</span> version <span class="error">«</span>plugin version<span class="error">»</span>   // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>for core Gradle plugins or plugins already available to the build script</p>
</li>
<li>
<p>for binary Gradle plugins that need to be resolved</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>Where <code>«plugin id»</code> and <code>«plugin version»</code> are a string.</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>Where <code>«plugin id»</code> and <code>«plugin version»</code> must be constant, literal strings.</p>
</div>
<div class="paragraph">
<p>The <code>plugins{}</code> block must also be a top-level statement in the build script.
It cannot be nested inside another construct (e.g., an if-statement or for-loop).</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:build_scripts_only"><a class="anchor" href="#sec:build_scripts_only"></a><a class="link" href="#sec:build_scripts_only">Only in build scripts and settings file</a></h6>
<div class="paragraph">
<p>The <code>plugins{}</code> block can only be used in a project&#8217;s build script <code>build.gradle(.kts)</code> and the <code>settings.gradle(.kts)</code> file.
It must appear before any other block.
It cannot be used in script plugins or init scripts.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:subprojects_plugins_dsl"><a class="anchor" href="#sec:subprojects_plugins_dsl"></a><a class="link" href="#sec:subprojects_plugins_dsl">Applying plugins to all subprojects</a></h6>
<div class="paragraph">
<p>Suppose you have a <a href="#multi_project_builds">multi-project build</a>, you probably want to apply plugins to some or all of the subprojects in your build but not to the <code>root</code> project.</p>
</div>
<div class="paragraph">
<p>While the default behavior of the <code>plugins{}</code> block is to immediately <code>resolve</code> <em>and</em> <code>apply</code> the plugins, you can use the <code>apply false</code> syntax to tell Gradle not to apply the plugin to the current project. Then, use the <code>plugins{}</code> block without the version in subprojects' build scripts:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;hello-a&quot;)
include(&quot;hello-b&quot;)
include(&quot;goodbye-c&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.example.hello&quot;) version &quot;1.0.0&quot; apply false
    id(&quot;com.example.goodbye&quot;) version &quot;1.0.0&quot; apply false
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">hello-a/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.example.hello&quot;)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">hello-b/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.example.hello&quot;)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">goodbye-c/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.example.goodbye&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">include <span class="string"><span class="delimiter">'</span><span class="content">hello-a</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">hello-b</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">goodbye-c</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">com.example.hello</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">1.0.0</span><span class="delimiter">'</span></span> apply <span class="predefined-constant">false</span>
    id <span class="string"><span class="delimiter">'</span><span class="content">com.example.goodbye</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">1.0.0</span><span class="delimiter">'</span></span> apply <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">hello-a/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">com.example.hello</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">hello-b/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">com.example.hello</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">goodbye-c/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">com.example.goodbye</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also encapsulate the versions of external plugins by composing the build logic using your own <a href="#sec:convention_plugins">convention plugins</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:buildsrc_plugins_dsl"><a class="anchor" href="#sec:buildsrc_plugins_dsl"></a><a class="link" href="#sec:buildsrc_plugins_dsl">2. Applying plugins from the <code>buildSrc</code> directory</a></h4>
<div class="paragraph">
<p><code>buildSrc</code> is an optional directory at the Gradle project root that contains build logic (i.e., plugins) used in building the main project.
You can apply plugins that reside in a project&#8217;s <code>buildSrc</code> directory as long as they have a defined ID.</p>
</div>
<div class="paragraph">
<p>The following example shows how to tie the plugin implementation class <code>my.MyPlugin</code>, defined in <code>buildSrc</code>, to the id "my-plugin":</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-gradle-plugin`
}

gradlePlugin {
    plugins {
        create(&quot;myPlugins&quot;) {
            id = &quot;my-plugin&quot;
            implementationClass = &quot;my.MyPlugin&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-gradle-plugin</span><span class="delimiter">'</span></span>
}

gradlePlugin {
    plugins {
        myPlugins {
            id = <span class="string"><span class="delimiter">'</span><span class="content">my-plugin</span><span class="delimiter">'</span></span>
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">my.MyPlugin</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin can then be applied by ID:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;my-plugin&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">my-plugin</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:applying_plugins_buildscript"><a class="anchor" href="#sec:applying_plugins_buildscript"></a><a class="link" href="#sec:applying_plugins_buildscript">3. Applying plugins using the <code>buildscript{}</code> block</a></h4>
<div class="paragraph">
<p>The <code>buildscript</code> block is used for:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>global <code>dependencies</code> and <code>repositories</code> required for building the project (applied in the subprojects).</p>
</li>
<li>
<p>declaring which plugins are available for use <strong>in the build script</strong> (in the <code>build.gradle(.kts)</code> file itself).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>So when you want to use a library in the build script itself, you must add this library on the script classpath using <code>buildScript</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="build.gradle">import org.apache.commons.codec.binary.Base64

buildscript {
    repositories {  // this is where the plugins are located
        mavenCentral()
        google()
    }
    dependencies { // these are the plugins that can be used in subprojects or in the build file itself
        classpath group: 'commons-codec', name: 'commons-codec', version: '1.2' // used in the task below
        classpath 'com.android.tools.build:gradle:4.1.0' // used in subproject
    }
}

tasks.register('encode') {
    doLast {
        def byte[] encodedString = new Base64().encode('hello world\n'.getBytes())
        println new String(encodedString)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you can apply the globally declared dependencies in the subproject that needs it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="subproject/build.gradle">plugins {
    id 'com.android.application'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Binary plugins published as external jar files can be added to a project by adding the plugin to the build script classpath and then applying the plugin.</p>
</div>
<div class="paragraph">
<p>External jars can be added to the build script classpath using the <code>buildscript{}</code> block as described in <a href="#sec:build_script_external_dependencies">External dependencies for the build script</a>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildscript {
    repositories {
        gradlePluginPortal()
    }
    dependencies {
        classpath(&quot;com.jfrog.bintray.gradle:gradle-bintray-plugin:1.8.5&quot;)
    }
}

apply(plugin = &quot;com.jfrog.bintray&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
        gradlePluginPortal()
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">'</span><span class="content">com.jfrog.bintray.gradle:gradle-bintray-plugin:1.8.5</span><span class="delimiter">'</span></span>
    }
}

apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">com.jfrog.bintray</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:script_plugins"><a class="anchor" href="#sec:script_plugins"></a><a class="link" href="#sec:script_plugins">4. Applying script plugins using the legacy <code>apply()</code> method</a></h4>
<div class="paragraph">
<p>A script plugin is an ad-hoc plugin, typically written and applied in the same build script.
It is applied using the <a href="#sec:old_plugin_application">legacy application method</a>:</p>
</div>
<div id="sec:binary_plugin_example" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="build.gradle.kts">class MyPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        println(&quot;Plugin ${this.javaClass.simpleName} applied on ${project.name}&quot;)
    }
}

apply&lt;MyPlugin&gt;()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s take a rudimentary example of a plugin written in a file called <code>other.gradle</code> located in the same directory as the <code>build.gradle</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="other.gradle">public class Other implements Plugin&lt;Project&gt; {
    @Override
    void apply(Project project) {
        // Does something
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>First, import the external file using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="build.gradle">apply from: 'other.gradle'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can apply it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="build.gradle">apply plugin: Other</code></pre>
</div>
</div>
<div class="paragraph">
<p>Script plugins are automatically resolved and can be applied from a script on the local filesystem or remotely:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(from = &quot;other.gradle.kts&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">from</span>: <span class="string"><span class="delimiter">'</span><span class="content">other.gradle</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Filesystem locations are relative to the project directory, while remote script locations are specified with an HTTP URL.
Multiple script plugins (of either form) can be applied to a given target.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:plugin_management"><a class="anchor" href="#sec:plugin_management"></a><a class="link" href="#sec:plugin_management">Plugin Management</a></h4>
<div class="paragraph">
<p>The <code>pluginManagement{}</code> block is used to configure repositories for plugin resolution and to define version constraints for plugins that are applied in the build scripts.</p>
</div>
<div class="paragraph">
<p>The <code>pluginManagement{}</code> block can be used in a <code>settings.gradle(.kts)</code> file, where it must be the first block in the file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    plugins {
    }
    resolutionStrategy {
    }
    repositories {
    }
}
rootProject.name = &quot;plugin-management&quot;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
    plugins {
    }
    resolutionStrategy {
    }
    repositories {
    }
}
rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">plugin-management</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The block can also be used in <a href="#init_scripts">Initialization Script</a>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">settingsEvaluated {
    pluginManagement {
        plugins {
        }
        resolutionStrategy {
        }
        repositories {
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">settingsEvaluated { settings -&gt;
    settings.pluginManagement {
        plugins {
        }
        resolutionStrategy {
        }
        repositories {
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:custom_plugin_repositories"><a class="anchor" href="#sec:custom_plugin_repositories"></a><a class="link" href="#sec:custom_plugin_repositories">Custom Plugin Repositories</a></h5>
<div class="paragraph">
<p>By default, the <code>plugins{}</code> DSL resolves plugins from the public <a href="https://plugins.gradle.org">Gradle Plugin Portal</a>.</p>
</div>
<div class="paragraph">
<p>Many build authors would also like to resolve plugins from private Maven or Ivy repositories because they contain proprietary implementation details or to have more control over what plugins are available to their builds.</p>
</div>
<div class="paragraph">
<p>To specify custom plugin repositories, use the <code>repositories{}</code> block inside <code>pluginManagement{}</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    repositories {
        maven(url = &quot;./maven-repo&quot;)
        gradlePluginPortal()
        ivy(url = &quot;./ivy-repo&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
    repositories {
        maven {
            url <span class="string"><span class="delimiter">'</span><span class="content">./maven-repo</span><span class="delimiter">'</span></span>
        }
        gradlePluginPortal()
        ivy {
            url <span class="string"><span class="delimiter">'</span><span class="content">./ivy-repo</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This tells Gradle to first look in the Maven repository at <code>../maven-repo</code> when resolving plugins and then to check the Gradle Plugin Portal if the plugins are not found in the Maven repository.
If you don&#8217;t want the Gradle Plugin Portal to be searched, omit the <code>gradlePluginPortal()</code> line.
Finally, the Ivy repository at <code>../ivy-repo</code> will be checked.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:plugin_version_management"><a class="anchor" href="#sec:plugin_version_management"></a><a class="link" href="#sec:plugin_version_management">Plugin Version Management</a></h5>
<div class="paragraph">
<p>A <code>plugins{}</code> block inside <code>pluginManagement{}</code> allows all plugin versions for the build to be defined in a single location.
Plugins can then be applied by id to any build script via the <code>plugins{}</code> block.</p>
</div>
<div class="paragraph">
<p>One benefit of setting plugin versions this way is that the <code>pluginManagement.plugins{}</code> does not have the same <a href="#sec:constrained_syntax">constrained syntax</a> as the build script <code>plugins{}</code> block.
This allows plugin versions to be taken from <code>gradle.properties</code>, or loaded via another mechanism.</p>
</div>
<div class="paragraph">
<p>Managing plugin versions via <code>pluginManagement</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
  val helloPluginVersion: String by settings
  plugins {
    id(&quot;com.example.hello&quot;) version &quot;${helloPluginVersion}&quot;
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.example.hello&quot;)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">helloPluginVersion=1.0.0</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
  plugins {
        id <span class="string"><span class="delimiter">'</span><span class="content">com.example.hello</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>helloPluginVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">com.example.hello</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">helloPluginVersion=1.0.0</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin version is loaded from <code>gradle.properties</code> and configured in the settings script, allowing the plugin to be added to any project without specifying the version.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:plugin_resolution_rules"><a class="anchor" href="#sec:plugin_resolution_rules"></a><a class="link" href="#sec:plugin_resolution_rules">Plugin Resolution Rules</a></h5>
<div class="paragraph">
<p>Plugin resolution rules allow you to modify plugin requests made in <code>plugins{}</code> blocks, e.g., changing the requested version or explicitly specifying the implementation artifact coordinates.</p>
</div>
<div class="paragraph">
<p>To add resolution rules, use the <code>resolutionStrategy{}</code> inside the <code>pluginManagement{}</code> block:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    resolutionStrategy {
        eachPlugin {
            if (requested.id.namespace == &quot;com.example&quot;) {
                useModule(&quot;com.example:sample-plugins:1.0.0&quot;)
            }
        }
    }
    repositories {
        maven {
            url = uri(&quot;./maven-repo&quot;)
        }
        gradlePluginPortal()
        ivy {
            url = uri(&quot;./ivy-repo&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
    resolutionStrategy {
        eachPlugin {
            <span class="keyword">if</span> (requested.id.namespace == <span class="string"><span class="delimiter">'</span><span class="content">com.example</span><span class="delimiter">'</span></span>) {
                useModule(<span class="string"><span class="delimiter">'</span><span class="content">com.example:sample-plugins:1.0.0</span><span class="delimiter">'</span></span>)
            }
        }
    }
    repositories {
        maven {
            url <span class="string"><span class="delimiter">'</span><span class="content">./maven-repo</span><span class="delimiter">'</span></span>
        }
        gradlePluginPortal()
        ivy {
            url <span class="string"><span class="delimiter">'</span><span class="content">./ivy-repo</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This tells Gradle to use the specified plugin implementation artifact instead of its built-in default mapping from plugin ID to Maven/Ivy coordinates.</p>
</div>
<div class="paragraph">
<p>Custom Maven and Ivy plugin repositories must contain <a href="#sec:plugin_markers">plugin marker artifacts</a> and the artifacts that implement the plugin.
Read <a href="java_gradle_plugin.html#java_gradle_plugin">Gradle Plugin Development Plugin</a> for more information on publishing plugins to custom repositories.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/plugin/management/PluginManagementSpec.html">PluginManagementSpec</a> for complete documentation for using the <code>pluginManagement{}</code> block.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:plugin_markers"><a class="anchor" href="#sec:plugin_markers"></a><a class="link" href="#sec:plugin_markers">Plugin Marker Artifacts</a></h5>
<div class="paragraph">
<p>Since the <code>plugins{}</code> DSL block only allows for declaring plugins by their globally unique plugin <code>id</code> and <code>version</code> properties, Gradle needs a way to look up the coordinates of the plugin implementation artifact.</p>
</div>
<div class="paragraph">
<p>To do so, Gradle will look for a Plugin Marker Artifact with the coordinates <code>plugin.id:plugin.id.gradle.plugin:plugin.version</code>.
This marker needs to have a dependency on the actual plugin implementation.
Publishing these markers is automated by the <a href="java_gradle_plugin.html#java_gradle_plugin">java-gradle-plugin</a>.</p>
</div>
<div class="paragraph">
<p>For example, the following complete sample from the <code>sample-plugins</code> project shows how to publish a <code>com.example.hello</code> plugin and a <code>com.example.goodbye</code> plugin to both an Ivy and Maven repository using the combination of the <a href="java_gradle_plugin.html#java_gradle_plugin">java-gradle-plugin</a>, the <a href="#publishing_maven">maven-publish</a> plugin, and the <a href="#publishing_ivy">ivy-publish</a> plugin.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-gradle-plugin`
    `maven-publish`
    `ivy-publish`
}

group = &quot;com.example&quot;
version = &quot;1.0.0&quot;

gradlePlugin {
    plugins {
        create(&quot;hello&quot;) {
            id = &quot;com.example.hello&quot;
            implementationClass = &quot;com.example.hello.HelloPlugin&quot;
        }
        create(&quot;goodbye&quot;) {
            id = &quot;com.example.goodbye&quot;
            implementationClass = &quot;com.example.goodbye.GoodbyePlugin&quot;
        }
    }
}

publishing {
    repositories {
        maven {
            url = uri(layout.buildDirectory.dir(&quot;maven-repo&quot;))
        }
        ivy {
            url = uri(layout.buildDirectory.dir(&quot;ivy-repo&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-gradle-plugin</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">ivy-publish</span><span class="delimiter">'</span></span>
}

group <span class="string"><span class="delimiter">'</span><span class="content">com.example</span><span class="delimiter">'</span></span>
version <span class="string"><span class="delimiter">'</span><span class="content">1.0.0</span><span class="delimiter">'</span></span>

gradlePlugin {
    plugins {
        hello {
            id = <span class="string"><span class="delimiter">'</span><span class="content">com.example.hello</span><span class="delimiter">'</span></span>
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">com.example.hello.HelloPlugin</span><span class="delimiter">'</span></span>
        }
        goodbye {
            id = <span class="string"><span class="delimiter">'</span><span class="content">com.example.goodbye</span><span class="delimiter">'</span></span>
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">com.example.goodbye.GoodbyePlugin</span><span class="delimiter">'</span></span>
        }
    }
}

publishing {
    repositories {
        maven {
            url layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">maven-repo</span><span class="delimiter">&quot;</span></span>)
        }
        ivy {
            url layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">ivy-repo</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Running <code>gradle publish</code> in the sample directory creates the following Maven repository layout (the Ivy layout is similar):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/plugin-markers.png" alt="plugin markers">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:old_plugin_application"><a class="anchor" href="#sec:old_plugin_application"></a><a class="link" href="#sec:old_plugin_application">Legacy Plugin Application</a></h4>
<div class="paragraph">
<p>With the introduction of the <a href="#sec:plugins_block">plugins DSL</a>, users should have little reason to use the legacy method of applying plugins.
It is documented here in case a build author cannot use the plugin DSL due to restrictions in how it currently works.</p>
</div>
<div id="sec:applying_binary_plugins" class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(plugin = &quot;java&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Plugins can be applied using a <em>plugin id</em>.
In the above case, we are using the short name "java" to apply the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/plugins/JavaPlugin.html">JavaPlugin</a>.</p>
</div>
<div class="paragraph">
<p>Rather than using a plugin id, plugins can also be applied by simply specifying the class of the plugin:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply&lt;JavaPlugin&gt;()</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: JavaPlugin</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>JavaPlugin</code> symbol in the above sample refers to the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/plugins/JavaPlugin.html">JavaPlugin</a>.
This class does not strictly need to be imported as the <code>org.gradle.api.plugins</code> package is automatically imported in all build scripts (see <a href="#script-default-imports">Default imports</a>).</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>Furthermore, one needs to append the <code>::class</code> suffix to identify a class literal in Kotlin instead of <code>.class</code> in Java.</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>Furthermore, it is unnecessary to append <code>.class</code> to identify a class literal in Groovy as it is in Java.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:version_catalog_plugin_application"><a class="anchor" href="#sec:version_catalog_plugin_application"></a><a class="link" href="#sec:version_catalog_plugin_application">Using a Version Catalog</a></h4>
<div class="paragraph">
<p>When a project uses a version catalog, plugins can be referenced via aliases when applied.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at a simple Version Catalog:</p>
</div>
<div class="listingblock">
<div class="title">gradle/libs.versions.toml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="toml">[versions]
intellij-plugin = &quot;1.6&quot;

[plugins]
jetbrains-intellij = { id = &quot;org.jetbrains.intellij&quot;, version.ref = &quot;intellij-plugin&quot; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then a plugin can be applied to any build script using the <code>alias</code> method:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    alias(libs.plugins.jetbrains.intellij)
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<code>jetbrains-intellij</code> is available as the Gradle generated safe accessor: <code>jetbrains.intellij</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#writing_plugins">Learn how to write Plugins</a> &gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="writing_plugins"><a class="anchor" href="#writing_plugins"></a><a class="link" href="#writing_plugins">Writing Plugins</a></h3>
<div class="paragraph">
<p>If Gradle or the Gradle community does not offer the specific capabilities your project needs, creating your own plugin could be a solution.</p>
</div>
<div class="paragraph">
<p>Additionally, if you find yourself duplicating build logic across subprojects and need a better way to organize it, custom plugins can help.</p>
</div>
<div class="sect3">
<h4 id="custom_plugin"><a class="anchor" href="#custom_plugin"></a><a class="link" href="#custom_plugin">Custom plugin</a></h4>
<div class="paragraph">
<p>A plugin is any class that implements the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Plugin.html"><code>Plugin</code></a> interface.
The example below is the most straightforward plugin, a "hello world" <strong>plugin</strong>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.gradle.api.Plugin
import org.gradle.api.Project

abstract class SamplePlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        project.tasks.create(&quot;SampleTask&quot;) {
            println(&quot;Hello world!&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="script_plugin"><a class="anchor" href="#script_plugin"></a><a class="link" href="#script_plugin">Script plugin</a></h4>
<div class="paragraph">
<p>Many plugins start as a script plugin coded in a build script.
This offers an easy way to rapidly prototype and experiment when building a plugin.
Let&#8217;s take a look at an example:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Define a task
abstract class CreateFileTask : DefaultTask() {                                     // <b class="conum">(1)</b>
    @get:Input
    abstract val fileText: Property&lt;String&gt;                                         // <b class="conum">(2)</b>

    @Input
    val fileName = &quot;myfile.txt&quot;

    @OutputFile
    val myFile: File = File(fileName)

    @TaskAction
    fun action() {
        myFile.createNewFile()
        myFile.writeText(fileText.get())
    }
}

// Define a plugin
abstract class MyPlugin : Plugin&lt;Project&gt; {                                         // <b class="conum">(3)</b>
    override fun apply(project: Project) {
        tasks {
            register(&quot;createFileTask&quot;, CreateFileTask::class) {
                group = &quot;from my plugin&quot;
                description = &quot;Create myfile.txt in the current directory&quot;
                fileText.set(&quot;HELLO FROM MY PLUGIN&quot;)
            }
        }
    }
}

// Apply the local plugin
apply&lt;MyPlugin&gt;()                                                                   // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Subclass <code>DefaultTask()</code>.</p>
</li>
<li>
<p>Use lazy configuration in the task.</p>
</li>
<li>
<p>Extend the <code>org.gradle.api.Plugin</code> interface.</p>
</li>
<li>
<p>Apply the script plugin.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="1_subclass_defaulttask"><a class="anchor" href="#1_subclass_defaulttask"></a><a class="link" href="#1_subclass_defaulttask">1. Subclass <code>DefaultTask()</code></a></h5>
<div class="paragraph">
<p>First, build a task by subclassing <code>DefaultTask()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class CreateFileTask : DefaultTask() { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This simple task adds a file to our application’s root directory.</p>
</div>
</div>
<div class="sect4">
<h5 id="2_use_lazy_configuration"><a class="anchor" href="#2_use_lazy_configuration"></a><a class="link" href="#2_use_lazy_configuration">2. Use Lazy Configuration</a></h5>
<div class="paragraph">
<p>Gradle has a concept called <em>lazy configuration</em>, which allows task inputs and outputs to be referenced before they are actually set.
This is done via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Property.html"><code>Property</code></a> class type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract val fileText: Property&lt;String&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>One advantage of this mechanism is that you can link the output file of one task to the input file of another, all before the filename has even been decided.
The <code>Property</code> class also knows which task it’s linked to, enabling Gradle to add the required task dependency automatically.</p>
</div>
</div>
<div class="sect4">
<h5 id="3_extend_the_org_gradle_api_plugin_interface"><a class="anchor" href="#3_extend_the_org_gradle_api_plugin_interface"></a><a class="link" href="#3_extend_the_org_gradle_api_plugin_interface">3. Extend the <code>org.gradle.api.Plugin</code> interface</a></h5>
<div class="paragraph">
<p>Next, create a new class that extends the <code>org.gradle.api.Plugin</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>abstract class MyPlugin : Plugin&lt;Project&gt; {
    override fun apply() {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add tasks and other logic in the <code>apply()</code> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="4_apply_the_script_plugin"><a class="anchor" href="#4_apply_the_script_plugin"></a><a class="link" href="#4_apply_the_script_plugin">4. Apply the script plugin</a></h5>
<div class="paragraph">
<p>Finally, apply the local plugin in the build script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>apply&lt;MyPlugin&gt;()</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <code>MyPlugin</code> is applied in the build script, Gradle calls the <code>fun apply() {}</code> method defined in the custom <code>MyPlugin</code> class.</p>
</div>
<div class="paragraph">
<p>This makes the plugin available to the application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Script plugins are NOT recommended. Script plugins offer an easy way to rapidly prototype build logic, before migrating it to a more permanent solution such as <strong>convention plugins</strong> or <strong>binary plugins</strong>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="convention_plugins"><a class="anchor" href="#convention_plugins"></a><a class="link" href="#convention_plugins">Convention Plugins</a></h4>
<div class="paragraph">
<p>Convention plugins are a way to encapsulate and reuse common build logic in Gradle.
They allow you to define a set of conventions for a project, and then apply those conventions to other projects or modules.</p>
</div>
<div class="paragraph">
<p>The example above has been re-written as a convention plugin stored in <code>buildSrc</code>:</p>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/MyConventionPlugin.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.gradle.api.DefaultTask
import org.gradle.api.Plugin
import org.gradle.api.Project
import org.gradle.api.provider.Property
import org.gradle.api.tasks.Input
import org.gradle.api.tasks.OutputFile
import org.gradle.api.tasks.TaskAction
import java.io.File

abstract class CreateFileTask : DefaultTask() {
    @get:Input
    abstract val fileText: Property&lt;String&gt;

    @Input
    val fileName = project.rootDir.toString() + &quot;/myfile.txt&quot;

    @OutputFile
    val myFile: File = File(fileName)

    @TaskAction
    fun action() {
        myFile.createNewFile()
        myFile.writeText(fileText.get())
    }
}

class MyConventionPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        project.tasks.register(&quot;createFileTask&quot;, CreateFileTask::class.java) {
            group = &quot;from my plugin&quot;
            description = &quot;Create myfile.txt in the current directory&quot;
            fileText.set(&quot;HELLO FROM MY PLUGIN&quot;)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin can be given an <code>id</code> using a <code>gradlePlugin{}</code> block so that it can be referenced in the root:</p>
</div>
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">gradlePlugin {
    plugins {
        create(&quot;my-convention-plugin&quot;) {
            id = &quot;com.gradle.plugin.my-convention-plugin&quot;
            implementationClass = &quot;com.gradle.plugin.MyConventionPlugin&quot;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>gradlePlugin{}</code> block defines the plugins being built by the project.
With the newly created <code>id</code>, the plugin can be applied in other build scripts accordingly:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    application
    id(&quot;com.gradle.plugin.my-convention-plugin&quot;) // Apply the new plugin
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="binary_plugins"><a class="anchor" href="#binary_plugins"></a><a class="link" href="#binary_plugins">Binary Plugins</a></h4>
<div class="paragraph">
<p>A binary plugin is a plugin that is implemented in a compiled language and is packaged as a JAR file.
It is resolved as a dependency rather than compiled from source.</p>
</div>
<div class="paragraph">
<p>For most use cases, convention plugins must be updated infrequently.
Having each developer execute the plugin build as part of their development process is wasteful, and we can instead distribute them as binary dependencies.</p>
</div>
<div class="paragraph">
<p>There are two ways to update the convention plugin in the example above into a binary plugin.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use <a href="#composite_builds">composite builds</a>:</p>
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">includeBuild(&quot;my-plugin&quot;)</code></pre>
</div>
</div>
</li>
<li>
<p><a href="#sec:publishing_your_plugin">Publish the plugin</a> to a repository:</p>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.gradle.plugin.myconventionplugin&quot;) version &quot;1.0.0&quot;
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Consult the <a href="#custom_plugins">Developing Plugins chapter</a> to learn more.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="structuring_builds"><a class="anchor" href="#structuring_builds"></a><a class="link" href="#structuring_builds">STRUCTURING BUILDS</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="multi_project_builds"><a class="anchor" href="#multi_project_builds"></a><a class="link" href="#multi_project_builds">Structuring Projects with Gradle</a></h3>
<div class="paragraph">
<p>It is important to structure your Gradle project to optimize build performance.
A multi-project build is the standard in Gradle.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/structuring-builds-1.png" alt="structuring builds 1">
</div>
</div>
<div class="paragraph">
<p>A multi-project build consists of one root project and one or more subprojects.
Gradle can build the root project and any number of the subprojects in a single execution.</p>
</div>
<div class="sect3">
<h4 id="sub:project_locations"><a class="anchor" href="#sub:project_locations"></a><a class="link" href="#sub:project_locations">Project locations</a></h4>
<div class="paragraph">
<p>Multi-project builds contain a single root project in a directory that Gradle views as the root path: <code>.</code>.</p>
</div>
<div class="paragraph">
<p>Subprojects are located physically under the root path: <code>./subproject</code>.</p>
</div>
<div class="paragraph">
<p>A subproject has <a href="#sec:project_path">a path</a>, which denotes the position of that subproject in the multi-project build.
In most cases, the project path is consistent with its location in the file system.</p>
</div>
<div class="paragraph">
<p>The project structure is created in the <code>settings.gradle(.kts)</code> file.
The settings file must be present in the root directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:creating_multi_project_builds"><a class="anchor" href="#sec:creating_multi_project_builds"></a><a class="link" href="#sec:creating_multi_project_builds">A simple multi-project build</a></h4>
<div class="paragraph">
<p>Let&#8217;s look at a <em>basic</em> multi-project build example that contains a root project and a single subproject.</p>
</div>
<div class="paragraph">
<p>The root project is called <code>basic-multiproject</code>, located somewhere on your machine.
From Gradle&#8217;s perspective, the root is the top-level directory <code>.</code>.</p>
</div>
<div class="paragraph">
<p>The project contains a single subproject called <code>./app</code>:</p>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
├── app
│   ...
│   └── build.gradle.kts
└── settings.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error">├</span><span class="error">─</span><span class="error">─</span> app
<span class="error">│</span>   ...
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">└</span><span class="error">─</span><span class="error">─</span> settings.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is the recommended project structure for starting any Gradle project.
The <a href="build_init_plugin.html#build_init_plugin">build init plugin</a> also generates skeleton projects that follow this structure - a root project with a single subproject:</p>
</div>
<div class="paragraph">
<p>The <code>settings.gradle(.kts)</code> file describes the project structure to Gradle:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;basic-multiproject&quot;
include(&quot;app&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">basic-multiproject</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">app</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, Gradle will look for a build file for the <code>app</code> subproject in the <code>./app</code> directory.</p>
</div>
<div class="paragraph">
<p>You can view the structure of a multi-project build by running the <code>projects</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew -q projects

Projects:

------------------------------------------------------------
Root project 'basic-multiproject'
------------------------------------------------------------

Root project 'basic-multiproject'
\--- Project ':app'

To see a list of the tasks of a project, run gradle &lt;project-path&gt;:tasks
For example, try running gradle :app:tasks</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>app</code> subproject is a Java application that applies the <a href="#application_plugin">application plugin</a> and configures the main class.
The application prints <code>Hello World</code> to the console:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;application&quot;)
}

application {
    mainClass = &quot;com.example.Hello&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">application</span><span class="delimiter">'</span></span>
}

application {
    mainClass = <span class="string"><span class="delimiter">'</span><span class="content">com.example.Hello</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">app/src/main/java/com/example/Hello.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.example</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Hello</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, world!</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can run the application by executing the <code>run</code> task from the <a href="#application_plugin">application plugin</a> in the project root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew -q run
Hello, world!</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sub:building_the_tree"><a class="anchor" href="#sub:building_the_tree"></a><a class="link" href="#sub:building_the_tree">Adding a subproject</a></h4>
<div class="paragraph">
<p>In the settings file, you can use the <code>include</code> method to add another subproject to the root project:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;project1&quot;, &quot;project2:child1&quot;, &quot;project3:child1&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">include <span class="string"><span class="delimiter">'</span><span class="content">project1</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">project2:child1</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">project3:child1</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>include</code> method takes <a href="#sec:project_path">project paths</a> as arguments.
The project path is assumed to be equal to the relative physical file system path.
For example, a path <code>services:api</code> is mapped by default to a folder <code>./services/api</code> (relative to the project root <code>.</code>).</p>
</div>
<div class="paragraph">
<p>More examples of how to work with the project path can be found in the DSL documentation of <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.initialization.Settings.html#org.gradle.api.initialization.Settings:include(java.lang.String[])">Settings.include(java.lang.String[])</a>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add another subproject called <code>lib</code> to the previously created project.</p>
</div>
<div class="paragraph">
<p>All we need to do is add another <code>include</code> statement in the root settings file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;basic-multiproject&quot;
include(&quot;app&quot;)
include(&quot;lib&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">basic-multiproject</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">app</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">lib</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle will then look for the build file of the new <code>lib</code> subproject in the <code>./lib/</code> directory:</p>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
├── app
│   ...
│   └── build.gradle.kts
├── lib
│   ...
│   └── build.gradle.kts
└── settings.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error">├</span><span class="error">─</span><span class="error">─</span> app
<span class="error">│</span>   ...
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">├</span><span class="error">─</span><span class="error">─</span> lib
<span class="error">│</span>   ...
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">└</span><span class="error">─</span><span class="error">─</span> settings.gradle</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sub:modifying_element_of_the_project_tree"><a class="anchor" href="#sub:modifying_element_of_the_project_tree"></a><a class="link" href="#sub:modifying_element_of_the_project_tree">Project Descriptors</a></h4>
<div class="paragraph">
<p>To further describe the project architecture to Gradle, the settings file provides <em>project descriptors</em>.</p>
</div>
<div class="paragraph">
<p>You can modify these descriptors in the settings file at any time.</p>
</div>
<div class="paragraph">
<p>To access a descriptor, you can:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;project-a&quot;)
println(rootProject.name)
println(project(&quot;:project-a&quot;).name)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">include(<span class="string"><span class="delimiter">'</span><span class="content">project-a</span><span class="delimiter">'</span></span>)
println rootProject.name
println project(<span class="string"><span class="delimiter">'</span><span class="content">:project-a</span><span class="delimiter">'</span></span>).name</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using this descriptor, you can change the name, project directory, and build file of a project:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;main&quot;
include(&quot;project-a&quot;)
project(&quot;:project-a&quot;).projectDir = file(&quot;custom/my-project-a&quot;)
project(&quot;:project-a&quot;).buildFileName = &quot;project-a.gradle.kts&quot;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">main</span><span class="delimiter">'</span></span>
include(<span class="string"><span class="delimiter">'</span><span class="content">project-a</span><span class="delimiter">'</span></span>)
project(<span class="string"><span class="delimiter">'</span><span class="content">:project-a</span><span class="delimiter">'</span></span>).projectDir = file(<span class="string"><span class="delimiter">'</span><span class="content">custom/my-project-a</span><span class="delimiter">'</span></span>)
project(<span class="string"><span class="delimiter">'</span><span class="content">:project-a</span><span class="delimiter">'</span></span>).buildFileName = <span class="string"><span class="delimiter">'</span><span class="content">project-a.gradle</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Consult the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/initialization/ProjectDescriptor.html">ProjectDescriptor</a> class in the API documentation for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="modifying_a_subproject_path"><a class="anchor" href="#modifying_a_subproject_path"></a><a class="link" href="#modifying_a_subproject_path">Modifying a subproject path</a></h4>
<div class="paragraph">
<p>Let&#8217;s take a hypothetical project with the following structure:</p>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
├── app
│   ...
│   └── build.gradle.kts
├── subs // Gradle may see this as a subproject
│   └── web // Gradle may see this as a subproject
│       └── my-web-module // Intended subproject
│           ...
│           └── build.gradle.kts
└── settings.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error">├</span><span class="error">─</span><span class="error">─</span> app
<span class="error">│</span>   ...
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">├</span><span class="error">─</span><span class="error">─</span> subs <span class="comment">// Gradle may see this as a subproject</span>
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> web <span class="comment">// Gradle may see this as a subproject</span>
<span class="error">│</span>       <span class="error">└</span><span class="error">─</span><span class="error">─</span> my-web-module <span class="comment">// Intended subproject</span>
<span class="error">│</span>           ...
<span class="error">│</span>           <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">└</span><span class="error">─</span><span class="error">─</span> settings.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If your <code>settings.gradle(.kts)</code> looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>include(':subs:web:my-web-module')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle sees a subproject with a logical project name of <code>:subs:web:my-web-module</code> and two, possibly unintentional, other subprojects logically named <code>:subs</code> and <code>:subs:web</code>.
This can lead to phantom build directories, especially when using <code>allprojects{}</code> or <code>subproject{}</code>.</p>
</div>
<div class="paragraph">
<p>To avoid this, you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>include(':subs:web:my-web-module')
project(':subs:web:my-web-module').projectDir = &quot;subs/web/my-web-module&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>So that you only end up with a single subproject named <code>:subs:web:my-web-module</code>.</p>
</div>
<div class="paragraph">
<p>Or you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>include(':my-web-module')
project(':my-web-module').projectDir = &quot;subs/web/my-web-module&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>So that you only end up with a single subproject named <code>:my-web-module</code>.</p>
</div>
<div class="paragraph">
<p>So, while the physical project layout is the same, the logical results are different.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:naming_recommendations"><a class="anchor" href="#sec:naming_recommendations"></a><a class="link" href="#sec:naming_recommendations">Naming recommendations</a></h4>
<div class="paragraph">
<p>As your project grows, naming and consistency get increasingly more important.
To keep your builds maintainable, we recommend the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Keep default project names for subprojects</strong>:
It is possible to configure custom project names in the settings file.
However, it’s an unnecessary extra effort for the developers to track which projects belong to what folders.</p>
</li>
<li>
<p><strong>Use lower case hyphenation for all project names</strong>:
All letters are lowercase, and words are separated with a dash (<code>-</code>) character.</p>
</li>
<li>
<p><strong>Define the root project name in the settings file</strong>:
The <code>rootProject.name</code> effectively assigns a name to the build, used in reports like Build Scans.
If the root project name is not set, the name will be the container directory name, which can be unstable (i.e., you can check out your project in any directory).
The name will be generated randomly if the root project name is not set and checked out to a file system&#8217;s root (e.g., <code>/</code> or <code>C:\</code>).</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="declaring_dependencies_between_subprojects"><a class="anchor" href="#declaring_dependencies_between_subprojects"></a><a class="link" href="#declaring_dependencies_between_subprojects">Declaring Dependencies between Subprojects</a></h3>
<div class="paragraph">
<p>What if one subproject depends on another subproject?
What if one project needs the artifact produced by another project?</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/structuring-builds-2.png" alt="structuring builds 2">
</div>
</div>
<div class="paragraph">
<p>This is a common use case for multi-project builds.
Gradle offers <a href="#sub:project_dependencies">project dependencies</a> for this.</p>
</div>
<div class="sect3">
<h4 id="sec:project_jar_dependencies"><a class="anchor" href="#sec:project_jar_dependencies"></a><a class="link" href="#sec:project_jar_dependencies">Depending on another project</a></h4>
<div class="paragraph">
<p>Let&#8217;s explore a theoretical multi-project build with the following layout:</p>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
├── api
│   ├── src
│   │   └──...
│   └── build.gradle.kts
├── services
│   └── person-service
│       ├── src
│       │   └──...
│       └── build.gradle.kts
├── shared
│   ├── src
│   │   └──...
│   └── build.gradle.kts
└── settings.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error">├</span><span class="error">─</span><span class="error">─</span> api
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> src
<span class="error">│</span>   <span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span>...
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">├</span><span class="error">─</span><span class="error">─</span> services
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> person-service
<span class="error">│</span>       <span class="error">├</span><span class="error">─</span><span class="error">─</span> src
<span class="error">│</span>       <span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span>...
<span class="error">│</span>       <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">├</span><span class="error">─</span><span class="error">─</span> shared
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> src
<span class="error">│</span>   <span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span>...
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">└</span><span class="error">─</span><span class="error">─</span> settings.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, there are three subprojects called <code>shared</code>, <code>api</code>, and <code>person-service</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>person-service</code> subproject depends on the other two subprojects, <code>shared</code> and <code>api</code>.</p>
</li>
<li>
<p>The <code>api</code> subproject depends on the <code>shared</code> subproject.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We use the <code>:</code> separator to define a <a href="#sec:project_path">project path</a> such as <code>services:person-service</code> or <code>:shared</code>.
Consult the DSL documentation of <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.initialization.Settings.html#org.gradle.api.initialization.Settings:include(java.lang.String[])">Settings.include(java.lang.String[])</a> for more information about defining project paths.</p>
</div>
<div id="javadependencies_2" class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;dependencies-java&quot;
include(&quot;api&quot;, &quot;shared&quot;, &quot;services:person-service&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">shared/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;java&quot;)
}

repositories {
    mavenCentral()
}

dependencies {
    testImplementation(&quot;junit:junit:4.13&quot;)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">api/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;java&quot;)
}

repositories {
    mavenCentral()
}

dependencies {
    testImplementation(&quot;junit:junit:4.13&quot;)
    implementation(project(&quot;:shared&quot;))
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">services/person-service/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;java&quot;)
}

repositories {
    mavenCentral()
}

dependencies {
    testImplementation(&quot;junit:junit:4.13&quot;)
    implementation(project(&quot;:shared&quot;))
    implementation(project(&quot;:api&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">basic-dependencies</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">api</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">shared</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">services:person-service</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">shared/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
}

dependencies {
    testImplementation <span class="string"><span class="delimiter">&quot;</span><span class="content">junit:junit:4.13</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">api/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
}

dependencies {
    testImplementation <span class="string"><span class="delimiter">&quot;</span><span class="content">junit:junit:4.13</span><span class="delimiter">&quot;</span></span>
    implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:shared</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">services/person-service/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
}

dependencies {
    testImplementation <span class="string"><span class="delimiter">&quot;</span><span class="content">junit:junit:4.13</span><span class="delimiter">&quot;</span></span>
    implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:shared</span><span class="delimiter">'</span></span>)
    implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:api</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A project dependency affects execution order.
It causes the other project to be built first and adds the output with the classes of the other project to the classpath.
It also adds the dependencies of the other project to the classpath.</p>
</div>
<div class="paragraph">
<p>If you execute <code>./gradlew :api:compile</code>, first the <code>shared</code> project is built, and then the <code>api</code> project is built.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:depending_on_output_of_another_project"><a class="anchor" href="#sec:depending_on_output_of_another_project"></a><a class="link" href="#sec:depending_on_output_of_another_project">Depending on artifacts produced by another project</a></h4>
<div class="paragraph">
<p>Sometimes, you might want to depend on the output of a specific task within another project rather than the entire project.
However, explicitly declaring a task dependency from one project to another is discouraged as it introduces unnecessary coupling between tasks.</p>
</div>
<div class="paragraph">
<p>The recommended way to model dependencies, where a task in one project depends on the output of another, is to produce the output and mark it as an "outgoing" artifact.
Gradle&#8217;s <a href="#cross_project_publications">dependency management engine</a> allows you to share arbitrary artifacts between projects and build them on demand.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sharing_build_logic_between_subprojects"><a class="anchor" href="#sharing_build_logic_between_subprojects"></a><a class="link" href="#sharing_build_logic_between_subprojects">Sharing Build Logic between Subprojects</a></h3>
<div class="paragraph">
<p>Subprojects in a multi-project build typically share some common dependencies.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/structuring-builds-3.png" alt="structuring builds 3">
</div>
</div>
<div class="paragraph">
<p>Instead of copying and pasting the same Java version and libraries in each subproject build script, Gradle provides a special directory for storing shared build logic that can be automatically applied to subprojects.</p>
</div>
<div class="sect3">
<h4 id="sec:using_buildsrc"><a class="anchor" href="#sec:using_buildsrc"></a><a class="link" href="#sec:using_buildsrc">Share logic in <code>buildSrc</code></a></h4>
<div class="paragraph">
<p><code>buildSrc</code> is a Gradle-recognized and protected directory which comes with some benefits:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Reusable Build Logic</strong>:</p>
<div class="paragraph">
<p><code>buildSrc</code> allows you to organize and centralize your custom build logic, tasks, and plugins in a structured manner.
The code written in buildSrc can be reused across your project, making it easier to maintain and share common build functionality.</p>
</div>
</li>
<li>
<p><strong>Isolation from the Main Build</strong>:</p>
<div class="paragraph">
<p>Code placed in <code>buildSrc</code> is isolated from the other build scripts of your project.
This helps keep the main build scripts cleaner and more focused on project-specific configurations.</p>
</div>
</li>
<li>
<p><strong>Automatic Compilation and Classpath</strong>:</p>
<div class="paragraph">
<p>The contents of the <code>buildSrc</code> directory are automatically compiled and included in the classpath of your main build.
This means that classes and plugins defined in buildSrc can be directly used in your project&#8217;s build scripts without any additional configuration.</p>
</div>
</li>
<li>
<p><strong>Ease of Testing</strong>:</p>
<div class="paragraph">
<p>Since <code>buildSrc</code> is a separate build, it allows for easy testing of your custom build logic.
You can write tests for your build code, ensuring that it behaves as expected.</p>
</div>
</li>
<li>
<p><strong>Gradle Plugin Development</strong>:</p>
<div class="paragraph">
<p>If you are developing custom Gradle plugins for your project, <code>buildSrc</code> is a convenient place to house the plugin code.
This makes the plugins easily accessible within your project.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>buildSrc</code> directory is treated as an <a href="#composite_build_intro">included build</a>.</p>
</div>
<div class="paragraph">
<p>For multi-project builds, there can be only one <code>buildSrc</code> directory, which must be in the root project directory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The downside of using <code>buildSrc</code> is that any change to it will invalidate every task in your project and require a rerun.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>buildSrc</code> uses the same <a href="java_plugin.html#javalayout">source code conventions</a> applicable to Java, Groovy, and Kotlin projects.
It also provides direct access to the Gradle API.</p>
</div>
<div class="paragraph">
<p>A typical project including <code>buildSrc</code> has the following layout:</p>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
├── buildSrc
│   ├── src
│   │   └──main
│   │      └──kotlin
│   │         └──MyCustomTask.kt    // <b class="conum">(1)</b>
│   ├── shared.gradle.kts   // <b class="conum">(2)</b>
│   └── build.gradle.kts
├── api
│   ├── src
│   │   └──...
│   └── build.gradle.kts    // <b class="conum">(3)</b>
├── services
│   └── person-service
│       ├── src
│       │   └──...
│       └── build.gradle.kts    // <b class="conum">(3)</b>
├── shared
│   ├── src
│   │   └──...
│   └── build.gradle.kts
└── settings.gradle.kts</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Create the <code>MyCustomTask</code> task.</p>
</li>
<li>
<p>A shared build script.</p>
</li>
<li>
<p>Uses the <code>MyCustomTask</code> task and shared build script.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error">├</span><span class="error">─</span><span class="error">─</span> buildSrc
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> src
<span class="error">│</span>   <span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span>main
<span class="error">│</span>   <span class="error">│</span>      <span class="error">└</span><span class="error">─</span><span class="error">─</span>groovy
<span class="error">│</span>   <span class="error">│</span>         <span class="error">└</span><span class="error">─</span><span class="error">─</span>MyCustomTask.groovy    // <b class="conum">(1)</b>
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> shared.gradle   // <b class="conum">(2)</b>
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">├</span><span class="error">─</span><span class="error">─</span> api
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> src
<span class="error">│</span>   <span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span>...
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle    // <b class="conum">(3)</b>
<span class="error">├</span><span class="error">─</span><span class="error">─</span> services
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> person-service
<span class="error">│</span>       <span class="error">├</span><span class="error">─</span><span class="error">─</span> src
<span class="error">│</span>       <span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span>...
<span class="error">│</span>       <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle    // <b class="conum">(3)</b>
<span class="error">├</span><span class="error">─</span><span class="error">─</span> shared
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> src
<span class="error">│</span>   <span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span>...
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">└</span><span class="error">─</span><span class="error">─</span> settings.gradle</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Create the <code>MyCustomTask</code> task.</p>
</li>
<li>
<p>A shared build script.</p>
</li>
<li>
<p>Uses the <code>MyCustomTask</code> task and shared build script.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>In the <code>buildSrc</code>, the build script <code>shared.gradle(.kts)</code> is created.
It contains dependencies and other build information that is common to multiple subprojects:</p>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">shared.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;org.slf4j:slf4j-api:1.7.32&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">shared.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-api:1.7.32</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the <code>buildSrc</code>, the <code>MyCustomTask</code> is also created.
It is a helper task that is used as part of the build logic for multiple subprojects:</p>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">MyCustomTask.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.gradle.api.DefaultTask
import org.gradle.api.tasks.TaskAction

open class MyCustomTask : DefaultTask() {
    @TaskAction
    fun calculateSum() {
        // Custom logic to calculate the sum of two numbers
        val num1 = 5
        val num2 = 7
        val sum = num1 + num2

        // Print the result
        println(&quot;Sum: $sum&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">MyCustomTask.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>

<span class="type">class</span> <span class="class">MyCustomTask</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> calculateSum() {
        <span class="comment">// Custom logic to calculate the sum of two numbers</span>
        <span class="type">int</span> num1 = <span class="integer">5</span>
        <span class="type">int</span> num2 = <span class="integer">7</span>
        <span class="type">int</span> sum = num1 + num2

        <span class="comment">// Print the result</span>
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Sum: </span><span class="inline"><span class="inline-delimiter">$</span>sum</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>MyCustomTask</code> task is used in the build script of the <code>api</code> and <code>shared</code> projects.
The task is automatically available because it&#8217;s part of <code>buildSrc</code>.</p>
</div>
<div class="paragraph">
<p>The <code>shared.build(.kts)</code> file is also applied:</p>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Apply any other configurations specific to your project

// Use the build script defined in buildSrc
apply(from = rootProject.file(&quot;buildSrc/shared.gradle&quot;))

// Use the custom task defined in buildSrc
tasks.register&lt;MyCustomTask&gt;(&quot;myCustomTask&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Apply any other configurations specific to your project</span>

<span class="comment">// Use the build script defined in buildSrc</span>
apply <span class="key">from</span>: rootProject.file(<span class="string"><span class="delimiter">'</span><span class="content">buildSrc/shared.gradle</span><span class="delimiter">'</span></span>)

<span class="comment">// Use the custom task defined in buildSrc</span>
tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">myCustomTask</span><span class="delimiter">'</span></span>, MyCustomTask)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:convention_plugins"><a class="anchor" href="#sec:convention_plugins"></a><a class="link" href="#sec:convention_plugins">Share logic using convention plugins</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s recommended way of organizing build logic is to use its plugin system.</p>
</div>
<div class="paragraph">
<p>We can write a plugin that encapsulates the build logic common to several subprojects in a project.
This kind of plugin is called a <strong>convention plugin</strong>.</p>
</div>
<div class="paragraph">
<p>While writing plugins is outside the scope of this section, the recommended way to build a Gradle project is to put common build logic in a convention plugin located in the <code>buildSrc</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at an example project:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
├── buildSrc
│   ├── src
│   │   └──main
│   │      └──kotlin
│   │         └──myproject.java-conventions.gradle.kts  // <b class="conum">(1)</b>
│   └── build.gradle.kts
├── api
│   ├── src
│   │   └──...
│   └── build.gradle.kts    // <b class="conum">(2)</b>
├── services
│   └── person-service
│       ├── src
│       │   └──...
│       └── build.gradle.kts    // <b class="conum">(2)</b>
├── shared
│   ├── src
│   │   └──...
│   └── build.gradle.kts    // <b class="conum">(2)</b>
└── settings.gradle.kts</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Create the <code>myproject.java-conventions</code> convention plugin.</p>
</li>
<li>
<p>Applies the <code>myproject.java-conventions</code> convention plugin.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error">├</span><span class="error">─</span><span class="error">─</span> buildSrc
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> src
<span class="error">│</span>   <span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span>main
<span class="error">│</span>   <span class="error">│</span>      <span class="error">└</span><span class="error">─</span><span class="error">─</span>groovy
<span class="error">│</span>   <span class="error">│</span>         <span class="error">└</span><span class="error">─</span><span class="error">─</span>myproject.java-conventions.gradle  // <b class="conum">(1)</b>
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">├</span><span class="error">─</span><span class="error">─</span> api
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> src
<span class="error">│</span>   <span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span>...
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle    // <b class="conum">(2)</b>
<span class="error">├</span><span class="error">─</span><span class="error">─</span> services
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> person-service
<span class="error">│</span>       <span class="error">├</span><span class="error">─</span><span class="error">─</span> src
<span class="error">│</span>       <span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span>...
<span class="error">│</span>       <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle    // <b class="conum">(2)</b>
<span class="error">├</span><span class="error">─</span><span class="error">─</span> shared
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> src
<span class="error">│</span>   <span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span>...
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle    // <b class="conum">(2)</b>
<span class="error">└</span><span class="error">─</span><span class="error">─</span> settings.gradle</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Create the <code>myproject.java-conventions</code> convention plugin.</p>
</li>
<li>
<p>Applies the <code>myproject.java-conventions</code> convention plugin.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This build contains three subprojects:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;dependencies-java&quot;
include(&quot;api&quot;, &quot;shared&quot;, &quot;services:person-service&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">dependencies-java</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">api</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">shared</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">services:person-service</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The source code for the convention plugin created in the <code>buildSrc</code> directory is as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/myproject.java-conventions.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;java&quot;)
}

group = &quot;com.example&quot;
version = &quot;1.0&quot;

repositories {
    mavenCentral()
}

dependencies {
    testImplementation(&quot;junit:junit:4.13&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/myproject.java-conventions.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

group = <span class="string"><span class="delimiter">'</span><span class="content">com.example</span><span class="delimiter">'</span></span>
version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>

repositories {
    mavenCentral()
}

dependencies {
    testImplementation <span class="string"><span class="delimiter">&quot;</span><span class="content">junit:junit:4.13</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For the convention plugin to compile, basic configuration needs to be applied in the build file of the <code>buildSrc</code> directory:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `kotlin-dsl`
}

repositories {
    mavenCentral()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy-gradle-plugin</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The convention plugin is applied to the <code>api</code>, <code>shared</code>, and <code>person-service</code> subprojects:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">api/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;myproject.java-conventions&quot;)
}

dependencies {
    implementation(project(&quot;:shared&quot;))
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">shared/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;myproject.java-conventions&quot;)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">services/person-service/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;myproject.java-conventions&quot;)
}

dependencies {
    implementation(project(&quot;:shared&quot;))
    implementation(project(&quot;:api&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">api/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">myproject.java-conventions</span><span class="delimiter">'</span></span>
}

dependencies {
    implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:shared</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">shared/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">myproject.java-conventions</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">services/person-service/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">myproject.java-conventions</span><span class="delimiter">'</span></span>
}

dependencies {
    implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:shared</span><span class="delimiter">'</span></span>)
    implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:api</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:convention_plugins_vs_cross_configuration"><a class="anchor" href="#sec:convention_plugins_vs_cross_configuration"></a><a class="link" href="#sec:convention_plugins_vs_cross_configuration">Do not use cross-project configuration</a></h4>
<div class="paragraph">
<p>An improper way to share build logic between subprojects is <em>cross-project configuration</em> via the <a href="https://docs.gradle.org/8.9/javadoc//org/gradle/api/Project.html#subprojects-groovy.lang.Closure-"><code>subprojects {}</code></a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Project.html#allprojects-groovy.lang.Closure-"><code>allprojects {}</code></a> DSL constructs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Avoid using <code>subprojects {}</code> and <code>allprojects {}</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With cross-configuration, build logic can be injected into a subproject which is not obvious when looking at its build script.</p>
</div>
<div class="paragraph">
<p>In the long run, cross-configuration usually grows in complexity and becomes a burden.
Cross-configuration can also introduce configuration-time coupling between projects, which can prevent optimizations like configuration-on-demand from working properly.</p>
</div>
<div class="sect4">
<h5 id="convention_plugins_versus_cross_configuration"><a class="anchor" href="#convention_plugins_versus_cross_configuration"></a><a class="link" href="#convention_plugins_versus_cross_configuration">Convention plugins versus cross-configuration</a></h5>
<div class="paragraph">
<p>The two most common uses of cross-configuration can be better modeled using convention plugins:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Applying plugins or other configurations to subprojects of a certain type.<br>
Often, the cross-configuration logic is <code>if subproject is of type X, then configure Y</code>.
This is equivalent to applying <code>X-conventions</code> plugin directly to a subproject.</p>
</li>
<li>
<p>Extracting information from subprojects of a certain type.<br>
This use case can be modeled using <a href="#sec:simple-sharing-artifacts-between-projects">outgoing configuration variants</a>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="composite_builds"><a class="anchor" href="#composite_builds"></a><a class="link" href="#composite_builds">Composite Builds</a></h3>
<div class="paragraph">
<p>A composite build is a build that includes other builds.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/structuring-builds-4.png" alt="structuring builds 4">
</div>
</div>
<div id="composite_build_intro" class="paragraph">
<p>A composite build is similar to a Gradle multi-project build, except that instead of including <code>subprojects</code>, entire <code>builds</code> are included.</p>
</div>
<div class="paragraph">
<p>Composite builds allow you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Combine builds that are usually developed independently, for instance, when trying out a bug fix in a library that your application uses.</p>
</li>
<li>
<p>Decompose a large multi-project build into smaller, more isolated chunks that can be worked on independently or together as needed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A build that is included in a composite build is referred to as an <strong>included build</strong>.
Included builds do not share any configuration with the composite build or the other included builds.
Each included build is configured and executed in isolation.</p>
</div>
<div class="sect3">
<h4 id="defining_composite_builds"><a class="anchor" href="#defining_composite_builds"></a><a class="link" href="#defining_composite_builds">Defining a composite build</a></h4>
<div class="paragraph">
<p>The following example demonstrates how two Gradle builds, normally developed separately, can be combined into a composite build.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">my-composite
├── gradle
├── gradlew
├── settings.gradle.kts
├── build.gradle.kts
├── my-app
│   ├── settings.gradle.kts
│   └── app
│       ├── build.gradle.kts
│       └── src/main/java/org/sample/my-app/Main.java
└── my-utils
    ├── settings.gradle.kts
    ├── number-utils
    │   ├── build.gradle.kts
    │   └── src/main/java/org/sample/numberutils/Numbers.java
    └── string-utils
        ├── build.gradle.kts
        └── src/main/java/org/sample/stringutils/Strings.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>my-utils</code> multi-project build produces two Java libraries, <code>number-utils</code> and <code>string-utils</code>.
The <code>my-app</code> build produces an executable using functions from those libraries.</p>
</div>
<div class="paragraph">
<p>The <code>my-app</code> build does not depend directly on <code>my-utils</code>.
Instead, it declares binary dependencies on the libraries produced by <code>my-utils</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">my-app/app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;application&quot;)
}

application {
    mainClass = &quot;org.sample.myapp.Main&quot;
}

dependencies {
    implementation(&quot;org.sample:number-utils:1.0&quot;)
    implementation(&quot;org.sample:string-utils:1.0&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">my-app/app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">application</span><span class="delimiter">'</span></span>
}

application {
    mainClass = <span class="string"><span class="delimiter">'</span><span class="content">org.sample.myapp.Main</span><span class="delimiter">'</span></span>
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.sample:number-utils:1.0</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.sample:string-utils:1.0</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="command_line_composite"><a class="anchor" href="#command_line_composite"></a><a class="link" href="#command_line_composite">Defining a composite build via <code>--include-build</code></a></h5>
<div class="paragraph">
<p>The <code>--include-build</code> command-line argument turns the executed build into a composite, substituting dependencies from the included build into the executed build.</p>
</div>
<div class="paragraph">
<p>For example, the output of <code>./gradlew run --include-build ../my-utils</code> run from <code>my-app</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew --include-build ../my-utils run
link:https://docs.gradle.org/8.9/samples/build-organization/composite-builds/basic/tests/basicCli.out[role=include]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="settings_defined_composite"><a class="anchor" href="#settings_defined_composite"></a><a class="link" href="#settings_defined_composite">Defining a composite build via the settings file</a></h5>
<div class="paragraph">
<p>It&#8217;s possible to make the above arrangement persistent by using <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.initialization.Settings.html#org.gradle.api.initialization.Settings:includeBuild(java.lang.Object)">Settings.includeBuild(java.lang.Object)</a> to declare the included build in the <code>settings.gradle(.kts)</code> file.</p>
</div>
<div class="paragraph">
<p>The settings file can be used to add subprojects and included builds simultaneously.</p>
</div>
<div class="paragraph">
<p>Included builds are added by location:</p>
</div>
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">includeBuild(&quot;my-utils&quot;)</code></pre>
</div>
</div>
<div id="separate_composite" class="paragraph">
<p>In the example, the settings.gradle(.kts) file combines otherwise separate builds:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;my-composite&quot;

includeBuild(&quot;my-app&quot;)
includeBuild(&quot;my-utils&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">my-composite</span><span class="delimiter">'</span></span>

includeBuild <span class="string"><span class="delimiter">'</span><span class="content">my-app</span><span class="delimiter">'</span></span>
includeBuild <span class="string"><span class="delimiter">'</span><span class="content">my-utils</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To execute the <code>run</code> task in the <code>my-app</code> build from <code>my-composite</code>, run <code>./gradlew my-app:app:run</code>.</p>
</div>
<div class="paragraph">
<p>You can optionally define a <code>run</code> task in <code>my-composite</code> that depends on <code>my-app:app:run</code> so that you can execute <code>./gradlew run</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;run&quot;) {
    dependsOn(gradle.includedBuild(&quot;my-app&quot;).task(&quot;:app:run&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">run</span><span class="delimiter">'</span></span>) {
    dependsOn gradle.includedBuild(<span class="string"><span class="delimiter">'</span><span class="content">my-app</span><span class="delimiter">'</span></span>).task(<span class="string"><span class="delimiter">'</span><span class="content">:app:run</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="included_plugin_builds"><a class="anchor" href="#included_plugin_builds"></a><a class="link" href="#included_plugin_builds">Including builds that define Gradle plugins</a></h5>
<div class="paragraph">
<p>A special case of included builds are builds that define Gradle plugins.</p>
</div>
<div class="paragraph">
<p>These builds should be included using the <code>includeBuild</code> statement inside the <code>pluginManagement {}</code> block of the settings file.</p>
</div>
<div class="paragraph">
<p>Using this mechanism, the included build may also contribute a settings plugin that can be applied in the settings file itself:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    includeBuild(&quot;../url-verifier-plugin&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
    includeBuild <span class="string"><span class="delimiter">'</span><span class="content">../url-verifier-plugin</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="included_builds"><a class="anchor" href="#included_builds"></a><a class="link" href="#included_builds">Restrictions on included builds</a></h4>
<div class="paragraph">
<p>Most builds can be included in a composite, including other composite builds.
There are some restrictions.</p>
</div>
<div class="paragraph">
<p>In a regular build, Gradle ensures that each project has a unique <em>project path</em>.
It makes projects identifiable and addressable without conflicts.</p>
</div>
<div class="paragraph">
<p>In a composite build, Gradle adds additional qualification to each project from an included build to avoid project path conflicts.
The full path to identify a project in a composite build is called a <em>build-tree path</em>.
It consists of a <em>build path</em> of an included build and a <em>project path</em> of the project.</p>
</div>
<div class="paragraph">
<p>By default, build paths and project paths are derived from directory names and structure on disk.
Since included builds can be located anywhere on disk, their build path is determined by the name of the containing directory.
This can sometimes lead to conflicts.</p>
</div>
<div class="paragraph">
<p>To summarize, the included builds must fulfill these requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each included build must have a unique build path.</p>
</li>
<li>
<p>Each included build path must not conflict with any project path of the main build.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These conditions guarantee that each project can be uniquely identified even in a composite build.</p>
</div>
<div class="paragraph">
<p>If conflicts arise, the way to resolve them is by changing the <em>build name</em> of an included build:</p>
</div>
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">includeBuild(&quot;some-included-build&quot;) {
    name = &quot;other-name&quot;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When a composite build is included in another composite build, both builds have the same parent.
In other words, the nested composite build structure is flattened.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="interacting_with_composite_builds"><a class="anchor" href="#interacting_with_composite_builds"></a><a class="link" href="#interacting_with_composite_builds">Interacting with a composite build</a></h4>
<div class="paragraph">
<p>Interacting with a composite build is generally similar to a regular multi-project build.
Tasks can be executed, tests can be run, and builds can be imported into the IDE.</p>
</div>
<div class="sect4">
<h5 id="composite_build_executing_tasks"><a class="anchor" href="#composite_build_executing_tasks"></a><a class="link" href="#composite_build_executing_tasks">Executing tasks</a></h5>
<div class="paragraph">
<p>Tasks from an included build can be executed from the command-line or IDE in the same way as tasks from a regular multi-project build.
Executing a task will result in task dependencies being executed, as well as those tasks required to build dependency artifacts from other included builds.</p>
</div>
<div class="paragraph">
<p>You can call a task in an included build using a fully qualified path, for example, <code>:included-build-name:project-name:taskName</code>.
Project and task names can be <a href="#sec:name_abbreviation">abbreviated</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew :included-build:subproject-a:compileJava
&gt; Task :included-build:subproject-a:compileJava

$ ./gradlew :i-b:sA:cJ
&gt; Task :included-build:subproject-a:compileJava</pre>
</div>
</div>
<div class="paragraph">
<p>To <a href="#sec:excluding_tasks_from_the_command_line">exclude a task from the command line</a>, you need to provide the fully qualified path to the task.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Included build tasks are automatically executed to generate required dependency artifacts, or the <a href="#included_build_task_dependencies">including build can declare a dependency on a task from an included build</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="composite_build_ide_integration"><a class="anchor" href="#composite_build_ide_integration"></a><a class="link" href="#composite_build_ide_integration">Importing into the IDE</a></h5>
<div class="paragraph">
<p>One of the most useful features of composite builds is IDE integration.</p>
</div>
<div class="paragraph">
<p>Importing a composite build permits sources from separate Gradle builds to be easily developed together.
For every included build, each subproject is included as an IntelliJ IDEA Module or Eclipse Project.
Source dependencies are configured, providing cross-build navigation and refactoring.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="included_build_declaring_substitutions"><a class="anchor" href="#included_build_declaring_substitutions"></a><a class="link" href="#included_build_declaring_substitutions">Declaring dependencies substituted by an included build</a></h4>
<div class="paragraph">
<p>By default, Gradle will configure each included build to determine the dependencies it can provide.
The algorithm for doing this is simple.
Gradle will inspect the group and name for the projects in the included build and substitute project dependencies for any external dependency matching <code>${project.group}:${project.name}</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, substitutions are not registered for the <em>main</em> build.</p>
</div>
<div class="paragraph">
<p>To make the (sub)projects of the main build addressable by <code>${project.group}:${project.name}</code>, you can tell Gradle to treat the main build like an included build by self-including it: <code>includeBuild(".")</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are cases when the default substitutions determined by Gradle are insufficient or must be corrected for a particular composite.
For these cases, explicitly declaring the substitutions for an included build is possible.</p>
</div>
<div class="paragraph">
<p>For example, a single-project build called <code>anonymous-library</code>, produces a Java utility library but does not declare a value for the group attribute:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When this build is included in a composite, it will attempt to substitute for the dependency module <code>undefined:anonymous-library</code> (<code>undefined</code> being the default value for <code>project.group</code>, and <code>anonymous-library</code> being the root project name).
Clearly, this isn&#8217;t useful in a composite build.</p>
</div>
<div class="paragraph">
<p>To use the unpublished library in a composite build, you can explicitly declare the substitutions that it provides:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">includeBuild(&quot;anonymous-library&quot;) {
    dependencySubstitution {
        substitute(module(&quot;org.sample:number-utils&quot;)).using(project(&quot;:&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">includeBuild(<span class="string"><span class="delimiter">'</span><span class="content">anonymous-library</span><span class="delimiter">'</span></span>) {
    dependencySubstitution {
        substitute module(<span class="string"><span class="delimiter">'</span><span class="content">org.sample:number-utils</span><span class="delimiter">'</span></span>) using project(<span class="string"><span class="delimiter">'</span><span class="content">:</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With this configuration, the <code>my-app</code> composite build will substitute any dependency on <code>org.sample:number-utils</code> with a dependency on the root project of <code>anonymous-library</code>.</p>
</div>
<div class="sect4">
<h5 id="deactivate_included_build_substitutions"><a class="anchor" href="#deactivate_included_build_substitutions"></a><a class="link" href="#deactivate_included_build_substitutions">Deactivate included build substitutions for a configuration</a></h5>
<div class="paragraph">
<p>If you need to <a href="#sec:resolvable-consumable-configs">resolve</a> a published version of a module that is also available as part of an included build, you can deactivate the included build substitution rules on the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.ResolutionStrategy.html">ResolutionStrategy</a> of the Configuration that is resolved.
This is necessary because the rules are globally applied in the build, and Gradle does not consider published versions during resolution by default.</p>
</div>
<div class="paragraph">
<p>For example, we create a separate <code>publishedRuntimeClasspath</code> configuration that gets resolved to the published versions of modules that also exist in one of the local builds.
This is done by deactivating global dependency substitution rules:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.create(&quot;publishedRuntimeClasspath&quot;) {
    resolutionStrategy.useGlobalDependencySubstitutionRules = false

    extendsFrom(configurations.runtimeClasspath.get())
    isCanBeConsumed = false
    attributes.attribute(Usage.USAGE_ATTRIBUTE, objects.named(Usage.JAVA_RUNTIME))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.create(<span class="string"><span class="delimiter">'</span><span class="content">publishedRuntimeClasspath</span><span class="delimiter">'</span></span>) {
    resolutionStrategy.useGlobalDependencySubstitutionRules = <span class="predefined-constant">false</span>

    extendsFrom(configurations.runtimeClasspath)
    canBeConsumed = <span class="predefined-constant">false</span>
    attributes.attribute(Usage.USAGE_ATTRIBUTE, objects.named(Usage, Usage.JAVA_RUNTIME))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A use-case would be to compare published and locally built JAR files.</p>
</div>
</div>
<div class="sect4">
<h5 id="included_build_substitution_requirements"><a class="anchor" href="#included_build_substitution_requirements"></a><a class="link" href="#included_build_substitution_requirements">Cases where included build substitutions must be declared</a></h5>
<div class="paragraph">
<p>Many builds will function automatically as an included build, without declared substitutions.
Here are some common cases where declared substitutions are required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the <code>archivesBaseName</code> property is used to set the name of the published artifact.</p>
</li>
<li>
<p>When a configuration other than <code>default</code> is published.</p>
</li>
<li>
<p>When the <code>MavenPom.addFilter()</code> is used to publish artifacts that don&#8217;t match the project name.</p>
</li>
<li>
<p>When the <code>maven-publish</code> or <code>ivy-publish</code> plugins are used for publishing and the publication coordinates don&#8217;t match <code>${project.group}:${project.name}</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="included_build_substitution_limitations"><a class="anchor" href="#included_build_substitution_limitations"></a><a class="link" href="#included_build_substitution_limitations">Cases where composite build substitutions won&#8217;t work</a></h5>
<div class="paragraph">
<p>Some builds won&#8217;t function correctly when included in a composite, even when dependency substitutions are explicitly declared.
This limitation is because a substituted project dependency will always point to the <code>default</code> configuration of the target project.
Any time the artifacts and dependencies specified for the default configuration of a project don&#8217;t match what is published to a repository, the composite build may exhibit different behavior.</p>
</div>
<div class="paragraph">
<p>Here are some cases where the published module metadata may be different from the project default configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a configuration other than <code>default</code> is published.</p>
</li>
<li>
<p>When the <code>maven-publish</code> or <code>ivy-publish</code> plugins are used.</p>
</li>
<li>
<p>When the <code>POM</code> or <code>ivy.xml</code> file is tweaked as part of publication.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Builds using these features function incorrectly when included in a composite build.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="included_build_task_dependencies"><a class="anchor" href="#included_build_task_dependencies"></a><a class="link" href="#included_build_task_dependencies">Depending on tasks in an included build</a></h4>
<div class="paragraph">
<p>While included builds are isolated from one another and cannot declare direct dependencies, a composite build can declare task dependencies on its included builds.
The included builds are accessed using <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.invocation.Gradle.html#org.gradle.api.invocation.Gradle:includedBuilds">Gradle.getIncludedBuilds()</a> or <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.invocation.Gradle.html#org.gradle.api.invocation.Gradle:includedBuild(java.lang.String)">Gradle.includedBuild(java.lang.String)</a>, and a task reference is obtained via the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.initialization.IncludedBuild.html#org.gradle.api.initialization.IncludedBuild:task(java.lang.String)">IncludedBuild.task(java.lang.String)</a> method.</p>
</div>
<div class="paragraph">
<p>Using these APIs, it is possible to declare a dependency on a task in a particular included build:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;run&quot;) {
    dependsOn(gradle.includedBuild(&quot;my-app&quot;).task(&quot;:app:run&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">run</span><span class="delimiter">'</span></span>) {
    dependsOn gradle.includedBuild(<span class="string"><span class="delimiter">'</span><span class="content">my-app</span><span class="delimiter">'</span></span>).task(<span class="string"><span class="delimiter">'</span><span class="content">:app:run</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Or you can declare a dependency on tasks with a certain path in some or all of the included builds:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;publishDeps&quot;) {
    dependsOn(gradle.includedBuilds.map { it.task(&quot;:publishMavenPublicationToMavenRepository&quot;) })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">publishDeps</span><span class="delimiter">'</span></span>) {
    dependsOn gradle.includedBuilds*.task(<span class="string"><span class="delimiter">'</span><span class="content">:publishMavenPublicationToMavenRepository</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="current_limitations_and_future_work"><a class="anchor" href="#current_limitations_and_future_work"></a><a class="link" href="#current_limitations_and_future_work">Limitations of composite builds</a></h4>
<div class="paragraph">
<p>Limitations of the current implementation include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No support for included builds with publications that don&#8217;t mirror the project default configuration.<br>
See <a href="#included_build_substitution_limitations">Cases where composite builds won&#8217;t work</a>.</p>
</li>
<li>
<p>Multiple composite builds may conflict when run in parallel if more than one includes the same build.<br>
Gradle does not share the project lock of a shared composite build between Gradle invocations to prevent concurrent execution.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration_and_execution"><a class="anchor" href="#configuration_and_execution"></a><a class="link" href="#configuration_and_execution">Configuration On Demand</a></h3>
<div class="paragraph">
<p>Configuration-on-demand attempts to configure only the relevant projects for the requested tasks, i.e., it only evaluates the build script file of projects participating in the build.
This way, the configuration time of a large multi-project build can be reduced.</p>
</div>
<div class="paragraph">
<p>The configuration-on-demand feature is <em>incubating</em>, so only some builds are guaranteed to work correctly.
The feature works well for <a href="#sec:decoupled_projects">decoupled</a> multi-project builds.</p>
</div>
<div class="paragraph">
<p>In configuration-on-demand mode, projects are configured as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The root project is always configured.</p>
</li>
<li>
<p>The project in the directory where the build is executed is also configured, but only when Gradle is executed without any tasks.<br>
This way, the default tasks behave correctly when projects are configured on demand.</p>
</li>
<li>
<p>The standard project dependencies are supported, and relevant projects are configured.<br>
If project A has a compile dependency on project B, then building A causes the configuration of both projects.</p>
</li>
<li>
<p>The task dependencies declared via the task path are supported and cause relevant projects to be configured.<br>
Example: <code>someTask.dependsOn(":some-other-project:someOtherTask")</code></p>
</li>
<li>
<p>A task requested via task path from the command line (or tooling API) causes the relevant project to be configured.<br>
For example, building <code>project-a:project-b:someTask</code> causes configuration of <code>project-b</code>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="sec:configuration_on_demand"><a class="anchor" href="#sec:configuration_on_demand"></a><a class="link" href="#sec:configuration_on_demand">Enable <code>configuration-on-demand</code></a></h4>
<div class="paragraph">
<p>You can enable configuration-on-demand using the <code>--configure-on-demand</code> flag or adding <code>org.gradle.configureondemand=true</code> to the <code>gradle.properties</code> file.</p>
</div>
<div class="paragraph">
<p>To configure on demand with every build run, see <a href="#sec:gradle_configuration_properties">Gradle properties</a>.</p>
</div>
<div class="paragraph">
<p>To configure on demand for a given build, see <a href="#sec:command_line_performance">command-line performance-oriented options</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:decoupled_projects"><a class="anchor" href="#sec:decoupled_projects"></a><a class="link" href="#sec:decoupled_projects">Decoupled projects</a></h4>
<div class="paragraph">
<p>Gradle allows projects to access each other&#8217;s configurations and tasks during the configuration and execution phases.
While this flexibility empowers build authors, it limits Gradle&#8217;s ability to perform optimizations such as <a href="#sec:parallel_execution">parallel project builds</a> and <a href="#configuration_and_execution">configuration on demand</a>.</p>
</div>
<div class="paragraph">
<p>Projects are considered decoupled when they interact solely through declared dependencies and task dependencies.
Any direct modification or reading of another project&#8217;s object creates coupling between the projects.
Coupling during configuration can result in flawed build outcomes when using 'configuration on demand', while coupling during execution can affect parallel execution.</p>
</div>
<div class="paragraph">
<p>One common source of coupling is configuration injection, such as using <code>allprojects{}</code> or <code>subprojects{}</code> in build scripts.</p>
</div>
<div class="paragraph">
<p>To avoid coupling issues, it&#8217;s recommended to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Refrain from referencing other subprojects' build scripts and prefer cross-configuration from the root project.</p>
</li>
<li>
<p>Avoid dynamically changing other projects' configurations during execution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As Gradle evolves, it aims to provide features that leverage decoupled projects while offering solutions for common use cases like configuration injection without introducing coupling.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:parallel_execution"><a class="anchor" href="#sec:parallel_execution"></a><a class="link" href="#sec:parallel_execution">Parallel projects</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s parallel execution feature optimizes CPU utilization to accelerate builds by concurrently executing tasks from different projects.</p>
</div>
<div class="paragraph">
<p>To enable parallel execution, use the <code>--parallel</code> <a href="#sec:command_line_performance">command-line argument</a> or configure your <a href="#sec:gradle_configuration_properties">build environment</a>.
Gradle automatically determines the optimal number of parallel threads based on CPU cores.</p>
</div>
<div class="paragraph">
<p>During parallel execution, each worker handles a specific project exclusively.
Task dependencies are respected, with workers prioritizing upstream tasks.
However, tasks may not execute in alphabetical order, as in sequential mode.
It&#8217;s crucial to correctly declare task dependencies and inputs/outputs to avoid ordering issues.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developing_tasks"><a class="anchor" href="#developing_tasks"></a><a class="link" href="#developing_tasks">DEVELOPING TASKS</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="more_about_tasks"><a class="anchor" href="#more_about_tasks"></a><a class="link" href="#more_about_tasks">Understanding Tasks</a></h3>
<div class="paragraph">
<p>A task represents some <strong>independent unit of work</strong> that a build performs, such as compiling classes, creating a JAR, generating Javadoc, or publishing archives to a repository.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/writing-tasks-1.png" alt="writing tasks 1">
</div>
</div>
<div class="paragraph">
<p>Before reading this chapter, it&#8217;s recommended that you first read the <a href="#gradle_directories">Learning The Basics</a> and complete the <a href="partr1_gradle_init.html#partr1_gradle_init">Tutorial</a>.</p>
</div>
<div class="sect3">
<h4 id="sec:more_listing_tasks"><a class="anchor" href="#sec:more_listing_tasks"></a><a class="link" href="#sec:more_listing_tasks">Listing tasks</a></h4>
<div class="paragraph">
<p>All available tasks in your project come from Gradle plugins and build scripts.</p>
</div>
<div class="paragraph">
<p>You can list all the available tasks in a project by running the following command in the terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew tasks</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s take a very basic Gradle project as an example.
The project has the following structure:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">gradle-project
├── app
│   ├── build.gradle.kts    // empty file - no build logic
│   └── ...                 // some java code
├── settings.gradle.kts     // includes app subproject
├── gradle
│   └── ...
├── gradlew
└── gradlew.bat</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gradle-project
<span class="error">├</span><span class="error">─</span><span class="error">─</span> app
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> build.gradle    <span class="comment">// empty file - no build logic</span>
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> ...             <span class="comment">// some java code</span>
<span class="error">├</span><span class="error">─</span><span class="error">─</span> settings.gradle     <span class="comment">// includes app subproject</span>
<span class="error">├</span><span class="error">─</span><span class="error">─</span> gradle
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> ...
<span class="error">├</span><span class="error">─</span><span class="error">─</span> gradlew
<span class="error">└</span><span class="error">─</span><span class="error">─</span> gradlew.bat</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The settings file contains the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;gradle-project&quot;
include(&quot;app&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">gradle-project</span><span class="delimiter">'</span></span>
include(<span class="string"><span class="delimiter">'</span><span class="content">app</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Currently, the <code>app</code> subproject&#8217;s build file is empty.</p>
</div>
<div class="paragraph">
<p>To see the tasks available in the <code>app</code> subproject, run <code>./gradlew :app:tasks</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew :app:tasks

&gt; Task :app:tasks

------------------------------------------------------------
Tasks runnable from project ':app'
------------------------------------------------------------

Help tasks
----------
buildEnvironment - Displays all buildscript dependencies declared in project ':app'.
dependencies - Displays all dependencies declared in project ':app'.
dependencyInsight - Displays the insight into a specific dependency in project ':app'.
help - Displays a help message.
javaToolchains - Displays the detected java toolchains.
kotlinDslAccessorsReport - Prints the Kotlin code for accessing the currently available project extensions and conventions.
outgoingVariants - Displays the outgoing variants of project ':app'.
projects - Displays the sub-projects of project ':app'.
properties - Displays the properties of project ':app'.
resolvableConfigurations - Displays the configurations that can be resolved in project ':app'.
tasks - Displays the tasks runnable from project ':app'.</code></pre>
</div>
</div>
<div class="paragraph">
<p>We observe that only a small number of help tasks are available at the moment.
This is because the core of Gradle only provides tasks that analyze your build.
Other tasks, such as the those that build your project or compile your code, are added by plugins.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s explore this by adding the <a href="base_plugin.html#base_plugin">Gradle core <code>base</code> plugin</a> to the <code>app</code> build script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;base&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id(<span class="string"><span class="delimiter">'</span><span class="content">base</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>base</code> plugin adds central lifecycle tasks.
Now when we run <code>./gradlew app:tasks</code>, we can see the <code>assemble</code> and <code>build</code> tasks are available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew :app:tasks

&gt; Task :app:tasks

------------------------------------------------------------
Tasks runnable from project ':app'
------------------------------------------------------------

Build tasks
-----------
assemble - Assembles the outputs of this project.
build - Assembles and tests this project.
clean - Deletes the build directory.

Help tasks
----------
buildEnvironment - Displays all buildscript dependencies declared in project ':app'.
dependencies - Displays all dependencies declared in project ':app'.
dependencyInsight - Displays the insight into a specific dependency in project ':app'.
help - Displays a help message.
javaToolchains - Displays the detected java toolchains.
outgoingVariants - Displays the outgoing variants of project ':app'.
projects - Displays the sub-projects of project ':app'.
properties - Displays the properties of project ':app'.
resolvableConfigurations - Displays the configurations that can be resolved in project ':app'.
tasks - Displays the tasks runnable from project ':app'.

Verification tasks
------------------
check - Runs all checks.</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_outcomes"><a class="anchor" href="#sec:task_outcomes"></a><a class="link" href="#sec:task_outcomes">Task outcomes</a></h4>
<div class="paragraph">
<p>When Gradle executes a task, it labels the task with outcomes via the console.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/author-tasks-1.png" alt="author tasks 1">
</div>
</div>
<div class="paragraph">
<p>These labels are based on whether a task has actions to execute and if Gradle executed them.
Actions include, but are not limited to, compiling code, zipping files, and publishing archives.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>(no label)</code> or <code>EXECUTED</code></dt>
<dd>
<p><strong>Task executed its actions.</strong></p>
<div class="ulist">
<ul>
<li>
<p>Task has actions and Gradle executed them.</p>
</li>
<li>
<p>Task has no actions and some dependencies, and Gradle executed one or more of the dependencies. See also <a href="organizing_tasks.html#sec:lifecycle_tasks">Lifecycle Tasks</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>UP-TO-DATE</code></dt>
<dd>
<p><strong>Task&#8217;s outputs did not change.</strong></p>
<div class="ulist">
<ul>
<li>
<p>Task has outputs and inputs but they have not changed. See <a href="#incremental_build">Incremental Build</a>.</p>
</li>
<li>
<p>Task has actions, but the task tells Gradle it did not change its outputs.</p>
</li>
<li>
<p>Task has no actions and some dependencies, but all the dependencies are <code>UP-TO-DATE</code>, <code>SKIPPED</code> or <code>FROM-CACHE</code>. See <a href="organizing_tasks.html#sec:lifecycle_tasks">Lifecycle Tasks</a>.</p>
</li>
<li>
<p>Task has no actions and no dependencies.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>FROM-CACHE</code></dt>
<dd>
<p><strong>Task&#8217;s outputs could be found from a previous execution.</strong></p>
<div class="ulist">
<ul>
<li>
<p>Task has outputs restored from the build cache. See <a href="#build_cache">Build Cache</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>SKIPPED</code></dt>
<dd>
<p><strong>Task did not execute its actions.</strong></p>
<div class="ulist">
<ul>
<li>
<p>Task has been explicitly excluded from the command-line. See <a href="#sec:excluding_tasks_from_the_command_line">Excluding tasks from execution</a>.</p>
</li>
<li>
<p>Task has an <code>onlyIf</code> predicate return false. See <a href="controlling_task_execution.html#sec:using_a_predicate">Using a predicate</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>NO-SOURCE</code></dt>
<dd>
<p><strong>Task did not need to execute its actions.</strong></p>
<div class="ulist">
<ul>
<li>
<p>Task has inputs and outputs, but <a href="#skip-when-empty">no sources</a> (i.e., inputs were not found).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_groups"><a class="anchor" href="#sec:task_groups"></a><a class="link" href="#sec:task_groups">Task group and description</a></h4>
<div class="paragraph">
<p>Task groups and descriptions are used to organize and describe tasks.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Groups </dt>
<dd>
<p>Task groups are used to categorize tasks. When you run <code>./gradlew tasks</code>, tasks are listed under their respective groups, making it easier to understand their purpose and relationship to other tasks. Groups are set using the <code>group</code> property.</p>
</dd>
<dt class="hdlist1">Descriptions </dt>
<dd>
<p>Descriptions provide a brief explanation of what a task does. When you run <code>./gradlew tasks</code>, the descriptions are shown next to each task, helping you understand its purpose and how to use it. Descriptions are set using the <code>description</code> property.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Let&#8217;s consider a basic Java application as an example.
The build contains a subproject called <code>app</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s list the available tasks in <code>app</code> at the moment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew :app:tasks

&gt; Task :app:tasks

------------------------------------------------------------
Tasks runnable from project ':app'
------------------------------------------------------------

Application tasks
-----------------
run - Runs this project as a JVM application.

Build tasks
-----------
assemble - Assembles the outputs of this project.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the <code>:run</code> task is part of the <code>Application</code> group with the description <code>Runs this project as a JVM application</code>.
In code, it would look something like this:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;run&quot;) {
    group = &quot;Application&quot;
    description = &quot;Runs this project as a JVM application.&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">run</span><span class="delimiter">&quot;</span></span>) {
    group = <span class="string"><span class="delimiter">&quot;</span><span class="content">Application</span><span class="delimiter">&quot;</span></span>
    description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Runs this project as a JVM application.</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:hidden_tasks"><a class="anchor" href="#sec:hidden_tasks"></a><a class="link" href="#sec:hidden_tasks">Private and hidden tasks</a></h4>
<div class="paragraph">
<p>Gradle doesn&#8217;t support marking a task as <em>private</em>.</p>
</div>
<div class="paragraph">
<p>However, tasks will only show up when running <code>:tasks</code> if <code>task.group</code> is set or no other task depends on it.</p>
</div>
<div class="paragraph">
<p>For instance, the following task will not appear when running <code>./gradlew :app:tasks</code> because it does not have a group; it is called a <em>hidden</em> task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;helloTask&quot;) {
    println(&quot;Hello&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloTask</span><span class="delimiter">&quot;</span></span>) {
    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Although <code>helloTask</code> is not listed, it can still be executed by Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew :app:tasks

&gt; Task :app:tasks

------------------------------------------------------------
Tasks runnable from project ':app'
------------------------------------------------------------

Application tasks
-----------------
run - Runs this project as a JVM application

Build tasks
-----------
assemble - Assembles the outputs of this project.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s add a group to the same task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;helloTask&quot;) {
    group = &quot;Other&quot;
    description = &quot;Hello task&quot;
    println(&quot;Hello&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloTask</span><span class="delimiter">&quot;</span></span>) {
    group = <span class="string"><span class="delimiter">&quot;</span><span class="content">Other</span><span class="delimiter">&quot;</span></span>
    description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello task</span><span class="delimiter">&quot;</span></span>
    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now that the group is added, the task is visible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew :app:tasks

&gt; Task :app:tasks

------------------------------------------------------------
Tasks runnable from project ':app'
------------------------------------------------------------

Application tasks
-----------------
run - Runs this project as a JVM application

Build tasks
-----------
assemble - Assembles the outputs of this project.

Other tasks
-----------
helloTask - Hello task</code></pre>
</div>
</div>
<div class="paragraph">
<p>In contrast, <code>./gradlew tasks --all</code> will show all tasks; <em>hidden</em> and <em>visible</em> tasks are listed.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:grouping_tasks"><a class="anchor" href="#sec:grouping_tasks"></a><a class="link" href="#sec:grouping_tasks">Grouping tasks</a></h4>
<div class="paragraph">
<p>If you want to customize which tasks are shown to users when listed, you can group tasks and set the visibility of each group.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Remember, even if you <em>hide</em> tasks, they are still available, and Gradle can still run them.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s start with an example built by Gradle <code>init</code> for a Java application with multiple subprojects.
The project structure is as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">gradle-project
├── app
│   ├── build.gradle.kts
│   └── src                 // some java code
│       └── ...
├── utilities
│   ├── build.gradle.kts
│   └── src                 // some java code
│       └── ...
├── list
│   ├── build.gradle.kts
│   └── src                 // some java code
│       └── ...
├── buildSrc
│   ├── build.gradle.kts
│   ├── settings.gradle.kts
│   └── src                 // common build logic
│       └── ...
├── settings.gradle.kts
├── gradle
├── gradlew
└── gradlew.bat</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gradle-project
<span class="error">├</span><span class="error">─</span><span class="error">─</span> app
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> src             <span class="comment">// some java code</span>
<span class="error">│</span>       <span class="error">└</span><span class="error">─</span><span class="error">─</span> ...
<span class="error">├</span><span class="error">─</span><span class="error">─</span> utilities
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> src             <span class="comment">// some java code</span>
<span class="error">│</span>       <span class="error">└</span><span class="error">─</span><span class="error">─</span> ...
<span class="error">├</span><span class="error">─</span><span class="error">─</span> list
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> src             <span class="comment">// some java code</span>
<span class="error">│</span>       <span class="error">└</span><span class="error">─</span><span class="error">─</span> ...
<span class="error">├</span><span class="error">─</span><span class="error">─</span> buildSrc
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">│</span>   <span class="error">├</span><span class="error">─</span><span class="error">─</span> settings.gradle
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> src             <span class="comment">// common build logic</span>
<span class="error">│</span>       <span class="error">└</span><span class="error">─</span><span class="error">─</span> ...
<span class="error">├</span><span class="error">─</span><span class="error">─</span> settings.gradle
<span class="error">├</span><span class="error">─</span><span class="error">─</span> gradle
<span class="error">├</span><span class="error">─</span><span class="error">─</span> gradlew
<span class="error">└</span><span class="error">─</span><span class="error">─</span> gradlew.bat</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Run <code>app:tasks</code> to see available tasks in the <code>app</code> subproject:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew :app:tasks

&gt; Task :app:tasks

------------------------------------------------------------
Tasks runnable from project ':app'
------------------------------------------------------------

Application tasks
-----------------
run - Runs this project as a JVM application

Build tasks
-----------
assemble - Assembles the outputs of this project.
build - Assembles and tests this project.
buildDependents - Assembles and tests this project and all projects that depend on it.
buildNeeded - Assembles and tests this project and all projects it depends on.
classes - Assembles main classes.
clean - Deletes the build directory.
jar - Assembles a jar archive containing the classes of the 'main' feature.
testClasses - Assembles test classes.

Distribution tasks
------------------
assembleDist - Assembles the main distributions
distTar - Bundles the project as a distribution.
distZip - Bundles the project as a distribution.
installDist - Installs the project as a distribution as-is.

Documentation tasks
-------------------
javadoc - Generates Javadoc API documentation for the 'main' feature.

Help tasks
----------
buildEnvironment - Displays all buildscript dependencies declared in project ':app'.
dependencies - Displays all dependencies declared in project ':app'.
dependencyInsight - Displays the insight into a specific dependency in project ':app'.
help - Displays a help message.
javaToolchains - Displays the detected java toolchains.
kotlinDslAccessorsReport - Prints the Kotlin code for accessing the currently available project extensions and conventions.
outgoingVariants - Displays the outgoing variants of project ':app'.
projects - Displays the sub-projects of project ':app'.
properties - Displays the properties of project ':app'.
resolvableConfigurations - Displays the configurations that can be resolved in project ':app'.
tasks - Displays the tasks runnable from project ':app'.

Verification tasks
------------------
check - Runs all checks.
test - Runs the test suite.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we look at the list of tasks available, even for a standard Java project, it&#8217;s extensive.
Many of these tasks are rarely required directly by developers using the build.</p>
</div>
<div class="paragraph">
<p>We can configure the <code>:tasks</code> task and limit the tasks shown to a certain group.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create our own group so that all tasks are hidden by default by updating the <code>app</code> build script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val myBuildGroup = &quot;my app build&quot;               // Create a group name

tasks.register&lt;TaskReportTask&gt;(&quot;tasksAll&quot;) {    // Register the tasksAll task
    group = myBuildGroup
    description = &quot;Show additional tasks.&quot;
    setShowDetail(true)
}

tasks.named&lt;TaskReportTask&gt;(&quot;tasks&quot;) {          // Move all existing tasks to the group
    displayGroup = myBuildGroup
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> myBuildGroup = <span class="string"><span class="delimiter">&quot;</span><span class="content">my app build</span><span class="delimiter">&quot;</span></span>               <span class="comment">// Create a group name</span>

tasks.register(TaskReportTask, <span class="string"><span class="delimiter">&quot;</span><span class="content">tasksAll</span><span class="delimiter">&quot;</span></span>) {    <span class="comment">// Register the tasksAll task</span>
    group = myBuildGroup
    description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Show additional tasks.</span><span class="delimiter">&quot;</span></span>
    setShowDetail(<span class="predefined-constant">true</span>)
}

tasks.named(TaskReportTask, <span class="string"><span class="delimiter">&quot;</span><span class="content">tasks</span><span class="delimiter">&quot;</span></span>) {          <span class="comment">// Move all existing tasks to the group</span>
    displayGroup = myBuildGroup
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when we list tasks available in <code>app</code>, the list is shorter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew :app:tasks

&gt; Task :app:tasks

------------------------------------------------------------
Tasks runnable from project ':app'
------------------------------------------------------------

My app build tasks
------------------
tasksAll - Show additional tasks.</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_categories"><a class="anchor" href="#sec:task_categories"></a><a class="link" href="#sec:task_categories">Task categories</a></h4>
<div class="paragraph">
<p>Gradle distinguishes between two categories of tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Lifecycle tasks</strong></p>
</li>
<li>
<p><strong>Actionable tasks</strong></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Lifecycle tasks</strong> define targets you can call, such as <code>:build</code> your project.
Lifecycle tasks do not provide Gradle with actions.
They must be <em>wired</em> to actionable tasks.
The <a href="base_plugin.html#base_plugin"><code>base</code> Gradle plugin</a> only adds lifecycle tasks.</p>
</div>
<div class="paragraph">
<p><strong>Actionable tasks</strong> define actions for Gradle to take, such as <code>:compileJava</code>, which compiles the Java code of your project.
Actions include creating JARs, zipping files, publishing archives, and much more.
Plugins like the <a href="#java_library_plugin"><code>java-library</code> plugin</a> adds actionable tasks.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s update the build script of the previous example, which is currently an empty file so that our <code>app</code> subproject is a Java library:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;java-library&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id(<span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once again, we list the available tasks to see what new tasks are available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew :app:tasks

&gt; Task :app:tasks

------------------------------------------------------------
Tasks runnable from project ':app'
------------------------------------------------------------

Build tasks
-----------
assemble - Assembles the outputs of this project.
build - Assembles and tests this project.
buildDependents - Assembles and tests this project and all projects that depend on it.
buildNeeded - Assembles and tests this project and all projects it depends on.
classes - Assembles main classes.
clean - Deletes the build directory.
jar - Assembles a jar archive containing the classes of the 'main' feature.
testClasses - Assembles test classes.

Documentation tasks
-------------------
javadoc - Generates Javadoc API documentation for the 'main' feature.

Help tasks
----------
buildEnvironment - Displays all buildscript dependencies declared in project ':app'.
dependencies - Displays all dependencies declared in project ':app'.
dependencyInsight - Displays the insight into a specific dependency in project ':app'.
help - Displays a help message.
javaToolchains - Displays the detected java toolchains.
outgoingVariants - Displays the outgoing variants of project ':app'.
projects - Displays the sub-projects of project ':app'.
properties - Displays the properties of project ':app'.
resolvableConfigurations - Displays the configurations that can be resolved in project ':app'.
tasks - Displays the tasks runnable from project ':app'.

Verification tasks
------------------
check - Runs all checks.
test - Runs the test suite.</code></pre>
</div>
</div>
<div class="paragraph">
<p>We see that many new tasks are available such as <code>jar</code> and <code>testClasses</code>.</p>
</div>
<div class="paragraph">
<p>Additionally, the <code>java-library</code> plugin has wired actionable tasks to lifecycle tasks.
If we call the <code>:build</code> task, we can see several tasks have been executed, including the <code>:app:compileJava</code> task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$./gradlew :app:build

&gt; Task :app:compileJava
&gt; Task :app:processResources NO-SOURCE
&gt; Task :app:classes
&gt; Task :app:jar
&gt; Task :app:assemble
&gt; Task :app:compileTestJava
&gt; Task :app:processTestResources NO-SOURCE
&gt; Task :app:testClasses
&gt; Task :app:test
&gt; Task :app:check
&gt; Task :app:build</code></pre>
</div>
</div>
<div class="paragraph">
<p>The actionable <code>:compileJava</code> task is wired to the lifecycle <code>:build</code> task.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:incremental_tasks"><a class="anchor" href="#sec:incremental_tasks"></a><a class="link" href="#sec:incremental_tasks">Incremental tasks</a></h4>
<div class="paragraph">
<p>A key feature of Gradle tasks is their incremental nature.</p>
</div>
<div class="paragraph">
<p>Gradle can reuse results from prior builds.
Therefore, if we&#8217;ve built our project before and made only minor changes, rerunning <code>:build</code> will not require Gradle to perform extensive work.</p>
</div>
<div class="paragraph">
<p>For example, if we modify only the test code in our project, leaving the production code unchanged, executing the build will solely recompile the test code.
Gradle marks the tasks for the production code as <code>UP-TO-DATE</code>, indicating that it remains unchanged since the last successful build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$./gradlew :app:build

lkassovic@MacBook-Pro temp1 % ./gradlew :app:build
&gt; Task :app:compileJava UP-TO-DATE
&gt; Task :app:processResources NO-SOURCE
&gt; Task :app:classes UP-TO-DATE
&gt; Task :app:jar UP-TO-DATE
&gt; Task :app:assemble UP-TO-DATE
&gt; Task :app:compileTestJava
&gt; Task :app:processTestResources NO-SOURCE
&gt; Task :app:testClasses
&gt; Task :app:test
&gt; Task :app:check UP-TO-DATE
&gt; Task :app:build UP-TO-DATE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:caching_tasks"><a class="anchor" href="#sec:caching_tasks"></a><a class="link" href="#sec:caching_tasks">Caching tasks</a></h4>
<div class="paragraph">
<p>Gradle can reuse results from past builds using the build cache.</p>
</div>
<div class="paragraph">
<p>To enable this feature, activate the build cache by using the <code>--build-cache</code> <a href="#command_line_interface">command line</a> parameter or by setting <code>org.gradle.caching=true</code> in your <a href="#sec:gradle_configuration_properties"><code>gradle.properties</code></a> file.</p>
</div>
<div class="paragraph">
<p>This optimization has the potential to accelerate your builds significantly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$./gradlew :app:clean :app:build --build-cache

&gt; Task :app:compileJava FROM-CACHE
&gt; Task :app:processResources NO-SOURCE
&gt; Task :app:classes UP-TO-DATE
&gt; Task :app:jar
&gt; Task :app:assemble
&gt; Task :app:compileTestJava FROM-CACHE
&gt; Task :app:processTestResources NO-SOURCE
&gt; Task :app:testClasses UP-TO-DATE
&gt; Task :app:test FROM-CACHE
&gt; Task :app:check UP-TO-DATE
&gt; Task :app:build</code></pre>
</div>
</div>
<div class="paragraph">
<p>When Gradle can fetch outputs of a task from the cache, it labels the task with <code>FROM-CACHE</code>.</p>
</div>
<div class="paragraph">
<p>The build cache is handy if you switch between branches regularly.
Gradle supports both local and remote build caches.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:developing_tasks"><a class="anchor" href="#sec:developing_tasks"></a><a class="link" href="#sec:developing_tasks">Developing tasks</a></h4>
<div class="paragraph">
<p>When developing Gradle tasks, you have two choices:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use an existing Gradle task type such as <code>Zip</code>, <code>Copy</code>, or <code>Delete</code></p>
</li>
<li>
<p>Create your own Gradle task type such as <code>MyResolveTask</code> or <code>CustomTaskUsingToolchains</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Task types are simply subclasses of the Gradle <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Task.html"><code>Task</code></a> class.</p>
</div>
<div class="paragraph">
<p>With Gradle tasks, there are three states to consider:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Registering</strong> a task - using a task (implemented by you or provided by Gradle) in your build logic.</p>
</li>
<li>
<p><strong>Configuring</strong> a task - defining inputs and outputs for a registered task.</p>
</li>
<li>
<p><strong>Implementing</strong> a task - creating a custom task class (i.e., custom class type).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Registration</strong> is commonly done with the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskContainer.html#register-java.lang.String-java.lang.Class-"><code>register()</code></a> method.<br>
<strong>Configuring</strong> a task is commonly done with the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskCollection.html#named-java.lang.String-java.lang.Class-"><code>named()</code></a> method.<br>
<strong>Implementing</strong> a task is commonly done by extending Gradle&#8217;s <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/DefaultTask.html"><code>DefaultTask</code></a> class:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;myCopy&quot;)                              // <b class="conum">(1)</b>

tasks.named&lt;Copy&gt;(&quot;myCopy&quot;) {                               // <b class="conum">(2)</b>
    from(&quot;resources&quot;)
    into(&quot;target&quot;)
    include(&quot;**/*.txt&quot;, &quot;**/*.xml&quot;, &quot;**/*.properties&quot;)
}

abstract class MyCopyTask : DefaultTask() {                 // <b class="conum">(3)</b>
    @TaskAction
    fun copyFiles() {
        val sourceDir = File(&quot;sourceDir&quot;)
        val destinationDir = File(&quot;destinationDir&quot;)
        sourceDir.listFiles()?.forEach { file -&gt;
            if (file.isFile &amp;&amp; file.extension == &quot;txt&quot;) {
                file.copyTo(File(destinationDir, file.name))
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Register the <code>myCopy</code> task of type <code>Copy</code> to let Gradle know we intend to use it in our build logic.</p>
</li>
<li>
<p>Configure the registered <code>myCopy</code> task with the inputs and outputs it needs according to its <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Copy.html">API</a>.</p>
</li>
<li>
<p>Implement a custom task type called <code>MyCopyTask</code> which extends <code>DefaultTask</code> and defines the <code>copyFiles</code> task action.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(Copy, <span class="string"><span class="delimiter">&quot;</span><span class="content">myCopy</span><span class="delimiter">&quot;</span></span>)                              // <b class="conum">(1)</b>

tasks.named(Copy, <span class="string"><span class="delimiter">&quot;</span><span class="content">myCopy</span><span class="delimiter">&quot;</span></span>) {                               // <b class="conum">(2)</b>
    from <span class="string"><span class="delimiter">&quot;</span><span class="content">resources</span><span class="delimiter">&quot;</span></span>
    into <span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span>
    include <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.txt</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.properties</span><span class="delimiter">&quot;</span></span>
}

<span class="directive">abstract</span> <span class="type">class</span> <span class="class">MyCopyTask</span> <span class="directive">extends</span> DefaultTask {             // <b class="conum">(3)</b>
    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> copyFiles() {
        fileTree(<span class="string"><span class="delimiter">'</span><span class="content">sourceDir</span><span class="delimiter">'</span></span>).matching {
            include <span class="string"><span class="delimiter">'</span><span class="content">**/*.txt</span><span class="delimiter">'</span></span>
        }.forEach { file -&gt;
            file.copyTo(file.path.replace(<span class="string"><span class="delimiter">'</span><span class="content">sourceDir</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">destinationDir</span><span class="delimiter">'</span></span>))
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Register the <code>myCopy</code> task of type <code>Copy</code> to let Gradle know we intend to use it in our build logic.</p>
</li>
<li>
<p>Configure the registered <code>myCopy</code> task with the inputs and outputs it needs according to its <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Copy.html">API</a>.</p>
</li>
<li>
<p>Implement a custom task type called <code>MyCopyTask</code> which extends <code>DefaultTask</code> and defines the <code>copyFiles</code> task action.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:defining_tasks"><a class="anchor" href="#sec:defining_tasks"></a><a class="link" href="#sec:defining_tasks">1. Registering tasks</a></h5>
<div class="paragraph">
<p>You define actions for Gradle to take by registering tasks in build scripts or plugins.</p>
</div>
<div class="paragraph">
<p>Tasks are defined using strings for task names:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    doLast {
        println(&quot;hello&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, the task is added to the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskCollection.html"><code>TasksCollection</code></a> using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskContainer.html#register-java.lang.String-java.lang.Class-"><code>register()</code></a> method in <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskContainer.html"><code>TaskContainer</code></a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:configuring_tasks"><a class="anchor" href="#sec:configuring_tasks"></a><a class="link" href="#sec:configuring_tasks">2. Configuring tasks</a></h5>
<div class="paragraph">
<p>Gradle tasks must be configured to complete their action(s) successfully.
If a task needs to ZIP a file, it must be configured with the file name and location.
You can refer to the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/bundling/Zip.html">API</a> for the Gradle <code>Zip</code> task to learn how to configure it appropriately.</p>
</div>
<div class="paragraph">
<p>Let’s look at the <code>Copy</code> task provided by Gradle as an example.
We first register a task called <code>myCopy</code> of type <code>Copy</code> in the build script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;myCopy&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">myCopy</span><span class="delimiter">'</span></span>, Copy)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This registers a copy task with no default behavior.
Since the task is of type <code>Copy</code>, a Gradle supported task type, it can be configured using its <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Copy.html">API</a>.</p>
</div>
<div class="paragraph">
<p>The following examples show several ways to achieve the same configuration:</p>
</div>
<div class="sect5">
<h6 id="1_using_the_named_method"><a class="anchor" href="#1_using_the_named_method"></a><a class="link" href="#1_using_the_named_method">1. Using the <code>named()</code> method:</a></h6>
<div class="paragraph">
<p>Use <code>named()</code> to configure an existing task registered elsewhere:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;Copy&gt;(&quot;myCopy&quot;) {
    from(&quot;resources&quot;)
    into(&quot;target&quot;)
    include(&quot;**/*.txt&quot;, &quot;**/*.xml&quot;, &quot;**/*.properties&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">myCopy</span><span class="delimiter">'</span></span>) {
    from <span class="string"><span class="delimiter">'</span><span class="content">resources</span><span class="delimiter">'</span></span>
    into <span class="string"><span class="delimiter">'</span><span class="content">target</span><span class="delimiter">'</span></span>
    include(<span class="string"><span class="delimiter">'</span><span class="content">**/*.txt</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.properties</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="2_using_a_configuration_block"><a class="anchor" href="#2_using_a_configuration_block"></a><a class="link" href="#2_using_a_configuration_block">2. Using a configuration block:</a></h6>
<div class="paragraph">
<p>Use a block to configure the task immediately upon registering it:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copy&quot;) {
   from(&quot;resources&quot;)
   into(&quot;target&quot;)
   include(&quot;**/*.txt&quot;, &quot;**/*.xml&quot;, &quot;**/*.properties&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copy</span><span class="delimiter">'</span></span>, Copy) {
   from <span class="string"><span class="delimiter">'</span><span class="content">resources</span><span class="delimiter">'</span></span>
   into <span class="string"><span class="delimiter">'</span><span class="content">target</span><span class="delimiter">'</span></span>
   include(<span class="string"><span class="delimiter">'</span><span class="content">**/*.txt</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.properties</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="3_name_method_as_call"><a class="anchor" href="#3_name_method_as_call"></a><a class="link" href="#3_name_method_as_call">3. Name method as call:</a></h6>
<div class="paragraph">
<p>A popular option that is only supported in Groovy is the shorthand notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">copy {
    from(<span class="string"><span class="delimiter">&quot;</span><span class="content">resources</span><span class="delimiter">&quot;</span></span>)
    into(<span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span>)
    include(<span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.txt</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.properties</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This option breaks task configuration avoidance and is not recommended!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Regardless of the method chosen, the task is configured with the name of the files to be copied and the location of the files.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:implementing_tasks"><a class="anchor" href="#sec:implementing_tasks"></a><a class="link" href="#sec:implementing_tasks">3. Implementing tasks</a></h5>
<div class="paragraph">
<p>Gradle provides many task types including <code>Delete</code>, <code>Javadoc</code>, <code>Copy</code>, <code>Exec</code>, <code>Tar</code>, and <code>Pmd</code>.
You can implement a custom task type if Gradle does not provide a task type that meets your build logic needs.</p>
</div>
<div class="paragraph">
<p>To create a custom task class, you extend <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/DefaultTask.html"><code>DefaultTask</code></a> and make the extending class abstract:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class MyCopyTask extends DefaultTask {

}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">MyCopyTask</span> : DefaultTask() {

}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can learn more about developing custom task types in <a href="#sec:implementing_tasks">Implementing Tasks</a>.</p>
</div>
<div class="paragraph">
<p>Unresolved directive in userguide_single.adoc - include::lifecycle_tasks.adoc[leveloffset=+2]
Unresolved directive in userguide_single.adoc - include::actionable_tasks.adoc[leveloffset=+2]
:leveloffset: +2</p>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="lazy_configuration" class="sect0"><a class="anchor" href="#lazy_configuration"></a><a class="link" href="#lazy_configuration">Configuring Tasks Lazily</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Knowing when and where a particular value is configured is difficult to track as a build grows in complexity.
Gradle provides several ways to manage this using <strong>lazy configuration</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/writing-tasks-4.png" alt="writing tasks 4">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lazy_properties"><a class="anchor" href="#lazy_properties"></a><a class="link" href="#lazy_properties">Understanding Lazy properties</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gradle provides lazy properties, which delay calculating a property’s value until it’s actually required.</p>
</div>
<div class="paragraph">
<p>Lazy properties provide three main benefits:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Deferred Value Resolution:</strong> Allows wiring Gradle models without needing to know when a property&#8217;s value will be known.
For example, you may want to set the input source files of a task based on the source directories property of an extension, but the extension property value isn&#8217;t known until the build script or some other plugin configures them.</p>
</li>
<li>
<p><strong>Automatic Task Dependency Management:</strong> Connects output of one task to input of another, automatically determining task dependencies.
Property instances carry information about which task, if any, produces their value.
Build authors do not need to worry about keeping task dependencies in sync with configuration changes.</p>
</li>
<li>
<p><strong>Improved Build Performance:</strong> Avoids resource-intensive work during configuration, impacting build performance positively.
For example, when a configuration value comes from parsing a file but is only used when functional tests are run, using a property instance to capture this means that the file is parsed only when the functional tests are run (and not when <code>clean</code> is run, for example).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Gradle represents lazy properties with two interfaces:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html">Provider</a> </dt>
<dd>
<p>Represents a value that can only be queried and cannot be changed.</p>
<div class="ulist">
<ul>
<li>
<p>Properties with these types are read-only.</p>
</li>
<li>
<p>The method <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html#get--">Provider.get()</a> returns the current value of the property.</p>
</li>
<li>
<p>A <code>Provider</code> can be created from another <code>Provider</code> using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-">Provider.map(Transformer)</a>.</p>
</li>
<li>
<p>Many other types extend <code>Provider</code> and can be used wherever a <code>Provider</code> is required.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Property.html">Property</a> </dt>
<dd>
<p>Represents a value that can be queried and changed.</p>
<div class="ulist">
<ul>
<li>
<p>Properties with these types are configurable.</p>
</li>
<li>
<p><code>Property</code> extends the <code>Provider</code> interface.</p>
</li>
<li>
<p>The method <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Property.html#set-T-">Property.set(T)</a> specifies a value for the property, overwriting whatever value may have been present.</p>
</li>
<li>
<p>The method <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Property.html#set-org.gradle.api.provider.Provider-">Property.set(Provider)</a> specifies a <code>Provider</code> for the value for the property, overwriting whatever value may have been present.
This allows you to wire together <code>Provider</code> and <code>Property</code> instances before the values are configured.</p>
</li>
<li>
<p>A <code>Property</code> can be created by the factory method <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#property-java.lang.Class-">ObjectFactory.property(Class)</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Lazy properties are intended to be passed around and only queried when required.
This typically happens during the <a href="#sec:build_phases">execution phase</a>.</p>
</div>
<div class="paragraph">
<p>The following demonstrates a task with a configurable <code>greeting</code> property and a read-only <code>message</code> property:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class Greeting : DefaultTask() { // <b class="conum">(1)</b>
    @get:Input
    abstract val greeting: Property&lt;String&gt; // <b class="conum">(2)</b>

    @Internal
    val message: Provider&lt;String&gt; = greeting.map { it + &quot; from Gradle&quot; } // <b class="conum">(3)</b>

    @TaskAction
    fun printMessage() {
        logger.quiet(message.get())
    }
}

tasks.register&lt;Greeting&gt;(&quot;greeting&quot;) {
    greeting.set(&quot;Hi&quot;) // <b class="conum">(4)</b>
    greeting = &quot;Hi&quot; // <b class="conum">(5)</b>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">Greeting</span> <span class="directive">extends</span> DefaultTask { // <b class="conum">(1)</b>
    <span class="annotation">@Input</span>
    <span class="directive">abstract</span> Property&lt;<span class="predefined-type">String</span>&gt; getGreeting() // <b class="conum">(2)</b>

    <span class="annotation">@Internal</span>
    <span class="directive">final</span> <span class="predefined-type">Provider</span>&lt;<span class="predefined-type">String</span>&gt; message = greeting.map { <span class="local-variable">it</span> + <span class="string"><span class="delimiter">'</span><span class="content"> from Gradle</span><span class="delimiter">'</span></span> } // <b class="conum">(3)</b>

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> printMessage() {
        logger.quiet(message.get())
    }
}

tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>, Greeting) {
    greeting.set(<span class="string"><span class="delimiter">'</span><span class="content">Hi</span><span class="delimiter">'</span></span>) // <b class="conum">(4)</b>
    greeting = <span class="string"><span class="delimiter">'</span><span class="content">Hi</span><span class="delimiter">'</span></span> // <b class="conum">(5)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A task that displays a greeting</p>
</li>
<li>
<p>A configurable greeting</p>
</li>
<li>
<p>Read-only property calculated from the greeting</p>
</li>
<li>
<p>Configure the greeting</p>
</li>
<li>
<p>Alternative notation to calling Property.set()</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle greeting

&gt; Task :greeting
Hi from Gradle

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Greeting</code> task has a property of type <code>Property&lt;String&gt;</code> to represent the configurable greeting and a property of type <code>Provider&lt;String&gt;</code> to represent the calculated, read-only, message.
The message <code>Provider</code> is created from the greeting <code>Property</code> using the <code>map()</code> method; its value is kept up-to-date as the value of the greeting property changes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating_property_provider"><a class="anchor" href="#creating_property_provider"></a><a class="link" href="#creating_property_provider">Creating a Property or Provider instance</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Neither <code>Provider</code> nor its subtypes, such as <code>Property</code>, are intended to be implemented by a build script or plugin.
Gradle provides factory methods to create instances of these types instead.</p>
</div>
<div class="paragraph">
<p>In the previous example, two factory methods were presented:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#property-java.lang.Class-">ObjectFactory.property(Class)</a> create a new <code>Property</code> instance.
An instance of the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html">ObjectFactory</a> can be referenced from <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Project.html#getObjects--">Project.getObjects()</a> or by injecting <code>ObjectFactory</code> through a constructor or method.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-">Provider.map(Transformer)</a> creates a new <code>Provider</code> from an existing <code>Provider</code> or <code>Property</code> instance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <a href="#lazy_configuration_reference">Quick Reference</a> for all of the types and factories available.</p>
</div>
<div class="paragraph">
<p>A <code>Provider</code> can also be created by the factory method <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.provider.ProviderFactory.html#org.gradle.api.provider.ProviderFactory:provider(java.util.concurrent.Callable)">ProviderFactory.provider(Callable)</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There are no specific methods to create a provider using a <code>groovy.lang.Closure</code>.</p>
</div>
<div class="paragraph">
<p>When writing a plugin or build script with Groovy, you can use the <code>map(Transformer)</code> method with a closure, and Groovy will convert the closure to a <code>Transformer</code>.</p>
</div>
<div class="paragraph">
<p>Similarly, when writing a plugin or build script with Kotlin, the Kotlin compiler will convert a Kotlin function into a <code>Transformer</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connecting_properties_together"><a class="anchor" href="#connecting_properties_together"></a><a class="link" href="#connecting_properties_together">Connecting properties together</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>An important feature of lazy properties is that they can be connected together so that changes to one property are automatically reflected in other properties.</p>
</div>
<div class="paragraph">
<p>Here is an example where the property of a task is connected to a property of a project extension:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// A project extension
interface MessageExtension {
    // A configurable greeting
    abstract val greeting: Property&lt;String&gt;
}

// A task that displays a greeting
abstract class Greeting : DefaultTask() {
    // Configurable by the user
    @get:Input
    abstract val greeting: Property&lt;String&gt;

    // Read-only property calculated from the greeting
    @Internal
    val message: Provider&lt;String&gt; = greeting.map { it + &quot; from Gradle&quot; }

    @TaskAction
    fun printMessage() {
        logger.quiet(message.get())
    }
}

// Create the project extension
val messages = project.extensions.create&lt;MessageExtension&gt;(&quot;messages&quot;)

// Create the greeting task
tasks.register&lt;Greeting&gt;(&quot;greeting&quot;) {
    // Attach the greeting from the project extension
    // Note that the values of the project extension have not been configured yet
    greeting = messages.greeting
}

messages.apply {
    // Configure the greeting on the extension
    // Note that there is no need to reconfigure the task's `greeting` property. This is automatically updated as the extension property changes
    greeting = &quot;Hi&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// A project extension</span>
<span class="type">interface</span> MessageExtension {
    <span class="comment">// A configurable greeting</span>
    Property&lt;<span class="predefined-type">String</span>&gt; getGreeting()
}

<span class="comment">// A task that displays a greeting</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">Greeting</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// Configurable by the user</span>
    <span class="annotation">@Input</span>
    <span class="directive">abstract</span> Property&lt;<span class="predefined-type">String</span>&gt; getGreeting()

    <span class="comment">// Read-only property calculated from the greeting</span>
    <span class="annotation">@Internal</span>
    <span class="directive">final</span> <span class="predefined-type">Provider</span>&lt;<span class="predefined-type">String</span>&gt; message = greeting.map { <span class="local-variable">it</span> + <span class="string"><span class="delimiter">'</span><span class="content"> from Gradle</span><span class="delimiter">'</span></span> }

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> printMessage() {
        logger.quiet(message.get())
    }
}

<span class="comment">// Create the project extension</span>
project.extensions.create(<span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>, MessageExtension)

<span class="comment">// Create the greeting task</span>
tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>, Greeting) {
    <span class="comment">// Attach the greeting from the project extension</span>
    <span class="comment">// Note that the values of the project extension have not been configured yet</span>
    greeting = messages.greeting
}

messages {
    <span class="comment">// Configure the greeting on the extension</span>
    <span class="comment">// Note that there is no need to reconfigure the task's `greeting` property. This is automatically updated as the extension property changes</span>
    greeting = <span class="string"><span class="delimiter">'</span><span class="content">Hi</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle greeting

&gt; Task :greeting
Hi from Gradle

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>This example calls the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Property.html#set-org.gradle.api.provider.Provider-">Property.set(Provider)</a> method to attach a <code>Provider</code> to a <code>Property</code> to supply the value of the property.
In this case, the <code>Provider</code> happens to be a <code>Property</code> as well, but you can connect any <code>Provider</code> implementation, for example one created using <code>Provider.map()</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="working_with_files_in_lazy_properties"><a class="anchor" href="#working_with_files_in_lazy_properties"></a><a class="link" href="#working_with_files_in_lazy_properties">Working with files</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#working_with_files">Working with Files</a>, we introduced four collection types for <code>File</code>-like objects:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Read-only Type</th>
<th class="tableblock halign-left valign-top">Configurable Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ConfigurableFileCollection.html">ConfigurableFileCollection</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileTree.html">FileTree</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ConfigurableFileTree.html">ConfigurableFileTree</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All of these types are also considered lazy types.</p>
</div>
<div class="paragraph">
<p>There are more strongly typed models used to represent elements of the file system:
<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/Directory.html">Directory</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/RegularFile.html">RegularFile</a>.
These types shouldn&#8217;t be confused with the standard Java <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html">File</a> type as they are used to tell Gradle that you expect more specific values such as a directory or a non-directory, regular file.</p>
</div>
<div class="paragraph">
<p>Gradle provides two specialized <code>Property</code> subtypes for dealing with values of these types:
<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/RegularFileProperty.html">RegularFileProperty</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/DirectoryProperty.html">DirectoryProperty</a>. <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html">ObjectFactory</a> has methods to create these: <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#fileProperty--">ObjectFactory.fileProperty()</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#directoryProperty--">ObjectFactory.directoryProperty()</a>.</p>
</div>
<div class="paragraph">
<p>A <code>DirectoryProperty</code> can also be used to create a lazily evaluated <code>Provider</code> for a <code>Directory</code> and <code>RegularFile</code> via <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/DirectoryProperty.html#dir-java.lang.String-">DirectoryProperty.dir(String)</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/DirectoryProperty.html#file-java.lang.String-">DirectoryProperty.file(String)</a> respectively.
These methods create providers whose values are calculated relative to the location for the <code>DirectoryProperty</code> they were created from.
The values returned from these providers will reflect changes to the <code>DirectoryProperty</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// A task that generates a source file and writes the result to an output directory
abstract class GenerateSource : DefaultTask() {
    // The configuration file to use to generate the source file
    @get:InputFile
    abstract val configFile: RegularFileProperty

    // The directory to write source files to
    @get:OutputDirectory
    abstract val outputDir: DirectoryProperty

    @TaskAction
    fun compile() {
        val inFile = configFile.get().asFile
        logger.quiet(&quot;configuration file = $inFile&quot;)
        val dir = outputDir.get().asFile
        logger.quiet(&quot;output dir = $dir&quot;)
        val className = inFile.readText().trim()
        val srcFile = File(dir, &quot;${className}.java&quot;)
        srcFile.writeText(&quot;public class ${className} { }&quot;)
    }
}

// Create the source generation task
tasks.register&lt;GenerateSource&gt;(&quot;generate&quot;) {
    // Configure the locations, relative to the project and build directories
    configFile = layout.projectDirectory.file(&quot;src/config.txt&quot;)
    outputDir = layout.buildDirectory.dir(&quot;generated-source&quot;)
}

// Change the build directory
// Don't need to reconfigure the task properties. These are automatically updated as the build directory changes
layout.buildDirectory = layout.projectDirectory.dir(&quot;output&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// A task that generates a source file and writes the result to an output directory</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">GenerateSource</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// The configuration file to use to generate the source file</span>
    <span class="annotation">@InputFile</span>
    <span class="directive">abstract</span> RegularFileProperty getConfigFile()

    <span class="comment">// The directory to write source files to</span>
    <span class="annotation">@OutputDirectory</span>
    <span class="directive">abstract</span> DirectoryProperty getOutputDir()

    <span class="annotation">@TaskAction</span>
    <span class="keyword">def</span> <span class="function">compile</span>() {
        <span class="keyword">def</span> inFile = configFile.get().asFile
        logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">configuration file = </span><span class="inline"><span class="inline-delimiter">$</span>inFile</span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">def</span> dir = outputDir.get().asFile
        logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">output dir = </span><span class="inline"><span class="inline-delimiter">$</span>dir</span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">def</span> className = inFile.text.trim()
        <span class="keyword">def</span> srcFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(dir, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>className<span class="inline-delimiter">}</span></span><span class="content">.java</span><span class="delimiter">&quot;</span></span>)
        srcFile.text = <span class="string"><span class="delimiter">&quot;</span><span class="content">public class </span><span class="inline"><span class="inline-delimiter">${</span>className<span class="inline-delimiter">}</span></span><span class="content"> { ... }</span><span class="delimiter">&quot;</span></span>
    }
}

<span class="comment">// Create the source generation task</span>
tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">generate</span><span class="delimiter">'</span></span>, GenerateSource) {
    <span class="comment">// Configure the locations, relative to the project and build directories</span>
    configFile = layout.projectDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">src/config.txt</span><span class="delimiter">'</span></span>)
    outputDir = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">generated-source</span><span class="delimiter">'</span></span>)
}

<span class="comment">// Change the build directory</span>
<span class="comment">// Don't need to reconfigure the task properties. These are automatically updated as the build directory changes</span>
layout.buildDirectory = layout.projectDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock multi-language-text lang-groovy">
<div class="content">
<pre>$ gradle generate

&gt; Task :generate
configuration file = /home/user/gradle/samples/src/config.txt
output dir = /home/user/gradle/samples/output/generated-source

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="listingblock multi-language-text lang-kotlin">
<div class="content">
<pre>$ gradle generate

&gt; Task :generate
configuration file = /home/user/gradle/samples/kotlin/src/config.txt
output dir = /home/user/gradle/samples/kotlin/output/generated-source

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>This example creates providers that represent locations in the project and build directories through <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Project.html#getLayout--">Project.getLayout()</a> with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ProjectLayout.html#getBuildDirectory--">ProjectLayout.getBuildDirectory()</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ProjectLayout.html#getProjectDirectory--">ProjectLayout.getProjectDirectory()</a>.</p>
</div>
<div class="paragraph">
<p>To close the loop, note that a <code>DirectoryProperty</code>, or a simple <code>Directory</code>, can be turned into a <code>FileTree</code> that allows the files and directories contained in the directory to be queried with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/DirectoryProperty.html#getAsFileTree--">DirectoryProperty.getAsFileTree()</a> or <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/Directory.html#getAsFileTree--">Directory.getAsFileTree()</a>.
From a <code>DirectoryProperty</code> or a <code>Directory</code>, you can create <code>FileCollection</code> instances containing a set of the files contained in the directory with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/DirectoryProperty.html#files-java.lang.Object...-">DirectoryProperty.files(Object...)</a> or <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/Directory.html#files-java.lang.Object...-">Directory.files(Object...)</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="working_with_task_dependencies_in_lazy_properties"><a class="anchor" href="#working_with_task_dependencies_in_lazy_properties"></a><a class="link" href="#working_with_task_dependencies_in_lazy_properties">Working with task inputs and outputs</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many builds have several tasks connected together, where one task consumes the outputs of another task as an input.</p>
</div>
<div class="paragraph">
<p>To make this work, we need to configure each task to know where to look for its inputs and where to place its outputs.
Ensure that the producing and consuming tasks are configured with the same location and attach task dependencies between the tasks.
This can be cumbersome and brittle if any of these values are configurable by a user or configured by multiple plugins, as task properties need to be configured in the correct order and locations, and task dependencies kept in sync as values change.</p>
</div>
<div class="paragraph">
<p>The <code>Property</code> API makes this easier by keeping track of the value of a property and the task that produces the value.</p>
</div>
<div class="paragraph">
<p>As an example, consider the following plugin with a producer and consumer task which are wired together:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class Producer : DefaultTask() {
    @get:OutputFile
    abstract val outputFile: RegularFileProperty

    @TaskAction
    fun produce() {
        val message = &quot;Hello, World!&quot;
        val output = outputFile.get().asFile
        output.writeText( message)
        logger.quiet(&quot;Wrote '${message}' to ${output}&quot;)
    }
}

abstract class Consumer : DefaultTask() {
    @get:InputFile
    abstract val inputFile: RegularFileProperty

    @TaskAction
    fun consume() {
        val input = inputFile.get().asFile
        val message = input.readText()
        logger.quiet(&quot;Read '${message}' from ${input}&quot;)
    }
}

val producer = tasks.register&lt;Producer&gt;(&quot;producer&quot;)
val consumer = tasks.register&lt;Consumer&gt;(&quot;consumer&quot;)

consumer {
    // Connect the producer task output to the consumer task input
    // Don't need to add a task dependency to the consumer task. This is automatically added
    inputFile = producer.flatMap { it.outputFile }
}

producer {
    // Set values for the producer lazily
    // Don't need to update the consumer.inputFile property. This is automatically updated as producer.outputFile changes
    outputFile = layout.buildDirectory.file(&quot;file.txt&quot;)
}

// Change the build directory.
// Don't need to update producer.outputFile and consumer.inputFile. These are automatically updated as the build directory changes
layout.buildDirectory = layout.projectDirectory.dir(&quot;output&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">Producer</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@OutputFile</span>
    <span class="directive">abstract</span> RegularFileProperty getOutputFile()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> produce() {
        <span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">'</span><span class="content">Hello, World!</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> output = outputFile.get().asFile
        output.text = message
        logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Wrote '</span><span class="inline"><span class="inline-delimiter">${</span>message<span class="inline-delimiter">}</span></span><span class="content">' to </span><span class="inline"><span class="inline-delimiter">${</span>output<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}

<span class="directive">abstract</span> <span class="type">class</span> <span class="class">Consumer</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@InputFile</span>
    <span class="directive">abstract</span> RegularFileProperty getInputFile()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> consume() {
        <span class="keyword">def</span> input = inputFile.get().asFile
        <span class="keyword">def</span> message = input.text
        logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Read '</span><span class="inline"><span class="inline-delimiter">${</span>message<span class="inline-delimiter">}</span></span><span class="content">' from </span><span class="inline"><span class="inline-delimiter">${</span>input<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}

<span class="keyword">def</span> producer = tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">producer</span><span class="delimiter">&quot;</span></span>, Producer)
<span class="keyword">def</span> consumer = tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">consumer</span><span class="delimiter">&quot;</span></span>, Consumer)

consumer.configure {
    <span class="comment">// Connect the producer task output to the consumer task input</span>
    <span class="comment">// Don't need to add a task dependency to the consumer task. This is automatically added</span>
    inputFile = producer.flatMap { <span class="local-variable">it</span>.outputFile }
}

producer.configure {
    <span class="comment">// Set values for the producer lazily</span>
    <span class="comment">// Don't need to update the consumer.inputFile property. This is automatically updated as producer.outputFile changes</span>
    outputFile = layout.buildDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">file.txt</span><span class="delimiter">'</span></span>)
}

<span class="comment">// Change the build directory.</span>
<span class="comment">// Don't need to update producer.outputFile and consumer.inputFile. These are automatically updated as the build directory changes</span>
layout.buildDirectory = layout.projectDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock multi-language-text lang-groovy">
<div class="content">
<pre>$ gradle consumer

&gt; Task :producer
Wrote 'Hello, World!' to /home/user/gradle/samples/output/file.txt

&gt; Task :consumer
Read 'Hello, World!' from /home/user/gradle/samples/output/file.txt

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="listingblock multi-language-text lang-kotlin">
<div class="content">
<pre>$ gradle consumer

&gt; Task :producer
Wrote 'Hello, World!' to /home/user/gradle/samples/kotlin/output/file.txt

&gt; Task :consumer
Read 'Hello, World!' from /home/user/gradle/samples/kotlin/output/file.txt

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the task outputs and inputs are connected before any location is defined.
The setters can be called at any time before the task is executed, and the change will automatically affect all related input and output properties.</p>
</div>
<div class="paragraph">
<p>Another important thing to note in this example is the absence of any explicit task dependency.
Task outputs represented using <code>Providers</code> keep track of which task produces their value, and using them as task inputs will implicitly add the correct task dependencies.</p>
</div>
<div class="paragraph">
<p>Implicit task dependencies also work for input properties that are not files:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class Producer : DefaultTask() {
    @get:OutputFile
    abstract val outputFile: RegularFileProperty

    @TaskAction
    fun produce() {
        val message = &quot;Hello, World!&quot;
        val output = outputFile.get().asFile
        output.writeText( message)
        logger.quiet(&quot;Wrote '${message}' to ${output}&quot;)
    }
}

abstract class Consumer : DefaultTask() {
    @get:Input
    abstract val message: Property&lt;String&gt;

    @TaskAction
    fun consume() {
        logger.quiet(message.get())
    }
}

val producer = tasks.register&lt;Producer&gt;(&quot;producer&quot;) {
    // Set values for the producer lazily
    // Don't need to update the consumer.inputFile property. This is automatically updated as producer.outputFile changes
    outputFile = layout.buildDirectory.file(&quot;file.txt&quot;)
}
tasks.register&lt;Consumer&gt;(&quot;consumer&quot;) {
    // Connect the producer task output to the consumer task input
    // Don't need to add a task dependency to the consumer task. This is automatically added
    message = producer.flatMap { it.outputFile }.map { it.asFile.readText() }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">Producer</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@OutputFile</span>
    <span class="directive">abstract</span> RegularFileProperty getOutputFile()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> produce() {
        <span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">'</span><span class="content">Hello, World!</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> output = outputFile.get().asFile
        output.text = message
        logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Wrote '</span><span class="inline"><span class="inline-delimiter">${</span>message<span class="inline-delimiter">}</span></span><span class="content">' to </span><span class="inline"><span class="inline-delimiter">${</span>output<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}

<span class="directive">abstract</span> <span class="type">class</span> <span class="class">Consumer</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@Input</span>
    <span class="directive">abstract</span> Property&lt;<span class="predefined-type">String</span>&gt; getMessage()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> consume() {
        logger.quiet(message.get())
    }
}

<span class="keyword">def</span> producer = tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">producer</span><span class="delimiter">'</span></span>, Producer) {
    <span class="comment">// Set values for the producer lazily</span>
    <span class="comment">// Don't need to update the consumer.inputFile property. This is automatically updated as producer.outputFile changes</span>
    outputFile = layout.buildDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">file.txt</span><span class="delimiter">'</span></span>)
}
tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">consumer</span><span class="delimiter">'</span></span>, Consumer) {
    <span class="comment">// Connect the producer task output to the consumer task input</span>
    <span class="comment">// Don't need to add a task dependency to the consumer task. This is automatically added</span>
    message = producer.flatMap { <span class="local-variable">it</span>.outputFile }.map { <span class="local-variable">it</span>.asFile.text }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock multi-language-text lang-groovy">
<div class="content">
<pre>$ gradle consumer

&gt; Task :producer
Wrote 'Hello, World!' to /home/user/gradle/samples/build/file.txt

&gt; Task :consumer
Hello, World!

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="listingblock multi-language-text lang-kotlin">
<div class="content">
<pre>$ gradle consumer

&gt; Task :producer
Wrote 'Hello, World!' to /home/user/gradle/samples/kotlin/build/file.txt

&gt; Task :consumer
Hello, World!

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="working_with_collections"><a class="anchor" href="#working_with_collections"></a><a class="link" href="#working_with_collections">Working with collections</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gradle provides two lazy property types to help configure <code>Collection</code> properties.</p>
</div>
<div class="paragraph">
<p>These work exactly like any other <code>Provider</code> and, just like file providers, they have additional modeling around them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For <code>List</code> values the interface is called <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/ListProperty.html">ListProperty</a>.<br>
You can create a new <code>ListProperty</code> using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#listProperty-java.lang.Class-">ObjectFactory.listProperty(Class)</a> and specifying the element type.</p>
</li>
<li>
<p>For <code>Set</code> values the interface is called <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/SetProperty.html">SetProperty</a>.<br>
You can create a new <code>SetProperty</code> using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#setProperty-java.lang.Class-">ObjectFactory.setProperty(Class)</a> and specifying the element type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This type of property allows you to overwrite the entire collection value with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/HasMultipleValues.html#set-java.lang.Iterable-">HasMultipleValues.set(Iterable)</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/HasMultipleValues.html#set-org.gradle.api.provider.Provider-">HasMultipleValues.set(Provider)</a> or add new elements through the various <code>add</code> methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/HasMultipleValues.html#add-T-">HasMultipleValues.add(T)</a>: Add a single element to the collection</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/HasMultipleValues.html#add-org.gradle.api.provider.Provider-">HasMultipleValues.add(Provider)</a>: Add a lazily calculated element to the collection</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/HasMultipleValues.html#addAll-org.gradle.api.provider.Provider-">HasMultipleValues.addAll(Provider)</a>: Add a lazily calculated collection of elements to the list</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Just like every <code>Provider</code>, the collection is calculated when <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html#get--">Provider.get()</a> is called. The following example shows the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/ListProperty.html">ListProperty</a> in action:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class Producer : DefaultTask() {
    @get:OutputFile
    abstract val outputFile: RegularFileProperty

    @TaskAction
    fun produce() {
        val message = &quot;Hello, World!&quot;
        val output = outputFile.get().asFile
        output.writeText( message)
        logger.quiet(&quot;Wrote '${message}' to ${output}&quot;)
    }
}

abstract class Consumer : DefaultTask() {
    @get:InputFiles
    abstract val inputFiles: ListProperty&lt;RegularFile&gt;

    @TaskAction
    fun consume() {
        inputFiles.get().forEach { inputFile -&gt;
            val input = inputFile.asFile
            val message = input.readText()
            logger.quiet(&quot;Read '${message}' from ${input}&quot;)
        }
    }
}

val producerOne = tasks.register&lt;Producer&gt;(&quot;producerOne&quot;)
val producerTwo = tasks.register&lt;Producer&gt;(&quot;producerTwo&quot;)
tasks.register&lt;Consumer&gt;(&quot;consumer&quot;) {
    // Connect the producer task outputs to the consumer task input
    // Don't need to add task dependencies to the consumer task. These are automatically added
    inputFiles.add(producerOne.get().outputFile)
    inputFiles.add(producerTwo.get().outputFile)
}

// Set values for the producer tasks lazily
// Don't need to update the consumer.inputFiles property. This is automatically updated as producer.outputFile changes
producerOne { outputFile = layout.buildDirectory.file(&quot;one.txt&quot;) }
producerTwo { outputFile = layout.buildDirectory.file(&quot;two.txt&quot;) }

// Change the build directory.
// Don't need to update the task properties. These are automatically updated as the build directory changes
layout.buildDirectory = layout.projectDirectory.dir(&quot;output&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">Producer</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@OutputFile</span>
    <span class="directive">abstract</span> RegularFileProperty getOutputFile()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> produce() {
        <span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">'</span><span class="content">Hello, World!</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> output = outputFile.get().asFile
        output.text = message
        logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Wrote '</span><span class="inline"><span class="inline-delimiter">${</span>message<span class="inline-delimiter">}</span></span><span class="content">' to </span><span class="inline"><span class="inline-delimiter">${</span>output<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}

<span class="directive">abstract</span> <span class="type">class</span> <span class="class">Consumer</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@InputFiles</span>
    <span class="directive">abstract</span> ListProperty&lt;RegularFile&gt; getInputFiles()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> consume() {
        inputFiles.get().each { inputFile -&gt;
            <span class="keyword">def</span> input = inputFile.asFile
            <span class="keyword">def</span> message = input.text
            logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Read '</span><span class="inline"><span class="inline-delimiter">${</span>message<span class="inline-delimiter">}</span></span><span class="content">' from </span><span class="inline"><span class="inline-delimiter">${</span>input<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
        }
    }
}

<span class="keyword">def</span> producerOne = tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">producerOne</span><span class="delimiter">'</span></span>, Producer)
<span class="keyword">def</span> producerTwo = tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">producerTwo</span><span class="delimiter">'</span></span>, Producer)
tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">consumer</span><span class="delimiter">'</span></span>, Consumer) {
    <span class="comment">// Connect the producer task outputs to the consumer task input</span>
    <span class="comment">// Don't need to add task dependencies to the consumer task. These are automatically added</span>
    inputFiles.add(producerOne.get().outputFile)
    inputFiles.add(producerTwo.get().outputFile)
}

<span class="comment">// Set values for the producer tasks lazily</span>
<span class="comment">// Don't need to update the consumer.inputFiles property. This is automatically updated as producer.outputFile changes</span>
producerOne.configure { outputFile = layout.buildDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">one.txt</span><span class="delimiter">'</span></span>) }
producerTwo.configure { outputFile = layout.buildDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">two.txt</span><span class="delimiter">'</span></span>) }

<span class="comment">// Change the build directory.</span>
<span class="comment">// Don't need to update the task properties. These are automatically updated as the build directory changes</span>
layout.buildDirectory = layout.projectDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock multi-language-text lang-groovy">
<div class="content">
<pre>$ gradle consumer

&gt; Task :producerOne
Wrote 'Hello, World!' to /home/user/gradle/samples/output/one.txt

&gt; Task :producerTwo
Wrote 'Hello, World!' to /home/user/gradle/samples/output/two.txt

&gt; Task :consumer
Read 'Hello, World!' from /home/user/gradle/samples/output/one.txt
Read 'Hello, World!' from /home/user/gradle/samples/output/two.txt

BUILD SUCCESSFUL in 0s
3 actionable tasks: 3 executed</pre>
</div>
</div>
<div class="listingblock multi-language-text lang-kotlin">
<div class="content">
<pre>$ gradle consumer

&gt; Task :producerOne
Wrote 'Hello, World!' to /home/user/gradle/samples/kotlin/output/one.txt

&gt; Task :producerTwo
Wrote 'Hello, World!' to /home/user/gradle/samples/kotlin/output/two.txt

&gt; Task :consumer
Read 'Hello, World!' from /home/user/gradle/samples/kotlin/output/one.txt
Read 'Hello, World!' from /home/user/gradle/samples/kotlin/output/two.txt

BUILD SUCCESSFUL in 0s
3 actionable tasks: 3 executed</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="working_with_maps"><a class="anchor" href="#working_with_maps"></a><a class="link" href="#working_with_maps">Working with maps</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gradle provides a lazy <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/MapProperty.html">MapProperty</a> type to allow <code>Map</code> values to be configured.
You can create a <code>MapProperty</code> instance using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#mapProperty-java.lang.Class-java.lang.Class-">ObjectFactory.mapProperty(Class, Class)</a>.</p>
</div>
<div class="paragraph">
<p>Similar to other property types, a <code>MapProperty</code> has a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/MapProperty.html#set-java.util.Map-">set()</a> method that you can use to specify the value for the property.
Some additional methods allow entries with lazy values to be added to the map.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class Generator: DefaultTask() {
    @get:Input
    abstract val properties: MapProperty&lt;String, Int&gt;

    @TaskAction
    fun generate() {
        properties.get().forEach { entry -&gt;
            logger.quiet(&quot;${entry.key} = ${entry.value}&quot;)
        }
    }
}

// Some values to be configured later
var b = 0
var c = 0

tasks.register&lt;Generator&gt;(&quot;generate&quot;) {
    properties.put(&quot;a&quot;, 1)
    // Values have not been configured yet
    properties.put(&quot;b&quot;, providers.provider { b })
    properties.putAll(providers.provider { mapOf(&quot;c&quot; to c, &quot;d&quot; to c + 1) })
}

// Configure the values. There is no need to reconfigure the task
b = 2
c = 3</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">Generator</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@Input</span>
    <span class="directive">abstract</span> MapProperty&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; getProperties()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> generate() {
        properties.get().each { key, value -&gt;
            logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>key<span class="inline-delimiter">}</span></span><span class="content"> = </span><span class="inline"><span class="inline-delimiter">${</span>value<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
        }
    }
}

<span class="comment">// Some values to be configured later</span>
<span class="keyword">def</span> b = <span class="integer">0</span>
<span class="keyword">def</span> c = <span class="integer">0</span>

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">generate</span><span class="delimiter">'</span></span>, Generator) {
    properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)
    <span class="comment">// Values have not been configured yet</span>
    properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>, providers.provider { b })
    properties.putAll(providers.provider { [<span class="key">c</span>: c, <span class="key">d</span>: c + <span class="integer">1</span>] })
}

<span class="comment">// Configure the values. There is no need to reconfigure the task</span>
b = <span class="integer">2</span>
c = <span class="integer">3</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle generate

&gt; Task :generate
a = 1
b = 2
c = 3
d = 4

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="applying_conventions"><a class="anchor" href="#applying_conventions"></a><a class="link" href="#applying_conventions">Applying a convention to a property</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Often, you want to apply some <em>convention</em>, or default value to a property to be used if no value has been configured.
You can use the <code>convention()</code> method for this.
This method accepts either a value or a <code>Provider</code>, and this will be used as the value until some other value is configured.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;show&quot;) {
    val property = objects.property(String::class)

    // Set a convention
    property.convention(&quot;convention 1&quot;)

    println(&quot;value = &quot; + property.get())

    // Can replace the convention
    property.convention(&quot;convention 2&quot;)
    println(&quot;value = &quot; + property.get())

    property.set(&quot;explicit value&quot;)

    // Once a value is set, the convention is ignored
    property.convention(&quot;ignored convention&quot;)

    doLast {
        println(&quot;value = &quot; + property.get())
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>) {
    <span class="keyword">def</span> property = objects.property(<span class="predefined-type">String</span>)

    <span class="comment">// Set a convention</span>
    property.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">convention 1</span><span class="delimiter">&quot;</span></span>)

    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">value = </span><span class="delimiter">&quot;</span></span> + property.get())

    <span class="comment">// Can replace the convention</span>
    property.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">convention 2</span><span class="delimiter">&quot;</span></span>)
    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">value = </span><span class="delimiter">&quot;</span></span> + property.get())

    property.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">explicit value</span><span class="delimiter">&quot;</span></span>)

    <span class="comment">// Once a value is set, the convention is ignored</span>
    property.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">ignored convention</span><span class="delimiter">&quot;</span></span>)

    doLast {
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">value = </span><span class="delimiter">&quot;</span></span> + property.get())
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle show
value = convention 1
value = convention 2

&gt; Task :show
value = explicit value

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="sect2">
<h3 id="where_to_apply_conventions_from"><a class="anchor" href="#where_to_apply_conventions_from"></a><a class="link" href="#where_to_apply_conventions_from">Where to apply conventions from?</a></h3>
<div class="paragraph">
<p>There are several appropriate locations for setting a convention on a property at configuration time (i.e., before execution).</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// setting convention when registering a task from plugin
class GreetingPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        project.getTasks().register&lt;GreetingTask&gt;(&quot;hello&quot;) {
            greeter.convention(&quot;Greeter&quot;)
        }
    }
}

apply&lt;GreetingPlugin&gt;()

tasks.withType&lt;GreetingTask&gt;().configureEach {
    // setting convention from build script
    guest.convention(&quot;Guest&quot;)
}

abstract class GreetingTask : DefaultTask() {
    // setting convention from constructor
    @get:Input
    abstract val guest: Property&lt;String&gt;

    init {
        guest.convention(&quot;person2&quot;)
    }

    // setting convention from declaration
    @Input
    val greeter = project.objects.property&lt;String&gt;().convention(&quot;person1&quot;)

    @TaskAction
    fun greet() {
        println(&quot;hello, ${guest.get()}, from ${greeter.get()}&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// setting convention when registering a task from plugin</span>
<span class="type">class</span> <span class="class">GreetingPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="type">void</span> apply(Project project) {
        project.getTasks().register(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>, GreetingTask) {
            greeter.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">Greeter</span><span class="delimiter">&quot;</span></span>)
        }
    }
}

apply <span class="key">plugin</span>: GreetingPlugin

tasks.withType(GreetingTask).configureEach {
    <span class="comment">// setting convention from build script</span>
    guest.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">Guest</span><span class="delimiter">&quot;</span></span>)
}

<span class="directive">abstract</span> <span class="type">class</span> <span class="class">GreetingTask</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// setting convention from constructor</span>
    <span class="annotation">@Input</span>
    <span class="directive">abstract</span> Property&lt;<span class="predefined-type">String</span>&gt; getGuest()

    GreetingTask() {
        guest.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">person2</span><span class="delimiter">&quot;</span></span>)
    }

    <span class="comment">// setting convention from declaration</span>
    <span class="annotation">@Input</span>
    <span class="directive">final</span> Property&lt;<span class="predefined-type">String</span>&gt; greeter = project.objects.property(<span class="predefined-type">String</span>).convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">person1</span><span class="delimiter">&quot;</span></span>)

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> greet() {
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello, </span><span class="inline"><span class="inline-delimiter">${</span>guest.get()<span class="inline-delimiter">}</span></span><span class="content">, from </span><span class="inline"><span class="inline-delimiter">${</span>greeter.get()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="from_a_plugins_apply_method"><a class="anchor" href="#from_a_plugins_apply_method"></a><a class="link" href="#from_a_plugins_apply_method">From a plugin&#8217;s <code>apply()</code> method</a></h4>
<div class="paragraph">
<p>Plugin authors may configure a convention on a lazy property from a plugin&#8217;s <code>apply()</code> method, while performing preliminary configuration of the task or extension defining the property.
This works well for regular plugins (meant to be distributed and used in the wild), and internal <a href="#sec:convention_plugins">convention plugins</a> (which often configure properties defined by third party plugins in a uniform way for the entire build).</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// setting convention when registering a task from plugin
class GreetingPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        project.getTasks().register&lt;GreetingTask&gt;(&quot;hello&quot;) {
            greeter.convention(&quot;Greeter&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// setting convention when registering a task from plugin</span>
<span class="type">class</span> <span class="class">GreetingPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="type">void</span> apply(Project project) {
        project.getTasks().register(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>, GreetingTask) {
            greeter.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">Greeter</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="from_a_build_script"><a class="anchor" href="#from_a_build_script"></a><a class="link" href="#from_a_build_script">From a build script</a></h4>
<div class="paragraph">
<p>Build engineers may configure a convention on a lazy property from shared build logic that is configuring tasks (for instance, from third-party plugins) in a standard way for the entire build.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply&lt;GreetingPlugin&gt;()

tasks.withType&lt;GreetingTask&gt;().configureEach {
    // setting convention from build script
    guest.convention(&quot;Guest&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(GreetingTask).configureEach {
    <span class="comment">// setting convention from build script</span>
    guest.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">Guest</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that for project-specific values, instead of conventions, you should prefer setting explicit values (using <code>Property.set(&#8230;&#8203;)</code> or <code>ConfigurableFileCollection.setFrom(&#8230;&#8203;)</code>, for instance),
as conventions are only meant to define defaults.</p>
</div>
</div>
<div class="sect3">
<h4 id="from_the_task_initialization"><a class="anchor" href="#from_the_task_initialization"></a><a class="link" href="#from_the_task_initialization">From the task initialization</a></h4>
<div class="paragraph">
<p>A task author may configure a convention on a lazy property from the task constructor or (if in Kotlin) initializer block.
This approach works for properties with trivial defaults, but it is not appropriate if additional context (external to the task implementation) is required in order to set a suitable default.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// setting convention from constructor
@get:Input
abstract val guest: Property&lt;String&gt;

init {
    guest.convention(&quot;person2&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// setting convention from constructor</span>
<span class="annotation">@Input</span>
<span class="directive">abstract</span> Property&lt;<span class="predefined-type">String</span>&gt; getGuest()

GreetingTask() {
    guest.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">person2</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="next_to_the_property_declaration"><a class="anchor" href="#next_to_the_property_declaration"></a><a class="link" href="#next_to_the_property_declaration">Next to the property declaration</a></h4>
<div class="paragraph">
<p>You may configure a convention on a lazy property next to the place where the property is declared.
Note this option is not available for <a href="properties_providers.html#managed_properties">managed properties</a>, and has the same caveats as configuring a convention from the task constructor.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// setting convention from declaration
@Input
val greeter = project.objects.property&lt;String&gt;().convention(&quot;person1&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// setting convention from declaration</span>
<span class="annotation">@Input</span>
<span class="directive">final</span> Property&lt;<span class="predefined-type">String</span>&gt; greeter = project.objects.property(<span class="predefined-type">String</span>).convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">person1</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="unmodifiable_property"><a class="anchor" href="#unmodifiable_property"></a><a class="link" href="#unmodifiable_property">Making a property unmodifiable</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most properties of a task or project are intended to be configured by plugins or build scripts so that they can use specific values for that build.</p>
</div>
<div class="paragraph">
<p>For example, a property that specifies the output directory for a compilation task may start with a value specified by a plugin.
Then a build script might change the value to some custom location, then this value is used by the task when it runs.
However, once the task starts to run, we want to prevent further property changes.
This way we avoid errors that result from different consumers, such as the task action, Gradle&#8217;s up-to-date checks, build caching, or other tasks, using different values for the property.</p>
</div>
<div class="paragraph">
<p>Lazy properties provide several methods that you can use to disallow changes to their value once the value has been configured.
The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Property.html#finalizeValue--">finalizeValue()</a> method calculates the <em>final</em> value for the property and prevents further changes to the property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>libVersioning.version.finalizeValue()</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the property&#8217;s value comes from a <code>Provider</code>, the provider is queried for its current value, and the result becomes the final value for the property.
This final value replaces the provider and the property no longer tracks the value of the provider.
Calling this method also makes a property instance unmodifiable and any further attempts to change the value of the property will fail.
Gradle automatically makes the properties of a task final when the task starts execution.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/HasConfigurableValue.html#finalizeValueOnRead--">finalizeValueOnRead()</a> method is similar, except that the property&#8217;s final value is not calculated until the value of the property is queried.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>modifiedFiles.finalizeValueOnRead()</code></pre>
</div>
</div>
<div class="paragraph">
<p>In other words, this method calculates the final value lazily as required, whereas <code>finalizeValue()</code> calculates the final value eagerly.
This method can be used when the value may be expensive to calculate or may not have been configured yet.
You also want to ensure that all consumers of the property see the same value when they query the value.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lazy_configuration_faqs"><a class="anchor" href="#lazy_configuration_faqs"></a><a class="link" href="#lazy_configuration_faqs">Using the Provider API</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Guidelines to be successful with the Provider API:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Property.html">Property</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html">Provider</a> types have all of the overloads you need to query or configure a value. For this reason, you should follow the following guidelines:</p>
<div class="ulist">
<ul>
<li>
<p>For configurable properties, expose the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Property.html">Property</a> directly through a single getter.</p>
</li>
<li>
<p>For non-configurable properties, expose an <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html">Provider</a> directly through a single getter.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Avoid simplifying calls like <code>obj.getProperty().get()</code> and <code>obj.getProperty().set(T)</code> in your code by introducing additional getters and setters.</p>
</li>
<li>
<p>When migrating your plugin to use providers, follow these guidelines:</p>
<div class="ulist">
<ul>
<li>
<p>If it&#8217;s a new property, expose it as a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Property.html">Property</a> or <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html">Provider</a> using a single getter.</p>
</li>
<li>
<p>If it&#8217;s incubating, change it to use a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Property.html">Property</a> or <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html">Provider</a> using a single getter.</p>
</li>
<li>
<p>If it&#8217;s a stable property, add a new <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Property.html">Property</a> or <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html">Provider</a> and deprecate the old one. You should wire the old getter/setters into the new property as appropriate.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="lazy_configuration_reference"><a class="anchor" href="#lazy_configuration_reference"></a><a class="link" href="#lazy_configuration_reference">Provider Files API Reference</a></h3>
<div class="paragraph">
<p>Use these types for <em>read-only</em> values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html">Provider</a>&lt;<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/RegularFile.html">RegularFile</a>&gt;</dt>
<dd>
<p>File on disk</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-">Provider.map(Transformer)</a>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html#flatMap-org.gradle.api.Transformer-">Provider.flatMap(Transformer)</a>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/DirectoryProperty.html#file-java.lang.String-">DirectoryProperty.file(String)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html">Provider</a>&lt;<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/Directory.html">Directory</a>&gt;</dt>
<dd>
<p>Directory on disk</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-">Provider.map(Transformer)</a>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html#flatMap-org.gradle.api.Transformer-">Provider.flatMap(Transformer)</a>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/DirectoryProperty.html#dir-java.lang.String-">DirectoryProperty.dir(String)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a></dt>
<dd>
<p>Unstructured collection of files</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(Object[])</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ProjectLayout.html#files-java.lang.Object...-">ProjectLayout.files(Object...)</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/DirectoryProperty.html#files-java.lang.Object...-">DirectoryProperty.files(Object...)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileTree.html">FileTree</a></dt>
<dd>
<p>Hierarchy of files</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:fileTree(java.lang.Object)">Project.fileTree(Object)</a> will produce a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ConfigurableFileTree.html">ConfigurableFileTree</a>, or you can use <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Project.html#zipTree-java.lang.Object-">Project.zipTree(Object)</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Project.html#tarTree-java.lang.Object-">Project.tarTree(Object)</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/DirectoryProperty.html#getAsFileTree--">DirectoryProperty.getAsFileTree()</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="property_files_api_reference"><a class="anchor" href="#property_files_api_reference"></a><a class="link" href="#property_files_api_reference">Property Files API Reference</a></h3>
<div class="paragraph">
<p>Use these types for <em>mutable</em> values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/RegularFileProperty.html">RegularFileProperty</a></dt>
<dd>
<p>File on disk</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#fileProperty--">ObjectFactory.fileProperty()</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/DirectoryProperty.html">DirectoryProperty</a></dt>
<dd>
<p>Directory on disk</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#directoryProperty--">ObjectFactory.directoryProperty()</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ConfigurableFileCollection.html">ConfigurableFileCollection</a></dt>
<dd>
<p>Unstructured collection of files</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#fileCollection--">ObjectFactory.fileCollection()</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ConfigurableFileTree.html">ConfigurableFileTree</a></dt>
<dd>
<p>Hierarchy of files</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#fileTree--">ObjectFactory.fileTree()</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/SourceDirectorySet.html">SourceDirectorySet</a></dt>
<dd>
<p>Hierarchy of source directories</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#sourceDirectorySet-java.lang.String-java.lang.String-">ObjectFactory.sourceDirectorySet(String, String)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="lazy_collections_api_reference"><a class="anchor" href="#lazy_collections_api_reference"></a><a class="link" href="#lazy_collections_api_reference">Lazy Collections API Reference</a></h3>
<div class="paragraph">
<p>Use these types for <em>mutable</em> values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/ListProperty.html">ListProperty&lt;T&gt;</a></dt>
<dd>
<p>a property whose value is <code>List&lt;T&gt;</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#listProperty-java.lang.Class-">ObjectFactory.listProperty(Class)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/SetProperty.html">SetProperty&lt;T&gt;</a></dt>
<dd>
<p>a property whose value is <code>Set&lt;T&gt;</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#setProperty-java.lang.Class-">ObjectFactory.setProperty(Class)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="lazy_objects_api_reference"><a class="anchor" href="#lazy_objects_api_reference"></a><a class="link" href="#lazy_objects_api_reference">Lazy Objects API Reference</a></h3>
<div class="paragraph">
<p>Use these types for <em>read only</em> values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html">Provider&lt;T&gt;</a></dt>
<dd>
<p>a property whose value is an instance of <code>T</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-">Provider.map(Transformer)</a>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html#flatMap-org.gradle.api.Transformer-">Provider.flatMap(Transformer)</a>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.provider.ProviderFactory.html#org.gradle.api.provider.ProviderFactory:provider(java.util.concurrent.Callable)">ProviderFactory.provider(Callable)</a>. Always prefer one of the other factory methods over this method.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Use these types for <em>mutable</em> values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Property.html">Property&lt;T&gt;</a></dt>
<dd>
<p>a property whose value is an instance of <code>T</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#property-java.lang.Class-">ObjectFactory.property(Class)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="tasks_parallel_worker"><a class="anchor" href="#tasks_parallel_worker"></a><a class="link" href="#tasks_parallel_worker">Developing Parallel Tasks</a></h3>
<div class="paragraph">
<p>Gradle provides an API that can split tasks into sections that can be executed in parallel.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/writing-tasks-5.png" alt="writing tasks 5">
</div>
</div>
<div class="paragraph">
<p>This allows Gradle to fully utilize the resources available and complete builds faster.</p>
</div>
<div class="sect3">
<h4 id="worker_api"><a class="anchor" href="#worker_api"></a><a class="link" href="#worker_api">The Worker API</a></h4>
<div class="paragraph">
<p>The Worker API provides the ability to break up the execution of a task action into discrete units of work and then execute that work concurrently and asynchronously.</p>
</div>
</div>
<div class="sect3">
<h4 id="worker_api_example"><a class="anchor" href="#worker_api_example"></a><a class="link" href="#worker_api_example">Worker API example</a></h4>
<div class="paragraph">
<p>The best way to understand how to use the API is to go through the process of converting an existing custom task to use the Worker API:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You&#8217;ll start by creating a custom task class that generates MD5 hashes for a configurable set of files.</p>
</li>
<li>
<p>Then, you&#8217;ll convert this custom task to use the Worker API.</p>
</li>
<li>
<p>Then, we&#8217;ll explore running the task with different levels of isolation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the process, you&#8217;ll learn about the basics of the Worker API and the capabilities it provides.</p>
</div>
<div class="sect4">
<h5 id="step_1_create_a_custom_task_class"><a class="anchor" href="#step_1_create_a_custom_task_class"></a><a class="link" href="#step_1_create_a_custom_task_class">Step 1. Create a custom task class</a></h5>
<div class="paragraph">
<p>First, create a custom task that generates MD5 hashes of a configurable set of files.</p>
</div>
<div class="paragraph">
<p>In a new directory, create a <code>buildSrc/build.gradle(.kts)</code> file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;commons-io:commons-io:2.5&quot;)
    implementation(&quot;commons-codec:commons-codec:1.9&quot;) // <b class="conum">(1)</b>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-io:commons-io:2.5</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-codec:commons-codec:1.9</span><span class="delimiter">'</span></span> // <b class="conum">(1)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Your custom task class will use <a href="https://commons.apache.org/proper/commons-codec/">Apache Commons Codec</a> to generate MD5 hashes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Next, create a custom task class in your <code>buildSrc/src/main/java</code> directory.
You should name this class <code>CreateMD5</code>:</p>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/java/CreateMD5.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.apache.commons.codec.digest.DigestUtils</span>;
<span class="keyword">import</span> <span class="include">org.apache.commons.io.FileUtils</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.DirectoryProperty</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.RegularFile</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Provider</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.OutputDirectory</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.SourceTask</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>;
<span class="keyword">import</span> <span class="include">org.gradle.workers.WorkerExecutor</span>;

<span class="keyword">import</span> <span class="include">java.io.File</span>;
<span class="keyword">import</span> <span class="include">java.io.FileInputStream</span>;
<span class="keyword">import</span> <span class="include">java.io.InputStream</span>;

<span class="directive">abstract</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">CreateMD5</span> <span class="directive">extends</span> SourceTask { // <b class="conum">(1)</b>

    <span class="annotation">@OutputDirectory</span>
    <span class="directive">abstract</span> <span class="directive">public</span> DirectoryProperty getDestinationDirectory(); // <b class="conum">(2)</b>

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> createHashes() {
        <span class="keyword">for</span> (<span class="predefined-type">File</span> sourceFile : getSource().getFiles()) { // <b class="conum">(3)</b>
            <span class="keyword">try</span> {
                <span class="predefined-type">InputStream</span> stream = <span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(sourceFile);
                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Generating MD5 for </span><span class="delimiter">&quot;</span></span> + sourceFile.getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>);
                <span class="comment">// Artificially make this task slower.</span>
                <span class="predefined-type">Thread</span>.sleep(<span class="integer">3000</span>); // <b class="conum">(4)</b>
                <span class="predefined-type">Provider</span>&lt;RegularFile&gt; md5File = getDestinationDirectory().file(sourceFile.getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">.md5</span><span class="delimiter">&quot;</span></span>);  // <b class="conum">(5)</b>
                FileUtils.writeStringToFile(md5File.get().getAsFile(), DigestUtils.md5Hex(stream), (<span class="predefined-type">String</span>) <span class="predefined-constant">null</span>);
            } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(e);
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/SourceTask.html">SourceTask</a> is a convenience type for tasks that operate on a set of source files.</p>
</li>
<li>
<p>The task output will go into a configured directory.</p>
</li>
<li>
<p>The task iterates over all the files defined as "source files" and creates an MD5 hash of each.</p>
</li>
<li>
<p>Insert an artificial sleep to simulate hashing a large file (the sample files won&#8217;t be that large).</p>
</li>
<li>
<p>The MD5 hash of each file is written to the output directory into a file of the same name with an "md5" extension.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Next, create a <code>build.gradle(.kts)</code> that registers your new <code>CreateMD5</code> task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins { id(&quot;base&quot;) } // <b class="conum">(1)</b>

tasks.register&lt;CreateMD5&gt;(&quot;md5&quot;) {
    destinationDirectory = project.layout.buildDirectory.dir(&quot;md5&quot;) // <b class="conum">(2)</b>
    source(project.layout.projectDirectory.file(&quot;src&quot;)) // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins { id <span class="string"><span class="delimiter">'</span><span class="content">base</span><span class="delimiter">'</span></span> } // <b class="conum">(1)</b>

tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">md5</span><span class="delimiter">&quot;</span></span>, CreateMD5) {
    destinationDirectory = project.layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">md5</span><span class="delimiter">&quot;</span></span>) // <b class="conum">(2)</b>
    source(project.layout.projectDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>)) // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Apply the <code>base</code> plugin so that you&#8217;ll have a <code>clean</code> task to use to remove the output.</p>
</li>
<li>
<p>MD5 hash files will be written to <code>build/md5</code>.</p>
</li>
<li>
<p>This task will generate MD5 hash files for every file in the <code>src</code> directory.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You will need some source to generate MD5 hashes from.
Create three files in the <code>src</code> directory:</p>
</div>
<div class="listingblock">
<div class="title">src/einstein.txt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Intellectual growth should commence at birth and cease only at death.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/feynman.txt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">I was born not knowing and have had only a little time to change that here and there.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/hawking.txt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Intelligence is the ability to adapt to change.</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, you can test your task by running it <code>./gradlew md5</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle md5</pre>
</div>
</div>
<div class="paragraph">
<p>The output should look similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Task :md5
Generating MD5 for einstein.txt...
Generating MD5 for feynman.txt...
Generating MD5 for hawking.txt...

BUILD SUCCESSFUL in 9s
3 actionable tasks: 3 executed</pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>build/md5</code> directory, you should now see corresponding files with an <code>md5</code> extension containing MD5 hashes of the files from the <code>src</code> directory.
Notice that the task takes at least 9 seconds to run because it hashes each file one at a time (i.e., three files at ~3 seconds apiece).</p>
</div>
</div>
<div class="sect4">
<h5 id="converting_to_worker_api"><a class="anchor" href="#converting_to_worker_api"></a><a class="link" href="#converting_to_worker_api">Step 2. Convert to the Worker API</a></h5>
<div class="paragraph">
<p>Although this task processes each file in sequence, the processing of each file is independent of any other file.
This work can be done in parallel and take advantage of multiple processors.
This is where the Worker API can help.</p>
</div>
<div class="paragraph">
<p>To use the Worker API, you need to define an interface that represents the parameters of each unit of work and extends <code>org.gradle.workers.WorkParameters</code>.</p>
</div>
<div class="paragraph">
<p>For the generation of MD5 hash files, the unit of work will require two parameters:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the file to be hashed and,</p>
</li>
<li>
<p>the file to write the hash to.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There is no need to create a concrete implementation because Gradle will generate one for us at runtime.</p>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/java/MD5WorkParameters.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.file.RegularFileProperty</span>;
<span class="keyword">import</span> <span class="include">org.gradle.workers.WorkParameters</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">MD5WorkParameters</span> <span class="directive">extends</span> WorkParameters {
    RegularFileProperty getSourceFile(); // <b class="conum">(1)</b>
    RegularFileProperty getMD5File();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Use <code>Property</code> objects to represent the source and MD5 hash files.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Then, you need to refactor the part of your custom task that does the work for each individual file into a separate class.
This class is your "unit of work" implementation, and it should be an abstract class that extends <code>org.gradle.workers.WorkAction</code>:</p>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/java/GenerateMD5.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.apache.commons.codec.digest.DigestUtils</span>;
<span class="keyword">import</span> <span class="include">org.apache.commons.io.FileUtils</span>;
<span class="keyword">import</span> <span class="include">org.gradle.workers.WorkAction</span>;

<span class="keyword">import</span> <span class="include">java.io.File</span>;
<span class="keyword">import</span> <span class="include">java.io.FileInputStream</span>;
<span class="keyword">import</span> <span class="include">java.io.InputStream</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">GenerateMD5</span> <span class="directive">implements</span> WorkAction&lt;MD5WorkParameters&gt; { // <b class="conum">(1)</b>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> execute() {
        <span class="keyword">try</span> {
            <span class="predefined-type">File</span> sourceFile = getParameters().getSourceFile().getAsFile().get();
            <span class="predefined-type">File</span> md5File = getParameters().getMD5File().getAsFile().get();
            <span class="predefined-type">InputStream</span> stream = <span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(sourceFile);
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Generating MD5 for </span><span class="delimiter">&quot;</span></span> + sourceFile.getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>);
            <span class="comment">// Artificially make this task slower.</span>
            <span class="predefined-type">Thread</span>.sleep(<span class="integer">3000</span>);
            FileUtils.writeStringToFile(md5File, DigestUtils.md5Hex(stream), (<span class="predefined-type">String</span>) <span class="predefined-constant">null</span>);
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(e);
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Do not implement the <code>getParameters()</code> method - Gradle will inject this at runtime.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now, change your custom task class to submit work to the
<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/workers/WorkerExecutor.html">WorkerExecutor</a> instead of doing the work itself.</p>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/java/CreateMD5.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.Action</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.RegularFile</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Provider</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks</span>.*;
<span class="keyword">import</span> <span class="include">org.gradle.workers</span>.*;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.DirectoryProperty</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.io.File</span>;

<span class="directive">abstract</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">CreateMD5</span> <span class="directive">extends</span> SourceTask {

    <span class="annotation">@OutputDirectory</span>
    <span class="directive">abstract</span> <span class="directive">public</span> DirectoryProperty getDestinationDirectory();

    <span class="annotation">@Inject</span>
    <span class="directive">abstract</span> <span class="directive">public</span> WorkerExecutor getWorkerExecutor(); // <b class="conum">(1)</b>

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> createHashes() {
        WorkQueue workQueue = getWorkerExecutor().noIsolation(); // <b class="conum">(2)</b>

        <span class="keyword">for</span> (<span class="predefined-type">File</span> sourceFile : getSource().getFiles()) {
            <span class="predefined-type">Provider</span>&lt;RegularFile&gt; md5File = getDestinationDirectory().file(sourceFile.getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">.md5</span><span class="delimiter">&quot;</span></span>);
            workQueue.submit(GenerateMD5.class, parameters -&gt; { // <b class="conum">(3)</b>
                parameters.getSourceFile().set(sourceFile);
                parameters.getMD5File().set(md5File);
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/workers/WorkerExecutor.html">WorkerExecutor</a> service is required in order to submit your work.
Create an abstract getter method annotated <code>javax.inject.Inject</code>, and Gradle will inject the service at runtime when the task is created.</p>
</li>
<li>
<p>Before submitting work, get a <code>WorkQueue</code> object with the desired isolation mode (described below).</p>
</li>
<li>
<p>When submitting the unit of work, specify the unit of work implementation, in this case <code>GenerateMD5</code>, and configure its parameters.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>At this point, you should be able to rerun your task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle clean md5

&gt; Task :md5
Generating MD5 for einstein.txt...
Generating MD5 for feynman.txt...
Generating MD5 for hawking.txt...

BUILD SUCCESSFUL in 3s
3 actionable tasks: 3 executed</pre>
</div>
</div>
<div class="paragraph">
<p>The results should look the same as before, although the MD5 hash files may be generated in a different order since the units of work are executed in parallel.
This time, however, the task runs much faster.
This is because the Worker API executes the MD5 calculation for each file in parallel rather than in sequence.</p>
</div>
</div>
<div class="sect4">
<h5 id="step_3_change_the_isolation_mode"><a class="anchor" href="#step_3_change_the_isolation_mode"></a><a class="link" href="#step_3_change_the_isolation_mode">Step 3. Change the isolation mode</a></h5>
<div class="paragraph">
<p>The isolation mode controls how strongly Gradle will isolate items of work from each other and the rest of the Gradle runtime.</p>
</div>
<div class="paragraph">
<p>There are three methods on <code>WorkerExecutor</code> that control this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>noIsolation()</code></p>
</li>
<li>
<p><code>classLoaderIsolation()</code></p>
</li>
<li>
<p><code>processIsolation()</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>noIsolation()</code> mode is the lowest level of isolation and will prevent a unit of work from changing the project state.
This is the fastest isolation mode because it requires the least overhead to set up and execute the work item.
However, it will use a single shared classloader for all units of work.
This means that each unit of work can affect one another through static class state.
It also means that every unit of work uses the same version of libraries on the buildscript classpath.
If you wanted the user to be able to configure the task to run with a different (but compatible) version of the
<a href="https://commons.apache.org/proper/commons-codec/">Apache Commons Codec</a> library, you would need to use a different isolation mode.</p>
</div>
<div class="paragraph">
<p>First, you must change the dependency in <code>buildSrc/build.gradle</code> to be <code>compileOnly</code>.
This tells Gradle that it should use this dependency when building the classes, but should not put it on the build script classpath:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;commons-io:commons-io:2.5&quot;)
    compileOnly(&quot;commons-codec:commons-codec:1.9&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-io:commons-io:2.5</span><span class="delimiter">'</span></span>
    compileOnly <span class="string"><span class="delimiter">'</span><span class="content">commons-codec:commons-codec:1.9</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Next, change the <code>CreateMD5</code> task to allow the user to configure the version of the codec library that they want to use.
It will resolve the appropriate version of the library at runtime and configure the workers to use this version.</p>
</div>
<div class="paragraph">
<p>The <code>classLoaderIsolation()</code> method tells Gradle to run this work in a thread with an isolated classloader:</p>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/java/CreateMD5.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.api.Action</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.ConfigurableFileCollection</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.DirectoryProperty</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.RegularFile</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Provider</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.*</span>;
<span class="keyword">import</span> <span class="include">org.gradle.process.JavaForkOptions</span>;
<span class="keyword">import</span> <span class="include">org.gradle.workers.*</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.io.File</span>;
<span class="keyword">import</span> <span class="include">java.util.Set</span>;

<span class="directive">abstract</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">CreateMD5</span> <span class="directive">extends</span> SourceTask {

    <span class="annotation">@InputFiles</span>
    <span class="directive">abstract</span> <span class="directive">public</span> ConfigurableFileCollection getCodecClasspath(); // <b class="conum">(1)</b>

    <span class="annotation">@OutputDirectory</span>
    <span class="directive">abstract</span> <span class="directive">public</span> DirectoryProperty getDestinationDirectory();

    <span class="annotation">@Inject</span>
    <span class="directive">abstract</span> <span class="directive">public</span> WorkerExecutor getWorkerExecutor();

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> createHashes() {
        WorkQueue workQueue = getWorkerExecutor().classLoaderIsolation(workerSpec -&gt; {
            workerSpec.getClasspath().from(getCodecClasspath()); // <b class="conum">(2)</b>
        });

        <span class="keyword">for</span> (<span class="predefined-type">File</span> sourceFile : getSource().getFiles()) {
            <span class="predefined-type">Provider</span>&lt;RegularFile&gt; md5File = getDestinationDirectory().file(sourceFile.getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">.md5</span><span class="delimiter">&quot;</span></span>);
            workQueue.submit(GenerateMD5.class, parameters -&gt; {
                parameters.getSourceFile().set(sourceFile);
                parameters.getMD5File().set(md5File);
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Expose an input property for the codec library classpath.</p>
</li>
<li>
<p>Configure the classpath on the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/workers/ClassLoaderWorkerSpec.html">ClassLoaderWorkerSpec</a> when creating the work queue.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Next, you need to configure your build so that it has a repository to look up the codec version at task execution time.
We also create a dependency to resolve our codec library from this repository:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins { id(&quot;base&quot;) }

repositories {
    mavenCentral() // <b class="conum">(1)</b>
}

val codec = configurations.create(&quot;codec&quot;) { // <b class="conum">(2)</b>
    attributes {
        attribute(Usage.USAGE_ATTRIBUTE, objects.named(Usage.JAVA_RUNTIME))
    }
    isVisible = false
    isCanBeConsumed = false
}

dependencies {
    codec(&quot;commons-codec:commons-codec:1.10&quot;) // <b class="conum">(3)</b>
}

tasks.register&lt;CreateMD5&gt;(&quot;md5&quot;) {
    codecClasspath.from(codec) // <b class="conum">(4)</b>
    destinationDirectory = project.layout.buildDirectory.dir(&quot;md5&quot;)
    source(project.layout.projectDirectory.file(&quot;src&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins { id <span class="string"><span class="delimiter">'</span><span class="content">base</span><span class="delimiter">'</span></span> }

repositories {
    mavenCentral() // <b class="conum">(1)</b>
}

configurations.create(<span class="string"><span class="delimiter">'</span><span class="content">codec</span><span class="delimiter">'</span></span>) { // <b class="conum">(2)</b>
    attributes {
        attribute(Usage.USAGE_ATTRIBUTE, objects.named(Usage, Usage.JAVA_RUNTIME))
    }
    visible = <span class="predefined-constant">false</span>
    canBeConsumed = <span class="predefined-constant">false</span>
}

dependencies {
    codec <span class="string"><span class="delimiter">'</span><span class="content">commons-codec:commons-codec:1.10</span><span class="delimiter">'</span></span> // <b class="conum">(3)</b>
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">md5</span><span class="delimiter">'</span></span>, CreateMD5) {
    codecClasspath.from(configurations.codec) // <b class="conum">(4)</b>
    destinationDirectory = project.layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">md5</span><span class="delimiter">'</span></span>)
    source(project.layout.projectDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Add a repository to resolve the codec library - this can be a different repository than the one used to build the <code>CreateMD5</code> task class.</p>
</li>
<li>
<p>Add a <em>configuration</em> to resolve our codec library version.</p>
</li>
<li>
<p>Configure an alternate, compatible version of <a href="https://commons.apache.org/proper/commons-codec/">Apache Commons Codec</a>.</p>
</li>
<li>
<p>Configure the <code>md5</code> task to use the configuration as its classpath.
Note that the configuration will not be resolved until the task is executed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now, if you run your task, it should work as expected using the configured version of the codec library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle clean md5

&gt; Task :md5
Generating MD5 for einstein.txt...
Generating MD5 for feynman.txt...
Generating MD5 for hawking.txt...

BUILD SUCCESSFUL in 3s
3 actionable tasks: 3 executed</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="step_4_create_a_worker_daemon"><a class="anchor" href="#step_4_create_a_worker_daemon"></a><a class="link" href="#step_4_create_a_worker_daemon">Step 4. Create a Worker Daemon</a></h5>
<div class="paragraph">
<p>Sometimes, it is desirable to utilize even greater levels of isolation when executing items of work.
For instance, external libraries may rely on certain system properties to be set, which may conflict between work items.
Or a library might not be compatible with the version of JDK that Gradle is running with and may need to be run with a different version.</p>
</div>
<div class="paragraph">
<p>The Worker API can accommodate this using the <code>processIsolation()</code> method that causes the work to execute in a separate "worker daemon".
These worker processes will be session-scoped and can be reused within the same build session, but they won&#8217;t persist across builds.
However, if system resources get low, Gradle will stop unused worker daemons.</p>
</div>
<div class="paragraph">
<p>To utilize a worker daemon, use the <code>processIsolation()</code> method when creating the <code>WorkQueue</code>.
You may also want to configure custom settings for the new process:</p>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/java/CreateMD5.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.Action</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.ConfigurableFileCollection</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.DirectoryProperty</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.RegularFile</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Provider</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks</span>.*;
<span class="keyword">import</span> <span class="include">org.gradle.process.JavaForkOptions</span>;
<span class="keyword">import</span> <span class="include">org.gradle.workers</span>.*;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.io.File</span>;
<span class="keyword">import</span> <span class="include">java.util.Set</span>;

<span class="directive">abstract</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">CreateMD5</span> <span class="directive">extends</span> SourceTask {

    <span class="annotation">@InputFiles</span>
    <span class="directive">abstract</span> <span class="directive">public</span> ConfigurableFileCollection getCodecClasspath(); // <b class="conum">(1)</b>

    <span class="annotation">@OutputDirectory</span>
    <span class="directive">abstract</span> <span class="directive">public</span> DirectoryProperty getDestinationDirectory();

    <span class="annotation">@Inject</span>
    <span class="directive">abstract</span> <span class="directive">public</span> WorkerExecutor getWorkerExecutor();

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> createHashes() {
        // <b class="conum">(1)</b>
        WorkQueue workQueue = getWorkerExecutor().processIsolation(workerSpec -&gt; {
            workerSpec.getClasspath().from(getCodecClasspath());
            workerSpec.forkOptions(options -&gt; {
                options.setMaxHeapSize(<span class="string"><span class="delimiter">&quot;</span><span class="content">64m</span><span class="delimiter">&quot;</span></span>); // <b class="conum">(2)</b>
            });
        });

        <span class="keyword">for</span> (<span class="predefined-type">File</span> sourceFile : getSource().getFiles()) {
            <span class="predefined-type">Provider</span>&lt;RegularFile&gt; md5File = getDestinationDirectory().file(sourceFile.getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">.md5</span><span class="delimiter">&quot;</span></span>);
            workQueue.submit(GenerateMD5.class, parameters -&gt; {
                parameters.getSourceFile().set(sourceFile);
                parameters.getMD5File().set(md5File);
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Change the isolation mode to <code>PROCESS</code>.</p>
</li>
<li>
<p>Set up the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/process/JavaForkOptions.html">JavaForkOptions</a> for the new process.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now, you should be able to run your task, and it will work as expected but using worker daemons instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle clean md5

&gt; Task :md5
Generating MD5 for einstein.txt...
Generating MD5 for feynman.txt...
Generating MD5 for hawking.txt...

BUILD SUCCESSFUL in 3s
3 actionable tasks: 3 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the execution time may be high.
This is because Gradle has to start a new process for each worker daemon, which is expensive.</p>
</div>
<div class="paragraph">
<p>However, if you run your task a second time, you will see that it runs much faster.
This is because the worker daemon(s) started during the initial build have persisted and are available for use immediately during subsequent builds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle clean md5

&gt; Task :md5
Generating MD5 for einstein.txt...
Generating MD5 for feynman.txt...
Generating MD5 for hawking.txt...

BUILD SUCCESSFUL in 1s
3 actionable tasks: 3 executed</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="isolation-modes"><a class="anchor" href="#isolation-modes"></a><a class="link" href="#isolation-modes">Isolation modes</a></h4>
<div class="paragraph">
<p>Gradle provides three isolation modes that can be configured when creating a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/workers/WorkQueue.html">WorkQueue</a> and are specified using one of the following methods on <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/workers/WorkerExecutor.html">WorkerExecutor</a>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/workers/WorkerExecutor.html#noIsolation--"><code>WorkerExecutor.noIsolation()</code></a></dt>
<dd>
<p>This states that the work should be run in a thread with minimal isolation.<br>
For instance, it will share the same classloader that the task is loaded from.
This is the fastest level of isolation.</p>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/workers/WorkerExecutor.html#classLoaderIsolation-org.gradle.api.Action-"><code>WorkerExecutor.classLoaderIsolation()</code></a></dt>
<dd>
<p>This states that the work should be run in a thread with an isolated classloader. <br>
The classloader will have the classpath from the classloader that the unit of work implementation class was loaded from as well as any additional classpath entries added through <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/workers/ClassLoaderWorkerSpec.html#getClasspath--"><code>ClassLoaderWorkerSpec.getClasspath()</code></a>.</p>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/workers/WorkerExecutor.html#processIsolation-org.gradle.api.Action-"><code>WorkerExecutor.processIsolation()</code></a></dt>
<dd>
<p>This states that the work should be run with a maximum isolation level by executing the work in a separate process.<br>
The classloader of the process will use the classpath from the classloader that the unit of work was loaded from as well as any additional classpath entries added through <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/workers/ClassLoaderWorkerSpec.html#getClasspath--"><code>ClassLoaderWorkerSpec.getClasspath()</code></a>.
Furthermore, the process will be a <em>worker daemon</em> that will stay alive and can be reused for future work items with the same requirements.
This process can be configured with different settings than the Gradle JVM using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/workers/ProcessWorkerSpec.html#forkOptions-org.gradle.api.Action-">ProcessWorkerSpec.forkOptions(org.gradle.api.Action)</a>.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="worker-daemons"><a class="anchor" href="#worker-daemons"></a><a class="link" href="#worker-daemons">Worker Daemons</a></h5>
<div class="paragraph">
<p>When using <code>processIsolation()</code>, Gradle will start a long-lived <em>worker daemon</em> process that can be reused for future work items.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Create a WorkQueue with process isolation
val workQueue = workerExecutor.processIsolation() {
    // Configure the options for the forked process
    forkOptions {
        maxHeapSize = &quot;512m&quot;
        systemProperty(&quot;org.gradle.sample.showFileSize&quot;, &quot;true&quot;)
    }
}

// Create and submit a unit of work for each file
source.forEach { file -&gt;
    workQueue.submit(ReverseFile::class) {
        fileToReverse = file
        destinationDir = outputDir
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Create a WorkQueue with process isolation</span>
WorkQueue workQueue = workerExecutor.processIsolation() { ProcessWorkerSpec spec -&gt;
    <span class="comment">// Configure the options for the forked process</span>
    forkOptions { JavaForkOptions options -&gt;
        options.maxHeapSize = <span class="string"><span class="delimiter">&quot;</span><span class="content">512m</span><span class="delimiter">&quot;</span></span>
        options.systemProperty <span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.sample.showFileSize</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
    }
}

<span class="comment">// Create and submit a unit of work for each file</span>
source.each { file -&gt;
    workQueue.submit(ReverseFile.class) { ReverseParameters parameters -&gt;
        parameters.fileToReverse = file
        parameters.destinationDir = outputDir
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When a unit of work for a worker daemon is submitted, Gradle will first look to see if a compatible, idle daemon already exists.
If so, it will send the unit of work to the idle daemon, marking it as busy.
If not, it will start a new daemon.
When evaluating compatibility, Gradle looks at a number of criteria, all of which can be controlled through <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/workers/ProcessWorkerSpec.html#forkOptions-org.gradle.api.Action-">ProcessWorkerSpec.forkOptions(org.gradle.api.Action)</a>.</p>
</div>
<div class="paragraph">
<p>By default, a worker daemon starts with a maximum heap of 512MB.
This can be changed by adjusting the workers' fork options.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">executable</dt>
<dd>
<p>A daemon is considered compatible only if it uses the same Java executable.</p>
</dd>
<dt class="hdlist1">classpath</dt>
<dd>
<p>A daemon is considered compatible if its classpath contains all the classpath entries requested.<br>
Note that a daemon is considered compatible only if the classpath exactly matches the requested classpath.</p>
</dd>
<dt class="hdlist1">heap settings</dt>
<dd>
<p>A daemon is considered compatible if it has at least the same heap size settings as requested.<br>
In other words, a daemon that has higher heap settings than requested would be considered compatible.</p>
</dd>
<dt class="hdlist1">jvm arguments</dt>
<dd>
<p>A daemon is compatible if it has set all the JVM arguments requested.<br>
Note that a daemon is compatible if it has additional JVM arguments beyond those requested (except for those treated especially, such as heap settings, assertions, debug, etc.).</p>
</dd>
<dt class="hdlist1">system properties</dt>
<dd>
<p>A daemon is considered compatible if it has set all the system properties requested with the same values.<br>
Note that a daemon is compatible if it has additional system properties beyond those requested.</p>
</dd>
<dt class="hdlist1">environment variables</dt>
<dd>
<p>A daemon is considered compatible if it has set all the environment variables requested with the same values.<br>
Note that a daemon is compatible if it has more environment variables than requested.</p>
</dd>
<dt class="hdlist1">bootstrap classpath</dt>
<dd>
<p>A daemon is considered compatible if it contains all the bootstrap classpath entries requested.<br>
Note that a daemon is compatible if it has more bootstrap classpath entries than requested.</p>
</dd>
<dt class="hdlist1">debug</dt>
<dd>
<p>A daemon is considered compatible only if debug is set to the same value as requested (<code>true</code> or <code>false</code>).</p>
</dd>
<dt class="hdlist1">enable assertions</dt>
<dd>
<p>A daemon is considered compatible only if enable assertions are set to the same value as requested (<code>true</code> or <code>false</code>).</p>
</dd>
<dt class="hdlist1">default character encoding</dt>
<dd>
<p>A daemon is considered compatible only if the default character encoding is set to the same value as requested.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Worker daemons will remain running until the build daemon that started them is stopped or system memory becomes scarce.
When system memory is low, Gradle will stop worker daemons to minimize memory consumption.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A step-by-step description of converting a normal task action to use the worker API can be found in the section on <a href="#tasks_parallel_worker">developing parallel tasks</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cancellation_and_timeouts"><a class="anchor" href="#cancellation_and_timeouts"></a><a class="link" href="#cancellation_and_timeouts">Cancellation and timeouts</a></h4>
<div class="paragraph">
<p>To support cancellation (e.g., when the user stops the build with CTRL+C) and task timeouts, custom tasks should react to interrupting their executing thread.
The same is true for work items submitted via the worker API.
If a task does not respond to an interrupt within 10s, the daemon will shut down to free up system resources.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom_tasks"><a class="anchor" href="#custom_tasks"></a><a class="link" href="#custom_tasks">Advanced Tasks</a></h3>
<div class="sect3">
<h4 id="incremental_tasks"><a class="anchor" href="#incremental_tasks"></a><a class="link" href="#incremental_tasks">Incremental tasks</a></h4>
<div class="paragraph">
<p>In Gradle, implementing a task that skips execution when its inputs and outputs are already <code>UP-TO-DATE</code> is simple and efficient, thanks to the <a href="#incremental_build">Incremental Build</a> feature.</p>
</div>
<div class="paragraph">
<p>However, there are times when only a few input files have changed since the last execution, and it is best to avoid reprocessing all the unchanged inputs.
This situation is common in tasks that transform input files into output files on a one-to-one basis.</p>
</div>
<div class="paragraph">
<p>To optimize your build process you can use an incremental task.
This approach ensures that only out-of-date input files are processed, improving build performance.</p>
</div>
<div class="sect4">
<h5 id="sec:implementing_an_incremental_task"><a class="anchor" href="#sec:implementing_an_incremental_task"></a><a class="link" href="#sec:implementing_an_incremental_task">Implementing an incremental task</a></h5>
<div class="paragraph">
<p>For a task to process inputs incrementally, that task must contain an <em>incremental</em> task action.</p>
</div>
<div class="paragraph">
<p>This is a task action method that has a single <a href="https://docs.gradle.org/8.9/dsl/org.gradle.work.InputChanges.html">InputChanges</a> parameter.
That parameter tells Gradle that the action only wants to process the changed inputs.</p>
</div>
<div class="paragraph">
<p>In addition, the task needs to declare at least one incremental file input property by using either <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/work/Incremental.html"><code>@Incremental</code></a> or <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/SkipWhenEmpty.html"><code>@SkipWhenEmpty</code></a>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">public class IncrementalReverseTask : DefaultTask() {

    @get:Incremental
    @get:InputDirectory
    val inputDir: DirectoryProperty = project.objects.directoryProperty()

    @get:OutputDirectory
    val outputDir: DirectoryProperty = project.objects.directoryProperty()

    @get:Input
    val inputProperty: RegularFileProperty = project.objects.fileProperty() // File input property

    @TaskAction
    fun execute(inputs: InputChanges) { // InputChanges parameter
        val msg = if (inputs.isIncremental) &quot;CHANGED inputs are out of date&quot;
                  else &quot;ALL inputs are out of date&quot;
        println(msg)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">IncrementalReverseTask</span> <span class="directive">extends</span> DefaultTask {

    <span class="annotation">@Incremental</span>
    <span class="annotation">@InputDirectory</span>
    <span class="keyword">def</span> <span class="predefined-type">File</span> inputDir

    <span class="annotation">@OutputDirectory</span>
    <span class="keyword">def</span> <span class="predefined-type">File</span> outputDir

    <span class="annotation">@Input</span>
    <span class="keyword">def</span> inputProperty <span class="comment">// File input property</span>

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> execute(InputChanges inputs) { <span class="comment">// InputChanges parameter</span>
        println inputs.incremental ? <span class="string"><span class="delimiter">&quot;</span><span class="content">CHANGED inputs are out of date</span><span class="delimiter">&quot;</span></span>
                                   : <span class="string"><span class="delimiter">&quot;</span><span class="content">ALL inputs are out of date</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To query incremental changes for an input file property, that property must always return the same instance.
The easiest way to accomplish this is to use one of the following property types: <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/RegularFileProperty.html"><code>RegularFileProperty</code></a>, <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/DirectoryProperty.html"><code>DirectoryProperty</code></a> or <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ConfigurableFileCollection.html"><code>ConfigurableFileCollection</code></a>.</p>
</div>
<div class="paragraph">
<p>You can learn more about <code>RegularFileProperty</code> and <code>DirectoryProperty</code> in <a href="#lazy_configuration">Lazy Configuration</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The incremental task action can use <a href="https://docs.gradle.org/8.9/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges:getFileChanges(org.gradle.api.file.FileCollection)"><code>InputChanges.getFileChanges()</code></a> to find out what files have changed for a given file-based input property, be it of type <code>RegularFileProperty</code>, <code>DirectoryProperty</code> or <code>ConfigurableFileCollection</code>.</p>
</div>
<div class="paragraph">
<p>The method returns an <code>Iterable</code> of type <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/work/FileChange.html">FileChanges</a>, which in turn can be queried for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/work/FileChange.html#getFile--">affected file</a></p>
</li>
<li>
<p>the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/work/FileChange.html#getChangeType--">change type</a> (<code>ADDED</code>, <code>REMOVED</code> or <code>MODIFIED</code>)</p>
</li>
<li>
<p>the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/work/FileChange.html#getNormalizedPath--">normalized path</a> of the changed file</p>
</li>
<li>
<p>the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/work/FileChange.html#getFileType--">file type</a> of the changed file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example demonstrates an incremental task that has a directory input.
It assumes that the directory contains a collection of text files and copies them to an output directory, reversing the text within each file:</p>
</div>
<div id="taskDefinition" class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class IncrementalReverseTask : DefaultTask() {
    @get:Incremental
    @get:PathSensitive(PathSensitivity.NAME_ONLY)
    @get:InputDirectory
    abstract val inputDir: DirectoryProperty

    @get:OutputDirectory
    abstract val outputDir: DirectoryProperty

    @get:Input
    abstract val inputProperty: Property&lt;String&gt;

    @TaskAction
    fun execute(inputChanges: InputChanges) {
        println(
            if (inputChanges.isIncremental) &quot;Executing incrementally&quot;
            else &quot;Executing non-incrementally&quot;
        )

        inputChanges.getFileChanges(inputDir).forEach { change -&gt;
            if (change.fileType == FileType.DIRECTORY) return@forEach

            println(&quot;${change.changeType}: ${change.normalizedPath}&quot;)
            val targetFile = outputDir.file(change.normalizedPath).get().asFile
            if (change.changeType == ChangeType.REMOVED) {
                targetFile.delete()
            } else {
                targetFile.writeText(change.file.readText().reversed())
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">IncrementalReverseTask</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@Incremental</span>
    <span class="annotation">@PathSensitive</span>(PathSensitivity.NAME_ONLY)
    <span class="annotation">@InputDirectory</span>
    <span class="directive">abstract</span> DirectoryProperty getInputDir()

    <span class="annotation">@OutputDirectory</span>
    <span class="directive">abstract</span> DirectoryProperty getOutputDir()

    <span class="annotation">@Input</span>
    <span class="directive">abstract</span> Property&lt;<span class="predefined-type">String</span>&gt; getInputProperty()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> execute(InputChanges inputChanges) {
        println(inputChanges.incremental
            ? <span class="string"><span class="delimiter">'</span><span class="content">Executing incrementally</span><span class="delimiter">'</span></span>
            : <span class="string"><span class="delimiter">'</span><span class="content">Executing non-incrementally</span><span class="delimiter">'</span></span>
        )

        inputChanges.getFileChanges(inputDir).each { change -&gt;
            <span class="keyword">if</span> (change.fileType == FileType.DIRECTORY) <span class="keyword">return</span>

            println <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>change.changeType<span class="inline-delimiter">}</span></span><span class="content">: </span><span class="inline"><span class="inline-delimiter">${</span>change.normalizedPath<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
            <span class="keyword">def</span> targetFile = outputDir.file(change.normalizedPath).get().asFile
            <span class="keyword">if</span> (change.changeType == ChangeType.REMOVED) {
                targetFile.delete()
            } <span class="keyword">else</span> {
                targetFile.text = change.file.text.reverse()
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The type of the <code>inputDir</code> property, its annotations, and the <code>execute()</code> action use <code>getFileChanges()</code> to process the subset of files that have changed since the last build.
The action deletes a target file if the corresponding input file has been removed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If, for some reason, the task is executed non-incrementally (by running with <code>--rerun-tasks</code>, for example), all files are reported as <code>ADDED</code>, irrespective of the previous state.
In this case, Gradle automatically removes the previous outputs, so the incremental task must only process the given files.</p>
</div>
<div class="paragraph">
<p>For a simple transformer task like the above example, the task action must generate output files for any out-of-date inputs and delete output files for any removed inputs.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
A task may only contain a single incremental task action.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:which_inputs_are_considered_out_of_date"><a class="anchor" href="#sec:which_inputs_are_considered_out_of_date"></a><a class="link" href="#sec:which_inputs_are_considered_out_of_date">Which inputs are considered out of date?</a></h5>
<div class="paragraph">
<p>When a task has been previously executed, and the only changes since that execution are to incremental input file properties, Gradle can intelligently determine which input files need to be processed, a concept known as incremental execution.</p>
</div>
<div class="paragraph">
<p>In this scenario, the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges:getFileChanges(org.gradle.api.file.FileCollection)"><code>InputChanges.getFileChanges()</code></a> method, available in the <code>org.gradle.work.InputChanges</code> class, provides details for all input files associated with the given property that have been <code>ADDED</code>, <code>REMOVED</code> or <code>MODIFIED</code>.</p>
</div>
<div class="paragraph">
<p>However, there are many cases where Gradle cannot determine which input files need to be processed (i.e., non-incremental execution). Examples include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is no history available from a previous execution.</p>
</li>
<li>
<p>You are building with a different version of Gradle.
Currently, Gradle does not use task history from a different version.</p>
</li>
<li>
<p>An <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskOutputs.html#upToDateWhen-groovy.lang.Closure-"><code>upToDateWhen</code></a> criterion added to the task returns <code>false</code>.</p>
</li>
<li>
<p>An input property has changed since the previous execution.</p>
</li>
<li>
<p>A non-incremental input file property has changed since the previous execution.</p>
</li>
<li>
<p>One or more output files have changed since the previous execution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In these cases, Gradle will report all input files as <code>ADDED</code>, and the <code>getFileChanges()</code> method will return details for all the files that comprise the given input property.</p>
</div>
<div class="paragraph">
<p>You can check if the task execution is incremental or not with the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges.html##org.gradle.work.InputChanges:incremental"><code>InputChanges.isIncremental()</code></a> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:an_incremental_task_in_action"><a class="anchor" href="#sec:an_incremental_task_in_action"></a><a class="link" href="#sec:an_incremental_task_in_action">An incremental task in action</a></h5>
<div class="paragraph">
<p>Consider an instance of <code>IncrementalReverseTask</code> executed against a set of inputs for the first time.</p>
</div>
<div class="paragraph">
<p>In this case, all inputs will be considered <code>ADDED</code>, as shown here:</p>
</div>
<div id="ex:incremental_task_definition" class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;IncrementalReverseTask&gt;(&quot;incrementalReverse&quot;) {
    inputDir = file(&quot;inputs&quot;)
    outputDir = layout.buildDirectory.dir(&quot;outputs&quot;)
    inputProperty = project.findProperty(&quot;taskInputProperty&quot;) as String? ?: &quot;original&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">incrementalReverse</span><span class="delimiter">'</span></span>, IncrementalReverseTask) {
    inputDir = file(<span class="string"><span class="delimiter">'</span><span class="content">inputs</span><span class="delimiter">'</span></span>)
    outputDir = layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">outputs</span><span class="delimiter">&quot;</span></span>)
    inputProperty = project.properties[<span class="string"><span class="delimiter">'</span><span class="content">taskInputProperty</span><span class="delimiter">'</span></span>] ?: <span class="string"><span class="delimiter">'</span><span class="content">original</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The build layout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">.
├── build.gradle
└── inputs
    ├── 1.txt
    ├── 2.txt
    └── 3.txt</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ gradle -q incrementalReverse
Executing non-incrementally
ADDED: 1.txt
ADDED: 2.txt
ADDED: 3.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Naturally, when the task is executed again with no changes, then the entire task is <code>UP-TO-DATE</code>, and the task action is not executed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ gradle incrementalReverse
&gt; Task :incrementalReverse UP-TO-DATE

BUILD SUCCESSFUL in 0s
1 actionable task: 1 up-to-date</code></pre>
</div>
</div>
<div class="paragraph">
<p>When an input file is modified in some way or a new input file is added, then re-executing the task results in those files being returned by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges:getFileChanges(org.gradle.api.file.FileCollection)"><code>InputChanges.getFileChanges()</code></a>.</p>
</div>
<div class="paragraph">
<p>The following example modifies the content of one file and adds another before running the incremental task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;updateInputs&quot;) {
    val inputsDir = layout.projectDirectory.dir(&quot;inputs&quot;)
    outputs.dir(inputsDir)
    doLast {
        inputsDir.file(&quot;1.txt&quot;).asFile.writeText(&quot;Changed content for existing file 1.&quot;)
        inputsDir.file(&quot;4.txt&quot;).asFile.writeText(&quot;Content for new file 4.&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">updateInputs</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> inputsDir = layout.projectDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">inputs</span><span class="delimiter">'</span></span>)
    outputs.dir(inputsDir)
    doLast {
        inputsDir.file(<span class="string"><span class="delimiter">'</span><span class="content">1.txt</span><span class="delimiter">'</span></span>).asFile.text = <span class="string"><span class="delimiter">'</span><span class="content">Changed content for existing file 1.</span><span class="delimiter">'</span></span>
        inputsDir.file(<span class="string"><span class="delimiter">'</span><span class="content">4.txt</span><span class="delimiter">'</span></span>).asFile.text = <span class="string"><span class="delimiter">'</span><span class="content">Content for new file 4.</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q updateInputs incrementalReverse
Executing incrementally
MODIFIED: 1.txt
ADDED: 4.txt</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The various mutation tasks (<code>updateInputs</code>, <code>removeInput</code>, etc) are only present to demonstrate the behavior of incremental tasks.
They should not be viewed as the kinds of tasks or task implementations you should have in your own build scripts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When an existing input file is removed, then re-executing the task results in that file being returned by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges:getFileChanges(org.gradle.api.file.FileCollection)"><code>InputChanges.getFileChanges()</code></a> as <code>REMOVED</code>.</p>
</div>
<div class="paragraph">
<p>The following example removes one of the existing files before executing the incremental task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Delete&gt;(&quot;removeInput&quot;) {
    delete(&quot;inputs/3.txt&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">removeInput</span><span class="delimiter">'</span></span>, Delete) {
    delete <span class="string"><span class="delimiter">'</span><span class="content">inputs/3.txt</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q removeInput incrementalReverse
Executing incrementally
REMOVED: 3.txt</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle cannot determine which input files are out-of-date when an <em>output</em> file is deleted (or modified).
In this case, details for <em>all</em> the input files for the given property are returned by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges:getFileChanges(org.gradle.api.file.FileCollection)"><code>InputChanges.getFileChanges()</code></a>.</p>
</div>
<div class="paragraph">
<p>The following example removes one of the output files from the build directory.
However, all the input files are considered to be <code>ADDED</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Delete&gt;(&quot;removeOutput&quot;) {
    delete(layout.buildDirectory.file(&quot;outputs/1.txt&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">removeOutput</span><span class="delimiter">'</span></span>, Delete) {
    delete layout.buildDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">outputs/1.txt</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q removeOutput incrementalReverse
Executing non-incrementally
ADDED: 1.txt
ADDED: 2.txt
ADDED: 3.txt</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The last scenario we want to cover concerns what happens when a non-file-based input property is modified.
In such cases, Gradle cannot determine how the property impacts the task outputs, so the task is executed non-incrementally.
This means that <em>all</em> input files for the given property are returned by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges:getFileChanges(org.gradle.api.file.FileCollection)"><code>InputChanges.getFileChanges()</code></a> and they are all treated as <code>ADDED</code>.</p>
</div>
<div class="paragraph">
<p>The following example sets the project property <code>taskInputProperty</code> to a new value when running the <code>incrementalReverse</code> task.
That project property is used to initialize the task&#8217;s <code>inputProperty</code> property, as you can see in the <a href="#ex:incremental_task_definition">first example of this section</a>.</p>
</div>
<div class="paragraph">
<p>Here is the expected output in this case:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>$ gradle -q -PtaskInputProperty=changed incrementalReverse
Executing non-incrementally
ADDED: 1.txt
ADDED: 2.txt
ADDED: 3.txt</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:declaring_and_using_command_line_options"><a class="anchor" href="#sec:declaring_and_using_command_line_options"></a><a class="link" href="#sec:declaring_and_using_command_line_options">Command Line options</a></h4>
<div class="paragraph">
<p>Sometimes, a user wants to declare the value of an exposed task property on the command line instead of the build script.
Passing property values on the command line is particularly helpful if they change more frequently.</p>
</div>
<div class="paragraph">
<p>The task API supports a mechanism for marking a property to automatically generate a corresponding command line parameter with a specific name at runtime.</p>
</div>
<div class="sect4">
<h5 id="sec:declaring_task_option"><a class="anchor" href="#sec:declaring_task_option"></a><a class="link" href="#sec:declaring_task_option">Step 1. Declare a command-line option</a></h5>
<div class="paragraph">
<p>To expose a new command line option for a task property, annotate the corresponding setter method of a property with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/options/Option.html">Option</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>@Option(option = &quot;flag&quot;, description = &quot;Sets the flag&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>An option requires a mandatory identifier.
You can provide an optional description.</p>
</div>
<div class="paragraph">
<p>A task can expose as many command line options as properties available in the class.</p>
</div>
<div class="paragraph">
<p>Options may be declared in superinterfaces of the task class as well.
If multiple interfaces declare the same property but with different option flags, they will both work to set the property.</p>
</div>
<div class="paragraph">
<p>In the example below, the custom task <code>UrlVerify</code> verifies whether a URL can be resolved by making an HTTP call and checking the response code. The URL to be verified is configurable through the property <code>url</code>.
The setter method for the property is annotated with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/options/Option.html">@Option</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">UrlVerify.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.tasks.options.Option</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">UrlVerify</span> <span class="directive">extends</span> DefaultTask {
    <span class="directive">private</span> <span class="predefined-type">String</span> url;

    <span class="annotation">@Option</span>(option = <span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>, description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Configures the URL to be verified.</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setUrl(<span class="predefined-type">String</span> url) {
        <span class="local-variable">this</span>.url = url;
    }

    <span class="annotation">@Input</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getUrl() {
        <span class="keyword">return</span> url;
    }

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> verify() {
        getLogger().quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Verifying URL '{}'</span><span class="delimiter">&quot;</span></span>, url);

        <span class="comment">// verify URL by making a HTTP call</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All options declared for a task can be <a href="#sec:listing_task_options">rendered as console output</a> by running the <code>help</code> task and the <code>--task</code> option.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:using_task_option_command_line"><a class="anchor" href="#sec:using_task_option_command_line"></a><a class="link" href="#sec:using_task_option_command_line">Step 2. Use an option on the command line</a></h5>
<div class="paragraph">
<p>There are a few rules for options on the command line:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The option uses a double-dash as a prefix, e.g., <code>--url</code>.
A single dash does not qualify as valid syntax for a task option.</p>
</li>
<li>
<p>The option argument follows directly after the task declaration, e.g., <code>verifyUrl --url=http://www.google.com/</code>.</p>
</li>
<li>
<p>Multiple task options can be declared in any order on the command line following the task name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Building upon the earlier example, the build script creates a task instance of type <code>UrlVerify</code> and provides a value from the command line through the exposed option:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;UrlVerify&gt;(&quot;verifyUrl&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">verifyUrl</span><span class="delimiter">'</span></span>, UrlVerify)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q verifyUrl --url=http://www.google.com/
Verifying URL 'http://www.google.com/'</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:supported_task_option_data_types"><a class="anchor" href="#sec:supported_task_option_data_types"></a><a class="link" href="#sec:supported_task_option_data_types">Supported data types for options</a></h5>
<div class="paragraph">
<p>Gradle limits the data types that can be used for declaring command line options.</p>
</div>
<div class="paragraph">
<p>The use of the command line differs per type:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>boolean</code>, <code>Boolean</code>, <code>Property&lt;Boolean&gt;</code></dt>
<dd>
<p>Describes an option with the value <code>true</code> or <code>false</code>.<br>
Passing the option on the command line treats the value as <code>true</code>.
For example, <code>--foo</code> equates to <code>true</code>.<br>
The absence of the option uses the default value of the property.
For each boolean option, an opposite option is created automatically.
For example, <code>--no-foo</code> is created for the provided option <code>--foo</code> and <code>--bar</code> is created for <code>--no-bar</code>.
Options whose name starts with <code>--no</code> are disabled options and set the option value to <code>false</code>.
An opposite option is only created if no option with the same name already exists for the task.</p>
</dd>
<dt class="hdlist1"><code>Double</code>, <code>Property&lt;Double&gt;</code></dt>
<dd>
<p>Describes an option with a double value.<br>
Passing the option on the command line also requires a value, e.g., <code>--factor=2.2</code> or <code>--factor 2.2</code>.</p>
</dd>
<dt class="hdlist1"><code>Integer</code>, <code>Property&lt;Integer&gt;</code></dt>
<dd>
<p>Describes an option with an integer value.<br>
Passing the option on the command line also requires a value, e.g., <code>--network-timeout=5000</code> or <code>--network-timeout 5000</code>.</p>
</dd>
<dt class="hdlist1"><code>Long</code>, <code>Property&lt;Long&gt;</code></dt>
<dd>
<p>Describes an option with a long value.<br>
Passing the option on the command line also requires a value, e.g., <code>--threshold=2147483648</code> or <code>--threshold 2147483648</code>.</p>
</dd>
<dt class="hdlist1"><code>String</code>, <code>Property&lt;String&gt;</code></dt>
<dd>
<p>Describes an option with an arbitrary String value.<br>
Passing the option on the command line also requires a value, e.g., <code>--container-id=2x94held</code> or <code>--container-id 2x94held</code>.</p>
</dd>
<dt class="hdlist1"><code>enum</code>, <code>Property&lt;enum&gt;</code></dt>
<dd>
<p>Describes an option as an enumerated type.<br>
Passing the option on the command line also requires a value e.g., <code>--log-level=DEBUG</code> or <code>--log-level debug</code>.<br>
The value is not case-sensitive.</p>
</dd>
<dt class="hdlist1"><code>List&lt;T&gt;</code> where <code>T</code> is <code>Double</code>, <code>Integer</code>, <code>Long</code>, <code>String</code>, <code>enum</code></dt>
<dd>
<p>Describes an option that can take multiple values of a given type.<br>
The values for the option have to be provided as multiple declarations, e.g., <code>--image-id=123 --image-id=456</code>.<br>
Other notations, such as comma-separated lists or multiple values separated by a space character, are currently not supported.</p>
</dd>
<dt class="hdlist1"><code>ListProperty&lt;T&gt;</code>, <code>SetProperty&lt;T&gt;</code> where <code>T</code> is <code>Double</code>, <code>Integer</code>, <code>Long</code>, <code>String</code>, <code>enum</code></dt>
<dd>
<p>Describes an option that can take multiple values of a given type.<br>
The values for the option have to be provided as multiple declarations, e.g., <code>--image-id=123 --image-id=456</code>.<br>
Other notations, such as comma-separated lists or multiple values separated by a space character, are currently not supported.</p>
</dd>
<dt class="hdlist1"><code>DirectoryProperty</code>, <code>RegularFileProperty</code></dt>
<dd>
<p>Describes an option with a file system element.<br>
Passing the option on the command line also requires a value representing a path, e.g., <code>--output-file=file.txt</code> or <code>--output-dir outputDir</code>.<br>
Relative paths are resolved relative to the project directory of the project that owns this property instance.
See <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileSystemLocationProperty.html#set-java.io.File"><code>FileSystemLocationProperty.set()</code></a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sec:documenting_available_task_option_values"><a class="anchor" href="#sec:documenting_available_task_option_values"></a><a class="link" href="#sec:documenting_available_task_option_values">Documenting available values for an option</a></h5>
<div class="paragraph">
<p>Theoretically, an option for a property type <code>String</code> or <code>List&lt;String&gt;</code> can accept any arbitrary value.
Accepted values for such an option can be documented programmatically with the help of the annotation <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/options/OptionValues.html">OptionValues</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>@OptionValues('file')</code></pre>
</div>
</div>
<div class="paragraph">
<p>This annotation may be assigned to any method that returns a <code>List</code> of one of the supported data types.
You need to specify an option identifier to indicate the relationship between the option and available values.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Passing a value on the command line not supported by the option does not fail the build or throw an exception. You must implement custom logic for such behavior in the task action.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example below demonstrates the use of multiple options for a single task.
The task implementation provides a list of available values for the option <code>output-type</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">UrlProcess.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.tasks.options.Option</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.options.OptionValues</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">UrlProcess</span> <span class="directive">extends</span> DefaultTask {
    <span class="directive">private</span> <span class="predefined-type">String</span> url;
    <span class="directive">private</span> OutputType outputType;

    <span class="annotation">@Input</span>
    <span class="annotation">@Option</span>(option = <span class="string"><span class="delimiter">&quot;</span><span class="content">http</span><span class="delimiter">&quot;</span></span>, description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Configures the http protocol to be allowed.</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="directive">abstract</span> Property&lt;<span class="predefined-type">Boolean</span>&gt; getHttp();

    <span class="annotation">@Option</span>(option = <span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>, description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Configures the URL to send the request to.</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setUrl(<span class="predefined-type">String</span> url) {
        <span class="keyword">if</span> (!getHttp().getOrElse(<span class="predefined-constant">true</span>) &amp;&amp; url.startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://</span><span class="delimiter">&quot;</span></span>)) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP is not allowed</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">else</span> {
            <span class="local-variable">this</span>.url = url;
        }
    }

    <span class="annotation">@Input</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getUrl() {
        <span class="keyword">return</span> url;
    }

    <span class="annotation">@Option</span>(option = <span class="string"><span class="delimiter">&quot;</span><span class="content">output-type</span><span class="delimiter">&quot;</span></span>, description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Configures the output type.</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setOutputType(OutputType outputType) {
        <span class="local-variable">this</span>.outputType = outputType;
    }

    <span class="annotation">@OptionValues</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">output-type</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;OutputType&gt; getAvailableOutputTypes() {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;OutputType&gt;(<span class="predefined-type">Arrays</span>.asList(OutputType.values()));
    }

    <span class="annotation">@Input</span>
    <span class="directive">public</span> OutputType getOutputType() {
        <span class="keyword">return</span> outputType;
    }

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> process() {
        getLogger().quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Writing out the URL response from '{}' to '{}'</span><span class="delimiter">&quot;</span></span>, url, outputType);

        <span class="comment">// retrieve content from URL and write to output</span>
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">enum</span> OutputType {
        CONSOLE, FILE
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:listing_task_options"><a class="anchor" href="#sec:listing_task_options"></a><a class="link" href="#sec:listing_task_options">Listing command line options</a></h5>
<div class="paragraph">
<p>Command line options using the annotations <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/options/Option.html">Option</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/options/OptionValues.html">OptionValues</a> are self-documenting.</p>
</div>
<div class="paragraph">
<p>You will see <a href="#sec:declaring_task_option">declared options</a> and their <a href="#sec:documenting_available_task_option_values">available values</a> reflected in the console output of the <code>help</code> task.
The output renders options alphabetically, except for boolean disable options, which appear following the enable option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q help --task processUrl
Detailed task information for processUrl

Path
     :processUrl

Type
     UrlProcess (UrlProcess)

Options
     --http     Configures the http protocol to be allowed.

     --no-http     Disables option --http.

     --output-type     Configures the output type.
                       Available values are:
                            CONSOLE
                            FILE

     --url     Configures the URL to send the request to.

     --rerun     Causes the task to be re-run even if up-to-date.

Description
     -

Group
     -</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="limitations"><a class="anchor" href="#limitations"></a><a class="link" href="#limitations">Limitations</a></h5>
<div class="paragraph">
<p>Support for declaring command line options currently comes with a few limitations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Command line options can only be declared for custom tasks via annotation.
There&#8217;s no programmatic equivalent for defining options.</p>
</li>
<li>
<p>Options cannot be declared globally, e.g., on a project level or as part of a plugin.</p>
</li>
<li>
<p>When assigning an option on the command line, the task exposing the option needs to be spelled out explicitly, e.g., <code>gradle check --tests abc</code> does not work even though the <code>check</code> task depends on the <code>test</code> task.</p>
</li>
<li>
<p>If you specify a task option name that conflicts with the name of a built-in Gradle option, use the <code>--</code> delimiter before calling your task to reference that option.
For more information, see <a href="#sec:disambiguate_task_options_from_built_in_options">Disambiguate Task Options from Built-in Options</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="verification_failures"><a class="anchor" href="#verification_failures"></a><a class="link" href="#verification_failures">Verification failures</a></h4>
<div class="paragraph">
<p>Normally, exceptions thrown during task execution result in a failure that immediately terminates a build.
The outcome of the task will be <code>FAILED</code>, the result of the build will be <code>FAILED</code>, and no further tasks will be executed.
When <a href="#sec:continue_build_on_failure">running with the <code>--continue</code> flag</a>, Gradle will continue to run other requested tasks in the build after encountering a task failure.
However, any tasks that depend on a failed task will not be executed.</p>
</div>
<div class="paragraph">
<p>There is a special type of exception that behaves differently when downstream tasks only rely on the outputs of a failing task.
A task can throw a subtype of <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/VerificationException.html">VerificationException</a> to indicate that it has failed in a controlled manner such that its output is still valid for consumers.
A task depends on the <strong>outcome</strong> of another task when it directly depends on it using <code>dependsOn</code>.
When Gradle is run with <code>--continue</code>, consumer tasks that depend on a producer task&#8217;s output (via a relationship between task inputs and outputs) can still run after the producer fails.</p>
</div>
<div class="paragraph">
<p>A failed unit test, for instance, will cause a failing outcome for the test task.
However, this doesn&#8217;t prevent another task from reading and processing the (valid) test results the task produced.
Verification failures are used in exactly this manner by the <a href="test_report_aggregation_plugin.html#test_report_aggregation_plugin"><code>Test Report Aggregation Plugin</code></a>.</p>
</div>
<div class="paragraph">
<p>Verification failures are also useful for tasks that need to report a failure even after producing useful output consumable by other tasks.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val process = tasks.register(&quot;process&quot;) {
    val outputFile = layout.buildDirectory.file(&quot;processed.log&quot;)
    outputs.files(outputFile) // <b class="conum">(1)</b>

    doLast {
        val logFile = outputFile.get().asFile
        logFile.appendText(&quot;Step 1 Complete.&quot;) // <b class="conum">(2)</b>
        throw VerificationException(&quot;Process failed!&quot;) // <b class="conum">(3)</b>
        logFile.appendText(&quot;Step 2 Complete.&quot;) // <b class="conum">(4)</b>
    }
}

tasks.register(&quot;postProcess&quot;) {
    inputs.files(process) // <b class="conum">(5)</b>

    doLast {
        println(&quot;Results: ${inputs.files.singleFile.readText()}&quot;) // <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>) {
    <span class="keyword">def</span> outputFile = layout.buildDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">processed.log</span><span class="delimiter">&quot;</span></span>)
    outputs.files(outputFile) // <b class="conum">(1)</b>

    doLast {
        <span class="keyword">def</span> logFile = outputFile.get().asFile
        logFile &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Step 1 Complete.</span><span class="delimiter">&quot;</span></span> // <b class="conum">(2)</b>
        <span class="keyword">throw</span> <span class="keyword">new</span> VerificationException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Process failed!</span><span class="delimiter">&quot;</span></span>) // <b class="conum">(3)</b>
        logFile &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Step 2 Complete.</span><span class="delimiter">&quot;</span></span> // <b class="conum">(4)</b>
    }
}

tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">postProcess</span><span class="delimiter">&quot;</span></span>) {
    inputs.files(tasks.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>)) // <b class="conum">(5)</b>

    doLast {
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Results: </span><span class="inline"><span class="inline-delimiter">${</span>inputs.files.singleFile.text<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>) // <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle postProcess --continue
&gt; Task :process FAILED

&gt; Task :postProcess
Results: Step 1 Complete.
2 actionable tasks: 2 executed

FAILURE: Build failed with an exception.</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><strong>Register Output</strong>: The <code>process</code> task writes its output to a log file.</p>
</li>
<li>
<p><strong>Modify Output</strong>: The task writes to its output file as it executes.</p>
</li>
<li>
<p><strong>Task Failure</strong>: The task throws a <code>VerificationException</code> and fails at this point.</p>
</li>
<li>
<p><strong>Continue to Modify Output</strong>: This line never runs due to the exception stopping the task.</p>
</li>
<li>
<p><strong>Consume Output</strong>: The <code>postProcess</code> task depends on the output of the <code>process</code> task due to using that task&#8217;s outputs as its own inputs.</p>
</li>
<li>
<p><strong>Use Partial Result</strong>: With the <code>--continue</code> flag set, Gradle still runs the requested <code>postProcess</code> task despite the <code>process</code> task&#8217;s failure.  <code>postProcess</code> can read and display the partial (though still valid) result.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developing_plugins"><a class="anchor" href="#developing_plugins"></a><a class="link" href="#developing_plugins">DEVELOPING PLUGINS</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="custom_plugins"><a class="anchor" href="#custom_plugins"></a><a class="link" href="#custom_plugins">Understanding Plugins</a></h3>
<div class="paragraph">
<p>Gradle comes with a set of powerful core systems such as dependency management, task execution, and project configuration.
But everything else it can do is supplied by plugins.</p>
</div>
<div class="paragraph">
<p>Plugins encapsulate logic for specific tasks or integrations, such as compiling code, running tests, or deploying artifacts.
By applying plugins, users can easily add new features to their build process without having to write complex code from scratch.</p>
</div>
<div class="paragraph">
<p>This plugin-based approach allows Gradle to be lightweight and modular.
It also promotes code reuse and maintainability, as plugins can be shared across projects or within an organization.</p>
</div>
<div class="paragraph">
<p>Before reading this chapter, it&#8217;s recommended that you first read <a href="#gradle_directories">Learning The Basics</a> and complete the <a href="partr1_gradle_init.html#partr1_gradle_init">Tutorial</a>.</p>
</div>
<div class="sect3">
<h4 id="plugins_introduction"><a class="anchor" href="#plugins_introduction"></a><a class="link" href="#plugins_introduction">Plugins Introduction</a></h4>
<div class="paragraph">
<p>Plugins can be sourced from Gradle or the Gradle community.
But when users want to organize their build logic or need specific build capabilities not provided by existing plugins, they can develop their own.</p>
</div>
<div class="paragraph">
<p>As such, we distinguish between three different kinds of plugins:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Core Plugins</strong> - plugins that come from Gradle.</p>
</li>
<li>
<p><strong>Community Plugins</strong> - plugins that come from <a href="https://plugins.gradle.org/">Gradle Plugin Portal</a> or a public repository.</p>
</li>
<li>
<p><strong>Local or Custom Plugins</strong> - plugins that you develop yourself.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="core_plugins"><a class="anchor" href="#core_plugins"></a><a class="link" href="#core_plugins">Core Plugins</a></h5>
<div class="paragraph">
<p>The term <strong>core plugin</strong> refers to a plugin that is part of the Gradle distribution such as the <a href="#java_library_plugin">Java Library Plugin</a>.
They are always available.</p>
</div>
</div>
<div class="sect4">
<h5 id="community_plugins"><a class="anchor" href="#community_plugins"></a><a class="link" href="#community_plugins">Community Plugins</a></h5>
<div class="paragraph">
<p>The term <strong>community plugin</strong> refers to a plugin published to the Gradle Plugin Portal (or another public repository) such as the <a href="https://plugins.gradle.org/plugin/com.diffplug.gradle.spotless">Spotless Plugin</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="local_or_custom_plugins"><a class="anchor" href="#local_or_custom_plugins"></a><a class="link" href="#local_or_custom_plugins">Local or Custom Plugins</a></h5>
<div class="paragraph">
<p>The term <strong>local or custom plugin</strong> refers to a plugin you write yourself for your own build.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom_plugins_2"><a class="anchor" href="#custom_plugins_2"></a><a class="link" href="#custom_plugins_2">Custom plugins</a></h4>
<div class="paragraph">
<p>There are three types of <strong>custom plugins</strong>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Location:</th>
<th class="tableblock halign-left valign-top">Most likely:</th>
<th class="tableblock halign-left valign-top">Benefit:</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:build_script_plugins">1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:build_script_plugins">Script plugins</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>.gradle(.kts)</code> script file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A local plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plugin is automatically compiled and included in the classpath of the build script.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:precompile_script_plugin">2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:precompile_script_plugin">Precompiled script plugins</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:using_buildsrc"><code>buildSrc</code></a> folder or <a href="#composite_builds">composite</a> build</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A convention plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plugin is automatically compiled, tested, and available on the classpath of the build script. The plugin is visible to every build script used by the build.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:custom_plugins_standalone_project">3</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:custom_plugins_standalone_project">Binary plugins</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standalone project</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A shared plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plugin JAR is produced and published. The plugin can be used in multiple builds and shared with others.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:build_script_plugins"><a class="anchor" href="#sec:build_script_plugins"></a><a class="link" href="#sec:build_script_plugins">Script plugins</a></h4>
<div class="paragraph">
<p><strong>Script plugins</strong> are typically small, local plugins written in script files for tasks specific to a single build or project.
They do not need to be reused across multiple projects.
Script plugins <strong>are not recommended</strong> but many other forms of plugins evolve from script plugins.</p>
</div>
<div class="paragraph">
<p>To create a plugin, you need to write a class that implements the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Plugin.html">Plugin</a> interface.</p>
</div>
<div id="sec:writing_a_simple_plugin" class="paragraph">
<p>The following sample creates a <code>GreetingPlugin</code>, which adds a <code>hello</code> task to a project when applied:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">class GreetingPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        project.task(&quot;hello&quot;) {
            doLast {
                println(&quot;Hello from the GreetingPlugin&quot;)
            }
        }
    }
}

// Apply the plugin
apply&lt;GreetingPlugin&gt;()</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">GreetingPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="type">void</span> apply(Project project) {
        project.task(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
            doLast {
                println <span class="string"><span class="delimiter">'</span><span class="content">Hello from the GreetingPlugin</span><span class="delimiter">'</span></span>
            }
        }
    }
}

<span class="comment">// Apply the plugin</span>
apply <span class="key">plugin</span>: GreetingPlugin</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q hello
Hello from the GreetingPlugin</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Project</code> object is passed as a parameter in <code>apply()</code>, which the plugin can use to configure the project however it needs to (such as adding tasks, configuring dependencies, etc.).
In this example, the plugin is written directly in the build file which is <strong>not a recommended practice</strong>.</p>
</div>
<div class="paragraph">
<p>When the plugin is written in a separate script file, it can be applied using <code>apply(from = "file_name.gradle.kts")</code> or <code>apply from: 'file_name.gradle'</code>.
In the example below, the plugin is coded in the <code>other.gradle(.kts)</code> script file.
Then, the <code>other.gradle(.kts)</code> is applied to <code>build.gradle(.kts)</code> using <code>apply from</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">other.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">class GreetingScriptPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        project.task(&quot;hi&quot;) {
            doLast {
                println(&quot;Hi from the GreetingScriptPlugin&quot;)
            }
        }
    }
}

// Apply the plugin
apply&lt;GreetingScriptPlugin&gt;()</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">other.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">GreetingScriptPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="type">void</span> apply(Project project) {
        project.task(<span class="string"><span class="delimiter">'</span><span class="content">hi</span><span class="delimiter">'</span></span>) {
            doLast {
                println <span class="string"><span class="delimiter">'</span><span class="content">Hi from the GreetingScriptPlugin</span><span class="delimiter">'</span></span>
            }
        }
    }
}

<span class="comment">// Apply the plugin</span>
apply <span class="key">plugin</span>: GreetingScriptPlugin</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(from = &quot;other.gradle.kts&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">from</span>: <span class="string"><span class="delimiter">'</span><span class="content">other.gradle</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q hi
Hi from the GreetingScriptPlugin</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Script plugins should be avoided.</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="sec:precompile_script_plugin"><a class="anchor" href="#sec:precompile_script_plugin"></a><a class="link" href="#sec:precompile_script_plugin">Precompiled script plugins</a></h4>
<div class="paragraph">
<p><strong>Precompiled script plugins</strong> are compiled into class files and packaged into a JAR before they are executed.
These plugins use the Groovy DSL or Kotlin DSL instead of pure Java, Kotlin, or Groovy.
They are best used as <strong>convention plugins</strong> that share build logic across projects or as a way to neatly organize build logic.</p>
</div>
<div class="paragraph">
<p>To create a precompiled script plugin, you can:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use Gradle&#8217;s Kotlin DSL - The plugin is a <code>.gradle.kts</code> file, and apply <code>id("kotlin-dsl")</code>.</p>
</li>
<li>
<p>Use Gradle&#8217;s Groovy DSL - The plugin is a <code>.gradle</code> file, and apply <code>id("groovy-gradle-plugin")</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To apply a precompiled script plugin, you need to know its ID.
The ID is derived from the plugin script&#8217;s filename and its (optional) package declaration.</p>
</div>
<div class="paragraph">
<p>For example, the script <code>src/main/*/some-java-library.gradle(.kts)</code> has a plugin ID of <code>some-java-library</code> (assuming it has no package declaration).
Likewise, <code>src/main/*/my/some-java-library.gradle(.kts)</code> has a plugin ID of <code>my.some-java-library</code> as long as it has a package declaration of <code>my</code>.</p>
</div>
<div class="paragraph">
<p>Precompiled script plugin names have two important limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>They cannot start with <code>org.gradle</code>.</p>
</li>
<li>
<p>They cannot have the same name as a <a href="#plugin_reference">core plugin</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the plugin is applied to a project, Gradle creates an instance of the plugin class and calls the instance&#8217;s <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Plugin.html#apply-T-">Plugin.apply()</a> method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A new instance of a <code>Plugin</code> is created within each project applying that plugin.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s rewrite the <code>GreetingPlugin</code> script plugin as a precompiled script plugin.
Since we are using the Groovy or Kotlin DSL, the file essentially becomes the plugin.
The original script plugin simply created a <code>hello</code> task which printed a greeting, this is what we will do in the pre-compiled script plugin:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/GreetingPlugin.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    doLast {
        println(&quot;Hello from the convention GreetingPlugin&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/GreetingPlugin.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>) {
    doLast {
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello from the convention GreetingPlugin</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>GreetingPlugin</code> can now be applied in other subprojects' builds by using its ID:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    application
    id(&quot;GreetingPlugin&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">application</span><span class="delimiter">'</span></span>
    id(<span class="string"><span class="delimiter">'</span><span class="content">GreetingPlugin</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q hello
Hello from the convention GreetingPlugin</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:convention_plugins"><a class="anchor" href="#sec:convention_plugins"></a><a class="link" href="#sec:convention_plugins">Convention plugins</a></h4>
<div class="paragraph">
<p>A <strong>convention plugin</strong> is typically a precompiled script plugin that configures existing core and community plugins with your own conventions (i.e. default values) such as setting the Java version by using <code>java.toolchain.languageVersion = JavaLanguageVersion.of(17)</code>.
Convention plugins are also used to enforce project standards and help streamline the build process.
They can apply and configure plugins, create new tasks and extensions, set dependencies, and much more.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take an example build with three subprojects: one for <code>data-model</code>, one for <code>database-logic</code> and one for <code>app</code> code.
The project has the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">.
├── buildSrc
│   ├── src
│   │   └──...
│   └── build.gradle.kts
├── data-model
│   ├── src
│   │   └──...
│   └── build.gradle.kts
├── database-logic
│   ├── src
│   │   └──...
│   └── build.gradle.kts
├── app
│   ├── src
│   │   └──...
│   └── build.gradle.kts
└── settings.gradle.kts</code></pre>
</div>
</div>
<div class="paragraph">
<p>The build file of the <code>database-logic</code> subproject is as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">database-logic/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;java-library&quot;)
    id(&quot;org.jetbrains.kotlin.jvm&quot;) version &quot;1.9.23&quot;
}

repositories {
    mavenCentral()
}

java {
    toolchain.languageVersion.set(JavaLanguageVersion.of(11))
}

tasks.test {
    useJUnitPlatform()
}

kotlin {
    jvmToolchain(11)
}

// More build logic</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">database-logic/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">org.jetbrains.kotlin.jvm</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">1.9.23</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
}

java {
    toolchain.languageVersion.set(JavaLanguageVersion.of(<span class="integer">11</span>))
}

tasks.test {
    useJUnitPlatform()
}

kotlin {
    jvmToolchain {
        languageVersion.set(JavaLanguageVersion.of(<span class="integer">11</span>))
    }
}

<span class="comment">// More build logic</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We apply the <code>java-library</code> plugin and add the <code>org.jetbrains.kotlin.jvm</code> plugin for Kotlin support.
We also configure Kotlin, Java, tests and more.</p>
</div>
<div class="paragraph">
<p>Our build file is beginning to grow&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>The more plugins we apply and the more plugins we configure, the larger it gets.
There&#8217;s also repetition in the build files of the <code>app</code> and <code>data-model</code> subprojects, especially when configuring common extensions like setting the Java version and Kotlin support.</p>
</div>
<div class="paragraph">
<p>To address this, we use convention plugins.
This allows us to avoid repeating configuration in each build file and keeps our build scripts more concise and maintainable.
In convention plugins, we can encapsulate arbitrary build configuration or custom build logic.</p>
</div>
<div class="paragraph">
<p>To develop a convention plugin, we recommend using <a href="#sec:using_buildsrc"><code>buildSrc</code></a> – which represents a completely separate Gradle build.
<code>buildSrc</code> has its own settings file to define where dependencies of this build are located.</p>
</div>
<div class="paragraph">
<p>We add a Kotlin script called <code>my-java-library.gradle.kts</code> inside the <code>buildSrc/src/main/kotlin</code> directory.
Or conversely, a Groovy script called <code>my-java-library.gradle</code> inside the <code>buildSrc/src/main/groovy</code> directory.
We put all the plugin application and configuration from the <code>database-logic</code> build file into it:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/my-java-library.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;java-library&quot;)
    id(&quot;org.jetbrains.kotlin.jvm&quot;)
}

repositories {
    mavenCentral()
}

java {
    toolchain.languageVersion.set(JavaLanguageVersion.of(11))
}

tasks.test {
    useJUnitPlatform()
}

kotlin {
    jvmToolchain(11)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/my-java-library.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">org.jetbrains.kotlin.jvm</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
}

java {
    toolchain.languageVersion.set(JavaLanguageVersion.of(<span class="integer">11</span>))
}

tasks.test {
    useJUnitPlatform()
}

kotlin {
    jvmToolchain {
        languageVersion.set(JavaLanguageVersion.of(<span class="integer">11</span>))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The name of the file <code>my-java-library</code> is the ID of our brand-new plugin, which we can now use in all of our subprojects.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Why is the version of <code>id 'org.jetbrains.kotlin.jvm'</code> missing? See <a href="#sec:applying_external_plugins">Applying External Plugins to Pre-Compiled Script Plugins</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>database-logic</code> build file becomes much simpler by removing all the redundant build logic and applying our convention <code>my-java-library</code> plugin instead:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">database-logic/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;my-java-library&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">database-logic/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id(<span class="string"><span class="delimiter">'</span><span class="content">my-java-library</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This convention plugin enables us to easily share common configurations across all our build files.
Any modifications can be made in one place, simplifying maintenance.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:custom_plugins_standalone_project"><a class="anchor" href="#sec:custom_plugins_standalone_project"></a><a class="link" href="#sec:custom_plugins_standalone_project">Binary plugins</a></h4>
<div class="paragraph">
<p><strong>Binary plugins</strong> in Gradle are plugins that are built as standalone JAR files and applied to a project using the <code>plugins{}</code> block in the build script.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s move our <code>GreetingPlugin</code> to a standalone project so that we can publish it and share it with others.
The plugin is essentially moved from the <code>buildSrc</code> folder to its own build called <code>greeting-plugin</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can publish the plugin from <code>buildSrc</code>, but this is not recommended practice. Plugins that are ready for publication should be in their own build.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>greeting-plugin</code> is simply a Java project that produces a JAR containing the plugin classes.</p>
</div>
<div class="paragraph">
<p>The easiest way to package and publish a plugin to a repository is to use the <a href="java_gradle_plugin.html#java_gradle_plugin">Gradle Plugin Development Plugin</a>.
This plugin provides the necessary tasks and configurations (including the plugin metadata) to compile your script into a plugin that can be applied in other builds.</p>
</div>
<div class="paragraph">
<p>Here is a simple build script for the <code>greeting-plugin</code> project using the Gradle Plugin Development Plugin:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-gradle-plugin`
}

gradlePlugin {
    plugins {
        create(&quot;simplePlugin&quot;) {
            id = &quot;org.example.greeting&quot;
            implementationClass = &quot;org.example.GreetingPlugin&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-gradle-plugin</span><span class="delimiter">'</span></span>
}

gradlePlugin {
    plugins {
        simplePlugin {
            id = <span class="string"><span class="delimiter">'</span><span class="content">org.example.greeting</span><span class="delimiter">'</span></span>
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">org.example.GreetingPlugin</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more on publishing plugins, see <a href="#plugin-publishing-plugin">Publishing Plugins</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="project_vs_settings_vs_init_plugins"><a class="anchor" href="#project_vs_settings_vs_init_plugins"></a><a class="link" href="#project_vs_settings_vs_init_plugins">Project vs Settings vs Init plugins</a></h4>
<div class="paragraph">
<p>In the example used through this section, the plugin accepts the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html">Project</a> type as a type parameter.
Alternatively, the plugin can accept a parameter of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.initialization.Settings.html">Settings</a> to be applied in a settings script, or a parameter of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.invocation.Gradle.html">Gradle</a> to be applied in an initialization script.</p>
</div>
<div class="paragraph">
<p>The difference between these types of plugins lies in the scope of their application:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Project Plugin </dt>
<dd>
<p>A project plugin is a plugin that is applied to a specific project in a build.
It can customize the build logic, add tasks, and configure the project-specific settings.</p>
</dd>
<dt class="hdlist1">Settings Plugin </dt>
<dd>
<p>A settings plugin is a plugin that is applied in the <code>settings.gradle</code> or <code>settings.gradle.kts</code> file.
It can configure settings that apply to the entire build, such as defining which projects are included in the build, configuring build script repositories, and applying common configurations to all projects.</p>
</dd>
<dt class="hdlist1">Init Plugin </dt>
<dd>
<p>An init plugin is a plugin that is applied in the <code>init.gradle</code> or <code>init.gradle.kts</code> file.
It can configure settings that apply globally to all Gradle builds on a machine, such as configuring the Gradle version, setting up default repositories, or applying common plugins to all builds.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implemention_plugins"><a class="anchor" href="#implemention_plugins"></a><a class="link" href="#implemention_plugins">Understanding Implementation Options for Plugins</a></h3>
<div class="paragraph">
<p>The choice between script, precompiled script, or binary plugins depends on your specific requirements and preferences.</p>
</div>
<div class="paragraph">
<p><strong>Script Plugins</strong> are simple and easy to write.
They are written in Kotlin DSL or Groovy DSL.
They are suitable for small, one-off tasks or for quick experimentation.
However, they can become hard to maintain as the build script grows in size and complexity.</p>
</div>
<div class="paragraph">
<p><strong>Precompiled Script Plugins</strong> are Kotlin or Groovy DSL scripts compiled into Java class files packaged in a library.
They offer better performance and maintainability compared to script plugins, and they can be reused across different projects.
You can also write them in Groovy DSL but that is not recommended.</p>
</div>
<div class="paragraph">
<p><strong>Binary Plugins</strong> are full-fledged plugins written in Java, Groovy, or Kotlin, compiled into JAR files, and published to a repository.
They offer the best performance, maintainability, and reusability.
They are suitable for complex build logic that needs to be shared across projects, builds, and teams.
You can also write them in Scala or Groovy but that is not recommended.</p>
</div>
<div class="paragraph">
<p>Here is a breakdown of all options for implementing Gradle plugins:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>#</strong></th>
<th class="tableblock halign-left valign-top"><strong>Using:</strong></th>
<th class="tableblock halign-left valign-top"><strong>Type:</strong></th>
<th class="tableblock halign-left valign-top"><strong>The Plugin is:</strong></th>
<th class="tableblock halign-left valign-top"><strong>Recommended?</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kotlin DSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">in a <code>.gradle.kts</code> file as an abstract class that implements the <code>apply(Project project)</code> method of the <code>Plugin&lt;Project&gt;</code> interface.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No<sup class="footnote" id="_footnote_1">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Groovy DSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">in a <code>.gradle</code> file as an abstract class that implements the <code>apply(Project project)</code> method of the <code>Plugin&lt;Project&gt;</code> interface.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kotlin DSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pre-compiled script plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a <code>.gradle.kts</code> file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Groovy DSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pre-compiled script plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a <code>.gradle</code> file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ok<sup class="footnote" id="_footnote_2">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an abstract class that implements the <code>apply(Project project)</code> method of the <code>Plugin&lt;Project&gt;</code> interface in Java.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kotlin / Kotlin DSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an abstract class that implements the <code>apply(Project project)</code> method of the <code>Plugin&lt;Project&gt;</code> interface in Kotlin and/or Kotlin DSL.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Groovy / Groovy DSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an abstract class that implements the <code>apply(Project project)</code> method of the <code>Plugin&lt;Project&gt;</code> interface in Groovy and/or Groovy DSL.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ok<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scala</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an abstract class that implements the <code>apply(Project project)</code> method of the <code>Plugin&lt;Project&gt;</code> interface in Scala.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you suspect issues with your plugin code, try creating a <a href="https://scans.gradle.com/">Build Scan</a> to identify bottlenecks.
The <a href="https://github.com/gradle/gradle-profiler">Gradle profiler</a> can help automate Build Scan generation and gather more low-level information.</p>
</div>
</div>
<div class="sect2">
<h3 id="implemention_precompiled_plugins"><a class="anchor" href="#implemention_precompiled_plugins"></a><a class="link" href="#implemention_precompiled_plugins">Implementing Pre-compiled Script Plugins</a></h3>
<div class="paragraph">
<p>A <strong>precompiled script plugin</strong> is typically a Kotlin script that has been compiled and distributed as Java class files packaged in a library.
These scripts are intended to be consumed as binary Gradle plugins and are recommended for use as convention plugins.</p>
</div>
<div class="paragraph">
<p>A <strong>convention plugin</strong> is a plugin that normaly configures existing core and community plugins with your own conventions (i.e. default values) such as setting the Java version by using <code>java.toolchain.languageVersion = JavaLanguageVersion.of(17)</code>.
Convention plugins are also used to enforce project standards and help streamline the build process.
They can apply and configure plugins, create new tasks and extensions, set dependencies, and much more.</p>
</div>
<div class="sect3">
<h4 id="sec:the_plugin_id"><a class="anchor" href="#sec:the_plugin_id"></a><a class="link" href="#sec:the_plugin_id">Setting the plugin ID</a></h4>
<div class="paragraph">
<p>The plugin ID for a precompiled script is derived from its file name and optional package declaration.</p>
</div>
<div class="paragraph">
<p>For example, a script named <code>code-quality.gradle(.kts)</code> located in <code>src/main/groovy</code> (or <code>src/main/kotlin</code>) without a package declaration would be exposed as the <code>code-quality</code> plugin:</p>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;kotlin-dsl&quot;)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;code-quality&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy-gradle-plugin</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">code-quality</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>On the other hand, a script named <code>code-quality.gradle(.kts)</code> located in <code>src/main/groovy/my</code> (or <code>src/main/kotlin/my</code>) with the package declaration <code>my</code> would be exposed as the <code>my.code-quality</code> plugin:</p>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;kotlin-dsl&quot;)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;my.code-quality&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy-gradle-plugin</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">my.code-quality</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:getting_input_from_the_build"><a class="anchor" href="#sec:getting_input_from_the_build"></a><a class="link" href="#sec:getting_input_from_the_build">Making a plugin configurable using extensions</a></h4>
<div class="paragraph">
<p><strong>Extension objects</strong> are commonly used in plugins to expose configuration options and additional functionality to build scripts.</p>
</div>
<div class="paragraph">
<p>When you apply a plugin that defines an extension, you can access the extension object and configure its properties or call its methods to customize the behavior of the plugin or tasks provided by the plugin.</p>
</div>
<div class="paragraph">
<p>A <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html">Project</a> has an associated <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/plugins/ExtensionContainer.html">ExtensionContainer</a> object that contains all the settings and properties for the plugins that have been applied to the project.
You can provide configuration for your plugin by adding an extension object to this container.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s update our <code>greetings</code> example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/greetings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Create extension object
interface GreetingPluginExtension {
    val message: Property&lt;String&gt;
}

// Add the 'greeting' extension object to project
val extension = project.extensions.create&lt;GreetingPluginExtension&gt;(&quot;greeting&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/greetings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Create extension object</span>
<span class="type">interface</span> GreetingPluginExtension {
    Property&lt;<span class="predefined-type">String</span>&gt; getMessage()
}

<span class="comment">// Add the 'greeting' extension object to project</span>
<span class="keyword">def</span> extension = project.extensions.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>, GreetingPluginExtension)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can set the value of the <code>message</code> property directly with <code>extension.message.set("Hi from Gradle,")</code>.</p>
</div>
<div class="paragraph">
<p>However, the <code>GreetingPluginExtension</code> object becomes available as a project property with the same name as the extension object.
You can now access <code>message</code> like so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/greetings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Where the&lt;GreetingPluginExtension&gt;() is equivalent to project.extensions.getByType(GreetingPluginExtension::class.java)
the&lt;GreetingPluginExtension&gt;().message.set(&quot;Hi from Gradle&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/greetings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">extensions.findByType(GreetingPluginExtension).message.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hi from Gradle</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you apply the <code>greetings</code> plugin, you can set the convention in your build script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    application
    id(&quot;greetings&quot;)
}

greeting {
    message = &quot;Hello from Gradle&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">application</span><span class="delimiter">'</span></span>
    id(<span class="string"><span class="delimiter">'</span><span class="content">greetings</span><span class="delimiter">'</span></span>)
}

configure(greeting) {
    message = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello from Gradle</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:plugin_conventions"><a class="anchor" href="#sec:plugin_conventions"></a><a class="link" href="#sec:plugin_conventions">Adding default configuration as conventions</a></h4>
<div class="paragraph">
<p>In plugins, you can define default values, also known as <strong>conventions</strong>, using the <code>project</code> object.</p>
</div>
<div class="paragraph">
<p>Convention properties are properties that are initialized with default values but can be overridden:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/greetings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Create extension object
interface GreetingPluginExtension {
    val message: Property&lt;String&gt;
}

// Add the 'greeting' extension object to project
val extension = project.extensions.create&lt;GreetingPluginExtension&gt;(&quot;greeting&quot;)

// Set a default value for 'message'
extension.message.convention(&quot;Hello from Gradle&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/greetings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Create extension object</span>
<span class="type">interface</span> GreetingPluginExtension {
    Property&lt;<span class="predefined-type">String</span>&gt; getMessage()
}

<span class="comment">// Add the 'greeting' extension object to project</span>
<span class="keyword">def</span> extension = project.extensions.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>, GreetingPluginExtension)

<span class="comment">// Set a default value for 'message'</span>
extension.message.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello from Gradle</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>extension.message.convention(&#8230;&#8203;)</code> sets a convention for the <code>message</code> property of the extension.
This convention specifies that the value of <code>message</code> should default to the content of a file named <code>defaultGreeting.txt</code> located in the build directory of the project.</p>
</div>
<div class="paragraph">
<p>If the <code>message</code> property is not explicitly set, its value will be automatically set to the content of <code>defaultGreeting.txt</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:mapping_extension_properties_to_task_properties"><a class="anchor" href="#sec:mapping_extension_properties_to_task_properties"></a><a class="link" href="#sec:mapping_extension_properties_to_task_properties">Mapping extension properties to task properties</a></h4>
<div class="paragraph">
<p>Using an extension and mapping it to a custom task&#8217;s input/output properties is common in plugins.</p>
</div>
<div class="paragraph">
<p>In this example, the message property of the <code>GreetingPluginExtension</code> is mapped to the message property of the <code>GreetingTask</code> as an input:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/greetings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Create extension object
interface GreetingPluginExtension {
    val message: Property&lt;String&gt;
}

// Add the 'greeting' extension object to project
val extension = project.extensions.create&lt;GreetingPluginExtension&gt;(&quot;greeting&quot;)

// Set a default value for 'message'
extension.message.convention(&quot;Hello from Gradle&quot;)

// Create a greeting task
abstract class GreetingTask : DefaultTask() {
    @Input
    val message = project.objects.property&lt;String&gt;()

    @TaskAction
    fun greet() {
        println(&quot;Message: ${message.get()}&quot;)
    }
}

// Register the task and set the convention
tasks.register&lt;GreetingTask&gt;(&quot;hello&quot;) {
    message.convention(extension.message)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/greetings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Create extension object</span>
<span class="type">interface</span> GreetingPluginExtension {
    Property&lt;<span class="predefined-type">String</span>&gt; getMessage()
}

<span class="comment">// Add the 'greeting' extension object to project</span>
<span class="keyword">def</span> extension = project.extensions.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>, GreetingPluginExtension)

<span class="comment">// Set a default value for 'message'</span>
extension.message.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello from Gradle</span><span class="delimiter">&quot;</span></span>)

<span class="comment">// Create a greeting task</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">GreetingTask</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@Input</span>
    <span class="directive">abstract</span> Property&lt;<span class="predefined-type">String</span>&gt; getMessage()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> greet() {
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Message: </span><span class="inline"><span class="inline-delimiter">${</span>message.get()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}

<span class="comment">// Register the task and set the convention</span>
tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>, GreetingTask) {
    message.convention(extension.message)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q hello
Message: Hello from Gradle</pre>
</div>
</div>
<div class="paragraph">
<p>This means that changes to the extension&#8217;s <code>message</code> property will trigger the task to be considered out-of-date, ensuring that the task is re-executed with the new message.</p>
</div>
<div class="paragraph">
<p>You can find out more about types that you can use in task implementations and extensions in <a href="#lazy_configuration">Lazy Configuration</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:applying_external_plugins"><a class="anchor" href="#sec:applying_external_plugins"></a><a class="link" href="#sec:applying_external_plugins">Applying external plugins</a></h4>
<div class="paragraph">
<p>In order to apply an external plugin in a precompiled script plugin, it has to be added to the plugin project&#8217;s implementation classpath in the plugin&#8217;s build file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `kotlin-dsl`
}

repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;com.bmuschko:gradle-docker-plugin:6.4.0&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy-gradle-plugin</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.bmuschko:gradle-docker-plugin:6.4.0</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It can then be applied in the precompiled script plugin:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/my-plugin.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.bmuschko.docker-remote-api&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/my-plugin.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">com.bmuschko.docker-remote-api</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin version in this case is defined in the dependency declaration.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implemention_binary_plugins"><a class="anchor" href="#implemention_binary_plugins"></a><a class="link" href="#implemention_binary_plugins">Implementing Binary Plugins</a></h3>
<div class="paragraph">
<p><strong>Binary plugins</strong> refer to plugins that are compiled and distributed as JAR files.
These plugins are usually written in Java or Kotlin and provide custom functionality or tasks to a Gradle build.</p>
</div>
<div class="sect3">
<h4 id="plugin-development-plugin"><a class="anchor" href="#plugin-development-plugin"></a><a class="link" href="#plugin-development-plugin">Using the Plugin Development plugin</a></h4>
<div class="paragraph">
<p>The <a href="java_gradle_plugin.html#java_gradle_plugin">Gradle Plugin Development plugin</a> can be used to assist in developing Gradle plugins.</p>
</div>
<div class="paragraph">
<p>This plugin will automatically apply the <a href="java_plugin.html#java_plugin">Java Plugin</a>, add the <code>gradleApi()</code> dependency to the <code>api</code> configuration, generate the required plugin descriptors in the resulting JAR file, and configure the <a href="#sec:plugin_markers">Plugin Marker Artifact</a> to be used when publishing.</p>
</div>
<div class="paragraph">
<p>To apply and configure the plugin, add the following code to your build file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-gradle-plugin`
}

gradlePlugin {
    plugins {
        create(&quot;simplePlugin&quot;) {
            id = &quot;org.example.greeting&quot;
            implementationClass = &quot;org.example.GreetingPlugin&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-gradle-plugin</span><span class="delimiter">'</span></span>
}

gradlePlugin {
    plugins {
        simplePlugin {
            id = <span class="string"><span class="delimiter">'</span><span class="content">org.example.greeting</span><span class="delimiter">'</span></span>
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">org.example.GreetingPlugin</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Writing and using <a href="#sec:task_groups">custom task types</a> is recommended when developing plugins as it automatically benefits from <a href="#incremental_build">incremental builds</a>.
As an added benefit of applying the plugin to your project, the task <code>validatePlugins</code> automatically checks for an existing input/output annotation for every public property defined in a custom task type implementation.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:creating_a_plugin_id"><a class="anchor" href="#sec:creating_a_plugin_id"></a><a class="link" href="#sec:creating_a_plugin_id">Creating a plugin ID</a></h4>
<div class="paragraph">
<p>Plugin IDs are meant to be globally unique, similar to Java package names (i.e., a reverse domain name).
This format helps prevent naming collisions and allows grouping plugins with similar ownership.</p>
</div>
<div class="paragraph">
<p>An explicit plugin identifier simplifies applying the plugin to a project.
Your plugin ID should combine components that reflect the namespace (a reasonable pointer to you or your organization) and the name of the plugin it provides.
For example, if your Github account is named <code>foo</code> and your plugin is named <code>bar</code>, a suitable plugin ID might be <code>com.github.foo.bar</code>.
Similarly, if the plugin was developed at the <code>baz</code> organization, the plugin ID might be <code>org.baz.bar</code>.</p>
</div>
<div class="paragraph">
<p>Plugin IDs should adhere to the following guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>May contain any alphanumeric character, '.', and '-'.</p>
</li>
<li>
<p>Must contain at least one '.' character separating the namespace from the plugin&#8217;s name.</p>
</li>
<li>
<p>Conventionally use a lowercase reverse domain name convention for the namespace.</p>
</li>
<li>
<p>Conventionally use only lowercase characters in the name.</p>
</li>
<li>
<p><code>org.gradle</code>, <code>com.gradle</code>, and <code>com.gradleware</code> namespaces may not be used.</p>
</li>
<li>
<p>Cannot start or end with a '.' character.</p>
</li>
<li>
<p>Cannot contain consecutive '.' characters (i.e., '..').</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A namespace that identifies ownership and a name is sufficient for a plugin ID.</p>
</div>
<div class="paragraph">
<p>When bundling multiple plugins in a single JAR artifact, adhering to the same naming conventions is recommended.
This practice helps logically group related plugins.</p>
</div>
<div class="paragraph">
<p>There is no limit to the number of plugins that can be defined and registered (by different identifiers) within a single project.</p>
</div>
<div class="paragraph">
<p>The identifiers for plugins written as a class should be defined in the project&#8217;s build script containing the plugin classes.
For this, the <code>java-gradle-plugin</code> needs to be applied:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;java-gradle-plugin&quot;)
}

gradlePlugin {
    plugins {
        create(&quot;androidApplicationPlugin&quot;) {
            id = &quot;com.android.application&quot;
            implementationClass = &quot;com.android.AndroidApplicationPlugin&quot;
        }
        create(&quot;androidLibraryPlugin&quot;) {
            id = &quot;com.android.library&quot;
            implementationClass = &quot;com.android.AndroidLibraryPlugin&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-gradle-plugin</span><span class="delimiter">'</span></span>
}

gradlePlugin {
    plugins {
        androidApplicationPlugin {
            id = <span class="string"><span class="delimiter">'</span><span class="content">com.android.application</span><span class="delimiter">'</span></span>
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">com.android.AndroidApplicationPlugin</span><span class="delimiter">'</span></span>
        }
        androidLibraryPlugin {
            id = <span class="string"><span class="delimiter">'</span><span class="content">com.android.library</span><span class="delimiter">'</span></span>
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">com.android.AndroidLibraryPlugin</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:working_with_files_in_custom_tasks_and_plugins"><a class="anchor" href="#sec:working_with_files_in_custom_tasks_and_plugins"></a><a class="link" href="#sec:working_with_files_in_custom_tasks_and_plugins">Working with files</a></h4>
<div class="paragraph">
<p>When developing plugins, it&#8217;s a good idea to be flexible when accepting input configuration for file locations.</p>
</div>
<div class="paragraph">
<p>It is recommended to use Gradle&#8217;s <a href="properties_providers.html#managed_properties">managed properties</a> and <code>project.layout</code> to select file or directory locations.
This will enable lazy configuration so that the actual location will only be resolved when the file is needed and can be reconfigured at any time during build configuration.</p>
</div>
<div class="paragraph">
<p>This Gradle build file defines a task <code>GreetingToFileTask</code> that writes a greeting to a file.
It also registers two tasks: <code>greet</code>, which creates the file with the greeting, and <code>sayGreeting</code>, which prints the file&#8217;s contents.
The <code>greetingFile</code> property is used to specify the file path for the greeting:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class GreetingToFileTask : DefaultTask() {

    @get:OutputFile
    abstract val destination: RegularFileProperty

    @TaskAction
    fun greet() {
        val file = destination.get().asFile
        file.parentFile.mkdirs()
        file.writeText(&quot;Hello!&quot;)
    }
}

val greetingFile = objects.fileProperty()

tasks.register&lt;GreetingToFileTask&gt;(&quot;greet&quot;) {
    destination = greetingFile
}

tasks.register(&quot;sayGreeting&quot;) {
    dependsOn(&quot;greet&quot;)
    val greetingFile = greetingFile
    doLast {
        val file = greetingFile.get().asFile
        println(&quot;${file.readText()} (file: ${file.name})&quot;)
    }
}

greetingFile = layout.buildDirectory.file(&quot;hello.txt&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">GreetingToFileTask</span> <span class="directive">extends</span> DefaultTask {

    <span class="annotation">@OutputFile</span>
    <span class="directive">abstract</span> RegularFileProperty getDestination()

    <span class="annotation">@TaskAction</span>
    <span class="keyword">def</span> <span class="function">greet</span>() {
        <span class="keyword">def</span> file = getDestination().get().asFile
        file.parentFile.mkdirs()
        file.write <span class="string"><span class="delimiter">'</span><span class="content">Hello!</span><span class="delimiter">'</span></span>
    }
}

<span class="keyword">def</span> greetingFile = objects.fileProperty()

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">greet</span><span class="delimiter">'</span></span>, GreetingToFileTask) {
    destination = greetingFile
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">sayGreeting</span><span class="delimiter">'</span></span>) {
    dependsOn greet
    doLast {
        <span class="keyword">def</span> file = greetingFile.get().asFile
        println <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>file.text<span class="inline-delimiter">}</span></span><span class="content"> (file: </span><span class="inline"><span class="inline-delimiter">${</span>file.name<span class="inline-delimiter">}</span></span><span class="content">)</span><span class="delimiter">&quot;</span></span>
    }
}

greetingFile = layout.buildDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">hello.txt</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q sayGreeting
Hello! (file: hello.txt)</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we configure the <code>greet</code> task <code>destination</code> property as a closure/provider, which is evaluated with
the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> method to turn the return value of the closure/provider into a <code>File</code> object at the last minute.
Note that we specify the <code>greetingFile</code> property value <em>after</em> the task configuration.
This lazy evaluation is a key benefit of accepting any value when setting a file property and then resolving that value when reading the property.</p>
</div>
<div class="paragraph">
<p>You can learn more about working with files lazily in <a href="#working_with_files">Working with Files</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="capturing_user_input_to_configure_plugin_runtime_behavior"><a class="anchor" href="#capturing_user_input_to_configure_plugin_runtime_behavior"></a><a class="link" href="#capturing_user_input_to_configure_plugin_runtime_behavior">Making a plugin configurable using extensions</a></h4>
<div class="paragraph">
<p>Most plugins offer configuration options for build scripts and other plugins to customize how the plugin works.
Plugins do this using <strong>extension objects</strong>.</p>
</div>
<div class="paragraph">
<p>A <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html">Project</a> has an associated <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/plugins/ExtensionContainer.html">ExtensionContainer</a> object that contains all the settings and properties for the plugins that have been applied to the project.
You can provide configuration for your plugin by adding an extension object to this container.</p>
</div>
<div class="paragraph">
<p>An extension object is simply an object with Java Bean properties representing the configuration.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add a <code>greeting</code> extension object to the project, which allows you to configure the greeting:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">interface GreetingPluginExtension {
    val message: Property&lt;String&gt;
}

class GreetingPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        // Add the 'greeting' extension object
        val extension = project.extensions.create&lt;GreetingPluginExtension&gt;(&quot;greeting&quot;)
        // Add a task that uses configuration from the extension object
        project.task(&quot;hello&quot;) {
            doLast {
                println(extension.message.get())
            }
        }
    }
}

apply&lt;GreetingPlugin&gt;()

// Configure the extension
the&lt;GreetingPluginExtension&gt;().message = &quot;Hi from Gradle&quot;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">interface</span> GreetingPluginExtension {
    Property&lt;<span class="predefined-type">String</span>&gt; getMessage()
}

<span class="type">class</span> <span class="class">GreetingPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="type">void</span> apply(Project project) {
        <span class="comment">// Add the 'greeting' extension object</span>
        <span class="keyword">def</span> extension = project.extensions.create(<span class="string"><span class="delimiter">'</span><span class="content">greeting</span><span class="delimiter">'</span></span>, GreetingPluginExtension)
        <span class="comment">// Add a task that uses configuration from the extension object</span>
        project.task(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
            doLast {
                println extension.message.get()
            }
        }
    }
}

apply <span class="key">plugin</span>: GreetingPlugin

<span class="comment">// Configure the extension</span>
greeting.message = <span class="string"><span class="delimiter">'</span><span class="content">Hi from Gradle</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q hello
Hi from Gradle</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>GreetingPluginExtension</code> is an object with a property called <code>message</code>.
The extension object is added to the project with the name <code>greeting</code>.
This object becomes available as a project property with the same name as the extension object.
<code>the&lt;GreetingPluginExtension&gt;()</code> is equivalent to <code>project.extensions.getByType(GreetingPluginExtension::class.java)</code>.</p>
</div>
<div class="paragraph">
<p>Often, you have several related properties you need to specify on a single plugin.
Gradle adds a configuration block for each extension object, so you can group settings:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">interface GreetingPluginExtension {
    val message: Property&lt;String&gt;
    val greeter: Property&lt;String&gt;
}

class GreetingPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        val extension = project.extensions.create&lt;GreetingPluginExtension&gt;(&quot;greeting&quot;)
        project.task(&quot;hello&quot;) {
            doLast {
                println(&quot;${extension.message.get()} from ${extension.greeter.get()}&quot;)
            }
        }
    }
}

apply&lt;GreetingPlugin&gt;()

// Configure the extension using a DSL block
configure&lt;GreetingPluginExtension&gt; {
    message = &quot;Hi&quot;
    greeter = &quot;Gradle&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">interface</span> GreetingPluginExtension {
    Property&lt;<span class="predefined-type">String</span>&gt; getMessage()
    Property&lt;<span class="predefined-type">String</span>&gt; getGreeter()
}

<span class="type">class</span> <span class="class">GreetingPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="type">void</span> apply(Project project) {
        <span class="keyword">def</span> extension = project.extensions.create(<span class="string"><span class="delimiter">'</span><span class="content">greeting</span><span class="delimiter">'</span></span>, GreetingPluginExtension)
        project.task(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
            doLast {
                println <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>extension.message.get()<span class="inline-delimiter">}</span></span><span class="content"> from </span><span class="inline"><span class="inline-delimiter">${</span>extension.greeter.get()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}

apply <span class="key">plugin</span>: GreetingPlugin

<span class="comment">// Configure the extension using a DSL block</span>
greeting {
    message = <span class="string"><span class="delimiter">'</span><span class="content">Hi</span><span class="delimiter">'</span></span>
    greeter = <span class="string"><span class="delimiter">'</span><span class="content">Gradle</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q hello
Hi from Gradle</pre>
</div>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>In this example, several settings can be grouped within the <code>configure&lt;GreetingPluginExtension&gt;</code> block.
The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Project.html#configure-java.lang.Object-groovy.lang.Closure-"><code>configure</code></a> function is used to configure an extension object.
It provides a convenient way to set properties or apply configurations to these objects.
The type used in the build script&#8217;s <code>configure</code> function (<code>GreetingPluginExtension</code>) must match the extension type.
Then, when the block is executed, the receiver of the block is the extension.</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>In this example, several settings can be grouped within the <code>greeting</code> closure. The name of the closure block in the build script (<code>greeting</code>) must match the extension object name.
Then, when the closure is executed, the fields on the extension object will be mapped to the variables within the closure based on the standard Groovy closure delegate feature.</p>
</div>
</div>
<div class="sect3">
<h4 id="declaring_a_dsl_configuration_container"><a class="anchor" href="#declaring_a_dsl_configuration_container"></a><a class="link" href="#declaring_a_dsl_configuration_container">Declaring a DSL configuration container</a></h4>
<div class="paragraph">
<p>Using an extension object <em>extends</em> the Gradle DSL to add a project property and DSL block for the plugin.
Because an extension object is a regular object, you can provide your own DSL nested inside the plugin block by adding properties and methods to the extension object.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following build script for illustration purposes.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;org.myorg.server-env&quot;)
}

environments {
    create(&quot;dev&quot;) {
        url = &quot;http://localhost:8080&quot;
    }

    create(&quot;staging&quot;) {
        url = &quot;http://staging.enterprise.com&quot;
    }

    create(&quot;production&quot;) {
        url = &quot;http://prod.enterprise.com&quot;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">org.myorg.server-env</span><span class="delimiter">'</span></span>
}

environments {
    dev {
        url = <span class="string"><span class="delimiter">'</span><span class="content">http://localhost:8080</span><span class="delimiter">'</span></span>
    }

    staging {
        url = <span class="string"><span class="delimiter">'</span><span class="content">http://staging.enterprise.com</span><span class="delimiter">'</span></span>
    }

    production {
        url = <span class="string"><span class="delimiter">'</span><span class="content">http://prod.enterprise.com</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The DSL exposed by the plugin exposes a container for defining a set of environments.
Each environment the user configures has an arbitrary but declarative name and is represented with its own DSL configuration block.
The example above instantiates a development, staging, and production environment, including its respective URL.</p>
</div>
<div class="paragraph">
<p>Each environment must have a data representation in code to capture the values.
The name of an environment is immutable and can be passed in as a constructor parameter.
Currently, the only other parameter the data object stores is a URL.</p>
</div>
<div class="paragraph">
<p>The following <code>ServerEnvironment</code> object fulfills those requirements:</p>
</div>
<div class="listingblock">
<div class="title">ServerEnvironment.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">abstract</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">ServerEnvironment</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> name;

    <span class="annotation">@javax</span>.inject.Inject
    <span class="directive">public</span> ServerEnvironment(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">abstract</span> <span class="directive">public</span> Property&lt;<span class="predefined-type">String</span>&gt; getUrl();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle exposes the factory method
<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#domainObjectContainer-java.lang.Class-org.gradle.api.NamedDomainObjectFactory-">ObjectFactory.domainObjectContainer(Class, NamedDomainObjectFactory)</a>
to create a container of data objects.
The parameter the method takes is the class representing the data.
The created instance of type <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/NamedDomainObjectContainer.html">NamedDomainObjectContainer</a> can be exposed to the end user by adding it to the extension container with a specific name.</p>
</div>
<div class="paragraph">
<p>It&#8217;s common for a plugin to post-process the captured values within the plugin implementation, e.g., to configure tasks:</p>
</div>
<div class="listingblock">
<div class="title">ServerEnvironmentPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ServerEnvironmentPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> apply(<span class="directive">final</span> Project project) {
        <span class="predefined-type">ObjectFactory</span> objects = project.getObjects();

        NamedDomainObjectContainer&lt;ServerEnvironment&gt; serverEnvironmentContainer =
            objects.domainObjectContainer(ServerEnvironment.class, name -&gt; objects.newInstance(ServerEnvironment.class, name));
        project.getExtensions().add(<span class="string"><span class="delimiter">&quot;</span><span class="content">environments</span><span class="delimiter">&quot;</span></span>, serverEnvironmentContainer);

        serverEnvironmentContainer.all(serverEnvironment -&gt; {
            <span class="predefined-type">String</span> env = serverEnvironment.getName();
            <span class="predefined-type">String</span> capitalizedServerEnv = env.substring(<span class="integer">0</span>, <span class="integer">1</span>).toUpperCase() + env.substring(<span class="integer">1</span>);
            <span class="predefined-type">String</span> taskName = <span class="string"><span class="delimiter">&quot;</span><span class="content">deployTo</span><span class="delimiter">&quot;</span></span> + capitalizedServerEnv;
            project.getTasks().register(taskName, Deploy.class, task -&gt; task.getUrl().set(serverEnvironment.getUrl()));
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, a deployment task is created dynamically for every user-configured environment.</p>
</div>
<div class="paragraph">
<p>You can find out more about implementing project extensions in <a href="properties_providers.html#properties_and_providers">Developing Custom Gradle Types</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="modeling_dsl_like_apis"><a class="anchor" href="#modeling_dsl_like_apis"></a><a class="link" href="#modeling_dsl_like_apis">Modeling DSL-like APIs</a></h4>
<div class="paragraph">
<p>DSLs exposed by plugins should be readable and easy to understand.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s consider the following extension provided by a plugin.
In its current form, it offers a "flat" list of properties for configuring the creation of a website:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build-flat.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;org.myorg.site&quot;)
}

site {
    outputDir = layout.buildDirectory.file(&quot;mysite&quot;)
    websiteUrl = &quot;https://gradle.org&quot;
    vcsUrl = &quot;https://github.com/gradle/gradle-site-plugin&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build-flat.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">org.myorg.site</span><span class="delimiter">'</span></span>
}

site {
    outputDir = layout.buildDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">mysite</span><span class="delimiter">&quot;</span></span>)
    websiteUrl = <span class="string"><span class="delimiter">'</span><span class="content">https://gradle.org</span><span class="delimiter">'</span></span>
    vcsUrl = <span class="string"><span class="delimiter">'</span><span class="content">https://github.com/gradle/gradle-site-plugin</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As the number of exposed properties grows, you should introduce a nested, more expressive structure.</p>
</div>
<div class="paragraph">
<p>The following code snippet adds a new configuration block named <code>siteInfo</code> as part of the extension.
This provides a stronger indication of what those properties mean:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;org.myorg.site&quot;)
}

site {
    outputDir = layout.buildDirectory.file(&quot;mysite&quot;)

    siteInfo {
        websiteUrl = &quot;https://gradle.org&quot;
        vcsUrl = &quot;https://github.com/gradle/gradle-site-plugin&quot;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">org.myorg.site</span><span class="delimiter">'</span></span>
}

site {
    outputDir = layout.buildDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">mysite</span><span class="delimiter">&quot;</span></span>)

    siteInfo {
        websiteUrl = <span class="string"><span class="delimiter">'</span><span class="content">https://gradle.org</span><span class="delimiter">'</span></span>
        vcsUrl = <span class="string"><span class="delimiter">'</span><span class="content">https://github.com/gradle/gradle-site-plugin</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Implementing the backing objects for such an extension is simple.
First, introduce a new data object for managing the properties <code>websiteUrl</code> and <code>vcsUrl</code>:</p>
</div>
<div class="listingblock">
<div class="title">SiteInfo.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">abstract</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">SiteInfo</span> {

    <span class="directive">abstract</span> <span class="directive">public</span> Property&lt;<span class="predefined-type">String</span>&gt; getWebsiteUrl();

    <span class="directive">abstract</span> <span class="directive">public</span> Property&lt;<span class="predefined-type">String</span>&gt; getVcsUrl();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the extension, create an instance of the <code>siteInfo</code> class and a method to delegate the captured values to the data instance.</p>
</div>
<div class="paragraph">
<p>To configure underlying data objects, define a parameter of type <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Action.html">Action</a>.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates the use of <code>Action</code> in an extension definition:</p>
</div>
<div class="listingblock">
<div class="title">SiteExtension.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">abstract</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">SiteExtension</span> {

    <span class="directive">abstract</span> <span class="directive">public</span> RegularFileProperty getOutputDir();

    <span class="annotation">@Nested</span>
    <span class="directive">abstract</span> <span class="directive">public</span> SiteInfo getSiteInfo();

    <span class="directive">public</span> <span class="type">void</span> siteInfo(<span class="predefined-type">Action</span>&lt;? <span class="local-variable">super</span> SiteInfo&gt; action) {
        action.execute(getSiteInfo());
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:mapping_extension_properties_to_task_properties"><a class="anchor" href="#sec:mapping_extension_properties_to_task_properties"></a><a class="link" href="#sec:mapping_extension_properties_to_task_properties">Mapping extension properties to task properties</a></h4>
<div class="paragraph">
<p>Plugins commonly use an extension to capture user input from the build script and map it to a custom task&#8217;s input/output properties.
The build script author interacts with the extension&#8217;s DSL, while the plugin implementation handles the underlying logic:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Extension class to capture user input
class MyExtension {
    @Input
    var inputParameter: String? = null
}

// Custom task that uses the input from the extension
class MyCustomTask : org.gradle.api.DefaultTask() {
    @Input
    var inputParameter: String? = null

    @TaskAction
    fun executeTask() {
        println(&quot;Input parameter: $inputParameter&quot;)
    }
}

// Plugin class that configures the extension and task
class MyPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        // Create and configure the extension
        val extension = project.extensions.create(&quot;myExtension&quot;, MyExtension::class.java)
        // Create and configure the custom task
        project.tasks.register(&quot;myTask&quot;, MyCustomTask::class.java) {
            group = &quot;custom&quot;
            inputParameter = extension.inputParameter
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Extension class to capture user input</span>
<span class="type">class</span> <span class="class">MyExtension</span> {
    <span class="annotation">@Input</span>
    <span class="predefined-type">String</span> inputParameter = <span class="predefined-constant">null</span>
}

<span class="comment">// Custom task that uses the input from the extension</span>
<span class="type">class</span> <span class="class">MyCustomTask</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@Input</span>
    <span class="predefined-type">String</span> inputParameter = <span class="predefined-constant">null</span>

    <span class="annotation">@TaskAction</span>
    <span class="keyword">def</span> <span class="function">executeTask</span>() {
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Input parameter: </span><span class="inline"><span class="inline-delimiter">$</span>inputParameter</span><span class="delimiter">&quot;</span></span>)
    }
}

<span class="comment">// Plugin class that configures the extension and task</span>
<span class="type">class</span> <span class="class">MyPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="type">void</span> apply(Project project) {
        <span class="comment">// Create and configure the extension</span>
        <span class="keyword">def</span> extension = project.extensions.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">myExtension</span><span class="delimiter">&quot;</span></span>, MyExtension)
        <span class="comment">// Create and configure the custom task</span>
        project.tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">myTask</span><span class="delimiter">&quot;</span></span>, MyCustomTask) {
            group = <span class="string"><span class="delimiter">&quot;</span><span class="content">custom</span><span class="delimiter">&quot;</span></span>
            inputParameter = extension.inputParameter
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>MyExtension</code> class defines an <code>inputParameter</code> property that can be set in the build script.
The <code>MyPlugin</code> class configures this extension and uses its <code>inputParameter</code> value to configure the <code>MyCustomTask</code> task.
The <code>MyCustomTask</code> task then uses this input parameter in its logic.</p>
</div>
<div class="paragraph">
<p>You can learn more about types you can use in task implementations and extensions in <a href="#lazy_configuration">Lazy Configuration</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:plugin_conventions"><a class="anchor" href="#sec:plugin_conventions"></a><a class="link" href="#sec:plugin_conventions">Adding default configuration with conventions</a></h4>
<div class="paragraph">
<p>Plugins should provide sensible defaults and standards in a specific context, reducing the number of decisions users need to make.
Using the <code>project</code> object, you can define default values.
These are known as <strong>conventions</strong>.</p>
</div>
<div class="paragraph">
<p>Conventions are properties that are initialized with default values and can be overridden by the user in their build script.
For example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">interface GreetingPluginExtension {
    val message: Property&lt;String&gt;
}

class GreetingPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        // Add the 'greeting' extension object
        val extension = project.extensions.create&lt;GreetingPluginExtension&gt;(&quot;greeting&quot;)
        extension.message.convention(&quot;Hello from GreetingPlugin&quot;)
        // Add a task that uses configuration from the extension object
        project.task(&quot;hello&quot;) {
            doLast {
                println(extension.message.get())
            }
        }
    }
}

apply&lt;GreetingPlugin&gt;()</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">interface</span> GreetingPluginExtension {
    Property&lt;<span class="predefined-type">String</span>&gt; getMessage()
}

<span class="type">class</span> <span class="class">GreetingPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="type">void</span> apply(Project project) {
        <span class="comment">// Add the 'greeting' extension object</span>
        <span class="keyword">def</span> extension = project.extensions.create(<span class="string"><span class="delimiter">'</span><span class="content">greeting</span><span class="delimiter">'</span></span>, GreetingPluginExtension)
        extension.message.convention(<span class="string"><span class="delimiter">'</span><span class="content">Hello from GreetingPlugin</span><span class="delimiter">'</span></span>)
        <span class="comment">// Add a task that uses configuration from the extension object</span>
        project.task(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
            doLast {
                println extension.message.get()
            }
        }
    }
}

apply <span class="key">plugin</span>: GreetingPlugin</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q hello
Hello from GreetingPlugin</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>GreetingPluginExtension</code> is a class that represents the convention.
The message property is the convention property with a default value of 'Hello from GreetingPlugin'.</p>
</div>
<div class="paragraph">
<p>Users can override this value in their build script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">GreetingPluginExtension {
    message = &quot;Custom message&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GreetingPluginExtension {
    message = <span class="string"><span class="delimiter">'</span><span class="content">Custom message</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ gradle -q hello
Custom message</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="capabilities-vs-conventions"><a class="anchor" href="#capabilities-vs-conventions"></a><a class="link" href="#capabilities-vs-conventions">Separating capabilities from conventions</a></h4>
<div class="paragraph">
<p>Separating capabilities from conventions in plugins allows users to choose which tasks and conventions to apply.</p>
</div>
<div class="paragraph">
<p>For example, the Java Base plugin provides un-opinionated (i.e., generic) functionality like <code>SourceSets</code>, while the Java plugin adds tasks and conventions familiar to Java developers like <code>classes</code>, <code>jar</code> or <code>javadoc</code>.</p>
</div>
<div class="paragraph">
<p>When designing your own plugins, consider developing two plugins — one for capabilities and another for conventions — to offer flexibility to users.</p>
</div>
<div class="paragraph">
<p>In the example below, <code>MyPlugin</code> contains conventions, and <code>MyBasePlugin</code> defines capabilities.
Then, <code>MyPlugin</code> applies <code>MyBasePlugin</code>, this is called <em>plugin composition</em>.
To apply a plugin from another one:</p>
</div>
<div class="listingblock">
<div class="title">MyBasePlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.Plugin</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.Project</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">MyBasePlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
        <span class="comment">// define capabilities</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MyPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.Plugin</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.Project</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">MyPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
        project.getPlugins().apply(MyBasePlugin.class);

        <span class="comment">// define conventions</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reacting_to_plugins"><a class="anchor" href="#reacting_to_plugins"></a><a class="link" href="#reacting_to_plugins">Reacting to plugins</a></h4>
<div class="paragraph">
<p>A common pattern in Gradle plugin implementations is configuring the runtime behavior of existing plugins and tasks in a build.</p>
</div>
<div class="paragraph">
<p>For example, a plugin could assume that it is applied to a Java-based project and automatically reconfigure the standard source directory:</p>
</div>
<div id="convention-api-usage-example" class="listingblock">
<div class="title">InhouseStrongOpinionConventionJavaPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">InhouseStrongOpinionConventionJavaPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
        <span class="comment">// Careful! Eagerly appyling plugins has downsides, and is not always recommended.</span>
        project.getPlugins().apply(JavaPlugin.class);
        SourceSetContainer sourceSets = project.getExtensions().getByType(SourceSetContainer.class);
        SourceSet main = sourceSets.getByName(SourceSet.MAIN_SOURCE_SET_NAME);
        main.getJava().setSrcDirs(<span class="predefined-type">Arrays</span>.asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The drawback to this approach is that it automatically forces the project to apply the Java plugin, imposing a strong opinion on it (i.e., reducing flexibility and generality).
In practice, the project applying the plugin might not even deal with Java code.</p>
</div>
<div class="paragraph">
<p>Instead of automatically applying the Java plugin, the plugin could react to the fact that the consuming project applies the Java plugin.
Only if that is the case, then a certain configuration is applied:</p>
</div>
<div class="listingblock">
<div class="title">InhouseConventionJavaPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">InhouseConventionJavaPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
        project.getPlugins().withType(JavaPlugin.class, javaPlugin -&gt; {
            SourceSetContainer sourceSets = project.getExtensions().getByType(SourceSetContainer.class);
            SourceSet main = sourceSets.getByName(SourceSet.MAIN_SOURCE_SET_NAME);
            main.getJava().setSrcDirs(<span class="predefined-type">Arrays</span>.asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>));
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Reacting to plugins is preferred over applying plugins if there is no good reason to assume that the consuming project has the expected setup.</p>
</div>
<div class="paragraph">
<p>The same concept applies to task types:</p>
</div>
<div class="listingblock">
<div class="title">InhouseConventionWarPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">InhouseConventionWarPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
        project.getTasks().withType(War.class).configureEach(war -&gt;
            war.setWebXml(project.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/someWeb.xml</span><span class="delimiter">&quot;</span></span>)));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reacting_to_build_features"><a class="anchor" href="#reacting_to_build_features"></a><a class="link" href="#reacting_to_build_features">Reacting to build features</a></h4>
<div class="paragraph">
<p>Plugins can access the status of build features in the build.
The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/configuration/BuildFeatures.html">Build Features API</a> allows checking whether the user requested a particular Gradle feature and if it is active in the current build.
An example of a build feature is the <a href="#config_cache">configuration cache</a>.</p>
</div>
<div class="paragraph">
<p>There are two main use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using the status of build features in reports or statistics.</p>
</li>
<li>
<p>Incrementally adopting experimental Gradle features by disabling incompatible plugin functionality.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Below is an example of a plugin that utilizes both of the cases.</p>
</div>
<div class="listingblock">
<div class="title">Reacting to build features</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">MyPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {

    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> <span class="directive">abstract</span> BuildFeatures getBuildFeatures(); // <b class="conum">(1)</b>

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> apply(Project p) {
        BuildFeatures buildFeatures = getBuildFeatures();

        <span class="predefined-type">Boolean</span> configCacheRequested = buildFeatures.getConfigurationCache().getRequested() // <b class="conum">(2)</b>
            .getOrNull(); <span class="comment">// could be null if user did not opt in nor opt out</span>
        <span class="predefined-type">String</span> configCacheUsage = describeFeatureUsage(configCacheRequested);
        MyReport myReport = <span class="keyword">new</span> MyReport();
        myReport.setConfigurationCacheUsage(configCacheUsage);

        <span class="type">boolean</span> isolatedProjectsActive = buildFeatures.getIsolatedProjects().getActive() // <b class="conum">(3)</b>
            .get(); <span class="comment">// the active state is always defined</span>
        <span class="keyword">if</span> (!isolatedProjectsActive) {
            myOptionalPluginLogicIncompatibleWithIsolatedProjects();
        }
    }

    <span class="directive">private</span> <span class="predefined-type">String</span> describeFeatureUsage(<span class="predefined-type">Boolean</span> requested) {
        <span class="keyword">return</span> requested == <span class="predefined-constant">null</span> ? <span class="string"><span class="delimiter">&quot;</span><span class="content">no preference</span><span class="delimiter">&quot;</span></span> : requested ? <span class="string"><span class="delimiter">&quot;</span><span class="content">opt-in</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">opt-out</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="directive">private</span> <span class="type">void</span> myOptionalPluginLogicIncompatibleWithIsolatedProjects() {
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>BuildFeatures</code> service can be injected into plugins, tasks, and other managed types.</p>
</li>
<li>
<p>Accessing the <code>requested</code> status of a feature for reporting.</p>
</li>
<li>
<p>Using the <code>active</code> status of a feature to disable incompatible functionality.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="build_feature_properties"><a class="anchor" href="#build_feature_properties"></a><a class="link" href="#build_feature_properties">Build feature properties</a></h5>
<div class="paragraph">
<p>A <code>BuildFeature</code> status properties are represented with <code>Provider&lt;Boolean&gt;</code> types.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/configuration/BuildFeature.html#getRequested--"><code>BuildFeature.getRequested()</code></a> status of a build feature determines if the user requested to enable or disable the feature.</p>
</div>
<div class="paragraph">
<p>When the <code>requested</code> provider value is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>true</code>&#8201;&#8212;&#8201;the user opted in for using the feature</p>
</li>
<li>
<p><code>false</code>&#8201;&#8212;&#8201;the user opted out from using the feature</p>
</li>
<li>
<p><code>undefined</code>&#8201;&#8212;&#8201;the user neither opted in nor opted out from using the feature</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/configuration/BuildFeature.html#getActive--"><code>BuildFeature.getActive()</code></a> status of a build feature is always defined.
It represents the effective state of the feature in the build.</p>
</div>
<div class="paragraph">
<p>When the <code>active</code> provider value is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>true</code>&#8201;&#8212;&#8201;the feature <em>may</em> affect the build behavior in a way specific to the feature</p>
</li>
<li>
<p><code>false</code>&#8201;&#8212;&#8201;the feature will not affect the build behavior</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the <code>active</code> status does not depend on the <code>requested</code> status.
Even if the user requests a feature, it may still not be active due to other build options being used in the build.
Gradle can also activate a feature by default, even if the user did not specify a preference.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom_dependencies_blocks"><a class="anchor" href="#custom_dependencies_blocks"></a><a class="link" href="#custom_dependencies_blocks">Using a custom <code>dependencies</code> block</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Custom <code>dependencies</code> blocks are based on incubating APIs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A plugin can provide dependency declarations in custom blocks that allow users to declare dependencies in a type-safe and context-aware way.</p>
</div>
<div class="paragraph">
<p>For instance, instead of users needing to know and use the underlying <code>Configuration</code> name to add dependencies, a custom <code>dependencies</code> block lets the plugin pick a meaningful name that
can be used consistently.</p>
</div>
<div class="sect4">
<h5 id="adding_a_custom_dependencies_block"><a class="anchor" href="#adding_a_custom_dependencies_block"></a><a class="link" href="#adding_a_custom_dependencies_block">Adding a custom <code>dependencies</code> block</a></h5>
<div class="paragraph">
<p>To add a custom <code>dependencies</code> block, you need to create a new <a href="properties_providers.html#properties_and_providers">type</a> that will represent the set of dependency scopes available to users.
That new type needs to be accessible from a part of your plugin (from a domain object or extension).
Finally, the dependency scopes need to be wired back to underlying <code>Configuration</code> objects that will be used during dependency resolution.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.plugins.jvm.JvmComponentDependencies.html">JvmComponentDependencies</a> and <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.plugins.jvm.JvmTestSuite.html">JvmTestSuite</a> for an example of how this is used in a Gradle core plugin.</p>
</div>
<div class="sect5">
<h6 id="1_create_an_interface_that_extends_dependencies"><a class="anchor" href="#1_create_an_interface_that_extends_dependencies"></a><a class="link" href="#1_create_an_interface_that_extends_dependencies">1. Create an interface that extends <code>Dependencies</code></a></h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can also extend <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.dsl.GradleDependencies.html">GradleDependencies</a> to get access to Gradle-provided dependencies like <code>gradleApi()</code>.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">ExampleDependencies.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Custom dependencies block for the example plugin.
 */</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">ExampleDependencies</span> <span class="directive">extends</span> Dependencies {</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="2_add_accessors_for_dependency_scopes"><a class="anchor" href="#2_add_accessors_for_dependency_scopes"></a><a class="link" href="#2_add_accessors_for_dependency_scopes">2. Add accessors for dependency scopes</a></h6>
<div class="paragraph">
<p>For each dependency scope your plugin wants to support, add a getter method that returns a <code>DependencyCollector</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">ExampleDependencies.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="comment">/**
     * Dependency scope called &quot;implementation&quot;
     */</span>
    DependencyCollector getImplementation();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="3_add_accessors_for_custom_dependencies_block"><a class="anchor" href="#3_add_accessors_for_custom_dependencies_block"></a><a class="link" href="#3_add_accessors_for_custom_dependencies_block">3. Add accessors for custom <code>dependencies</code> block</a></h6>
<div class="paragraph">
<p>To make the custom <code>dependencies</code> block configurable, the plugin needs to add a <code>getDependencies</code> method that returns the new type from above and a configurable block method named <code>dependencies</code>.</p>
</div>
<div class="paragraph">
<p>By convention, the accessors for your custom <code>dependencies</code> block should be called <code>getDependencies()</code>/<code>dependencies(Action)</code>.
This method could be named something else, but users would need to know that a different block can behave like a <code>dependencies</code> block.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">ExampleExtension.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="comment">/**
     * Custom dependencies for this extension.
     */</span>
    <span class="annotation">@Nested</span>
    ExampleDependencies getDependencies();

    <span class="comment">/**
     * Configurable block
     */</span>
    <span class="keyword">default</span> <span class="type">void</span> dependencies(<span class="predefined-type">Action</span>&lt;? <span class="local-variable">super</span> ExampleDependencies&gt; action) {
        action.execute(getDependencies());
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="4_wire_dependency_scope_to_configuration"><a class="anchor" href="#4_wire_dependency_scope_to_configuration"></a><a class="link" href="#4_wire_dependency_scope_to_configuration">4. Wire dependency scope to <code>Configuration</code></a></h6>
<div class="paragraph">
<p>Finally, the plugin needs to wire the custom <code>dependencies</code> block to some underlying <code>Configuration</code> objects. If this is not done, none of the dependencies declared in the custom block will
be available to dependency resolution.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">ExamplePlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        project.getConfigurations().dependencyScope(<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleImplementation</span><span class="delimiter">&quot;</span></span>, conf -&gt; {
            conf.fromDependencyCollector(example.getDependencies().getImplementation());
        });</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In this example, the name users will use to add dependencies is "implementation", but the underlying <code>Configuration</code> is named <code>exampleImplementation</code>.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">example {
    dependencies {
        implementation(&quot;junit:junit:4.13&quot;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">example {
    dependencies {
        implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">junit:junit:4.13</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:differences_with_top_level_dependencies"><a class="anchor" href="#sec:differences_with_top_level_dependencies"></a><a class="link" href="#sec:differences_with_top_level_dependencies">Differences between the custom <code>dependencies</code> and the top-level <code>dependencies</code> blocks</a></h5>
<div class="paragraph">
<p>Each dependency scope returns a <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.dsl.DependencyCollector.html"><code>DependencyCollector</code></a> that provides strongly-typed methods to add and configure dependencies.</p>
</div>
<div class="paragraph">
<p>There is also a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/dsl/DependencyFactory.html"><code>DependencyFactory</code></a> with factory methods to create new dependencies from different notations.
Dependencies can be created lazily using these factory methods, as shown below.</p>
</div>
<div class="paragraph">
<p>A custom <code>dependencies</code> block differs from the top-level <code>dependencies</code> block in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dependencies must be declared using a <code>String</code>, an instance of <code>Dependency</code>, a <code>FileCollection</code>, a <code>Provider</code> of <code>Dependency</code>, or a <code>ProviderConvertible</code> of <code>MinimalExternalModuleDependency</code>.</p>
</li>
<li>
<p>Outside of Gradle build scripts, you must explicitly call a getter for the <code>DependencyCollector</code> and <code>add</code>.</p>
<div class="ulist">
<ul>
<li>
<p><code>dependencies.add("implementation", x)</code> becomes <code>getImplementation().add(x)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>You cannot declare dependencies with the <code>Map</code> notation from Kotlin and Java.
Use multi-argument methods instead in Kotlin and Java.</p>
<div class="ulist">
<ul>
<li>
<p>Kotlin: <code>compileOnly(mapOf("group" to "foo", "name" to "bar"))</code> becomes <code>compileOnly(module(group = "foo", name = "bar"))</code></p>
</li>
<li>
<p>Java: <code>compileOnly(Map.of("group", "foo", "name", "bar"))</code> becomes <code>getCompileOnly().add(module("foo", "bar", null))</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>You cannot add a dependency with an instance of <code>Project</code>. You must turn it into a <code>ProjectDependency</code> first.</p>
</li>
<li>
<p>You cannot add version catalog bundles directly.
Instead, use the <code>bundle</code> method on each configuration.</p>
<div class="ulist">
<ul>
<li>
<p>Kotlin and Groovy: <code>implementation(libs.bundles.testing)</code> becomes <code>implementation.bundle(libs.bundles.testing)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>You cannot use providers for non-<code>Dependency</code> types directly.
Instead, map them to a <code>Dependency</code> using the <code>DependencyFactory</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Kotlin and Groovy: <code>implementation(myStringProvider)</code> becomes <code>implementation(myStringProvider.map { dependencyFactory.create(it) })</code></p>
</li>
<li>
<p>Java: <code>implementation(myStringProvider)</code> becomes <code>getImplementation().add(myStringProvider.map(getDependencyFactory()::create)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Unlike the top-level <code>dependencies</code> block, constraints are not in a separate block.</p>
<div class="ulist">
<ul>
<li>
<p>Instead, constraints are added by decorating a dependency with <code>constraint(&#8230;&#8203;)</code> like <code>implementation(constraint("org:foo:1.0"))</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Keep in mind that the <code>dependencies</code> block may not provide access to the same methods as the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html">top-level <code>dependencies</code> block</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Plugins should prefer adding dependencies via their own <code>dependencies</code> block.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="providing_default_dependencies"><a class="anchor" href="#providing_default_dependencies"></a><a class="link" href="#providing_default_dependencies">Providing default dependencies</a></h4>
<div class="paragraph">
<p>The implementation of a plugin sometimes requires the use of an external dependency.</p>
</div>
<div class="paragraph">
<p>You might want to automatically download an artifact using Gradle’s dependency management mechanism and later use it in the action of a task type declared in the plugin.
Ideally, the plugin implementation does not need to ask the user for the coordinates of that dependency - it can simply predefine a sensible default version.</p>
</div>
<div class="paragraph">
<p>Let’s look at an example of a plugin that downloads files containing data for further processing.
The plugin implementation declares a custom configuration that allows for <a href="#declaring-dependencies">assigning those external dependencies with dependency coordinates</a>:</p>
</div>
<div class="listingblock">
<div class="title">DataProcessingPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DataProcessingPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
        <span class="predefined-type">Configuration</span> dataFiles = project.getConfigurations().create(<span class="string"><span class="delimiter">&quot;</span><span class="content">dataFiles</span><span class="delimiter">&quot;</span></span>, c -&gt; {
            c.setVisible(<span class="predefined-constant">false</span>);
            c.setCanBeConsumed(<span class="predefined-constant">false</span>);
            c.setCanBeResolved(<span class="predefined-constant">true</span>);
            c.setDescription(<span class="string"><span class="delimiter">&quot;</span><span class="content">The data artifacts to be processed for this plugin.</span><span class="delimiter">&quot;</span></span>);
            c.defaultDependencies(d -&gt; d.add(project.getDependencies().create(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.myorg:data:1.4.6</span><span class="delimiter">&quot;</span></span>)));
        });

        project.getTasks().withType(DataProcessing.class).configureEach(
            dataProcessing -&gt; dataProcessing.getDataFiles().from(dataFiles));
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">DataProcessing.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">abstract</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">DataProcessing</span> <span class="directive">extends</span> DefaultTask {

    <span class="annotation">@InputFiles</span>
    <span class="directive">abstract</span> <span class="directive">public</span> ConfigurableFileCollection getDataFiles();

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> process() {
        <span class="predefined-type">System</span>.out.println(getDataFiles().getFiles());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach is convenient for the end user as there is no need to actively declare a dependency.
The plugin already provides all the details about this implementation.</p>
</div>
<div class="paragraph">
<p>But what if the user wants to redefine the default dependency?</p>
</div>
<div class="paragraph">
<p>No problem.
The plugin also exposes the custom configuration that can be used to assign a different dependency.
Effectively, the default dependency is overwritten:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;org.myorg.data-processing&quot;)
}

dependencies {
    dataFiles(&quot;org.myorg:more-data:2.6&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">org.myorg.data-processing</span><span class="delimiter">'</span></span>
}

dependencies {
    dataFiles <span class="string"><span class="delimiter">'</span><span class="content">org.myorg:more-data:2.6</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You will find that this pattern works well for tasks that require an external dependency when the task&#8217;s action is executed.
You can go further and abstract the version to be used for the external dependency by exposing an extension property (e.g.
<code>toolVersion</code> in <a href="https://docs.gradle.org/8.9/dsl/org.gradle.testing.jacoco.plugins.JacocoPluginExtension.html">the JaCoCo plugin</a>).</p>
</div>
<div class="sect4">
<h5 id="minimizing_the_use_of_external_libraries"><a class="anchor" href="#minimizing_the_use_of_external_libraries"></a><a class="link" href="#minimizing_the_use_of_external_libraries">Minimizing the use of external libraries</a></h5>
<div class="paragraph">
<p>Using external libraries in your Gradle projects can bring great convenience, but be aware that they can introduce complex dependency graphs.
Gradle&#8217;s <code>buildEnvironment</code> task can help you visualize these dependencies, including those of your plugins.
Keep in mind that plugins share the same classloader, so conflicts may arise with different versions of the same library.</p>
</div>
<div class="paragraph">
<p>To demonstrate let’s assume the following build script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;org.asciidoctor.jvm.convert&quot;) version &quot;4.0.2&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">org.asciidoctor.jvm.convert</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">4.0.2</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The output of the task clearly indicates the classpath of the <code>classpath</code> configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle buildEnvironment

&gt; Task :buildEnvironment

------------------------------------------------------------
Root project 'external-libraries'
------------------------------------------------------------

classpath
\--- org.asciidoctor.jvm.convert:org.asciidoctor.jvm.convert.gradle.plugin:4.0.2
     \--- org.asciidoctor:asciidoctor-gradle-jvm:4.0.2
          +--- org.ysb33r.gradle:grolifant-rawhide:3.0.0
          |    \--- org.tukaani:xz:1.6
          +--- org.ysb33r.gradle:grolifant-herd:3.0.0
          |    +--- org.tukaani:xz:1.6
          |    +--- org.ysb33r.gradle:grolifant40:3.0.0
          |    |    +--- org.tukaani:xz:1.6
          |    |    +--- org.apache.commons:commons-collections4:4.4
          |    |    +--- org.ysb33r.gradle:grolifant-core:3.0.0
          |    |    |    +--- org.tukaani:xz:1.6
          |    |    |    +--- org.apache.commons:commons-collections4:4.4
          |    |    |    \--- org.ysb33r.gradle:grolifant-rawhide:3.0.0 (*)
          |    |    \--- org.ysb33r.gradle:grolifant-rawhide:3.0.0 (*)
          |    +--- org.ysb33r.gradle:grolifant50:3.0.0
          |    |    +--- org.tukaani:xz:1.6
          |    |    +--- org.ysb33r.gradle:grolifant40:3.0.0 (*)
          |    |    +--- org.ysb33r.gradle:grolifant-core:3.0.0 (*)
          |    |    \--- org.ysb33r.gradle:grolifant40-legacy-api:3.0.0
          |    |         +--- org.tukaani:xz:1.6
          |    |         +--- org.apache.commons:commons-collections4:4.4
          |    |         +--- org.ysb33r.gradle:grolifant-core:3.0.0 (*)
          |    |         \--- org.ysb33r.gradle:grolifant40:3.0.0 (*)
          |    +--- org.ysb33r.gradle:grolifant60:3.0.0
          |    |    +--- org.tukaani:xz:1.6
          |    |    +--- org.ysb33r.gradle:grolifant40:3.0.0 (*)
          |    |    +--- org.ysb33r.gradle:grolifant50:3.0.0 (*)
          |    |    +--- org.ysb33r.gradle:grolifant-core:3.0.0 (*)
          |    |    \--- org.ysb33r.gradle:grolifant-rawhide:3.0.0 (*)
          |    +--- org.ysb33r.gradle:grolifant70:3.0.0
          |    |    +--- org.tukaani:xz:1.6
          |    |    +--- org.ysb33r.gradle:grolifant40:3.0.0 (*)
          |    |    +--- org.ysb33r.gradle:grolifant50:3.0.0 (*)
          |    |    +--- org.ysb33r.gradle:grolifant60:3.0.0 (*)
          |    |    \--- org.ysb33r.gradle:grolifant-core:3.0.0 (*)
          |    +--- org.ysb33r.gradle:grolifant80:3.0.0
          |    |    +--- org.tukaani:xz:1.6
          |    |    +--- org.ysb33r.gradle:grolifant40:3.0.0 (*)
          |    |    +--- org.ysb33r.gradle:grolifant50:3.0.0 (*)
          |    |    +--- org.ysb33r.gradle:grolifant60:3.0.0 (*)
          |    |    +--- org.ysb33r.gradle:grolifant70:3.0.0 (*)
          |    |    \--- org.ysb33r.gradle:grolifant-core:3.0.0 (*)
          |    +--- org.ysb33r.gradle:grolifant-core:3.0.0 (*)
          |    \--- org.ysb33r.gradle:grolifant-rawhide:3.0.0 (*)
          +--- org.asciidoctor:asciidoctor-gradle-base:4.0.2
          |    \--- org.ysb33r.gradle:grolifant-herd:3.0.0 (*)
          \--- org.asciidoctor:asciidoctorj-api:2.5.7

(*) - Indicates repeated occurrences of a transitive dependency subtree. Gradle expands transitive dependency subtrees only once per project; repeat occurrences only display the root of the subtree, followed by this annotation.

A web-based, searchable dependency report is available by adding the --scan option.

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>A Gradle plugin does not run in its own, isolated classloader, so you must consider whether you truly need a library or if a simpler solution suffices.</p>
</div>
<div class="paragraph">
<p>For logic that is executed as part of task execution, use the <a href="#tasks_parallel_worker">Worker API</a> that allows you to isolate libraries.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="plugin-with-variants"><a class="anchor" href="#plugin-with-variants"></a><a class="link" href="#plugin-with-variants">Providing multiple variants of a plugin</a></h4>
<div class="paragraph">
<p>Variants of a plugin refer to different flavors or configurations of the plugin that are tailored to specific needs or use cases.
These variants can include different implementations, extensions, or configurations of the base plugin.</p>
</div>
<div class="paragraph">
<p>The most convenient way to configure additional plugin variants is to use <a href="#feature_variants">feature variants</a>, a concept available in all Gradle projects that apply one of the Java plugins:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation 'com.google.guava:guava:30.1-jre'        // Regular dependency
    featureVariant 'com.google.guava:guava-gwt:30.1-jre'    // Feature variant dependency
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following example, each plugin variant is developed in isolation.
A separate source set is compiled and packaged in a separate jar for each variant.</p>
</div>
<div class="paragraph">
<p>The following sample demonstrates how to add a variant that is compatible with Gradle 7.0+ while the "main" variant is compatible with older versions:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val gradle7 = sourceSets.create(&quot;gradle7&quot;)

java {
    registerFeature(gradle7.name) {
        usingSourceSet(gradle7)
        capability(project.group.toString(), project.name, project.version.toString()) // <b class="conum">(1)</b>
    }
}

configurations.configureEach {
    if (isCanBeConsumed &amp;&amp; name.startsWith(gradle7.name))  {
        attributes {
            attribute(GradlePluginApiVersion.GRADLE_PLUGIN_API_VERSION_ATTRIBUTE, // <b class="conum">(2)</b>
                objects.named(&quot;7.0&quot;))
        }
    }
}

tasks.named&lt;Copy&gt;(gradle7.processResourcesTaskName) { // <b class="conum">(3)</b>
    val copyPluginDescriptors = rootSpec.addChild()
    copyPluginDescriptors.into(&quot;META-INF/gradle-plugins&quot;)
    copyPluginDescriptors.from(tasks.pluginDescriptors)
}

dependencies {
    &quot;gradle7CompileOnly&quot;(gradleApi()) // <b class="conum">(4)</b>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> gradle7 = sourceSets.create(<span class="string"><span class="delimiter">'</span><span class="content">gradle7</span><span class="delimiter">'</span></span>)

java {
    registerFeature(gradle7.name) {
        usingSourceSet(gradle7)
        capability(project.group.toString(), project.name, project.version.toString()) // <b class="conum">(1)</b>
    }
}

configurations.configureEach {
    <span class="keyword">if</span> (canBeConsumed &amp;&amp; name.startsWith(gradle7.name))  {
        attributes {
            attribute(GradlePluginApiVersion.GRADLE_PLUGIN_API_VERSION_ATTRIBUTE, // <b class="conum">(2)</b>
                      objects.named(GradlePluginApiVersion, <span class="string"><span class="delimiter">'</span><span class="content">7.0</span><span class="delimiter">'</span></span>))
        }
    }
}

tasks.named(gradle7.processResourcesTaskName) { // <b class="conum">(3)</b>
    <span class="keyword">def</span> copyPluginDescriptors = rootSpec.addChild()
    copyPluginDescriptors.into(<span class="string"><span class="delimiter">'</span><span class="content">META-INF/gradle-plugins</span><span class="delimiter">'</span></span>)
    copyPluginDescriptors.from(tasks.pluginDescriptors)
}

dependencies {
    gradle7CompileOnly(gradleApi()) // <b class="conum">(4)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Only Gradle versions 7 or higher can be explicitly targeted by a variant, as support for this was only added in Gradle 7.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, we declare a separate <em>source set</em> and a <em>feature variant</em> for our Gradle 7 plugin variant.
Then, we do some specific wiring to turn the feature into a proper Gradle plugin variant:</p>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Assign the <a href="#declaring-component-capabilities">implicit capability that corresponds to the components GAV</a> to the variant.</p>
</li>
<li>
<p>Assign the <a href="#sub:gradle_plugins_default_attributes">Gradle API version attribute</a> to all <a href="#sec:resolvable-consumable-configs">consumable configurations</a> of our Gradle7 variant. Gradle uses this information to determine which variant to select during plugin resolution.</p>
</li>
<li>
<p>Configure the <code>processGradle7Resources</code> task to ensure the plugin descriptor file is added to the Gradle7 variant Jar.</p>
</li>
<li>
<p>Add a dependency to the <code>gradleApi()</code> for our new variant so that the API is visible during compilation time.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that there is currently no convenient way to access the API of other Gradle versions as the one you are building the plugin with.
Ideally, every variant should be able to declare a dependency on the API of the minimal Gradle version it supports.
This will be improved in the future.</p>
</div>
<div class="paragraph">
<p>The above snippet assumes that all variants of your plugin have the plugin class at the same location.
That is, if your plugin class is <code>org.example.GreetingPlugin</code>, you need to create a second variant of that class in <code>src/gradle7/java/org/example</code>.</p>
</div>
<div class="sect4">
<h5 id="using_version_specific_variants_of_multi_variant_plugins"><a class="anchor" href="#using_version_specific_variants_of_multi_variant_plugins"></a><a class="link" href="#using_version_specific_variants_of_multi_variant_plugins">Using version-specific variants of multi-variant plugins</a></h5>
<div class="paragraph">
<p>Given a dependency on a multi-variant plugin, Gradle will automatically choose its variant that best matches the current Gradle version when it resolves any of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>plugins specified in the <a href="#sec:plugins_block"><code>plugins {}</code> block</a>;</p>
</li>
<li>
<p><code>buildscript</code> classpath dependencies;</p>
</li>
<li>
<p>dependencies in the root project of the <a href="#sec:using_buildsrc">build source (<code>buildSrc</code>)</a> that appear on the compile or runtime classpath;</p>
</li>
<li>
<p>dependencies in a project that applies the <a href="java_gradle_plugin.html#java_gradle_plugin">Java Gradle Plugin Development plugin</a> or the <a href="#sec:kotlin-dsl_plugin">Kotlin DSL plugin</a>, appearing on the compile or runtime classpath.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The best matching variant is the variant that targets the highest Gradle API version and does not exceed the current build&#8217;s Gradle version.</p>
</div>
<div class="paragraph">
<p>In all other cases, a plugin variant that does not specify the supported Gradle API version is preferred if such a variant is present.</p>
</div>
<div class="paragraph">
<p>In projects that use plugins as dependencies, requesting the variants of plugin dependencies that support a different Gradle version is possible.
This allows a multi-variant plugin that depends on other plugins to access their APIs, which are exclusively provided in their version-specific variants.</p>
</div>
<div class="paragraph">
<p>This snippet makes the <a href="#plugin-with-variants">plugin variant <code>gradle7</code> defined above</a> consume the matching variants of its dependencies on other multi-variant plugins:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.configureEach {
    if (isCanBeResolved &amp;&amp; name.startsWith(gradle7.name))  {
        attributes {
            attribute(GradlePluginApiVersion.GRADLE_PLUGIN_API_VERSION_ATTRIBUTE,
                objects.named(&quot;7.0&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.configureEach {
    <span class="keyword">if</span> (canBeResolved &amp;&amp; name.startsWith(gradle7.name))  {
        attributes {
            attribute(GradlePluginApiVersion.GRADLE_PLUGIN_API_VERSION_ATTRIBUTE,
                objects.named(GradlePluginApiVersion, <span class="string"><span class="delimiter">'</span><span class="content">7.0</span><span class="delimiter">'</span></span>))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reporting_problems"><a class="anchor" href="#reporting_problems"></a><a class="link" href="#reporting_problems">Reporting problems</a></h4>
<div class="paragraph">
<p>Plugins can report problems through Gradle&#8217;s problem-reporting APIs.
The APIs report rich, structured information about problems happening during the build.
This information can be used by different user interfaces such as Gradle&#8217;s console output, Build Scans, or IDEs to communicate problems to the user in the most appropriate way.</p>
</div>
<div class="paragraph">
<p>The following example shows an issue reported from a plugin:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">ProblemReportingPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ProblemReportingPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {

    <span class="directive">private</span> <span class="directive">final</span> ProblemReporter problemReporter;

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> ProblemReportingPlugin(Problems problems) { // <b class="conum">(1)</b>
        <span class="local-variable">this</span>.problemReporter = problems.forNamespace(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.myorg</span><span class="delimiter">&quot;</span></span>); // <b class="conum">(2)</b>
    }

    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
        <span class="local-variable">this</span>.problemReporter.reporting(builder -&gt; builder // <b class="conum">(3)</b>
            .id(<span class="string"><span class="delimiter">&quot;</span><span class="content">adhoc-deprecation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Plugin 'x' is deprecated</span><span class="delimiter">&quot;</span></span>)
            .details(<span class="string"><span class="delimiter">&quot;</span><span class="content">The plugin 'x' is deprecated since version 2.5</span><span class="delimiter">&quot;</span></span>)
            .solution(<span class="string"><span class="delimiter">&quot;</span><span class="content">Please use plugin 'y'</span><span class="delimiter">&quot;</span></span>)
            .severity(<span class="predefined-type">Severity</span>.WARNING)
        );
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>Problem</code> service is injected into the plugin.</p>
</li>
<li>
<p>A problem reporter, is created for the plugin. While the namespace is up to the plugin author, it is recommended that the plugin ID be used.</p>
</li>
<li>
<p>A problem is reported. This problem is recoverable so that the build will continue.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For a full example, see our <a href="../samples/sample_problems_api_usage.html">end-to-end sample</a>.</p>
</div>
<div class="sect4">
<h5 id="problem_building"><a class="anchor" href="#problem_building"></a><a class="link" href="#problem_building">Problem building</a></h5>
<div class="paragraph">
<p>When reporting a problem, a wide variety of information can be provided.
The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/problems/ProblemSpec.html">ProblemSpec</a> describes all the information that can be provided.</p>
</div>
</div>
<div class="sect4">
<h5 id="reporting_problems_2"><a class="anchor" href="#reporting_problems_2"></a><a class="link" href="#reporting_problems_2">Reporting problems</a></h5>
<div class="paragraph">
<p>When it comes to reporting problems, we support three different modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/problems/ProblemReporter.html#reporting-org.gradle.api.Action-">Reporting</a> a problem is used for reporting problems that are recoverable, and the build should continue.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/problems/ProblemReporter.html#throwing-org.gradle.api.Action-">Throwing</a> a problem is used for reporting problems that are not recoverable, and the build should fail.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/problems/ProblemReporter.html#rethrowing-java.lang.RuntimeException-org.gradle.api.Action-">Rethrowing</a> a problem is used to wrap an already thrown exception. Otherwise, the behavior is the same as <code>Throwing</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details, see the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/problems/ProblemReporter.html">ProblemReporter</a> documentation.</p>
</div>
</div>
<div class="sect4">
<h5 id="problem_aggregation"><a class="anchor" href="#problem_aggregation"></a><a class="link" href="#problem_aggregation">Problem aggregation</a></h5>
<div class="paragraph">
<p>When reporting problems, Gradle will aggregate similar problems by sending them through the Tooling API based on the problem&#8217;s category label.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a problem is reported, the <em>first</em> occurrence is going to be reported as a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/tooling/events/problems/ProblemDescriptor.html">ProblemDescriptor</a>, containing the complete information about the problem.</p>
</li>
<li>
<p>Any subsequent occurrences of the same problem will be reported as a <a href="https://docs.gradle.org/8.9/javadocorg/gradle/tooling/events/problems/ProblemAggregationDescriptor.html">ProblemAggregationDescriptor</a>. This descriptor will arrive at the <em>end</em> of the build and contain the number of occurrences of the problem.</p>
</li>
<li>
<p>If for any bucket (i.e., category and label pairing), the number of collected occurrences is greater than 10.000, then it will be sent immediately instead of at the end of the build.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing_gradle_plugins"><a class="anchor" href="#testing_gradle_plugins"></a><a class="link" href="#testing_gradle_plugins">Testing Gradle plugins</a></h3>
<div class="paragraph">
<p>Testing plays a crucial role in the development process by ensuring reliable and high-quality software.
This principle applies to build code, including Gradle plugins.</p>
</div>
<div class="sect3">
<h4 id="the_sample_project"><a class="anchor" href="#the_sample_project"></a><a class="link" href="#the_sample_project">The sample project</a></h4>
<div class="paragraph">
<p>This section revolves around a sample project called the "URL verifier plugin".
This plugin creates a task named <code>verifyUrl</code> that checks whether a given URL can be resolved via HTTP GET.
The end user can provide the URL via an extension named <code>verification</code>.</p>
</div>
<div class="paragraph">
<p>The following build script assumes that the plugin JAR file has been published to a binary repository.
The script demonstrates how to apply the plugin to the project and configure its exposed extension:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;org.myorg.url-verifier&quot;)        // <b class="conum">(1)</b>
}

verification {
    url = &quot;https://www.google.com/&quot;  // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">org.myorg.url-verifier</span><span class="delimiter">'</span></span>         // <b class="conum">(1)</b>
}

verification {
    url = <span class="string"><span class="delimiter">'</span><span class="content">https://www.google.com/</span><span class="delimiter">'</span></span>     // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Applies the plugin to the project</p>
</li>
<li>
<p>Configures the URL to be verified through the exposed extension</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Executing the <code>verifyUrl</code> task renders a success message if the HTTP GET call to the configured URL returns with a 200 response code:</p>
</div>
<div id="verify-url-cmd-output" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">$ gradle verifyUrl

&gt; Task :verifyUrl
Successfully resolved URL 'https://www.google.com/'

BUILD SUCCESSFUL in 0s
5 actionable tasks: 5 executed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before diving into the code, let&#8217;s first revisit the different types of tests and the tooling that supports implementing them.</p>
</div>
</div>
<div class="sect3">
<h4 id="the_importance_of_testing"><a class="anchor" href="#the_importance_of_testing"></a><a class="link" href="#the_importance_of_testing">The importance of testing</a></h4>
<div class="paragraph">
<p>Testing is a crucial part of the software development life cycle, ensuring that software functions correctly and meets quality standards before release.
Automated testing allows developers to refactor and improve code with confidence.</p>
</div>
<div class="sect4">
<h5 id="testing-pyramid"><a class="anchor" href="#testing-pyramid"></a><a class="link" href="#testing-pyramid">The testing pyramid</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Manual Testing </dt>
<dd>
<p>While manual testing is straightforward, it is error-prone and requires human effort. For Gradle plugins, manual testing involves using the plugin in a build script.</p>
</dd>
<dt class="hdlist1">Automated Testing </dt>
<dd>
<p>Automated testing includes unit, integration, and functional testing.</p>
</dd>
</dl>
</div>
<div class="imageblock right">
<div class="content">
<img src="img/testing-pyramid.png" alt="testing pyramid">
</div>
</div>
<div class="paragraph">
<p>The testing pyramid introduced by Mike Cohen in his book <a href="https://www.mountaingoatsoftware.com/books/succeeding-with-agile-software-development-using-scrum">Succeeding with Agile: Software Development Using Scrum</a> describes three types of automated tests:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Unit Testing:</strong> Verifies the smallest units of code, typically methods, in isolation. It uses Stubs or Mocks to isolate code from external dependencies.</p>
</li>
<li>
<p><strong>Integration Testing:</strong> Validates that multiple units or components work together.</p>
</li>
<li>
<p><strong>Functional Testing:</strong> Tests the system from the end user&#8217;s perspective, ensuring correct functionality. End-to-end tests for Gradle plugins simulate a build, apply the plugin, and execute specific tasks to verify functionality.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="tooling_support"><a class="anchor" href="#tooling_support"></a><a class="link" href="#tooling_support">Tooling support</a></h5>
<div class="paragraph">
<p>Testing Gradle plugins, both manually and automatically, is simplified with the appropriate tools.
The table below provides a summary of each testing approach.
You can choose any test framework you&#8217;re comfortable with.</p>
</div>
<div class="paragraph">
<p>For detailed explanations and code examples, refer to the specific sections below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Test type</th>
<th class="tableblock halign-left valign-top">Tooling support</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#manual-tests">Manual tests</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#composite_builds">Gradle composite builds</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#unit-tests">Unit tests</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any JVM-based test framework</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#integration-tests">Integration tests</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any JVM-based test framework</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#functional-tests">Functional tests</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any JVM-based test framework and <a href="#test_kit">Gradle TestKit</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="manual-tests"><a class="anchor" href="#manual-tests"></a><a class="link" href="#manual-tests">Setting up manual tests</a></h4>
<div class="paragraph">
<p>The <a href="#composite_builds">composite builds</a> feature of Gradle makes it easy to test a plugin manually.
The standalone plugin project and the consuming project can be combined into a single unit, making it straightforward to try out or debug changes without re-publishing the binary file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── include-plugin-build   // <b class="conum">(1)</b>
│   ├── build.gradle
│   └── settings.gradle
└── url-verifier-plugin    // <b class="conum">(2)</b>
    ├── build.gradle
    ├── settings.gradle
    └── src</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Consuming project that includes the plugin project</p>
</li>
<li>
<p>The plugin project</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There are two ways to include a plugin project in a consuming project:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By using the command line option <code>--include-build</code>.</p>
</li>
<li>
<p>By using the method <code>includeBuild</code> in <code>settings.gradle</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following code snippet demonstrates the use of the settings file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    includeBuild(&quot;../url-verifier-plugin&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
    includeBuild <span class="string"><span class="delimiter">'</span><span class="content">../url-verifier-plugin</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The command line output of the <code>verifyUrl</code> task from the project <code>include-plugin-build</code> <a href="#verify-url-cmd-output">looks exactly the same as shown in the introduction</a>, except that it now executes as part of a composite build.</p>
</div>
<div class="paragraph">
<p>Manual testing has its place in the development process, but it is not a replacement for automated testing.</p>
</div>
</div>
<div class="sect3">
<h4 id="setting_up_automated_tests"><a class="anchor" href="#setting_up_automated_tests"></a><a class="link" href="#setting_up_automated_tests">Setting up automated tests</a></h4>
<div class="paragraph">
<p>Setting up a suite of tests early on is crucial to the success of your plugin.
Automated tests become an invaluable safety net when upgrading the plugin to a new Gradle version or enhancing/refactoring the code.</p>
</div>
<div class="sect4">
<h5 id="organizing_test_source_code"><a class="anchor" href="#organizing_test_source_code"></a><a class="link" href="#organizing_test_source_code">Organizing test source code</a></h5>
<div class="paragraph">
<p>We recommend implementing a good distribution of unit, integration, and functional tests to cover the most important use cases.
Separating the source code for each test type automatically results in a project that is more maintainable and manageable.</p>
</div>
<div class="paragraph">
<p>By default, the Java project creates a convention for organizing unit tests in the directory <code>src/test/java</code>.
Additionally, if you apply the Groovy plugin, source code under the directory <code>src/test/groovy</code> is considered for compilation (with the same standard for Kotlin under the directory <code>src/test/kotlin</code>).
Consequently, source code directories for other test types should follow a similar pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
└── src
    ├── functionalTest
    │   └── groovy      // <b class="conum">(1)</b>
    ├── integrationTest
    │   └── groovy      // <b class="conum">(2)</b>
    ├── main
    │   ├── java        // <b class="conum">(3)</b>
    └── test
        └── groovy      // <b class="conum">(4)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Source directory containing functional tests</p>
</li>
<li>
<p>Source directory containing integration tests</p>
</li>
<li>
<p>Source directory containing production source code</p>
</li>
<li>
<p>Source directory containing unit tests</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The directories <code>src/integrationTest/groovy</code> and <code>src/functionalTest/groovy</code> are not based on an existing standard convention for Gradle projects.
You are free to choose any project layout that works best for you.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can configure the source directories for compilation and test execution.</p>
</div>
<div class="paragraph">
<p>The <a href="{userManualPath}/jvm_test_suite_plugin.html">Test Suite plugin</a> provides a DSL and API to model multiple groups of automated tests into test suites in JVM-based projects.
You can also rely on third-party plugins for convenience, such as the <a href="https://github.com/nebula-plugins/nebula-project-plugin#nebula-facet-plugin">Nebula Facet plugin</a> or the <a href="https://github.com/unbroken-dome/gradle-testsets-plugin">TestSets plugin</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="modeling_test_types"><a class="anchor" href="#modeling_test_types"></a><a class="link" href="#modeling_test_types">Modeling test types</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A new configuration DSL for modeling the below <code>integrationTest</code> suite is available via the incubating <a href="jvm_test_suite_plugin.html#jvm_test_suite_plugin">JVM Test Suite</a> plugin.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Gradle, source code directories are represented using the concept of <a href="java_plugin.html#source_sets">source sets</a>.
A source set is configured to point to one or more directories containing source code.
When you define a source set, Gradle automatically sets up compilation tasks for the specified directories.</p>
</div>
<div class="paragraph">
<p>A pre-configured source set can be created with one line of build script code.
The source set automatically registers configurations to define dependencies for the sources of the source set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Define a source set named 'test' for test sources</span>
sourceSets {
    test {
        java {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">src/test/java</span><span class="delimiter">'</span></span>]
        }
    }
}
<span class="comment">// Specify a test implementation dependency on JUnit</span>
dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use that to define an <code>integrationTestImplementation</code> dependency to the project itself, which represents the "main" variant of our project (i.e., the compiled plugin code):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val integrationTest by sourceSets.creating

dependencies {
    &quot;integrationTestImplementation&quot;(project)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> integrationTest = sourceSets.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">integrationTest</span><span class="delimiter">&quot;</span></span>)

dependencies {
    integrationTestImplementation(project)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Source sets are responsible for compiling source code, but they do not deal with executing the bytecode.
For test execution, a corresponding task of type <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/Test.html">Test</a> needs to be established.
The following setup shows the execution of integration tests, referencing the classes and runtime classpath of the integration test source set:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val integrationTestTask = tasks.register&lt;Test&gt;(&quot;integrationTest&quot;) {
    description = &quot;Runs the integration tests.&quot;
    group = &quot;verification&quot;
    testClassesDirs = integrationTest.output.classesDirs
    classpath = integrationTest.runtimeClasspath
    mustRunAfter(tasks.test)
}
tasks.check {
    dependsOn(integrationTestTask)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> integrationTestTask = tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">integrationTest</span><span class="delimiter">&quot;</span></span>, Test) {
    description = <span class="string"><span class="delimiter">'</span><span class="content">Runs the integration tests.</span><span class="delimiter">'</span></span>
    group = <span class="string"><span class="delimiter">&quot;</span><span class="content">verification</span><span class="delimiter">&quot;</span></span>
    testClassesDirs = integrationTest.output.classesDirs
    classpath = integrationTest.runtimeClasspath
    mustRunAfter(tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>))
}
tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">check</span><span class="delimiter">'</span></span>) {
    dependsOn(integrationTestTask)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configuring_a_test_framework"><a class="anchor" href="#configuring_a_test_framework"></a><a class="link" href="#configuring_a_test_framework">Configuring a test framework</a></h5>
<div class="paragraph">
<p>Gradle does not dictate the use of a specific test framework. Popular choices include <a href="https://junit.org/">JUnit</a>, <a href="https://testng.org/">TestNG</a> and <a href="http://spockframework.org/">Spock</a>.
Once you choose an option, you have to add its dependency to the compile classpath for your tests.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows how to use Spock for implementing tests:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

dependencies {
    testImplementation(platform(&quot;org.spockframework:spock-bom:2.2-groovy-3.0&quot;))
    testImplementation(&quot;org.spockframework:spock-core&quot;)
    testRuntimeOnly(&quot;org.junit.platform:junit-platform-launcher&quot;)

    &quot;integrationTestImplementation&quot;(platform(&quot;org.spockframework:spock-bom:2.2-groovy-3.0&quot;))
    &quot;integrationTestImplementation&quot;(&quot;org.spockframework:spock-core&quot;)
    &quot;integrationTestRuntimeOnly&quot;(&quot;org.junit.platform:junit-platform-launcher&quot;)

    &quot;functionalTestImplementation&quot;(platform(&quot;org.spockframework:spock-bom:2.2-groovy-3.0&quot;))
    &quot;functionalTestImplementation&quot;(&quot;org.spockframework:spock-core&quot;)
    &quot;functionalTestRuntimeOnly&quot;(&quot;org.junit.platform:junit-platform-launcher&quot;)
}

tasks.withType&lt;Test&gt;().configureEach {
    // Using JUnitPlatform for running tests
    useJUnitPlatform()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

dependencies {
    testImplementation platform(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spockframework:spock-bom:2.2-groovy-3.0</span><span class="delimiter">&quot;</span></span>)
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core</span><span class="delimiter">'</span></span>
    testRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.platform:junit-platform-launcher</span><span class="delimiter">'</span></span>

    integrationTestImplementation platform(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spockframework:spock-bom:2.2-groovy-3.0</span><span class="delimiter">&quot;</span></span>)
    integrationTestImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core</span><span class="delimiter">'</span></span>
    integrationTestRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.platform:junit-platform-launcher</span><span class="delimiter">'</span></span>

    functionalTestImplementation platform(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spockframework:spock-bom:2.2-groovy-3.0</span><span class="delimiter">&quot;</span></span>)
    functionalTestImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core</span><span class="delimiter">'</span></span>
    functionalTestRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.platform:junit-platform-launcher</span><span class="delimiter">'</span></span>
}

tasks.withType(Test).configureEach {
    <span class="comment">// Using JUnitPlatform for running tests</span>
    useJUnitPlatform()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Spock is a Groovy-based BDD test framework that even includes APIs for creating Stubs and Mocks.
The Gradle team prefers Spock over other options for its expressiveness and conciseness.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="implementing_automated_tests"><a class="anchor" href="#implementing_automated_tests"></a><a class="link" href="#implementing_automated_tests">Implementing automated tests</a></h4>
<div class="paragraph">
<p>This section discusses representative implementation examples for unit, integration, and functional tests.
All test classes are based on the use of Spock, though it should be relatively easy to adapt the code to a different test framework.</p>
</div>
<div class="sect4">
<h5 id="unit-tests"><a class="anchor" href="#unit-tests"></a><a class="link" href="#unit-tests">Implementing unit tests</a></h5>
<div class="paragraph">
<p>The URL verifier plugin emits HTTP GET calls to check if a URL can be resolved successfully.
The method <code>DefaultHttpCaller.get(String)</code> is responsible for calling a given URL and returns an instance of type <code>HttpResponse</code>. <code>HttpResponse</code> is a POJO containing information about the HTTP response code and message:</p>
</div>
<div class="listingblock">
<div class="title">HttpResponse.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.myorg.http</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">HttpResponse</span> {
    <span class="directive">private</span> <span class="type">int</span> code;
    <span class="directive">private</span> <span class="predefined-type">String</span> message;

    <span class="directive">public</span> HttpResponse(<span class="type">int</span> code, <span class="predefined-type">String</span> message) {
        <span class="local-variable">this</span>.code = code;
        <span class="local-variable">this</span>.message = message;
    }

    <span class="directive">public</span> <span class="type">int</span> getCode() {
        <span class="keyword">return</span> code;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getMessage() {
        <span class="keyword">return</span> message;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP </span><span class="delimiter">&quot;</span></span> + code + <span class="string"><span class="delimiter">&quot;</span><span class="content">, Reason: </span><span class="delimiter">&quot;</span></span> + message;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class <code>HttpResponse</code> represents a good candidate for a unit test.
It does not reach out to any other classes nor does it use the Gradle API.</p>
</div>
<div class="listingblock">
<div class="title">HttpResponseTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.myorg.http

<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span> <span class="class">HttpResponseTest</span> <span class="directive">extends</span> Specification {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> OK_HTTP_CODE = <span class="integer">200</span>
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> OK_HTTP_MESSAGE = <span class="string"><span class="delimiter">'</span><span class="content">OK</span><span class="delimiter">'</span></span>

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">can access information</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        <span class="keyword">def</span> httpResponse = <span class="keyword">new</span> HttpResponse(OK_HTTP_CODE, OK_HTTP_MESSAGE)

        <span class="key">then</span>:
        httpResponse.code == OK_HTTP_CODE
        httpResponse.message == OK_HTTP_MESSAGE
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">can get String representation</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        <span class="keyword">def</span> httpResponse = <span class="keyword">new</span> HttpResponse(OK_HTTP_CODE, OK_HTTP_MESSAGE)

        <span class="key">then</span>:
        httpResponse.toString() == <span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP </span><span class="inline"><span class="inline-delimiter">$</span>OK_HTTP_CODE</span><span class="content">, Reason: </span><span class="inline"><span class="inline-delimiter">$</span>OK_HTTP_MESSAGE</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When writing unit tests, it&#8217;s important to test boundary conditions and various forms of invalid input.
Try to extract as much logic as possible from classes that use the Gradle API to make it testable as unit tests.
It will result in maintainable code and faster test execution.
</td>
</tr>
</table>
</div>
<div id="sec:writing_tests_for_your_plugin" class="paragraph">
<p>You can use the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testfixtures/ProjectBuilder.html">ProjectBuilder</a> class to create <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html">Project</a> instances to use when you test your plugin implementation.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">src/test/java/org/example/GreetingPluginTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">GreetingPluginTest</span> {
    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> greeterPluginAddsGreetingTaskToProject() {
        Project project = ProjectBuilder.builder().build();
        project.getPluginManager().apply(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example.greeting</span><span class="delimiter">&quot;</span></span>);

        assertTrue(project.getTasks().getByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>) <span class="keyword">instanceof</span> GreetingTask);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="integration-tests"><a class="anchor" href="#integration-tests"></a><a class="link" href="#integration-tests">Implementing integration tests</a></h5>
<div class="paragraph">
<p>Let&#8217;s look at a class that reaches out to another system, the piece of code that emits the HTTP calls.
At the time of executing a test for the class <code>DefaultHttpCaller</code>, the runtime environment needs to be able to reach out to the internet:</p>
</div>
<div class="listingblock">
<div class="title">DefaultHttpCaller.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.myorg.http</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.net.HttpURLConnection</span>;
<span class="keyword">import</span> <span class="include">java.net.URI</span>;
<span class="keyword">import</span> <span class="include">java.net.URISyntaxException</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultHttpCaller</span> <span class="directive">implements</span> HttpCaller {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> HttpResponse get(<span class="predefined-type">String</span> url) {
        <span class="keyword">try</span> {
            <span class="predefined-type">HttpURLConnection</span> connection = (<span class="predefined-type">HttpURLConnection</span>) <span class="keyword">new</span> <span class="predefined-type">URI</span>(url).toURL().openConnection();
            connection.setConnectTimeout(<span class="integer">5000</span>);
            connection.setRequestMethod(<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>);
            connection.connect();

            <span class="type">int</span> code = connection.getResponseCode();
            <span class="predefined-type">String</span> message = connection.getResponseMessage();
            <span class="keyword">return</span> <span class="keyword">new</span> HttpResponse(code, message);
        } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> HttpCallException(<span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">Failed to call URL '%s' via HTTP GET</span><span class="delimiter">&quot;</span></span>, url), e);
        } <span class="keyword">catch</span> (<span class="exception">URISyntaxException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(e);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Implementing an integration test for <code>DefaultHttpCaller</code> doesn&#8217;t look much different from the unit test shown in the previous section:</p>
</div>
<div class="listingblock">
<div class="title">DefaultHttpCallerIntegrationTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.myorg.http

<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="keyword">import</span> <span class="include">spock.lang.Subject</span>

<span class="type">class</span> <span class="class">DefaultHttpCallerIntegrationTest</span> <span class="directive">extends</span> Specification {
    <span class="annotation">@Subject</span> HttpCaller httpCaller = <span class="keyword">new</span> DefaultHttpCaller()

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">can make successful HTTP GET call</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        <span class="keyword">def</span> httpResponse = httpCaller.get(<span class="string"><span class="delimiter">'</span><span class="content">https://www.google.com/</span><span class="delimiter">'</span></span>)

        <span class="key">then</span>:
        httpResponse.code == <span class="integer">200</span>
        httpResponse.message == <span class="string"><span class="delimiter">'</span><span class="content">OK</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">throws exception when calling unknown host via HTTP GET</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        httpCaller.get(<span class="string"><span class="delimiter">'</span><span class="content">https://www.wedonotknowyou123.com/</span><span class="delimiter">'</span></span>)

        <span class="key">then</span>:
        <span class="keyword">def</span> t = thrown(HttpCallException)
        t.message == <span class="string"><span class="delimiter">&quot;</span><span class="content">Failed to call URL 'https://www.wedonotknowyou123.com/' via HTTP GET</span><span class="delimiter">&quot;</span></span>
        t.cause <span class="keyword">instanceof</span> <span class="exception">UnknownHostException</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="functional-tests"><a class="anchor" href="#functional-tests"></a><a class="link" href="#functional-tests">Implementing functional tests</a></h5>
<div class="paragraph">
<p>Functional tests verify the correctness of the plugin end-to-end.
In practice, this means applying, configuring, and executing the functionality of the plugin implementation.
The <code>UrlVerifierPlugin</code> class exposes an extension and a task instance that uses the URL value configured by the end user:</p>
</div>
<div class="listingblock">
<div class="title">UrlVerifierPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.myorg</span>;

<span class="keyword">import</span> <span class="include">org.gradle.api.Plugin</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.Project</span>;
<span class="keyword">import</span> <span class="include">org.myorg.tasks.UrlVerify</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">UrlVerifierPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
        UrlVerifierExtension extension = project.getExtensions().create(<span class="string"><span class="delimiter">&quot;</span><span class="content">verification</span><span class="delimiter">&quot;</span></span>, UrlVerifierExtension.class);
        UrlVerify verifyUrlTask = project.getTasks().create(<span class="string"><span class="delimiter">&quot;</span><span class="content">verifyUrl</span><span class="delimiter">&quot;</span></span>, UrlVerify.class);
        verifyUrlTask.getUrl().set(extension.getUrl());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every Gradle plugin project should apply the <a href="java_gradle_plugin.html#java_gradle_plugin">plugin development plugin</a> to reduce boilerplate code.
By applying the plugin development plugin, the test source set is preconfigured for the use with TestKit.
If we want to use a custom source set for functional tests and leave the default test source set for only unit tests, we can configure the plugin development plugin to look for TestKit tests elsewhere.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">gradlePlugin {
    testSourceSets(functionalTest)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gradlePlugin {
    testSourceSets(sourceSets.functionalTest)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Functional tests for Gradle plugins use an instance of <code>GradleRunner</code> to execute the build under test.
<code>GradleRunner</code> is an API provided by TestKit, which internally uses the Tooling API to execute the build.</p>
</div>
<div class="paragraph">
<p>The following example applies the plugin to the build script under test, configures the extension and executes the build with the task <code>verifyUrl</code>.
Please see the <a href="#test_kit">TestKit documentation</a> to get more familiar with the functionality of TestKit.</p>
</div>
<div class="listingblock">
<div class="title">UrlVerifierPluginFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.myorg

<span class="keyword">import</span> <span class="include">org.gradle.testkit.runner.GradleRunner</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="keyword">import</span> <span class="include">spock.lang.TempDir</span>

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.gradle.testkit.runner.TaskOutcome.SUCCESS</span>

<span class="type">class</span> <span class="class">UrlVerifierPluginFunctionalTest</span> <span class="directive">extends</span> Specification {
    <span class="annotation">@TempDir</span> <span class="predefined-type">File</span> testProjectDir
    <span class="predefined-type">File</span> buildFile

    <span class="keyword">def</span> <span class="function">setup</span>() {
        buildFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(testProjectDir, <span class="string"><span class="delimiter">'</span><span class="content">build.gradle</span><span class="delimiter">'</span></span>)
        buildFile &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
            plugins {
                id 'org.myorg.url-verifier'
            }
        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">can successfully configure URL through extension and verify it</span><span class="delimiter">&quot;</span></span>() {
        buildFile &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
            verification {
                url = 'https://www.google.com/'
            }
        </span><span class="delimiter">&quot;&quot;&quot;</span></span>

        <span class="key">when</span>:
        <span class="keyword">def</span> result = GradleRunner.create()
            .withProjectDir(testProjectDir)
            .withArguments(<span class="string"><span class="delimiter">'</span><span class="content">verifyUrl</span><span class="delimiter">'</span></span>)
            .withPluginClasspath()
            .build()

        <span class="key">then</span>:
        result.output.contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">Successfully resolved URL 'https://www.google.com/'</span><span class="delimiter">&quot;</span></span>)
        result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:verifyUrl</span><span class="delimiter">&quot;</span></span>).outcome == SUCCESS
    }
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="ide_integration"><a class="anchor" href="#ide_integration"></a><a class="link" href="#ide_integration">IDE integration</a></h6>
<div class="paragraph">
<p>TestKit determines the plugin classpath by running a specific Gradle task.
You will need to execute the <code>assemble</code> task to initially generate the plugin classpath or to reflect changes to it even when running TestKit-based functional tests from the IDE.</p>
</div>
<div class="paragraph">
<p>Some IDEs provide a convenience option to delegate the "test classpath generation and execution" to the build.
In IntelliJ, you can find this option under Preferences&#8230;&#8203; &gt; Build, Execution, Deployment &gt; Build Tools &gt; Gradle &gt; Runner &gt; Delegate IDE build/run actions to Gradle.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/intellij-delegate-to-build.png" alt="intellij delegate to build">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="publishing_portal"><a class="anchor" href="#publishing_portal"></a><a class="link" href="#publishing_portal">Publishing Plugins to the Gradle Plugin Portal</a></h3>
<div class="paragraph">
<p>Publishing a plugin is the primary way to make it available for others to use.
While you can publish to a private repository to restrict access, publishing to the <a href="https://plugins.gradle.org">Gradle Plugin Portal</a> makes your plugin available to anyone in the world.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/plugin-portal-page.png" alt="plugin portal page">
</div>
</div>
<div class="paragraph">
<p>This guide shows you how to use the <a href="https://plugins.gradle.org/plugin/com.gradle.plugin-publish"><code>com.gradle.plugin-publish</code></a> plugin to publish plugins to the <a href="https://plugins.gradle.org">Gradle Plugin Portal</a> using a convenient DSL.
This approach streamlines configuration steps and provides validation checks to ensure your plugin meets the Gradle Plugin Portal&#8217;s criteria.</p>
</div>
<div class="sect3">
<h4 id="prerequisites"><a class="anchor" href="#prerequisites"></a><a class="link" href="#prerequisites">Prerequisites</a></h4>
<div class="paragraph">
<p>You&#8217;ll need an existing Gradle plugin project for this tutorial. If you don&#8217;t have one, use the <a href="../samples/sample_gradle_plugin.html">Greeting plugin sample</a>.</p>
</div>
<div class="paragraph">
<p>Attempting to publish this plugin will safely fail with a permission error, so don&#8217;t worry about cluttering up the Gradle Plugin Portal with a trivial example plugin.</p>
</div>
</div>
<div class="sect3">
<h4 id="account_setup"><a class="anchor" href="#account_setup"></a><a class="link" href="#account_setup">Account setup</a></h4>
<div class="paragraph">
<p>Before publishing your plugin, you must create an account on the Gradle Plugin Portal.
Follow the instructions on the <a href="https://plugins.gradle.org/user/register">registration page</a> to create an account and obtain an API key from your profile page&#8217;s "API Keys" tab.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/plugin-portal-registration-page.png" alt="plugin portal registration page">
</div>
</div>
<div class="paragraph">
<p>Store your API key in your Gradle configuration (gradle.publish.key and gradle.publish.secret) or use a plugin like Seauc Credentials plugin or Gradle Credentials plugin for secure management.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/plugin-portal-api-keys.png" alt="plugin portal api keys">
</div>
</div>
<div class="paragraph">
<p>It is common practice to copy and paste the text into your <a href="#sec:gradle_configuration_properties">$HOME/.gradle/gradle.properties</a> file, but you can also place it in any other valid location.
All the plugin requires is that the <code>gradle.publish.key</code> and <code>gradle.publish.secret</code> are available as project properties when the appropriate Plugin Portal tasks are executed.</p>
</div>
<div class="paragraph">
<p>If you are concerned about placing your credentials in <code>gradle.properties</code>, check out the <a href="https://plugins.gradle.org/plugin/de.qaware.seu.as.code.credentials">Seauc Credentials plugin</a> or the <a href="https://plugins.gradle.org/plugin/nu.studer.credentials">Gradle Credentials plugin</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="plugin-publishing-plugin"><a class="anchor" href="#plugin-publishing-plugin"></a><a class="link" href="#plugin-publishing-plugin">Adding the Plugin Publishing Plugin</a></h4>
<div class="paragraph">
<p>To publish your plugin, add the <code>com.gradle.plugin-publish</code> plugin to your project&#8217;s <code>build.gradle</code> or <code>build.gradle.kts</code> file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.gradle.plugin-publish&quot;) version &quot;1.2.1&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">com.gradle.plugin-publish</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">1.2.1</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The latest version of the Plugin Publishing Plugin can be found on the <a href="https://plugins.gradle.org/plugin/com.gradle.plugin-publish">Gradle Plugin Portal</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Since version 1.0.0 the Plugin Publish Plugin automatically applies the
<a href="java_gradle_plugin.html#java_gradle_plugin">Java Gradle Plugin Development Plugin</a> (assists with developing Gradle plugins) and the
<a href="#publishing_maven">Maven Publish Plugin</a> (generates plugin publication metadata).
If using older versions of the Plugin Publish Plugin, these helper plugins must be applied explicitly.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configure_the_plugin_publishing_plugin"><a class="anchor" href="#configure_the_plugin_publishing_plugin"></a><a class="link" href="#configure_the_plugin_publishing_plugin">Configuring the Plugin Publishing Plugin</a></h4>
<div class="paragraph">
<p>Configure the <code>com.gradle.plugin-publish</code> plugin in your <code>build.gradle</code> or <code>build.gradle.kts</code> file.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">group = &quot;io.github.johndoe&quot; // <b class="conum">(1)</b>
version = &quot;1.0&quot; // <b class="conum">(2)</b>

gradlePlugin { // <b class="conum">(3)</b>
    website = &quot;&lt;substitute your project website&gt;&quot; // <b class="conum">(4)</b>
    vcsUrl = &quot;&lt;uri to project source repository&gt;&quot; // <b class="conum">(5)</b>

    // ... // <b class="conum">(6)</b>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">group = <span class="string"><span class="delimiter">'</span><span class="content">io.github.johndoe</span><span class="delimiter">'</span></span> // <b class="conum">(1)</b>
version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>     // <b class="conum">(2)</b>

gradlePlugin { // <b class="conum">(3)</b>
    website = <span class="string"><span class="delimiter">'</span><span class="content">&lt;substitute your project website&gt;</span><span class="delimiter">'</span></span> // <b class="conum">(4)</b>
    vcsUrl = <span class="string"><span class="delimiter">'</span><span class="content">&lt;uri to project source repository&gt;</span><span class="delimiter">'</span></span> // <b class="conum">(5)</b>

    <span class="comment">// ... </span>// <b class="conum">(6)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Make sure your project has a <code>group</code> set which is used to identify the artifacts (jar and metadata) you publish for your plugins
in the repository of the Gradle Plugin Portal and which is descriptive of the plugin author or the organization the plugins belong too.</p>
</li>
<li>
<p>Set the version of your project, which will also be used as the version of your plugins.</p>
</li>
<li>
<p>Use the <code>gradlePlugin</code> block provided by the <a href="java_gradle_plugin.html#java_gradle_plugin">Java Gradle Plugin Development Plugin</a>
to configure further options for your plugin publication.</p>
</li>
<li>
<p>Set the website for your plugin&#8217;s project.</p>
</li>
<li>
<p>Provide the source repository URI so that others can find it, if they want to contribute.</p>
</li>
<li>
<p>Set specific properties for each plugin you want to publish; see next section.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Define common properties for all plugins, such as group, version, website, and source repository, using the <code>gradlePlugin{}</code> block:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">gradlePlugin { // <b class="conum">(1)</b>
    // ... // <b class="conum">(2)</b>

    plugins { // <b class="conum">(3)</b>
        create(&quot;greetingsPlugin&quot;) { // <b class="conum">(4)</b>
            id = &quot;&lt;your plugin identifier&gt;&quot; // <b class="conum">(5)</b>
            displayName = &quot;&lt;short displayable name for plugin&gt;&quot; // <b class="conum">(6)</b>
            description = &quot;&lt;human-readable description of what your plugin is about&gt;&quot; // <b class="conum">(7)</b>
            tags = listOf(&quot;tags&quot;, &quot;for&quot;, &quot;your&quot;, &quot;plugins&quot;) // <b class="conum">(8)</b>
            implementationClass = &quot;&lt;your plugin class&gt;&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gradlePlugin { // <b class="conum">(1)</b>
    <span class="comment">// ... </span>// <b class="conum">(2)</b>

    plugins { // <b class="conum">(3)</b>
        greetingsPlugin { // <b class="conum">(4)</b>
            id = <span class="string"><span class="delimiter">'</span><span class="content">&lt;your plugin identifier&gt;</span><span class="delimiter">'</span></span> // <b class="conum">(5)</b>
            displayName = <span class="string"><span class="delimiter">'</span><span class="content">&lt;short displayable name for plugin&gt;</span><span class="delimiter">'</span></span> // <b class="conum">(6)</b>
            description = <span class="string"><span class="delimiter">'</span><span class="content">&lt;human-readable description of what your plugin is about&gt;</span><span class="delimiter">'</span></span> // <b class="conum">(7)</b>
            tags.set([<span class="string"><span class="delimiter">'</span><span class="content">tags</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">for</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">your</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">plugins</span><span class="delimiter">'</span></span>]) // <b class="conum">(8)</b>
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">&lt;your plugin class&gt;</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Plugin specific configuration also goes into the <code>gradlePlugin</code> block.</p>
</li>
<li>
<p>This is where we previously added global properties.</p>
</li>
<li>
<p>Each plugin you publish will have its own block inside <code>plugins</code>.</p>
</li>
<li>
<p>The name of a plugin block must be unique for each plugin you publish; this is a property used only locally by your build and will not be part of the publication.</p>
</li>
<li>
<p>Set the unique <code>id</code> of the plugin, as it will be identified in the publication.</p>
</li>
<li>
<p>Set the plugin name in human-readable form.</p>
</li>
<li>
<p>Set a description to be displayed on the portal. It provides useful information to people who want to use your plugin.</p>
</li>
<li>
<p>Specifies the categories your plugin covers. It makes the plugin more likely to be discovered by people needing its functionality.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, consider the configuration for the <a href="https://plugins.gradle.org/plugin/org.ysb33r.gradletest">GradleTest plugin</a>, already published to the Gradle Plugin Portal.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">gradlePlugin {
    website = &quot;https://github.com/ysb33r/gradleTest&quot;
    vcsUrl = &quot;https://github.com/ysb33r/gradleTest.git&quot;
    plugins {
        create(&quot;gradletestPlugin&quot;) {
            id = &quot;org.ysb33r.gradletest&quot;
            displayName = &quot;Plugin for compatibility testing of Gradle plugins&quot;
            description = &quot;A plugin that helps you test your plugin against a variety of Gradle versions&quot;
            tags = listOf(&quot;testing&quot;, &quot;integrationTesting&quot;, &quot;compatibility&quot;)
            implementationClass = &quot;org.ysb33r.gradle.gradletest.GradleTestPlugin&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gradlePlugin {
    website = <span class="string"><span class="delimiter">'</span><span class="content">https://github.com/ysb33r/gradleTest</span><span class="delimiter">'</span></span>
    vcsUrl = <span class="string"><span class="delimiter">'</span><span class="content">https://github.com/ysb33r/gradleTest.git</span><span class="delimiter">'</span></span>
    plugins {
        gradletestPlugin {
            id = <span class="string"><span class="delimiter">'</span><span class="content">org.ysb33r.gradletest</span><span class="delimiter">'</span></span>
            displayName = <span class="string"><span class="delimiter">'</span><span class="content">Plugin for compatibility testing of Gradle plugins</span><span class="delimiter">'</span></span>
            description = <span class="string"><span class="delimiter">'</span><span class="content">A plugin that helps you test your plugin against a variety of Gradle versions</span><span class="delimiter">'</span></span>
            tags.addAll(<span class="string"><span class="delimiter">'</span><span class="content">testing</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">integrationTesting</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">compatibility</span><span class="delimiter">'</span></span>)
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">org.ysb33r.gradle.gradletest.GradleTestPlugin</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you browse the associated page on the Gradle Plugin Portal for the <a href="https://plugins.gradle.org/plugin/org.ysb33r.gradletest">GradleTest plugin</a>, you will see how the specified metadata is displayed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/plugin-portal-plugin-page.png" alt="plugin portal plugin page">
</div>
</div>
<div class="sect4">
<h5 id="sources_javadoc"><a class="anchor" href="#sources_javadoc"></a><a class="link" href="#sources_javadoc">Sources &amp; Javadoc</a></h5>
<div class="paragraph">
<p>The Plugin Publish Plugin automatically generates and publishes the <a href="#sec:java_packaging">Javadoc, and sources JARs</a> for your plugin publication.</p>
</div>
</div>
<div class="sect4">
<h5 id="sign_artifacts"><a class="anchor" href="#sign_artifacts"></a><a class="link" href="#sign_artifacts">Sign artifacts</a></h5>
<div class="paragraph">
<p>Starting from version 1.0.0 of Plugin Publish Plugin, the signing of published plugin artifacts has been made automatic.
To enable it, all that&#8217;s needed is to apply the <a href="signing_plugin.html#signing_plugin"><code>signing</code></a> plugin in your build.</p>
</div>
</div>
<div class="sect4">
<h5 id="shadow_dependencies"><a class="anchor" href="#shadow_dependencies"></a><a class="link" href="#shadow_dependencies">Shadow dependencies</a></h5>
<div class="paragraph">
<p>Starting from version 1.0.0 of Plugin Publish Plugin, shadowing your plugin&#8217;s dependencies (ie, publishing it as a fat jar) has been made automatic.
To enable it, all that&#8217;s needed is to apply the <a href="https://github.com/johnrengelman/shadow"><code>com.github.johnrengelman.shadow</code></a> plugin in your build.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:publishing_your_plugin"><a class="anchor" href="#sec:publishing_your_plugin"></a><a class="link" href="#sec:publishing_your_plugin">Publishing the plugin</a></h4>
<div class="paragraph">
<p>If you publish your plugin internally for use within your organization, you can publish it like any other code artifact.
See the <a href="#publishing_ivy">Ivy</a> and <a href="#publishing_maven">Maven</a> chapters on publishing artifacts.</p>
</div>
<div class="paragraph">
<p>If you are interested in publishing your plugin to be used by the wider Gradle community, you can publish it to <a href="http://plugins.gradle.org">Gradle Plugin Portal</a>.
This site provides the ability to search for and gather information about plugins contributed by the Gradle community.
Please refer to the corresponding <a href="#publishing_portal">section</a> on making your plugin available on this site.</p>
</div>
<div class="sect4">
<h5 id="custom-plugin-repositories"><a class="anchor" href="#custom-plugin-repositories"></a><a class="link" href="#custom-plugin-repositories">Publish locally</a></h5>
<div class="paragraph">
<p>To check how the artifacts of your published plugin look or to use it only locally or internally in your company, you can publish it to any Maven repository, including a local folder.
You only need to <a href="#publishing_maven:repositories">configure repositories for publishing</a>.
Then, you can run the <code>publish</code> task to publish your plugin to all repositories you have defined (but not the Gradle Plugin Portal).</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    repositories {
        maven {
            name = &quot;localPluginRepository&quot;
            url = uri(&quot;../local-plugin-repository&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    repositories {
        maven {
            name = <span class="string"><span class="delimiter">'</span><span class="content">localPluginRepository</span><span class="delimiter">'</span></span>
            url = <span class="string"><span class="delimiter">'</span><span class="content">../local-plugin-repository</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To use the repository in another build, add it to <a href="#sec:custom_plugin_repositories">the repositories of the <code>pluginManagement {}</code> block</a> in your <code>settings.gradle(.kts)</code> file.</p>
</div>
</div>
<div class="sect4">
<h5 id="publish_to_the_plugin_portal"><a class="anchor" href="#publish_to_the_plugin_portal"></a><a class="link" href="#publish_to_the_plugin_portal">Publish to the Plugin Portal</a></h5>
<div class="paragraph">
<p>Publish the plugin by using the <code>publishPlugin</code> task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew publishPlugins</pre>
</div>
</div>
<div class="paragraph">
<p>You can validate your plugins before publishing using the <code>--validate-only</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew publishPlugins --validate-only</pre>
</div>
</div>
<div class="paragraph">
<p>If you have not configured your <code>gradle.properties</code> for the Gradle Plugin Portal, you can specify them on the command-line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew publishPlugins -Pgradle.publish.key=&lt;key&gt; -Pgradle.publish.secret=&lt;secret&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You will encounter a permission failure if you attempt to publish the example Greeting Plugin with the ID used in this section.
That&#8217;s expected and ensures the portal won&#8217;t be overrun with multiple experimental and duplicate greeting-type plugins.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After approval, your plugin will be available on the Gradle Plugin Portal for others to discover and use.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="consume"><a class="anchor" href="#consume"></a><a class="link" href="#consume">Consume the published plugin</a></h4>
<div class="paragraph">
<p>Once you successfully publish a plugin, it won&#8217;t immediately appear on the Portal.
It also needs to pass an approval process, which is manual and relatively slow for the initial version of your plugin, but is fully automatic for subsequent versions.
For further details, see <a href="https://plugins.gradle.org/docs/publish-plugin-new#approval">here</a>.</p>
</div>
<div class="paragraph">
<p>Once your plugin is approved, you can find instructions for its use at a URL of the form <strong>https://plugins.gradle.org/plugin/&lt;your-plugin-id&gt;</strong>.
For example, the Greeting Plugin example is already on the portal at <a href="https://plugins.gradle.org/plugin/org.example.greeting" class="bare">https://plugins.gradle.org/plugin/org.example.greeting</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="plugins_published_without_gradle_plugin_portal"><a class="anchor" href="#plugins_published_without_gradle_plugin_portal"></a><a class="link" href="#plugins_published_without_gradle_plugin_portal">Plugins published without Gradle Plugin Portal</a></h4>
<div class="paragraph">
<p>If your plugin was published without using the <a href="java_gradle_plugin.html#java_gradle_plugin">Java Gradle Plugin Development Plugin</a>, the publication will be lacking <a href="#sec:plugin_markers">Plugin Marker Artifact</a>, which is needed for <a href="#sec:plugins_block">plugins DSL</a> to locate the plugin.
In this case, the recommended way to resolve the plugin in another project is to add a <code>resolutionStrategy</code> section to the <code>pluginManagement {}</code> block of the project&#8217;s settings file, as shown below.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">resolutionStrategy {
    eachPlugin {
        if (requested.id.namespace == &quot;org.example&quot;) {
            useModule(&quot;org.example:custom-plugin:${requested.version}&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">resolutionStrategy {
    eachPlugin {
        <span class="keyword">if</span> (requested.id.namespace == <span class="string"><span class="delimiter">'</span><span class="content">org.example</span><span class="delimiter">'</span></span>) {
            useModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example:custom-plugin:</span><span class="inline"><span class="inline-delimiter">${</span>requested.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="other_topics_2"><a class="anchor" href="#other_topics_2"></a><a class="link" href="#other_topics_2">OTHER TOPICS</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="directory_layout"><a class="anchor" href="#directory_layout"></a><a class="link" href="#directory_layout">Gradle-managed Directories</a></h3>
<div class="paragraph">
<p>Gradle uses two main directories to perform and manage its work: the <a href="#dir:gradle_user_home">Gradle User Home directory</a> and the <a href="#dir:project_root">Project Root directory</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/author-gradle-2.png" alt="author gradle 2">
</div>
</div>
<div class="sect3">
<h4 id="dir:gradle_user_home"><a class="anchor" href="#dir:gradle_user_home"></a><a class="link" href="#dir:gradle_user_home">Gradle User Home directory</a></h4>
<div class="paragraph">
<p>By default, the Gradle User Home (<code>~/.gradle</code> or <code>C:\Users\&lt;USERNAME&gt;\.gradle</code>) stores global configuration properties, initialization scripts, caches, and log files.</p>
</div>
<div class="paragraph">
<p>It can be set with the environment variable <code>GRADLE_USER_HOME</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Not to be confused with the <code>GRADLE_HOME</code>, the optional installation directory for Gradle.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is roughly structured as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>├── caches // <b class="conum">(1)</b>
│   ├── 4.8 // <b class="conum">(2)</b>
│   ├── 4.9 // <b class="conum">(2)</b>
│   ├── ⋮
│   ├── jars-3 // <b class="conum">(3)</b>
│   └── modules-2 // <b class="conum">(3)</b>
├── daemon // <b class="conum">(4)</b>
│   ├── ⋮
│   ├── 4.8
│   └── 4.9
├── init.d // <b class="conum">(5)</b>
│   └── my-setup.gradle
├── jdks // <b class="conum">(6)</b>
│   ├── ⋮
│   └── jdk-14.0.2+12
├── wrapper
│   └── dists // <b class="conum">(7)</b>
│       ├── ⋮
│       ├── gradle-4.8-bin
│       ├── gradle-4.9-all
│       └── gradle-4.9-bin
└── gradle.properties // <b class="conum">(8)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Global cache directory (for everything that is not project-specific).</p>
</li>
<li>
<p>Version-specific caches (e.g., to support incremental builds).</p>
</li>
<li>
<p>Shared caches (e.g., for artifacts of dependencies).</p>
</li>
<li>
<p>Registry and logs of the <a href="#gradle_daemon">Gradle Daemon</a>.</p>
</li>
<li>
<p>Global <a href="#init_scripts">initialization scripts</a>.</p>
</li>
<li>
<p>JDKs downloaded by the <a href="#sec:provisioning">toolchain support</a>.</p>
</li>
<li>
<p>Distributions downloaded by the <a href="#gradle_wrapper_reference">Gradle Wrapper</a>.</p>
</li>
<li>
<p>Global <a href="#sec:gradle_configuration_properties">Gradle configuration properties</a>.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="dir:gradle_user_home:cache_cleanup"><a class="anchor" href="#dir:gradle_user_home:cache_cleanup"></a><a class="link" href="#dir:gradle_user_home:cache_cleanup">Cleanup of caches and distributions</a></h5>
<div class="paragraph">
<p>Gradle automatically cleans its user home directory.</p>
</div>
<div class="paragraph">
<p>By default, the cleanup runs in the background when the Gradle daemon is stopped or shut down.</p>
</div>
<div class="paragraph">
<p>If using <code>--no-daemon</code>, it runs in the foreground after the build session.</p>
</div>
<div class="paragraph">
<p>The following cleanup strategies are applied periodically (by default, once every 24 hours):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Version-specific caches in all <code>caches/&lt;GRADLE_VERSION&gt;/</code> directories are checked for whether they are still in use.</p>
<div class="paragraph">
<p>If not, directories for release versions are deleted after 30 days of inactivity, and snapshot versions after 7 days.</p>
</div>
</li>
<li>
<p>Shared caches in <code>caches/</code> (e.g., <code>jars-*</code>) are checked for whether they are still in use.</p>
<div class="paragraph">
<p>If no Gradle version still uses them, they are deleted.</p>
</div>
</li>
<li>
<p>Files in shared caches used by the current Gradle version in <code>caches/</code> (e.g., <code>jars-3</code> or <code>modules-2</code>) are checked for when they were last accessed.</p>
<div class="paragraph">
<p>Depending on whether the file can be recreated locally or downloaded from a remote repository, it will be deleted after 7 or 30 days, respectively.</p>
</div>
</li>
<li>
<p>Gradle distributions in <code>wrapper/dists/</code> are checked for whether they are still in use, i.e., whether there&#8217;s a corresponding version-specific cache directory.</p>
<div class="paragraph">
<p>Unused distributions are deleted.</p>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="dir:gradle_user_home:configure_cache_cleanup"><a class="anchor" href="#dir:gradle_user_home:configure_cache_cleanup"></a><a class="link" href="#dir:gradle_user_home:configure_cache_cleanup">Configuring cleanup of caches and distributions</a></h6>
<div class="paragraph">
<p>The retention periods of the various caches can be configured.</p>
</div>
<div class="paragraph">
<p>Caches are classified into five categories:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Released wrapper distributions:</strong> Distributions and related version-specific caches corresponding to released versions (e.g., <code>4.6.2</code> or <code>8.0</code>).</p>
<div class="paragraph">
<p>Default retention for unused versions is 30 days.</p>
</div>
</li>
<li>
<p><strong>Snapshot wrapper distributions:</strong> Distributions and related version-specific caches corresponding to snapshot versions (e.g. <code>7.6-20221130141522+0000</code>).</p>
<div class="paragraph">
<p>Default retention for unused versions is 7 days.</p>
</div>
</li>
<li>
<p><strong>Downloaded resources:</strong> Shared caches downloaded from a remote repository (e.g., cached dependencies).</p>
<div class="paragraph">
<p>Default retention for unused resources is 30 days.</p>
</div>
</li>
<li>
<p><strong>Created resources:</strong> Shared caches that Gradle creates during a build (e.g., artifact transforms).</p>
<div class="paragraph">
<p>Default retention for unused resources is 7 days.</p>
</div>
</li>
<li>
<p><strong>Build cache:</strong> The local build cache (e.g., build-cache-1).</p>
<div class="paragraph">
<p>Default retention for unused build-cache entries is 7 days.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The retention period for each category can be configured independently via an <a href="#init_scripts">init script</a> in the Gradle User Home:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradleUserHome/init.d/cache-settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">beforeSettings {
    caches {
        releasedWrappers.setRemoveUnusedEntriesAfterDays(45)
        snapshotWrappers.setRemoveUnusedEntriesAfterDays(10)
        downloadedResources.setRemoveUnusedEntriesAfterDays(45)
        createdResources.setRemoveUnusedEntriesAfterDays(10)
        buildCache.setRemoveUnusedEntriesAfterDays(5)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradleUserHome/init.d/cache-settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beforeSettings { settings -&gt;
    settings.caches {
        releasedWrappers.removeUnusedEntriesAfterDays = <span class="integer">45</span>
        snapshotWrappers.removeUnusedEntriesAfterDays = <span class="integer">10</span>
        downloadedResources.removeUnusedEntriesAfterDays = <span class="integer">45</span>
        createdResources.removeUnusedEntriesAfterDays = <span class="integer">10</span>
        buildCache.removeUnusedEntriesAfterDays = <span class="integer">5</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The frequency at which cache cleanup is invoked is also configurable.</p>
</div>
<div class="paragraph">
<p>There are three possible settings:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>DEFAULT:</strong> Cleanup is performed periodically in the background (currently once every 24 hours).</p>
</li>
<li>
<p><strong>DISABLED:</strong> Never cleanup Gradle User Home.</p>
<div class="paragraph">
<p>This is useful in cases where Gradle User Home is ephemeral or delaying cleanup is desirable until an explicit point.</p>
</div>
</li>
<li>
<p><strong>ALWAYS:</strong> Cleanup is performed at the end of each build session.</p>
<div class="paragraph">
<p>This is useful in cases where it&#8217;s desirable to ensure that cleanup has occurred before proceeding.</p>
</div>
<div class="paragraph">
<p>However, this performs cache cleanup during the build (rather than in the background), which can be expensive, so this option should only be used when necessary.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To disable cache cleanup:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradleUserHome/init.d/cache-settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">beforeSettings {
    caches {
        cleanup = Cleanup.DISABLED
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradleUserHome/init.d/cache-settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beforeSettings { settings -&gt;
    settings.caches {
        cleanup = Cleanup.DISABLED
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Cache cleanup settings can only be configured via init scripts and should be placed under the <code>init.d</code> directory in Gradle User Home.
This effectively couples the configuration of cache cleanup to the Gradle User Home those settings apply to and limits the possibility of different conflicting settings from different projects being applied to the same directory.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="dir:gradle_user_home:multi_version_cache_cleanup"><a class="anchor" href="#dir:gradle_user_home:multi_version_cache_cleanup"></a><a class="link" href="#dir:gradle_user_home:multi_version_cache_cleanup">Multiple versions of Gradle sharing a Gradle User Home</a></h6>
<div class="paragraph">
<p>It is common to share a single Gradle User Home between multiple versions of Gradle.</p>
</div>
<div class="paragraph">
<p>As stated above, caches in Gradle User Home are version-specific.
Different versions of Gradle will perform maintenance on only the version-specific caches associated with each version.</p>
</div>
<div class="paragraph">
<p>On the other hand, some caches are shared between versions (e.g., the dependency artifact cache or the artifact transform cache).</p>
</div>
<div class="paragraph">
<p>Beginning with Gradle version 8.0, the cache cleanup settings can be configured to custom retention periods.
However, older versions have fixed retention periods (7 or 30 days, depending on the cache).
These shared caches could be accessed by versions of Gradle with different settings to retain cache artifacts.</p>
</div>
<div class="paragraph">
<p>This means that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the retention period is <em>not</em> customized, all versions that perform cleanup will have the same retention periods. There will be no effect due to sharing a Gradle User Home with multiple versions.</p>
</li>
<li>
<p>If the retention period is customized for Gradle versions greater than or equal to version 8.0 to use retention periods <em>shorter</em> than the previously fixed periods, there will also be no effect.</p>
<div class="paragraph">
<p>The versions of Gradle aware of these settings will cleanup artifacts earlier than the previously fixed retention periods, and older versions will effectively not participate in the cleanup of shared caches.</p>
</div>
</li>
<li>
<p>If the retention period is customized for Gradle versions greater than or equal to version 8.0 to use retention periods <em>longer</em> than the previously fixed periods, the older versions of Gradle may clean the shared caches earlier than what is configured.</p>
<div class="paragraph">
<p>In this case, if it is desirable to maintain these shared cache entries for newer versions for longer retention periods, they will not be able to share a Gradle User Home with older versions. They will need to use a separate directory.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another consideration when sharing the Gradle User Home with versions of Gradle before version 8.0 is that the DSL elements to configure the cache retention settings are unavailable in earlier versions, so this must be accounted for in any init script shared between versions.
This can easily be handled by conditionally applying a version-compliant script.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The version-compliant script should reside somewhere other than the <code>init.d</code> directory (such as a sub-directory), so it is not automatically applied.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure cache cleanup in a version-safe manner:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradleUserHome/init.d/cache-settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">if (GradleVersion.current() &gt;= GradleVersion.version(&quot;8.0&quot;)) {
    apply(from = &quot;gradle8/cache-settings.gradle.kts&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradleUserHome/init.d/cache-settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">if</span> (GradleVersion.current() &gt;= GradleVersion.version(<span class="string"><span class="delimiter">'</span><span class="content">8.0</span><span class="delimiter">'</span></span>)) {
    apply <span class="key">from</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">gradle8/cache-settings.gradle</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Version-compliant cache configuration script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradleUserHome/init.d/gradle8/cache-settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">beforeSettings {
    caches {
        releasedWrappers { setRemoveUnusedEntriesAfterDays(45) }
        snapshotWrappers { setRemoveUnusedEntriesAfterDays(10) }
        downloadedResources { setRemoveUnusedEntriesAfterDays(45) }
        createdResources { setRemoveUnusedEntriesAfterDays(10) }
        buildCache { setRemoveUnusedEntriesAfterDays(5) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradleUserHome/init.d/gradle8/cache-settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beforeSettings { settings -&gt;
    settings.caches {
        releasedWrappers.removeUnusedEntriesAfterDays = <span class="integer">45</span>
        snapshotWrappers.removeUnusedEntriesAfterDays = <span class="integer">10</span>
        downloadedResources.removeUnusedEntriesAfterDays = <span class="integer">45</span>
        createdResources.removeUnusedEntriesAfterDays = <span class="integer">10</span>
        buildCache.removeUnusedEntriesAfterDays = <span class="integer">5</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dir:gradle_user_home:cache_marking"><a class="anchor" href="#dir:gradle_user_home:cache_marking"></a><a class="link" href="#dir:gradle_user_home:cache_marking">Cache marking</a></h5>
<div class="paragraph">
<p>Beginning with Gradle version 8.1, Gradle supports marking caches with a <code>CACHEDIR.TAG</code> file.</p>
</div>
<div class="paragraph">
<p>It follows the format described in <a href="https://bford.info/cachedir/">the Cache Directory Tagging Specification</a>.
The purpose of this file is to allow tools to identify the directories that do not need to be searched or backed up.</p>
</div>
<div class="paragraph">
<p>By default, the directories <code>caches</code>, <code>wrapper/dists</code>, <code>daemon</code>, and <code>jdks</code> in the Gradle User Home are marked with this file.</p>
</div>
<div class="sect5">
<h6 id="dir:gradle_user_home:configure_cache_marking"><a class="anchor" href="#dir:gradle_user_home:configure_cache_marking"></a><a class="link" href="#dir:gradle_user_home:configure_cache_marking">Configuring cache marking</a></h6>
<div class="paragraph">
<p>The cache marking feature can be configured via an init script in the Gradle User Home:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradleUserHome/init.d/cache-settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">beforeSettings {
    caches {
        // Disable cache marking for all caches
        markingStrategy = MarkingStrategy.NONE
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradleUserHome/init.d/cache-settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beforeSettings { settings -&gt;
    settings.caches {
        <span class="comment">// Disable cache marking for all caches</span>
        markingStrategy = MarkingStrategy.NONE
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Cache marking settings can only be configured via init scripts and should be placed under the <code>init.d</code> directory in Gradle User Home. This effectively couples the configuration of cache marking to the Gradle User Home to which those settings apply and limits the possibility of different conflicting settings from different projects being applied to the same directory.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dir:project_root"><a class="anchor" href="#dir:project_root"></a><a class="link" href="#dir:project_root">Project Root directory</a></h4>
<div class="paragraph">
<p>The project root directory contains all source files from your project.</p>
</div>
<div class="paragraph">
<p>It also contains files and directories Gradle generates, such as <code>.gradle</code> and <code>build</code>.</p>
</div>
<div class="paragraph">
<p>While the former are usually checked into source control, the latter are transient files Gradle uses to support features like incremental builds.</p>
</div>
<div class="paragraph">
<p>The anatomy of a typical project root directory looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>├── .gradle // <b class="conum">(1)</b>
│   ├── 4.8 // <b class="conum">(2)</b>
│   ├── 4.9 // <b class="conum">(2)</b>
│   └── ⋮
├── build   // <b class="conum">(3)</b>
├── gradle
│   └── wrapper // <b class="conum">(4)</b>
├── gradle.properties   // <b class="conum">(5)</b>
├── gradlew // <b class="conum">(6)</b>
├── gradlew.bat // <b class="conum">(6)</b>
├── settings.gradle.kts // <b class="conum">(7)</b>
├── subproject-one  // <b class="conum">(8)</b>
|   └── build.gradle.kts    // <b class="conum">(9)</b>
├── subproject-two  // <b class="conum">(8)</b>
|   └── build.gradle.kts    // <b class="conum">(9)</b>
└── ⋮</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Project-specific cache directory generated by Gradle.</p>
</li>
<li>
<p>Version-specific caches (e.g., to support incremental builds).</p>
</li>
<li>
<p>The build directory of this project into which Gradle generates all build artifacts.</p>
</li>
<li>
<p>Contains the JAR file and configuration of the <a href="#gradle_wrapper_reference">Gradle Wrapper</a>.</p>
</li>
<li>
<p>Project-specific <a href="#sec:gradle_configuration_properties">Gradle configuration properties</a>.</p>
</li>
<li>
<p>Scripts for executing builds using the <a href="#gradle_wrapper_reference">Gradle Wrapper</a>.</p>
</li>
<li>
<p>The project&#8217;s <a href="#sec:settings_file_script">settings file</a> where the list of subprojects is defined.</p>
</li>
<li>
<p>Usually, a project is organized into one or multiple subprojects.</p>
</li>
<li>
<p>Each subproject has its own Gradle build script.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="dir:project_root:cache_cleanup"><a class="anchor" href="#dir:project_root:cache_cleanup"></a><a class="link" href="#dir:project_root:cache_cleanup">Project cache cleanup</a></h5>
<div class="paragraph">
<p>From version 4.10 onwards, Gradle automatically cleans the project-specific cache directory.</p>
</div>
<div class="paragraph">
<p>After building the project, version-specific cache directories in <code>.gradle/8.9/</code> are checked periodically (at most, every 24 hours) to determine whether they are still in use.
They are deleted if they haven&#8217;t been used for 7 days.</p>
</div>
<div class="paragraph text-right">
<p><strong>Next Step:</strong> <a href="#build_lifecycle">Learn about the Gradle Build Lifecycle</a> &gt;&gt;</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="working_with_files"><a class="anchor" href="#working_with_files"></a><a class="link" href="#working_with_files">Working With Files</a></h3>
<div class="paragraph">
<p>File operations are fundamental to nearly every Gradle build.
They involve handling source files, managing file dependencies, and generating reports.
Gradle provides a robust API that simplifies these operations, enabling developers to perform necessary file tasks easily.</p>
</div>
<div class="sect3">
<h4 id="sec:hard_coded_file_paths"><a class="anchor" href="#sec:hard_coded_file_paths"></a><a class="link" href="#sec:hard_coded_file_paths">Hardcoded paths and laziness</a></h4>
<div class="paragraph">
<p>It is best practice to <strong>avoid</strong> hardcoded paths in build scripts.</p>
</div>
<div class="paragraph">
<p>In addition to avoiding hardcoded paths, Gradle encourages laziness in its build scripts.
This means that tasks and operations should be deferred until they are actually needed rather than executed eagerly.</p>
</div>
<div class="paragraph">
<p>Many examples in this chapter use hard-coded paths as string literals.
This makes them easy to understand, but it is not good practice.
The problem is that paths often change, and the more places you need to change them, the more likely you will miss one and break the build.</p>
</div>
<div class="paragraph">
<p>Where possible, you should use tasks, task properties, and <a href="properties_providers.html#understanding_properties">project properties</a> — in that order of preference — to configure file paths.</p>
</div>
<div class="paragraph">
<p>For example, if you create a task that packages the compiled classes of a Java application,  you should use an implementation similar to this:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val archivesDirPath = layout.buildDirectory.dir(&quot;archives&quot;)

tasks.register&lt;Zip&gt;(&quot;packageClasses&quot;) {
    archiveAppendix = &quot;classes&quot;
    destinationDirectory = archivesDirPath

    from(tasks.compileJava)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> archivesDirPath = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">archives</span><span class="delimiter">'</span></span>)

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">packageClasses</span><span class="delimiter">'</span></span>, Zip) {
    archiveAppendix = <span class="string"><span class="delimiter">&quot;</span><span class="content">classes</span><span class="delimiter">&quot;</span></span>
    destinationDirectory = archivesDirPath

    from compileJava
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>compileJava</code> task is the source of the files to package, and the project property <code>archivesDirPath</code> stores the location of the archives, as we are likely to use it elsewhere in the build.</p>
</div>
<div class="paragraph">
<p>Using a task directly as an argument like this relies on it having <a href="#sec:task_inputs_outputs">defined outputs</a>, so it won&#8217;t always be possible.
This example could be further improved by relying on the Java plugin&#8217;s convention for <code>destinationDirectory</code> rather than overriding it, but it does demonstrate the use of project properties.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:locating_files"><a class="anchor" href="#sec:locating_files"></a><a class="link" href="#sec:locating_files">Locating files</a></h4>
<div class="paragraph">
<p>To perform some action on a file, you need to know where it is, and that&#8217;s the information provided by file paths.
Gradle builds on the standard Java <code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html">File</a></code> class, which represents the location of a single file and provides APIs for dealing with collections of paths.</p>
</div>
<div class="sect4">
<h5 id="using_projectlayout"><a class="anchor" href="#using_projectlayout"></a><a class="link" href="#using_projectlayout">Using <code>ProjectLayout</code></a></h5>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.file.ProjectLayout.html"><code>ProjectLayout</code></a> class is used to access various directories and files within a project.
It provides methods to retrieve paths to the project directory, build directory, settings file, and other important locations within the project&#8217;s file structure.
This class is particularly useful when you need to work with files in a build script or plugin in different project paths:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val archivesDirPath = layout.buildDirectory.dir(&quot;archives&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> archivesDirPath = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">archives</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can learn more about the <code>ProjectLayout</code> class in <a href="service_injection.html#sec:projectlayout">Services</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:single_file_paths"><a class="anchor" href="#sec:single_file_paths"></a><a class="link" href="#sec:single_file_paths">Using <code>Project.file()</code></a></h5>
<div class="paragraph">
<p>Gradle provides the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> method for specifying the location of a single file or directory.</p>
</div>
<div class="paragraph">
<p>Relative paths are resolved relative to the project directory, while absolute paths remain unchanged.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>Never use <code>new File(relative path)</code> unless passed to <code>file()</code> or <code>files()</code> or <code>from()</code> or other methods defined in terms of <code>file()</code> or <code>files()</code>.
Otherwise, this creates a path relative to the current working directory (CWD).
Gradle can make no guarantees about the location of the CWD, which means builds that rely on it may break at any time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here are some examples of using the <code>file()</code> method with different types of arguments:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Using a relative path
var configFile = file(&quot;src/config.xml&quot;)

// Using an absolute path
configFile = file(configFile.absolutePath)

// Using a File object with a relative path
configFile = file(File(&quot;src/config.xml&quot;))

// Using a java.nio.file.Path object with a relative path
configFile = file(Paths.get(&quot;src&quot;, &quot;config.xml&quot;))

// Using an absolute java.nio.file.Path object
configFile = file(Paths.get(System.getProperty(&quot;user.home&quot;)).resolve(&quot;global-config.xml&quot;))</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Using a relative path</span>
<span class="predefined-type">File</span> configFile = file(<span class="string"><span class="delimiter">'</span><span class="content">src/config.xml</span><span class="delimiter">'</span></span>)

<span class="comment">// Using an absolute path</span>
configFile = file(configFile.absolutePath)

<span class="comment">// Using a File object with a relative path</span>
configFile = file(<span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/config.xml</span><span class="delimiter">'</span></span>))

<span class="comment">// Using a java.nio.file.Path object with a relative path</span>
configFile = file(Paths.get(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">config.xml</span><span class="delimiter">'</span></span>))

<span class="comment">// Using an absolute java.nio.file.Path object</span>
configFile = file(Paths.get(<span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">user.home</span><span class="delimiter">'</span></span>)).resolve(<span class="string"><span class="delimiter">'</span><span class="content">global-config.xml</span><span class="delimiter">'</span></span>))</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, you can pass strings, <code>File</code> instances and <code><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html">Path</a></code> instances to the <code>file()</code> method, all of which result in an absolute <code>File</code> object.</p>
</div>
<div class="paragraph">
<p>In the case of multi-project builds, the <code>file()</code> method will always turn relative paths into paths relative to the current project directory, which may be a child project.</p>
</div>
</div>
<div class="sect4">
<h5 id="using_project_getrootdir"><a class="anchor" href="#using_project_getrootdir"></a><a class="link" href="#using_project_getrootdir">Using <code>Project.getRootDir()</code></a></h5>
<div class="paragraph">
<p>Suppose you want to use a path relative to the <em>root project</em> directory. In that case, you need to use the special <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:rootDir">Project.getRootDir()</a> property to construct an absolute path, like so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val configFile = file(&quot;$rootDir/shared/config.xml&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">File</span> configFile = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>rootDir</span><span class="content">/shared/config.xml</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s say you&#8217;re working on a multi-project build in the directory: <code>dev/projects/AcmeHealth</code>.<br>
The build script above is at: <code>AcmeHealth/subprojects/AcmePatientRecordLib/build.gradle</code>.<br>
The file path will resolve to the absolute of: <code>dev/projects/AcmeHealth/shared/config.xml</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">dev
├── projects
│   ├── AcmeHealth
│   │   ├── subprojects
│   │   │   ├── AcmePatientRecordLib
│   │   │   │   └── build.gradle
│   │   │   └── ...
│   │   ├── shared
│   │   │   └── config.xml
│   │   └── ...
│   └── ...
└── settings.gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>Project</code> also provides <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:rootProject">Project.getRootProject()</a> for multi-project builds which, in the example, would resolve to: <code>dev/projects/AcmeHealth/subprojects/AcmePatientRecordLib</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:file_collections"><a class="anchor" href="#sec:file_collections"></a><a class="link" href="#sec:file_collections">Using <code>FileCollection</code></a></h5>
<div class="paragraph">
<p>A <em>file collection</em> is simply a set of file paths represented by the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a> interface.</p>
</div>
<div class="paragraph">
<p>The set of paths can be <em>any</em> file path.
The file paths don&#8217;t have to be related in any way, so they don&#8217;t have to be in the same directory or have a shared parent directory.</p>
</div>
<div class="paragraph">
<p>The recommended way to specify a collection of files is to use the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ProjectLayout.html#files-java.lang.Object...-">ProjectLayout.files(java.lang.Object...)</a> method, which returns a <code>FileCollection</code> instance.
This flexible method allows you to pass multiple strings, <code>File</code> instances, collections of strings, collections of <code>File</code>s, and more.
You can also pass in tasks as arguments if they have <a href="#sec:task_inputs_outputs">defined outputs</a>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<code>files()</code> properly handles relative paths and <code>File(relative path)</code> instances, resolving them relative to the project directory.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As with the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> method covered in the <a href="#sec:single_file_paths">previous section</a>, all relative paths are evaluated relative to the current project directory.
The following example demonstrates some of the variety of argument types you can use — strings, <code>File</code> instances, lists, or  <code><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html">Path</a>s</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val collection: FileCollection = layout.files(
    &quot;src/file1.txt&quot;,
    File(&quot;src/file2.txt&quot;),
    listOf(&quot;src/file3.csv&quot;, &quot;src/file4.csv&quot;),
    Paths.get(&quot;src&quot;, &quot;file5.txt&quot;)
)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">FileCollection collection = layout.files(<span class="string"><span class="delimiter">'</span><span class="content">src/file1.txt</span><span class="delimiter">'</span></span>,
                                  <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/file2.txt</span><span class="delimiter">'</span></span>),
                                  [<span class="string"><span class="delimiter">'</span><span class="content">src/file3.csv</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">src/file4.csv</span><span class="delimiter">'</span></span>],
                                  Paths.get(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">file5.txt</span><span class="delimiter">'</span></span>))</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>File collections have important attributes in Gradle.
They can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>created lazily</p>
</li>
<li>
<p>iterated over</p>
</li>
<li>
<p>filtered</p>
</li>
<li>
<p>combined</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Lazy creation</em> of a file collection is useful when evaluating the files that make up a collection when a build runs.
In the following example, we query the file system to find out what files exist in a particular directory and then make those into a file collection:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;list&quot;) {
    val projectDirectory = layout.projectDirectory
    doLast {
        var srcDir: File? = null

        val collection = projectDirectory.files({
            srcDir?.listFiles()
        })

        srcDir = projectDirectory.file(&quot;src&quot;).asFile
        println(&quot;Contents of ${srcDir.name}&quot;)
        collection.map { it.relativeTo(projectDirectory.asFile) }.sorted().forEach { println(it) }

        srcDir = projectDirectory.file(&quot;src2&quot;).asFile
        println(&quot;Contents of ${srcDir.name}&quot;)
        collection.map { it.relativeTo(projectDirectory.asFile) }.sorted().forEach { println(it) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">list</span><span class="delimiter">'</span></span>) {
    Directory projectDirectory = layout.projectDirectory
    doLast {
        <span class="predefined-type">File</span> srcDir

        <span class="comment">// Create a file collection using a closure</span>
        collection = projectDirectory.files { srcDir.listFiles() }

        srcDir = projectDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>).asFile
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Contents of </span><span class="inline"><span class="inline-delimiter">$</span>srcDir</span><span class="content">.name</span><span class="delimiter">&quot;</span></span>
        collection.collect { projectDirectory.asFile.relativePath(<span class="local-variable">it</span>) }.sort().each { println <span class="local-variable">it</span> }

        srcDir = projectDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">src2</span><span class="delimiter">'</span></span>).asFile
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Contents of </span><span class="inline"><span class="inline-delimiter">$</span>srcDir</span><span class="content">.name</span><span class="delimiter">&quot;</span></span>
        collection.collect { projectDirectory.asFile.relativePath(<span class="local-variable">it</span>) }.sort().each { println <span class="local-variable">it</span> }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q list
Contents of src
src/dir1
src/file1.txt
Contents of src2
src2/dir1
src2/dir2</pre>
</div>
</div>
<div class="paragraph">
<p>The key to lazy creation is passing a closure (in Groovy) or a <code>Provider</code> (in Kotlin) to the <code>files()</code> method.
Your closure or provider must return a value of a type accepted by <code>files()</code>, such as <code>List&lt;File&gt;</code>, <code>String</code>, or <code>FileCollection</code>.</p>
</div>
<div class="paragraph">
<p><em>Iterating over a file collection</em> can be done through the <code>each()</code> method (in Groovy) or <code>forEach</code> method (in Kotlin) on the collection or using the collection in a <code>for</code> loop.
In both approaches, the file collection is treated as a set of <code>File</code> instances, i.e., your iteration variable will be of type <code>File</code>.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates such iteration.
It also demonstrates how you can convert file collections to other types using the <code>as</code> operator (or supported properties):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Iterate over the files in the collection
collection.forEach { file: File -&gt;
    println(file.name)
}

// Convert the collection to various types
val set: Set&lt;File&gt; = collection.files
val list: List&lt;File&gt; = collection.toList()
val path: String = collection.asPath
val file: File = collection.singleFile

// Add and subtract collections
val union = collection + projectLayout.files(&quot;src/file2.txt&quot;)
val difference = collection - projectLayout.files(&quot;src/file2.txt&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Iterate over the files in the collection</span>
collection.each { <span class="predefined-type">File</span> file -&gt;
    println file.name
}

<span class="comment">// Convert the collection to various types</span>
<span class="predefined-type">Set</span> set = collection.files
<span class="predefined-type">Set</span> set2 = collection <span class="keyword">as</span> <span class="predefined-type">Set</span>
<span class="predefined-type">List</span> list = collection <span class="keyword">as</span> <span class="predefined-type">List</span>
<span class="predefined-type">String</span> path = collection.asPath
<span class="predefined-type">File</span> file = collection.singleFile

<span class="comment">// Add and subtract collections</span>
<span class="keyword">def</span> union = collection + projectLayout.files(<span class="string"><span class="delimiter">'</span><span class="content">src/file2.txt</span><span class="delimiter">'</span></span>)
<span class="keyword">def</span> difference = collection - projectLayout.files(<span class="string"><span class="delimiter">'</span><span class="content">src/file2.txt</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also see at the end of the example <em>how to combine file collections</em> using the <code>+</code> and <code>-</code> operators to merge and subtract them.
An important feature of the resulting file collections is that they are <em>live</em>.
In other words, when you combine file collections this way, the result always reflects what&#8217;s currently in the source file collections, even if they change during the build.</p>
</div>
<div class="paragraph">
<p>For example, imagine <code>collection</code> in the above example gains an extra file or two after <code>union</code> is created.
As long as you use <code>union</code> after those files are added to <code>collection</code>, <code>union</code> will also contain those additional files.
The same goes for the <code>different</code> file collection.</p>
</div>
<div class="paragraph">
<p>Live collections are also important when it comes to <em>filtering</em>.
Suppose you want to use a subset of a file collection.
In that case, you can take advantage of the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileCollection.html#filter-org.gradle.api.specs.Spec-">FileCollection.filter(org.gradle.api.specs.Spec)</a> method to determine which files to "keep".
In the following example, we create a new collection that consists of only the files that end with <code>.txt</code> in the source collection:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val textFiles: FileCollection = collection.filter { f: File -&gt;
    f.name.endsWith(&quot;.txt&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">FileCollection textFiles = collection.filter { <span class="predefined-type">File</span> f -&gt;
    f.name.endsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">.txt</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q filterTextFiles
src/file1.txt
src/file2.txt
src/file5.txt</pre>
</div>
</div>
<div class="paragraph">
<p>If <code>collection</code> changes at any time, either by adding or removing files from itself, then <code>textFiles</code> will immediately reflect the change because it is also a live collection.
Note that the closure you pass to <code>filter()</code> takes a <code>File</code> as an argument and should return a boolean.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:specifying_multiple_files"><a class="anchor" href="#sec:specifying_multiple_files"></a><a class="link" href="#sec:specifying_multiple_files">Understanding implicit conversion to file collections</a></h5>
<div class="paragraph">
<p>Many objects in Gradle have properties which accept a set of input files.
For example, the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a> task has a <code>source</code> property that defines the source files to compile.
You can set the value of this property using any of the types supported by the <a href="#sec:file_collections">files()</a> method, as mentioned in the API docs.
This means you can, for example, set the property to a <code>File</code>, <code>String</code>, collection, <code>FileCollection</code> or even a closure or <code>Provider</code>.</p>
</div>
<div class="paragraph">
<p><strong>This is a feature of specific tasks</strong>!
That means implicit conversion will not happen for just any task that has a <code>FileCollection</code> or <code>FileTree</code> property.
If you want to know whether implicit conversion happens in a particular situation, you will need to read the relevant documentation, such as the corresponding task&#8217;s API docs.
Alternatively, you can remove all doubt by explicitly using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ProjectLayout.html#files-java.lang.Object...-">ProjectLayout.files(java.lang.Object...)</a> in your build.</p>
</div>
<div class="paragraph">
<p>Here are some examples of the different types of arguments that the <code>source</code> property can take:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;JavaCompile&gt;(&quot;compile&quot;) {
    // Use a File object to specify the source directory
    source = fileTree(file(&quot;src/main/java&quot;))

    // Use a String path to specify the source directory
    source = fileTree(&quot;src/main/java&quot;)

    // Use a collection to specify multiple source directories
    source = fileTree(listOf(&quot;src/main/java&quot;, &quot;../shared/java&quot;))

    // Use a FileCollection (or FileTree in this case) to specify the source files
    source = fileTree(&quot;src/main/java&quot;).matching { include(&quot;org/gradle/api/**&quot;) }

    // Using a closure to specify the source files.
    setSource({
        // Use the contents of each zip file in the src dir
        file(&quot;src&quot;).listFiles().filter { it.name.endsWith(&quot;.zip&quot;) }.map { zipTree(it) }
    })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">compile</span><span class="delimiter">'</span></span>, JavaCompile) {

    <span class="comment">// Use a File object to specify the source directory</span>
    source = file(<span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>)

    <span class="comment">// Use a String path to specify the source directory</span>
    source = <span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>

    <span class="comment">// Use a collection to specify multiple source directories</span>
    source = [<span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">../shared/java</span><span class="delimiter">'</span></span>]

    <span class="comment">// Use a FileCollection (or FileTree in this case) to specify the source files</span>
    source = fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>).matching { include <span class="string"><span class="delimiter">'</span><span class="content">org/gradle/api/**</span><span class="delimiter">'</span></span> }

    <span class="comment">// Using a closure to specify the source files.</span>
    source = {
        <span class="comment">// Use the contents of each zip file in the src dir</span>
        file(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>).listFiles().findAll {<span class="local-variable">it</span>.name.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">.zip</span><span class="delimiter">'</span></span>)}.collect { zipTree(<span class="local-variable">it</span>) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>One other thing to note is that properties like <code>source</code> have corresponding methods in core Gradle tasks.
Those methods follow the convention of <em>appending</em> to collections of values rather than replacing them.
Again, this method accepts any of the types supported by the <a href="#sec:file_collections">files()</a> method, as shown here:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;JavaCompile&gt;(&quot;compile&quot;) {
    // Add some source directories use String paths
    source(&quot;src/main/java&quot;, &quot;src/main/groovy&quot;)

    // Add a source directory using a File object
    source(file(&quot;../shared/java&quot;))

    // Add some source directories using a closure
    setSource({ file(&quot;src/test/&quot;).listFiles() })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile {
    <span class="comment">// Add some source directories use String paths</span>
    source <span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">src/main/groovy</span><span class="delimiter">'</span></span>

    <span class="comment">// Add a source directory using a File object</span>
    source file(<span class="string"><span class="delimiter">'</span><span class="content">../shared/java</span><span class="delimiter">'</span></span>)

    <span class="comment">// Add some source directories using a closure</span>
    source { file(<span class="string"><span class="delimiter">'</span><span class="content">src/test/</span><span class="delimiter">'</span></span>).listFiles() }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As this is a common convention, we recommend that you follow it in your own custom tasks.
Specifically, if you plan to add a method to configure a collection-based property, make sure the method appends rather than replaces values.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:file_trees"><a class="anchor" href="#sec:file_trees"></a><a class="link" href="#sec:file_trees">Using <code>FileTree</code></a></h5>
<div class="paragraph">
<p>A <em>file tree</em> is a file collection that retains the directory structure of the files it contains and has the type <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileTree.html">FileTree</a>.
This means all the paths in a file tree must have a shared parent directory.
The following diagram highlights the distinction between file trees and file collections in the typical case of copying files:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/file-collection-vs-file-tree.png" alt="file collection vs file tree">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Although <code>FileTree</code> extends <code>FileCollection</code> (an is-a relationship), their behaviors differ.
In other words, you can use a file tree wherever a file collection is required, but remember that a file collection is a flat list/set of files, while a file tree is a file and directory hierarchy.
To convert a file tree to a flat collection, use the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileTree.html#getFiles--">FileTree.getFiles()</a> property.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The simplest way to create a file tree is to pass a file or directory path to the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:fileTree(java.lang.Object)">Project.fileTree(java.lang.Object)</a> method.
This will create a tree of all the files and directories in that base directory (but not the base directory itself).
The following example demonstrates how to use this method and how to filter the files and directories using Ant-style patterns:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Create a file tree with a base directory
var tree: ConfigurableFileTree = fileTree(&quot;src/main&quot;)

// Add include and exclude patterns to the tree
tree.include(&quot;**/*.java&quot;)
tree.exclude(&quot;**/Abstract*&quot;)

// Create a tree using closure
tree = fileTree(&quot;src&quot;) {
    include(&quot;**/*.java&quot;)
}

// Create a tree using a map
tree = fileTree(&quot;dir&quot; to &quot;src&quot;, &quot;include&quot; to &quot;**/*.java&quot;)
tree = fileTree(&quot;dir&quot; to &quot;src&quot;, &quot;includes&quot; to listOf(&quot;**/*.java&quot;, &quot;**/*.xml&quot;))
tree = fileTree(&quot;dir&quot; to &quot;src&quot;, &quot;include&quot; to &quot;**/*.java&quot;, &quot;exclude&quot; to &quot;**/*test*/**&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Create a file tree with a base directory</span>
ConfigurableFileTree tree = fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src/main</span><span class="delimiter">'</span></span>)

<span class="comment">// Add include and exclude patterns to the tree</span>
tree.include <span class="string"><span class="delimiter">'</span><span class="content">**/*.java</span><span class="delimiter">'</span></span>
tree.exclude <span class="string"><span class="delimiter">'</span><span class="content">**/Abstract*</span><span class="delimiter">'</span></span>

<span class="comment">// Create a tree using closure</span>
tree = fileTree(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>) {
    include <span class="string"><span class="delimiter">'</span><span class="content">**/*.java</span><span class="delimiter">'</span></span>
}

<span class="comment">// Create a tree using a map</span>
tree = fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>, <span class="key">include</span>: <span class="string"><span class="delimiter">'</span><span class="content">**/*.java</span><span class="delimiter">'</span></span>)
tree = fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>, <span class="key">includes</span>: [<span class="string"><span class="delimiter">'</span><span class="content">**/*.java</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.xml</span><span class="delimiter">'</span></span>])
tree = fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>, <span class="key">include</span>: <span class="string"><span class="delimiter">'</span><span class="content">**/*.java</span><span class="delimiter">'</span></span>, <span class="key">exclude</span>: <span class="string"><span class="delimiter">'</span><span class="content">**/*test*/**</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can see more examples of supported patterns in the API docs for <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/util/PatternFilterable.html">PatternFilterable</a>.</p>
</div>
<div class="paragraph">
<p>By default, <code>fileTree()</code> returns a <code>FileTree</code> instance that applies some default exclude patterns for convenience — the same defaults as Ant.
For the complete default exclude list, see <a href="http://ant.apache.org/manual/dirtasks.html#defaultexcludes">the Ant manual</a>.</p>
</div>
<div id="sec:change_default_excludes" class="paragraph">
<p>If those default excludes prove problematic, you can work around the issue by changing the default excludes in the settings script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.apache.tools.ant.DirectoryScanner

DirectoryScanner.removeDefaultExclude(&quot;**/.git&quot;)
DirectoryScanner.removeDefaultExclude(&quot;**/.git/**&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.apache.tools.ant.DirectoryScanner</span>

DirectoryScanner.removeDefaultExclude(<span class="string"><span class="delimiter">'</span><span class="content">**/.git</span><span class="delimiter">'</span></span>)
DirectoryScanner.removeDefaultExclude(<span class="string"><span class="delimiter">'</span><span class="content">**/.git/**</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Gradle does not support changing default excludes during the execution phase.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can do many of the same things with file trees that you can with file collections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>iterate over them (depth first)</p>
</li>
<li>
<p>filter them (using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileTree.html#matching-org.gradle.api.Action-">FileTree.matching(org.gradle.api.Action)</a> and Ant-style patterns)</p>
</li>
<li>
<p>merge them</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also traverse file trees using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileTree.html#visit-org.gradle.api.Action-">FileTree.visit(org.gradle.api.Action)</a> method.
All of these techniques are demonstrated in the following example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Iterate over the contents of a tree
tree.forEach{ file: File -&gt;
    println(file)
}

// Filter a tree
val filtered: FileTree = tree.matching {
    include(&quot;org/gradle/api/**&quot;)
}

// Add trees together
val sum: FileTree = tree + fileTree(&quot;src/test&quot;)

// Visit the elements of the tree
tree.visit {
    println(&quot;${this.relativePath} =&gt; ${this.file}&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Iterate over the contents of a tree</span>
tree.each {<span class="predefined-type">File</span> file -&gt;
    println file
}

<span class="comment">// Filter a tree</span>
FileTree filtered = tree.matching {
    include <span class="string"><span class="delimiter">'</span><span class="content">org/gradle/api/**</span><span class="delimiter">'</span></span>
}

<span class="comment">// Add trees together</span>
FileTree sum = tree + fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src/test</span><span class="delimiter">'</span></span>)

<span class="comment">// Visit the elements of the tree</span>
tree.visit {element -&gt;
    println <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>element</span><span class="content">.relativePath =&gt; </span><span class="inline"><span class="inline-delimiter">$</span>element</span><span class="content">.file</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="copying_files"><a class="anchor" href="#copying_files"></a><a class="link" href="#copying_files">Copying files</a></h4>
<div class="paragraph">
<p>Copying files in Gradle primarily uses <code>CopySpec</code>, a mechanism that makes it easy to manage resources such as source code, configuration files, and other assets in your project build process.</p>
</div>
<div class="sect4">
<h5 id="sec:using_the_copyspec_class"><a class="anchor" href="#sec:using_the_copyspec_class"></a><a class="link" href="#sec:using_the_copyspec_class">Understanding <code>CopySpec</code></a></h5>
<div class="paragraph">
<p><code>CopySpec</code> is a copy specification that allows you to define what files to copy, where to copy them from, and where to copy them.
It provides a flexible and expressive way to specify complex file copying operations, including filtering files based on patterns, renaming files, and including/excluding files based on various criteria.</p>
</div>
<div class="paragraph">
<p><code>CopySpec</code> instances are used in the <code>Copy</code> task to specify the files and directories to be copied.</p>
</div>
<div class="paragraph">
<p><code>CopySpec</code> has two important attributes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It is independent of tasks, allowing you to <em>share copy specs within a build</em>.</p>
</li>
<li>
<p>It is hierarchical, providing <em>fine-grained control</em> within the overall copy specification.</p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="sub:sharing_copy_specs"><a class="anchor" href="#sub:sharing_copy_specs"></a><a class="link" href="#sub:sharing_copy_specs">1. Sharing copy specs</a></h6>
<div class="paragraph">
<p>Consider a build with several tasks that copy a project&#8217;s static website resources or add them to an archive.
One task might copy the resources to a folder for a local HTTP server, and another might package them into a distribution.
You could manually specify the file locations and appropriate inclusions each time they are needed, but human error is more likely to creep in, resulting in inconsistencies between tasks.</p>
</div>
<div class="paragraph">
<p>One solution is the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:copySpec(org.gradle.api.Action)">Project.copySpec(org.gradle.api.Action)</a> method.
This allows you to create a copy spec outside a task, which can then be attached to an appropriate task using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopySpec.html#with-org.gradle.api.file.CopySpec...-">CopySpec.with(org.gradle.api.file.CopySpec&#8230;&#8203;)</a> method.
The following example demonstrates how this is done:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val webAssetsSpec: CopySpec = copySpec {
    from(&quot;src/main/webapp&quot;)
    include(&quot;**/*.html&quot;, &quot;**/*.png&quot;, &quot;**/*.jpg&quot;)
    rename(&quot;(.+)-staging(.+)&quot;, &quot;$1$2&quot;)
}

tasks.register&lt;Copy&gt;(&quot;copyAssets&quot;) {
    into(layout.buildDirectory.dir(&quot;inPlaceApp&quot;))
    with(webAssetsSpec)
}

tasks.register&lt;Zip&gt;(&quot;distApp&quot;) {
    archiveFileName = &quot;my-app-dist.zip&quot;
    destinationDirectory = layout.buildDirectory.dir(&quot;dists&quot;)

    from(appClasses)
    with(webAssetsSpec)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">CopySpec webAssetsSpec = copySpec {
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>
    include <span class="string"><span class="delimiter">'</span><span class="content">**/*.html</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.png</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.jpg</span><span class="delimiter">'</span></span>
    rename <span class="string"><span class="delimiter">'</span><span class="content">(.+)-staging(.+)</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">$1$2</span><span class="delimiter">'</span></span>
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyAssets</span><span class="delimiter">'</span></span>, Copy) {
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">inPlaceApp</span><span class="delimiter">&quot;</span></span>)
    with webAssetsSpec
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">distApp</span><span class="delimiter">'</span></span>, Zip) {
    archiveFileName = <span class="string"><span class="delimiter">'</span><span class="content">my-app-dist.zip</span><span class="delimiter">'</span></span>
    destinationDirectory = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">dists</span><span class="delimiter">'</span></span>)

    from appClasses
    with webAssetsSpec
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Both the <code>copyAssets</code> and <code>distApp</code> tasks will process the static resources under <code>src/main/webapp</code>, as specified by <code>webAssetsSpec</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The configuration defined by <code>webAssetsSpec</code> will <em>not</em> apply to the app classes included by the <code>distApp</code> task.
That&#8217;s because <code>from appClasses</code> is its own child specification independent of <code>with webAssetsSpec</code>.</p>
</div>
<div class="paragraph">
<p>This can be confusing, so it&#8217;s probably best to treat <code>with()</code> as an extra <code>from()</code> specification in the task.
Hence, it doesn&#8217;t make sense to define a standalone copy spec without at least one <code>from()</code> defined.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Suppose you encounter a scenario in which you want to apply the same copy configuration to <em>different</em> sets of files.
In that case, you can share the configuration block directly without using <code>copySpec()</code>.
Here&#8217;s an example that has two independent tasks that happen to want to process image files only:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val webAssetPatterns = Action&lt;CopySpec&gt; {
    include(&quot;**/*.html&quot;, &quot;**/*.png&quot;, &quot;**/*.jpg&quot;)
}

tasks.register&lt;Copy&gt;(&quot;copyAppAssets&quot;) {
    into(layout.buildDirectory.dir(&quot;inPlaceApp&quot;))
    from(&quot;src/main/webapp&quot;, webAssetPatterns)
}

tasks.register&lt;Zip&gt;(&quot;archiveDistAssets&quot;) {
    archiveFileName = &quot;distribution-assets.zip&quot;
    destinationDirectory = layout.buildDirectory.dir(&quot;dists&quot;)

    from(&quot;distResources&quot;, webAssetPatterns)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> webAssetPatterns = {
    include <span class="string"><span class="delimiter">'</span><span class="content">**/*.html</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.png</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.jpg</span><span class="delimiter">'</span></span>
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyAppAssets</span><span class="delimiter">'</span></span>, Copy) {
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">inPlaceApp</span><span class="delimiter">&quot;</span></span>)
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>, webAssetPatterns
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">archiveDistAssets</span><span class="delimiter">'</span></span>, Zip) {
    archiveFileName = <span class="string"><span class="delimiter">'</span><span class="content">distribution-assets.zip</span><span class="delimiter">'</span></span>
    destinationDirectory = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">dists</span><span class="delimiter">'</span></span>)

    from <span class="string"><span class="delimiter">'</span><span class="content">distResources</span><span class="delimiter">'</span></span>, webAssetPatterns
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, we assign the copy configuration to its own variable and apply it to whatever <code>from()</code> specification we want.
This doesn&#8217;t just work for inclusions but also exclusions, file renaming, and file content filtering.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:using_child_copy_specifications"><a class="anchor" href="#sub:using_child_copy_specifications"></a><a class="link" href="#sub:using_child_copy_specifications">2. Using child specifications</a></h6>
<div class="paragraph">
<p>If you only use a single copy spec, the file filtering and renaming will apply to <em>all</em> files copied.
Sometimes, this is what you want, but not always.
Consider the following example that copies files into a directory structure that a Java Servlet container can use to deliver a website:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/exploded-war-child-copy-spec-example.png" alt="exploded war child copy spec example">
</div>
</div>
<div class="paragraph">
<p>This is not a straightforward copy as the <code>WEB-INF</code> directory and its subdirectories don&#8217;t exist within the project, so they must be created during the copy.
In addition, we only want HTML and image files going directly into the root folder — <code>build/explodedWar</code> — and only JavaScript files going into the <code>js</code> directory.
We need separate filter patterns for those two sets of files.</p>
</div>
<div class="paragraph">
<p>The solution is to use <em>child specifications</em>, which can be applied to both <code>from()</code> and <code>into()</code> declarations.
The following task definition does the necessary work:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;nestedSpecs&quot;) {
    into(layout.buildDirectory.dir(&quot;explodedWar&quot;))
    exclude(&quot;**/*staging*&quot;)
    from(&quot;src/dist&quot;) {
        include(&quot;**/*.html&quot;, &quot;**/*.png&quot;, &quot;**/*.jpg&quot;)
    }
    from(sourceSets.main.get().output) {
        into(&quot;WEB-INF/classes&quot;)
    }
    into(&quot;WEB-INF/lib&quot;) {
        from(configurations.runtimeClasspath)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">nestedSpecs</span><span class="delimiter">'</span></span>, Copy) {
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">explodedWar</span><span class="delimiter">&quot;</span></span>)
    exclude <span class="string"><span class="delimiter">'</span><span class="content">**/*staging*</span><span class="delimiter">'</span></span>
    from(<span class="string"><span class="delimiter">'</span><span class="content">src/dist</span><span class="delimiter">'</span></span>) {
        include <span class="string"><span class="delimiter">'</span><span class="content">**/*.html</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.png</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.jpg</span><span class="delimiter">'</span></span>
    }
    from(sourceSets.main.output) {
        into <span class="string"><span class="delimiter">'</span><span class="content">WEB-INF/classes</span><span class="delimiter">'</span></span>
    }
    into(<span class="string"><span class="delimiter">'</span><span class="content">WEB-INF/lib</span><span class="delimiter">'</span></span>) {
        from configurations.runtimeClasspath
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Notice how the <code>src/dist</code> configuration has a nested inclusion specification; it is the child copy spec.
You can, of course, add content filtering and renaming here as required.
A child copy spec is still a copy spec.</p>
</div>
<div class="paragraph">
<p>The above example also demonstrates how you can copy files into a subdirectory of the destination either by using a child <code>into()</code> on a <code>from()</code> or a child <code>from()</code> on an <code>into()</code>.
Both approaches are acceptable, but you should create and follow a convention to ensure consistency across your build files.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t get your <code>into()</code> specifications mixed up.
For a normal copy, one to the filesystem rather than an archive, there should always be <em>one</em> "root" <code>into()</code> that specifies the overall destination directory of the copy.
Any other <code>into()</code> should have a child spec attached, and its path will be relative to the root <code>into()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One final thing to be aware of is that a child copy spec inherits its destination path, include patterns, exclude patterns, copy actions, name mappings, and filters from its parent.
So, be careful where you place your configuration.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:sync_task"><a class="anchor" href="#sec:sync_task"></a><a class="link" href="#sec:sync_task">Using the <code>Sync</code> task</a></h5>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.Sync.html">Sync</a> task, which extends the <code>Copy</code> task, copies the source files into the destination directory and then removes any files from the destination directory which it did not copy.
It synchronizes the contents of a directory with its source.</p>
</div>
<div class="paragraph">
<p>This can be useful for doing things such as installing your application, creating an exploded copy of your archives, or maintaining a copy of the project&#8217;s dependencies.</p>
</div>
<div class="paragraph">
<p>Here is an example that maintains a copy of the project&#8217;s runtime dependencies in the <code>build/libs</code> directory:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Sync&gt;(&quot;libs&quot;) {
    from(configurations[&quot;runtime&quot;])
    into(layout.buildDirectory.dir(&quot;libs&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>, Sync) {
    from configurations.runtime
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also perform the same function in your own tasks with the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:sync(org.gradle.api.Action)">Project.sync(org.gradle.api.Action)</a> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:copying_single_file_example"><a class="anchor" href="#sec:copying_single_file_example"></a><a class="link" href="#sec:copying_single_file_example">Using the <code>Copy</code> task</a></h5>
<div class="paragraph">
<p>You can copy a file by creating an instance of Gradle&#8217;s builtin <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.Copy.html">Copy</a> task and configuring it with the location of the file and where you want to put it.</p>
</div>
<div class="paragraph">
<p>This example mimics copying a generated report into a directory that will be packed into an archive, such as a ZIP or TAR:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyReport&quot;) {
    from(layout.buildDirectory.file(&quot;reports/my-report.pdf&quot;))
    into(layout.buildDirectory.dir(&quot;toArchive&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyReport</span><span class="delimiter">'</span></span>, Copy) {
    from layout.buildDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">reports/my-report.pdf</span><span class="delimiter">&quot;</span></span>)
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">toArchive</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The file and directory paths are then used to specify what file to copy using <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.Copy.html#org.gradle.api.tasks.Copy:from(java.lang.Object[])">Copy.from(java.lang.Object&#8230;&#8203;)</a> and which directory to copy it to using <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.Copy.html#org.gradle.api.tasks.Copy:into(java.lang.Object)">Copy.into(java.lang.Object)</a>.</p>
</div>
<div class="paragraph">
<p>Although hard-coded paths make for simple examples, they make the build brittle.
Using a reliable, single source of truth, such as a task or shared project property, is better.
In the following modified example, we use a report task defined elsewhere that has the report&#8217;s location stored in its <code>outputFile</code> property:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyReport2&quot;) {
    from(myReportTask.flatMap { it.outputFile })
    into(archiveReportsTask.flatMap { it.dirToArchive })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyReport2</span><span class="delimiter">'</span></span>, Copy) {
    from myReportTask.outputFile
    into archiveReportsTask.dirToArchive
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We have also assumed that the reports will be archived by <code>archiveReportsTask</code>, which provides us with the directory that will be archived and hence where we want to put the copies of the reports.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:copying_multiple_files_example"><a class="anchor" href="#sec:copying_multiple_files_example"></a><a class="link" href="#sec:copying_multiple_files_example">Copying multiple files</a></h5>
<div class="paragraph">
<p>You can extend the previous examples to multiple files very easily by providing multiple arguments to <code>from()</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyReportsForArchiving&quot;) {
    from(layout.buildDirectory.file(&quot;reports/my-report.pdf&quot;), layout.projectDirectory.file(&quot;src/docs/manual.pdf&quot;))
    into(layout.buildDirectory.dir(&quot;toArchive&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyReportsForArchiving</span><span class="delimiter">'</span></span>, Copy) {
    from layout.buildDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">reports/my-report.pdf</span><span class="delimiter">&quot;</span></span>), layout.projectDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/docs/manual.pdf</span><span class="delimiter">&quot;</span></span>)
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">toArchive</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Two files are now copied into the archive directory.</p>
</div>
<div class="paragraph">
<p>You can also use multiple <code>from()</code> statements to do the same thing, as shown in the first example of the section <a href="#sec:copying_files">File copying in depth</a>.</p>
</div>
<div class="paragraph">
<p>But what if you want to copy all the PDFs in a directory without specifying each one?
To do this, attach inclusion and/or exclusion patterns to the copy specification.
Here, we use a string pattern to include PDFs only:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyPdfReportsForArchiving&quot;) {
    from(layout.buildDirectory.dir(&quot;reports&quot;))
    include(&quot;*.pdf&quot;)
    into(layout.buildDirectory.dir(&quot;toArchive&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyPdfReportsForArchiving</span><span class="delimiter">'</span></span>, Copy) {
    from layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">reports</span><span class="delimiter">&quot;</span></span>)
    include <span class="string"><span class="delimiter">&quot;</span><span class="content">*.pdf</span><span class="delimiter">&quot;</span></span>
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">toArchive</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>One thing to note, as demonstrated in the following diagram, is that only the PDFs that reside directly in the <code>reports</code> directory are copied:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/copy-with-flat-filter-example.png" alt="copy with flat filter example">
</div>
</div>
<div class="paragraph">
<p>You can include files in subdirectories by using an Ant-style glob pattern (<code>**/*</code>), as done in this updated example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyAllPdfReportsForArchiving&quot;) {
    from(layout.buildDirectory.dir(&quot;reports&quot;))
    include(&quot;**/*.pdf&quot;)
    into(layout.buildDirectory.dir(&quot;toArchive&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyAllPdfReportsForArchiving</span><span class="delimiter">'</span></span>, Copy) {
    from layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">reports</span><span class="delimiter">&quot;</span></span>)
    include <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.pdf</span><span class="delimiter">&quot;</span></span>
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">toArchive</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This task has the following effect:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/copy-with-deep-filter-example.png" alt="copy with deep filter example">
</div>
</div>
<div class="paragraph">
<p>Remember that a deep filter like this has the side effect of copying the directory structure below <code>reports</code> and the files.
If you want to copy the files without the directory structure, you must use an explicit <code>fileTree(<em>dir</em>) { <em>includes</em> }.files</code> expression.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:copying_directories_example"><a class="anchor" href="#sec:copying_directories_example"></a><a class="link" href="#sec:copying_directories_example">Copying directory hierarchies</a></h5>
<div class="paragraph">
<p>You may need to copy files as well as the directory structure in which they reside.
This is the default behavior when you specify a directory as the <code>from()</code> argument, as demonstrated by the following example that copies everything in the <code>reports</code> directory, including all its subdirectories, to the destination:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyReportsDirForArchiving&quot;) {
    from(layout.buildDirectory.dir(&quot;reports&quot;))
    into(layout.buildDirectory.dir(&quot;toArchive&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyReportsDirForArchiving</span><span class="delimiter">'</span></span>, Copy) {
    from layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">reports</span><span class="delimiter">&quot;</span></span>)
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">toArchive</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The key aspect that users need help with is controlling how much of the directory structure goes to the destination.
In the above example, do you get a <code>toArchive/reports</code> directory, or does everything in <code>reports</code> go straight into <code>toArchive</code>?
The answer is the latter. If a directory is part of the <code>from()</code> path, then it <em>won&#8217;t</em> appear in the destination.</p>
</div>
<div class="paragraph">
<p>So how do you ensure that <code>reports</code> itself is copied across, but not any other directory in <code>${layout.buildDirectory}</code>?
The answer is to add it as an include pattern:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyReportsDirForArchiving2&quot;) {
    from(layout.buildDirectory) {
        include(&quot;reports/**&quot;)
    }
    into(layout.buildDirectory.dir(&quot;toArchive&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyReportsDirForArchiving2</span><span class="delimiter">'</span></span>, Copy) {
    from(layout.buildDirectory) {
        include <span class="string"><span class="delimiter">&quot;</span><span class="content">reports/**</span><span class="delimiter">&quot;</span></span>
    }
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">toArchive</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll get the same behavior as before except with one extra directory level in the destination, i.e., <code>toArchive/reports</code>.</p>
</div>
<div class="paragraph">
<p>One thing to note is how the <code>include()</code> directive applies only to the <code>from()</code>, whereas the directive in the previous section applied to the whole task.
These different <a href="#sub:using_child_copy_specifications">levels of granularity</a> in the copy specification allow you to handle most requirements that you will come across easily.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:copying_files"><a class="anchor" href="#sec:copying_files"></a><a class="link" href="#sec:copying_files">Understanding file copying</a></h5>
<div class="paragraph">
<p>The basic process of copying files in Gradle is a simple one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define a task of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.Copy.html">Copy</a></p>
</li>
<li>
<p>Specify which files (and potentially directories) to copy</p>
</li>
<li>
<p>Specify a destination for the copied files</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But this apparent simplicity hides a rich API that allows fine-grained control of which files are copied, where they go, and what happens to them as they are copied — renaming of the files and token substitution of file content are both possibilities, for example.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with the last two items on the list, which involve <a href="#sec:using_the_copyspec_class"><code>CopySpec</code></a>.
The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopySpec.html">CopySpec</a> interface, which the <code>Copy</code> task implements, offers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopySpec.html#from-java.lang.Object...-">CopySpec.from(java.lang.Object&#8230;&#8203;)</a> method to define what to copy</p>
</li>
<li>
<p>An <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopySpec.html#into-java.lang.Object-">CopySpec.into(java.lang.Object)</a> method to define the destination</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>CopySpec</code> has several additional methods that allow you to control the copying process, but these two are the only required ones.
<code>into()</code> is straightforward, requiring a directory path as its argument in any form supported by the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> method.
The <code>from()</code> configuration is far more flexible.</p>
</div>
<div class="paragraph">
<p>Not only does <code>from()</code> accept multiple arguments, it also allows several different types of argument.
For example, some of the most common types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>String</code> — treated as a file path or, if it starts with "file://", a file URI</p>
</li>
<li>
<p>A <code>File</code> — used as a file path</p>
</li>
<li>
<p>A <code>FileCollection</code> or <code>FileTree</code> — all files in the collection are included in the copy</p>
</li>
<li>
<p>A task — the files or directories that form a task&#8217;s <a href="#sec:task_inputs_outputs">defined outputs</a> are included</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In fact, <code>from()</code> accepts all the same arguments as <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(java.lang.Object&#8230;&#8203;)</a> so see that method for a more detailed list of acceptable types.</p>
</div>
<div class="paragraph">
<p>Something else to consider is what type of thing a file path refers to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A file — the file is copied as is</p>
</li>
<li>
<p>A directory — this is effectively treated as a file tree: everything in it, including subdirectories, is copied. However, the directory itself is not included in the copy.</p>
</li>
<li>
<p>A non-existent file — the path is ignored</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example that uses multiple <code>from()</code> specifications, each with a different argument type.
You will probably also notice that <code>into()</code> is configured lazily using a closure (in Groovy) or a Provider (in Kotlin) — a technique that also works with <code>from()</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;anotherCopyTask&quot;) {
    // Copy everything under src/main/webapp
    from(&quot;src/main/webapp&quot;)
    // Copy a single file
    from(&quot;src/staging/index.html&quot;)
    // Copy the output of a task
    from(copyTask)
    // Copy the output of a task using Task outputs explicitly.
    from(tasks[&quot;copyTaskWithPatterns&quot;].outputs)
    // Copy the contents of a Zip file
    from(zipTree(&quot;src/main/assets.zip&quot;))
    // Determine the destination directory later
    into({ getDestDir() })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">anotherCopyTask</span><span class="delimiter">'</span></span>, Copy) {
    <span class="comment">// Copy everything under src/main/webapp</span>
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>
    <span class="comment">// Copy a single file</span>
    from <span class="string"><span class="delimiter">'</span><span class="content">src/staging/index.html</span><span class="delimiter">'</span></span>
    <span class="comment">// Copy the output of a task</span>
    from copyTask
    <span class="comment">// Copy the output of a task using Task outputs explicitly.</span>
    from copyTaskWithPatterns.outputs
    <span class="comment">// Copy the contents of a Zip file</span>
    from zipTree(<span class="string"><span class="delimiter">'</span><span class="content">src/main/assets.zip</span><span class="delimiter">'</span></span>)
    <span class="comment">// Determine the destination directory later</span>
    into { getDestDir() }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that the lazy configuration of <code>into()</code> is different from a <a href="#sub:using_child_copy_specifications">child specification</a>, even though the syntax is similar.
Keep an eye on the number of arguments to distinguish between them.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:project_copy_method"><a class="anchor" href="#sec:project_copy_method"></a><a class="link" href="#sec:project_copy_method">Copying files in your own tasks</a></h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Using the <code>Project.copy</code> method at execution time, as described here, is not compatible with the <a href="#config_cache:requirements:use_project_during_execution">configuration cache</a>.
A possible solution is to implement the task as a proper class and use <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileSystemOperations.html#copy-org.gradle.api.Action-">FileSystemOperations.copy</a> method instead, as described in the <a href="#config_cache:troubleshooting">configuration cache chapter</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Occasionally, you want to copy files or directories as <em>part</em> of a task.
For example, a custom archiving task based on an unsupported archive format might want to copy files to a temporary directory before they are archived.
You still want to take advantage of Gradle&#8217;s copy API without introducing an extra <code>Copy</code> task.</p>
</div>
<div class="paragraph">
<p>The solution is to use the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:copy(org.gradle.api.Action)">Project.copy(org.gradle.api.Action)</a> method.
Configuring it with a copy spec works like the <code>Copy</code> task.
Here&#8217;s a trivial example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;copyMethod&quot;) {
    doLast {
        copy {
            from(&quot;src/main/webapp&quot;)
            into(layout.buildDirectory.dir(&quot;explodedWar&quot;))
            include(&quot;**/*.html&quot;)
            include(&quot;**/*.jsp&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyMethod</span><span class="delimiter">'</span></span>) {
    doLast {
        copy {
            from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>
            into layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">explodedWar</span><span class="delimiter">'</span></span>)
            include <span class="string"><span class="delimiter">'</span><span class="content">**/*.html</span><span class="delimiter">'</span></span>
            include <span class="string"><span class="delimiter">'</span><span class="content">**/*.jsp</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above example demonstrates the basic syntax and also highlights two major limitations of using the <code>copy()</code> method:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>copy()</code> method is not <a href="#incremental_build">incremental</a>.
The example&#8217;s <code>copyMethod</code> task will <em>always</em> execute because it has no information about what files make up the task&#8217;s inputs.
You have to define the task inputs and outputs manually.</p>
</li>
<li>
<p>Using a task as a copy source, i.e., as an argument to <code>from()</code>, won&#8217;t create an automatic task dependency between your task and that copy source.
As such, if you use the <code>copy()</code> method as part of a task action, you must explicitly declare all inputs and outputs to get the correct behavior.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following example shows how to work around these limitations using the <a href="#sec:task_input_output_runtime_api">dynamic API for task inputs and outputs</a>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;copyMethodWithExplicitDependencies&quot;) {
    // up-to-date check for inputs, plus add copyTask as dependency
    inputs.files(copyTask)
        .withPropertyName(&quot;inputs&quot;)
        .withPathSensitivity(PathSensitivity.RELATIVE)
    outputs.dir(&quot;some-dir&quot;) // up-to-date check for outputs
        .withPropertyName(&quot;outputDir&quot;)
    doLast {
        copy {
            // Copy the output of copyTask
            from(copyTask)
            into(&quot;some-dir&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyMethodWithExplicitDependencies</span><span class="delimiter">'</span></span>) {
    <span class="comment">// up-to-date check for inputs, plus add copyTask as dependency</span>
    inputs.files(copyTask)
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">inputs</span><span class="delimiter">&quot;</span></span>)
        .withPathSensitivity(PathSensitivity.RELATIVE)
    outputs.dir(<span class="string"><span class="delimiter">'</span><span class="content">some-dir</span><span class="delimiter">'</span></span>) <span class="comment">// up-to-date check for outputs</span>
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">outputDir</span><span class="delimiter">&quot;</span></span>)
    doLast {
        copy {
            <span class="comment">// Copy the output of copyTask</span>
            from copyTask
            into <span class="string"><span class="delimiter">'</span><span class="content">some-dir</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>These limitations make it preferable to use the <code>Copy</code> task wherever possible because of its built-in support for incremental building and task dependency inference.
That is why the <code>copy()</code> method is intended for use by <a href="#custom_tasks">custom tasks</a> that need to copy files as part of their function.
Custom tasks that use the <code>copy()</code> method should declare the necessary inputs and outputs relevant to the copy action.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="renaming_files"><a class="anchor" href="#renaming_files"></a><a class="link" href="#renaming_files">Renaming files</a></h4>
<div class="paragraph">
<p>Renaming files in Gradle can be done using the <code>CopySpec</code> API, which provides methods for renaming files as they are copied.</p>
</div>
<div class="sect4">
<h5 id="sec:renaming_files_example"><a class="anchor" href="#sec:renaming_files_example"></a><a class="link" href="#sec:renaming_files_example">Using <code>Copy.rename()</code></a></h5>
<div class="paragraph">
<p>If the files used and generated by your builds sometimes don&#8217;t have names that suit, you can rename those files as you copy them.
Gradle allows you to do this as part of a copy specification using the <code>rename()</code> configuration.</p>
</div>
<div class="paragraph">
<p>The following example removes the "-staging" marker from the names of any files that have it:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyFromStaging&quot;) {
    from(&quot;src/main/webapp&quot;)
    into(layout.buildDirectory.dir(&quot;explodedWar&quot;))

    rename(&quot;(.+)-staging(.+)&quot;, &quot;$1$2&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyFromStaging</span><span class="delimiter">'</span></span>, Copy) {
    from <span class="string"><span class="delimiter">&quot;</span><span class="content">src/main/webapp</span><span class="delimiter">&quot;</span></span>
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">explodedWar</span><span class="delimiter">'</span></span>)

    rename <span class="string"><span class="delimiter">'</span><span class="content">(.+)-staging(.+)</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">$1$2</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As in the above example, you can use regular expressions for this or closures that use more complex logic to determine the target filename.
For example, the following task truncates filenames:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyWithTruncate&quot;) {
    from(layout.buildDirectory.dir(&quot;reports&quot;))
    rename { filename: String -&gt;
        if (filename.length &gt; 10) {
            filename.slice(0..7) + &quot;~&quot; + filename.length
        }
        else filename
    }
    into(layout.buildDirectory.dir(&quot;toArchive&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyWithTruncate</span><span class="delimiter">'</span></span>, Copy) {
    from layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">reports</span><span class="delimiter">&quot;</span></span>)
    rename { <span class="predefined-type">String</span> filename -&gt;
        <span class="keyword">if</span> (filename.size() &gt; <span class="integer">10</span>) {
            <span class="keyword">return</span> filename[<span class="integer">0</span>..<span class="integer">7</span>] + <span class="string"><span class="delimiter">&quot;</span><span class="content">~</span><span class="delimiter">&quot;</span></span> + filename.size()
        }
        <span class="keyword">else</span> <span class="keyword">return</span> filename
    }
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">toArchive</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As with filtering, you can also rename a subset of files by configuring it as part of a child specification on a <code>from()</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:renaming_files"><a class="anchor" href="#sec:renaming_files"></a><a class="link" href="#sec:renaming_files">Using <code>Copyspec.rename{}</code></a></h5>
<div class="paragraph">
<p>The <a href="#sec:renaming_files_example">example of how to rename files on copy</a> gives you most of the information you need to perform this operation.
It demonstrates the two options for renaming:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using a regular expression</p>
</li>
<li>
<p>Using a closure</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Regular expressions are a flexible approach to renaming, particularly as Gradle supports regex groups that allow you to remove and replace parts of the source filename.
The following example shows how you can remove the string "-staging" from any filename that contains it using a simple regular expression:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;rename&quot;) {
    from(&quot;src/main/webapp&quot;)
    into(layout.buildDirectory.dir(&quot;explodedWar&quot;))
    // Use a regular expression to map the file name
    rename(&quot;(.+)-staging(.+)&quot;, &quot;$1$2&quot;)
    rename(&quot;(.+)-staging(.+)&quot;.toRegex().pattern, &quot;$1$2&quot;)
    // Use a closure to convert all file names to upper case
    rename { fileName: String -&gt;
        fileName.toUpperCase()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">rename</span><span class="delimiter">'</span></span>, Copy) {
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">explodedWar</span><span class="delimiter">'</span></span>)
    <span class="comment">// Use a regular expression to map the file name</span>
    rename <span class="string"><span class="delimiter">'</span><span class="content">(.+)-staging(.+)</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">$1$2</span><span class="delimiter">'</span></span>
    rename(<span class="regexp"><span class="delimiter">/</span><span class="content">(.+)-staging(.+)</span><span class="delimiter">/</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">$1$2</span><span class="delimiter">'</span></span>)
    <span class="comment">// Use a closure to convert all file names to upper case</span>
    rename { <span class="predefined-type">String</span> fileName -&gt;
        fileName.toUpperCase()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use any regular expression supported by the Java <code><a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Pattern</a></code> class and the substitution string.
The second argument of <code>rename()</code> works on the same principles as the <code><a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html#appendReplacement(java.lang.StringBuffer,%20java.lang.String)">Matcher.appendReplacement()</a></code> method.</p>
</div>
<div class="openblock">
<div class="title">Regular expressions in Groovy build scripts</div>
<div class="content">
<div class="paragraph">
<p>There are two common issues people come across when using regular expressions in this context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you use a slashy string (those delimited by '/') for the first argument, you <em>must</em> include the parentheses for <code>rename()</code> as shown in the above example.</p>
</li>
<li>
<p>It&#8217;s safest to use single quotes for the second argument, otherwise you need to escape the '$' in group substitutions, i.e. <code>"\$1\$2"</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first is a minor inconvenience, but slashy strings have the advantage that you don&#8217;t have to escape backslash ('\') characters in the regular expression.
The second issue stems from Groovy&#8217;s support for embedded expressions using <code>${ }</code> syntax in double-quoted and slashy strings.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The closure syntax for <code>rename()</code> is straightforward and can be used for any requirements that simple regular expressions can&#8217;t handle.
You&#8217;re given a file&#8217;s name, and you return a new name for that file or <code>null</code> if you don&#8217;t want to change the name.
Be aware that the closure will be executed for every file copied, so try to avoid expensive operations where possible.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="filtering_files"><a class="anchor" href="#filtering_files"></a><a class="link" href="#filtering_files">Filtering files</a></h4>
<div class="paragraph">
<p>Filtering files in Gradle involves selectively including or excluding files based on certain criteria.</p>
</div>
<div class="sect4">
<h5 id="using_copyspec_include_and_copyspec_exclude"><a class="anchor" href="#using_copyspec_include_and_copyspec_exclude"></a><a class="link" href="#using_copyspec_include_and_copyspec_exclude">Using <code>CopySpec.include()</code> and <code>CopySpec.exclude()</code></a></h5>
<div class="paragraph">
<p>You can apply filtering in any copy specification through the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopySpec.html#include-java.lang.String...-">CopySpec.include(java.lang.String&#8230;&#8203;)</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopySpec.html#exclude-java.lang.String...-">CopySpec.exclude(java.lang.String&#8230;&#8203;)</a> methods.</p>
</div>
<div class="paragraph">
<p>These methods are typically used with Ant-style include or exclude patterns, as described in <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/util/PatternFilterable.html">PatternFilterable</a>.</p>
</div>
<div class="paragraph">
<p>You can also perform more complex logic by using a closure that takes a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileTreeElement.html">FileTreeElement</a> and returns <code>true</code> if the file should be included or <code>false</code> otherwise.
The following example demonstrates both forms, ensuring that only <code>.html</code> and <code>.jsp</code> files are copied, except for those <code>.html</code> files with the word "DRAFT" in their content:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyTaskWithPatterns&quot;) {
    from(&quot;src/main/webapp&quot;)
    into(layout.buildDirectory.dir(&quot;explodedWar&quot;))
    include(&quot;**/*.html&quot;)
    include(&quot;**/*.jsp&quot;)
    exclude { details: FileTreeElement -&gt;
        details.file.name.endsWith(&quot;.html&quot;) &amp;&amp;
            details.file.readText().contains(&quot;DRAFT&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyTaskWithPatterns</span><span class="delimiter">'</span></span>, Copy) {
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">explodedWar</span><span class="delimiter">'</span></span>)
    include <span class="string"><span class="delimiter">'</span><span class="content">**/*.html</span><span class="delimiter">'</span></span>
    include <span class="string"><span class="delimiter">'</span><span class="content">**/*.jsp</span><span class="delimiter">'</span></span>
    exclude { FileTreeElement details -&gt;
        details.file.name.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">.html</span><span class="delimiter">'</span></span>) &amp;&amp;
            details.file.text.contains(<span class="string"><span class="delimiter">'</span><span class="content">DRAFT</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A question you may ask yourself at this point is what happens when inclusion and exclusion patterns overlap? Which pattern wins? Here are the basic rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there are no explicit inclusions or exclusions, everything is included</p>
</li>
<li>
<p>If at least one inclusion is specified, only files and directories matching the patterns are included</p>
</li>
<li>
<p>Any exclusion pattern overrides any inclusions, so if a file or directory matches at least one exclusion pattern, it won&#8217;t be included, regardless of the inclusion patterns</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bear these rules in mind when creating combined inclusion and exclusion specifications so that you end up with the exact behavior you want.</p>
</div>
<div class="paragraph">
<p>Note that the inclusions and exclusions in the above example will apply to <em>all</em> <code>from()</code> configurations.
If you want to apply filtering to a subset of the copied files, you&#8217;ll need to use <a href="#sub:using_child_copy_specifications">child specifications</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:filtering_files"><a class="anchor" href="#sec:filtering_files"></a><a class="link" href="#sec:filtering_files">Filtering file content</a></h4>
<div class="paragraph">
<p>Filtering file content in Gradle involves replacing placeholders or tokens in files with dynamic values.</p>
</div>
<div class="sect4">
<h5 id="using_copyspec_filter"><a class="anchor" href="#using_copyspec_filter"></a><a class="link" href="#using_copyspec_filter">Using <code>CopySpec.filter()</code></a></h5>
<div class="paragraph">
<p>Transforming the content of files while they are being copied involves basic templating that uses token substitution, removal of lines of text, or even more complex filtering using a full-blown template engine.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates several forms of filtering, including token substitution using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopySpec.html#expand-java.util.Map-">CopySpec.expand(java.util.Map)</a> method and another using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopySpec.html#filter-java.lang.Class-">CopySpec.filter(java.lang.Class)</a> with an <a href="https://ant.apache.org/manual/Types/filterchain.html">Ant filter</a>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.apache.tools.ant.filters.FixCrLfFilter
import org.apache.tools.ant.filters.ReplaceTokens
tasks.register&lt;Copy&gt;(&quot;filter&quot;) {
    from(&quot;src/main/webapp&quot;)
    into(layout.buildDirectory.dir(&quot;explodedWar&quot;))
    // Substitute property tokens in files
    expand(&quot;copyright&quot; to &quot;2009&quot;, &quot;version&quot; to &quot;2.3.1&quot;)
    // Use some of the filters provided by Ant
    filter(FixCrLfFilter::class)
    filter(ReplaceTokens::class, &quot;tokens&quot; to mapOf(&quot;copyright&quot; to &quot;2009&quot;, &quot;version&quot; to &quot;2.3.1&quot;))
    // Use a closure to filter each line
    filter { line: String -&gt;
        &quot;[$line]&quot;
    }
    // Use a closure to remove lines
    filter { line: String -&gt;
        if (line.startsWith('-')) null else line
    }
    filteringCharset = &quot;UTF-8&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.apache.tools.ant.filters.FixCrLfFilter</span>
<span class="keyword">import</span> <span class="include">org.apache.tools.ant.filters.ReplaceTokens</span>

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">filter</span><span class="delimiter">'</span></span>, Copy) {
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">explodedWar</span><span class="delimiter">'</span></span>)
    <span class="comment">// Substitute property tokens in files</span>
    expand(<span class="key">copyright</span>: <span class="string"><span class="delimiter">'</span><span class="content">2009</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">2.3.1</span><span class="delimiter">'</span></span>)
    <span class="comment">// Use some of the filters provided by Ant</span>
    filter(FixCrLfFilter)
    filter(ReplaceTokens, <span class="key">tokens</span>: [<span class="key">copyright</span>: <span class="string"><span class="delimiter">'</span><span class="content">2009</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">2.3.1</span><span class="delimiter">'</span></span>])
    <span class="comment">// Use a closure to filter each line</span>
    filter { <span class="predefined-type">String</span> line -&gt;
        <span class="string"><span class="delimiter">&quot;</span><span class="content">[</span><span class="inline"><span class="inline-delimiter">$</span>line</span><span class="content">]</span><span class="delimiter">&quot;</span></span>
    }
    <span class="comment">// Use a closure to remove lines</span>
    filter { <span class="predefined-type">String</span> line -&gt;
        line.startsWith(<span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>) ? <span class="predefined-constant">null</span> : line
    }
    filteringCharset = <span class="string"><span class="delimiter">'</span><span class="content">UTF-8</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>filter()</code> method has two variants, which behave differently:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one takes a <code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/FilterReader.html">FilterReader</a></code> and is designed to work with Ant filters, such as <code>ReplaceTokens</code></p>
</li>
<li>
<p>one takes a closure or <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Transformer.html">Transformer</a> that defines the transformation for each line of the source file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that both variants assume the source files are text-based.
When you use the <code>ReplaceTokens</code> class with <code>filter()</code>, you create a template engine that replaces tokens of the form <code>@tokenName@</code> (the Ant-style token) with values you define.</p>
</div>
</div>
<div class="sect4">
<h5 id="using_copyspec_expand"><a class="anchor" href="#using_copyspec_expand"></a><a class="link" href="#using_copyspec_expand">Using <code>CopySpec.expand()</code></a></h5>
<div class="paragraph">
<p>The <code>expand()</code> method treats the source files as <a href="https://docs.groovy-lang.org/latest/html/api/groovy/text/SimpleTemplateEngine.html">Groovy templates</a>, which evaluates and expands expressions of the form <code>${expression}.</code></p>
</div>
<div class="paragraph">
<p>You can pass in property names and values that are then expanded in the source files. <code>expand()</code> allows for more than basic token substitution as the embedded expressions are full-blown Groovy expressions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Specifying the character set when reading and writing the file is good practice.
Otherwise, the transformations won&#8217;t work properly for non-ASCII text.
You configure the character set with the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopySpec.html#setFilteringCharset-java.lang.String-">CopySpec.setFilteringCharset(String)</a> property.
If it&#8217;s not specified, the JVM default character set is used, which will likely differ from the one you want.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:setting_file_permissions"><a class="anchor" href="#sec:setting_file_permissions"></a><a class="link" href="#sec:setting_file_permissions">Setting file permissions</a></h4>
<div class="paragraph">
<p>Setting file permissions in Gradle involves specifying the permissions for files or directories created or modified during the build process.</p>
</div>
<div class="sect4">
<h5 id="using_copyspec_filepermissions"><a class="anchor" href="#using_copyspec_filepermissions"></a><a class="link" href="#using_copyspec_filepermissions">Using <code>CopySpec.filePermissions{}</code></a></h5>
<div class="paragraph">
<p>For any <code>CopySpec</code> involved in copying files, may it be the <code>Copy</code> task itself, or any child specifications, you can explicitly set the permissions the destination files will have via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopyProcessingSpec.html#filePermissions-org.gradle.api.Action-">CopySpec.filePermissions {}</a> configurations block.</p>
</div>
</div>
<div class="sect4">
<h5 id="using_copyspec_dirpermissions"><a class="anchor" href="#using_copyspec_dirpermissions"></a><a class="link" href="#using_copyspec_dirpermissions">Using <code>CopySpec.dirPermissions{}</code></a></h5>
<div class="paragraph">
<p>You can do the same for directories too, independently of files, via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopyProcessingSpec.html#dirPermissions-org.gradle.api.Action-">CopySpec.dirPermissions {}</a> configurations block.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Not setting permissions explicitly will preserve the permissions of the original files or directories.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;permissions&quot;) {
    from(&quot;src/main/webapp&quot;)
    into(layout.buildDirectory.dir(&quot;explodedWar&quot;))
    filePermissions {
        user {
            read = true
            execute = true
        }
        other.execute = false
    }
    dirPermissions {
        unix(&quot;r-xr-x---&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">permissions</span><span class="delimiter">'</span></span>, Copy) {
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">explodedWar</span><span class="delimiter">'</span></span>)
    filePermissions {
        user {
            read = <span class="predefined-constant">true</span>
            execute = <span class="predefined-constant">true</span>
        }
        other.execute = <span class="predefined-constant">false</span>
    }
    dirPermissions {
        unix(<span class="string"><span class="delimiter">'</span><span class="content">r-xr-x---</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For a detailed description of file permissions, see <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FilePermissions.html">FilePermissions</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/UserClassFilePermissions.html">UserClassFilePermissions</a>.
For details on the convenience method used in the samples, see <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ConfigurableFilePermissions.html#unix-java.lang.String-">ConfigurableFilePermissions.unix(String)</a>.</p>
</div>
<div class="paragraph">
<p>Using empty configuration blocks for file or directory permissions still sets them explicitly, just to fixed default values.
Everything inside one of these configuration blocks is relative to the default values.
Default permissions differ for files and directories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>file</strong>: read &amp; write for <strong>owner</strong>, read for <strong>group</strong>, read for <strong>other</strong> (<strong>0644</strong>, <strong>rw-r&#8212;&#8203;r--</strong>)</p>
</li>
<li>
<p><strong>directory</strong>: read, write &amp; execute for <strong>owner</strong>, read &amp; execute for <strong>group</strong>, read &amp; execute for <strong>other</strong> (<strong>0755</strong>, <strong>rwxr-xr-x</strong>)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:moving_files_example"><a class="anchor" href="#sec:moving_files_example"></a><a class="link" href="#sec:moving_files_example">Moving files and directories</a></h4>
<div class="paragraph">
<p>Moving files and directories in Gradle is a straightforward process that can be accomplished using several APIs.
When implementing file-moving logic in your build scripts, it&#8217;s important to consider file paths, conflicts, and task dependencies.</p>
</div>
<div class="sect4">
<h5 id="using_file_renameto"><a class="anchor" href="#using_file_renameto"></a><a class="link" href="#using_file_renameto">Using <code>File.renameTo()</code></a></h5>
<div class="paragraph">
<p><code>File.renameTo()</code> is a method in Java (and by extension, in Gradle&#8217;s Groovy DSL) used to rename or move a file or directory.
When you call <code>renameTo()</code> on a <code>File</code> object, you provide another <code>File</code> object representing the new name or location.
If the operation is successful, <code>renameTo()</code> returns <code>true</code>; otherwise, it returns <code>false</code>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s important to note that <code>renameTo()</code> has some limitations and platform-specific behavior.</p>
</div>
<div class="paragraph">
<p>In this example, the <code>moveFile</code> task uses the <code>Copy</code> task type to specify the source and destination directories.
Inside the <code>doLast</code> closure, it uses <code>File.renameTo()</code> to move the file from the source directory to the destination directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task moveFile {
    doLast {
        <span class="keyword">def</span> sourceFile = file(<span class="string"><span class="delimiter">'</span><span class="content">source.txt</span><span class="delimiter">'</span></span>)
        <span class="keyword">def</span> destFile = file(<span class="string"><span class="delimiter">'</span><span class="content">destination/new_name.txt</span><span class="delimiter">'</span></span>)

        <span class="keyword">if</span> (sourceFile.renameTo(destFile)) {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">File moved successfully.</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using_the_copy_task"><a class="anchor" href="#using_the_copy_task"></a><a class="link" href="#using_the_copy_task">Using the <code>Copy</code> task</a></h5>
<div class="paragraph">
<p>In this example, the <code>moveFile</code> task copies the file <code>source.txt</code> to the destination directory and renames it to <code>new_name.txt</code> in the process.
This achieves a similar effect to moving a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task moveFile(<span class="key">type</span>: Copy) {
    from <span class="string"><span class="delimiter">'</span><span class="content">source.txt</span><span class="delimiter">'</span></span>
    into <span class="string"><span class="delimiter">'</span><span class="content">destination</span><span class="delimiter">'</span></span>
    rename { fileName -&gt;
        <span class="string"><span class="delimiter">'</span><span class="content">new_name.txt</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:deleting_files_example"><a class="anchor" href="#sec:deleting_files_example"></a><a class="link" href="#sec:deleting_files_example">Deleting files and directories</a></h4>
<div class="paragraph">
<p>Deleting files and directories in Gradle involves removing them from the file system.</p>
</div>
<div class="sect4">
<h5 id="using_the_delete_task"><a class="anchor" href="#using_the_delete_task"></a><a class="link" href="#using_the_delete_task">Using the <code>Delete</code> task</a></h5>
<div class="paragraph">
<p>You can easily delete files and directories using the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.Delete.html">Delete</a> task.
You must specify which files and directories to delete in a way supported by the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(java.lang.Object&#8230;&#8203;)</a> method.</p>
</div>
<div class="paragraph">
<p>For example, the following task deletes the entire contents of a build&#8217;s output directory:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Delete&gt;(&quot;myClean&quot;) {
    delete(buildDir)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">myClean</span><span class="delimiter">'</span></span>, Delete) {
    delete buildDir
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want more control over which files are deleted, you can&#8217;t use inclusions and exclusions the same way you use them for copying files.
Instead, you use the built-in filtering mechanisms of <code>FileCollection</code> and <code>FileTree</code>.
The following example does just that to clear out temporary files from a source directory:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Delete&gt;(&quot;cleanTempFiles&quot;) {
    delete(fileTree(&quot;src&quot;).matching {
        include(&quot;**/*.tmp&quot;)
    })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">cleanTempFiles</span><span class="delimiter">'</span></span>, Delete) {
    delete fileTree(<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>).matching {
        include <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.tmp</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using_project_delete"><a class="anchor" href="#using_project_delete"></a><a class="link" href="#using_project_delete">Using <code>Project.delete()</code></a></h5>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:delete(org.gradle.api.Action)">Project.delete(org.gradle.api.Action)</a> method can delete files and directories.</p>
</div>
<div class="paragraph">
<p>This method takes one or more arguments representing the files or directories to be deleted.</p>
</div>
<div class="paragraph">
<p>For example, the following task deletes the entire contents of a build&#8217;s output directory:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Delete&gt;(&quot;myClean&quot;) {
    delete(buildDir)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">myClean</span><span class="delimiter">'</span></span>, Delete) {
    delete buildDir
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want more control over which files are deleted, you can&#8217;t use inclusions and exclusions the same way you use them for copying files.
Instead, you use the built-in filtering mechanisms of <code>FileCollection</code> and <code>FileTree</code>.
The following example does just that to clear out temporary files from a source directory:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Delete&gt;(&quot;cleanTempFiles&quot;) {
    delete(fileTree(&quot;src&quot;).matching {
        include(&quot;**/*.tmp&quot;)
    })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">cleanTempFiles</span><span class="delimiter">'</span></span>, Delete) {
    delete fileTree(<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>).matching {
        include <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.tmp</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:creating_archives_example"><a class="anchor" href="#sec:creating_archives_example"></a><a class="link" href="#sec:creating_archives_example">Creating archives</a></h4>
<div class="paragraph">
<p>From the perspective of Gradle, packing files into an archive is effectively a copy in which the destination is the archive file rather than a directory on the file system.
Creating archives looks a lot like copying, with all the same features.</p>
</div>
<div class="sect4">
<h5 id="using_the_zip_tar_or_jar_task"><a class="anchor" href="#using_the_zip_tar_or_jar_task"></a><a class="link" href="#using_the_zip_tar_or_jar_task">Using the <code>Zip</code>, <code>Tar</code>, or <code>Jar</code> task</a></h5>
<div class="paragraph">
<p>The simplest case involves archiving the entire contents of a directory, which this example demonstrates by creating a ZIP of the <code>toArchive</code> directory:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Zip&gt;(&quot;packageDistribution&quot;) {
    archiveFileName = &quot;my-distribution.zip&quot;
    destinationDirectory = layout.buildDirectory.dir(&quot;dist&quot;)

    from(layout.buildDirectory.dir(&quot;toArchive&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">packageDistribution</span><span class="delimiter">'</span></span>, Zip) {
    archiveFileName = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-distribution.zip</span><span class="delimiter">&quot;</span></span>
    destinationDirectory = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">dist</span><span class="delimiter">'</span></span>)

    from layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">toArchive</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Notice how we specify the destination and name of the archive instead of an <code>into()</code>: both are required. You often won&#8217;t see them explicitly set because most projects apply the <a href="base_plugin.html#base_plugin">Base Plugin</a>.
It provides some conventional values for those properties.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates this; you can learn more about the conventions in the <a href="#sec:archive_naming">archive naming</a> section.</p>
</div>
<div class="paragraph">
<p>Each type of archive has its own task type, the most common ones being <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.Zip.html">Zip</a>, <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.Tar.html">Tar</a> and <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar</a>.
They all share most of the configuration options of <code>Copy</code>, including filtering and renaming.</p>
</div>
<div class="paragraph">
<p>One of the most common scenarios involves copying files into specified archive subdirectories.
For example, let&#8217;s say you want to package all PDFs into a <code>docs</code> directory in the archive&#8217;s root.
This <code>docs</code> directory doesn&#8217;t exist in the source location, so you must create it as part of the archive.
You do this by adding an <code>into()</code> declaration for just the PDFs:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    base
}

version = &quot;1.0.0&quot;

tasks.register&lt;Zip&gt;(&quot;packageDistribution&quot;) {
    from(layout.buildDirectory.dir(&quot;toArchive&quot;)) {
        exclude(&quot;**/*.pdf&quot;)
    }

    from(layout.buildDirectory.dir(&quot;toArchive&quot;)) {
        include(&quot;**/*.pdf&quot;)
        into(&quot;docs&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">base</span><span class="delimiter">'</span></span>
}

version = <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0</span><span class="delimiter">&quot;</span></span>

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">packageDistribution</span><span class="delimiter">'</span></span>, Zip) {
    from(layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">toArchive</span><span class="delimiter">&quot;</span></span>)) {
        exclude <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.pdf</span><span class="delimiter">&quot;</span></span>
    }

    from(layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">toArchive</span><span class="delimiter">&quot;</span></span>)) {
        include <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.pdf</span><span class="delimiter">&quot;</span></span>
        into <span class="string"><span class="delimiter">&quot;</span><span class="content">docs</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, you can have multiple <code>from()</code> declarations in a copy specification, each with its own configuration.
See <a href="#sub:using_child_copy_specifications">Using child copy specifications</a> for more information on this feature.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:archives"><a class="anchor" href="#sec:archives"></a><a class="link" href="#sec:archives">Understanding archive creation</a></h5>
<div class="paragraph">
<p>Archives are essentially self-contained file systems, and Gradle treats them as such.
This is why working with archives is similar to working with files and directories.</p>
</div>
<div class="paragraph">
<p>Out of the box, Gradle supports the creation of ZIP and TAR archives and, by extension, Java&#8217;s JAR, WAR, and EAR formats—Java&#8217;s archive formats are all ZIPs.
Each of these formats has a corresponding task type to create them: <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.Zip.html">Zip</a>, <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.Tar.html">Tar</a>, <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar</a>, <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.War.html">War</a>, and <a href="https://docs.gradle.org/8.9/dsl/org.gradle.plugins.ear.Ear.html">Ear</a>.
These all work the same way and are based on copy specifications, just like the <code>Copy</code> task.</p>
</div>
<div class="paragraph">
<p>Creating an archive file is essentially a file copy in which the destination is implicit, i.e., the archive file itself.
Here is a basic example that specifies the path and name of the target archive file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Zip&gt;(&quot;packageDistribution&quot;) {
    archiveFileName = &quot;my-distribution.zip&quot;
    destinationDirectory = layout.buildDirectory.dir(&quot;dist&quot;)

    from(layout.buildDirectory.dir(&quot;toArchive&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">packageDistribution</span><span class="delimiter">'</span></span>, Zip) {
    archiveFileName = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-distribution.zip</span><span class="delimiter">&quot;</span></span>
    destinationDirectory = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">dist</span><span class="delimiter">'</span></span>)

    from layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">toArchive</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The full power of copy specifications is available to you when creating archives, which means you can do content filtering, file renaming, or anything else covered in the previous section.
A common requirement is copying files into subdirectories of the archive that don&#8217;t exist in the source folders, something that can be achieved with <code>into()</code> <a href="#sub:using_child_copy_specifications">child specifications</a>.</p>
</div>
<div class="paragraph">
<p>Gradle allows you to create as many archive tasks as you want, but it&#8217;s worth considering that many convention-based plugins provide their own.
For example, the Java plugin adds a <code>jar</code> task for packaging a project&#8217;s compiled classes and resources in a JAR.
Many of these plugins provide sensible conventions for the names of archives and the copy specifications used.
We recommend you use these tasks wherever you can rather than overriding them with your own.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:archive_naming"><a class="anchor" href="#sec:archive_naming"></a><a class="link" href="#sec:archive_naming">Naming archives</a></h5>
<div class="paragraph">
<p>Gradle has several conventions around the naming of archives and where they are created based on the plugins your project uses.
The main convention is provided by the <a href="base_plugin.html#base_plugin">Base Plugin</a>, which defaults to creating archives in the <code>layout.buildDirectory.dir("distributions")</code> directory and typically uses archive names of the form <em>[projectName]-[version].[type]</em>.</p>
</div>
<div class="paragraph">
<p>The following example comes from a project named <code>archive-naming</code>, hence the <code>myZip</code> task creates an archive named <code>archive-naming-1.0.zip</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    base
}

version = &quot;1.0&quot;

tasks.register&lt;Zip&gt;(&quot;myZip&quot;) {
    from(&quot;somedir&quot;)
    val projectDir = layout.projectDirectory.asFile
    doLast {
        println(archiveFileName.get())
        println(destinationDirectory.get().asFile.relativeTo(projectDir))
        println(archiveFile.get().asFile.relativeTo(projectDir))
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">base</span><span class="delimiter">'</span></span>
}

version = <span class="float">1.0</span>

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">myZip</span><span class="delimiter">'</span></span>, Zip) {
    from <span class="string"><span class="delimiter">'</span><span class="content">somedir</span><span class="delimiter">'</span></span>
    <span class="predefined-type">File</span> projectDir = layout.projectDirectory.asFile
    doLast {
        println archiveFileName.get()
        println projectDir.relativePath(destinationDirectory.get().asFile)
        println projectDir.relativePath(archiveFile.get().asFile)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q myZip
archive-naming-1.0.zip
build/distributions
build/distributions/archive-naming-1.0.zip</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the archive name does <em>not</em> derive from the task&#8217;s name that creates it.</p>
</div>
<div class="paragraph">
<p>If you want to change the name and location of a generated archive file, you can provide values for the corresponding task&#8217;s <code>archiveFileName</code> and <code>destinationDirectory</code> properties.
These override any conventions that would otherwise apply.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can make use of the default archive name pattern provided by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.AbstractArchiveTask.html#org.gradle.api.tasks.bundling.AbstractArchiveTask:archiveFileName">AbstractArchiveTask.getArchiveFileName()</a>: <em>[archiveBaseName]-[archiveAppendix]-[archiveVersion]-[archiveClassifier].[archiveExtension]</em>.
You can set each of these properties on the task separately.
Note that the Base Plugin uses the convention of the project name for <em>archiveBaseName</em>, project version for <em>archiveVersion</em>, and the archive type for <em>archiveExtension</em>.
It does not provide values for the other properties.</p>
</div>
<div class="paragraph">
<p>This example — from the same project as the one above — configures just the <code>archiveBaseName</code> property, overriding the default value of the project name:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Zip&gt;(&quot;myCustomZip&quot;) {
    archiveBaseName = &quot;customName&quot;
    from(&quot;somedir&quot;)

    doLast {
        println(archiveFileName.get())
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">myCustomZip</span><span class="delimiter">'</span></span>, Zip) {
    archiveBaseName = <span class="string"><span class="delimiter">'</span><span class="content">customName</span><span class="delimiter">'</span></span>
    from <span class="string"><span class="delimiter">'</span><span class="content">somedir</span><span class="delimiter">'</span></span>

    doLast {
        println archiveFileName.get()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q myCustomZip
customName-1.0.zip</pre>
</div>
</div>
<div class="paragraph">
<p>You can also override the default <code>archiveBaseName</code> value for <em>all</em> the archive tasks in your build by using the <em>project</em> property <code>archivesBaseName</code>, as demonstrated by the following example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    base
}

version = &quot;1.0&quot;

base {
    archivesName = &quot;gradle&quot;
    distsDirectory = layout.buildDirectory.dir(&quot;custom-dist&quot;)
    libsDirectory = layout.buildDirectory.dir(&quot;custom-libs&quot;)
}

val myZip by tasks.registering(Zip::class) {
    from(&quot;somedir&quot;)
}

val myOtherZip by tasks.registering(Zip::class) {
    archiveAppendix = &quot;wrapper&quot;
    archiveClassifier = &quot;src&quot;
    from(&quot;somedir&quot;)
}

tasks.register(&quot;echoNames&quot;) {
    val projectNameString = project.name
    val archiveFileName = myZip.flatMap { it.archiveFileName }
    val myOtherArchiveFileName = myOtherZip.flatMap { it.archiveFileName }
    doLast {
        println(&quot;Project name: $projectNameString&quot;)
        println(archiveFileName.get())
        println(myOtherArchiveFileName.get())
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">base</span><span class="delimiter">'</span></span>
}

version = <span class="float">1.0</span>
base {
    archivesName = <span class="string"><span class="delimiter">&quot;</span><span class="content">gradle</span><span class="delimiter">&quot;</span></span>
    distsDirectory = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">custom-dist</span><span class="delimiter">'</span></span>)
    libsDirectory = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">custom-libs</span><span class="delimiter">'</span></span>)
}

<span class="keyword">def</span> myZip = tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">myZip</span><span class="delimiter">'</span></span>, Zip) {
    from <span class="string"><span class="delimiter">'</span><span class="content">somedir</span><span class="delimiter">'</span></span>
}

<span class="keyword">def</span> myOtherZip = tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">myOtherZip</span><span class="delimiter">'</span></span>, Zip) {
    archiveAppendix = <span class="string"><span class="delimiter">'</span><span class="content">wrapper</span><span class="delimiter">'</span></span>
    archiveClassifier = <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>
    from <span class="string"><span class="delimiter">'</span><span class="content">somedir</span><span class="delimiter">'</span></span>
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">echoNames</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> projectNameString = project.name
    <span class="keyword">def</span> archiveFileName = myZip.flatMap { <span class="local-variable">it</span>.archiveFileName }
    <span class="keyword">def</span> myOtherArchiveFileName = myOtherZip.flatMap { <span class="local-variable">it</span>.archiveFileName }
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Project name: </span><span class="inline"><span class="inline-delimiter">$</span>projectNameString</span><span class="delimiter">&quot;</span></span>
        println archiveFileName.get()
        println myOtherArchiveFileName.get()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q echoNames
Project name: archives-changed-base-name
gradle-1.0.zip
gradle-wrapper-1.0-src.zip</pre>
</div>
</div>
<div class="paragraph">
<p>You can find all the possible archive task properties in the API documentation for <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.AbstractArchiveTask.html">AbstractArchiveTask</a>.
Still, we have also summarized the main ones here:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>archiveFileName</code> — <code>Property&lt;String&gt;</code>, default: <code><em>archiveBaseName</em>-<em>archiveAppendix</em>-<em>archiveVersion</em>-<em>archiveClassifier</em>.<em>archiveExtension</em></code></dt>
<dd>
<p>The complete file name of the generated archive. If any of the properties in the default value are empty, their '-' separator is dropped.</p>
</dd>
<dt class="hdlist1"><code>archiveFile</code> — <code>Provider&lt;RegularFile&gt;</code>, <em>read-only</em>, default: <code><em>destinationDirectory</em>/<em>archiveFileName</em></code></dt>
<dd>
<p>The absolute file path of the generated archive.</p>
</dd>
<dt class="hdlist1"><code>destinationDirectory</code> — <code>DirectoryProperty</code>, default: depends on archive type</dt>
<dd>
<p>The target directory in which to put the generated archive. By default, JARs and WARs go into <code>layout.buildDirectory.dir("libs")</code>. ZIPs and TARs go into <code>layout.buildDirectory.dir("distributions")</code>.</p>
</dd>
<dt class="hdlist1"><code>archiveBaseName</code> — <code>Property&lt;String&gt;</code>, default: <code><em>project.name</em></code></dt>
<dd>
<p>The base name portion of the archive file name, typically a project name or some other descriptive name for what it contains.</p>
</dd>
<dt class="hdlist1"><code>archiveAppendix</code> — <code>Property&lt;String&gt;</code>, default: <code>null</code></dt>
<dd>
<p>The appendix portion of the archive file name that comes immediately after the base name. It is typically used to distinguish between different forms of content, such as code and docs, or a minimal distribution versus a full or complete one.</p>
</dd>
<dt class="hdlist1"><code>archiveVersion</code> — <code>Property&lt;String&gt;</code>, default: <code><em>project.version</em></code></dt>
<dd>
<p>The version portion of the archive file name, typically in the form of a normal project or product version.</p>
</dd>
<dt class="hdlist1"><code>archiveClassifier</code> — <code>Property&lt;String&gt;</code>, default: <code>null</code></dt>
<dd>
<p>The classifier portion of the archive file name. Often used to distinguish between archives that target different platforms.</p>
</dd>
<dt class="hdlist1"><code>archiveExtension</code> — <code>Property&lt;String&gt;</code>, default: depends on archive type and compression type</dt>
<dd>
<p>The filename extension for the archive. By default, this is set based on the archive task type and the compression type (if you&#8217;re creating a TAR). Will be one of: <code>zip</code>, <code>jar</code>, <code>war</code>, <code>tar</code>, <code>tgz</code> or <code>tbz2</code>. You can of course set this to a custom extension if you wish.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sec:sharing_content_between_multiple_archives"><a class="anchor" href="#sec:sharing_content_between_multiple_archives"></a><a class="link" href="#sec:sharing_content_between_multiple_archives">Sharing content between multiple archives</a></h5>
<div class="paragraph">
<p><a href="#sub:sharing_copy_specs">As described in the <code>CopySpec</code> section above</a>, you can use the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:copySpec(org.gradle.api.Action)">Project.copySpec(org.gradle.api.Action)</a> method to share content between archives.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:archive_contents"><a class="anchor" href="#sec:archive_contents"></a><a class="link" href="#sec:archive_contents">Using archives as file trees</a></h5>
<div class="paragraph">
<p>An archive is a directory and file hierarchy packed into a single file.
In other words, it&#8217;s a special case of a file tree, and that&#8217;s exactly how Gradle treats archives.</p>
</div>
<div class="paragraph">
<p>Instead of using the <code>fileTree()</code> method, which only works on normal file systems, you use the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:zipTree(java.lang.Object)">Project.zipTree(java.lang.Object)</a> and <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:tarTree(java.lang.Object)">Project.tarTree(java.lang.Object)</a> methods to wrap archive files of the corresponding type (note that JAR, WAR and EAR files are ZIPs).
Both methods return <code>FileTree</code> instances that you can then use in the same way as normal file trees.
For example, you can extract some or all of the files of an archive by copying its contents to some directory on the file system.
Or you can merge one archive into another.</p>
</div>
<div class="paragraph">
<p>Here are some simple examples of creating archive-based file trees:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Create a ZIP file tree using path
val zip: FileTree = zipTree(&quot;someFile.zip&quot;)

// Create a TAR file tree using path
val tar: FileTree = tarTree(&quot;someFile.tar&quot;)

// tar tree attempts to guess the compression based on the file extension
// however if you must specify the compression explicitly you can:
val someTar: FileTree = tarTree(resources.gzip(&quot;someTar.ext&quot;))</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Create a ZIP file tree using path</span>
FileTree zip = zipTree(<span class="string"><span class="delimiter">'</span><span class="content">someFile.zip</span><span class="delimiter">'</span></span>)

<span class="comment">// Create a TAR file tree using path</span>
FileTree tar = tarTree(<span class="string"><span class="delimiter">'</span><span class="content">someFile.tar</span><span class="delimiter">'</span></span>)

<span class="comment">//tar tree attempts to guess the compression based on the file extension</span>
<span class="comment">//however if you must specify the compression explicitly you can:</span>
FileTree someTar = tarTree(resources.gzip(<span class="string"><span class="delimiter">'</span><span class="content">someTar.ext</span><span class="delimiter">'</span></span>))</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can see a practical example of extracting an archive file <a href="#sec:unpacking_archives_example">in the unpacking archives section</a> below.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:reproducible_archives"><a class="anchor" href="#sec:reproducible_archives"></a><a class="link" href="#sec:reproducible_archives">Using <code>AbstractArchiveTask</code> for reproducible builds</a></h5>
<div class="paragraph">
<p>Sometimes it&#8217;s desirable to recreate archives exactly the same, byte for byte, on different machines.
You want to be sure that building an artifact from source code produces the same result no matter when and where it is built.
This is necessary for projects like <a href="https://reproducible-builds.org/">reproducible-builds.org</a>.</p>
</div>
<div class="paragraph">
<p>Reproducing the same byte-for-byte archive poses some challenges since the order of the files in an archive is influenced by the underlying file system.
Each time a ZIP, TAR, JAR, WAR or EAR is built from source, the order of the files inside the archive may change.
Files that only have a different timestamp also causes differences in archives from build to build.</p>
</div>
<div class="paragraph">
<p>All <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.AbstractArchiveTask.html">AbstractArchiveTask</a> (e.g. Jar, Zip) tasks shipped with Gradle include support for producing reproducible archives.</p>
</div>
<div class="paragraph">
<p>For example, to make a <code>Zip</code> task reproducible you need to set <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.Zip.html#org.gradle.api.tasks.bundling.Zip:reproducibleFileOrder">Zip.isReproducibleFileOrder()</a> to <code>true</code> and <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.Zip.html#org.gradle.api.tasks.bundling.Zip:preserveFileTimestamps">Zip.isPreserveFileTimestamps()</a> to <code>false</code>.
In order to make all archive tasks in your build reproducible, consider adding the following configuration to your build file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;AbstractArchiveTask&gt;().configureEach {
    isPreserveFileTimestamps = false
    isReproducibleFileOrder = true
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(AbstractArchiveTask).configureEach {
    preserveFileTimestamps = <span class="predefined-constant">false</span>
    reproducibleFileOrder = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Often you will want to publish an archive, so that it is usable from another project.
This process is described in <a href="#cross_project_publications">Cross-Project publications</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:unpacking_archives_example"><a class="anchor" href="#sec:unpacking_archives_example"></a><a class="link" href="#sec:unpacking_archives_example">Unpacking archives</a></h4>
<div class="paragraph">
<p>Archives are effectively self-contained file systems, so unpacking them is a case of copying the files from that file system onto the local file system — or even into another archive.
Gradle enables this by providing some wrapper functions that make archives available as hierarchical collections of files (<a href="#sec:file_trees">file trees</a>).</p>
</div>
<div class="sect4">
<h5 id="using_project_ziptree_and_project_tartree"><a class="anchor" href="#using_project_ziptree_and_project_tartree"></a><a class="link" href="#using_project_ziptree_and_project_tartree">Using <code>Project.zipTree</code> and <code>Project.tarTree</code></a></h5>
<div class="paragraph">
<p>The two functions of interest are <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:zipTree(java.lang.Object)">Project.zipTree(java.lang.Object)</a> and <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:tarTree(java.lang.Object)">Project.tarTree(java.lang.Object)</a>, which produce a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileTree.html">FileTree</a> from a corresponding archive file.</p>
</div>
<div class="paragraph">
<p>That file tree can then be used in a <code>from()</code> specification, like so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;unpackFiles&quot;) {
    from(zipTree(&quot;src/resources/thirdPartyResources.zip&quot;))
    into(layout.buildDirectory.dir(&quot;resources&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">unpackFiles</span><span class="delimiter">'</span></span>, Copy) {
    from zipTree(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/resources/thirdPartyResources.zip</span><span class="delimiter">&quot;</span></span>)
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">resources</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As with a normal copy, you can control which files are unpacked via <a href="#sec:filtering_files">filters</a> and even <a href="#sec:renaming_files">rename files</a> as they are unpacked.</p>
</div>
<div class="paragraph">
<p>More advanced processing can be handled by the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.AbstractCopyTask.html#eachFile(org.gradle.api.Action)">eachFile()</a> method.
For example, you might need to extract different subtrees of the archive into different paths within the destination directory.
The following sample uses the method to extract the files within the archive&#8217;s <code>libs</code> directory into the root destination directory, rather than into a <code>libs</code> subdirectory:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;unpackLibsDirectory&quot;) {
    from(zipTree(&quot;src/resources/thirdPartyResources.zip&quot;)) {
        include(&quot;libs/**&quot;)  // <b class="conum">(1)</b>
        eachFile {
            relativePath = RelativePath(true, *relativePath.segments.drop(1).toTypedArray())  // <b class="conum">(2)</b>
        }
        includeEmptyDirs = false  // <b class="conum">(3)</b>
    }
    into(layout.buildDirectory.dir(&quot;resources&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">unpackLibsDirectory</span><span class="delimiter">'</span></span>, Copy) {
    from(zipTree(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/resources/thirdPartyResources.zip</span><span class="delimiter">&quot;</span></span>)) {
        include <span class="string"><span class="delimiter">&quot;</span><span class="content">libs/**</span><span class="delimiter">&quot;</span></span>  // <b class="conum">(1)</b>
        eachFile { fcd -&gt;
            fcd.relativePath = <span class="keyword">new</span> RelativePath(<span class="predefined-constant">true</span>, fcd.relativePath.segments.drop(<span class="integer">1</span>))  // <b class="conum">(2)</b>
        }
        includeEmptyDirs = <span class="predefined-constant">false</span>  // <b class="conum">(3)</b>
    }
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">resources</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Extracts only the subset of files that reside in the <code>libs</code> directory</p>
</li>
<li>
<p>Remaps the path of the extracting files into the destination directory by dropping the <code>libs</code> segment from the file path</p>
</li>
<li>
<p>Ignores the empty directories resulting from the remapping, see Caution note below</p>
</li>
</ol>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can not change the destination path of empty directories with this technique.
You can learn more in <a href="https://github.com/gradle/gradle/issues/2940">this issue</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you&#8217;re a Java developer wondering why there is no <code>jarTree()</code> method, that&#8217;s because <code>zipTree()</code> works perfectly well for JARs, WARs, and EARs.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:creating_uber_jar_example"><a class="anchor" href="#sec:creating_uber_jar_example"></a><a class="link" href="#sec:creating_uber_jar_example">Creating "uber" or "fat" JARs</a></h4>
<div class="paragraph">
<p>In Java, applications and their dependencies were typically packaged as separate JARs within a single distribution archive.
That still happens, but another approach that is now common is placing the classes and resources of the dependencies directly into the application JAR, creating what is known as an Uber or fat JAR.</p>
</div>
<div class="paragraph">
<p>Creating "uber" or "fat" JARs in Gradle involves packaging all dependencies into a single JAR file, making it easier to distribute and run the application.</p>
</div>
<div class="sect4">
<h5 id="using_the_shadow_plugin"><a class="anchor" href="#using_the_shadow_plugin"></a><a class="link" href="#using_the_shadow_plugin">Using the Shadow Plugin</a></h5>
<div class="paragraph">
<p>Gradle does not have full built-in support for creating uber JARs, but you can use third-party plugins like the <a href="https://github.com/johnrengelman/shadow">Shadow plugin</a> (<code>com.github.johnrengelman.shadow</code>) to achieve this.
This plugin packages your project classes and dependencies into a single JAR file.</p>
</div>
</div>
<div class="sect4">
<h5 id="using_project_ziptree_and_the_jar_task"><a class="anchor" href="#using_project_ziptree_and_the_jar_task"></a><a class="link" href="#using_project_ziptree_and_the_jar_task">Using <code>Project.zipTree()</code> and the <code>Jar</code> task</a></h5>
<div class="paragraph">
<p>To copy the contents of other JAR files into the application JAR, use the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:zipTree(java.lang.Object)">Project.zipTree(java.lang.Object)</a> method and the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar</a> task.
This is demonstrated by the <code>uberJar</code> task in the following example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}

version = &quot;1.0.0&quot;

repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;commons-io:commons-io:2.6&quot;)
}

tasks.register&lt;Jar&gt;(&quot;uberJar&quot;) {
    archiveClassifier = &quot;uber&quot;

    from(sourceSets.main.get().output)

    dependsOn(configurations.runtimeClasspath)
    from({
        configurations.runtimeClasspath.get().filter { it.name.endsWith(&quot;jar&quot;) }.map { zipTree(it) }
    })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

version = <span class="string"><span class="delimiter">'</span><span class="content">1.0.0</span><span class="delimiter">'</span></span>

repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-io:commons-io:2.6</span><span class="delimiter">'</span></span>
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">uberJar</span><span class="delimiter">'</span></span>, Jar) {
    archiveClassifier = <span class="string"><span class="delimiter">'</span><span class="content">uber</span><span class="delimiter">'</span></span>

    from sourceSets.main.output

    dependsOn configurations.runtimeClasspath
    from {
        configurations.runtimeClasspath.findAll { <span class="local-variable">it</span>.name.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>) }.collect { zipTree(<span class="local-variable">it</span>) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, we&#8217;re taking the runtime dependencies of the project — <code>configurations.runtimeClasspath.files</code> — and wrapping each of the JAR files with the <code>zipTree()</code> method.
The result is a collection of ZIP file trees, the contents of which are copied into the uber JAR alongside the application classes.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:creating_directories_example"><a class="anchor" href="#sec:creating_directories_example"></a><a class="link" href="#sec:creating_directories_example">Creating directories</a></h4>
<div class="paragraph">
<p>Many tasks need to create directories to store the files they generate, which is why Gradle <a href="#incremental_build">automatically manages</a> this aspect of tasks when they explicitly define file and directory outputs.
All core Gradle tasks ensure that any output directories they need are created, if necessary, using this mechanism.</p>
</div>
<div class="sect4">
<h5 id="using_file_mkdirs_and_files_createdirectories"><a class="anchor" href="#using_file_mkdirs_and_files_createdirectories"></a><a class="link" href="#using_file_mkdirs_and_files_createdirectories">Using <code>File.mkdirs</code> and <code>Files.createDirectories</code></a></h5>
<div class="paragraph">
<p>In cases where you need to create a directory manually, you can use the standard <code><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#createDirectories-java.nio.file.Path-java.nio.file.attribute.FileAttribute...-">Files.createDirectories</a></code> or <code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html#mkdirs--">File.mkdirs</a></code> methods from within your build scripts or custom task implementations.</p>
</div>
<div class="paragraph">
<p>Here is a simple example that creates a single <code>images</code> directory in the project folder:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;ensureDirectory&quot;) {
    // Store target directory into a variable to avoid project reference in the configuration cache
    val directory = file(&quot;images&quot;)

    doLast {
        Files.createDirectories(directory.toPath())
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">ensureDirectory</span><span class="delimiter">'</span></span>) {
    <span class="comment">// Store target directory into a variable to avoid project reference in the configuration cache</span>
    <span class="keyword">def</span> directory = file(<span class="string"><span class="delimiter">&quot;</span><span class="content">images</span><span class="delimiter">&quot;</span></span>)

    doLast {
        Files.createDirectories(directory.toPath())
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As described in the <a href="https://ant.apache.org/manual/Tasks/mkdir.html">Apache Ant manual</a>, the <code>mkdir</code> task will automatically create all necessary directories in the given path.
It will do nothing if the directory already exists.</p>
</div>
</div>
<div class="sect4">
<h5 id="using_project_mkdir"><a class="anchor" href="#using_project_mkdir"></a><a class="link" href="#using_project_mkdir">Using <code>Project.mkdir</code></a></h5>
<div class="paragraph">
<p>You can create directories in Gradle using the <code>mkdir</code> method, which is available in the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Project.html#mkdir-java.lang.Object-"><code>Project</code> object</a>.
This method takes a <code>File</code> object or a <code>String</code> representing the path of the directory to be created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">createDirs</span><span class="delimiter">'</span></span>) {
    doLast {
        mkdir <span class="string"><span class="delimiter">'</span><span class="content">src/main/resources</span><span class="delimiter">'</span></span>
        mkdir file(<span class="string"><span class="delimiter">'</span><span class="content">build/generated</span><span class="delimiter">'</span></span>)

        <span class="comment">// Create multiple dirs</span>
        mkdir files([<span class="string"><span class="delimiter">'</span><span class="content">src/main/resources</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">src/test/resources</span><span class="delimiter">'</span></span>])

        <span class="comment">// Check dir existence</span>
        <span class="keyword">def</span> dir = file(<span class="string"><span class="delimiter">'</span><span class="content">src/main/resources</span><span class="delimiter">'</span></span>)
        <span class="keyword">if</span> (!dir.exists()) {
            mkdir dir
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:install_executable"><a class="anchor" href="#sec:install_executable"></a><a class="link" href="#sec:install_executable">Installing executables</a></h4>
<div class="paragraph">
<p>When you are building a standalone executable, you may want to install this file on your system, so it ends up in your path.</p>
</div>
<div class="sect4">
<h5 id="using_the_copy_task_2"><a class="anchor" href="#using_the_copy_task_2"></a><a class="link" href="#using_the_copy_task_2">Using the <code>Copy</code> task</a></h5>
<div class="paragraph">
<p>You can use a <code>Copy</code> task to install the executable into shared directories like <code>/usr/local/bin</code>.
The installation directory probably contains many other executables, some of which may even be unreadable by Gradle.
To support the unreadable files in the <code>Copy</code> task&#8217;s destination directory and to avoid time consuming up-to-date checks, you can use <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Task.html#org.gradle.api.Task:doNotTrackState(java.lang.String)">Task.doNotTrackState()</a>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;installExecutable&quot;) {
    from(&quot;build/my-binary&quot;)
    into(&quot;/usr/local/bin&quot;)
    doNotTrackState(&quot;Installation directory contains unrelated files&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">installExecutable</span><span class="delimiter">&quot;</span></span>, Copy) {
    from <span class="string"><span class="delimiter">&quot;</span><span class="content">build/my-binary</span><span class="delimiter">&quot;</span></span>
    into <span class="string"><span class="delimiter">&quot;</span><span class="content">/usr/local/bin</span><span class="delimiter">&quot;</span></span>
    doNotTrackState(<span class="string"><span class="delimiter">&quot;</span><span class="content">Installation directory contains unrelated files</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:copy_deploy"><a class="anchor" href="#sec:copy_deploy"></a><a class="link" href="#sec:copy_deploy">Deploying single files into application servers</a></h4>
<div class="paragraph">
<p>Deploying a single file to an application server typically refers to the process of transferring a packaged application artifact, such as a WAR file, to the application server&#8217;s deployment directory.</p>
</div>
<div class="sect4">
<h5 id="using_the_copy_task_3"><a class="anchor" href="#using_the_copy_task_3"></a><a class="link" href="#using_the_copy_task_3">Using the <code>Copy</code> task</a></h5>
<div class="paragraph">
<p>When working with application servers, you can use a <code>Copy</code> task to deploy the application archive (e.g. a WAR file).
Since you are deploying a single file, the destination directory of the <code>Copy</code> is the whole deployment directory.
The deployment directory sometimes does contain unreadable files like named pipes, so Gradle may have problems doing up-to-date checks.
In order to support this use-case, you can use <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Task.html#org.gradle.api.Task:doNotTrackState(java.lang.String)">Task.doNotTrackState()</a>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    war
}

tasks.register&lt;Copy&gt;(&quot;deployToTomcat&quot;) {
    from(tasks.war)
    into(layout.projectDirectory.dir(&quot;tomcat/webapps&quot;))
    doNotTrackState(&quot;Deployment directory contains unreadable files&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">war</span><span class="delimiter">'</span></span>
}

tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">deployToTomcat</span><span class="delimiter">&quot;</span></span>, Copy) {
    from war
    into layout.projectDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">tomcat/webapps</span><span class="delimiter">'</span></span>)
    doNotTrackState(<span class="string"><span class="delimiter">&quot;</span><span class="content">Deployment directory contains unreadable files</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="logging"><a class="anchor" href="#logging"></a><a class="link" href="#logging">Logging</a></h3>
<div class="paragraph">
<p>The log serves as the primary 'UI' of a build tool.
If it becomes overly verbose, important warnings and issues can be obscured.
However, it is essential to have relevant information to determine if something has gone wrong.</p>
</div>
<div class="paragraph">
<p>Gradle defines six log levels, detailed in <a href="#logLevels">Log levels</a>.
In addition to the standard log levels, Gradle introduces two specific levels: <em>QUIET</em> and <em>LIFECYCLE</em>.
<em>LIFECYCLE</em> is the default level used to report build progress.</p>
</div>
<div class="sect3">
<h4 id="logLevels"><a class="anchor" href="#logLevels"></a><a class="link" href="#logLevels">Understanding Log levels</a></h4>
<div class="paragraph">
<p>There are 6 log levels in Gradle:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
ERROR
</td>
<td class="hdlist2">
<p>Error messages</p>
</td>
</tr>
<tr>
<td class="hdlist1">
QUIET
</td>
<td class="hdlist2">
<p>Important information messages</p>
</td>
</tr>
<tr>
<td class="hdlist1">
WARNING
</td>
<td class="hdlist2">
<p>Warning messages</p>
</td>
</tr>
<tr>
<td class="hdlist1">
LIFECYCLE
</td>
<td class="hdlist2">
<p>Progress information messages</p>
</td>
</tr>
<tr>
<td class="hdlist1">
INFO
</td>
<td class="hdlist2">
<p>Information messages</p>
</td>
</tr>
<tr>
<td class="hdlist1">
DEBUG
</td>
<td class="hdlist2">
<p>Debug messages</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The console&#8217;s rich components (build status and work-in-progress area) are displayed regardless of the log level used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:choosing_a_log_level"><a class="anchor" href="#sec:choosing_a_log_level"></a><a class="link" href="#sec:choosing_a_log_level">Choosing a log level</a></h4>
<div class="paragraph">
<p>You can choose different log levels from the command line switches shown in <a href="#logLevelCommandLineOptions">Log level command-line options</a>.</p>
</div>
<div class="paragraph">
<p>You can also configure the log level using <a href="#sec:gradle_configuration_properties"><code>gradle.properties</code></a>.</p>
</div>
<div class="paragraph">
<p>In <a href="#stacktraces">Stacktrace command-line options</a> you can find the command line switches which affect stacktrace logging.</p>
</div>
<div id="logLevelCommandLineOptions" class="paragraph">
<p>Log level command-line options:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Outputs Log Levels</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-q</code> or <code>--quiet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QUIET and higher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-w</code> or <code>--warn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN and higher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no logging options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIFECYCLE and higher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code> or <code>--info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO and higher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code> or <code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG and higher (that is, all log messages)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
The <code>DEBUG</code> log level can <a href="#sec:debug_security">expose sensitive security information to the console</a>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="stacktraces"><a class="anchor" href="#stacktraces"></a><a class="link" href="#stacktraces">Stacktrace command-line options</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-s</code> or <code>--stacktrace</code></dt>
<dd>
<p>Truncated stacktraces are printed. We recommend this over full stacktraces. Groovy full stacktraces are extremely verbose due to the underlying dynamic invocation mechanisms. Yet they usually do not contain relevant information about what has gone wrong in <em>your</em> code. This option renders stacktraces for deprecation warnings.</p>
</dd>
<dt class="hdlist1"><code>-S</code> or <code>--full-stacktrace</code></dt>
<dd>
<p>The full stacktraces are printed out. This option renders stacktraces for deprecation warnings.</p>
</dd>
<dt class="hdlist1">&lt;No stacktrace options&gt;</dt>
<dd>
<p>No stacktraces are printed to the console in case of a build error (e.g., a compile error). Only in case of internal exceptions will stacktraces be printed. If the <code>DEBUG</code> log level is chosen, truncated stacktraces are always printed.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:debug_security"><a class="anchor" href="#sec:debug_security"></a><a class="link" href="#sec:debug_security">Logging Sensitive Information</a></h4>
<div class="paragraph">
<p>Running Gradle with the <code>DEBUG</code> log level can potentially expose sensitive information to the console and build log.</p>
</div>
<div class="paragraph">
<p>This information might include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment variables</p>
</li>
<li>
<p>Private repository credentials</p>
</li>
<li>
<p>Build cache and Develocity credentials</p>
</li>
<li>
<p>Plugin Portal publishing credentials</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s important to avoid using the <code>DEBUG</code> log level when running on public Continuous Integration (CI) services.
Build logs on these services are accessible to the public and can expose sensitive information.
Even on private CI services, logging sensitive credentials may pose a risk depending on your organization&#8217;s threat model.
It&#8217;s advisable to discuss this with your organization&#8217;s security team.</p>
</div>
<div class="paragraph">
<p>Some CI providers attempt to redact sensitive credentials from logs, but this process is not foolproof and typically only redacts exact matches of pre-configured secrets.</p>
</div>
<div class="paragraph">
<p>If you suspect that a Gradle Plugin may inadvertently expose sensitive information, please contact [<a href="mailto:security@gradle.com">security@gradle.com</a>](mailto:security@gradle.com) for assistance with disclosure.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:sending_your_own_log_messages"><a class="anchor" href="#sec:sending_your_own_log_messages"></a><a class="link" href="#sec:sending_your_own_log_messages">Writing your own log messages</a></h4>
<div class="paragraph">
<p>A simple option for logging in your build file is to write messages to standard output.
Gradle redirects anything written to standard output to its logging system at the <code>QUIET</code> log level:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">println(&quot;A message which is logged at QUIET level&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println <span class="string"><span class="delimiter">'</span><span class="content">A message which is logged at QUIET level</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle also provides a <code>logger</code> property to a build script, which is an instance of <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/logging/Logger.html">Logger</a>.
This interface extends the SLF4J <code>Logger</code> interface and adds a few Gradle-specific methods.
Below is an example of how this is used in the build script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">logger.quiet(&quot;An info log message which is always logged.&quot;)
logger.error(&quot;An error log message.&quot;)
logger.warn(&quot;A warning log message.&quot;)
logger.lifecycle(&quot;A lifecycle info log message.&quot;)
logger.info(&quot;An info log message.&quot;)
logger.debug(&quot;A debug log message.&quot;)
logger.trace(&quot;A trace log message.&quot;) // Gradle never logs TRACE level logs</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">logger.quiet(<span class="string"><span class="delimiter">'</span><span class="content">An info log message which is always logged.</span><span class="delimiter">'</span></span>)
logger.error(<span class="string"><span class="delimiter">'</span><span class="content">An error log message.</span><span class="delimiter">'</span></span>)
logger.warn(<span class="string"><span class="delimiter">'</span><span class="content">A warning log message.</span><span class="delimiter">'</span></span>)
logger.lifecycle(<span class="string"><span class="delimiter">'</span><span class="content">A lifecycle info log message.</span><span class="delimiter">'</span></span>)
logger.info(<span class="string"><span class="delimiter">'</span><span class="content">An info log message.</span><span class="delimiter">'</span></span>)
logger.debug(<span class="string"><span class="delimiter">'</span><span class="content">A debug log message.</span><span class="delimiter">'</span></span>)
logger.trace(<span class="string"><span class="delimiter">'</span><span class="content">A trace log message.</span><span class="delimiter">'</span></span>) <span class="comment">// Gradle never logs TRACE level logs</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Use the link <a href="https://www.slf4j.org/manual.html#typical_usage">typical SLF4J pattern</a> to replace a placeholder with an actual value in the log message.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">logger.info(&quot;A {} log message&quot;, &quot;info&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">logger.info(<span class="string"><span class="delimiter">'</span><span class="content">A {} log message</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">info</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also hook into Gradle&#8217;s logging system from within other classes used in the build (classes from the <code>buildSrc</code> directory, for example) with an SLF4J logger.
You can use this logger the same way as you use the provided logger in the build script.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.slf4j.LoggerFactory

val slf4jLogger = LoggerFactory.getLogger(&quot;some-logger&quot;)
slf4jLogger.info(&quot;An info log message logged using SLF4j&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.slf4j.LoggerFactory</span>

<span class="keyword">def</span> slf4jLogger = LoggerFactory.getLogger(<span class="string"><span class="delimiter">'</span><span class="content">some-logger</span><span class="delimiter">'</span></span>)
slf4jLogger.info(<span class="string"><span class="delimiter">'</span><span class="content">An info log message logged using SLF4j</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:external_tools"><a class="anchor" href="#sec:external_tools"></a><a class="link" href="#sec:external_tools">Logging from external tools and libraries</a></h4>
<div class="paragraph">
<p>Internally, Gradle uses Ant and Ivy.
Both have their own logging system.
Gradle redirects their logging output into the Gradle logging system.</p>
</div>
<div class="paragraph">
<p>There is a 1:1 mapping from the Ant/Ivy log levels to the Gradle log levels, except the Ant/Ivy <code>TRACE</code> log level, which is mapped to the Gradle <code>DEBUG</code> log level.
This means the default Gradle log level will not show any Ant/Ivy output unless it is an error or a warning.</p>
</div>
<div class="paragraph">
<p>Many tools out there still use the standard output for logging.
By default, Gradle redirects standard output to the <code>QUIET</code> log level and standard error to the <code>ERROR</code> level.
This behavior is configurable.</p>
</div>
<div class="paragraph">
<p>The <code>project</code> object provides a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/logging/LoggingManager.html">LoggingManager</a>, which allows you to change the log levels that standard out or error are redirected to when your build script is evaluated.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">logging.captureStandardOutput(LogLevel.INFO)
println(&quot;A message which is logged at INFO level&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">logging.captureStandardOutput LogLevel.INFO
println <span class="string"><span class="delimiter">'</span><span class="content">A message which is logged at INFO level</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To change the log level for standard out or error during task execution, use a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/logging/LoggingManager.html">LoggingManager</a>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;logInfo&quot;) {
    logging.captureStandardOutput(LogLevel.INFO)
    doFirst {
        println(&quot;A task message which is logged at INFO level&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">logInfo</span><span class="delimiter">'</span></span>) {
    logging.captureStandardOutput LogLevel.INFO
    doFirst {
        println <span class="string"><span class="delimiter">'</span><span class="content">A task message which is logged at INFO level</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle also integrates with the [Java Util Logging](<a href="https://docs.oracle.com/javase/8/docs/api/java/util/logging/package-summary.html" class="bare">https://docs.oracle.com/javase/8/docs/api/java/util/logging/package-summary.html</a>), Jakarta Commons Logging and [Log4j](<a href="https://logging.apache.org/log4j/2.x/" class="bare">https://logging.apache.org/log4j/2.x/</a>) logging toolkits.
Any log messages your build classes write using these logging toolkits will be redirected to Gradle&#8217;s logging system.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:changing_what_gradle_logs"><a class="anchor" href="#sec:changing_what_gradle_logs"></a><a class="link" href="#sec:changing_what_gradle_logs">Changing what Gradle logs</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="#config_cache">configuration cache</a> limits the ability to customize Gradle&#8217;s logging UI.
The custom logger can only implement <a href="#config_cache:requirements:build_listeners">supported listener interfaces</a>.
These interfaces do not receive events when the configuration cache entry is reused because the configuration phase is skipped.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can replace much of Gradle&#8217;s logging UI with your own.
You could do this if you want to customize the UI somehow - to log more or less information or to change the formatting.
Simply replace the logging using the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.invocation.Gradle.html#org.gradle.api.invocation.Gradle:useLogger(java.lang.Object)">Gradle.useLogger(java.lang.Object)</a> method.
This is accessible from a build script, an init script, or via the embedding API.
Note that this completely disables Gradle&#8217;s default output.
Below is an example init script that changes how task execution and build completion are logged:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">customLogger.init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">useLogger(CustomEventLogger())

@Suppress(&quot;deprecation&quot;)
class CustomEventLogger() : BuildAdapter(), TaskExecutionListener {

    override fun beforeExecute(task: Task) {
        println(&quot;[${task.name}]&quot;)
    }

    override fun afterExecute(task: Task, state: TaskState) {
        println()
    }

    override fun buildFinished(result: BuildResult) {
        println(&quot;build completed&quot;)
        if (result.failure != null) {
            (result.failure as Throwable).printStackTrace()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">customLogger.init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">useLogger(<span class="keyword">new</span> CustomEventLogger())

<span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">deprecation</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">CustomEventLogger</span> <span class="directive">extends</span> BuildAdapter <span class="directive">implements</span> TaskExecutionListener {

    <span class="type">void</span> beforeExecute(Task task) {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">[</span><span class="inline"><span class="inline-delimiter">$</span>task</span><span class="content">.name]</span><span class="delimiter">&quot;</span></span>
    }

    <span class="type">void</span> afterExecute(Task task, TaskState state) {
        println()
    }
    
    <span class="type">void</span> buildFinished(BuildResult result) {
        println <span class="string"><span class="delimiter">'</span><span class="content">build completed</span><span class="delimiter">'</span></span>
        <span class="keyword">if</span> (result.failure != <span class="predefined-constant">null</span>) {
            result.failure.printStackTrace()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock multi-language-text lang-kotlin">
<div class="content">
<pre>$ gradle -I customLogger.init.gradle.kts build

&gt; Task :compile
[compile]
compiling source

&gt; Task :testCompile
[testCompile]
compiling test source

&gt; Task :test
[test]
running unit tests

&gt; Task :build
[build]

build completed
3 actionable tasks: 3 executed</pre>
</div>
</div>
<div class="listingblock multi-language-text lang-groovy">
<div class="content">
<pre>$ gradle -I customLogger.init.gradle build

&gt; Task :compile
[compile]
compiling source

&gt; Task :testCompile
[testCompile]
compiling test source

&gt; Task :test
[test]
running unit tests

&gt; Task :build
[build]

build completed
3 actionable tasks: 3 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Your logger can implement any of the listener interfaces listed below.
When you register a logger, only the logging for the interfaces it implements is replaced.
Logging for the other interfaces is left untouched.
You can find out more about the listener interfaces in <a href="#sec:build_phases">Build lifecycle events</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/BuildListener.html">BuildListener</a><sup class="footnote" id="_footnote_config_cache_incompat">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/ProjectEvaluationListener.html">ProjectEvaluationListener</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/execution/TaskExecutionGraphListener.html">TaskExecutionGraphListener</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/execution/TaskExecutionListener.html">TaskExecutionListener</a><sup class="footnoteref">[<a class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/execution/TaskActionListener.html">TaskActionListener</a><sup class="footnoteref">[<a class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build_environment"><a class="anchor" href="#build_environment"></a><a class="link" href="#build_environment">Configuring the Build Environment</a></h3>
<div class="paragraph">
<p>Configuring the build environment is a powerful way to customize the build process.
There are many mechanisms available.
By leveraging these mechanisms, you can make your Gradle builds more flexible and adaptable to different environments and requirements.</p>
</div>
<div class="sect3">
<h4 id="available_mechanisms"><a class="anchor" href="#available_mechanisms"></a><a class="link" href="#available_mechanisms">Available mechanisms</a></h4>
<div class="paragraph">
<p>Gradle provides multiple mechanisms for configuring the behavior of Gradle itself and specific projects:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Mechanism</th>
<th class="tableblock halign-left valign-top">Information</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#command_line_interface">Command line interface</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flags that configure build behavior and Gradle features</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--rerun</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:project_properties">Project properties</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties specific to your Gradle project</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TestFilter::isFailOnNoMatchingTests=false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:gradle_system_properties">System properties</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties that are passed to the Gradle runtime (JVM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>systemProp.http.proxyHost=somehost.org</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:gradle_configuration_properties">Gradle properties</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties that configure Gradle settings and the Java process that executes your build</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.gradle.logging.level=quiet</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:gradle_environment_variables">Environment variables</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties that configure build behavior based on the environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAVA_HOME</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="priority_for_configurations"><a class="anchor" href="#priority_for_configurations"></a><a class="link" href="#priority_for_configurations">Priority for configurations</a></h4>
<div class="paragraph">
<p>When configuring Gradle behavior, you can use these methods, but you must consider their priority.</p>
</div>
<div class="paragraph">
<p>The following table lists these methods in order of highest to lowest precedence (the first one wins):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Priority</th>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#command_line_interface">Command-line flags</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command line</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flags have precedence over properties and environment variables</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:gradle_system_properties">System properties</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project Root Dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stored in a <code>gradle.properties</code> file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:gradle_configuration_properties">Gradle properties</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GRADLE_USER_HOME</code><br>
Project Root Dir<br>
<code>GRADLE_HOME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stored in a <code>gradle.properties</code> file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:gradle_environment_variables">Environment variables</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sourced by the environment that executes Gradle</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here are all possible configurations of specifying the JDK installation directory in order of priority:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Command Line</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew yourTask -Dorg.gradle.java.home=/path/to/your/java/home</code></pre>
</div>
</div>
</li>
<li>
<p>Gradle Properties File</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">org.gradle.java.home=/path/to/your/java/home</code></pre>
</div>
</div>
</li>
<li>
<p>Environment Variable</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ export JAVA_HOME=/path/to/your/java/home</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="sec:project_properties"><a class="anchor" href="#sec:project_properties"></a><a class="link" href="#sec:project_properties">Project properties</a></h4>
<div class="paragraph">
<p>Project properties are specific to your Gradle project, they are variables or configuration blocks defined in your build script or in the <code>project</code> object.</p>
</div>
<div class="paragraph">
<p>For example, the project property <code>myProperty</code> is created in a build file:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext {
    myProperty = findProperty(<span class="string"><span class="delimiter">'</span><span class="content">myProperty</span><span class="delimiter">'</span></span>) ?: <span class="string"><span class="delimiter">'</span><span class="content">Hello, world!</span><span class="delimiter">'</span></span>
}

println <span class="string"><span class="delimiter">&quot;</span><span class="content">My property value: </span><span class="inline"><span class="inline-delimiter">${</span>project.ext.myProperty<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="setting_a_project_properties"><a class="anchor" href="#setting_a_project_properties"></a><a class="link" href="#setting_a_project_properties">Setting a project properties</a></h5>
<div class="paragraph">
<p>You have three options to add project properties, listed in order of priority:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Command Line:</strong> You can add project properties directly to your <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html">Project</a> object via the <code>-P</code> command line option.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew build -PmyProperty='Hi, world'</code></pre>
</div>
</div>
</li>
<li>
<p><strong>System Property:</strong> Gradle creates specially-named system properties for project properties which you can set using the <code>-D</code> command line flag or <code>gradle.properties</code> file. For the project property <code>prop</code>, the system property created is called <code>org.gradle.project.<em>prop</em></code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew build -Dorg.gradle.project.myProperty='Hi, world'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.project.myProperty='Hi, world'</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Environment Variables:</strong> You can set project properties with environment variables. If the environment variable name looks like <code>ORG_GRADLE_PROJECT<em>_prop</em>=somevalue</code>, then Gradle will set a <code>prop</code> property on your project object, with the value of <code>somevalue</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ export ORG_GRADLE_PROJECT_myProperty='Hi, world'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This feature is very useful when you don&#8217;t have admin rights to a continuous integration server and need to set property values that are not easily visible.
Since you cannot use the <code>-P</code> option in that scenario nor change the system-level configuration files, the correct strategy is to change the configuration of your continuous integration build job, adding an environment variable setting that matches an expected pattern.
This won&#8217;t be visible to normal users on the system.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:gradle_command_line_flags"><a class="anchor" href="#sec:gradle_command_line_flags"></a><a class="link" href="#sec:gradle_command_line_flags">Command-line flags</a></h4>
<div class="paragraph">
<p>The command line interface and the available flags are described in <a href="#command_line_interface">its own section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:gradle_system_properties"><a class="anchor" href="#sec:gradle_system_properties"></a><a class="link" href="#sec:gradle_system_properties">System properties</a></h4>
<div class="paragraph">
<p>System properties are variables set at the JVM level and accessible to the Gradle build process.
System properties can be accessed using the <code>System</code> class in the build script.</p>
</div>
<div class="sect4">
<h5 id="setting_system_properties"><a class="anchor" href="#setting_system_properties"></a><a class="link" href="#setting_system_properties">Setting system properties</a></h5>
<div class="paragraph">
<p>You have two options to add system properties listed in order of priority:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Command Line:</strong> Using the <code>-D</code> command-line option, you can pass a system property to the JVM, which runs Gradle.
The <code>-D</code> option of the <code>gradle</code> command has the same effect as the <code>-D</code> option of the <code>java</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew build -Dgradle.wrapperUser=myuser</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Gradle Properties File:</strong> You can also set system properties in <code>gradle.properties</code> files with the prefix <code>systemProp</code>.</p>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">systemProp.gradle.wrapperUser=myuser
systemProp.gradle.wrapperPassword=mypassword</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="system_properties_reference"><a class="anchor" href="#system_properties_reference"></a><a class="link" href="#system_properties_reference">System properties reference</a></h5>
<div class="paragraph">
<p>For a quick reference, the following are <em>common</em> system properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>gradle.wrapperUser=(myuser)</code></dt>
<dd>
<p>Specify username to download Gradle distributions <a href="#sec:authenticated_download">from servers using HTTP Basic Authentication</a>.</p>
</dd>
<dt class="hdlist1"><code>gradle.wrapperPassword=(mypassword)</code></dt>
<dd>
<p>Specify password for downloading a Gradle distribution using the Gradle wrapper.</p>
</dd>
<dt class="hdlist1"><code>gradle.user.home=(path to directory)</code></dt>
<dd>
<p>Specify the <code>GRADLE_USER_HOME</code> directory.</p>
</dd>
<dt class="hdlist1"><code>https.protocols</code></dt>
<dd>
<p>Specify the supported TLS versions in a comma-separated format. e.g., <code>TLSv1.2,TLSv1.3</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Additional Java system properties are listed <a href="https://docs.oracle.com/javase/tutorial/essential/environment/sysprop.html">here</a>.</p>
</div>
<div class="paragraph">
<p>In a multi-project build, <code>systemProp</code> properties set in any project except the root will be <strong>ignored</strong>.
Only the root project&#8217;s <code>gradle.properties</code> file will be checked for properties that begin with <code>systemProp</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="using_system_properties"><a class="anchor" href="#using_system_properties"></a><a class="link" href="#using_system_properties">Using system properties</a></h5>
<div class="paragraph">
<p>The following examples demonstrate how to use system properties:</p>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong> Setting system properties with a <code>gradle.properties</code> file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">systemProp.system=gradlePropertiesValue</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong> Reading system properties at configuration time:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Using the Java API
println(System.getProperty(&quot;system&quot;))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Using the Java API
println(System.getProperty(&quot;system&quot;))

// Using the Gradle API, provides a lazy Provider&lt;String&gt;
println(providers.systemProperty(&quot;system&quot;).get())</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Using the Java API
println(System.getProperty(&quot;system&quot;))

// Using the Gradle API, provides a lazy Provider&lt;String&gt;
println(providers.systemProperty(&quot;system&quot;).get())</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Using the Java API</span>
println <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">system</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Using the Java API</span>
println <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">system</span><span class="delimiter">'</span></span>)

<span class="comment">// Using the Gradle API, provides a lazy Provider&lt;String&gt;</span>
println providers.systemProperty(<span class="string"><span class="delimiter">'</span><span class="content">system</span><span class="delimiter">'</span></span>).get()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Using the Java API</span>
println <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">system</span><span class="delimiter">'</span></span>)

<span class="comment">// Using the Gradle API, provides a lazy Provider&lt;String&gt;</span>
println providers.systemProperty(<span class="string"><span class="delimiter">'</span><span class="content">system</span><span class="delimiter">'</span></span>).get()</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Example 3:</strong> Reading system properties for consumption at execution time:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;PrintValue&gt;(&quot;printProperty&quot;) {
    // Using the Gradle API, provides a lazy Provider&lt;String&gt; wired to a task input
    inputValue = providers.systemProperty(&quot;system&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">printProperty</span><span class="delimiter">'</span></span>, PrintValue) {
    <span class="comment">// Using the Gradle API, provides a lazy Provider&lt;String&gt; wired to a task input</span>
    inputValue = providers.systemProperty(<span class="string"><span class="delimiter">'</span><span class="content">system</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Example 4:</strong> Setting system properties from the command line <code>-D gradle.wrapperUser=username</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>$ gradle -Dsystem=commandLineValue</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:gradle_configuration_properties"><a class="anchor" href="#sec:gradle_configuration_properties"></a><a class="link" href="#sec:gradle_configuration_properties">Gradle properties</a></h4>
<div class="paragraph">
<p>Gradle provides several options that make it easy to configure the Java process that will be used to execute your build.
While it&#8217;s possible to configure these in your local environment via <code>GRADLE_OPTS</code> or <code>JAVA_OPTS</code>, it is useful to be able to store certain settings like JVM memory configuration and <code>JAVA_HOME</code> location in version control so that an entire team can work with a consistent environment.</p>
</div>
<div class="sect4">
<h5 id="setting_gradle_properties"><a class="anchor" href="#setting_gradle_properties"></a><a class="link" href="#setting_gradle_properties">Setting Gradle properties</a></h5>
<div class="paragraph">
<p>You have two options to add Gradle properties listed in order of priority:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Command Line:</strong> Using the <code>-D</code> command-line option, you can pass a Gradle property:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./gradlew build -Dorg.gradle.caching.debug=false</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Gradle Properties File:</strong> Place these settings into a <code>gradle.properties</code> file and commit it to your version control system.</p>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.caching.debug=false</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The final configuration considered by Gradle is a combination of all Gradle properties set on the command line and your <code>gradle.properties</code> files.
If an option is configured in multiple locations, the <em>first one</em> found in any of these locations wins:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Priority</th>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command line interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In the command line using <code>-D</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gradle.properties</code> file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GRADLE_USER_HOME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stored in a <code>gradle.properties</code> file in the <code><a href="#dir:gradle_user_home">GRADLE_USER_HOME</a></code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gradle.properties</code> file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project Root Dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stored in a <code>gradle.properties</code> file in a project directory, then its parent project’s directory up to the project’s root directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gradle.properties</code> file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GRADLE_HOME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stored in a <code>gradle.properties</code> file in the <code><a href="#sec:gradle_environment_variables">GRADLE_HOME</a></code>, the optional Gradle installation directory.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The location of the <code>GRADLE_USER_HOME</code> may have been changed beforehand via the <code>-Dgradle.user.home</code> system property passed on the command line.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="gradle_properties_reference"><a class="anchor" href="#gradle_properties_reference"></a><a class="link" href="#gradle_properties_reference">Gradle properties reference</a></h5>
<div class="paragraph">
<p>For reference, the following properties are common Gradle properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.gradle.caching=(true,false)</code></dt>
<dd>
<p>When set to <code>true</code>, Gradle will reuse task outputs from any previous build when possible, <a href="#build_cache">resulting in much faster builds</a>.</p>
<div class="paragraph">
<p><em>Default is <code>false</code>; the build cache is <strong>not</strong> enabled.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.caching.debug=(true,false)</code></dt>
<dd>
<p>When set to <code>true</code>, individual input property hashes and the build cache key for each task are <a href="#sec:task_output_caching">logged on the console</a>.</p>
<div class="paragraph">
<p><em>Default is <code>false</code>.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.configuration-cache=(true,false)</code></dt>
<dd>
<p>Enables <a href="#config_cache:usage:enable">configuration caching</a>. Gradle will try to reuse the build configuration from previous builds.</p>
<div class="paragraph">
<p><em>Default is <code>false</code>.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.configureondemand=(true,false)</code></dt>
<dd>
<p>Enables incubating configuration-on-demand, where Gradle will attempt to configure only necessary projects.</p>
<div class="paragraph">
<p><em>Default is <code>false</code>.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.console=(auto,plain,rich,verbose)</code></dt>
<dd>
<p>Customize <a href="#sec:command_line_logging">console output</a> coloring or verbosity.</p>
<div class="paragraph">
<p><em>Default depends on how Gradle is invoked.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.continue=(true,false)</code></dt>
<dd>
<p>If enabled, continue task execution after a task failure, else stop task execution after a task failure.</p>
<div class="paragraph">
<p><em>Default is <code>false</code>.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.daemon=(true,false)</code></dt>
<dd>
<p>When set to <code>true</code> the <a href="#gradle_daemon">Gradle Daemon</a> is used to run the build.</p>
<div class="paragraph">
<p><em>Default is <code>true</code>.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.daemon.idletimeout=(# of idle millis)</code></dt>
<dd>
<p>Gradle Daemon will terminate itself after a specified number of idle milliseconds.</p>
<div class="paragraph">
<p><em>Default is <code>10800000</code> (3 hours).</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.debug=(true,false)</code></dt>
<dd>
<p>When set to <code>true</code>, Gradle will run the build with remote debugging enabled, listening on port 5005.
Note that this is equivalent to adding <code>-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005</code> to the JVM command line and will suspend the virtual machine until a debugger is attached.</p>
<div class="paragraph">
<p><em>Default is <code>false</code>.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.java.home=(path to JDK home)</code></dt>
<dd>
<p>Specifies the Java home for the Gradle build process.
The value can be set to either a <code>jdk</code> or <code>jre</code> location; however, using a JDK is safer depending on what your build does.
This does not affect the version of Java used to launch the <a href="#sec:gradle_environment_variables">Gradle client VM</a>.</p>
<div class="paragraph">
<p>You can also control the JVM used to run Gradle itself using the <a href="#sec:daemon_jvm_criteria">Daemon JVM criteria</a>.</p>
</div>
<div class="paragraph">
<p><em>Default is derived from your environment (<code>JAVA_HOME</code> or the path to <code>java</code>) if the setting is unspecified.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.jvmargs=(JVM arguments)</code></dt>
<dd>
<p>Specifies the JVM arguments used for the Gradle Daemon.
The setting is particularly useful for <a href="#sec:configuring_jvm_memory">configuring JVM memory settings</a> for build performance.
This does not affect the JVM settings for the Gradle client VM.</p>
<div class="paragraph">
<p><em>Default is <code>-Xmx512m "-XX:MaxMetaspaceSize=384m"</code>.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.logging.level=(quiet,warn,lifecycle,info,debug)</code></dt>
<dd>
<p>When set to quiet, warn, info, or debug, Gradle will use this <a href="#sec:choosing_a_log_level">log level</a>.
The values are not case-sensitive.</p>
<div class="paragraph">
<p><em>Default is <code>lifecycle</code> level.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.parallel=(true,false)</code></dt>
<dd>
<p>When configured, Gradle will fork up to <code>org.gradle.workers.max</code> JVMs to execute <a href="#parallel_execution">projects in parallel</a>.</p>
<div class="paragraph">
<p><em>Default is <code>false</code>.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.priority=(low,normal)</code></dt>
<dd>
<p>Specifies the <a href="#sec:command_line_performance">scheduling priority</a> for the Gradle daemon and all processes launched by it.</p>
<div class="paragraph">
<p><em>Default is <code>normal</code>.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.projectcachedir=(directory)</code></dt>
<dd>
<p>Specify the project-specific cache directory. Defaults to <code>.gradle</code> in the root project directory."</p>
<div class="paragraph">
<p><em>Default is <code>.gradle</code>.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.unsafe.isolated-projects=(true,false)</code></dt>
<dd>
<p>Enables project isolation, which enables configuration caching.</p>
<div class="paragraph">
<p><em>Default is <code>false</code>.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.vfs.verbose=(true,false)</code></dt>
<dd>
<p>Configures verbose logging when <a href="#sec:daemon_watch_fs">watching the file system</a>.</p>
<div class="paragraph">
<p><em>Default is <code>false</code>.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.vfs.watch=(true,false)</code></dt>
<dd>
<p>Toggles <a href="#sec:daemon_watch_fs">watching the file system</a>.
When enabled, Gradle reuses information it collects about the file system between builds.</p>
<div class="paragraph">
<p><em>Default is <code>true</code> on operating systems where Gradle supports this feature.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.warning.mode=(all,fail,summary,none)</code></dt>
<dd>
<p>When set to <code>all</code>, <code>summary</code>, or <code>none</code>, Gradle will use <a href="#sec:command_line_logging">different warning type display</a>.</p>
<div class="paragraph">
<p><em>Default is <code>summary</code>.</em></p>
</div>
</dd>
<dt class="hdlist1"><code>org.gradle.workers.max=(max # of worker processes)</code></dt>
<dd>
<p>When configured, Gradle will use a maximum of the <a href="#sec:command_line_performance">given number of workers</a>.</p>
<div class="paragraph">
<p><em>Default is the number of CPU processors.</em></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="using_gradle_properties"><a class="anchor" href="#using_gradle_properties"></a><a class="link" href="#using_gradle_properties">Using Gradle properties</a></h5>
<div class="paragraph">
<p>The following examples demonstrate how to use Gradle properties.</p>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong> Setting Gradle properties with a <code>gradle.properties</code> file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">gradlePropertiesProp=gradlePropertiesValue
gradleProperties.with.dots=gradlePropertiesDottedValue</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong> Reading Gradle properties at configuration time:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Using the API, provides a lazy Provider&lt;String&gt;
println(providers.gradleProperty(&quot;gradlePropertiesProp&quot;).get())

// Using Kotlin delegated properties on `settings`
val gradlePropertiesProp: String by settings
println(gradlePropertiesProp)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Using the API, provides a lazy Provider&lt;String&gt;
println(providers.gradleProperty(&quot;gradlePropertiesProp&quot;).get())

// Using Kotlin delegated properties on `project`
val gradlePropertiesProp: String by project
println(gradlePropertiesProp)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Using the API, provides a lazy Provider&lt;String&gt;</span>
println providers.gradleProperty(<span class="string"><span class="delimiter">'</span><span class="content">gradlePropertiesProp</span><span class="delimiter">'</span></span>).get()

<span class="comment">// Using Groovy dynamic names</span>
println gradlePropertiesProp
println settings.gradlePropertiesProp

<span class="comment">// Using Groovy dynamic array notation on `settings`</span>
println settings[<span class="string"><span class="delimiter">'</span><span class="content">gradlePropertiesProp</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Using the API, provides a lazy Provider&lt;String&gt;</span>
println providers.gradleProperty(<span class="string"><span class="delimiter">'</span><span class="content">gradlePropertiesProp</span><span class="delimiter">'</span></span>).get()

<span class="comment">// Using Groovy dynamic names</span>
println gradlePropertiesProp
println project.gradlePropertiesProp

<span class="comment">// Using Groovy dynamic array notation on `project`</span>
println project[<span class="string"><span class="delimiter">'</span><span class="content">gradlePropertiesProp</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>The <a href="https://kotlinlang.org/docs/delegated-properties.html">Kotlin delegated properties</a> are part of the Gradle Kotlin DSL.
You need to explicitly specify the type as <code>String</code>.
If you need to branch depending on the presence of the property, you can also use <code>String?</code> and check for <code>null</code>.</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>Note that using the dynamic Groovy names is impossible if a Gradle property has a dot in its name.
You have to use the API or the dynamic array notation instead.</p>
</div>
<div class="paragraph">
<p><strong>Example 3:</strong> Reading Gradle properties for consumption at execution time:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;PrintValue&gt;(&quot;printProperty&quot;) {
    // Using the API, provides a lazy Provider&lt;String&gt; wired to a task input
    inputValue = providers.gradleProperty(&quot;gradlePropertiesProp&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">printProperty</span><span class="delimiter">'</span></span>, PrintValue) {
    <span class="comment">// Using the API, provides a lazy Provider&lt;String&gt; wired to a task input</span>
    inputValue = providers.gradleProperty(<span class="string"><span class="delimiter">'</span><span class="content">gradlePropertiesProp</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Example 4:</strong> Setting Gradle properties from the command line:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>$ gradle -DgradlePropertiesProp=commandLineValue</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that <a href="#init_scripts">initialization scripts</a> can&#8217;t read Gradle properties directly.
The earliest Gradle properties can be read in initialization scripts is on <code>settingsEvaluated {}</code>:</p>
</div>
<div class="paragraph">
<p><strong>Example 5:</strong> Reading Gradle properties from initialization scripts:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">settingsEvaluated {
    // Using the API, provides a lazy Provider&lt;String&gt;
    println(providers.gradleProperty(&quot;gradlePropertiesProp&quot;).get())

    // Using Kotlin delegated properties on `settings`
    val gradlePropertiesProp: String by this
    println(gradlePropertiesProp)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">settingsEvaluated { settings -&gt;
    <span class="comment">// Using the API, provides a lazy Provider&lt;String&gt;</span>
    println settings.providers.gradleProperty(<span class="string"><span class="delimiter">'</span><span class="content">gradlePropertiesProp</span><span class="delimiter">'</span></span>).get()

    <span class="comment">// Using Groovy dynamic names</span>
    println settings.gradlePropertiesProp

    <span class="comment">// Using Groovy dynamic array notation on `settings`</span>
    println settings[<span class="string"><span class="delimiter">'</span><span class="content">gradlePropertiesProp</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Properties declared in a <code>gradle.properties</code> file present in a subproject directory are only available to that project and its children.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:gradle_environment_variables"><a class="anchor" href="#sec:gradle_environment_variables"></a><a class="link" href="#sec:gradle_environment_variables">Environment variables</a></h4>
<div class="paragraph">
<p>Gradle provides a number of environment variables, which are listed below.</p>
</div>
<div class="sect4">
<h5 id="setting_environment_variables"><a class="anchor" href="#setting_environment_variables"></a><a class="link" href="#setting_environment_variables">Setting environment variables</a></h5>
<div class="paragraph">
<p>Let&#8217;s take an example that sets the $JAVA_HOME environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ set JAVA_HOME=C:\Path\To\Your\Java\Home   // Windows
$ export JAVA_HOME=/path/to/your/java/home  // Mac/Linux</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can access environment variables as properties in the build script using the <code>System.getenv()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task printEnvVariables {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">JAVA_HOME: </span><span class="inline"><span class="inline-delimiter">${</span><span class="predefined-type">System</span>.getenv(<span class="string"><span class="delimiter">'</span><span class="content">JAVA_HOME</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="environment_variables_reference"><a class="anchor" href="#environment_variables_reference"></a><a class="link" href="#environment_variables_reference">Environment variables reference</a></h5>
<div class="paragraph">
<p>The following environment variables are available for the <code>gradle</code> command:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>GRADLE_HOME</code></dt>
<dd>
<p>Installation directory for Gradle.</p>
<div class="paragraph">
<p>Can be used to specify a local Gradle version instead of using the wrapper.</p>
</div>
<div class="paragraph">
<p>You can add <code>GRADLE_HOME/bin</code> to your <code>PATH</code> for specific applications and use cases (such as testing an early release for Gradle).</p>
</div>
</dd>
<dt class="hdlist1"><code>JAVA_OPTS</code></dt>
<dd>
<p>Used to pass JVM options and custom settings to the JVM.</p>
</dd>
<dt class="hdlist1"><code>GRADLE_OPTS</code></dt>
<dd>
<p>Specifies JVM arguments to use when starting the Gradle client VM.</p>
<div class="paragraph">
<p>The client VM only handles command line input/output, so one would rarely need to change its VM options.</p>
</div>
<div class="paragraph">
<p>The actual build is run by the Gradle daemon, which is not affected by this environment variable.</p>
</div>
</dd>
<dt class="hdlist1"><code><a href="#dir:gradle_user_home">GRADLE_USER_HOME</a></code></dt>
<dd>
<p>Specifies the <code>GRADLE_USER_HOME</code> directory for Gradle to store its global configuration properties, initialization scripts, caches, log files and more.</p>
<div class="paragraph">
<p>Defaults to <code>USER_HOME/.gradle</code> if not set.</p>
</div>
</dd>
<dt class="hdlist1"><code>JAVA_HOME</code></dt>
<dd>
<p>Specifies the JDK installation directory to use for the client VM.</p>
<div class="paragraph">
<p>This VM is also used for the daemon unless a different one is specified in a Gradle properties file with <code>org.gradle.java.home</code> or using the <a href="#sec:daemon_jvm_criteria">Daemon JVM criteria</a>.</p>
</div>
</dd>
<dt class="hdlist1"><code>GRADLE_LIBS_REPO_OVERRIDE</code></dt>
<dd>
<p>Overrides for the default Gradle library repository.</p>
<div class="paragraph">
<p>Can be used to specify a default Gradle repository URL in <code>org.gradle.plugins.ide.internal.resolver</code>.</p>
</div>
<div class="paragraph">
<p>Useful override to specify an internally hosted repository if your company uses a firewall/proxy.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="using_environment_variables"><a class="anchor" href="#using_environment_variables"></a><a class="link" href="#using_environment_variables">Using environment variables</a></h5>
<div class="paragraph">
<p>The following examples demonstrate how to use environment variables.</p>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong> Reading environment variables at configuration time:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Using the Java API
println(System.getenv(&quot;ENVIRONMENTAL&quot;))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Using the Java API
println(System.getenv(&quot;ENVIRONMENTAL&quot;))

// Using the Gradle API, provides a lazy Provider&lt;String&gt;
println(providers.environmentVariable(&quot;ENVIRONMENTAL&quot;).get())</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Using the Java API
println(System.getenv(&quot;ENVIRONMENTAL&quot;))

// Using the Gradle API, provides a lazy Provider&lt;String&gt;
println(providers.environmentVariable(&quot;ENVIRONMENTAL&quot;).get())</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Using the Java API</span>
println <span class="predefined-type">System</span>.getenv(<span class="string"><span class="delimiter">'</span><span class="content">ENVIRONMENTAL</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Using the Java API</span>
println <span class="predefined-type">System</span>.getenv(<span class="string"><span class="delimiter">'</span><span class="content">ENVIRONMENTAL</span><span class="delimiter">'</span></span>)

<span class="comment">// Using the Gradle API, provides a lazy Provider&lt;String&gt;</span>
println providers.environmentVariable(<span class="string"><span class="delimiter">'</span><span class="content">ENVIRONMENTAL</span><span class="delimiter">'</span></span>).get()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Using the Java API</span>
println <span class="predefined-type">System</span>.getenv(<span class="string"><span class="delimiter">'</span><span class="content">ENVIRONMENTAL</span><span class="delimiter">'</span></span>)

<span class="comment">// Using the Gradle API, provides a lazy Provider&lt;String&gt;</span>
println providers.environmentVariable(<span class="string"><span class="delimiter">'</span><span class="content">ENVIRONMENTAL</span><span class="delimiter">'</span></span>).get()</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong> Reading environment variables for consumption at execution time:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;PrintValue&gt;(&quot;printValue&quot;) {
    // Using the Gradle API, provides a lazy Provider&lt;String&gt; wired to a task input
    inputValue = providers.environmentVariable(&quot;ENVIRONMENTAL&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">printValue</span><span class="delimiter">'</span></span>, PrintValue) {
    <span class="comment">// Using the Gradle API, provides a lazy Provider&lt;String&gt; wired to a task input</span>
    inputValue = providers.environmentVariable(<span class="string"><span class="delimiter">'</span><span class="content">ENVIRONMENTAL</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="init_scripts"><a class="anchor" href="#init_scripts"></a><a class="link" href="#init_scripts">Initialization Scripts</a></h3>
<div class="paragraph">
<p>Initialization scripts are scripts that run before the build script is executed.
They allow you to customize the build environment or configure settings early in the build.</p>
</div>
<div class="paragraph">
<p>Initialization scripts can be useful for setting up common configurations, such as repositories, plugins, or custom tasks, across multiple projects.</p>
</div>
<div class="sect3">
<h4 id="sec:basic_usage"><a class="anchor" href="#sec:basic_usage"></a><a class="link" href="#sec:basic_usage">Using an init script</a></h4>
<div class="paragraph">
<p>Initialization scripts, also called <em>init scripts</em>, are similar to other scripts in Gradle.
Initialization scripts run before the build starts.</p>
</div>
<div class="paragraph">
<p>They are useful for various purposes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting up enterprise-wide configurations (e.g., custom plugin locations)</p>
</li>
<li>
<p>Configuring properties based on the environment (e.g., developer&#8217;s machine vs. CI server)</p>
</li>
<li>
<p>Providing user-specific information (e.g., authentication credentials)</p>
</li>
<li>
<p>Defining machine-specific details (e.g., JDK locations)</p>
</li>
<li>
<p>Registering build listeners (e.g., external tools that wish to listen to Gradle events might find this helpful)</p>
</li>
<li>
<p>Registering loggers (e.g., customize how Gradle logs the events that it generates)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One main <a href="#sec:using_buildsrc">limitation of init scripts</a> is that they cannot access classes in the <code>buildSrc</code> project.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:using_an_init_script"><a class="anchor" href="#sec:using_an_init_script"></a><a class="link" href="#sec:using_an_init_script">Invoking an init script</a></h4>
<div class="paragraph">
<p>There are several ways to invoke an init script (in order of priority):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Specify a file on the command line</strong> with the option <code>-I</code> or <code>--init-script</code> followed by the path to the script.</p>
<div class="paragraph">
<p>The command line option can appear more than once, each time adding another init script. The build will fail if any files specified on the command line do not exist.</p>
</div>
</li>
<li>
<p><strong>Put a file called <code>init.gradle(.kts)</code></strong> in the <code><em>$<a href="#dir:gradle_user_home">GRADLE_USER_HOME</a></em>/</code> directory.</p>
</li>
<li>
<p><strong>Put a file called <code>init.gradle(.kts)</code></strong> in the <code><em>$<a href="#dir:gradle_user_home">GRADLE_USER_HOME</a></em>/init.d/</code> directory.</p>
</li>
<li>
<p><strong>Put a file called <code>init.gradle(.kts)</code></strong> in the <code>$<a href="#sec:linux_macos_users_2"><em>GRADLE_HOME</em></a>/init.d/</code> directory.</p>
<div class="paragraph">
<p>This lets you package a custom Gradle distribution containing custom build logic and plugins. You can combine this with the <a href="#gradle_wrapper_reference">Gradle wrapper</a> to make custom logic available to all builds in your enterprise.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If more than one init script is found, they will all be executed in the order specified above.</p>
</div>
<div class="paragraph">
<p>Scripts in a given directory are executed in alphabetical order.
For example, a tool can specify an init script on the command line and another in the home directory to define the environment.
Both scripts will run when Gradle is executed.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:writing_an_init_script"><a class="anchor" href="#sec:writing_an_init_script"></a><a class="link" href="#sec:writing_an_init_script">Writing an init script</a></h4>
<div class="paragraph">
<p>Like a Gradle build script, an init script is a Groovy or Kotlin script.
Each init script has a <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.invocation.Gradle.html">Gradle</a> instance associated with it.
Any property reference and method call in the init script will be delegated to this <code>Gradle</code> instance.</p>
</div>
<div class="paragraph">
<p>Each init script implements the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Script.html">Script</a> interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When writing init scripts, pay attention to the scope of the reference you are trying to access.
For example, properties loaded from <code>gradle.properties</code> are available on <code>Settings</code> or <code>Project</code> instances but not on the <code>Gradle</code> one.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sec:configuring_projects_from_an_init_script"><a class="anchor" href="#sec:configuring_projects_from_an_init_script"></a><a class="link" href="#sec:configuring_projects_from_an_init_script">Configuring projects from an init script</a></h5>
<div class="paragraph">
<p>You can use an init script to configure the projects in the build.
This works similarly to configuring projects in a multi-project build.</p>
</div>
<div class="paragraph">
<p>The following sample shows how to perform extra configuration from an init script <em>before</em> the projects are evaluated:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">showRepos</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> repositoryNames = repositories.collect { <span class="local-variable">it</span>.name }
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">All repos:</span><span class="delimiter">&quot;</span></span>
        println repositoryNames
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">allprojects {
    repositories {
        mavenLocal()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

tasks.register(&quot;showRepos&quot;) {
    val repositoryNames = repositories.map { it.name }
    doLast {
        println(&quot;All repos:&quot;)
        println(repositoryNames)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">allprojects {
    repositories {
        mavenLocal()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This sample uses this feature to configure an additional repository to be used only for specific environments.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">&gt; gradle --init-script init.gradle.kts -q showRepos
All repos:
[MavenLocal, MavenRepo]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&gt; gradle --init-script init.gradle -q showRepos
All <span class="key">repos</span>:
[MavenLocal, MavenRepo]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:custom_classpath"><a class="anchor" href="#sec:custom_classpath"></a><a class="link" href="#sec:custom_classpath">Adding external dependencies</a></h4>
<div class="paragraph">
<p>Init scripts can also declare dependencies with the <code>initscript()</code> method, passing in a closure that declares the init script classpath.</p>
</div>
<div class="paragraph">
<p>Declaring external dependencies for an init script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">initscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath(&quot;org.apache.commons:commons-math:2.0&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">initscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-math:2.0</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The closure passed to the <code>initscript()</code> method configures a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/initialization/dsl/ScriptHandler.html">ScriptHandler</a> instance.
You declare the init script classpath by adding dependencies to the <code>classpath</code> configuration.</p>
</div>
<div class="paragraph">
<p>This is the same way you declare, for example, the Java compilation classpath.
You can use any of the dependency types described in <a href="#declaring-dependencies">Declaring Dependencies</a>, except project dependencies.</p>
</div>
<div class="paragraph">
<p>Having declared the init script classpath, you can use the classes in your init script as you would any other classes on the classpath.
The following example adds to the previous example and uses classes from the init script classpath.</p>
</div>
<div class="paragraph">
<p>An init script with external dependencies:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.apache.commons.math.fraction.Fraction

initscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath(&quot;org.apache.commons:commons-math:2.0&quot;)
    }
}

println(Fraction.ONE_FIFTH.multiply(2))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;doNothing&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.apache.commons.math.fraction.Fraction</span>

initscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-math:2.0</span><span class="delimiter">'</span></span>
    }
}

println Fraction.ONE_FIFTH.multiply(<span class="integer">2</span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">doNothing</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">&gt; gradle --init-script init.gradle.kts -q doNothing
2 / 5</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&gt; gradle --init-script init.gradle -q doNothing
<span class="integer">2</span> / <span class="integer">5</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:init_script_plugins"><a class="anchor" href="#sec:init_script_plugins"></a><a class="link" href="#sec:init_script_plugins">Applying plugins</a></h4>
<div class="paragraph">
<p>Plugins can be applied to init scripts like a Gradle build script or a Gradle settings file.</p>
</div>
<div class="paragraph">
<p>Using plugins in init scripts:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply&lt;EnterpriseRepositoryPlugin&gt;()

class EnterpriseRepositoryPlugin : Plugin&lt;Gradle&gt; {
    companion object {
        const val ENTERPRISE_REPOSITORY_URL = &quot;https://repo.gradle.org/gradle/repo&quot;
    }

    override fun apply(gradle: Gradle) {
        // ONLY USE ENTERPRISE REPO FOR DEPENDENCIES
        gradle.allprojects {
            repositories {

                // Remove all repositories not pointing to the enterprise repository url
                all {
                    if (this !is MavenArtifactRepository || url.toString() != ENTERPRISE_REPOSITORY_URL) {
                        project.logger.lifecycle(&quot;Repository ${(this as? MavenArtifactRepository)?.url ?: name} removed. Only $ENTERPRISE_REPOSITORY_URL is allowed&quot;)
                        remove(this)
                    }
                }

                // add the enterprise repository
                add(maven {
                    name = &quot;STANDARD_ENTERPRISE_REPO&quot;
                    url = uri(ENTERPRISE_REPOSITORY_URL)
                })
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories{
    mavenCentral()
}

data class RepositoryData(val name: String, val url: URI)

tasks.register(&quot;showRepositories&quot;) {
    val repositoryData = repositories.withType&lt;MavenArtifactRepository&gt;().map { RepositoryData(it.name, it.url) }
    doLast {
        repositoryData.forEach {
            println(&quot;repository: ${it.name} ('${it.url}')&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: EnterpriseRepositoryPlugin

<span class="type">class</span> <span class="class">EnterpriseRepositoryPlugin</span> <span class="directive">implements</span> Plugin&lt;Gradle&gt; {

    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> ENTERPRISE_REPOSITORY_URL = <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.gradle.org/gradle/repo</span><span class="delimiter">&quot;</span></span>

    <span class="type">void</span> apply(Gradle gradle) {
        <span class="comment">// ONLY USE ENTERPRISE REPO FOR DEPENDENCIES</span>
        gradle.allprojects { project -&gt;
            project.repositories {

                <span class="comment">// Remove all repositories not pointing to the enterprise repository url</span>
                all { ArtifactRepository repo -&gt;
                    <span class="keyword">if</span> (!(repo <span class="keyword">instanceof</span> MavenArtifactRepository) ||
                          repo.url.toString() != ENTERPRISE_REPOSITORY_URL) {
                        project.logger.lifecycle <span class="string"><span class="delimiter">&quot;</span><span class="content">Repository </span><span class="inline"><span class="inline-delimiter">${</span>repo.url<span class="inline-delimiter">}</span></span><span class="content"> removed. Only </span><span class="inline"><span class="inline-delimiter">$</span>ENTERPRISE_REPOSITORY_URL</span><span class="content"> is allowed</span><span class="delimiter">&quot;</span></span>
                        remove repo
                    }
                }

                <span class="comment">// add the enterprise repository</span>
                maven {
                    name <span class="string"><span class="delimiter">&quot;</span><span class="content">STANDARD_ENTERPRISE_REPO</span><span class="delimiter">&quot;</span></span>
                    url ENTERPRISE_REPOSITORY_URL
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories{
    mavenCentral()
}

<span class="annotation">@Immutable</span>
<span class="type">class</span> <span class="class">RepositoryData</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">URI</span> url
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">showRepositories</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> repositoryData = repositories.collect { <span class="keyword">new</span> RepositoryData(<span class="local-variable">it</span>.name, <span class="local-variable">it</span>.url) }
    doLast {
        repositoryData.each {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">repository: </span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">it</span>.name<span class="inline-delimiter">}</span></span><span class="content"> ('</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">it</span>.url<span class="inline-delimiter">}</span></span><span class="content">')</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">&gt; gradle --init-script init.gradle.kts -q showRepositories
repository: STANDARD_ENTERPRISE_REPO ('https://repo.gradle.org/gradle/repo')</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&gt; gradle --init-script init.gradle -q showRepositories
<span class="key">repository</span>: STANDARD_ENTERPRISE_REPO (<span class="string"><span class="delimiter">'</span><span class="content">https://repo.gradle.org/gradle/repo</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin in the init script ensures that only a specified repository is used when running the build.</p>
</div>
<div class="paragraph">
<p>When applying plugins within the init script, Gradle instantiates the plugin and calls the plugin instance&#8217;s <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Plugin.html#apply-T-">Plugin.apply(T)</a> method.</p>
</div>
<div class="paragraph">
<p>The <code>gradle</code> object is passed as a parameter, which can be used to configure all aspects of a build. Of course, the applied plugin can be resolved as an external dependency as described in <a href="#sec:custom_classpath">External dependencies for the init script</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build_services"><a class="anchor" href="#build_services"></a><a class="link" href="#build_services">Using Shared Build Services</a></h3>
<div class="paragraph">
<p>Shared build services allow tasks to share state or resources.
For example, tasks might share a cache of pre-computed values or use a web service or database instance.</p>
</div>
<div class="paragraph">
<p>A build service is an object that holds the state for tasks to use.
It provides an alternative mechanism for hooking into a Gradle build and receiving information about task execution and operation completion.</p>
</div>
<div class="paragraph">
<p>Build services are configuration cacheable.</p>
</div>
<div class="paragraph">
<p>Gradle manages the service lifecycle, creating the service instance only when required and cleaning it up when no longer needed.
Gradle can also coordinate access to the build service, ensuring that no more than a specified number of tasks use the service concurrently.</p>
</div>
<div class="sect3">
<h4 id="implementing_a_build_service"><a class="anchor" href="#implementing_a_build_service"></a><a class="link" href="#implementing_a_build_service">Implementing a build service</a></h4>
<div class="paragraph">
<p>To implement a build service, create an abstract class that implements <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/services/BuildService.html">BuildService</a>.
Then, define methods you want the tasks to use on this type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">BaseCountingService</span> <span class="directive">implements</span> BuildService&lt;CountingParams&gt;, AutoCloseable {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A build service implementation is treated as a <a href="properties_providers.html#properties_and_providers">custom Gradle type</a> and can use any of the features available to custom Gradle types.</p>
</div>
<div class="paragraph">
<p>A build service can optionally take parameters, which Gradle injects into the service instance when creating it.
To provide parameters, you define an abstract class (or interface) that holds the parameters.
The parameters type must implement (or extend) <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/services/BuildServiceParameters.html">BuildServiceParameters</a>.
The service implementation can access the parameters using <code>this.getParameters()</code>.
The parameters type is also a <a href="properties_providers.html#properties_and_providers">custom Gradle type</a>.</p>
</div>
<div class="paragraph">
<p>When the build service does not require any parameters, you can use <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/services/BuildServiceParameters.None.html">BuildServiceParameters.None</a> as the type of parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">interface</span> CountingParams <span class="directive">extends</span> BuildServiceParameters {
    Property&lt;<span class="predefined-type">Integer</span>&gt; getInitial()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A build service implementation can also optionally implement <code>AutoCloseable</code>, in which case Gradle will call the build service instance&#8217;s <code>close()</code> method when it discards the service instance.
This happens sometime between the completion of the last task that uses the build service and the end of the build.</p>
</div>
<div class="paragraph">
<p>Here is an example of a service that takes parameters and is closeable:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">WebServer.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.file.DirectoryProperty</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Property</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.services.BuildService</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.services.BuildServiceParameters</span>;

<span class="keyword">import</span> <span class="include">java.net.URI</span>;
<span class="keyword">import</span> <span class="include">java.net.URISyntaxException</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">WebServer</span> <span class="directive">implements</span> BuildService&lt;WebServer.Params&gt;, AutoCloseable {

    <span class="comment">// Some parameters for the web server</span>
    <span class="type">interface</span> <span class="class">Params</span> <span class="directive">extends</span> BuildServiceParameters {
        Property&lt;<span class="predefined-type">Integer</span>&gt; getPort();

        DirectoryProperty getResources();
    }

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">URI</span> uri;

    <span class="directive">public</span> WebServer() <span class="directive">throws</span> <span class="exception">URISyntaxException</span> {
        <span class="comment">// Use the parameters</span>
        <span class="type">int</span> port = getParameters().getPort().get();
        uri = <span class="keyword">new</span> <span class="predefined-type">URI</span>(<span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://localhost:%d/</span><span class="delimiter">&quot;</span></span>, port));

        <span class="comment">// Start the server ...</span>

        <span class="predefined-type">System</span>.out.println(<span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">Server is running at %s</span><span class="delimiter">&quot;</span></span>, uri));
    }

    <span class="comment">// A public method for tasks to use</span>
    <span class="directive">public</span> <span class="predefined-type">URI</span> getUri() {
        <span class="keyword">return</span> uri;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> close() {
        <span class="comment">// Stop the server ...</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that you should <strong>not</strong> implement the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/services/BuildService.html#getParameters--">BuildService.getParameters()</a> method, as Gradle will provide an implementation of this.</p>
</div>
<div class="paragraph">
<p>A build service implementation must be thread-safe, as it will potentially be used by multiple tasks concurrently.</p>
</div>
</div>
<div class="sect3">
<h4 id="using_a_build_service_from_a_task"><a class="anchor" href="#using_a_build_service_from_a_task"></a><a class="link" href="#using_a_build_service_from_a_task">Using a build service in a task</a></h4>
<div class="paragraph">
<p>To use a build service from a task, you need to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a property to the task of type <code>Property&lt;MyServiceType&gt;</code>.</p>
</li>
<li>
<p>Annotate the property with <code>@Internal</code> or <code>@ServiceReference</code> (since 8.0).</p>
</li>
<li>
<p>Assign a shared build service provider to the property (optional, when using <code>@ServiceReference(&lt;serviceName&gt;)</code>).</p>
</li>
<li>
<p>Declare the association between the task and the service so Gradle can properly honor the build service lifecycle and its usage constraints (also optional when using <code>@ServiceReference</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that using a service with any other annotation is currently not supported.
For example, it is currently impossible to mark a service as an input to a task.</p>
</div>
<div class="sect4">
<h5 id="annotating_a_shared_build_service_property_with_internal"><a class="anchor" href="#annotating_a_shared_build_service_property_with_internal"></a><a class="link" href="#annotating_a_shared_build_service_property_with_internal">Annotating a shared build service property with <code>@Internal</code></a></h5>
<div class="paragraph">
<p>When you annotate a shared build service property with <code>@Internal</code>, you need to do two more things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Explicitly assign a build service provider obtained when registering the service with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/services/BuildServiceRegistry.html#registerIfAbsent-java.lang.String-java.lang.Class-org.gradle.api.Action-">BuildServiceRegistry.registerIfAbsent()</a> to the property.</p>
</li>
<li>
<p>Explicitly declare the association between the task and the service via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Task.html#usesService-org.gradle.api.provider.Provider-">Task.usesService</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here is an example of a task that consumes the previous service via a property annotated with <code>@Internal</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">Download.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.RegularFileProperty</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Property</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.Internal</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.OutputFile</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>;

<span class="keyword">import</span> <span class="include">java.net.URI</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">Download</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// This property provides access to the service instance</span>
    <span class="annotation">@Internal</span>
    <span class="directive">abstract</span> Property&lt;WebServer&gt; getServer();

    <span class="annotation">@OutputFile</span>
    <span class="directive">abstract</span> RegularFileProperty getOutputFile();

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> download() {
        <span class="comment">// Use the server to download a file</span>
        WebServer server = getServer().get();
        <span class="predefined-type">URI</span> uri = server.getUri().resolve(<span class="string"><span class="delimiter">&quot;</span><span class="content">somefile.zip</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">System</span>.out.println(<span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">Downloading %s</span><span class="delimiter">&quot;</span></span>, uri));
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:service_references"><a class="anchor" href="#sec:service_references"></a><a class="link" href="#sec:service_references">Annotating a shared build service property with <code>@ServiceReference</code></a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>@ServiceReference</code> annotation is an <a href="#feature_lifecycle">incubating</a> API and is subject to change in a future release.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Otherwise, when you annotate a shared build service property with <code>@ServiceReference</code>, there is no need to declare the association between the task and the service explicitly; also, if you provide a service name to the annotation, and a shared build service is registered with that name, it will be automatically assigned to the property when the task is created.</p>
</div>
<div class="paragraph">
<p>Here is an example of a task that consumes the previous service via a property annotated with <code>@ServiceReference</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">Download.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.RegularFileProperty</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Property</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.services.ServiceReference</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.OutputFile</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>;

<span class="keyword">import</span> <span class="include">java.net.URI</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">Download</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// This property provides access to the service instance</span>
    <span class="annotation">@ServiceReference</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">web</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">abstract</span> Property&lt;WebServer&gt; getServer();

    <span class="annotation">@OutputFile</span>
    <span class="directive">abstract</span> RegularFileProperty getOutputFile();

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> download() {
        <span class="comment">// Use the server to download a file</span>
        WebServer server = getServer().get();
        <span class="predefined-type">URI</span> uri = server.getUri().resolve(<span class="string"><span class="delimiter">&quot;</span><span class="content">somefile.zip</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">System</span>.out.println(<span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">Downloading %s</span><span class="delimiter">&quot;</span></span>, uri));
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="registering_a_build_service_and_connecting_it_to_a_task"><a class="anchor" href="#registering_a_build_service_and_connecting_it_to_a_task"></a><a class="link" href="#registering_a_build_service_and_connecting_it_to_a_task">Registering a build service and connecting it to a task</a></h4>
<div class="paragraph">
<p>To create a build service, you register the service instance using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/services/BuildServiceRegistry.html#registerIfAbsent-java.lang.String-java.lang.Class-org.gradle.api.Action-">BuildServiceRegistry.registerIfAbsent()</a> method.
Registering the service does not create the service instance.
This happens on demand when a task first uses the service.
The service instance will not be created if no task uses the service during a build.</p>
</div>
<div class="paragraph">
<p>Currently, build services are scoped to a build, rather than a project, and these services are available to be shared by the tasks of all projects.
You can access the registry of shared build services via <code>Project.getGradle().getSharedServices()</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example of a plugin that registers the previous service when the task property consuming the service is annotated with <code>@Internal</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">DownloadPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.Plugin</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.Project</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Provider</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">DownloadPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
        <span class="comment">// Register the service</span>
        <span class="predefined-type">Provider</span>&lt;WebServer&gt; serviceProvider = project.getGradle().getSharedServices().registerIfAbsent(<span class="string"><span class="delimiter">&quot;</span><span class="content">web</span><span class="delimiter">&quot;</span></span>, WebServer.class, spec -&gt; {
            <span class="comment">// Provide some parameters</span>
            spec.getParameters().getPort().set(<span class="integer">5005</span>);
        });

        project.getTasks().register(<span class="string"><span class="delimiter">&quot;</span><span class="content">download</span><span class="delimiter">&quot;</span></span>, Download.class, task -&gt; {
            <span class="comment">// Connect the service provider to the task</span>
            task.getServer().set(serviceProvider);
            <span class="comment">// Declare the association between the task and the service</span>
            task.usesService(serviceProvider);
            task.getOutputFile().set(project.getLayout().getBuildDirectory().file(<span class="string"><span class="delimiter">&quot;</span><span class="content">result.zip</span><span class="delimiter">&quot;</span></span>));
        });
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin registers the service and receives a <code>Provider&lt;WebService&gt;</code> back.
This provider can be connected to task properties to pass the service to the task.
Note that for a task property annotated with <code>@Internal</code>, the task property needs to (1) be explicitly assigned with the provider obtained during registation, and (2) you must tell Gradle the task uses the service via <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Task.html#usesService-org.gradle.api.provider.Provider-">Task.usesService</a>.</p>
</div>
<div class="paragraph">
<p>Compare that to when the task property consuming the service is annotated with <code>@ServiceReference</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">DownloadPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.Plugin</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.Project</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Provider</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">DownloadPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
        <span class="comment">// Register the service</span>
        project.getGradle().getSharedServices().registerIfAbsent(<span class="string"><span class="delimiter">&quot;</span><span class="content">web</span><span class="delimiter">&quot;</span></span>, WebServer.class, spec -&gt; {
            <span class="comment">// Provide some parameters</span>
            spec.getParameters().getPort().set(<span class="integer">5005</span>);
        });

        project.getTasks().register(<span class="string"><span class="delimiter">&quot;</span><span class="content">download</span><span class="delimiter">&quot;</span></span>, Download.class, task -&gt; {
            task.getOutputFile().set(project.getLayout().getBuildDirectory().file(<span class="string"><span class="delimiter">&quot;</span><span class="content">result.zip</span><span class="delimiter">&quot;</span></span>));
        });
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, there is no need to assign the build service provider to the task, nor to declare explicitly that the task uses the service.</p>
</div>
<div class="sect4">
<h5 id="using_shared_build_services_from_configuration_actions"><a class="anchor" href="#using_shared_build_services_from_configuration_actions"></a><a class="link" href="#using_shared_build_services_from_configuration_actions">Using shared build services from configuration actions</a></h5>
<div class="paragraph">
<p>Generally, build services are intended to be used by tasks, and as they usually represent some potentially expensive state to create, you should avoid using them at configuration time. However, sometimes, using the service at configuration time can make sense.
This is possible; call <code>get()</code> on the provider.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using_a_build_service_with_the_worker_api"><a class="anchor" href="#using_a_build_service_with_the_worker_api"></a><a class="link" href="#using_a_build_service_with_the_worker_api">Using a build service with the Worker API</a></h4>
<div class="paragraph">
<p>In addition to using a build service from a task, you can use a build service from a <a href="#converting_to_worker_api">Worker API action</a>, an <a href="#sec:implementing-artifact-transforms">artifact transform</a> or another build service.
To do this, pass the build service <code>Provider</code> as a parameter of the consuming action or service, in the same way you pass other parameters to the action or service.</p>
</div>
<div class="paragraph">
<p>For example, to pass a <code>MyServiceType</code> service to Worker API action, you might add a property of type <code>Property&lt;MyServiceType&gt;</code> to the action&#8217;s parameters object and then connect the <code>Provider&lt;MyServiceType&gt;</code> that you receive when registering the service to this property:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">Download.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Property</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.services.ServiceReference</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>;
<span class="keyword">import</span> <span class="include">org.gradle.workers.WorkAction</span>;
<span class="keyword">import</span> <span class="include">org.gradle.workers.WorkParameters</span>;
<span class="keyword">import</span> <span class="include">org.gradle.workers.WorkQueue</span>;
<span class="keyword">import</span> <span class="include">org.gradle.workers.WorkerExecutor</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.net.URI</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">Download</span> <span class="directive">extends</span> DefaultTask {

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">DownloadWorkAction</span> <span class="directive">implements</span> WorkAction&lt;DownloadWorkAction.Parameters&gt; {
        <span class="type">interface</span> <span class="class">Parameters</span> <span class="directive">extends</span> WorkParameters {
            <span class="comment">// This property provides access to the service instance from the work action</span>
            <span class="directive">abstract</span> Property&lt;WebServer&gt; getServer();
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> execute() {
            <span class="comment">// Use the server to download a file</span>
            WebServer server = getParameters().getServer().get();
            <span class="predefined-type">URI</span> uri = server.getUri().resolve(<span class="string"><span class="delimiter">&quot;</span><span class="content">somefile.zip</span><span class="delimiter">&quot;</span></span>);
            <span class="predefined-type">System</span>.out.println(<span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">Downloading %s</span><span class="delimiter">&quot;</span></span>, uri));
        }
    }

    <span class="annotation">@Inject</span>
    <span class="directive">abstract</span> <span class="directive">public</span> WorkerExecutor getWorkerExecutor();

    <span class="comment">// This property provides access to the service instance from the task</span>
    <span class="annotation">@ServiceReference</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">web</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">abstract</span> Property&lt;WebServer&gt; getServer();

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> download() {
        WorkQueue workQueue = getWorkerExecutor().noIsolation();
        workQueue.submit(DownloadWorkAction.class, parameter -&gt; {
            parameter.getServer().set(getServer());
        });
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Currently, it is impossible to use a build service with a worker API action that uses ClassLoader or process isolation modes.</p>
</div>
</div>
<div class="sect3">
<h4 id="accessing_the_build_service_concurrently"><a class="anchor" href="#accessing_the_build_service_concurrently"></a><a class="link" href="#accessing_the_build_service_concurrently">Accessing the build service concurrently</a></h4>
<div class="paragraph">
<p>You can constrain concurrent execution when you register the service, by using the <code>Property</code> object returned from <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/services/BuildServiceSpec.html#getMaxParallelUsages--">BuildServiceSpec.getMaxParallelUsages()</a>.
When this property has no value, which is the default, Gradle does not constrain access to the service.
When this property has a value &gt; 0, Gradle will allow no more than the specified number of tasks to use the service concurrently.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When the consuming task property is annotated with <code>@Internal</code>, for the constraint to take effect, the build service <strong>must</strong> be registered with the consuming task via
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Task.html#org.gradle.api.Task:usesService(org.gradle.api.provider.Provider)">Task.usesService(Provider&lt;? extends BuildService&lt;?&gt;&gt;)</a>.
This is not necessary if, instead, the consuming property is annotated with <code>@ServiceReference</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="operation_listener"><a class="anchor" href="#operation_listener"></a><a class="link" href="#operation_listener">Receiving information about task execution</a></h4>
<div class="paragraph">
<p>A build service can be used to receive events as tasks are executed.
To do this, create and register a build service that implements <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/tooling/events/OperationCompletionListener.html">OperationCompletionListener</a>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">TaskEventsService.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.services.BuildService</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.services.BuildServiceParameters</span>;
<span class="keyword">import</span> <span class="include">org.gradle.tooling.events.FinishEvent</span>;
<span class="keyword">import</span> <span class="include">org.gradle.tooling.events.OperationCompletionListener</span>;
<span class="keyword">import</span> <span class="include">org.gradle.tooling.events.task.TaskFinishEvent</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">TaskEventsService</span> <span class="directive">implements</span> BuildService&lt;BuildServiceParameters.None&gt;,
    OperationCompletionListener { // <b class="conum">(1)</b>

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onFinish(FinishEvent finishEvent) {
        <span class="keyword">if</span> (finishEvent <span class="keyword">instanceof</span> TaskFinishEvent) { // <b class="conum">(2)</b>
            <span class="comment">// Handle task finish event...</span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Implement the <code>OperationCompletionListener</code> interface and the <code>BuildService</code> interface.</p>
</li>
<li>
<p>Check if the finish event is a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/tooling/events/task/TaskFinishEvent.html">TaskFinishEvent</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Then, in the plugin, you can use the methods on the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/build/event/BuildEventsListenerRegistry.html">BuildEventsListenerRegistry</a> service to start receiving events:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">TaskEventsPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.Plugin</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.Project</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Provider</span>;
<span class="keyword">import</span> <span class="include">org.gradle.build.event.BuildEventsListenerRegistry</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">TaskEventsPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="annotation">@Inject</span>
    <span class="directive">public</span> <span class="directive">abstract</span> BuildEventsListenerRegistry getEventsListenerRegistry(); // <b class="conum">(1)</b>

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
        <span class="predefined-type">Provider</span>&lt;TaskEventsService&gt; serviceProvider =
            project.getGradle().getSharedServices().registerIfAbsent(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">taskEvents</span><span class="delimiter">&quot;</span></span>, TaskEventsService.class, spec -&gt; {}); // <b class="conum">(2)</b>

        getEventsListenerRegistry().onTaskCompletion(serviceProvider); // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Use <a href="service_injection.html#service_injection">service injection</a> to obtain an instance of the <code>BuildEventsListenerRegistry</code>.</p>
</li>
<li>
<p>Register the build service as usual.</p>
</li>
<li>
<p>Use the service <code>Provider</code> to subscribe to the build service to build events.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dataflow_action"><a class="anchor" href="#dataflow_action"></a><a class="link" href="#dataflow_action">Dataflow Actions</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The dataflow actions support is an <a href="#feature_lifecycle">incubating</a> feature and is subject to change.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A preferred way of executing work in a Gradle build is using a task.
However, some kinds of work do not fit tasks well, such as custom handling of the build failure.</p>
</div>
<div class="paragraph">
<p>What if you want to play a cheerful sound when the build succeeds and a sad one when it fails?
This work piece has to process the task execution result, so it cannot be a task itself.</p>
</div>
<div class="paragraph">
<p>The Dataflow Actions API provides a way to schedule this type of work.
A dataflow action is a parameterized isolated piece of work that becomes eligible for execution as soon as all input parameters become available.</p>
</div>
<div class="sect3">
<h4 id="implementing_a_dataflow_action"><a class="anchor" href="#implementing_a_dataflow_action"></a><a class="link" href="#implementing_a_dataflow_action">Implementing a dataflow action</a></h4>
<div class="paragraph">
<p>The first step is to implement the action itself.
You must create a class implementing the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/flow/FlowAction.html">FlowAction</a> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.gradle.api.flow.FlowAction
import org.gradle.api.flow.FlowParameters

abstract class ReportConsumption : FlowAction&lt;ReportConsumption.Params&gt; {

    interface Params : FlowParameters {

    }

    override fun execute(parameters: Params) {

    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>execute</code> method must be implemented because this is where the work happens.
An action implementation is treated as a <a href="properties_providers.html#properties_and_providers">custom Gradle type</a> and can use any of the features available to custom Gradle types.
In particular, some Gradle services can be injected into the implementation.</p>
</div>
<div class="paragraph">
<p>A dataflow action may accept parameters.
To provide parameters, you define an abstract class (or interface) to hold the parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The parameters type must implement (or extend) <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/flow/FlowParameters.html">FlowParameters</a>.</p>
</li>
<li>
<p>The parameters type is also a <a href="properties_providers.html#properties_and_providers">custom Gradle type</a>.</p>
</li>
<li>
<p>The action implementation gets the parameters as an argument of the <code>execute</code> method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the action requires no parameters, you can use <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/flow/FlowParameters.None.html">FlowParameters.None</a> as the type of parameter.</p>
</div>
<div class="paragraph">
<p>Here is an example of a dataflow action that takes a shared build service and a file path as parameters:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">SoundPlay.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.gradle.sample.sound</span>;

<span class="keyword">import</span> <span class="include">org.gradle.api.flow.FlowAction</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.flow.FlowParameters</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Property</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.services.ServiceReference</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.Input</span>;

<span class="keyword">import</span> <span class="include">java.io.File</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">SoundPlay</span> <span class="directive">implements</span> FlowAction&lt;SoundPlay.Parameters&gt; {
    <span class="type">interface</span> <span class="class">Parameters</span> <span class="directive">extends</span> FlowParameters {
        <span class="annotation">@ServiceReference</span> // <b class="conum">(1)</b>
        Property&lt;SoundService&gt; getSoundService();

        <span class="annotation">@Input</span> // <b class="conum">(2)</b>
        Property&lt;<span class="predefined-type">File</span>&gt; getMediaFile();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> execute(Parameters parameters) {
        parameters.getSoundService().get().playSoundFile(parameters.getMediaFile().get());
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Parameters in the parameter type must be annotated. If a parameter is annotated with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/services/ServiceReference.html"><code>@ServiceReference</code></a>, then a suitable shared build service implementation is automatically assigned to the parameter when the action is created, according to the <a href="#sec:service_references">usual rules</a>.</p>
</li>
<li>
<p>All other parameters must be annotated with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Input.html"><code>@Input</code></a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="using_lifecycle_event_providers"><a class="anchor" href="#using_lifecycle_event_providers"></a><a class="link" href="#using_lifecycle_event_providers">Using lifecycle event providers</a></h4>
<div class="paragraph">
<p>Besides the usual value providers, Gradle provides dedicated providers for build lifecycle events, like build completion.
These providers are intended for dataflow actions and provide additional ordering guarantees when used as inputs.
The ordering also applies if you derive a provider from the event provider by, for example, calling <code>map</code> or <code>flatMap</code>.
You can obtain these providers from the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/flow/FlowProviders.html">FlowProviders</a> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">flowProviders.buildWorkResult.map {
    [
        <span class="key">buildInvocationId</span>: scopeIdsService.buildInvocationId,
        <span class="key">workspaceId</span>: scopeIdsService.workspaceId,
        <span class="key">userId</span>: scopeIdsService.userId
    ]
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If you&#8217;re not using a lifecycle event provider as an input to the dataflow action, then the exact timing when the action is executed is not defined and may change in the next version of Gradle.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="supplying_the_action_for_execution"><a class="anchor" href="#supplying_the_action_for_execution"></a><a class="link" href="#supplying_the_action_for_execution">Supplying the action for execution</a></h4>
<div class="paragraph">
<p>You should not create <code>FlowAction</code> objects manually.
Instead, you request to execute them in the appropriate scope of <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/flow/FlowScope.html"><code>FlowScope</code></a>.
In doing so, you can configure the parameters for the task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">SoundFeedbackPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.gradle.sample.sound</span>;

<span class="keyword">import</span> <span class="include">org.gradle.api.Plugin</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.flow.FlowProviders</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.flow.FlowScope</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.initialization.Settings</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.io.File</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">SoundFeedbackPlugin</span> <span class="directive">implements</span> Plugin&lt;Settings&gt; {
    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> <span class="directive">abstract</span> FlowScope getFlowScope(); // <b class="conum">(1)</b>

    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> <span class="directive">abstract</span> FlowProviders getFlowProviders(); // <b class="conum">(1)</b>

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> apply(Settings settings) {
        <span class="directive">final</span> <span class="predefined-type">File</span> soundsDir = <span class="keyword">new</span> <span class="predefined-type">File</span>(settings.getSettingsDir(), <span class="string"><span class="delimiter">&quot;</span><span class="content">sounds</span><span class="delimiter">&quot;</span></span>);
        getFlowScope().always( // <b class="conum">(2)</b>
            SoundPlay.class,  // <b class="conum">(3)</b>
            spec -&gt;  // <b class="conum">(4)</b>
                spec.getParameters().getMediaFile().set(
                    getFlowProviders().getBuildWorkResult().map(result -&gt; // <b class="conum">(5)</b>
                        <span class="keyword">new</span> <span class="predefined-type">File</span>(
                            soundsDir,
                            result.getFailure().isPresent() ? <span class="string"><span class="delimiter">&quot;</span><span class="content">sad-trombone.mp3</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">tada.mp3</span><span class="delimiter">&quot;</span></span>
                        )
                    )
                )
        );
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Use service injection to obtain <code>FlowScope</code> and <code>FlowProviders</code> instances. They are available for project and settings plugins.</p>
</li>
<li>
<p>Use an appropriate scope to run your actions. As the name suggests, actions in the <code>always</code> scope are executed every time the build runs.</p>
</li>
<li>
<p>Specify the class that implements the action.</p>
</li>
<li>
<p>Use the spec argument to configure the action parameters.</p>
</li>
<li>
<p>A lifecycle event provider can be mapped into something else while preserving the action order.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As a result, when you run the build, and it completes successfully, the action will play the "tada" sound.
If the build fails at configuration or execution time, you&#8217;ll hear "sad-trombone" sound&#8201;&#8212;&#8201;assuming that build configuration proceeds far enough for the action to be registered.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="test_kit"><a class="anchor" href="#test_kit"></a><a class="link" href="#test_kit">Testing Build Logic with TestKit</a></h3>
<div class="paragraph">
<p>The Gradle TestKit (a.k.a. just TestKit) is a library that aids in testing Gradle plugins and build logic generally. At this time, it is focused on <em>functional</em> testing. That is, testing build logic by exercising it as part of a programmatically executed build. Over time, the TestKit will likely expand to facilitate other kinds of tests.</p>
</div>
<div class="sect3">
<h4 id="sec:testkit_usage"><a class="anchor" href="#sec:testkit_usage"></a><a class="link" href="#sec:testkit_usage">Using TestKit</a></h4>
<div class="paragraph">
<p>To use the TestKit, include the following in your plugin&#8217;s build:</p>
</div>
<div id="ex-declaring-the-testkit-dependency" class="exampleblock">
<div class="title">Example 1. <a href="#ex-declaring-the-testkit-dependency">Declaring the TestKit dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(gradleTestKit())
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation gradleTestKit()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>gradleTestKit()</code> encompasses the classes of the TestKit, as well as the <a href="#embedding">Gradle Tooling API client</a>. It does not include a version of <a href="https://junit.org">JUnit</a>, <a href="https://testng.org">TestNG</a>, or any other test execution framework. Such a dependency must be explicitly declared.</p>
</div>
<div id="ex-declaring-the-junit-dependency" class="exampleblock">
<div class="title">Example 2. <a href="#ex-declaring-the-junit-dependency">Declaring the JUnit dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;org.junit.jupiter:junit-jupiter:5.7.1&quot;)
    testRuntimeOnly(&quot;org.junit.platform:junit-platform-launcher&quot;)
}

tasks.named&lt;Test&gt;(&quot;test&quot;) {
    useJUnitPlatform()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.junit.jupiter:junit-jupiter:5.7.1</span><span class="delimiter">&quot;</span></span>)
    testRuntimeOnly(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.junit.platform:junit-platform-launcher</span><span class="delimiter">&quot;</span></span>)
}

tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>, Test) {
    useJUnitPlatform()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:functional_testing_with_the_gradle_runner"><a class="anchor" href="#sec:functional_testing_with_the_gradle_runner"></a><a class="link" href="#sec:functional_testing_with_the_gradle_runner">Functional testing with the Gradle runner</a></h4>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html">GradleRunner</a> facilitates programmatically executing Gradle builds, and inspecting the result.</p>
</div>
<div class="paragraph">
<p>A contrived build can be created (e.g. programmatically, or from a template) that exercises the “logic under test”. The build can then be executed, potentially in a variety of ways (e.g. different combinations of tasks and arguments). The correctness of the logic can then be verified by asserting the following, potentially in combination:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The build&#8217;s output;</p>
</li>
<li>
<p>The build&#8217;s logging (i.e. console output);</p>
</li>
<li>
<p>The set of tasks executed by the build and their results (e.g. FAILED, UP-TO-DATE etc.).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After creating and configuring a runner instance, the build can be executed via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html#build--">GradleRunner.build()</a> or <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html#buildAndFail--">GradleRunner.buildAndFail()</a> methods depending on the anticipated outcome.</p>
</div>
<div class="paragraph">
<p>The following demonstrates the usage of the Gradle runner in a Java JUnit test:</p>
</div>
<div class="sect4">
<h5 id="example_using_gradlerunner_with_java_and_junit"><a class="anchor" href="#example_using_gradlerunner_with_java_and_junit"></a><a class="link" href="#example_using_gradlerunner_with_java_and_junit">Example: Using GradleRunner with Java and JUnit</a></h5>
<div class="listingblock">
<div class="title">BuildLogicFunctionalTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.testkit.runner.BuildResult</span>;
<span class="keyword">import</span> <span class="include">org.gradle.testkit.runner.GradleRunner</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.BeforeEach</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.io.TempDir</span>;

<span class="keyword">import</span> <span class="include">java.io.BufferedWriter</span>;
<span class="keyword">import</span> <span class="include">java.io.File</span>;
<span class="keyword">import</span> <span class="include">java.io.FileWriter</span>;
<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.gradle.testkit.runner.TaskOutcome.SUCCESS</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertEquals</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertTrue</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">BuildLogicFunctionalTest</span> {

    <span class="annotation">@TempDir</span> <span class="predefined-type">File</span> testProjectDir;
    <span class="directive">private</span> <span class="predefined-type">File</span> settingsFile;
    <span class="directive">private</span> <span class="predefined-type">File</span> buildFile;

    <span class="annotation">@BeforeEach</span>
    <span class="directive">public</span> <span class="type">void</span> setup() {
        settingsFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(testProjectDir, <span class="string"><span class="delimiter">&quot;</span><span class="content">settings.gradle</span><span class="delimiter">&quot;</span></span>);
        buildFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(testProjectDir, <span class="string"><span class="delimiter">&quot;</span><span class="content">build.gradle</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testHelloWorldTask() <span class="directive">throws</span> <span class="exception">IOException</span> {
        writeFile(settingsFile, <span class="string"><span class="delimiter">&quot;</span><span class="content">rootProject.name = 'hello-world'</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">String</span> buildFileContent = <span class="string"><span class="delimiter">&quot;</span><span class="content">task helloWorld {</span><span class="delimiter">&quot;</span></span> +
                                  <span class="string"><span class="delimiter">&quot;</span><span class="content">    doLast {</span><span class="delimiter">&quot;</span></span> +
                                  <span class="string"><span class="delimiter">&quot;</span><span class="content">        println 'Hello world!'</span><span class="delimiter">&quot;</span></span> +
                                  <span class="string"><span class="delimiter">&quot;</span><span class="content">    }</span><span class="delimiter">&quot;</span></span> +
                                  <span class="string"><span class="delimiter">&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>;
        writeFile(buildFile, buildFileContent);

        BuildResult result = GradleRunner.create()
            .withProjectDir(testProjectDir)
            .withArguments(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloWorld</span><span class="delimiter">&quot;</span></span>)
            .build();

        assertTrue(result.getOutput().contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world!</span><span class="delimiter">&quot;</span></span>));
        assertEquals(SUCCESS, result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:helloWorld</span><span class="delimiter">&quot;</span></span>).getOutcome());
    }

    <span class="directive">private</span> <span class="type">void</span> writeFile(<span class="predefined-type">File</span> destination, <span class="predefined-type">String</span> content) <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="predefined-type">BufferedWriter</span> output = <span class="predefined-constant">null</span>;
        <span class="keyword">try</span> {
            output = <span class="keyword">new</span> <span class="predefined-type">BufferedWriter</span>(<span class="keyword">new</span> <span class="predefined-type">FileWriter</span>(destination));
            output.write(content);
        } <span class="keyword">finally</span> {
            <span class="keyword">if</span> (output != <span class="predefined-constant">null</span>) {
                output.close();
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any test execution framework can be used.</p>
</div>
<div class="paragraph">
<p>As Gradle build scripts can also be written in the Groovy programming language, it is often a productive choice to write Gradle functional tests in Groovy. Furthermore, it is recommended to use the (Groovy based) <a href="https://code.google.com/p/spock/">Spock test execution framework</a> as it offers many compelling features over the use of JUnit.</p>
</div>
<div class="paragraph">
<p>The following demonstrates the usage of the Gradle runner in a Groovy Spock test:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_using_gradlerunner_with_groovy_and_spock"><a class="anchor" href="#example_using_gradlerunner_with_groovy_and_spock"></a><a class="link" href="#example_using_gradlerunner_with_groovy_and_spock">Example: Using GradleRunner with Groovy and Spock</a></h5>
<div class="listingblock">
<div class="title">BuildLogicFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.testkit.runner.GradleRunner</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.gradle.testkit.runner.TaskOutcome.*</span>
<span class="keyword">import</span> <span class="include">spock.lang.TempDir</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span> <span class="class">BuildLogicFunctionalTest</span> <span class="directive">extends</span> Specification {
    <span class="annotation">@TempDir</span> <span class="predefined-type">File</span> testProjectDir
    <span class="predefined-type">File</span> settingsFile
    <span class="predefined-type">File</span> buildFile

    <span class="keyword">def</span> <span class="function">setup</span>() {
        settingsFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(testProjectDir, <span class="string"><span class="delimiter">'</span><span class="content">settings.gradle</span><span class="delimiter">'</span></span>)
        buildFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(testProjectDir, <span class="string"><span class="delimiter">'</span><span class="content">build.gradle</span><span class="delimiter">'</span></span>)
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world task prints hello world</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        settingsFile &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">rootProject.name = 'hello-world'</span><span class="delimiter">&quot;</span></span>
        buildFile &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
            task helloWorld {
                doLast {
                    println 'Hello world!'
                }
            }
        </span><span class="delimiter">&quot;&quot;&quot;</span></span>

        <span class="key">when</span>:
        <span class="keyword">def</span> result = GradleRunner.create()
            .withProjectDir(testProjectDir)
            .withArguments(<span class="string"><span class="delimiter">'</span><span class="content">helloWorld</span><span class="delimiter">'</span></span>)
            .build()

        <span class="key">then</span>:
        result.output.contains(<span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>)
        result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:helloWorld</span><span class="delimiter">&quot;</span></span>).outcome == SUCCESS
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is a common practice to implement any custom build logic (like plugins and task types) that is more complex in nature as external classes in a standalone project. The main driver behind this approach is bundle the compiled code into a JAR file, publish it to a binary repository and reuse it across various projects.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sub:test-kit-classpath-injection"><a class="anchor" href="#sub:test-kit-classpath-injection"></a><a class="link" href="#sub:test-kit-classpath-injection">Getting the plugin-under-test into the test build</a></h4>
<div class="paragraph">
<p>The GradleRunner uses the <a href="#embedding">Tooling API</a> to execute builds. An implication of this is that the builds are executed in a separate process (i.e. not the same process executing the tests). Therefore, the test build does not share the same classpath or classloaders as the test process and the code under test is not implicitly available to the test build.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>GradleRunner supports the same range of Gradle versions as the Tooling API.
The supported versions are defined in the <a href="#sec:embedding_compatibility">compatibility matrix</a>.</p>
</div>
<div class="paragraph">
<p>Builds with older Gradle versions <em>may</em> still work but there are no guarantees.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Starting with version 2.13, Gradle provides a conventional mechanism to inject the code under test into the test build.</p>
</div>
<div class="sect4">
<h5 id="sub:test-kit-automatic-classpath-injection"><a class="anchor" href="#sub:test-kit-automatic-classpath-injection"></a><a class="link" href="#sub:test-kit-automatic-classpath-injection">Automatic injection with the Java Gradle Plugin Development plugin</a></h5>
<div class="paragraph">
<p>The <a href="java_gradle_plugin.html#java_gradle_plugin">Java Gradle Plugin development plugin</a> can be used to assist in the development of Gradle plugins.
Starting with Gradle version 2.13, the plugin provides a direct integration with TestKit.
When applied to a project, the plugin automatically adds the <code>gradleTestKit()</code> dependency to the <code>testApi</code> configuration.
Furthermore, it automatically generates the classpath for the code under test and injects it via <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html#withPluginClasspath--">GradleRunner.withPluginClasspath()</a> for any <code>GradleRunner</code> instance created by the user.
It&#8217;s important to note that the mechanism currently <em>only</em> works if the plugin under test is applied using the <a href="#sec:plugins_block">plugins DSL</a>.
If the <a href="#sub:gradle-runner-gradle-version">target Gradle version</a> is prior to 2.8, automatic plugin classpath injection is not performed.</p>
</div>
<div class="paragraph">
<p>The plugin uses the following conventions for applying the TestKit dependency and injecting the classpath:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Source set containing code under test: <code>sourceSets.main</code></p>
</li>
<li>
<p>Source set used for injecting the plugin classpath: <code>sourceSets.test</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any of these conventions can be reconfigured with the help of the class <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/plugin/devel/GradlePluginDevelopmentExtension.html">GradlePluginDevelopmentExtension</a>.</p>
</div>
<div class="paragraph">
<p>The following Groovy-based sample demonstrates how to automatically inject the plugin classpath by using the standard conventions applied by the Java Gradle Plugin Development plugin.</p>
</div>
<div id="ex-using-the-java-gradle-development-plugin-for-generating-the-plugin-metadata" class="exampleblock">
<div class="title">Example 3. <a href="#ex-using-the-java-gradle-development-plugin-for-generating-the-plugin-metadata">Using the Java Gradle Development plugin for generating the plugin metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    groovy
    `java-gradle-plugin`
}

dependencies {
    testImplementation(&quot;org.spockframework:spock-core:2.2-groovy-3.0&quot;) {
        exclude(group = &quot;org.codehaus.groovy&quot;)
    }
    testRuntimeOnly(&quot;org.junit.platform:junit-platform-launcher&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">java-gradle-plugin</span><span class="delimiter">'</span></span>
}

dependencies {
    testImplementation(<span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core:2.2-groovy-3.0</span><span class="delimiter">'</span></span>) {
        exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy</span><span class="delimiter">'</span></span>
    }
    testRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.platform:junit-platform-launcher</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example_automatically_injecting_the_code_under_test_classes_into_test_builds"><a class="anchor" href="#example_automatically_injecting_the_code_under_test_classes_into_test_builds"></a><a class="link" href="#example_automatically_injecting_the_code_under_test_classes_into_test_builds">Example: Automatically injecting the code under test classes into test builds</a></h5>
<div class="listingblock">
<div class="title">src/test/groovy/org/gradle/sample/BuildLogicFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world task prints hello world</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>:
    settingsFile &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">rootProject.name = 'hello-world'</span><span class="delimiter">&quot;</span></span>
    buildFile &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
        plugins {
            id 'org.gradle.sample.helloworld'
        }
    </span><span class="delimiter">&quot;&quot;&quot;</span></span>

    <span class="key">when</span>:
    <span class="keyword">def</span> result = GradleRunner.create()
        .withProjectDir(testProjectDir)
        .withArguments(<span class="string"><span class="delimiter">'</span><span class="content">helloWorld</span><span class="delimiter">'</span></span>)
        .withPluginClasspath()
        .build()

    <span class="key">then</span>:
    result.output.contains(<span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>)
    result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:helloWorld</span><span class="delimiter">&quot;</span></span>).outcome == SUCCESS
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following build script demonstrates how to reconfigure the conventions provided by the Java Gradle Plugin Development plugin for a project that uses a custom <code>Test</code> source set.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A new configuration DSL for modeling the below <code>functionalTest</code> suite is available via the incubating <a href="jvm_test_suite_plugin.html#jvm_test_suite_plugin">JVM Test Suite</a> plugin.
</td>
</tr>
</table>
</div>
<div id="ex-reconfiguring-the-classpath-generation-conventions-of-the-java-gradle-development-plugin" class="exampleblock">
<div class="title">Example 4. <a href="#ex-reconfiguring-the-classpath-generation-conventions-of-the-java-gradle-development-plugin">Reconfiguring the classpath generation conventions of the Java Gradle Development plugin</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    groovy
    `java-gradle-plugin`
}

val functionalTest = sourceSets.create(&quot;functionalTest&quot;)
val functionalTestTask = tasks.register&lt;Test&gt;(&quot;functionalTest&quot;) {
    group = &quot;verification&quot;
    testClassesDirs = functionalTest.output.classesDirs
    classpath = functionalTest.runtimeClasspath
    useJUnitPlatform()
}

tasks.check {
    dependsOn(functionalTestTask)
}

gradlePlugin {
    testSourceSets(functionalTest)
}

dependencies {
    &quot;functionalTestImplementation&quot;(&quot;org.spockframework:spock-core:2.2-groovy-3.0&quot;) {
        exclude(group = &quot;org.codehaus.groovy&quot;)
    }
    &quot;functionalTestRuntimeOnly&quot;(&quot;org.junit.platform:junit-platform-launcher&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">java-gradle-plugin</span><span class="delimiter">'</span></span>
}

<span class="keyword">def</span> functionalTest = sourceSets.create(<span class="string"><span class="delimiter">'</span><span class="content">functionalTest</span><span class="delimiter">'</span></span>)
<span class="keyword">def</span> functionalTestTask = tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">functionalTest</span><span class="delimiter">'</span></span>, Test) {
    group = <span class="string"><span class="delimiter">'</span><span class="content">verification</span><span class="delimiter">'</span></span>
    testClassesDirs = sourceSets.functionalTest.output.classesDirs
    classpath = sourceSets.functionalTest.runtimeClasspath
    useJUnitPlatform()
}

tasks.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">check</span><span class="delimiter">&quot;</span></span>) {
    dependsOn functionalTestTask
}

gradlePlugin {
    testSourceSets sourceSets.functionalTest
}

dependencies {
    functionalTestImplementation(<span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core:2.2-groovy-3.0</span><span class="delimiter">'</span></span>) {
        exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy</span><span class="delimiter">'</span></span>
    }
    functionalTestRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.platform:junit-platform-launcher</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:controlling_the_build_environment"><a class="anchor" href="#sec:controlling_the_build_environment"></a><a class="link" href="#sec:controlling_the_build_environment">Controlling the build environment</a></h4>
<div class="paragraph">
<p>The runner executes the test builds in an isolated environment by specifying a dedicated "working directory" in a directory inside the JVM&#8217;s temp directory (i.e. the location specified by the <code>java.io.tmpdir</code> system property, typically <code>/tmp</code>). Any configuration in the default Gradle User Home (e.g. <code>~/.gradle/gradle.properties</code>) is not used for test execution. The TestKit does not expose a mechanism for fine grained control of all aspects of the environment (e.g., JDK). Future versions of the TestKit will provide improved configuration options.</p>
</div>
<div class="paragraph">
<p>The TestKit uses dedicated daemon processes that are automatically shut down after test execution.</p>
</div>
<div class="paragraph">
<p>The dedicated working directory is not deleted by the runner after the build.
The TestKit provides two ways to specify a location that is regularly cleaned, such as the project&#8217;s build folder:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>org.gradle.testkit.dir</code> system property;</p>
</li>
<li>
<p>The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html#withTestKitDir-java.io.File-">GradleRunner.withTestKitDir(file testKitDir)</a> method.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sub:gradle-runner-gradle-version"><a class="anchor" href="#sub:gradle-runner-gradle-version"></a><a class="link" href="#sub:gradle-runner-gradle-version">Setting the Gradle version used to test</a></h4>
<div class="paragraph">
<p>The Gradle runner requires a Gradle distribution in order to execute the build. The TestKit does not depend on all of Gradle&#8217;s implementation.</p>
</div>
<div class="paragraph">
<p>By default, the runner will attempt to find a Gradle distribution based on where the <code>GradleRunner</code> class was loaded from. That is, it is expected that the class was loaded from a Gradle distribution, as is the case when using the <code>gradleTestKit()</code> dependency declaration.</p>
</div>
<div class="paragraph">
<p>When using the runner as part of tests <em>being executed by Gradle</em> (e.g. executing the <code>test</code> task of a plugin project), the same distribution used to execute the tests will be used by the runner. When using the runner as part of tests <em>being executed by an IDE</em>, the same distribution of Gradle that was used when importing the project will be used. This means that the plugin will effectively be tested with the same version of Gradle that it is being built with.</p>
</div>
<div class="paragraph">
<p>Alternatively, a different and specific version of Gradle to use can be specified by the any of the following <code>GradleRunner</code> methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html#withGradleVersion-java.lang.String-">GradleRunner.withGradleVersion(java.lang.String)</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html#withGradleInstallation-java.io.File-">GradleRunner.withGradleInstallation(java.io.File)</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html#withGradleDistribution-java.net.URI-">GradleRunner.withGradleDistribution(java.net.URI)</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This can potentially be used to test build logic across Gradle versions. The following demonstrates a cross-version compatibility test written as Groovy Spock test:</p>
</div>
<div class="sect4">
<h5 id="example_specifying_a_gradle_version_for_test_execution"><a class="anchor" href="#example_specifying_a_gradle_version_for_test_execution"></a><a class="link" href="#example_specifying_a_gradle_version_for_test_execution">Example: Specifying a Gradle version for test execution</a></h5>
<div class="listingblock">
<div class="title">BuildLogicFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.testkit.runner.GradleRunner</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.gradle.testkit.runner.TaskOutcome.*</span>
<span class="keyword">import</span> <span class="include">spock.lang.TempDir</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span> <span class="class">BuildLogicFunctionalTest</span> <span class="directive">extends</span> Specification {
    <span class="annotation">@TempDir</span> <span class="predefined-type">File</span> testProjectDir
    <span class="predefined-type">File</span> settingsFile
    <span class="predefined-type">File</span> buildFile

    <span class="keyword">def</span> <span class="function">setup</span>() {
        settingsFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(testProjectDir, <span class="string"><span class="delimiter">'</span><span class="content">settings.gradle</span><span class="delimiter">'</span></span>)
        buildFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(testProjectDir, <span class="string"><span class="delimiter">'</span><span class="content">build.gradle</span><span class="delimiter">'</span></span>)
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">can execute hello world task with Gradle version #gradleVersion</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        buildFile &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
            task helloWorld {
                doLast {
                    logger.quiet 'Hello world!'
                }
            }
        </span><span class="delimiter">&quot;&quot;&quot;</span></span>
        settingsFile &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>

        <span class="key">when</span>:
        <span class="keyword">def</span> result = GradleRunner.create()
            .withGradleVersion(gradleVersion)
            .withProjectDir(testProjectDir)
            .withArguments(<span class="string"><span class="delimiter">'</span><span class="content">helloWorld</span><span class="delimiter">'</span></span>)
            .build()

        <span class="key">then</span>:
        result.output.contains(<span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>)
        result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:helloWorld</span><span class="delimiter">&quot;</span></span>).outcome == SUCCESS

        <span class="key">where</span>:
        gradleVersion &lt;&lt; [<span class="string"><span class="delimiter">'</span><span class="content">5.0</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">6.0.1</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:test-kit-compatibility"><a class="anchor" href="#sub:test-kit-compatibility"></a><a class="link" href="#sub:test-kit-compatibility">Feature support when testing with different Gradle versions</a></h5>
<div class="paragraph">
<p>It is possible to use the GradleRunner to execute builds with Gradle 1.0 and later. However, some runner features are not supported on earlier versions. In such cases, the runner will throw an exception when attempting to use the feature.</p>
</div>
<div class="paragraph">
<p>The following table lists the features that are sensitive to the Gradle version being used.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 3. Gradle version compatibility</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Minimum Version</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inspecting executed tasks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inspecting the executed tasks, using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/BuildResult.html#getTasks--">BuildResult.getTasks()</a> and similar methods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sub:test-kit-classpath-injection">Plugin classpath injection</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Injecting the code under test via<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html#withPluginClasspath-java.lang.Iterable-">GradleRunner.withPluginClasspath(java.lang.Iterable)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sub:test-kit-debug">Inspecting build output in debug mode</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inspecting the build&#8217;s text output when run in debug mode, using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/BuildResult.html#getOutput--">BuildResult.getOutput()</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sub:test-kit-automatic-classpath-injection">Automatic plugin classpath injection</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Injecting the code under test automatically via <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html#withPluginClasspath--">GradleRunner.withPluginClasspath()</a> by applying the Java Gradle Plugin Development plugin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setting environment variables to be used by the build.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Gradle Tooling API only supports setting environment variables in later versions.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sub:test-kit-debug"><a class="anchor" href="#sub:test-kit-debug"></a><a class="link" href="#sub:test-kit-debug">Debugging build logic</a></h4>
<div class="paragraph">
<p>The runner uses the <a href="#embedding">Tooling API</a> to execute builds. An implication of this is that the builds are executed in a separate process (i.e. not the same process executing the tests). Therefore, executing your <em>tests</em> in debug mode does not allow you to debug your build logic as you may expect. Any breakpoints set in your IDE will be not be tripped by the code being exercised by the test build.</p>
</div>
<div class="paragraph">
<p>The TestKit provides two different ways to enable the debug mode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting “<code>org.gradle.testkit.debug</code>” system property to <code>true</code> for the JVM <em>using</em> the <code>GradleRunner</code> (i.e. not the build being executed with the runner);</p>
</li>
<li>
<p>Calling the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html#withDebug-boolean-">GradleRunner.withDebug(boolean)</a> method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The system property approach can be used when it is desirable to enable debugging support without making an adhoc change to the runner configuration. Most IDEs offer the capability to set JVM system properties for test execution, and such a feature can be used to set this system property.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:test-kit-build-cache"><a class="anchor" href="#sub:test-kit-build-cache"></a><a class="link" href="#sub:test-kit-build-cache">Testing with the Build Cache</a></h4>
<div class="paragraph">
<p>To enable the <a href="#build_cache">Build Cache</a> in your tests, you can pass the <code>--build-cache</code> argument to <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html">GradleRunner</a> or use one of the other methods described in <a href="#sec:build_cache_enable">Enable the build cache</a>. You can then check for the task outcome <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/TaskOutcome.html#FROM_CACHE">TaskOutcome.FROM_CACHE</a> when your plugin&#8217;s custom task is cached. This outcome is only valid for Gradle 3.5 and newer.</p>
</div>
<div class="sect4">
<h5 id="example_testing_cacheable_tasks"><a class="anchor" href="#example_testing_cacheable_tasks"></a><a class="link" href="#example_testing_cacheable_tasks">Example: Testing cacheable tasks</a></h5>
<div class="listingblock">
<div class="title">BuildLogicFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">cacheableTask is loaded from cache</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>:
    buildFile &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
        plugins {
            id 'org.gradle.sample.helloworld'
        }
    </span><span class="delimiter">&quot;&quot;&quot;</span></span>

    <span class="key">when</span>:
    <span class="keyword">def</span> result = runner()
        .withArguments( <span class="string"><span class="delimiter">'</span><span class="content">--build-cache</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">cacheableTask</span><span class="delimiter">'</span></span>)
        .build()

    <span class="key">then</span>:
    result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:cacheableTask</span><span class="delimiter">&quot;</span></span>).outcome == SUCCESS

    <span class="key">when</span>:
    <span class="keyword">new</span> <span class="predefined-type">File</span>(testProjectDir, <span class="string"><span class="delimiter">'</span><span class="content">build</span><span class="delimiter">'</span></span>).deleteDir()
    result = runner()
        .withArguments( <span class="string"><span class="delimiter">'</span><span class="content">--build-cache</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">cacheableTask</span><span class="delimiter">'</span></span>)
        .build()

    <span class="key">then</span>:
    result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:cacheableTask</span><span class="delimiter">&quot;</span></span>).outcome == FROM_CACHE
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that TestKit re-uses a Gradle User Home between tests (see <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html#withTestKitDir-java.io.File-">GradleRunner.withTestKitDir(java.io.File)</a>) which contains the default location for the local build cache.
For testing with the build cache, the build cache directory should be cleaned between tests.
The easiest way to accomplish this is to configure the local build cache to use a temporary directory.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_clean_build_cache_between_tests"><a class="anchor" href="#example_clean_build_cache_between_tests"></a><a class="link" href="#example_clean_build_cache_between_tests">Example: Clean build cache between tests</a></h5>
<div class="listingblock">
<div class="title">BuildLogicFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@TempDir</span> <span class="predefined-type">File</span> testProjectDir
<span class="predefined-type">File</span> buildFile
<span class="predefined-type">File</span> localBuildCacheDirectory

<span class="keyword">def</span> <span class="function">setup</span>() {
    localBuildCacheDirectory = <span class="keyword">new</span> <span class="predefined-type">File</span>(testProjectDir, <span class="string"><span class="delimiter">'</span><span class="content">local-cache</span><span class="delimiter">'</span></span>)
    buildFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(testProjectDir,<span class="string"><span class="delimiter">'</span><span class="content">settings.gradle</span><span class="delimiter">'</span></span>) &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
        buildCache {
            local {
                directory '</span><span class="inline"><span class="inline-delimiter">${</span>localBuildCacheDirectory.toURI()<span class="inline-delimiter">}</span></span><span class="content">'
            }
        }
    </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    buildFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(testProjectDir,<span class="string"><span class="delimiter">'</span><span class="content">build.gradle</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ant"><a class="anchor" href="#ant"></a><a class="link" href="#ant">Using Ant from Gradle</a></h3>
<div class="paragraph">
<p>Gradle provides integration with Ant.</p>
</div>
<div class="paragraph">
<p>Gradle integrates with Ant, allowing you to use individual Ant tasks or entire Ant builds in your Gradle builds.
Using Ant tasks in a Gradle build script is often easier and more powerful than using Ant&#8217;s XML format.
Gradle can also be used as a powerful Ant task scripting tool.</p>
</div>
<div class="paragraph">
<p>Ant can be divided into two layers:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Layer 1: The Ant language</strong>. It provides the syntax for the <code>build.xml</code> file, the handling of the targets, special constructs like macrodefs, and more. In other words, this layer includes everything except the Ant tasks and types. Gradle understands this language and lets you import your Ant <code>build.xml</code> directly into a Gradle project. You can then use the targets of your Ant build as if they were Gradle tasks.</p>
</li>
<li>
<p><strong>Layer 2: The Ant tasks and types</strong>, like <code>javac</code>, <code>copy</code> or <code>jar</code>. For this layer, Gradle provides integration using Groovy and the <code>AntBuilder</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Since build scripts are Kotlin or Groovy scripts, you can execute an Ant build as an external process.
Your build script may contain statements like: <code>"ant clean compile".execute()</code>.<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup></p>
</div>
<div class="paragraph">
<p>Gradle&#8217;s Ant integration allows you to migrate your build from Ant to Gradle smoothly:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Begin by importing your existing Ant build.</p>
</li>
<li>
<p>Then, transition your dependency declarations from the Ant script to your build file.</p>
</li>
<li>
<p>Finally, move your tasks to your build file or replace them with Gradle&#8217;s plugins.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This migration process can be performed incrementally, and you can maintain a functional Gradle build throughout the transition.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Ant integration is not fully compatible with the <a href="#config_cache">configuration cache</a>.
Using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Task.html#getAnt--">Task.ant</a> to run Ant task in the task action may work, but importing the Ant build is not supported.
</td>
</tr>
</table>
</div>
<div id="sec:ant_api" class="paragraph">
<p>The Ant integration is provided by the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/AntBuilder.html">AntBuilder API</a>.</p>
</div>
<div class="sect3">
<h4 id="sec:using_ant_tasks"><a class="anchor" href="#sec:using_ant_tasks"></a><a class="link" href="#sec:using_ant_tasks">Using Ant tasks and types</a></h4>
<div class="paragraph">
<p>Gradle provides a property called <code>ant</code> in your build script.
This is a reference to an <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/AntBuilder.html">AntBuilder</a> instance.</p>
</div>
<div class="paragraph">
<p><code>AntBuilder</code> is used to access Ant tasks, types, and properties from your build script.</p>
</div>
<div class="paragraph">
<p>You execute an Ant task by calling a method on the <code>AntBuilder</code> instance.
You use the task name as the method name:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.mkdir(<span class="key">dir</span>: <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>STAGE</span><span class="delimiter">&quot;</span></span>)
ant.copy(<span class="key">todir</span>: <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>STAGE</span><span class="content">/bin</span><span class="delimiter">&quot;</span></span>) {
    ant.fileset(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">bin</span><span class="delimiter">'</span></span>, <span class="key">includes</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">**</span><span class="delimiter">&quot;</span></span>)
}
ant.gzip(<span class="key">destfile</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">build/file-</span><span class="inline"><span class="inline-delimiter">${</span>VERSION<span class="inline-delimiter">}</span></span><span class="content">.tar.gz</span><span class="delimiter">&quot;</span></span>, <span class="key">src</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">build/file-</span><span class="inline"><span class="inline-delimiter">${</span>VERSION<span class="inline-delimiter">}</span></span><span class="content">.tar</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, you execute the Ant <code>echo</code> task using the <code>ant.echo()</code> method.</p>
</div>
<div class="paragraph">
<p>The attributes of the Ant task are passed as Map parameters to the method.
Below is an example of the <code>echo</code> task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    doLast {
        val greeting = &quot;hello from Ant&quot;
        ant.withGroovyBuilder {
            &quot;echo&quot;(&quot;message&quot; to greeting)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
    doLast {
        <span class="predefined-type">String</span> greeting = <span class="string"><span class="delimiter">'</span><span class="content">hello from Ant</span><span class="delimiter">'</span></span>
        ant.echo(<span class="key">message</span>: greeting)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle hello

&gt; Task :hello
[ant:echo] hello from Ant

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can mix Groovy/Kotlin code and the Ant task markup. This can be extremely powerful.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You pass nested text to an Ant task as a parameter of the task method call.
In this example, we pass the message for the <code>echo</code> task as nested text:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    doLast {
        ant.withGroovyBuilder {
            &quot;echo&quot;(&quot;message&quot; to &quot;hello from Ant&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
    doLast {
        ant.echo(<span class="string"><span class="delimiter">'</span><span class="content">hello from Ant</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle hello

&gt; Task :hello
[ant:echo] hello from Ant

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>You pass nested elements to an Ant task inside a closure.
Nested elements are defined in the same way as tasks by calling a method with the same name as the element we want to define:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;zip&quot;) {
    doLast {
        ant.withGroovyBuilder {
            &quot;zip&quot;(&quot;destfile&quot; to &quot;archive.zip&quot;) {
                &quot;fileset&quot;(&quot;dir&quot; to &quot;src&quot;) {
                    &quot;include&quot;(&quot;name&quot; to &quot;**.xml&quot;)
                    &quot;exclude&quot;(&quot;name&quot; to &quot;**.java&quot;)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">zip</span><span class="delimiter">'</span></span>) {
    doLast {
        ant.zip(<span class="key">destfile</span>: <span class="string"><span class="delimiter">'</span><span class="content">archive.zip</span><span class="delimiter">'</span></span>) {
            fileset(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>) {
                include(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">**.xml</span><span class="delimiter">'</span></span>)
                exclude(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">**.java</span><span class="delimiter">'</span></span>)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can access Ant types the same way you access tasks, using the name of the type as the method name.
The method call returns the Ant data type, which you can use directly in your build script.
In the following example, we create an Ant <code>path</code> object, then iterate over the contents of it:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.apache.tools.ant.types.Path

tasks.register(&quot;list&quot;) {
    doLast {
        val path = ant.withGroovyBuilder {
            &quot;path&quot; {
                &quot;fileset&quot;(&quot;dir&quot; to &quot;libs&quot;, &quot;includes&quot; to &quot;*.jar&quot;)
            }
        } as Path
        path.list().forEach {
            println(it)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">list</span><span class="delimiter">'</span></span>) {
    doLast {
        <span class="keyword">def</span> path = ant.path {
            fileset(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>, <span class="key">includes</span>: <span class="string"><span class="delimiter">'</span><span class="content">*.jar</span><span class="delimiter">'</span></span>)
        }
        path.list().each {
            println <span class="local-variable">it</span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:using_custom_ant_tasks"><a class="anchor" href="#sec:using_custom_ant_tasks"></a><a class="link" href="#sec:using_custom_ant_tasks">Using custom Ant tasks</a></h5>
<div class="paragraph">
<p>To make custom tasks available in your build, use the <code>taskdef</code> (usually easier) or <code>typedef</code> Ant task, just as you would in a <code>build.xml</code> file.
You can then refer to the custom Ant task as you would a built-in Ant task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;check&quot;) {
    val checkstyleConfig = file(&quot;checkstyle.xml&quot;)
    doLast {
        ant.withGroovyBuilder {
            &quot;taskdef&quot;(&quot;resource&quot; to &quot;com/puppycrawl/tools/checkstyle/ant/checkstyle-ant-task.properties&quot;) {
                &quot;classpath&quot; {
                    &quot;fileset&quot;(&quot;dir&quot; to &quot;libs&quot;, &quot;includes&quot; to &quot;*.jar&quot;)
                }
            }
            &quot;checkstyle&quot;(&quot;config&quot; to checkstyleConfig) {
                &quot;fileset&quot;(&quot;dir&quot; to &quot;src&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">check</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> checkstyleConfig = file(<span class="string"><span class="delimiter">'</span><span class="content">checkstyle.xml</span><span class="delimiter">'</span></span>)
    doLast {
        ant.taskdef(<span class="key">resource</span>: <span class="string"><span class="delimiter">'</span><span class="content">com/puppycrawl/tools/checkstyle/ant/checkstyle-ant-task.properties</span><span class="delimiter">'</span></span>) {
            classpath {
                fileset(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>, <span class="key">includes</span>: <span class="string"><span class="delimiter">'</span><span class="content">*.jar</span><span class="delimiter">'</span></span>)
            }
        }
        ant.checkstyle(<span class="key">config</span>: checkstyleConfig) {
            fileset(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use Gradle&#8217;s dependency management to assemble the classpath for the custom tasks.
To do this, you need to define a custom configuration for the classpath and add some dependencies to it.
This is described in more detail in <a href="declaring_dependencies.html">Declaring Dependencies</a>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val pmd = configurations.create(&quot;pmd&quot;)

dependencies {
    pmd(group = &quot;pmd&quot;, name = &quot;pmd&quot;, version = &quot;4.2.5&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    pmd
}

dependencies {
    pmd <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">pmd</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">pmd</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">4.2.5</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To use the classpath configuration, use the <code>asPath</code> property of the custom configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;check&quot;) {
    doLast {
        ant.withGroovyBuilder {
            &quot;taskdef&quot;(&quot;name&quot; to &quot;pmd&quot;,
                      &quot;classname&quot; to &quot;net.sourceforge.pmd.ant.PMDTask&quot;,
                      &quot;classpath&quot; to pmd.asPath)
            &quot;pmd&quot;(&quot;shortFilenames&quot; to true,
                  &quot;failonruleviolation&quot; to true,
                  &quot;rulesetfiles&quot; to file(&quot;pmd-rules.xml&quot;).toURI().toString()) {
                &quot;formatter&quot;(&quot;type&quot; to &quot;text&quot;, &quot;toConsole&quot; to &quot;true&quot;)
                &quot;fileset&quot;(&quot;dir&quot; to &quot;src&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">check</span><span class="delimiter">'</span></span>) {
    doLast {
        ant.taskdef(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">pmd</span><span class="delimiter">'</span></span>,
                    <span class="key">classname</span>: <span class="string"><span class="delimiter">'</span><span class="content">net.sourceforge.pmd.ant.PMDTask</span><span class="delimiter">'</span></span>,
                    <span class="key">classpath</span>: configurations.pmd.asPath)
        ant.pmd(<span class="key">shortFilenames</span>: <span class="string"><span class="delimiter">'</span><span class="content">true</span><span class="delimiter">'</span></span>,
                <span class="key">failonruleviolation</span>: <span class="string"><span class="delimiter">'</span><span class="content">true</span><span class="delimiter">'</span></span>,
                <span class="key">rulesetfiles</span>: file(<span class="string"><span class="delimiter">'</span><span class="content">pmd-rules.xml</span><span class="delimiter">'</span></span>).toURI().toString()) {
            formatter(<span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>, <span class="key">toConsole</span>: <span class="string"><span class="delimiter">'</span><span class="content">true</span><span class="delimiter">'</span></span>)
            fileset(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:import_ant_build"><a class="anchor" href="#sec:import_ant_build"></a><a class="link" href="#sec:import_ant_build">Importing an Ant build</a></h4>
<div class="paragraph">
<p>You can use the <code>ant.importBuild()</code> method to import an Ant build into your Gradle project.</p>
</div>
<div class="paragraph">
<p>When you import an Ant build, each Ant target is treated as a Gradle task.
This means you can manipulate and execute the Ant targets in the same way as Gradle tasks:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.importBuild(&quot;build.xml&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.importBuild <span class="string"><span class="delimiter">'</span><span class="content">build.xml</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project&gt;</span>
    <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;echo&gt;</span>Hello, from Ant<span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle hello

&gt; Task :hello
[ant:echo] Hello, from Ant

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>You can add a task that depends on an Ant target:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.importBuild(&quot;build.xml&quot;)

tasks.register(&quot;intro&quot;) {
    dependsOn(&quot;hello&quot;)
    doLast {
        println(&quot;Hello, from Gradle&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.importBuild <span class="string"><span class="delimiter">'</span><span class="content">build.xml</span><span class="delimiter">'</span></span>

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">intro</span><span class="delimiter">'</span></span>) {
    dependsOn(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>)
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello, from Gradle</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle intro

&gt; Task :hello
[ant:echo] Hello, from Ant

&gt; Task :intro
Hello, from Gradle

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Or, you can add behavior to an Ant target:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.importBuild(&quot;build.xml&quot;)

tasks.named(&quot;hello&quot;) {
    doLast {
        println(&quot;Hello, from Gradle&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.importBuild <span class="string"><span class="delimiter">'</span><span class="content">build.xml</span><span class="delimiter">'</span></span>

hello {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello, from Gradle</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle hello

&gt; Task :hello
[ant:echo] Hello, from Ant
Hello, from Gradle

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible for an Ant target to depend on a Gradle task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.importBuild(&quot;build.xml&quot;)

tasks.register(&quot;intro&quot;) {
    doLast {
        println(&quot;Hello, from Gradle&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.importBuild <span class="string"><span class="delimiter">'</span><span class="content">build.xml</span><span class="delimiter">'</span></span>

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">intro</span><span class="delimiter">'</span></span>) {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello, from Gradle</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project&gt;</span>
    <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">depends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">intro</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;echo&gt;</span>Hello, from Ant<span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle hello

&gt; Task :intro
Hello, from Gradle

&gt; Task :hello
[ant:echo] Hello, from Ant

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes, it may be necessary to “rename” the task generated for an Ant target to avoid a naming collision with existing Gradle tasks.
To do this, use the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/AntBuilder.html#importBuild-java.lang.Object-org.gradle.api.Transformer-">AntBuilder.importBuild(java.lang.Object, org.gradle.api.Transformer)</a> method:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.importBuild(&quot;build.xml&quot;) { antTargetName -&gt;
    &quot;a-&quot; + antTargetName
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.importBuild(<span class="string"><span class="delimiter">'</span><span class="content">build.xml</span><span class="delimiter">'</span></span>) { antTargetName -&gt;
    <span class="string"><span class="delimiter">'</span><span class="content">a-</span><span class="delimiter">'</span></span> + antTargetName
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project&gt;</span>
    <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;echo&gt;</span>Hello, from Ant<span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle a-hello

&gt; Task :a-hello
[ant:echo] Hello, from Ant

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
While the second argument to this method should be a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Transformer.html">Transformer</a>, when programming in Groovy you can use a closure instead of an anonymous inner class (or similar) due to <a href="http://mrhaki.blogspot.ie/2013/11/groovy-goodness-implicit-closure.html">Groovy&#8217;s support for automatically coercing closures to single-abstract-method types</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:ant_properties"><a class="anchor" href="#sec:ant_properties"></a><a class="link" href="#sec:ant_properties">Using Ant properties and references</a></h4>
<div class="paragraph">
<p>There are several ways to set an Ant property so that the property can be used by Ant tasks.</p>
</div>
<div class="paragraph">
<p>You can set the property directly on the <code>AntBuilder</code> instance.
The Ant properties are also available as a Map, which you can change.</p>
</div>
<div class="paragraph">
<p>You can also use the Ant <code>property</code> task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.setProperty(&quot;buildDir&quot;, buildDir)
ant.properties.set(&quot;buildDir&quot;, buildDir)
ant.properties[&quot;buildDir&quot;] = buildDir
ant.withGroovyBuilder {
    &quot;property&quot;(&quot;name&quot; to &quot;buildDir&quot;, &quot;location&quot; to &quot;buildDir&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.buildDir = buildDir
ant.properties.buildDir = buildDir
ant.properties[<span class="string"><span class="delimiter">'</span><span class="content">buildDir</span><span class="delimiter">'</span></span>] = buildDir
ant.property(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">buildDir</span><span class="delimiter">'</span></span>, <span class="key">location</span>: buildDir)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Many Ant tasks set properties when they execute.
There are several ways to get the value of these properties.
You can get the property directly from the <code>AntBuilder</code> instance.
The Ant properties are also available as a Map:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">antProp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a property defined in an Ant build</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">println(ant.getProperty(&quot;antProp&quot;))
println(ant.properties.get(&quot;antProp&quot;))
println(ant.properties[&quot;antProp&quot;])</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println ant.antProp
println ant.properties.antProp
println ant.properties[<span class="string"><span class="delimiter">'</span><span class="content">antProp</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are several ways to set an Ant reference:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.withGroovyBuilder { &quot;path&quot;(&quot;id&quot; to &quot;classpath&quot;, &quot;location&quot; to &quot;libs&quot;) }
ant.references.set(&quot;classpath&quot;, ant.withGroovyBuilder { &quot;path&quot;(&quot;location&quot; to &quot;libs&quot;) })
ant.references[&quot;classpath&quot;] = ant.withGroovyBuilder { &quot;path&quot;(&quot;location&quot; to &quot;libs&quot;) }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.path(<span class="key">id</span>: <span class="string"><span class="delimiter">'</span><span class="content">classpath</span><span class="delimiter">'</span></span>, <span class="key">location</span>: <span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>)
ant.references.classpath = ant.path(<span class="key">location</span>: <span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>)
ant.references[<span class="string"><span class="delimiter">'</span><span class="content">classpath</span><span class="delimiter">'</span></span>] = ant.path(<span class="key">location</span>: <span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;path</span> <span class="attribute-name">refid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are several ways to get an Ant reference:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;path</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">antPath</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">libs</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">println(ant.references.get(&quot;antPath&quot;))
println(ant.references[&quot;antPath&quot;])</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println ant.references.antPath
println ant.references[<span class="string"><span class="delimiter">'</span><span class="content">antPath</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:ant_logging"><a class="anchor" href="#sec:ant_logging"></a><a class="link" href="#sec:ant_logging">Using Ant logging</a></h4>
<div class="paragraph">
<p>Gradle maps Ant message priorities to Gradle log levels so that messages logged from Ant appear in the Gradle output.
By default, these are mapped as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Ant Message Priority</th>
<th class="tableblock halign-left valign-top">Gradle Log Level</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>VERBOSE</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DEBUG</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>DEBUG</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DEBUG</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>INFO</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INFO</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>WARN</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>WARN</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>ERROR</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>ERROR</code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="sec:fine_tuning_ant_logging"><a class="anchor" href="#sec:fine_tuning_ant_logging"></a><a class="link" href="#sec:fine_tuning_ant_logging">Fine-tuning Ant logging</a></h5>
<div class="paragraph">
<p>The default mapping of Ant message priority to the Gradle log level can sometimes be problematic.
For example, no message priority maps directly to the <code>LIFECYCLE</code> log level, which is the default for Gradle.
Many Ant tasks log messages at the <em>INFO</em> priority, which means to expose those messages from Gradle, a build would have to be run with the log level set to <code>INFO</code>, potentially logging much more output than is desired.</p>
</div>
<div class="paragraph">
<p>Conversely, if an Ant task logs messages at too high of a level, suppressing those messages would require the build to be run at a higher log level, such as <code>QUIET.</code>
However, this could result in other desirable outputs being suppressed.</p>
</div>
<div class="paragraph">
<p>To help with this, Gradle allows the user to fine-tune the Ant logging and control the mapping of message priority to the Gradle log level.
This is done by setting the priority that should map to the default Gradle <code>LIFECYCLE</code> log level using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/AntBuilder.html#setLifecycleLogLevel-java.lang.String-">AntBuilder.setLifecycleLogLevel(java.lang.String)</a> method.
When this value is set, any Ant message logged at the configured priority or above will be logged at least at <code>LIFECYCLE</code>.
Any Ant message logged below this priority will be logged at <code>INFO</code> at most.</p>
</div>
<div class="paragraph">
<p>For example, the following changes the mapping such that Ant <em>INFO</em> priority messages are exposed at the <code>LIFECYCLE</code> log level:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.lifecycleLogLevel = AntBuilder.AntMessagePriority.INFO

tasks.register(&quot;hello&quot;) {
    doLast {
        ant.withGroovyBuilder {
            &quot;echo&quot;(&quot;level&quot; to &quot;info&quot;, &quot;message&quot; to &quot;hello from info priority!&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.lifecycleLogLevel = <span class="string"><span class="delimiter">&quot;</span><span class="content">INFO</span><span class="delimiter">&quot;</span></span>

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
    doLast {
        ant.echo(<span class="key">level</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">info</span><span class="delimiter">&quot;</span></span>, <span class="key">message</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hello from info priority!</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle hello

&gt; Task :hello
[ant:echo] hello from info priority!

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>On the other hand, if the <code>lifecycleLogLevel</code> was set to <em>ERROR</em>, Ant messages logged at the <em>WARN</em> priority would no longer be logged at the <code>WARN</code> log level.
They would now be logged at the <code>INFO</code> level and suppressed by default.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:jvm_projects"><a class="anchor" href="#part:jvm_projects"></a><a class="link" href="#part:jvm_projects"><strong>AUTHORING JVM BUILDS</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="building_java_projects"><a class="anchor" href="#building_java_projects"></a><a class="link" href="#building_java_projects">Building Java &amp; JVM projects</a></h3>
<div class="paragraph">
<p>Gradle uses a convention-over-configuration approach to building JVM-based projects that borrows several conventions from Apache Maven. In particular, it uses the same default directory structure for source files and resources, and it works with Maven-compatible repositories.</p>
</div>
<div class="paragraph">
<p>We will look at Java projects in detail in this chapter, but most of the topics apply to other supported JVM languages as well, such as <a href="https://kotlinlang.org/docs/reference/using-gradle.html#targeting-the-jvm">Kotlin</a>, <a href="#groovy_plugin">Groovy</a> and <a href="#scala_plugin">Scala</a>.
If you don&#8217;t have much experience with building JVM-based projects with Gradle, take a look at the <a href="../samples/index.html#java">Java samples</a> for step-by-step instructions on how to build various types of basic Java projects.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The example in this section use the Java Library Plugin.
However the described features are shared by all JVM plugins.
Specifics of the different plugins are available in their dedicated documentation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
There are a number of hands-on samples that you can explore for <a href="../samples/index.html#java">Java</a>, <a href="../samples/index.html#groovy">Groovy</a>, <a href="../samples/index.html#scala">Scala</a> and <a href="../samples/index.html#kotlin">Kotlin</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="introduction"><a class="anchor" href="#introduction"></a><a class="link" href="#introduction">Introduction</a></h4>
<div class="paragraph">
<p>The simplest build script for a Java project applies the <a href="#java_library_plugin">Java Library Plugin</a> and optionally sets the project version and selects the <a href="#toolchains">Java toolchain</a> to use:</p>
</div>
<div id="ex-applying-the-java-library-plugin" class="exampleblock">
<div class="title">Example 5. <a href="#ex-applying-the-java-library-plugin">Applying the Java Library Plugin</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)
    }
}

version = &quot;1.2.1&quot;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(<span class="integer">17</span>)
    }
}

version = <span class="string"><span class="delimiter">'</span><span class="content">1.2.1</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By applying the Java Library Plugin, you get a whole host of features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>compileJava</code> task that compiles all the Java source files under <em>src/main/java</em></p>
</li>
<li>
<p>A <code>compileTestJava</code> task for source files under <em>src/test/java</em></p>
</li>
<li>
<p>A <code>test</code> task that runs the tests from <em>src/test/java</em></p>
</li>
<li>
<p>A <code>jar</code> task that packages the <code>main</code> compiled classes and resources from <em>src/main/resources</em> into a single JAR named <em>&lt;project&gt;-&lt;version&gt;.jar</em></p>
</li>
<li>
<p>A <code>javadoc</code> task that generates Javadoc for the <code>main</code> classes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This isn&#8217;t sufficient to build any non-trivial Java project — at the very least, you&#8217;ll probably have some file dependencies. But it means that your build script only needs the information that is specific to <em>your</em> project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Although the properties in the example are optional, we recommend that you specify them in your projects.
Configuring the toolchain protects against problems with the project being built with different Java versions.
The version string is important for tracking the progression of the project.
The project version is also used in archive names by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Java Library Plugin also integrates the above tasks into the standard <a href="base_plugin.html#sec:base_tasks">Base Plugin lifecycle tasks</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jar</code> is attached to <code>assemble</code></p>
</li>
<li>
<p><code>test</code> is attached to <code>check</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rest of the chapter explains the different avenues for customizing the build to your requirements. You will also see later how to adjust the build for libraries, applications, web apps and enterprise apps.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_source_sets"><a class="anchor" href="#sec:java_source_sets"></a><a class="link" href="#sec:java_source_sets">Declaring your source files via source sets</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s Java support was the first to introduce a new concept for building source-based projects: <em>source sets</em>. The main idea is that source files and resources are often logically grouped by type, such as application code, unit tests and integration tests. Each logical group typically has its own sets of file dependencies, classpaths, and more. Significantly, the files that form a source set <em>don&#8217;t have to be located in the same directory</em>!</p>
</div>
<div class="paragraph">
<p>Source sets are a powerful concept that tie together several aspects of compilation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the source files and where they&#8217;re located</p>
</li>
<li>
<p>the compilation classpath, including any required dependencies (via Gradle <a href="#sub:terminology_configuration">configurations</a>)</p>
</li>
<li>
<p>where the compiled class files are placed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see how these relate to one another in this diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/java-sourcesets-compilation.png" alt="java sourcesets compilation">
</div>
<div class="title">Figure 1. Source sets and Java compilation</div>
</div>
<div class="paragraph">
<p>The shaded boxes represent properties of the source set itself.
On top of that, the Java Library Plugin automatically creates a compilation task for every source set you or a plugin defines — named <code>compile<em>SourceSet</em>Java</code> — and several <a href="java_plugin.html#java_source_set_configurations">dependency configurations</a>.</p>
</div>
<div class="openblock">
<div class="title">The <code>main</code> source set</div>
<div class="content">
<div class="paragraph">
<p>Most language plugins, Java included, automatically create a source set called <code>main</code>, which is used for the project&#8217;s production code. This source set is special in that its name is not included in the names of the configurations and tasks, hence why you have just a <code>compileJava</code> task and <code>compileOnly</code> and <code>implementation</code> configurations rather than <code>compileMainJava</code>, <code>mainCompileOnly</code> and <code>mainImplementation</code> respectively.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Java projects typically include resources other than source files, such as properties files, that may need processing — for example by replacing tokens within the files — and packaging within the final JAR.
The Java Library Plugin handles this by automatically creating a dedicated task for each defined source set called <code>process<em>SourceSet</em>Resources</code> (or <code>processResources</code> for the <code>main</code> source set).
The following diagram shows how the source set fits in with this task:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/java-sourcesets-process-resources.png" alt="java sourcesets process resources">
</div>
<div class="title">Figure 2. Processing non-source files for a source set</div>
</div>
<div class="paragraph">
<p>As before, the shaded boxes represent properties of the source set, which in this case comprises the locations of the resource files and where they are copied to.</p>
</div>
<div class="paragraph">
<p>In addition to the <code>main</code> source set, the Java Library Plugin defines a <code>test</code> source set that represents the project&#8217;s tests.
This source set is used by the <code>test</code> task, which runs the tests.
You can learn more about this task and related topics in the <a href="#java_testing">Java testing</a> chapter.</p>
</div>
<div class="paragraph">
<p>Projects typically use this source set for unit tests, but you can also use it for integration, acceptance and other types of test if you wish.
The alternative approach is to <a href="#sec:custom_java_source_sets">define a new source set</a> for each of your other test types, which is typically done for one or both of the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You want to keep the tests separate from one another for aesthetics and manageability</p>
</li>
<li>
<p>The different test types require different compilation or runtime classpaths or some other difference in setup</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see an example of this approach in the Java testing chapter, which shows you <a href="#sec:configuring_java_integration_tests">how to set up integration tests</a> in a project.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll learn more about source sets and the features they provide in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sec:custom_java_source_set_paths">Customizing file and directory locations</a></p>
</li>
<li>
<p><a href="#sec:configuring_java_integration_tests">Configuring Java integration tests</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="sec:implicit_sourceset_configurations"><a class="anchor" href="#sec:implicit_sourceset_configurations"></a><a class="link" href="#sec:implicit_sourceset_configurations">Source set configurations</a></h5>
<div class="paragraph">
<p>When a source set is created, it also creates a number of configurations as described above.
Build logic should <strong>not</strong> attempt to create or access these configurations until they are first created by the source set.</p>
</div>
<div class="paragraph">
<p>When creating a source set, if one of these automatically created configurations already exists, Gradle will emit a deprecation warning.
If the existing configuration&#8217;s role is different than the role that the source set would have assigned, its role will be mutated to the correct value and another deprecation warning will be emitted.</p>
</div>
<div class="paragraph">
<p>The build below demonstrates this unwanted behavior.</p>
</div>
<div id="ex-configurations-created-prior-to-their-associated-source-sets" class="exampleblock">
<div class="title">Example 6. <a href="#ex-configurations-created-prior-to-their-associated-source-sets">Configurations created prior to their associated source sets</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    val myCodeCompileClasspath: Configuration by creating
}

sourceSets {
    val myCode: SourceSet by creating
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    myCodeCompileClasspath
}

sourceSets {
    myCode
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, the following deprecation warning is emitted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>When creating configurations during sourceSet custom setup, Gradle found that configuration customCompileClasspath already exists with permitted usage(s):
        Consumable - this configuration can be selected by another project as a dependency
        Resolvable - this configuration can be resolved by this project to a set of files
        Declarable - this configuration can have dependencies added to it
Yet Gradle expected to create it with the usage(s):
        Resolvable - this configuration can be resolved by this project to a set of files</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following two simple best practices will avoid this problem:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Don&#8217;t create configurations with names that will be used by source sets, such as names ending in <code>Api</code>, <code>Implementation</code>, <code>ApiElements</code>, <code>CompileOnly</code>, <code>CompileOnlyApi</code>, <code>RuntimeOnly</code>, <code>RuntimeClasspath</code> or <code>RuntimeElements</code>.
(This list is not exhaustive.)</p>
</li>
<li>
<p>Create any custom source sets prior to any custom configurations.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Remember that any time you reference a configuration within the <code>configurations</code> container - with or without supplying an initialization action - Gradle will create the configuration.
Sometimes when using the Groovy DSL this creation is not obvious, as in the example below, where <code>myCustomConfiguration</code> is created prior to the call to <code>extendsFrom</code>.</p>
</div>
<div id="ex-custom-configuration-creation-in-groovy" class="exampleblock">
<div class="title">Example 7. <a href="#ex-custom-configuration-creation-in-groovy">Custom Configuration creation in Groovy</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    myCustomConfiguration.extendsFrom(implementation)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_dependency_management_overview"><a class="anchor" href="#sec:java_dependency_management_overview"></a><a class="link" href="#sec:java_dependency_management_overview">Managing your dependencies</a></h4>
<div class="paragraph">
<p>The vast majority of Java projects rely on libraries, so managing a project&#8217;s dependencies is an important part of building a Java project.
Dependency management is a big topic, so we will focus on the basics for Java projects here.
If you&#8217;d like to dive into the detail, check out the <a href="#dependency_management_in_gradle">introduction to dependency management</a>.</p>
</div>
<div class="paragraph">
<p>Specifying the dependencies for your Java project requires just three pieces of information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Which dependency you need, such as a name and version</p>
</li>
<li>
<p>What it&#8217;s needed for, e.g. compilation or running</p>
</li>
<li>
<p>Where to look for it</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first two are specified in a <code>dependencies {}</code> block and the third in a <code>repositories {}</code> block. For example, to tell Gradle that your project requires version 3.6.7 of <a href="http://hibernate.org/">Hibernate</a> Core to compile and run your production code, and that you want to download the library from the Maven Central repository, you can use the following fragment:</p>
</div>
<div id="ex-declaring-dependencies" class="exampleblock">
<div class="title">Example 8. <a href="#ex-declaring-dependencies">Declaring dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;org.hibernate:hibernate-core:3.6.7.Final&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate:hibernate-core:3.6.7.Final</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Gradle terminology for the three elements is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Repository</em> (ex: <code>mavenCentral()</code>) — where to look for the modules you declare as dependencies</p>
</li>
<li>
<p><em>Configuration</em> (ex: <code>implementation</code>) — a named collection of dependencies, grouped together for a specific goal such as compiling or running a module — a more flexible form of Maven scopes</p>
</li>
<li>
<p><em>Module coordinate</em> (ex: <code>org.hibernate:hibernate-core-3.6.7.Final</code>) — the ID of the dependency, usually in the form '<em>&lt;group&gt;</em>:<em>&lt;module&gt;</em>:<em>&lt;version&gt;</em>' (or '<em>&lt;groupId&gt;</em>:<em>&lt;artifactId&gt;</em>:<em>&lt;version&gt;</em>' in Maven terminology)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find a more comprehensive glossary of dependency management terms <a href="#dependency_management_terminology">here</a>.</p>
</div>
<div class="paragraph">
<p>As far as configurations go, the main ones of interest are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>compileOnly</code> — for dependencies that are necessary to compile your production code but shouldn&#8217;t be part of the runtime classpath</p>
</li>
<li>
<p><code>implementation</code> (supersedes <code>compile</code>) — used for compilation and runtime</p>
</li>
<li>
<p><code>runtimeOnly</code> (supersedes <code>runtime</code>) — only used at runtime, not for compilation</p>
</li>
<li>
<p><code>testCompileOnly</code> — same as <code>compileOnly</code> except it&#8217;s for the tests</p>
</li>
<li>
<p><code>testImplementation</code> — test equivalent of <code>implementation</code></p>
</li>
<li>
<p><code>testRuntimeOnly</code> — test equivalent of <code>runtimeOnly</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can learn more about these and how they relate to one another in the <a href="java_plugin.html#sec:java_plugin_and_dependency_management">plugin reference chapter</a>.</p>
</div>
<div class="paragraph">
<p>Be aware that the <a href="#java_library_plugin">Java Library Plugin</a> offers two additional configurations — <code>api</code> and <code>compileOnlyApi</code> — for dependencies that are required for compiling both the module and any modules that depend on it.</p>
</div>
<div class="openblock">
<div class="title">Why no <code>compile</code> configuration?</div>
<div class="content">
<div class="paragraph">
<p>The Java Library Plugin has historically used the <code>compile</code> configuration for dependencies that are required to both compile and run a project&#8217;s production code.
It is now deprecated, and will issue warnings when used, because it doesn&#8217;t distinguish between dependencies that impact the public API of a Java library project and those that don&#8217;t.
You can learn more about the importance of this distinction in <a href="#sec:building_java_libraries">Building Java libraries</a>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>We have only scratched the surface here, so we recommend that you read the dedicated dependency management chapters once you&#8217;re comfortable with the basics of building Java projects with Gradle. Some common scenarios that require further reading include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Defining a custom <a href="#sec:maven_repo">Maven-</a> or <a href="#sec:ivy_repositories">Ivy-compatible</a> repository</p>
</li>
<li>
<p>Using dependencies from a <a href="#sub:flat_dir_resolver">local filesystem directory</a></p>
</li>
<li>
<p>Declaring dependencies with <a href="#sub:declaring_dependency_with_changing_version">changing</a> (e.g. SNAPSHOT) and <a href="#sub:declaring_dependency_with_dynamic_version">dynamic</a> (range) versions</p>
</li>
<li>
<p>Declaring a sibling <a href="#sub:project_dependencies">project as a dependency</a></p>
</li>
<li>
<p><a href="#dependency-constraints">Controlling transitive dependencies and their versions</a></p>
</li>
<li>
<p>Testing your fixes to a 3rd-party dependency via <a href="#composite_builds">composite builds</a> (a better alternative to publishing to and consuming from <a href="#sub:maven_local">Maven Local</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You&#8217;ll discover that Gradle has a rich API for working with dependencies — one that takes time to master, but is straightforward to use for common scenarios.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:compile"><a class="anchor" href="#sec:compile"></a><a class="link" href="#sec:compile">Compiling your code</a></h4>
<div class="paragraph">
<p>Compiling both your production and test code can be trivially easy if you follow the conventions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Put your production source code under the <em>src/main/java</em> directory</p>
</li>
<li>
<p>Put your test source code under <em>src/test/java</em></p>
</li>
<li>
<p>Declare your production compile dependencies in the <code>compileOnly</code> or <code>implementation</code> configurations (see previous section)</p>
</li>
<li>
<p>Declare your test compile dependencies in the <code>testCompileOnly</code> or <code>testImplementation</code> configurations</p>
</li>
<li>
<p>Run the <code>compileJava</code> task for the production code and <code>compileTestJava</code> for the tests</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Other JVM language plugins, such as the one for <a href="#groovy_plugin">Groovy</a>, follow the same pattern of conventions. We recommend that you follow these conventions wherever possible, but you don&#8217;t have to. There are several options for customization, as you&#8217;ll see next.</p>
</div>
<div class="sect4">
<h5 id="sec:custom_java_source_set_paths"><a class="anchor" href="#sec:custom_java_source_set_paths"></a><a class="link" href="#sec:custom_java_source_set_paths">Customizing file and directory locations</a></h5>
<div class="paragraph">
<p>Imagine you have a legacy project that uses an <em>src</em> directory for the production code and <em>test</em> for the test code. The conventional directory structure won&#8217;t work, so you need to tell Gradle where to find the source files. You do that via source set configuration.</p>
</div>
<div class="paragraph">
<p>Each source set defines where its source code resides, along with the resources and the output directory for the class files. You can override the convention values by using the following syntax:</p>
</div>
<div id="ex-declaring-custom-source-directories" class="exampleblock">
<div class="title">Example 9. <a href="#ex-declaring-custom-source-directories">Declaring custom source directories</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    main {
        java {
            setSrcDirs(listOf(&quot;src&quot;))
        }
    }

    test {
        java {
            setSrcDirs(listOf(&quot;test&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    main {
         java {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>]
         }
    }

    test {
        java {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>]
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now Gradle will only search directly in <em>src</em> and <em>test</em> for the respective source code. What if you don&#8217;t want to override the convention, but simply want to <em>add</em> an extra source directory, perhaps one that contains some third-party source code you want to keep separate? The syntax is similar:</p>
</div>
<div id="ex-declaring-custom-source-directories-additively" class="exampleblock">
<div class="title">Example 10. <a href="#ex-declaring-custom-source-directories-additively">Declaring custom source directories additively</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    main {
        java {
            srcDir(&quot;thirdParty/src/main/java&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    main {
        java {
            srcDir <span class="string"><span class="delimiter">'</span><span class="content">thirdParty/src/main/java</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Crucially, we&#8217;re using the <em>method</em> <code>srcDir()</code> here to append a directory path, whereas setting the <code>srcDirs</code> property replaces any existing values. This is a common convention in Gradle: setting a property replaces values, while the corresponding method appends values.</p>
</div>
<div class="paragraph">
<p>You can see all the properties and methods available on source sets in the DSL reference for <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.SourceSet.html">SourceSet</a> and <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.file.SourceDirectorySet.html">SourceDirectorySet</a>. Note that <code>srcDirs</code> and <code>srcDir()</code> are both on <code>SourceDirectorySet</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="changing_compiler_options"><a class="anchor" href="#changing_compiler_options"></a><a class="link" href="#changing_compiler_options">Changing compiler options</a></h5>
<div class="paragraph">
<p>Most of the compiler options are accessible through the corresponding task, such as <code>compileJava</code> and <code>compileTestJava</code>. These tasks are of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a>, so read the task reference for an up-to-date and comprehensive list of the options.</p>
</div>
<div class="paragraph">
<p>For example, if you want to use a separate JVM process for the compiler and prevent compilation failures from failing the build, you can use this configuration:</p>
</div>
<div id="ex-setting-java-compiler-options" class="exampleblock">
<div class="title">Example 11. <a href="#ex-setting-java-compiler-options">Setting Java compiler options</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.compileJava {
    options.isIncremental = true
    options.isFork = true
    options.isFailOnError = false
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compileJava {
    options.incremental = <span class="predefined-constant">true</span>
    options.fork = <span class="predefined-constant">true</span>
    options.failOnError = <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s also how you can change the verbosity of the compiler, disable debug output in the byte code and configure where the compiler can find annotation processors.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:java_cross_compilation"><a class="anchor" href="#sec:java_cross_compilation"></a><a class="link" href="#sec:java_cross_compilation">Targeting a specific Java version</a></h5>
<div class="paragraph">
<p>By default, Gradle will compile Java code to the language level of the JVM running Gradle.
If you need to target a specific version of Java when compiling, Gradle provides multiple options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using <a href="#toolchains">Java toolchains</a> is a preferred way to target a language version.<br>
A toolchain uniformly handles compilation, execution and Javadoc generation, and it can be configured on the project level.</p>
</li>
<li>
<p>Using <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.CompileOptions.html#org.gradle.api.tasks.compile.CompileOptions:release"><code>release</code></a> property is possible starting from Java 10.<br>
Selecting a Java release makes sure that compilation is done with the configured language level and against the JDK APIs from that Java version.</p>
</li>
<li>
<p>Using <code>sourceCompatibility</code> and <code>targetCompatibility</code> properties.<br>
Although not generally advised, these options were historically used to configure the Java version during compilation.</p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="sec:compiling_with_toolchain"><a class="anchor" href="#sec:compiling_with_toolchain"></a><a class="link" href="#sec:compiling_with_toolchain">Using toolchains</a></h6>
<div class="paragraph">
<p>When Java code is compiled using a specific toolchain, the actual compilation is carried out by a compiler of the specified Java version.
The compiler provides access to the language features and JDK APIs for the requested Java language version.</p>
</div>
<div class="paragraph">
<p>In the simplest case, the toolchain can be configured for a project using the <code>java</code> extension.
This way, not only compilation benefits from it, but also other tasks such as <code>test</code> and <code>javadoc</code> will also consistently use the same toolchain.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(<span class="integer">17</span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can learn more about this in the <a href="#toolchains">Java toolchains</a> guide.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:compiling_with_release"><a class="anchor" href="#sec:compiling_with_release"></a><a class="link" href="#sec:compiling_with_release">Using Java release version</a></h6>
<div class="paragraph">
<p>Setting the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.CompileOptions.html#org.gradle.api.tasks.compile.CompileOptions:release">release</a> flag ensures the specified language level is used regardless of which compiler actually performs the compilation.
To use this feature, the compiler must support the requested release version.
It is possible to specify an earlier release version while compiling with a more recent <a href="#sec:compiling_with_toolchain">toolchain</a>.</p>
</div>
<div class="paragraph">
<p>Gradle supports using the release flag from Java 10.
It can be configured on the compilation task as follows.</p>
</div>
<div id="ex-setting-java-release-flag" class="exampleblock">
<div class="title">Example 12. <a href="#ex-setting-java-release-flag">Setting Java release flag</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.compileJava {
    options.release = 7
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compileJava {
    options.release = <span class="integer">7</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The release flag provides guarantees similar to toolchains.
It validates that the Java sources are not using language features introduced in later Java versions, and also that the code does not access APIs from more recent JDKs.
The bytecode produced by the compiler also corresponds to the requested Java version, meaning that the compiled code cannot be executed on older JVMs.</p>
</div>
<div class="paragraph">
<p>The <code>release</code> option of the Java compiler was introduced in Java 9.
However, using this option with Gradle is only possible starting with Java 10, due to a <a href="https://bugs.openjdk.java.net/browse/JDK-8139607">bug in Java 9</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="using_java_compatibility_options"><a class="anchor" href="#using_java_compatibility_options"></a><a class="link" href="#using_java_compatibility_options">Using Java compatibility options</a></h6>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Using compatibility properties can lead to runtime failures when executing compiled code due to weaker guarantees they provide.
Instead, consider using <a href="#sec:compiling_with_toolchain">toolchains</a> or the <a href="#sec:compiling_with_release">release</a> flag.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>sourceCompatibility</code> and <code>targetCompatibility</code> options correspond to the Java compiler options <code>-source</code> and <code>-target</code>.
They are considered a legacy mechanism for targeting a specific Java version.
However, these options do not protect against the use of APIs introduced in later Java versions.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>sourceCompatibility</code></dt>
<dd>
<p>Defines the language version of Java used in your source files.</p>
</dd>
<dt class="hdlist1"><code>targetCompatibility</code></dt>
<dd>
<p>Defines the minimum JVM version your code should run on, i.e. it determines the version of the bytecode generated by the compiler.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These options can be set per <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a> task, or on the <code>java { }</code> extension for all compile tasks, using properties with the same names.</p>
</div>
</div>
<div class="sect5">
<h6 id="targeting_java_6_and_java_7"><a class="anchor" href="#targeting_java_6_and_java_7"></a><a class="link" href="#targeting_java_6_and_java_7">Targeting Java 6 and Java 7</a></h6>
<div class="paragraph">
<p>Gradle itself can only run on a JVM with Java version 8 or higher.
However, Gradle still supports compiling, testing, generating Javadocs and executing applications for Java 6 and Java 7.
Java 5 and below are not supported.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If using Java 10+, leveraging the <code>release</code> flag might be an easier solution, see above.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use Java 6 or Java 7, the following tasks need to be configured:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JavaCompile</code> task to fork and use the correct Java home</p>
</li>
<li>
<p><code>Javadoc</code> task to use the correct <code>javadoc</code> executable</p>
</li>
<li>
<p><code>Test</code> and the <code>JavaExec</code> task to use the correct <code>java</code> executable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the usage of Java toolchains, this can be done as follows:</p>
</div>
<div id="ex-configuring-java-7-build" class="exampleblock">
<div class="title">Example 13. <a href="#ex-configuring-java-7-build">Configuring Java 7 build</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(7)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(<span class="integer">7</span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The only requirement is that Java 7 is installed and has to be either in <a href="#sec:auto_detection">a location Gradle can detect automatically</a> or <a href="#sec:custom_loc">explicitly configured</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:custom_java_source_sets"><a class="anchor" href="#sec:custom_java_source_sets"></a><a class="link" href="#sec:custom_java_source_sets">Compiling independent sources separately</a></h5>
<div class="paragraph">
<p>Most projects have at least two independent sets of sources: the production code and the test code.
Gradle already makes this scenario part of its Java convention, but what if you have other sets of sources?
One of the most common scenarios is when you have separate integration tests of some form or other.
In that case, a custom source set may be just what you need.</p>
</div>
<div class="paragraph">
<p>You can see a complete example for setting up integration tests in the <a href="#sec:configuring_java_integration_tests">Java testing chapter</a>. You can set up other source sets that fulfil different roles in the same way. The question then becomes: when should you define a custom source set?</p>
</div>
<div class="paragraph">
<p>To answer that question, consider whether the sources:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Need to be compiled with a unique classpath</p>
</li>
<li>
<p>Generate classes that are handled differently from the <code>main</code> and <code>test</code> ones</p>
</li>
<li>
<p>Form a natural part of the project</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If your answer to both 3 and either one of the others is yes, then a custom source set is probably the right approach. For example, integration tests are typically part of the project because they test the code in <code>main</code>. In addition, they often have either their own dependencies independent of the <code>test</code> source set or they need to be run with a custom <code>Test</code> task.</p>
</div>
<div class="paragraph">
<p>Other common scenarios are less clear cut and may have better solutions. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Separate API and implementation JARs — it may make sense to have these as separate projects, particularly if you already have a multi-project build</p>
</li>
<li>
<p>Generated sources — if the resulting sources should be compiled with the production code, add their path(s) to the <code>main</code> source set and make sure that the <code>compileJava</code> task depends on the task that generates the sources</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you&#8217;re unsure whether to create a custom source set or not, then go ahead and do so. It should be straightforward and if it&#8217;s not, then it&#8217;s probably not the right tool for the job.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_resources"><a class="anchor" href="#sec:java_resources"></a><a class="link" href="#sec:java_resources">Managing resources</a></h4>
<div class="paragraph">
<p>Many Java projects make use of resources beyond source files, such as images, configuration files and localization data.
Sometimes these files simply need to be packaged unchanged and sometimes they need to be processed as template files or in some other way.
Either way, the Java Library Plugin adds a specific <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.Copy.html">Copy</a> task for each source set that handles the processing of its associated resources.</p>
</div>
<div class="paragraph">
<p>The task&#8217;s name follows the convention of <code>process<em>SourceSet</em>Resources</code> — or <code>processResources</code> for the <code>main</code> source set — and it will automatically copy any files in <em>src/[sourceSet]/resources</em> to a directory that will be included in the production JAR. This target directory will also be included in the runtime classpath of the tests.</p>
</div>
<div class="paragraph">
<p>Since <code>processResources</code> is an instance of the <code>ProcessResources</code> task, you can perform any of the processing described in the <a href="#sec:copying_files">Working With Files</a> chapter.</p>
</div>
<div class="sect4">
<h5 id="sec:properties_files"><a class="anchor" href="#sec:properties_files"></a><a class="link" href="#sec:properties_files">Java properties files and reproducible builds</a></h5>
<div class="paragraph">
<p>You can easily create Java properties files via the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.WriteProperties.html">WriteProperties</a> task, which fixes a well-known problem with <code>Properties.store()</code> that can reduce the usefulness of <a href="#incremental_build">incremental builds</a>.</p>
</div>
<div class="paragraph">
<p>The standard Java API for writing properties files produces a unique file every time, even when the same properties and values are used, because it includes a timestamp in the comments. Gradle&#8217;s <code>WriteProperties</code> task generates exactly the same output byte-for-byte if none of the properties have changed. This is achieved by a few tweaks to how a properties file is generated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>no timestamp comment is added to the output</p>
</li>
<li>
<p>the line separator is system independent, but can be configured explicitly (it defaults to <code>'\n'</code>)</p>
</li>
<li>
<p>the properties are sorted alphabetically</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sometimes it can be desirable to recreate archives in a byte for byte way on different machines. You want to be sure that building an artifact from source code produces the same result, byte for byte, no matter when and where it is built. This is necessary for projects like reproducible-builds.org.</p>
</div>
<div class="paragraph">
<p>These tweaks not only lead to better incremental build integration, but they also help with <a href="https://reproducible-builds.org">reproducible builds</a>. In essence, reproducible builds guarantee that you will see the same results from a build execution — including test results and production binaries — no matter when or on what system you run it.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:running_java_tests"><a class="anchor" href="#sec:running_java_tests"></a><a class="link" href="#sec:running_java_tests">Running tests</a></h4>
<div class="paragraph">
<p>Alongside providing automatic compilation of unit tests in <em>src/test/java</em>, the Java Library Plugin has native support for running tests that use JUnit 3, 4 &amp; 5 (JUnit 5 support <a href="https://docs.gradle.org/4.6/release-notes.html#junit-5-support">came in Gradle 4.6</a>) and TestNG.
You get:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An automatic <code>test</code> task of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html">Test</a>, using the <code>test</code> source set</p>
</li>
<li>
<p>An HTML test report that includes the results from <em>all</em> <code>Test</code> tasks that run</p>
</li>
<li>
<p>Easy filtering of which tests to run</p>
</li>
<li>
<p>Fine-grained control over how the tests are run</p>
</li>
<li>
<p>The opportunity to create your own test execution and test reporting tasks</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You do <em>not</em> get a <code>Test</code> task for every source set you declare, since not every source set represents tests! That&#8217;s why you typically need to <a href="#sec:custom_java_source_sets">create your own <code>Test</code> tasks</a> for things like integration and acceptance tests if they can&#8217;t be included with the <code>test</code> source set.</p>
</div>
<div class="paragraph">
<p>As there is a lot to cover when it comes to testing, the topic has its <a href="#java_testing">own chapter</a> in which we look at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How tests are run</p>
</li>
<li>
<p>How to run a subset of tests via filtering</p>
</li>
<li>
<p>How Gradle discovers tests</p>
</li>
<li>
<p>How to configure test reporting and add your own reporting tasks</p>
</li>
<li>
<p>How to make use of specific JUnit and TestNG features</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also learn more about configuring tests in the DSL reference for <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html">Test</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_packaging"><a class="anchor" href="#sec:java_packaging"></a><a class="link" href="#sec:java_packaging">Packaging and publishing</a></h4>
<div class="paragraph">
<p>How you package and potentially publish your Java project depends on what type of project it is.
Libraries, applications, web applications and enterprise applications all have differing requirements.
In this section, we will focus on the bare bones provided by the Java Library Plugin.</p>
</div>
<div class="paragraph">
<p>By default, the Java Library Plugin provides the <code>jar</code> task that packages all the compiled production classes and resources into a single JAR.
This JAR is also automatically built by the <code>assemble</code> task.
Furthermore, the plugin can be configured to provide the <code>javadocJar</code> and <code>sourcesJar</code> tasks to package Javadoc and source code if so desired.
If a publishing plugin is used, these tasks will automatically run during publishing or can be called directly.</p>
</div>
<div id="ex-configure-a-project-to-publish-javadoc-and-sources" class="exampleblock">
<div class="title">Example 14. <a href="#ex-configure-a-project-to-publish-javadoc-and-sources">Configure a project to publish Javadoc and sources</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    withJavadocJar()
    withSourcesJar()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    withJavadocJar()
    withSourcesJar()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want to create an 'uber' (AKA 'fat') JAR, then you can use a task definition like this:</p>
</div>
<div id="ex-creating-a-java-uber-or-fat-jar" class="exampleblock">
<div class="title">Example 15. <a href="#ex-creating-a-java-uber-or-fat-jar">Creating a Java uber or fat JAR</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}

version = &quot;1.0.0&quot;

repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;commons-io:commons-io:2.6&quot;)
}

tasks.register&lt;Jar&gt;(&quot;uberJar&quot;) {
    archiveClassifier = &quot;uber&quot;

    from(sourceSets.main.get().output)

    dependsOn(configurations.runtimeClasspath)
    from({
        configurations.runtimeClasspath.get().filter { it.name.endsWith(&quot;jar&quot;) }.map { zipTree(it) }
    })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

version = <span class="string"><span class="delimiter">'</span><span class="content">1.0.0</span><span class="delimiter">'</span></span>

repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-io:commons-io:2.6</span><span class="delimiter">'</span></span>
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">uberJar</span><span class="delimiter">'</span></span>, Jar) {
    archiveClassifier = <span class="string"><span class="delimiter">'</span><span class="content">uber</span><span class="delimiter">'</span></span>

    from sourceSets.main.output

    dependsOn configurations.runtimeClasspath
    from {
        configurations.runtimeClasspath.findAll { <span class="local-variable">it</span>.name.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>) }.collect { zipTree(<span class="local-variable">it</span>) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar</a> for more details on the configuration options available to you.
And note that you need to use <code>archiveClassifier</code> rather than <code>archiveAppendix</code> here for correct publication of the JAR.</p>
</div>
<div class="paragraph">
<p>You can use one of the publishing plugins to publish the JARs created by a Java project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#publishing_maven">Maven Publish Plugin</a></p>
</li>
<li>
<p><a href="#publishing_ivy">Ivy Publish Plugin</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="sec:jar_manifest"><a class="anchor" href="#sec:jar_manifest"></a><a class="link" href="#sec:jar_manifest">Modifying the JAR manifest</a></h5>
<div class="paragraph">
<p>Each instance of the <code>Jar</code>, <code>War</code> and <code>Ear</code> tasks has a <code>manifest</code> property that allows you to customize the <em>MANIFEST.MF</em> file that goes into the corresponding archive. The following example demonstrates how to set attributes in the JAR&#8217;s manifest:</p>
</div>
<div id="ex-customization-of-manifest-mf" class="exampleblock">
<div class="title">Example 16. <a href="#ex-customization-of-manifest-mf">Customization of MANIFEST.MF</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.jar {
    manifest {
        attributes(
            &quot;Implementation-Title&quot; to &quot;Gradle&quot;,
            &quot;Implementation-Version&quot; to archiveVersion
        )
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">jar {
    manifest {
        attributes(<span class="string"><span class="delimiter">&quot;</span><span class="content">Implementation-Title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Gradle</span><span class="delimiter">&quot;</span></span>,
                   <span class="string"><span class="delimiter">&quot;</span><span class="content">Implementation-Version</span><span class="delimiter">&quot;</span></span>: archiveVersion)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/java/archives/Manifest.html">Manifest</a> for the configuration options it provides.</p>
</div>
<div class="paragraph">
<p>You can also create standalone instances of <code>Manifest</code>. One reason for doing so is to share manifest information between JARs. The following example demonstrates how to share common attributes between JARs:</p>
</div>
<div id="ex-creating-a-manifest-object" class="exampleblock">
<div class="title">Example 17. <a href="#ex-creating-a-manifest-object">Creating a manifest object.</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val sharedManifest = java.manifest {
    attributes (
        &quot;Implementation-Title&quot; to &quot;Gradle&quot;,
        &quot;Implementation-Version&quot; to version
    )
}

tasks.register&lt;Jar&gt;(&quot;fooJar&quot;) {
    manifest = java.manifest {
        from(sharedManifest)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> sharedManifest = java.manifest {
    attributes(<span class="string"><span class="delimiter">&quot;</span><span class="content">Implementation-Title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Gradle</span><span class="delimiter">&quot;</span></span>,
               <span class="string"><span class="delimiter">&quot;</span><span class="content">Implementation-Version</span><span class="delimiter">&quot;</span></span>: version)
}
tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">fooJar</span><span class="delimiter">'</span></span>, Jar) {
    manifest = java.manifest {
        from sharedManifest
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Another option available to you is to merge manifests into a single <code>Manifest</code> object. Those source manifests can take the form of a text for or another <code>Manifest</code> object. In the following example, the source manifests are all text files except for <code>sharedManifest</code>, which is the <code>Manifest</code> object from the previous example:</p>
</div>
<div id="ex-separate-manifest-mf-for-a-particular-archive" class="exampleblock">
<div class="title">Example 18. <a href="#ex-separate-manifest-mf-for-a-particular-archive">Separate MANIFEST.MF for a particular archive</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Jar&gt;(&quot;barJar&quot;) {
    manifest {
        attributes(&quot;key1&quot; to &quot;value1&quot;)
        from(sharedManifest, &quot;src/config/basemanifest.txt&quot;)
        from(listOf(&quot;src/config/javabasemanifest.txt&quot;, &quot;src/config/libbasemanifest.txt&quot;)) {
            eachEntry(Action&lt;ManifestMergeDetails&gt; {
                if (baseValue != mergeValue) {
                    value = baseValue
                }
                if (key == &quot;foo&quot;) {
                    exclude()
                }
            })
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">barJar</span><span class="delimiter">'</span></span>, Jar) {
    manifest {
        attributes <span class="key">key1</span>: <span class="string"><span class="delimiter">'</span><span class="content">value1</span><span class="delimiter">'</span></span>
        from sharedManifest, <span class="string"><span class="delimiter">'</span><span class="content">src/config/basemanifest.txt</span><span class="delimiter">'</span></span>
        from([<span class="string"><span class="delimiter">'</span><span class="content">src/config/javabasemanifest.txt</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">src/config/libbasemanifest.txt</span><span class="delimiter">'</span></span>]) {
            eachEntry { details -&gt;
                <span class="keyword">if</span> (details.baseValue != details.mergeValue) {
                    details.value = baseValue
                }
                <span class="keyword">if</span> (details.key == <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>) {
                    details.exclude()
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Manifests are merged in the order they are declared in the <code>from</code> statement. If the base manifest and the merged manifest both define values for the same key, the merged manifest wins by default. You can fully customize the merge behavior by adding <code>eachEntry</code> actions in which you have access to a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/java/archives/ManifestMergeDetails.html">ManifestMergeDetails</a> instance for each entry of the resulting manifest. Note that the merge is done lazily, either when generating the JAR or when <code>Manifest.writeTo()</code> or <code>Manifest.getEffectiveManifest()</code> are called.</p>
</div>
<div class="paragraph">
<p>Speaking of <code>writeTo()</code>, you can use that to easily write a manifest to disk at any time, like so:</p>
</div>
<div id="ex-saving-a-manifest-mf-to-disk" class="exampleblock">
<div class="title">Example 19. <a href="#ex-saving-a-manifest-mf-to-disk">Saving a MANIFEST.MF to disk</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.jar { manifest.writeTo(layout.buildDirectory.file(&quot;mymanifest.mf&quot;)) }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>) { manifest.writeTo(layout.buildDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">mymanifest.mf</span><span class="delimiter">'</span></span>)) }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:generating_javadocs"><a class="anchor" href="#sec:generating_javadocs"></a><a class="link" href="#sec:generating_javadocs">Generating API documentation</a></h4>
<div class="paragraph">
<p>The Java Library Plugin provides a <code>javadoc</code> task of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.javadoc.Javadoc.html">Javadoc</a>, that will generate standard Javadocs for all your production code, i.e. whatever source is in the <code>main</code> source set.
The task supports the core Javadoc and standard doclet options described in the <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/javadoc.html#options">Javadoc reference documentation</a>.
See <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/external/javadoc/CoreJavadocOptions.html">CoreJavadocOptions</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/external/javadoc/StandardJavadocDocletOptions.html">StandardJavadocDocletOptions</a> for a complete list of those options.</p>
</div>
<div class="paragraph">
<p>As an example of what you can do, imagine you want to use Asciidoc syntax in your Javadoc comments. To do this, you need to add Asciidoclet to Javadoc&#8217;s doclet path. Here&#8217;s an example that does just that:</p>
</div>
<div id="ex-using-a-custom-doclet-with-javadoc" class="exampleblock">
<div class="title">Example 20. <a href="#ex-using-a-custom-doclet-with-javadoc">Using a custom doclet with Javadoc</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val asciidoclet by configurations.creating

dependencies {
    asciidoclet(&quot;org.asciidoctor:asciidoclet:1.+&quot;)
}

tasks.register(&quot;configureJavadoc&quot;) {
    doLast {
        tasks.javadoc {
            options.doclet = &quot;org.asciidoctor.Asciidoclet&quot;
            options.docletpath = asciidoclet.files.toList()
        }
    }
}

tasks.javadoc {
    dependsOn(&quot;configureJavadoc&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    asciidoclet
}

dependencies {
    asciidoclet <span class="string"><span class="delimiter">'</span><span class="content">org.asciidoctor:asciidoclet:1.+</span><span class="delimiter">'</span></span>
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">configureJavadoc</span><span class="delimiter">'</span></span>) {
    doLast {
        javadoc {
            options.doclet = <span class="string"><span class="delimiter">'</span><span class="content">org.asciidoctor.Asciidoclet</span><span class="delimiter">'</span></span>
            options.docletpath = configurations.asciidoclet.files.toList()
        }
    }
}

javadoc {
    dependsOn configureJavadoc
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You don&#8217;t have to create a configuration for this, but it&#8217;s an elegant way to handle dependencies that are required for a unique purpose.</p>
</div>
<div class="paragraph">
<p>You might also want to create your own Javadoc tasks, for example to generate API docs for the tests:</p>
</div>
<div id="ex-defining-a-custom-javadoc-task" class="exampleblock">
<div class="title">Example 21. <a href="#ex-defining-a-custom-javadoc-task">Defining a custom Javadoc task</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Javadoc&gt;(&quot;testJavadoc&quot;) {
    source = sourceSets.test.get().allJava
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">testJavadoc</span><span class="delimiter">'</span></span>, Javadoc) {
    source = sourceSets.test.allJava
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>These are just two non-trivial but common customizations that you might come across.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:cleaning_java_build"><a class="anchor" href="#sec:cleaning_java_build"></a><a class="link" href="#sec:cleaning_java_build">Cleaning the build</a></h4>
<div class="paragraph">
<p>The Java Library Plugin adds a <code>clean</code> task to your project by virtue of applying the <a href="base_plugin.html#base_plugin">Base Plugin</a>.
This task simply deletes everything in the <code>layout.buildDirectory</code> directory, hence why you should always put files generated by the build in there.
The task is an instance of <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.Delete.html">Delete</a> and you can change what directory it deletes by setting its <code>dir</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_jvm_components"><a class="anchor" href="#sec:building_jvm_components"></a><a class="link" href="#sec:building_jvm_components">Building JVM components</a></h4>
<div class="paragraph">
<p>All of the specific JVM plugins are built on top of the <a href="java_plugin.html#java_plugin">Java Plugin</a>.
The examples above only illustrated concepts provided by this base plugin and shared with all JVM plugins.</p>
</div>
<div class="paragraph">
<p>Read on to understand which plugins fits which project type, as it is recommended to pick a specific plugin instead of applying the Java Plugin directly.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_java_libraries"><a class="anchor" href="#sec:building_java_libraries"></a><a class="link" href="#sec:building_java_libraries">Building Java libraries</a></h4>
<div class="paragraph">
<p>The unique aspect of library projects is that they are used (or "consumed") by other Java projects.
That means the dependency metadata published with the JAR file — usually in the form of a Maven POM —  is crucial.
In particular, consumers of your library should be able to distinguish between two different types of dependencies: those that are only required to compile your library and those that are also required to compile the consumer.</p>
</div>
<div class="paragraph">
<p>Gradle manages this distinction via the <a href="#java_library_plugin">Java Library Plugin</a>, which introduces an <em>api</em> configuration in addition to the <em>implementation</em> one covered in this chapter.
If the types from a dependency appear in public fields or methods of your library&#8217;s public classes, then that dependency is exposed via your library&#8217;s public API and should therefore be added to the <em>api</em> configuration.
Otherwise, the dependency is an internal implementation detail and should be added to <em>implementation</em>.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re unsure of the difference between an API and implementation dependency, the <a href="#sec:java_library_recognizing_dependencies">Java Library Plugin chapter</a> has a detailed explanation. In addition, you can explore a basic, practical <a href="../samples/sample_building_java_libraries.html">sample of building a Java library</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_java_applications"><a class="anchor" href="#sec:building_java_applications"></a><a class="link" href="#sec:building_java_applications">Building Java applications</a></h4>
<div class="paragraph">
<p>Java applications packaged as a JAR aren&#8217;t set up for easy launching from the command line or a desktop environment.
The <a href="#application_plugin">Application Plugin</a> solves the command line aspect by creating a distribution that includes the production JAR, its dependencies and launch scripts Unix-like and Windows systems.</p>
</div>
<div class="paragraph">
<p>See the plugin&#8217;s chapter for more details, but here&#8217;s a quick summary of what you get:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>assemble</code> creates ZIP and TAR distributions of the application containing everything needed to run it</p>
</li>
<li>
<p>A <code>run</code> task that starts the application from the build (for easy testing)</p>
</li>
<li>
<p>Shell and Windows Batch scripts to start the application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see a basic example of building a Java application in the corresponding <a href="../samples/sample_building_java_applications.html">sample</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_java_webapps"><a class="anchor" href="#sec:building_java_webapps"></a><a class="link" href="#sec:building_java_webapps">Building Java web applications</a></h4>
<div class="paragraph">
<p>Java web applications can be packaged and deployed in a number of ways depending on the technology you use. For example, you might use <a href="https://projects.spring.io/spring-boot/">Spring Boot</a> with a fat JAR or a <a href="https://www.reactivemanifesto.org/">Reactive</a>-based system running on <a href="https://netty.io/">Netty</a>. Whatever technology you use, Gradle and its large community of plugins will satisfy your needs. Core Gradle, though, only directly supports traditional Servlet-based web applications deployed as WAR files.</p>
</div>
<div class="paragraph">
<p>That support comes via the <a href="war_plugin.html#war_plugin">War Plugin</a>, which automatically applies the Java Plugin and adds an extra packaging step that does the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Copies static resources from <em>src/main/webapp</em> into the root of the WAR</p>
</li>
<li>
<p>Copies the compiled production classes into a <em>WEB-INF/classes</em> subdirectory of the WAR</p>
</li>
<li>
<p>Copies the library dependencies into a <em>WEB-INF/lib</em> subdirectory of the WAR</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is done by the <code>war</code> task, which effectively replaces the <code>jar</code> task — although that task remains — and is attached to the <code>assemble</code> lifecycle task. See the plugin&#8217;s chapter for more details and configuration options.</p>
</div>
<div class="paragraph">
<p>There is no core support for running your web application directly from the build, but we do recommend that you try the <a href="https://plugins.gradle.org/plugin/org.gretty">Gretty</a> community plugin, which provides an embedded Servlet container.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_java_enterprise_apps"><a class="anchor" href="#sec:building_java_enterprise_apps"></a><a class="link" href="#sec:building_java_enterprise_apps">Building Java EE applications</a></h4>
<div class="paragraph">
<p>Java enterprise systems have changed a lot over the years, but if you&#8217;re still deploying to JEE application servers, you can make use of the <a href="ear_plugin.html#ear_plugin">Ear Plugin</a>. This adds conventions and a task for building EAR files. The plugin&#8217;s chapter has more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_java_platform"><a class="anchor" href="#sec:building_java_platform"></a><a class="link" href="#sec:building_java_platform">Building Java Platforms</a></h4>
<div class="paragraph">
<p>A Java platform represents a set of dependency declarations and constraints that form a cohesive unit to be applied on consuming projects.
The platform has no source and no artifact of its own.
It maps in the Maven world to a <a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Management">BOM</a>.</p>
</div>
<div class="paragraph">
<p>The support comes via the <a href="#java_platform_plugin">Java Platform plugin</a>, which sets up the different configurations and publication components.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This plugin is the exception as it does not apply the Java Plugin.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:feature_preview"><a class="anchor" href="#sec:feature_preview"></a><a class="link" href="#sec:feature_preview">Enabling Java preview features</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Using a Java preview feature is very likely to make your code incompatible with that compiled without a feature preview.
As a consequence, we strongly recommend you not to publish libraries compiled with preview features and restrict the use of feature previews to toy projects.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To enable Java <a href="https://openjdk.java.net/jeps/12">preview features</a> for compilation, test execution and runtime, you can use the following DSL snippet:</p>
</div>
<div id="ex-enabling-java-feature-preview" class="exampleblock">
<div class="title">Example 22. <a href="#ex-enabling-java-feature-preview">Enabling Java feature preview</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;JavaCompile&gt;().configureEach {
    options.compilerArgs.add(&quot;--enable-preview&quot;)
}

tasks.withType&lt;Test&gt;().configureEach {
    jvmArgs(&quot;--enable-preview&quot;)
}

tasks.withType&lt;JavaExec&gt;().configureEach {
    jvmArgs(&quot;--enable-preview&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(JavaCompile).configureEach {
    options.compilerArgs += <span class="string"><span class="delimiter">&quot;</span><span class="content">--enable-preview</span><span class="delimiter">&quot;</span></span>
}

tasks.withType(Test).configureEach {
    jvmArgs += <span class="string"><span class="delimiter">&quot;</span><span class="content">--enable-preview</span><span class="delimiter">&quot;</span></span>
}

tasks.withType(JavaExec).configureEach {
    jvmArgs += <span class="string"><span class="delimiter">&quot;</span><span class="content">--enable-preview</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_jvm_lang"><a class="anchor" href="#sec:building_jvm_lang"></a><a class="link" href="#sec:building_jvm_lang">Building other JVM language projects</a></h4>
<div class="paragraph">
<p>If you want to leverage the multi language aspect of the JVM, most of what was described here will still apply.</p>
</div>
<div class="paragraph">
<p>Gradle itself provides <a href="#groovy_plugin">Groovy</a> and <a href="#scala_plugin">Scala</a> plugins.
The plugins automatically apply support for compiling Java code and can be further enhanced by combining them with the <code>java-library</code> plugin.</p>
</div>
<div class="sect4">
<h5 id="sub:compile_deps_jvm_lang"><a class="anchor" href="#sub:compile_deps_jvm_lang"></a><a class="link" href="#sub:compile_deps_jvm_lang">Compilation dependency between languages</a></h5>
<div class="paragraph">
<p>These plugins create a dependency between Groovy/Scala compilation and Java compilation (of source code in the <code>java</code> folder of a source set).
You can change this default behavior by adjusting the classpath of the involved compile tasks as shown in the following example:</p>
</div>
<div id="ex-changing-the-classpath-of-compile-tasks" class="exampleblock">
<div class="title">Example 23. <a href="#ex-changing-the-classpath-of-compile-tasks">Changing the classpath of compile tasks</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;AbstractCompile&gt;(&quot;compileGroovy&quot;) {
    // Groovy only needs the declared dependencies
    // (and not longer the output of compileJava)
    classpath = sourceSets.main.get().compileClasspath
}
tasks.named&lt;AbstractCompile&gt;(&quot;compileJava&quot;) {
    // Java also depends on the result of Groovy compilation
    // (which automatically makes it depend of compileGroovy)
    classpath += files(sourceSets.main.get().groovy.classesDirectory)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">compileGroovy</span><span class="delimiter">'</span></span>) {
    <span class="comment">// Groovy only needs the declared dependencies</span>
    <span class="comment">// (and not longer the output of compileJava)</span>
    classpath = sourceSets.main.compileClasspath
}
tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">compileJava</span><span class="delimiter">'</span></span>) {
    <span class="comment">// Java also depends on the result of Groovy compilation</span>
    <span class="comment">// (which automatically makes it depend of compileGroovy)</span>
    classpath += files(sourceSets.main.groovy.classesDirectory)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By setting the <code>compileGroovy</code> classpath to be only <code>sourceSets.main.compileClasspath</code>, we effectively remove the previous dependency on <code>compileJava</code> that was declared by having the classpath also take into consideration <code>sourceSets.main.java.classesDirectory</code></p>
</li>
<li>
<p>By adding <code>sourceSets.main.groovy.classesDirectory</code> to the <code>compileJava</code> <code>classpath</code>, we effectively declare a dependency on the <code>compileGroovy</code> task</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All of this is possible through the use of <a href="#lazy_configuration">directory properties</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="extra_language_support"><a class="anchor" href="#extra_language_support"></a><a class="link" href="#extra_language_support">Extra language support</a></h5>
<div class="paragraph">
<p>Beyond core Gradle, there are other <a href="https://plugins.gradle.org/search?term=jvm">great plugins</a> for more JVM languages!</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java_testing"><a class="anchor" href="#java_testing"></a><a class="link" href="#java_testing">Testing in Java &amp; JVM projects</a></h3>
<div class="paragraph">
<p>Testing on the JVM is a rich subject matter. There are many different testing libraries and frameworks, as well as many different types of test. All need to be part of the build, whether they are executed frequently or infrequently. This chapter is dedicated to explaining how Gradle handles differing requirements between and within builds, with significant coverage of how it integrates with the two most common testing frameworks: <a href="https://junit.org/">JUnit</a> and <a href="https://testng.org/">TestNG</a>.</p>
</div>
<div class="paragraph">
<p>It explains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ways to control how the tests are run (<a href="#sec:test_execution">Test execution</a>)</p>
</li>
<li>
<p>How to select specific tests to run (<a href="#test_filtering">Test filtering</a>)</p>
</li>
<li>
<p>What test reports are generated and how to influence the process (<a href="#test_reporting">Test reporting</a>)</p>
</li>
<li>
<p>How Gradle finds tests to run (<a href="#sec:test_detection">Test detection</a>)</p>
</li>
<li>
<p>How to make use of the major frameworks' mechanisms for grouping tests together (<a href="#test_grouping">Test grouping</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But first, let&#8217;s look at the basics of JVM testing in Gradle.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A new configuration DSL for modeling test execution phases is available via the incubating <a href="jvm_test_suite_plugin.html#jvm_test_suite_plugin">JVM Test Suite</a> plugin.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sec:java_testing_basics"><a class="anchor" href="#sec:java_testing_basics"></a><a class="link" href="#sec:java_testing_basics">The basics</a></h4>
<div class="paragraph">
<p>All JVM testing revolves around a single task type: <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html">Test</a>. This runs a collection of test cases using any supported test library — JUnit, JUnit Platform or TestNG — and collates the results. You can then turn those results into a report via an instance of the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.TestReport.html">TestReport</a> task type.</p>
</div>
<div class="paragraph">
<p>In order to operate, the <code>Test</code> task type requires just two pieces of information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Where to find the compiled test classes (property: <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:testClassesDirs">Test.getTestClassesDirs()</a>)</p>
</li>
<li>
<p>The execution classpath, which should include the classes under test as well as the test library that you&#8217;re using (property: <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:classpath">Test.getClasspath()</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you&#8217;re using a JVM language plugin — such as the <a href="java_plugin.html#java_plugin">Java Plugin</a> — you will automatically get the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A dedicated <code>test</code> source set for unit tests</p>
</li>
<li>
<p>A <code>test</code> task of type <code>Test</code> that runs those unit tests</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The JVM language plugins use the source set to configure the task with the appropriate execution classpath and the directory containing the compiled test classes. In addition, they attach the <code>test</code> task to the <code>check</code> <a href="organizing_tasks.html#sec:lifecycle_tasks">lifecycle task</a>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s also worth bearing in mind that the <code>test</code> source set automatically creates <a href="java_plugin.html#java_source_set_configurations">corresponding dependency configurations</a> — of which the most useful are <code>testImplementation</code> and <code>testRuntimeOnly</code> — that the plugins tie into the <code>test</code> task&#8217;s classpath.</p>
</div>
<div class="paragraph">
<p>All you need to do in most cases is configure the appropriate compilation and runtime dependencies and add any necessary configuration to the <code>test</code> task. The following example shows a simple setup that uses JUnit Platform and changes the maximum heap size for the tests' JVM to 1 gigabyte:</p>
</div>
<div id="ex-a-basic-configuration-for-the-test-task" class="exampleblock">
<div class="title">Example 24. <a href="#ex-a-basic-configuration-for-the-test-task">A basic configuration for the 'test' task</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;org.junit.jupiter:junit-jupiter:5.7.1&quot;)
    testRuntimeOnly(&quot;org.junit.platform:junit-platform-launcher&quot;)
}

tasks.named&lt;Test&gt;(&quot;test&quot;) {
    useJUnitPlatform()

    maxHeapSize = &quot;1G&quot;

    testLogging {
        events(&quot;passed&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.junit.jupiter:junit-jupiter:5.7.1</span><span class="delimiter">'</span></span>
    testRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.platform:junit-platform-launcher</span><span class="delimiter">'</span></span>
}

tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>, Test) {
    useJUnitPlatform()

    maxHeapSize = <span class="string"><span class="delimiter">'</span><span class="content">1G</span><span class="delimiter">'</span></span>

    testLogging {
        events <span class="string"><span class="delimiter">&quot;</span><span class="content">passed</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html">Test</a> task has many generic configuration options as well as several framework-specific ones that you can find described in <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/junit/JUnitOptions.html">JUnitOptions</a>, <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/junitplatform/JUnitPlatformOptions.html">JUnitPlatformOptions</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/testng/TestNGOptions.html">TestNGOptions</a>. We cover a significant number of them in the rest of the chapter.</p>
</div>
<div class="paragraph">
<p>If you want to set up your own <code>Test</code> task with its own set of test classes, then the easiest approach is to create your own source set and <code>Test</code> task instance, as shown in <a href="#sec:configuring_java_integration_tests">Configuring integration tests</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:test_execution"><a class="anchor" href="#sec:test_execution"></a><a class="link" href="#sec:test_execution">Test execution</a></h4>
<div class="paragraph">
<p>Gradle executes tests in a separate ('forked') JVM, isolated from the main build process. This prevents classpath pollution and excessive memory consumption for the build process. It also allows you to run the tests with different JVM arguments than the build is using.</p>
</div>
<div class="paragraph">
<p>You can control how the test process is launched via several properties on the <code>Test</code> task, including the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>maxParallelForks</code> — default: 1</dt>
<dd>
<p>You can run your tests in parallel by setting this property to a value greater than 1. This may make your test suites complete faster, particularly if you run them on a multi-core CPU. When using parallel test execution, make sure your tests are properly isolated from one another. Tests that interact with the filesystem are particularly prone to conflict, causing intermittent test failures.</p>
<div class="paragraph">
<p>Your tests can distinguish between parallel test processes by using the value of the <code>org.gradle.test.worker</code> property, which is unique for each process. You can use this for anything you want, but it&#8217;s particularly useful for filenames and other resource identifiers to prevent the kind of conflict we just mentioned.</p>
</div>
</dd>
<dt class="hdlist1"><code>forkEvery</code> — default: 0 (no maximum)</dt>
<dd>
<p>This property specifies the maximum number of test classes that Gradle should run on a test process before its disposed of and a fresh one created. This is mainly used as a way to manage leaky tests or frameworks that have static state that can&#8217;t be cleared or reset between tests.</p>
<div class="paragraph">
<p><strong>Warning: a low value (other than 0) can severely hurt the performance of the tests</strong></p>
</div>
</dd>
<dt class="hdlist1"><code>ignoreFailures</code> — default: false</dt>
<dd>
<p>If this property is <code>true</code>, Gradle will continue with the project&#8217;s build once the tests have completed, even if some of them have failed. Note that, by default, the <code>Test</code> task always executes every test that it detects, irrespective of this setting.</p>
</dd>
<dt class="hdlist1"><code>failFast</code> —  (since Gradle 4.6) default: false</dt>
<dd>
<p>Set this to <code>true</code> if you want the build to fail and finish as soon as one of your tests fails. This can save a lot of time when you have a long-running test suite and is particularly useful when running the build on continuous integration servers. When a build fails before all tests have run, the test reports only include the results of the tests that have completed, successfully or not.</p>
<div class="paragraph">
<p>You can also enable this behavior by using the <code>--fail-fast</code> command line option, or disable it respectively with <code>--no-fail-fast</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>testLogging</code> — default: <em>not set</em></dt>
<dd>
<p>This property represents a set of options that control which test events are logged and at what level. You can also configure other logging behavior via this property. See <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/logging/TestLoggingContainer.html">TestLoggingContainer</a> for more detail.</p>
</dd>
<dt class="hdlist1"><code>dryRun</code> — default: false</dt>
<dd>
<p>If this property is <code>true</code>, Gradle will simulate the execution of the tests without actually running them. This will still generate reports, allowing for inspection of what tests were selected. This can be used to verify that your test filtering configuration is correct without actually running the tests.</p>
<div class="paragraph">
<p>You can also enable this behavior by using the <code>--test-dry-run</code> command-line option, or disable it respectively with <code>--no-test-dry-run</code>.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html">Test</a> for details on all the available configuration options.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The test process can exit unexpectedly if configured incorrectly. For instance, if the Java executable does not exist or an invalid JVM argument is provided, the test process will fail to start. Similarly, if a test makes programmatic changes to the test process, this can also cause unexpected failures.</p>
</div>
<div class="paragraph">
<p>For example, issues may occur if a <code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/SecurityManager.html">SecurityManager</a></code> is modified in a test because
Gradle&#8217;s internal messaging depends on reflection and socket communication, which may be disrupted if the permissions on the security manager change. In this particular case, you should restore the original <code>SecurityManager</code> after the test so that the
gradle test worker process can continue to function.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="test_filtering"><a class="anchor" href="#test_filtering"></a><a class="link" href="#test_filtering">Test filtering</a></h4>
<div class="paragraph">
<p>It&#8217;s a common requirement to run subsets of a test suite, such as when you&#8217;re fixing a bug or developing a new test case. Gradle provides two mechanisms to do this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Filtering (the preferred option)</p>
</li>
<li>
<p>Test inclusion/exclusion</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Filtering supersedes the inclusion/exclusion mechanism, but you may still come across the latter in the wild.</p>
</div>
<div class="paragraph">
<p>With Gradle&#8217;s test filtering you can select tests to run based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A fully-qualified class name or fully qualified method name, e.g. <code>org.gradle.SomeTest</code>, <code>org.gradle.SomeTest.someMethod</code></p>
</li>
<li>
<p>A simple class name or method name if the pattern starts with an upper-case letter, e.g. <code>SomeTest</code>, <code>SomeTest.someMethod</code> (since Gradle 4.7)</p>
</li>
<li>
<p>'*' wildcard matching</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can enable filtering either in the build script or via the <code>--tests</code> command-line option. Here&#8217;s an example of some filters that are applied every time the build runs:</p>
</div>
<div id="ex-filtering-tests-in-the-build-script" class="exampleblock">
<div class="title">Example 25. <a href="#ex-filtering-tests-in-the-build-script">Filtering tests in the build script</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    filter {
        //include specific method in any of the tests
        includeTestsMatching(&quot;*UiCheck&quot;)

        //include all tests from package
        includeTestsMatching(&quot;org.gradle.internal.*&quot;)

        //include all integration tests
        includeTestsMatching(&quot;*IntegTest&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    filter {
        <span class="comment">//include specific method in any of the tests</span>
        includeTestsMatching <span class="string"><span class="delimiter">&quot;</span><span class="content">*UiCheck</span><span class="delimiter">&quot;</span></span>

        <span class="comment">//include all tests from package</span>
        includeTestsMatching <span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.internal.*</span><span class="delimiter">&quot;</span></span>

        <span class="comment">//include all integration tests</span>
        includeTestsMatching <span class="string"><span class="delimiter">&quot;</span><span class="content">*IntegTest</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more details and examples of declaring filters in the build script, please see the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/TestFilter.html">TestFilter</a> reference.</p>
</div>
<div class="paragraph">
<p>The command-line option is especially useful to execute a single test method. When you use <code>--tests</code>, be aware that the inclusions declared in the build script are still honored. It is also possible to supply multiple <code>--tests</code> options, all of whose patterns will take effect. The following sections have several examples of using the command-line option.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Not all test frameworks play well with filtering. Some advanced, synthetic tests may not be fully compatible.
However, the vast majority of tests and use cases work perfectly well with Gradle&#8217;s filtering mechanism.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following two sections look at the specific cases of simple class/method names and fully-qualified names.</p>
</div>
<div class="sect4">
<h5 id="simple_name_pattern"><a class="anchor" href="#simple_name_pattern"></a><a class="link" href="#simple_name_pattern">Simple name pattern</a></h5>
<div class="paragraph">
<p>Since 4.7, Gradle has treated a pattern starting with an uppercase letter as a simple class name, or a class name + method name. For example, the following command lines run either all or exactly one of the tests in the <code>SomeTestClass</code> test case, regardless of what  package it&#8217;s in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Executes all tests in SomeTestClass
gradle test --tests SomeTestClass

# Executes a single specified test in SomeTestClass
gradle test --tests SomeTestClass.someSpecificMethod

gradle test --tests SomeTestClass.*someMethod*</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="full_qualified_name_pattern"><a class="anchor" href="#full_qualified_name_pattern"></a><a class="link" href="#full_qualified_name_pattern">Fully-qualified name pattern</a></h5>
<div class="paragraph">
<p>Prior to 4.7 or if the pattern doesn&#8217;t start with an uppercase letter, Gradle treats the pattern as fully-qualified. So if you want to use the test class name irrespective of its package, you would use <code>--tests *.SomeTestClass</code>. Here are some more examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># specific class
gradle test --tests org.gradle.SomeTestClass

# specific class and method
gradle test --tests org.gradle.SomeTestClass.someSpecificMethod

# method name containing spaces
gradle test --tests &quot;org.gradle.SomeTestClass.some method containing spaces&quot;

# all classes at specific package (recursively)
gradle test --tests 'all.in.specific.package*'

# specific method at specific package (recursively)
gradle test --tests 'all.in.specific.package*.someSpecificMethod'

gradle test --tests '*IntegTest'

gradle test --tests '*IntegTest*ui*'

gradle test --tests '*ParameterizedTest.foo*'

# the second iteration of a parameterized test
gradle test --tests '*ParameterizedTest.*[2]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the wildcard '*' has no special understanding of the '.' package separator. It&#8217;s purely text based. So <code>--tests *.SomeTestClass</code> will match any package, regardless of its 'depth'.</p>
</div>
<div class="paragraph">
<p>You can also combine filters defined at the command line with <a href="#sec:continuous_build">continuous build</a> to re-execute a subset of tests immediately after every change to a production or test source file. The following executes all tests in the 'com.mypackage.foo' package or subpackages whenever a change triggers the tests to run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>gradle test --continuous --tests &quot;com.mypackage.foo.*&quot;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="test_reporting"><a class="anchor" href="#test_reporting"></a><a class="link" href="#test_reporting">Test reporting</a></h4>
<div class="paragraph">
<p>The <code>Test</code> task generates the following results by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An HTML test report</p>
</li>
<li>
<p>XML test results in a format compatible with the Ant JUnit report task — one that is supported by many other tools, such as CI servers</p>
</li>
<li>
<p>An efficient binary format of the results used by the <code>Test</code> task to generate the other formats</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In most cases, you&#8217;ll work with the standard HTML report, which automatically includes the results from <em>all</em> your <code>Test</code> tasks, even the ones you explicitly add to the build yourself. For example, if you add a <code>Test</code> task for integration tests, the report will include the results of both the unit tests and the integration tests if both tasks are run.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To aggregate test results across multiple subprojects, see the <a href="test_report_aggregation_plugin.html#test_report_aggregation_plugin">Test Report Aggregation Plugin</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unlike with many of the testing configuration options, there are several project-level <a href="java_plugin.html#sec:java_convention_properties">convention properties that affect the test reports</a>. For example, you can change the destination of the test results and reports like so:</p>
</div>
<div id="ex-changing-the-default-test-report-and-results-directories" class="exampleblock">
<div class="title">Example 26. <a href="#ex-changing-the-default-test-report-and-results-directories">Changing the default test report and results directories</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">reporting.baseDir = file(&quot;my-reports&quot;)
java.testResultsDir = layout.buildDirectory.dir(&quot;my-test-results&quot;)

tasks.register(&quot;showDirs&quot;) {
    val rootDir = project.rootDir
    val reportsDir = project.reporting.baseDirectory
    val testResultsDir = project.java.testResultsDir

    doLast {
        logger.quiet(rootDir.toPath().relativize(reportsDir.get().asFile.toPath()).toString())
        logger.quiet(rootDir.toPath().relativize(testResultsDir.get().asFile.toPath()).toString())
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">reporting.baseDir = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-reports</span><span class="delimiter">&quot;</span></span>
java.testResultsDir = layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-test-results</span><span class="delimiter">&quot;</span></span>)

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">showDirs</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> rootDir = project.rootDir
    <span class="keyword">def</span> reportsDir = project.reporting.baseDirectory
    <span class="keyword">def</span> testResultsDir = project.java.testResultsDir

    doLast {
        logger.quiet(rootDir.toPath().relativize(reportsDir.get().asFile.toPath()).toString())
        logger.quiet(rootDir.toPath().relativize(testResultsDir.get().asFile.toPath()).toString())
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q showDirs</code></strong></div>
<div class="content">
<pre>&gt; gradle -q showDirs
my-reports
build/my-test-results</pre>
</div>
</div>
<div class="paragraph">
<p>Follow the link to the convention properties for more details.</p>
</div>
<div class="paragraph">
<p>There is also a standalone <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.TestReport.html">TestReport</a> task type that you can use to generate a custom HTML test report. All it requires are a value for <code>destinationDir</code> and the test results you want included in the report. Here is a sample which generates a combined report for the unit tests from all subprojects:</p>
</div>
<div id="ex-creating-a-unit-test-report-for-subprojects" class="exampleblock">
<div class="title">Example 27. <a href="#ex-creating-a-unit-test-report-for-subprojects">Creating a unit test report for subprojects</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/myproject.java-conventions.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;java&quot;)
}

// Disable the test report for the individual test task
tasks.named&lt;Test&gt;(&quot;test&quot;) {
    reports.html.required = false
}

// Share the test report data to be aggregated for the whole project
configurations.create(&quot;binaryTestResultsElements&quot;) {
    isCanBeResolved = false
    isCanBeConsumed = true
    attributes {
        attribute(Category.CATEGORY_ATTRIBUTE, objects.named(Category.DOCUMENTATION))
        attribute(DocsType.DOCS_TYPE_ATTRIBUTE, objects.named(&quot;test-report-data&quot;))
    }
    outgoing.artifact(tasks.test.map { task -&gt; task.getBinaryResultsDirectory().get() })
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val testReportData by configurations.creating {
    isCanBeConsumed = false
    attributes {
        attribute(Category.CATEGORY_ATTRIBUTE, objects.named(Category.DOCUMENTATION))
        attribute(DocsType.DOCS_TYPE_ATTRIBUTE, objects.named(&quot;test-report-data&quot;))
    }
}

dependencies {
    testReportData(project(&quot;:core&quot;))
    testReportData(project(&quot;:util&quot;))
}

tasks.register&lt;TestReport&gt;(&quot;testReport&quot;) {
    destinationDirectory = reporting.baseDirectory.dir(&quot;allTests&quot;)
    // Use test results from testReportData configuration
    testResults.from(testReportData)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/myproject.java-conventions.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

<span class="comment">// Disable the test report for the individual test task</span>
test {
    reports.html.required = <span class="predefined-constant">false</span>
}

<span class="comment">// Share the test report data to be aggregated for the whole project</span>
configurations {
    binaryTestResultsElements {
        canBeResolved = <span class="predefined-constant">false</span>
        canBeConsumed = <span class="predefined-constant">true</span>
        attributes {
            attribute(Category.CATEGORY_ATTRIBUTE, objects.named(Category, Category.DOCUMENTATION))
            attribute(DocsType.DOCS_TYPE_ATTRIBUTE, objects.named(DocsType, <span class="string"><span class="delimiter">'</span><span class="content">test-report-data</span><span class="delimiter">'</span></span>))
        }
        outgoing.artifact(test.binaryResultsDirectory)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// A resolvable configuration to collect test reports data</span>
configurations {
    testReportData {
        canBeConsumed = <span class="predefined-constant">false</span>
        attributes {
            attribute(Category.CATEGORY_ATTRIBUTE, objects.named(Category, Category.DOCUMENTATION))
            attribute(DocsType.DOCS_TYPE_ATTRIBUTE, objects.named(DocsType, <span class="string"><span class="delimiter">'</span><span class="content">test-report-data</span><span class="delimiter">'</span></span>))
        }
    }
}

dependencies {
    testReportData project(<span class="string"><span class="delimiter">'</span><span class="content">:core</span><span class="delimiter">'</span></span>)
    testReportData project(<span class="string"><span class="delimiter">'</span><span class="content">:util</span><span class="delimiter">'</span></span>)
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">testReport</span><span class="delimiter">'</span></span>, TestReport) {
    destinationDirectory = reporting.baseDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">allTests</span><span class="delimiter">'</span></span>)
    <span class="comment">// Use test results from testReportData configuration</span>
    testResults.from(configurations.testReportData)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, we use a convention plugin <code>myproject.java-conventions</code> to expose the test results from a project to Gradle&#8217;s <a href="#understanding-variant-selection">variant aware dependency management engine</a>.</p>
</div>
<div class="paragraph">
<p>The plugin declares a consumable <code>binaryTestResultsElements</code> configuration that represents the binary test results of the <code>test</code> task.
In the aggregation project&#8217;s build file, we declare the <code>testReportData</code> configuration and depend on all of the projects that we want to aggregate the results from. Gradle will automatically select the binary test result variant from each of the subprojects instead of the project&#8217;s jar file.
Lastly, we add a <code>testReport</code> task that aggregates the test results from the <code>testResultsDirs</code> property, which contains all of the binary test results resolved from the <code>testReportData</code> configuration.</p>
</div>
<div class="paragraph">
<p>You should note that the <code>TestReport</code> type combines the results from multiple test tasks and needs to aggregate the results of individual test classes. This means that if a given test class is executed by multiple test tasks, then the test report will include executions of that class, but it can be hard to distinguish individual executions of that class and their output.</p>
</div>
<div class="sect4">
<h5 id="communicating_test_results_to_CI_servers_and_other_tools_via_xml_files"><a class="anchor" href="#communicating_test_results_to_CI_servers_and_other_tools_via_xml_files"></a><a class="link" href="#communicating_test_results_to_CI_servers_and_other_tools_via_xml_files">Communicating test results to CI servers and other tools via XML files</a></h5>
<div class="paragraph">
<p>The Test tasks creates XML files describing the test results, in the “JUnit XML” pseudo standard.
This standard is used by the JUnit 4, JUnit Jupiter, and TestNG test frameworks, and is configured using the same DSL block for each of these.
It is common for CI servers and other tooling to observe test results via these XML files.</p>
</div>
<div class="paragraph">
<p>By default, the files are written to <code>layout.buildDirectory.dir("test-results/$testTaskName")</code> with a file per test class.
The location can be changed for all test tasks of a project, or individually per test task.</p>
</div>
<div id="ex-changing-junit-xml-results-location-for-all-test-tasks" class="exampleblock">
<div class="title">Example 28. <a href="#ex-changing-junit-xml-results-location-for-all-test-tasks">Changing JUnit XML results location for all test tasks</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java.testResultsDir = layout.buildDirectory.dir(&quot;junit-xml&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java.testResultsDir = layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">junit-xml</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the above configuration, the XML files will be written to <code>layout.buildDirectory.dir("junit-xml/$testTaskName")</code>.</p>
</div>
<div id="ex-changing-junit-xml-results-location-for-a-particular-test-task" class="exampleblock">
<div class="title">Example 29. <a href="#ex-changing-junit-xml-results-location-for-a-particular-test-task">Changing JUnit XML results location for a particular test task</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    reports {
        junitXml.outputLocation = layout.buildDirectory.dir(&quot;test-junit-xml&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    reports {
        junitXml.outputLocation = layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">test-junit-xml</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the above configuration, the XML files for the <code>test</code> task will be written to <code>layout.buildDirectory.dir("test-results/test-junit-xml")</code>.
The location of the XML files for other test tasks will be unchanged.</p>
</div>
<div class="sect5">
<h6 id="junit_xml_configuration"><a class="anchor" href="#junit_xml_configuration"></a><a class="link" href="#junit_xml_configuration">Configuration options</a></h6>
<div class="paragraph">
<p>The content of the XML files can also be configured to convey the results differently, by configuring the
<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/JUnitXmlReport.html">JUnitXmlReport</a> options.</p>
</div>
<div id="ex-configuring-how-the-results-are-conveyed" class="exampleblock">
<div class="title">Example 30. <a href="#ex-configuring-how-the-results-are-conveyed">Configuring how the results are conveyed</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    reports {
        junitXml.apply {
            includeSystemOutLog = false // defaults to true
            includeSystemErrLog = false // defaults to true
            isOutputPerTestCase = true // defaults to false
            mergeReruns = true // defaults to false
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    reports {
        junitXml {
            includeSystemOutLog = <span class="predefined-constant">false</span> <span class="comment">// defaults to true</span>
            includeSystemErrLog = <span class="predefined-constant">false</span> <span class="comment">// defaults to true</span>
            outputPerTestCase = <span class="predefined-constant">true</span> <span class="comment">// defaults to false</span>
            mergeReruns = <span class="predefined-constant">true</span> <span class="comment">// defaults to false</span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect6">
<h7 id="junit_xml_configuration_output_filtering"><a class="anchor" href="#junit_xml_configuration_output_filtering"></a><a class="link" href="#junit_xml_configuration_output_filtering">includeSystemOutLog &amp; includeSystemErrLog</a></h7>
<div class="paragraph">
<p>The <code>includeSystemOutLog</code> option allows configuring whether or not test output written to standard out is exported to the XML report file.
The <code>includeSystemErrLog</code> option allows configuring whether or not test error output written to standard error is exported to the XML report file.</p>
</div>
<div class="paragraph">
<p>These options affect both test-suite level output (such as <code>@BeforeClass</code>/<code>@BeforeAll</code> output) and test class and method-specific output (<code>@Before</code>/<code>@BeforeEach</code> and <code>@Test</code>).
If either option is disabled, the element that normally contains that content will be excluded from the XML report file.</p>
</div>
<div class="paragraph">
<p>The default for each option is <code>true</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="outputpertestcase"><a class="anchor" href="#outputpertestcase"></a><a class="link" href="#outputpertestcase">outputPerTestCase</a></h7>
<div class="paragraph">
<p>The <code>outputPerTestCase</code> option, when enabled, associates any output logging generated during a test case to that test case in the results.
When disabled (the default) output is associated with the test class as whole and not the individual test cases (e.g. test methods) that produced the logging output.
Most modern tools that observe JUnit XML files support the “output per test case” format.</p>
</div>
<div class="paragraph">
<p>If you are using the XML files to communicate test results, it is recommended to enable this option as it provides more useful reporting.</p>
</div>
</div>
<div class="sect6">
<h7 id="mergereruns"><a class="anchor" href="#mergereruns"></a><a class="link" href="#mergereruns">mergeReruns</a></h7>
<div class="paragraph">
<p>When <code>mergeReruns</code> is enabled, if a test fails but is then retried and succeeds, its failures will be recorded as <code>&lt;flakyFailure&gt;</code> instead of <code>&lt;failure&gt;</code>, within one <code>&lt;testcase&gt;</code>.
This is effectively the reporting produced by the <a href="https://maven.apache.org/components/surefire/maven-surefire-plugin/examples/rerun-failing-tests.html">surefire plugin of Apache Maven™</a> when enabling reruns.
If your CI server understands this format, it will indicate that the test was flaky.
If it does not, it will indicate that the test succeeded as it will ignore the <code>&lt;flakyFailure&gt;</code> information.
If the test does not succeed (i.e. it fails for every retry), it will be indicated as having failed whether your tool understands this format or not.</p>
</div>
<div class="paragraph">
<p>When <code>mergeReruns</code> is disabled (the default), each execution of a test will be listed as a separate test case.</p>
</div>
<div class="paragraph">
<p>If you are using <a href="https://scans.gradle.com">build scans</a> or <a href="https://gradle.com/gradle-enterprise-solution-overview/failure-analytics/">Develocity</a>,
flaky tests will be detected regardless of this setting.</p>
</div>
<div class="paragraph">
<p>Enabling this option is especially useful when using a CI tool that uses the XML test results to determine build failure instead of relying on Gradle&#8217;s determination of whether the build failed or not,
and you wish to not consider the build failed if all failed tests passed when retried.
This is the case for the Jenkins CI server and its <a href="https://plugins.jenkins.io/junit/">JUnit plugin</a>.
With <code>mergeReruns</code> enabled, tests that pass-on-retry will no longer cause this Jenkins plugin to consider the build to have failed.
However, failed test executions will be omitted from the Jenkins test result visualizations as it does not consider <code>&lt;flakyFailure&gt;</code> information.
The separate <a href="https://plugins.jenkins.io/flaky-test-handler">Flaky Test Handler Jenkins plugin</a> can be used in addition to the JUnit Jenkins plugin to have such “flaky failures” also be visualized.</p>
</div>
<div class="paragraph">
<p>Tests are grouped and merged based on their reported name.
When using any kind of test parameterization that affects the reported test name,
or any other kind of mechanism that produces a potentially dynamic test name,
care should be taken to ensure that the test name is stable and does not unnecessarily change.</p>
</div>
<div class="paragraph">
<p>Enabling the <code>mergeReruns</code> option does not add any retry/rerun functionality to test execution.
Rerunning can be enabled by the test execution framework (e.g. JUnit&#8217;s <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-repeated-tests">@RepeatedTest</a>),
or via the separate <a href="https://github.com/gradle/test-retry-gradle-plugin">Test Retry Gradle plugin</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:test_detection"><a class="anchor" href="#sec:test_detection"></a><a class="link" href="#sec:test_detection">Test detection</a></h4>
<div class="paragraph">
<p>By default, Gradle will run all tests that it detects, which it does by inspecting the compiled test classes. This detection uses different criteria depending on the test framework used.</p>
</div>
<div class="paragraph">
<p>For <em>JUnit</em>, Gradle scans for both JUnit 3 and 4 test classes. A class is considered to be a JUnit test if it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ultimately inherits from <code>TestCase</code> or <code>GroovyTestCase</code></p>
</li>
<li>
<p>Is annotated with <code>@RunWith</code></p>
</li>
<li>
<p>Contains a method annotated with <code>@Test</code> or a super class does</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For <em>TestNG</em>, Gradle scans for methods annotated with <code>@Test</code>.</p>
</div>
<div class="paragraph">
<p>Note that abstract classes are not executed. In addition, be aware that Gradle scans up the inheritance tree into jar files on the test classpath. So if those JARs contain test classes, they will also be run.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to use test class detection, you can disable it by setting the <code>scanForTestClasses</code> property on <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html">Test</a> to <code>false</code>. When you do that, the test task uses only the <code>includes</code> and <code>excludes</code> properties to find test classes.</p>
</div>
<div class="paragraph">
<p>If <code>scanForTestClasses</code> is false and no include or exclude patterns are specified, Gradle defaults to running any class that matches the patterns <code>**/*Tests.class</code> and <code>**/*Test.class</code>, excluding those that match <code>**/Abstract*.class</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
With <a href="http://junit.org/junit5/docs/current/user-guide">JUnit Platform</a>, only <code>includes</code> and <code>excludes</code> are used to filter test classes — <code>scanForTestClasses</code> has no effect.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:test_logging"><a class="anchor" href="#sec:test_logging"></a><a class="link" href="#sec:test_logging">Test logging</a></h4>
<div class="paragraph">
<p>Gradle allows fine-tuned control over events that are logged to the console.
Logging is configurable on a per-log-level basis and by default, the following events are logged:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the log level is</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Events that are logged</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ERROR</code>, <code>QUIET</code> or <code>WARNING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIFECYCLE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/logging/TestLogEvent.html#FAILED">Test failures</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exception format is <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/logging/TestExceptionFormat.html#SHORT">SHORT</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/logging/TestLogEvent.html#FAILED">Test failures</a>, <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/logging/TestLogEvent.html#SKIPPED">skipped tests</a>, <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/logging/TestLogEvent.html#STANDARD_OUT">test standard output</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/logging/TestLogEvent.html#STANDARD_ERROR">test standard error</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stacktraces are truncated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEBUG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/logging/TestLogEvent.html">All events</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full stacktraces are logged.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Test logging can be modified on a per-log-level basis by adjusting the appropriate <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/logging/TestLogging.html">TestLogging</a> instances in the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/AbstractTestTask.html#getTestLogging--">testLogging</a> property of the test task.
For example, to adjust the <code>INFO</code> level test logging configuration, modify the
<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/logging/TestLoggingContainer.html#getInfo--">TestLoggingContainer.getInfo()</a> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="test_grouping"><a class="anchor" href="#test_grouping"></a><a class="link" href="#test_grouping">Test grouping</a></h4>
<div class="paragraph">
<p>JUnit, JUnit Platform and TestNG allow sophisticated groupings of test methods.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This section applies to grouping individual test classes or methods within a collection of tests that serve the same testing purpose (unit tests, integration tests, acceptance tests, etc.).
For dividing test classes based upon their purpose, see the incubating <a href="jvm_test_suite_plugin.html#jvm_test_suite_plugin">JVM Test Suite</a> plugin.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>JUnit 4.8 introduced the concept of categories for grouping JUnit 4 tests classes and methods.<sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup> <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:useJUnit(org.gradle.api.Action)">Test.useJUnit(org.gradle.api.Action)</a> allows you to specify the JUnit categories you want to include and exclude. For example, the following configuration includes tests in <code>CategoryA</code> and excludes those in <code>CategoryB</code> for the <code>test</code> task:</p>
</div>
<div id="ex-junit-categories" class="exampleblock">
<div class="title">Example 31. <a href="#ex-junit-categories">JUnit Categories</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    useJUnit {
        includeCategories(&quot;org.gradle.junit.CategoryA&quot;)
        excludeCategories(&quot;org.gradle.junit.CategoryB&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    useJUnit {
        includeCategories <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.junit.CategoryA</span><span class="delimiter">'</span></span>
        excludeCategories <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.junit.CategoryB</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="http://junit.org/junit5/docs/current/user-guide">JUnit Platform</a> introduced <a href="http://junit.org/junit5/docs/current/user-guide/#writing-tests-tagging-and-filtering">tagging</a> to replace categories. You can specify the included/excluded tags via <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/Test.html#useJUnitPlatform-org.gradle.api.Action-">Test.useJUnitPlatform(org.gradle.api.Action)</a>, as follows:</p>
</div>
<div id="ex-junit-platform-tags" class="exampleblock">
<div class="title">Example 32. <a href="#ex-junit-platform-tags">JUnit Platform Tags</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;Test&gt;().configureEach {
    useJUnitPlatform {
        includeTags(&quot;fast&quot;)
        excludeTags(&quot;slow&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(Test).configureEach {
    useJUnitPlatform {
        includeTags <span class="string"><span class="delimiter">'</span><span class="content">fast</span><span class="delimiter">'</span></span>
        excludeTags <span class="string"><span class="delimiter">'</span><span class="content">slow</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The TestNG framework uses the concept of test groups for a similar effect.<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup> You can configure which test groups to include or exclude during the test execution via the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:useTestNG(org.gradle.api.Action)">Test.useTestNG(org.gradle.api.Action)</a> setting, as seen here:</p>
</div>
<div id="ex-grouping-testng-tests" class="exampleblock">
<div class="title">Example 33. <a href="#ex-grouping-testng-tests">Grouping TestNG tests</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;Test&gt;(&quot;test&quot;) {
    useTestNG {
        val options = this as TestNGOptions
        options.excludeGroups(&quot;integrationTests&quot;)
        options.includeGroups(&quot;unitTests&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    useTestNG {
        excludeGroups <span class="string"><span class="delimiter">'</span><span class="content">integrationTests</span><span class="delimiter">'</span></span>
        includeGroups <span class="string"><span class="delimiter">'</span><span class="content">unitTests</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using_junit5"><a class="anchor" href="#using_junit5"></a><a class="link" href="#using_junit5">Using JUnit 5</a></h4>
<div class="paragraph">
<p><a href="http://junit.org/junit5">JUnit 5</a> is the latest version of the well-known JUnit test framework.
Unlike its predecessor, JUnit 5 is modularized and composed of several modules:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>JUnit 5 = JUnit Platform + JUnit Jupiter + JUnit Vintage</pre>
</div>
</div>
<div class="paragraph">
<p>The JUnit Platform serves as a foundation for launching testing frameworks on the JVM. JUnit Jupiter is the combination of the new <a href="http://junit.org/junit5/docs/current/user-guide/#writing-tests">programming model</a>
 and <a href="http://junit.org/junit5/docs/current/user-guide/#extensions">extension model</a> for writing tests and extensions in JUnit 5. JUnit Vintage provides a <code>TestEngine</code> for running JUnit 3 and JUnit 4 based tests on the platform.</p>
</div>
<div class="paragraph">
<p>The following code enables JUnit Platform support in <code>build.gradle</code>:</p>
</div>
<div id="ex-enabling-junit-platform-to-run-your-tests" class="exampleblock">
<div class="title">Example 34. <a href="#ex-enabling-junit-platform-to-run-your-tests">Enabling JUnit Platform to run your tests</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;Test&gt;(&quot;test&quot;) {
    useJUnitPlatform()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>, Test) {
    useJUnitPlatform()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/Test.html#useJUnitPlatform--">Test.useJUnitPlatform()</a> for more details.</p>
</div>
<div class="sect4">
<h5 id="compiling_and_executing_junit_jupiter_tests"><a class="anchor" href="#compiling_and_executing_junit_jupiter_tests"></a><a class="link" href="#compiling_and_executing_junit_jupiter_tests">Compiling and executing JUnit Jupiter tests</a></h5>
<div class="paragraph">
<p>To enable JUnit Jupiter support in Gradle, all you need to do is add the following dependency:</p>
</div>
<div id="ex-junit-jupiter-dependencies" class="exampleblock">
<div class="title">Example 35. <a href="#ex-junit-jupiter-dependencies">JUnit Jupiter dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;org.junit.jupiter:junit-jupiter:5.7.1&quot;)
    testRuntimeOnly(&quot;org.junit.platform:junit-platform-launcher&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.junit.jupiter:junit-jupiter:5.7.1</span><span class="delimiter">'</span></span>
    testRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.platform:junit-platform-launcher</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can then put your test cases into <em>src/test/java</em> as normal and execute them with <code>gradle test</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="executing_legacy_tests_with_junit_vintage"><a class="anchor" href="#executing_legacy_tests_with_junit_vintage"></a><a class="link" href="#executing_legacy_tests_with_junit_vintage">Executing legacy tests with JUnit Vintage</a></h5>
<div class="paragraph">
<p>If you want to run JUnit 3/4 tests on JUnit Platform, or even mix them with Jupiter tests, you should add extra JUnit Vintage Engine dependencies:</p>
</div>
<div id="ex-junit-vintage-dependencies" class="exampleblock">
<div class="title">Example 36. <a href="#ex-junit-vintage-dependencies">JUnit Vintage dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;org.junit.jupiter:junit-jupiter:5.7.1&quot;)
    testCompileOnly(&quot;junit:junit:4.13&quot;)
    testRuntimeOnly(&quot;org.junit.vintage:junit-vintage-engine&quot;)
    testRuntimeOnly(&quot;org.junit.platform:junit-platform-launcher&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.junit.jupiter:junit-jupiter:5.7.1</span><span class="delimiter">'</span></span>
    testCompileOnly <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.13</span><span class="delimiter">'</span></span>
    testRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.vintage:junit-vintage-engine</span><span class="delimiter">'</span></span>
    testRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.platform:junit-platform-launcher</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this way, you can use <code>gradle test</code> to test JUnit 3/4 tests on JUnit Platform, without the need to rewrite them.</p>
</div>
</div>
<div class="sect4">
<h5 id="filtering_test_engine"><a class="anchor" href="#filtering_test_engine"></a><a class="link" href="#filtering_test_engine">Filtering test engine</a></h5>
<div class="paragraph">
<p>JUnit Platform allows you to use different test engines. JUnit currently provides two <code>TestEngine</code> implementations out of the box:
<a href="https://junit.org/junit5/docs/current/api/org.junit.jupiter.engine/module-summary.html">junit-jupiter-engine</a> and <a href="https://junit.org/junit5/docs/current/api/org.junit.vintage.engine/module-summary.html">junit-vintage-engine</a>.
You can also write and plug in your own <code>TestEngine</code> implementation as documented <a href="https://junit.org/junit5/docs/current/user-guide/#launcher-api-engines-custom">here</a>.</p>
</div>
<div class="paragraph">
<p>By default, all test engines on the test runtime classpath will be used.
To control specific test engine implementations explicitly, you can add the following setting to your build script:</p>
</div>
<div id="ex-filter-specific-engines" class="exampleblock">
<div class="title">Example 37. <a href="#ex-filter-specific-engines">Filter specific engines</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;Test&gt;().configureEach {
    useJUnitPlatform {
        includeEngines(&quot;junit-vintage&quot;)
        // excludeEngines(&quot;junit-jupiter&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(Test).configureEach {
    useJUnitPlatform {
        includeEngines <span class="string"><span class="delimiter">'</span><span class="content">junit-vintage</span><span class="delimiter">'</span></span>
        <span class="comment">// excludeEngines 'junit-jupiter'</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="test_execution_order"><a class="anchor" href="#test_execution_order"></a><a class="link" href="#test_execution_order">Test execution order in TestNG</a></h4>
<div class="paragraph">
<p>TestNG allows explicit control of the execution order of tests when you use a <em>testng.xml</em> file. Without such a file — or an equivalent one configured by <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/testng/TestNGOptions.html#getSuiteXmlBuilder--">TestNGOptions.getSuiteXmlBuilder()</a> — you can&#8217;t specify the test execution order. However, what you <em>can</em> do is control whether all aspects of a test — including its associated <code>@BeforeXXX</code> and <code>@AfterXXX</code> methods, such as those annotated with <code>@Before/AfterClass</code> and <code>@Before/AfterMethod</code> — are executed before the next test starts. You do this by setting the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/testing/testng/TestNGOptions.html#getPreserveOrder--">TestNGOptions.getPreserveOrder()</a> property to <code>true</code>. If you set it to <code>false</code>, you may encounter scenarios in which the execution order is something like: <code>TestA.doBeforeClass()</code> &#8594; <code>TestB.doBeforeClass()</code> &#8594; <code>TestA</code> tests.</p>
</div>
<div class="paragraph">
<p>While preserving the order of tests is the default behavior when directly working with <em>testng.xml</em> files, the <a href="https://jitpack.io/com/github/cbeust/testng/master/javadoc/org/testng/TestNG.html">TestNG API</a> that is used by Gradle&#8217;s TestNG integration executes tests in unpredictable order by default.<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup> The ability to preserve test execution order was introduced with TestNG version 5.14.5. Setting the <code>preserveOrder</code> property to <code>true</code> for an older TestNG version will cause the build to fail.</p>
</div>
<div id="ex-preserving-order-of-testng-tests" class="exampleblock">
<div class="title">Example 38. <a href="#ex-preserving-order-of-testng-tests">Preserving order of TestNG tests</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    useTestNG {
        preserveOrder = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    useTestNG {
        preserveOrder <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>groupByInstance</code> property controls whether tests should be grouped by instance rather than by class. The <a href="http://testng.org/doc/documentation-main.html#dependencies-with-annotations">TestNG documentation</a> explains the difference in more detail, but essentially, if you have a test method <code>A()</code> that depends on <code>B()</code>, grouping by instance ensures that each A-B pairing, e.g. <code>B(1)</code>-<code>A(1)</code>, is executed before the next pairing. With group by class, all <code>B()</code> methods are run and then all <code>A()</code> ones.</p>
</div>
<div class="paragraph">
<p>Note that you typically only have more than one instance of a test if you&#8217;re using a data provider to parameterize it. Also, grouping tests by instances was introduced with TestNG version 6.1. Setting the <code>groupByInstances</code> property to <code>true</code> for an older TestNG version will cause the build to fail.</p>
</div>
<div id="ex-grouping-testng-tests-by-instances" class="exampleblock">
<div class="title">Example 39. <a href="#ex-grouping-testng-tests-by-instances">Grouping TestNG tests by instances</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    useTestNG {
        groupByInstances = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    useTestNG {
        groupByInstances = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="testNgParameterizedReporting"><a class="anchor" href="#testNgParameterizedReporting"></a><a class="link" href="#testNgParameterizedReporting">TestNG parameterized methods and reporting</a></h5>
<div class="paragraph">
<p>TestNG supports <a href="http://testng.org/doc/documentation-main.html#parameters">parameterizing test methods</a>, allowing a particular test method to be executed multiple times with different inputs. Gradle includes the parameter values in its reporting of the test method execution.</p>
</div>
<div class="paragraph">
<p>Given a parameterized test method named <code>aTestMethod</code> that takes two parameters, it will be reported with the name <code>aTestMethod(toStringValueOfParam1, toStringValueOfParam2)</code>. This makes it easy to identify the parameter values for a particular iteration.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuring_java_integration_tests"><a class="anchor" href="#sec:configuring_java_integration_tests"></a><a class="link" href="#sec:configuring_java_integration_tests">Configuring integration tests</a></h4>
<div class="paragraph">
<p>A common requirement for projects is to incorporate integration tests in one form or another.
Their aim is to verify that the various parts of the project are working together properly.
This often means that they require special execution setup and dependencies compared to unit tests.</p>
</div>
<div class="paragraph">
<p>The simplest way to add integration tests to your build is by leveraging the incubating <a href="jvm_test_suite_plugin.html#jvm_test_suite_plugin">JVM Test Suite</a> plugin.
If an incubating solution is not something for you, here are the steps you need to take in your build:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new <a href="#sec:java_source_sets">source set</a> for them</p>
</li>
<li>
<p>Add the dependencies you need to the appropriate configurations for that source set</p>
</li>
<li>
<p>Configure the compilation and runtime classpaths for that source set</p>
</li>
<li>
<p>Create a task to run the integration tests</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You may also need to perform some additional configuration depending on what form the integration tests take. We will discuss those as we go.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a practical example that implements the first three steps in a build script, centered around a new source set <code>intTest</code>:</p>
</div>
<div id="ex-setting-up-working-integration-tests" class="exampleblock">
<div class="title">Example 40. <a href="#ex-setting-up-working-integration-tests">Setting up working integration tests</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    create(&quot;intTest&quot;) {
        compileClasspath += sourceSets.main.get().output
        runtimeClasspath += sourceSets.main.get().output
    }
}

val intTestImplementation by configurations.getting {
    extendsFrom(configurations.implementation.get())
}
val intTestRuntimeOnly by configurations.getting

configurations[&quot;intTestRuntimeOnly&quot;].extendsFrom(configurations.runtimeOnly.get())

dependencies {
    intTestImplementation(&quot;org.junit.jupiter:junit-jupiter:5.7.1&quot;)
    intTestRuntimeOnly(&quot;org.junit.platform:junit-platform-launcher&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    intTest {
        compileClasspath += sourceSets.main.output
        runtimeClasspath += sourceSets.main.output
    }
}

configurations {
    intTestImplementation.extendsFrom implementation
    intTestRuntimeOnly.extendsFrom runtimeOnly
}

dependencies {
    intTestImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.junit.jupiter:junit-jupiter:5.7.1</span><span class="delimiter">'</span></span>
    intTestRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.platform:junit-platform-launcher</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will set up a new source set called <code>intTest</code> that automatically creates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>intTestImplementation</code>, <code>intTestCompileOnly</code>, <code>intTestRuntimeOnly</code> configurations (and <a href="java_plugin.html#java_source_set_configurations">a few others</a> that are less commonly needed)</p>
</li>
<li>
<p>A <code>compileIntTestJava</code> task that will compile all the source files under <em>src/intTest/java</em></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are working with the IntelliJ IDE, you may wish to flag the directories in these additional source sets as containing test source rather than production source as explained in the <a href="idea_plugin.html#sec:idea_identify_additional_source_sets">Idea Plugin</a> documentation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example also does the following, not all of which you may need for your specific integration tests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adds the production classes from the <code>main</code> source set to the compilation and runtime classpaths of the integration tests — <code>sourceSets.main.output</code> is a <a href="#sec:file_collections">file collection</a> of all the directories containing compiled production classes and resources</p>
</li>
<li>
<p>Makes the <code>intTestImplementation</code> configuration extend from <code>implementation</code>, which means that all the declared dependencies of the production code also become dependencies of the integration tests</p>
</li>
<li>
<p>Does the same for the <code>intTestRuntimeOnly</code> configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In most cases, you want your integration tests to have access to the classes under test, which is why we ensure that those are included on the compilation and runtime classpaths in this example. But some types of test interact with the production code in a different way. For example, you may have tests that run your application as an executable and verify the output. In the case of web applications, the tests may interact with your application via HTTP. Since the tests don&#8217;t need direct access to the classes under test in such cases, you don&#8217;t need to add the production classes to the test classpath.</p>
</div>
<div class="paragraph">
<p>Another common step is to attach all the unit test dependencies to the integration tests as well — via <code>intTestImplementation.extendsFrom testImplementation</code> — but that only makes sense if the integration tests require <em>all</em> or nearly all the same dependencies that the unit tests have.</p>
</div>
<div class="paragraph">
<p>There are a couple of other facets of the example you should take note of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>+=</code> allows you to append paths and collections of paths to <code>compileClasspath</code> and <code>runtimeClasspath</code> instead of overwriting them</p>
</li>
<li>
<p>If you want to use the convention-based configurations, such as <code>intTestImplementation</code>, you <em>must</em> declare the dependencies <em>after</em> the new source set</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Creating and configuring a source set automatically sets up the compilation stage, but it does nothing with respect to running the integration tests. So the last piece of the puzzle is a custom test task that uses the information from the new source set to configure its runtime classpath and the test classes:</p>
</div>
<div id="ex-defining-a-working-integration-test-task" class="exampleblock">
<div class="title">Example 41. <a href="#ex-defining-a-working-integration-test-task">Defining a working integration test task</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val integrationTest = task&lt;Test&gt;(&quot;integrationTest&quot;) {
    description = &quot;Runs integration tests.&quot;
    group = &quot;verification&quot;

    testClassesDirs = sourceSets[&quot;intTest&quot;].output.classesDirs
    classpath = sourceSets[&quot;intTest&quot;].runtimeClasspath
    shouldRunAfter(&quot;test&quot;)

    useJUnitPlatform()

    testLogging {
        events(&quot;passed&quot;)
    }
}

tasks.check { dependsOn(integrationTest) }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">integrationTest</span><span class="delimiter">'</span></span>, Test) {
    description = <span class="string"><span class="delimiter">'</span><span class="content">Runs integration tests.</span><span class="delimiter">'</span></span>
    group = <span class="string"><span class="delimiter">'</span><span class="content">verification</span><span class="delimiter">'</span></span>

    testClassesDirs = sourceSets.intTest.output.classesDirs
    classpath = sourceSets.intTest.runtimeClasspath
    shouldRunAfter test

    useJUnitPlatform()

    testLogging {
        events <span class="string"><span class="delimiter">&quot;</span><span class="content">passed</span><span class="delimiter">&quot;</span></span>
    }
}

check.dependsOn integrationTest</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Again, we&#8217;re accessing a source set to get the relevant information, i.e. where the compiled test classes are — the <code>testClassesDirs</code> property — and what needs to be on the classpath when running them — <code>classpath</code>.</p>
</div>
<div class="paragraph">
<p>Users commonly want to run integration tests after the unit tests, because they are often slower to run and you want the build to fail early on the unit tests rather than later on the integration tests. That&#8217;s why the above example adds a <code>shouldRunAfter()</code> declaration. This is preferred over <code>mustRunAfter()</code> so that Gradle has more flexibility in executing the build in parallel.</p>
</div>
<div class="paragraph">
<p>For information on how to determine code coverage for tests in additional source sets, see the <a href="jacoco_plugin.html#jacoco_plugin">JaCoCo Plugin</a> and the <a href="jacoco_report_aggregation_plugin.html#jacoco_report_aggregation_plugin">JaCoCo Report Aggregation Plugin</a> chapters.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_testing_modular"><a class="anchor" href="#sec:java_testing_modular"></a><a class="link" href="#sec:java_testing_modular">Testing Java Modules</a></h4>
<div class="paragraph">
<p>If you are <a href="#java_library_plugin">developing Java Modules</a>, everything described in this chapter still applies and any of the supported test frameworks can be used.
However, there are some things to consider depending on whether you need module information to be available, and module boundaries to be enforced, during test execution.
In this context, the terms <em>whitebox testing</em> (module boundaries are deactivated or relaxed) and <em>blackbox testing</em> (module boundaries are in place) are often used.
Whitebox testing is used/needed for unit testing and blackbox testing fits functional or integration test requirements.</p>
</div>
<div class="paragraph">
<p>Sample: <a href="../samples/sample_java_modules_multi_project_with_integration_tests.html">Java Modules multi-project with integration tests</a></p>
</div>
<div class="sect4">
<h5 id="whitebox_unit_test_execution_on_the_classpath"><a class="anchor" href="#whitebox_unit_test_execution_on_the_classpath"></a><a class="link" href="#whitebox_unit_test_execution_on_the_classpath">Whitebox unit test execution on the classpath</a></h5>
<div class="paragraph">
<p>The simplest setup to write unit tests for functions or classes in modules is to <em>not</em> use module specifics during test execution.
For this, you just need to write tests the same way you would write them for normal libraries.
If you don&#8217;t have a <code>module-info.java</code> file in your test source set (<code>src/test/java</code>) this source set will be considered as traditional Java library during compilation and test runtime.
This means, all dependencies, including Jars with module information, are put on the classpath.
The advantage is that all internal classes of your (or other) modules are then accessible directly in tests.
This may be a totally valid setup for unit testing, where we do not care about the larger module structure, but only about testing single functions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using Eclipse: By default, Eclipse also runs unit tests as modules using module patching (see <a href="#sec:java_testing_modular_patching">below</a>).
In an imported Gradle project, unit testing a module with the Eclipse test runner might fail.
You then need to manually adjust the classpath/module path in the test run configuration or delegate test execution to Gradle.</p>
</div>
<div class="paragraph">
<p>This only concerns the test execution.
Unit test compilation and development works fine in Eclipse.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="blackbox_integration_testing"><a class="anchor" href="#blackbox_integration_testing"></a><a class="link" href="#blackbox_integration_testing">Blackbox integration testing</a></h5>
<div class="paragraph">
<p>For integration tests, you have the option to define the test set itself as additional module.
You do this similar to how you turn your main sources into a module:
by adding a <code>module-info.java</code> file to the corresponding source set (e.g. <code>integrationTests/java/module-info.java</code>).</p>
</div>
<div class="paragraph">
<p>You can find a full example that includes blackbox integration tests <a href="../samples/sample_java_modules_multi_project_with_integration_tests.html">here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In Eclipse, compiling multiple modules in one project is <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=520667">currently not support</a>.
Therefore the integration test (blackbox) setup described here only works in Eclipse if the tests are moved to a separate subproject.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:java_testing_modular_patching"><a class="anchor" href="#sec:java_testing_modular_patching"></a><a class="link" href="#sec:java_testing_modular_patching">Whitebox test execution with module patching</a></h5>
<div class="paragraph">
<p>Another approach for whitebox testing is to stay in the module world by <em>patching</em> the tests into the module under test.
This way, module boundaries stay in place, but the tests themselves become part of the module under test and can then access the module&#8217;s internals.</p>
</div>
<div class="paragraph">
<p>For which uses cases this is relevant and how this is best done is a topic of discussion.
There is no general best approach at the moment.
Thus, there is no special support for this in Gradle right now.</p>
</div>
<div class="paragraph">
<p>You can however, setup module patching for tests like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a <code>module-info.java</code> to your test source set that is a copy of the main <code>module-info.java</code> with additional dependencies needed for testing (e.g. <code>requires org.junit.jupiter.api</code>).</p>
</li>
<li>
<p>Configure both the <code>testCompileJava</code> and <code>test</code> tasks with arguments to patch the main classes with the test classes as shown below.</p>
</li>
</ul>
</div>
<div id="ex-patch-module-for-testing-using-command-line-arguments" class="exampleblock">
<div class="title">Example 42. <a href="#ex-patch-module-for-testing-using-command-line-arguments">Patch module for testing using command line arguments</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val moduleName = &quot;org.gradle.sample&quot;
val patchArgs = listOf(&quot;--patch-module&quot;, &quot;$moduleName=${tasks.compileJava.get().destinationDirectory.asFile.get().path}&quot;)
tasks.compileTestJava {
    options.compilerArgs.addAll(patchArgs)
}
tasks.test {
    jvmArgs(patchArgs)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> moduleName = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.sample</span><span class="delimiter">&quot;</span></span>
<span class="keyword">def</span> patchArgs = [<span class="string"><span class="delimiter">&quot;</span><span class="content">--patch-module</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>moduleName</span><span class="content">=</span><span class="inline"><span class="inline-delimiter">${</span>tasks.compileJava.destinationDirectory.asFile.get().path<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>]
tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">compileTestJava</span><span class="delimiter">'</span></span>) {
    options.compilerArgs += patchArgs
}
tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>) {
    jvmArgs += patchArgs
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If custom arguments are used for patching, these are not picked up by Eclipse and IDEA.
You will most likely see invalid compilation errors in the IDE.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:skipping_java_tests"><a class="anchor" href="#sec:skipping_java_tests"></a><a class="link" href="#sec:skipping_java_tests">Skipping the tests</a></h4>
<div class="paragraph">
<p>If you want to skip the tests when running a build, you have a few options. You can either do it via <a href="#sec:excluding_tasks_from_the_command_line">command line arguments</a> or <a href="controlling_task_execution.html#sec:skipping_tasks">in the build script</a>. To do it on the command line, you can use the <code>-x</code> or <code>--exclude-task</code> option like so:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>gradle build -x test</pre>
</div>
</div>
<div class="paragraph">
<p>This excludes the <code>test</code> task and any other task that it <em>exclusively</em> depends on, i.e. no other task depends on the same task. Those tasks will not be marked "SKIPPED" by Gradle, but will simply not appear in the list of tasks executed.</p>
</div>
<div class="paragraph">
<p>Skipping a test via the build script can be done a few ways. One common approach is to make test execution conditional via the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Task.html#org.gradle.api.Task:onlyIf(java.lang.String,org.gradle.api.specs.Spec)">Task.onlyIf(String, org.gradle.api.specs.Spec)</a> method. The following sample skips the <code>test</code> task if the project has a property called <code>mySkipTests</code>:</p>
</div>
<div id="ex-skipping-the-unit-tests-based-on-a-project-property" class="exampleblock">
<div class="title">Example 43. <a href="#ex-skipping-the-unit-tests-based-on-a-project-property">Skipping the unit tests based on a project property</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    val skipTestsProvider = providers.gradleProperty(&quot;mySkipTests&quot;)
    onlyIf(&quot;mySkipTests property is not set&quot;) {
        !skipTestsProvider.isPresent()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> skipTestsProvider = providers.gradleProperty(<span class="string"><span class="delimiter">'</span><span class="content">mySkipTests</span><span class="delimiter">'</span></span>)
test.onlyIf(<span class="string"><span class="delimiter">&quot;</span><span class="content">mySkipTests property is not set</span><span class="delimiter">&quot;</span></span>) {
    !skipTestsProvider.present
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, Gradle will mark the skipped tests as "SKIPPED" rather than exclude them from the build.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:forcing_java_tests_to_run"><a class="anchor" href="#sec:forcing_java_tests_to_run"></a><a class="link" href="#sec:forcing_java_tests_to_run">Forcing tests to run</a></h4>
<div class="paragraph">
<p>In well-defined builds, you can rely on Gradle to only run tests if the tests themselves or the production code change. However, you may encounter situations where the tests rely on a third-party service or something else that might change but can&#8217;t be modeled in the build.</p>
</div>
<div class="paragraph">
<p>You can always use the <code>--rerun</code> <a href="#sec:builtin_task_options">built-in task option</a> to force a task to rerun.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>gradle test --rerun</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if <a href="#sec:build_cache_enable">build caching</a> is not enabled, you can also force tests to run by cleaning the output of the relevant <code>Test</code> task — say <code>test</code> — and running the tests again, like so:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>gradle cleanTest test</pre>
</div>
</div>
<div class="paragraph">
<p><code>cleanTest</code> is based on a task rule provided by the <a href="base_plugin.html#sec:base_tasks">Base Plugin</a>. You can use it for <em>any</em> task.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:debugging_java_tests"><a class="anchor" href="#sec:debugging_java_tests"></a><a class="link" href="#sec:debugging_java_tests">Debugging when running tests</a></h4>
<div class="paragraph">
<p>On the few occasions that you want to debug your code while the tests are running, it can be helpful if you can attach a debugger at that point. You can either set the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:debug">Test.getDebug()</a> property to <code>true</code> or use the <code>--debug-jvm</code> command line option, or use <code>--no-debug-jvm</code> to set it to false.</p>
</div>
<div class="paragraph">
<p>When debugging for tests is enabled, Gradle will start the test process suspended and listening on port 5005.</p>
</div>
<div class="paragraph">
<p>You can also enable debugging in the DSL, where you can also configure other properties:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>test {
    debugOptions {
        enabled = true
        host = 'localhost'
        port = 4455
        server = true
        suspend = true
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration the test JVM will behave just like when passing the <code>--debug-jvm</code> argument but it will listen on port 4455.</p>
</div>
<div class="paragraph">
<p>To debug the test process remotely via network,  the <code>host</code> needs to be set to the machine&#8217;s IP address or <code>"*"</code> (listen on all interfaces).</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_test_fixtures"><a class="anchor" href="#sec:java_test_fixtures"></a><a class="link" href="#sec:java_test_fixtures">Using test fixtures</a></h4>
<div class="sect4">
<h5 id="producing_and_using_test_fixtures_within_a_single_project"><a class="anchor" href="#producing_and_using_test_fixtures_within_a_single_project"></a><a class="link" href="#producing_and_using_test_fixtures_within_a_single_project">Producing and using test fixtures within a single project</a></h5>
<div class="paragraph">
<p>Test fixtures are commonly used to setup the code under test, or provide utilities aimed at facilitating the tests of a component.
Java projects can enable test fixtures support by applying the <code>java-test-fixtures</code> plugin, in addition to the <code>java</code> or <code>java-library</code> plugins:</p>
</div>
<div id="ex-applying-the-java-test-fixtures-plugin" class="exampleblock">
<div class="title">Example 44. <a href="#ex-applying-the-java-test-fixtures-plugin">Applying the Java test fixtures plugin</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">lib/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    // A Java Library
    `java-library`
    // which produces test fixtures
    `java-test-fixtures`
    // and is published
    `maven-publish`
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">lib/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    <span class="comment">// A Java Library</span>
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    <span class="comment">// which produces test fixtures</span>
    id <span class="string"><span class="delimiter">'</span><span class="content">java-test-fixtures</span><span class="delimiter">'</span></span>
    <span class="comment">// and is published</span>
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will automatically create a <code>testFixtures</code> source set, in which you can write your test fixtures.
Test fixtures are configured so that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>they can see the <em>main</em> source set classes</p>
</li>
<li>
<p><em>test</em> sources can see the <em>test fixtures</em> classes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example for this main class:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/com/acme/Person.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> firstName;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> lastName;

    <span class="directive">public</span> Person(<span class="predefined-type">String</span> firstName, <span class="predefined-type">String</span> lastName) {
        <span class="local-variable">this</span>.firstName = firstName;
        <span class="local-variable">this</span>.lastName = lastName;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() {
        <span class="keyword">return</span> firstName;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getLastName() {
        <span class="keyword">return</span> lastName;
    }

    <span class="comment">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A test fixture can be written in <code>src/testFixtures/java</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/testFixtures/java/com/acme/Simpsons.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Simpsons</span> {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> Person HOMER = <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Homer</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> Person MARGE = <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Marjorie</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> Person BART = <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bartholomew</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> Person LISA = <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Elisabeth Marie</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> Person MAGGIE = <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Margaret Eve</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">List</span>&lt;Person&gt; FAMILY = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;Person&gt;() {{
        add(HOMER);
        add(MARGE);
        add(BART);
        add(LISA);
        add(MAGGIE);
    }};

    <span class="directive">public</span> <span class="directive">static</span> Person homer() { <span class="keyword">return</span> HOMER; }

    <span class="directive">public</span> <span class="directive">static</span> Person marge() { <span class="keyword">return</span> MARGE; }

    <span class="directive">public</span> <span class="directive">static</span> Person bart() { <span class="keyword">return</span> BART; }

    <span class="directive">public</span> <span class="directive">static</span> Person lisa() { <span class="keyword">return</span> LISA; }

    <span class="directive">public</span> <span class="directive">static</span> Person maggie() { <span class="keyword">return</span> MAGGIE; }

    <span class="comment">// ...</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="declaring_dependencies_of_test_fixtures"><a class="anchor" href="#declaring_dependencies_of_test_fixtures"></a><a class="link" href="#declaring_dependencies_of_test_fixtures">Declaring dependencies of test fixtures</a></h5>
<div class="paragraph">
<p>Similarly to the <a href="java_library_plugin.html">Java Library Plugin</a>, test fixtures expose an API and an implementation configuration:</p>
</div>
<div id="ex-declaring-test-fixture-dependencies" class="exampleblock">
<div class="title">Example 45. <a href="#ex-declaring-test-fixture-dependencies">Declaring test fixture dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">lib/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;junit:junit:4.13&quot;)

    // API dependencies are visible to consumers when building
    testFixturesApi(&quot;org.apache.commons:commons-lang3:3.9&quot;)

    // Implementation dependencies are not leaked to consumers when building
    testFixturesImplementation(&quot;org.apache.commons:commons-text:1.6&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">lib/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.13</span><span class="delimiter">'</span></span>

    <span class="comment">// API dependencies are visible to consumers when building</span>
    testFixturesApi <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-lang3:3.9</span><span class="delimiter">'</span></span>

    <span class="comment">// Implementation dependencies are not leaked to consumers when building</span>
    testFixturesImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-text:1.6</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s worth noticing that if a dependency is an <em>implementation</em> dependency of test fixtures, then <em>when compiling tests that depend on those test fixtures</em>, the implementation dependencies will <em>not leak</em> into the compile classpath.
This results in improved separation of concerns and better compile avoidance.</p>
</div>
</div>
<div class="sect4">
<h5 id="consuming_test_fixtures_of_another_project"><a class="anchor" href="#consuming_test_fixtures_of_another_project"></a><a class="link" href="#consuming_test_fixtures_of_another_project">Consuming test fixtures of another project</a></h5>
<div class="paragraph">
<p>Test fixtures are not limited to a single project.
It is often the case that a dependent project tests also needs the test fixtures of the dependency.
This can be achieved very easily using the <code>testFixtures</code> keyword:</p>
</div>
<div id="ex-adding-a-dependency-on-test-fixtures-of-another-project" class="exampleblock">
<div class="title">Example 46. <a href="#ex-adding-a-dependency-on-test-fixtures-of-another-project">Adding a dependency on test fixtures of another project</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(project(&quot;:lib&quot;))

    testImplementation(&quot;junit:junit:4.13&quot;)
    testImplementation(testFixtures(project(&quot;:lib&quot;)))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:lib</span><span class="delimiter">&quot;</span></span>))

    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.13</span><span class="delimiter">'</span></span>
    testImplementation(testFixtures(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:lib</span><span class="delimiter">&quot;</span></span>)))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="publishing_test_fixtures"><a class="anchor" href="#publishing_test_fixtures"></a><a class="link" href="#publishing_test_fixtures">Publishing test fixtures</a></h5>
<div class="paragraph">
<p>One of the advantages of using the <code>java-test-fixtures</code> plugin is that test fixtures are published.
By convention, test fixtures will be published with an artifact having the <code>test-fixtures</code> classifier.
For both Maven and Ivy, an artifact with that classifier is simply published alongside the regular artifacts.
However, if you use the <code>maven-publish</code> or <code>ivy-publish</code> plugin, test fixtures are published as additional variants in <a href="https://github.com/gradle/gradle/blob/master/platforms/documentation/docs/src/docs/design/gradle-module-metadata-1.0-specification.md">Gradle Module Metadata</a> and you can directly depend on test fixtures of external libraries in another Gradle project:</p>
</div>
<div id="ex-adding-a-dependency-on-test-fixtures-of-an-external-library" class="exampleblock">
<div class="title">Example 47. <a href="#ex-adding-a-dependency-on-test-fixtures-of-an-external-library">Adding a dependency on test fixtures of an external library</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // Adds a dependency on the test fixtures of Gson, however this
    // project doesn't publish such a thing
    functionalTest(testFixtures(&quot;com.google.code.gson:gson:2.8.5&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// Adds a dependency on the test fixtures of Gson, however this</span>
    <span class="comment">// project doesn't publish such a thing</span>
    functionalTest testFixtures(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.code.gson:gson:2.8.5</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s worth noting that if the external project is <em>not</em> publishing Gradle Module Metadata, then resolution will fail with an error indicating that such a variant cannot be found:</p>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle dependencyInsight --configuration functionalTestClasspath --dependency gson</code></strong></div>
<div class="content">
<pre>&gt; gradle dependencyInsight --configuration functionalTestClasspath --dependency gson

&gt; Task :dependencyInsight
com.google.code.gson:gson:2.8.5 FAILED
   Failures:
      - Could not resolve com.google.code.gson:gson:2.8.5.
          - Unable to find a variant of com.google.code.gson:gson:2.8.5 providing the requested capability com.google.code.gson:gson-test-fixtures:
               - Variant compile provides com.google.code.gson:gson:2.8.5
               - Variant enforced-platform-compile provides com.google.code.gson:gson-derived-enforced-platform:2.8.5
               - Variant enforced-platform-runtime provides com.google.code.gson:gson-derived-enforced-platform:2.8.5
               - Variant javadoc provides com.google.code.gson:gson:2.8.5
               - Variant platform-compile provides com.google.code.gson:gson-derived-platform:2.8.5
               - Variant platform-runtime provides com.google.code.gson:gson-derived-platform:2.8.5
               - Variant runtime provides com.google.code.gson:gson:2.8.5
               - Variant sources provides com.google.code.gson:gson:2.8.5

com.google.code.gson:gson:2.8.5 FAILED
\--- functionalTestClasspath

A web-based, searchable dependency report is available by adding the --scan option.

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>The error message mentions the missing <code>com.google.code.gson:gson-test-fixtures</code> capability, which is indeed not defined for this library.
That&#8217;s because by convention, for projects that use the <code>java-test-fixtures</code> plugin, Gradle automatically creates test fixtures variants with a capability whose name is the name of the main component, with the appendix <code>-test-fixtures</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you publish your library and use test fixtures, but do not want to publish the fixtures, you can deactivate publishing of the <em>test fixtures variants</em> as shown below.
</td>
</tr>
</table>
</div>
<div id="ex-disable-publishing-of-test-fixtures-variants" class="exampleblock">
<div class="title">Example 48. <a href="#ex-disable-publishing-of-test-fixtures-variants">Disable publishing of test fixtures variants</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val javaComponent = components[&quot;java&quot;] as AdhocComponentWithVariants
javaComponent.withVariantsFromConfiguration(configurations[&quot;testFixturesApiElements&quot;]) { skip() }
javaComponent.withVariantsFromConfiguration(configurations[&quot;testFixturesRuntimeElements&quot;]) { skip() }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">components.java.withVariantsFromConfiguration(configurations.testFixturesApiElements) { skip() }
components.java.withVariantsFromConfiguration(configurations.testFixturesRuntimeElements) { skip() }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dependency_management_for_java_projects"><a class="anchor" href="#dependency_management_for_java_projects"></a><a class="link" href="#dependency_management_for_java_projects">Managing Dependencies of JVM Projects</a></h3>
<div class="paragraph">
<p>This chapter explains how to apply basic dependency management concepts to JVM-based projects.
For a detailed introduction to dependency management, see <a href="#dependency_management_in_gradle">dependency management in Gradle</a>.</p>
</div>
<div class="sect3">
<h4 id="sec:setting_up_a_standard_build_script_java_tutorial"><a class="anchor" href="#sec:setting_up_a_standard_build_script_java_tutorial"></a><a class="link" href="#sec:setting_up_a_standard_build_script_java_tutorial">Dissecting a typical build script</a></h4>
<div class="paragraph">
<p>Let&#8217;s have a look at a very simple build script for a JVM-based project.
It applies the <a href="#java_library_plugin">Java Library plugin</a> which automatically introduces a standard project layout, provides tasks for performing typical work and adequate support for dependency management.</p>
</div>
<div id="ex-dependency-declarations-for-a-jvm-based-project" class="exampleblock">
<div class="title">Example 49. <a href="#ex-dependency-declarations-for-a-jvm-based-project">Dependency declarations for a JVM-based project</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;org.hibernate:hibernate-core:3.6.7.Final&quot;)
    api(&quot;com.google.guava:guava:23.0&quot;)
    testImplementation(&quot;junit:junit:4.+&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate:hibernate-core:3.6.7.Final</span><span class="delimiter">'</span></span>
    api <span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:23.0</span><span class="delimiter">'</span></span>
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.+</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:dependencies(groovy.lang.Closure)">Project.dependencies{}</a> code block declares that Hibernate core 3.6.7.Final is required to compile the project&#8217;s production source code. It also states that junit &gt;= 4.0 is required to compile the project&#8217;s tests. All dependencies are supposed to be looked up in the Maven Central repository as defined by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:repositories(groovy.lang.Closure)">Project.repositories{}</a>. The following sections explain each aspect in more detail.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:module_dependencies_java_tutorial"><a class="anchor" href="#sec:module_dependencies_java_tutorial"></a><a class="link" href="#sec:module_dependencies_java_tutorial">Declaring module dependencies</a></h4>
<div class="paragraph">
<p>There are various <a href="#sec:dependency-types">types of dependencies</a> that you can declare.
One such type is a <em>module dependency</em>.
A <a href="#sub:module_dependencies">module dependency</a> represents a dependency on a module with a specific version built outside the current build.
Modules are usually stored in a repository, such as Maven Central, a corporate Maven or Ivy repository, or a directory in the local file system.</p>
</div>
<div class="paragraph">
<p>To define an module dependency, you add it to a <a href="#sec:configurations_java_tutorial">dependency configuration</a>:</p>
</div>
<div id="ex-definition-of-a-module-dependency" class="exampleblock">
<div class="title">Example 50. <a href="#ex-definition-of-a-module-dependency">Definition of a module dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.hibernate:hibernate-core:3.6.7.Final&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate:hibernate-core:3.6.7.Final</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To find out more about defining dependencies, have a look at <a href="#declaring-dependencies">Declaring Dependencies</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:configurations_java_tutorial"><a class="anchor" href="#sec:configurations_java_tutorial"></a><a class="link" href="#sec:configurations_java_tutorial">Using dependency configurations</a></h4>
<div class="paragraph">
<p>A <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.Configuration.html">Configuration</a> is a named set of dependencies and artifacts. There are three main purposes for a <em>configuration</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Declaring dependencies</dt>
<dd>
<p>A plugin uses configurations to make it easy for build authors to declare what other subprojects or external artifacts are needed for various purposes during the execution of tasks defined by the plugin. For example a plugin may need the Spring web framework dependency to compile the source code.</p>
</dd>
<dt class="hdlist1">Resolving dependencies</dt>
<dd>
<p>A plugin uses configurations to find (and possibly download) inputs to the tasks it defines. For example Gradle needs to download Spring web framework JAR files from Maven Central.</p>
</dd>
<dt class="hdlist1">Exposing artifacts for consumption</dt>
<dd>
<p>A plugin uses configurations to define what <em>artifacts</em> it generates for other projects to consume. For example the project would like to publish its compiled source code packaged in the JAR file to an in-house Artifactory repository.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>With those three purposes in mind, let&#8217;s take a look at a few of the <a href="#sec:java_library_configurations_graph">standard configurations defined by the Java Library Plugin</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">implementation</dt>
<dd>
<p>The dependencies required to compile the production source of the project which <em>are not</em> part of the API exposed by the project. For example the project uses Hibernate for its internal persistence layer implementation.</p>
</dd>
<dt class="hdlist1">api</dt>
<dd>
<p>The dependencies required to compile the production source of the project which <em>are</em> part of the API exposed by the project. For example the project uses Guava and exposes public interfaces with Guava classes in their method signatures.</p>
</dd>
<dt class="hdlist1">testImplementation</dt>
<dd>
<p>The dependencies required to compile and run the test source of the project. For example the project decided to write test code with the test framework JUnit.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Various plugins add further standard configurations.
You can also define your own custom configurations in your build via <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:configurations(groovy.lang.Closure)">Project.configurations{}</a>.
See <a href="#sec:what-are-dependency-configurations">What are dependency configurations</a> for the details of defining and customizing dependency configurations.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:repositories_java_tutorial"><a class="anchor" href="#sec:repositories_java_tutorial"></a><a class="link" href="#sec:repositories_java_tutorial">Declaring common Java repositories</a></h4>
<div class="paragraph">
<p>How does Gradle know where to find the files for external dependencies? Gradle looks for them in a <em>repository</em>.
A repository is a collection of modules, organized by <code>group</code>, <code>name</code> and <code>version</code>.
Gradle understands different <a href="#sec:repository-types">repository types</a>, such as Maven and Ivy, and supports various ways of accessing the repository via HTTP or other protocols.</p>
</div>
<div class="paragraph">
<p>By default, Gradle does not define any repositories. You need to define at least one with the help of <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:repositories(groovy.lang.Closure)">Project.repositories{}</a> before you can use module dependencies. One option is use the Maven Central repository:</p>
</div>
<div id="ex-usage-of-maven-central-repository" class="exampleblock">
<div class="title">Example 51. <a href="#ex-usage-of-maven-central-repository">Usage of Maven central repository</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also have repositories on the local file system. This works for both Maven and Ivy repositories.</p>
</div>
<div id="ex-usage-of-a-local-ivy-directory" class="exampleblock">
<div class="title">Example 52. <a href="#ex-usage-of-a-local-ivy-directory">Usage of a local Ivy directory</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        // URL can refer to a local directory
        url = uri(&quot;../local-repo&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        <span class="comment">// URL can refer to a local directory</span>
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">../local-repo</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A project can have multiple repositories. Gradle will look for a dependency in each repository in the order they are specified, stopping at the first repository that contains the requested module.</p>
</div>
<div class="paragraph">
<p>To find out more about defining repositories, have a look at <a href="#declaring-repositories">Declaring Repositories</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:publishing_artifacts_java_tutorial"><a class="anchor" href="#sec:publishing_artifacts_java_tutorial"></a><a class="link" href="#sec:publishing_artifacts_java_tutorial">Publishing artifacts</a></h4>
<div class="paragraph">
<p>To learn more about publishing artifacts, have a look at <a href="#publishing_components">publishing plugins</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java_toolchains"><a class="anchor" href="#java_toolchains"></a><a class="link" href="#java_toolchains">JAVA TOOLCHAINS</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="toolchains"><a class="anchor" href="#toolchains"></a><a class="link" href="#toolchains">Toolchains for JVM projects</a></h3>
<div class="paragraph">
<p>Working on multiple projects can require interacting with multiple versions of the Java language.
Even within a single project different parts of the codebase may be fixed to a particular language level due to backward compatibility requirements.
This means different versions of the same tools (a toolchain) must be installed and managed on each machine that builds the project.</p>
</div>
<div class="paragraph">
<p>A <strong>Java toolchain</strong> is a set of tools to build and run Java projects, which is usually provided by the environment via local JRE or JDK installations.
Compile tasks may use <code>javac</code> as their compiler, test and exec tasks may use the <code>java</code> command while <code>javadoc</code> will be used to generate documentation.</p>
</div>
<div class="paragraph">
<p>By default, Gradle uses the same Java toolchain for running Gradle itself and building JVM projects.
However, this may only sometimes be desirable.
Building projects with different Java versions on different developer machines and CI servers may lead to unexpected issues.
Additionally, you may want to build a project using a Java version that is not supported for running Gradle.</p>
</div>
<div class="paragraph">
<p>In order to improve reproducibility of the builds and make build requirements clearer, Gradle allows configuring toolchains on both project and task levels.
You can also control the JVM used to run Gradle itself using the <a href="#sec:daemon_jvm_criteria">Daemon JVM criteria</a>.</p>
</div>
<div class="sect3">
<h4 id="sec:consuming"><a class="anchor" href="#sec:consuming"></a><a class="link" href="#sec:consuming">Toolchains for projects</a></h4>
<div class="paragraph">
<p>You can define what toolchain to use for a project by stating the Java language version in the <code>java</code> extension block:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(<span class="integer">17</span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Executing the build (e.g. using <code>gradle check</code>) will now handle several things for you and others running your build:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Gradle configures all compile, test and javadoc tasks to use the defined toolchain.</p>
</li>
<li>
<p>Gradle detects <a href="#sec:auto_detection">locally installed toolchains</a>.</p>
</li>
<li>
<p>Gradle chooses a toolchain matching the requirements (any Java 17 toolchain for the example above).</p>
</li>
<li>
<p>If no matching toolchain is found, Gradle can automatically download a matching one based on the configured <a href="#sub:download_repositories">toolchain download repositories</a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Toolchain support is available in the Java plugins and for the tasks they define.</p>
</div>
<div class="paragraph">
<p>For the Groovy plugin, compilation is supported but not yet Groovydoc generation.
For the Scala plugin, compilation and Scaladoc generation are supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sec:vendors"><a class="anchor" href="#sec:vendors"></a><a class="link" href="#sec:vendors">Selecting toolchains by vendor</a></h5>
<div class="paragraph">
<p>In case your build has specific requirements from the used JRE/JDK, you may want to define the vendor for the toolchain as well.
<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/jvm/toolchain/JvmVendorSpec.html"><code>JvmVendorSpec</code></a> has a list of well-known JVM vendors recognized by Gradle.
The advantage is that Gradle can handle any inconsistencies across JDK versions in how exactly the JVM encodes the vendor information.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(11)
        vendor = JvmVendorSpec.ADOPTIUM
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(<span class="integer">11</span>)
        vendor = JvmVendorSpec.ADOPTIUM
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the vendor you want to target is not a known vendor, you can still restrict the toolchain to those matching the <code>java.vendor</code> system property of the available toolchains.</p>
</div>
<div class="paragraph">
<p>The following snippet uses filtering to include a subset of available toolchains.
This example only includes toolchains whose <code>java.vendor</code> property contains the given match string.
The matching is done in a case-insensitive manner.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(11)
        vendor = JvmVendorSpec.matching(&quot;customString&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(<span class="integer">11</span>)
        vendor = JvmVendorSpec.matching(<span class="string"><span class="delimiter">&quot;</span><span class="content">customString</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="selecting_toolchains_by_virtual_machine_implementation"><a class="anchor" href="#selecting_toolchains_by_virtual_machine_implementation"></a><a class="link" href="#selecting_toolchains_by_virtual_machine_implementation">Selecting toolchains by virtual machine implementation</a></h5>
<div class="paragraph">
<p>If your project requires a specific implementation, you can filter based on the implementation as well.
Currently available implementations to choose from are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>VENDOR_SPECIFIC</code></dt>
<dd>
<p>Acts as a placeholder and matches any implementation from any vendor (e.g. hotspot, zulu, &#8230;&#8203;)</p>
</dd>
<dt class="hdlist1"><code>J9</code></dt>
<dd>
<p>Matches only virtual machine implementations using the OpenJ9/IBM J9 runtime engine.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example, to use an <a href="https://www.eclipse.org/openj9/">IBM</a> JVM, distributed via <a href="https://adoptopenjdk.net/">AdoptOpenJDK</a>,
you can specify the filter as shown in the example below.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(11)
        vendor = JvmVendorSpec.IBM
        implementation = JvmImplementation.J9
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(<span class="integer">11</span>)
        vendor = JvmVendorSpec.IBM
        implementation = JvmImplementation.J9
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Java major version, the vendor (if specified) and implementation (if specified) will be tracked as an input for compilation and test execution.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:configuring_toolchain_specifications"><a class="anchor" href="#sec:configuring_toolchain_specifications"></a><a class="link" href="#sec:configuring_toolchain_specifications">Configuring toolchain specifications</a></h5>
<div class="paragraph">
<p>Gradle allows configuring multiple properties that affect the selection of a toolchain, such as language version or vendor.
Even though these properties can be configured independently, the configuration must follow certain rules in order to form a <em>valid</em> specification.</p>
</div>
<div class="paragraph">
<p>A <code>JavaToolchainSpec</code> is considered <em>valid</em> in two cases:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>when no properties have been set, i.e. the specification is <em>empty</em>;</p>
</li>
<li>
<p>when <code>languageVersion</code> has been set, optionally followed by setting any other property.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In other words, if a vendor or an implementation are specified, they must be accompanied by the language version.
Gradle distinguishes between toolchain specifications that configure the language version and the ones that do not.
A specification without a language version, in most cases, would be treated as a one that selects the toolchain of the current build.</p>
</div>
<div class="paragraph">
<p>Usage of <em>invalid</em> instances of <code>JavaToolchainSpec</code> results in a build error since Gradle 8.0.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="toolchains_for_tasks"><a class="anchor" href="#toolchains_for_tasks"></a><a class="link" href="#toolchains_for_tasks">Toolchains for tasks</a></h4>
<div class="paragraph">
<p>In case you want to tweak which toolchain is used for a specific task, you can specify the exact tool a task is using.
For example, the <code>Test</code> task exposes a <code>JavaLauncher</code> property that defines which java executable to use for launching the tests.</p>
</div>
<div class="paragraph">
<p>In the example below, we configure all java compilation tasks to use Java 8.
Additionally, we introduce a new <code>Test</code> task that will run our unit tests using a JDK 17.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">list/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;JavaCompile&gt;().configureEach {
    javaCompiler = javaToolchains.compilerFor {
        languageVersion = JavaLanguageVersion.of(8)
    }
}

tasks.register&lt;Test&gt;(&quot;testsOn17&quot;) {
    javaLauncher = javaToolchains.launcherFor {
        languageVersion = JavaLanguageVersion.of(17)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">list/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(JavaCompile).configureEach {
    javaCompiler = javaToolchains.compilerFor {
        languageVersion = JavaLanguageVersion.of(<span class="integer">8</span>)
    }
}

task(<span class="string"><span class="delimiter">'</span><span class="content">testsOn17</span><span class="delimiter">'</span></span>, <span class="key">type</span>: Test) {
    javaLauncher = javaToolchains.launcherFor {
        languageVersion = JavaLanguageVersion.of(<span class="integer">17</span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition, in the <code>application</code> subproject, we add another Java execution task to run our application with JDK 17.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">application/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;JavaExec&gt;(&quot;runOn17&quot;) {
    javaLauncher = javaToolchains.launcherFor {
        languageVersion = JavaLanguageVersion.of(17)
    }

    classpath = sourceSets[&quot;main&quot;].runtimeClasspath
    mainClass = application.mainClass
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">application/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task(<span class="string"><span class="delimiter">'</span><span class="content">runOn17</span><span class="delimiter">'</span></span>, <span class="key">type</span>: JavaExec) {
    javaLauncher = javaToolchains.launcherFor {
        languageVersion = JavaLanguageVersion.of(<span class="integer">17</span>)
    }

    classpath = sourceSets.main.runtimeClasspath
    mainClass = application.mainClass
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Depending on the task, a JRE might be enough while for other tasks (e.g. compilation), a JDK is required.
By default, Gradle prefers installed JDKs over JREs if they can satisfy the requirements.</p>
</div>
<div class="paragraph">
<p>Toolchains tool providers can be obtained from the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/jvm/toolchain/JavaToolchainService.html"><code>javaToolchains</code></a> extension.</p>
</div>
<div class="paragraph">
<p>Three tools are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>JavaCompiler</code> which is the tool used by the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.JavaCompile.html#org.gradle.api.tasks.compile.JavaCompile:javaCompiler">JavaCompile</a> task</p>
</li>
<li>
<p>A <code>JavaLauncher</code> which is the tool used by the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.JavaExec.html#org.gradle.api.tasks.JavaExec:javaLauncher">JavaExec</a> or <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:javaLauncher">Test</a> tasks</p>
</li>
<li>
<p>A <code>JavadocTool</code> which is the tool used by the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.javadoc.Javadoc.html#org.gradle.api.tasks.javadoc.Javadoc:javadocTool">Javadoc</a> task</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="integration_with_tasks_relying_on_a_java_executable_or_java_home"><a class="anchor" href="#integration_with_tasks_relying_on_a_java_executable_or_java_home"></a><a class="link" href="#integration_with_tasks_relying_on_a_java_executable_or_java_home">Integration with tasks relying on a Java executable or Java home</a></h5>
<div class="paragraph">
<p>Any task that can be configured with a path to a Java executable, or a Java home location, can benefit from toolchains.</p>
</div>
<div class="paragraph">
<p>While you will not be able to wire a toolchain tool directly, they all have the metadata that gives access to their full path or to the path of the Java installation they belong to.</p>
</div>
<div class="paragraph">
<p>For example, you can configure the <code>java</code> executable for a task as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val launcher = javaToolchains.launcherFor {
    languageVersion = JavaLanguageVersion.of(11)
}

tasks.sampleTask {
    javaExecutable = launcher.map { it.executablePath }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> launcher = javaToolchains.launcherFor {
    languageVersion = JavaLanguageVersion.of(<span class="integer">11</span>)
}

tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">sampleTask</span><span class="delimiter">'</span></span>) {
    javaExecutable = launcher.map { <span class="local-variable">it</span>.executablePath }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As another example, you can configure the <em>Java Home</em> for a task as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val launcher = javaToolchains.launcherFor {
    languageVersion = JavaLanguageVersion.of(11)
}

tasks.anotherSampleTask {
    javaHome = launcher.map { it.metadata.installationPath }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> launcher = javaToolchains.launcherFor {
    languageVersion = JavaLanguageVersion.of(<span class="integer">11</span>)
}

tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">anotherSampleTask</span><span class="delimiter">'</span></span>) {
    javaHome = launcher.map { <span class="local-variable">it</span>.metadata.installationPath }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you require a path to a specific tool such as Java compiler, you can obtain it as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val compiler = javaToolchains.compilerFor {
    languageVersion = JavaLanguageVersion.of(11)
}

tasks.yetAnotherSampleTask {
    javaCompilerExecutable = compiler.map { it.executablePath }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> compiler = javaToolchains.compilerFor {
    languageVersion = JavaLanguageVersion.of(<span class="integer">11</span>)
}

tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">yetAnotherSampleTask</span><span class="delimiter">'</span></span>) {
    javaCompilerExecutable = compiler.map { <span class="local-variable">it</span>.executablePath }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The examples above use tasks with <code>RegularFileProperty</code> and <code>DirectoryProperty</code> properties which allow lazy configuration.
Doing respectively <code>launcher.get().executablePath</code>, <code>launcher.get().metadata.installationPath</code> or <code>compiler.get().executablePath</code> instead will give you the full path for the given toolchain but note that this may realize (and provision) a toolchain eagerly.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:auto_detection"><a class="anchor" href="#sec:auto_detection"></a><a class="link" href="#sec:auto_detection">Auto-detection of installed toolchains</a></h4>
<div class="paragraph">
<p>By default, Gradle automatically detects local JRE/JDK installations so no further configuration is required by the user.
The following is a list of common package managers, tools, and locations that are supported by the JVM auto-detection.</p>
</div>
<div class="paragraph">
<p>JVM auto-detection knows how to work with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Operation-system specific locations: Linux, macOS, Windows</p>
</li>
<li>
<p>Package Managers: <a href="https://asdf-vm.com/#/">Asdf-vm</a>, <a href="https://github.com/shyiko/jabba">Jabba</a>, <a href="https://sdkman.io/">SDKMAN!</a></p>
</li>
<li>
<p><a href="https://maven.apache.org/guides/mini/guide-using-toolchains.html">Maven Toolchain</a> specifications</p>
</li>
<li>
<p><a href="https://www.jetbrains.com/help/idea/sdk.html#jdk-from-ide">IntelliJ IDEA</a> installations</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Among the set of all detected JRE/JDK installations, one will be picked according to the <a href="#sec:precedence">Toolchain Precedence Rules</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Whether you are using toolchain auto-detection or you are configuring <a href="#sec:custom_loc">Custom toolchain locations</a>, installations that are non-existing or without a <code>bin/java</code> executable will be ignored with a warning, but they won&#8217;t generate an error.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sub:disable_auto_detect"><a class="anchor" href="#sub:disable_auto_detect"></a><a class="link" href="#sub:disable_auto_detect">How to disable auto-detection</a></h5>
<div class="paragraph">
<p>In order to disable auto-detection, you can use the <code>org.gradle.java.installations.auto-detect</code> Gradle property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Either start gradle using <code>-Porg.gradle.java.installations.auto-detect=false</code></p>
</li>
<li>
<p>Or put <code>org.gradle.java.installations.auto-detect=false</code> into your <code>gradle.properties</code> file.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:provisioning"><a class="anchor" href="#sec:provisioning"></a><a class="link" href="#sec:provisioning">Auto-provisioning</a></h4>
<div class="paragraph">
<p>If Gradle can&#8217;t find a locally available toolchain that matches the requirements of the build, it can automatically download one (as long as a toolchain download repository has been configured; for detail, see <a href="#sub:download_repositories">relevant section</a>).
Gradle installs the downloaded JDKs in the <a href="#dir:gradle_user_home">Gradle User Home</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Gradle only downloads JDK versions for GA releases.
There is no support for downloading early access versions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once installed in the <a href="#dir:gradle_user_home">Gradle User Home</a>, a provisioned JDK becomes one of the JDKs visible to <a href="#sec:auto_detection">auto-detection</a> and can be used by any subsequent builds, just like any other JDK installed on the system.</p>
</div>
<div class="paragraph">
<p>Since auto-provisioning only kicks in when auto-detection fails to find a matching JDK, auto-provisioning can only download new JDKs and is in no way involved in updating any of the already installed ones.
None of the auto-provisioned JDKs will ever be revisited and automatically updated by auto-provisioning, even if there is a newer minor version available for them.</p>
</div>
<div class="sect4">
<h5 id="sub:download_repositories"><a class="anchor" href="#sub:download_repositories"></a><a class="link" href="#sub:download_repositories">Toolchain Download Repositories</a></h5>
<div class="paragraph">
<p>Toolchain download repository definitions are added to a build by applying specific settings plugins.
For details on writing such plugins, consult the <a href="#toolchain_plugins">Toolchain Resolver Plugins</a> page.</p>
</div>
<div class="paragraph">
<p>One example of a toolchain resolver plugin is the <a href="https://github.com/gradle/foojay-toolchains">Foojay Toolchains Plugin</a>, based on the <a href="https://github.com/foojayio/discoapi">foojay Disco API</a>.
It even has a convention variant, which automatically takes care of all the needed configuration, just by being applied:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;org.gradle.toolchains.foojay-resolver-convention&quot;) version(&quot;0.8.0&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.toolchains.foojay-resolver-convention</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">0.8.0</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In general, when applying toolchain resolver plugins, the toolchain download resolvers provided by them also need to be configured.
Let&#8217;s illustrate with an example.
Consider two toolchain resolver plugins applied by the build:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One is the Foojay plugin mentioned above, which downloads toolchains via the <code>FoojayToolchainResolver</code> it provides.</p>
</li>
<li>
<p>The other contains a <strong>FICTITIOUS</strong> resolver named <code>MadeUpResolver</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example uses these toolchain resolvers in a build via the <code>toolchainManagement</code> block in the settings file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">toolchainManagement {
    jvm { // <b class="conum">(1)</b>
        javaRepositories {
            repository(&quot;foojay&quot;) { // <b class="conum">(2)</b>
                resolverClass = org.gradle.toolchains.foojay.FoojayToolchainResolver::class.java
            }
            repository(&quot;made_up&quot;) { // <b class="conum">(3)</b>
                resolverClass = MadeUpResolver::class.java
                credentials {
                    username = &quot;user&quot;
                    password = &quot;password&quot;
                }
                authentication {
                    create&lt;DigestAuthentication&gt;(&quot;digest&quot;)
                } // <b class="conum">(4)</b>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">toolchainManagement {
    jvm { // <b class="conum">(1)</b>
        javaRepositories {
            repository(<span class="string"><span class="delimiter">'</span><span class="content">foojay</span><span class="delimiter">'</span></span>) { // <b class="conum">(2)</b>
                resolverClass = org.gradle.toolchains.foojay.FoojayToolchainResolver
            }
            repository(<span class="string"><span class="delimiter">'</span><span class="content">made_up</span><span class="delimiter">'</span></span>) { // <b class="conum">(3)</b>
                resolverClass = MadeUpResolver
                credentials {
                    username <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
                    password <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
                }
                authentication {
                    digest(BasicAuthentication)
                } // <b class="conum">(4)</b>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>In the <code>toolchainManagement</code> block, the <code>jvm</code> block contains configuration for Java toolchains.</p>
</li>
<li>
<p>The <code>javaRepositories</code> block defines named Java toolchain repository configurations.
Use the <code>resolverClass</code> property to link these configurations to plugins.</p>
</li>
<li>
<p>Toolchain declaration order matters.
Gradle downloads from the first repository that provides a match, starting with the first repository in the list.</p>
</li>
<li>
<p>You can configure toolchain repositories with the same set of <a href="#sec:authentication_schemes">authentication and authorization options</a> used for dependency management.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The <code>jvm</code> block in <code>toolchainManagement</code> only resolves after applying a toolchain resolver plugin.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sub:viewing_toolchains"><a class="anchor" href="#sub:viewing_toolchains"></a><a class="link" href="#sub:viewing_toolchains">Viewing and debugging toolchains</a></h5>
<div class="paragraph">
<p>Gradle can display the list of all detected toolchains including their metadata.</p>
</div>
<div class="paragraph">
<p>For example, to show all toolchains of a project, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>gradle -q javaToolchains</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q javaToolchains</code></strong></div>
<div class="content">
<pre>&gt; gradle -q javaToolchains

 + Options
     | Auto-detection:     Enabled
     | Auto-download:      Enabled

 + AdoptOpenJDK 1.8.0_242
     | Location:           /Users/username/myJavaInstalls/8.0.242.hs-adpt/jre
     | Language Version:   8
     | Vendor:             AdoptOpenJDK
     | Architecture:       x86_64
     | Is JDK:             false
     | Detected by:        Gradle property 'org.gradle.java.installations.paths'

 + Microsoft JDK 16.0.2+7
     | Location:           /Users/username/.sdkman/candidates/java/16.0.2.7.1-ms
     | Language Version:   16
     | Vendor:             Microsoft
     | Architecture:       aarch64
     | Is JDK:             true
     | Detected by:        SDKMAN!

 + OpenJDK 15-ea
     | Location:           /Users/user/customJdks/15.ea.21-open
     | Language Version:   15
     | Vendor:             AdoptOpenJDK
     | Architecture:       x86_64
     | Is JDK:             true
     | Detected by:        environment variable 'JDK16'

 + Oracle JDK 1.7.0_80
     | Location:           /Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk/Contents/Home/jre
     | Language Version:   7
     | Vendor:             Oracle
     | Architecture:       x86_64
     | Is JDK:             false
     | Detected by:        MacOS java_home</pre>
</div>
</div>
<div class="paragraph">
<p>This can help to debug which toolchains are available to the build, how they are detected and what kind of metadata Gradle knows about those toolchains.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:disable_auto_provision"><a class="anchor" href="#sub:disable_auto_provision"></a><a class="link" href="#sub:disable_auto_provision">Disabling auto provisioning</a></h5>
<div class="paragraph">
<p>In order to disable auto-provisioning, you can use the <code>org.gradle.java.installations.auto-download</code> Gradle property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Either start gradle using <code>-Porg.gradle.java.installations.auto-download=false</code></p>
</li>
<li>
<p>Or put <code>org.gradle.java.installations.auto-download=false</code> into a <code>gradle.properties</code> file.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>After disabling the auto provisioning, ensure that the specified JRE/JDK version in the build file is already installed locally.
Then, stop the Gradle daemon so that it can be reinitialized for the next build.
You can use the <code>./gradlew --stop</code> command to stop the daemon process.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sub:removing_auto_provisioned_toolchain"><a class="anchor" href="#sub:removing_auto_provisioned_toolchain"></a><a class="link" href="#sub:removing_auto_provisioned_toolchain">Removing an auto-provisioned toolchain</a></h5>
<div class="paragraph">
<p>When removing an auto-provisioned toolchain is necessary, remove the relevant toolchain located in the <code>/jdks</code> directory within the <a href="#dir:gradle_user_home">Gradle User Home</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="#gradle_daemon">Gradle Daemon</a> caches information about your project, including configuration details such as toolchain paths or versions. Changes to a project&#8217;s toolchain configuration might only occur once the Gradle Daemon is restarted. It is recommended to  <a href="#sec:stopping_an_existing_daemon">stop the Gradle Daemon</a> to ensure that Gradle updates the configuration for subsequent builds.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:custom_loc"><a class="anchor" href="#sec:custom_loc"></a><a class="link" href="#sec:custom_loc">Custom toolchain locations</a></h4>
<div class="paragraph">
<p>If auto-detecting local toolchains is not sufficient or disabled, there are additional ways you can let Gradle know about installed toolchains.</p>
</div>
<div class="paragraph">
<p>If your setup already provides environment variables pointing to installed JVMs, you can also let Gradle know about which environment variables to take into account.
Assuming the environment variables <code>JDK8</code> and <code>JRE17</code> point to valid java installations, the following instructs Gradle to resolve those environment variables and consider those installations when looking for a matching toolchain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org.gradle.java.installations.fromEnv=JDK8,JRE17</pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, you can provide a comma-separated list of paths to specific installations using the <code>org.gradle.java.installations.paths</code> property.
For example, using the following in your <code>gradle.properties</code> will let Gradle know which directories to look at when detecting toolchains.
Gradle will treat these directories as possible installations but will not descend into any nested directories.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org.gradle.java.installations.paths=/custom/path/jdk1.8,/shared/jre11</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Gradle does not prioritize custom toolchains over <a href="#sec:auto_detection">auto-detected</a> toolchains.
If you enable auto-detection in your build, custom toolchains extend the set of toolchain locations.
Gradle picks a toolchain according to the <a href="#sec:precedence">precedence rules</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:precedence"><a class="anchor" href="#sec:precedence"></a><a class="link" href="#sec:precedence">Toolchain installations precedence</a></h4>
<div class="paragraph">
<p>Gradle will sort all the JDK/JRE installations matching the toolchain specification of the build and will pick the first one.
Sorting is done based on the following rules:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the installation currently running Gradle is preferred over any other</p>
</li>
<li>
<p>JDK installations are preferred over JRE ones</p>
</li>
<li>
<p>certain vendors take precedence over others; their ordering (from the highest priority to lowest):</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ADOPTIUM</p>
</li>
<li>
<p>ADOPTOPENJDK</p>
</li>
<li>
<p>AMAZON</p>
</li>
<li>
<p>APPLE</p>
</li>
<li>
<p>AZUL</p>
</li>
<li>
<p>BELLSOFT</p>
</li>
<li>
<p>GRAAL_VM</p>
</li>
<li>
<p>HEWLETT_PACKARD</p>
</li>
<li>
<p>IBM</p>
</li>
<li>
<p>JETBRAINS</p>
</li>
<li>
<p>MICROSOFT</p>
</li>
<li>
<p>ORACLE</p>
</li>
<li>
<p>SAP</p>
</li>
<li>
<p>TENCENT</p>
</li>
<li>
<p>everything else</p>
</li>
</ol>
</div>
</li>
<li>
<p>higher major versions take precedence over lower ones</p>
</li>
<li>
<p>higher minor versions take precedence over lower ones</p>
</li>
<li>
<p>installation paths take precedence according to their lexicographic ordering (last resort criteria for deterministically deciding
between installations of the same type, from the same vendor and with the same version)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All these rules are applied as multilevel sorting criteria, <strong>in the order shown</strong>.
Let&#8217;s illustrate with an example.
A toolchain specification requests Java version 17.
Gradle detects the following matching installations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Oracle JRE v17.0.1</p>
</li>
<li>
<p>Oracle JDK v17.0.0</p>
</li>
<li>
<p>Microsoft JDK 17.0.0</p>
</li>
<li>
<p>Microsoft JRE 17.0.1</p>
</li>
<li>
<p>Microsoft JDK 17.0.1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assume that Gradle runs on a major Java version other than 17.
Otherwise, that installation would have priority.</p>
</div>
<div class="paragraph">
<p>When we apply the above rules to sort this set we will end up with following ordering:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Microsoft JDK 17.0.1</p>
</li>
<li>
<p>Microsoft JDK 17.0.0</p>
</li>
<li>
<p>Oracle JDK v17.0.0</p>
</li>
<li>
<p>Microsoft JRE v17.0.1</p>
</li>
<li>
<p>Oracle JRE v17.0.1</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Gradle prefers JDKs over JREs, so the JREs come last.
Gradle prefers the Microsoft vendor over Oracle, so the Microsoft installations come first.
Gradle prefers higher version numbers, so JDK 17.0.1 comes before JDK 17.0.0.</p>
</div>
<div class="paragraph">
<p>So Gradle picks the first match in this order: Microsoft JDK 17.0.1.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:plugins_toolchains"><a class="anchor" href="#sec:plugins_toolchains"></a><a class="link" href="#sec:plugins_toolchains">Toolchains for plugin authors</a></h4>
<div class="paragraph">
<p>When creating a plugin or a task that uses toolchains, it is essential to provide sensible defaults and allow users to override them.</p>
</div>
<div class="paragraph">
<p>For JVM projects, it is usually safe to assume that the <code>java</code> plugin has been applied to the project.
The <code>java</code> plugin is automatically applied for the core Groovy and Scala plugins, as well as for the Kotlin plugin.
In such a case, using the toolchain defined via the <code>java</code> extension as a default value for the tool property is appropriate.
This way, the users will need to configure the toolchain only once on the project level.</p>
</div>
<div class="paragraph">
<p>The example below showcases how to use the default toolchain as convention while allowing users to individually configure the toolchain per task.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class CustomTaskUsingToolchains : DefaultTask() {

    @get:Nested
    abstract val launcher: Property&lt;JavaLauncher&gt; // <b class="conum">(1)</b>

    init {
        val toolchain = project.extensions.getByType&lt;JavaPluginExtension&gt;().toolchain // <b class="conum">(2)</b>
        val defaultLauncher = javaToolchainService.launcherFor(toolchain) // <b class="conum">(3)</b>
        launcher.convention(defaultLauncher) // <b class="conum">(4)</b>
    }

    @TaskAction
    fun showConfiguredToolchain() {
        println(launcher.get().executablePath)
        println(launcher.get().metadata.installationPath)
    }

    @get:Inject
    protected abstract val javaToolchainService: JavaToolchainService
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">CustomTaskUsingToolchains</span> <span class="directive">extends</span> DefaultTask {

    <span class="annotation">@Nested</span>
    <span class="directive">abstract</span> Property&lt;JavaLauncher&gt; getLauncher() // <b class="conum">(1)</b>

    CustomTaskUsingToolchains() {
        <span class="keyword">def</span> toolchain = project.extensions.getByType(JavaPluginExtension.class).toolchain // <b class="conum">(2)</b>
        <span class="predefined-type">Provider</span>&lt;JavaLauncher&gt; defaultLauncher = getJavaToolchainService().launcherFor(toolchain) // <b class="conum">(3)</b>
        launcher.convention(defaultLauncher) // <b class="conum">(4)</b>
    }

    <span class="annotation">@TaskAction</span>
    <span class="keyword">def</span> <span class="function">showConfiguredToolchain</span>() {
        println launcher.get().executablePath
        println launcher.get().metadata.installationPath
    }

    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> <span class="directive">abstract</span> JavaToolchainService getJavaToolchainService()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We declare a <code>JavaLauncher</code> property on the task.
The property must be marked as a <a href="#sec:task_input_nested_inputs"><code>@Nested</code> input</a> to make sure the task is responsive to toolchain changes.</p>
</li>
<li>
<p>We obtain the toolchain spec from the <code>java</code> extension to use it as a default.</p>
</li>
<li>
<p>Using the <code>JavaToolchainService</code> we get a provider of the <code>JavaLauncher</code> that matches the toolchain.</p>
</li>
<li>
<p>Finally, we wire the launcher provider as a convention for our property.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In a project where the <code>java</code> plugin was applied, we can use the task as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}

java {
    toolchain { // <b class="conum">(1)</b>
        languageVersion = JavaLanguageVersion.of(8)
    }
}

tasks.register&lt;CustomTaskUsingToolchains&gt;(&quot;showDefaultToolchain&quot;) // <b class="conum">(2)</b>

tasks.register&lt;CustomTaskUsingToolchains&gt;(&quot;showCustomToolchain&quot;) {
    launcher = javaToolchains.launcherFor { // <b class="conum">(3)</b>
        languageVersion = JavaLanguageVersion.of(17)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

java {
    toolchain { // <b class="conum">(1)</b>
        languageVersion = JavaLanguageVersion.of(<span class="integer">8</span>)
    }
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">showDefaultToolchain</span><span class="delimiter">'</span></span>, CustomTaskUsingToolchains) // <b class="conum">(2)</b>

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">showCustomToolchain</span><span class="delimiter">'</span></span>, CustomTaskUsingToolchains) {
    launcher = javaToolchains.launcherFor { // <b class="conum">(3)</b>
        languageVersion = JavaLanguageVersion.of(<span class="integer">17</span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The toolchain defined on the <code>java</code> extension is used by default to resolve the launcher.</p>
</li>
<li>
<p>The custom task without additional configuration will use the default Java 8 toolchain.</p>
</li>
<li>
<p>The other task overrides the value of the launcher by selecting a different toolchain using <code>javaToolchains</code> service.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When a task needs access to toolchains without the <code>java</code> plugin being applied the toolchain service can be used directly.
If an <a href="#sec:configuring_toolchain_specifications">unconfigured</a> toolchain spec is provided to the service, it will always return a tool provider for the toolchain that is running Gradle.
This can be achieved by passing an empty lambda when requesting a tool: <code>javaToolchainService.launcherFor({})</code>.</p>
</div>
<div class="paragraph">
<p>You can find more details on defining custom tasks in the <a href="#more_about_tasks">Authoring tasks</a> documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:limitations"><a class="anchor" href="#sec:limitations"></a><a class="link" href="#sec:limitations">Toolchains limitations</a></h4>
<div class="paragraph">
<p>Gradle may detect toolchains incorrectly when it&#8217;s running in a JVM compiled against <code>musl</code>, an <a href="https://musl.libc.org/">alternative implementation</a> of the C standard library.
JVMs compiled against <code>musl</code> can sometimes override the <code>LD_LIBRARY_PATH</code> environment variable to control dynamic library resolution.
This can influence forked java processes launched by Gradle, resulting in unexpected behavior.</p>
</div>
<div class="paragraph">
<p>As a consequence, using multiple java toolchains is discouraged in environments with the <code>musl</code> library.
This is the case in most Alpine distributions — consider using another distribution, like Ubuntu, instead.
If you are using a single toolchain, the JVM running Gradle, to build and run your application, you can safely ignore this limitation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="toolchain_plugins"><a class="anchor" href="#toolchain_plugins"></a><a class="link" href="#toolchain_plugins">Toolchain Resolver Plugins</a></h3>
<div class="paragraph">
<p>In Gradle version 7.6 and above, Gradle provides a way to define Java toolchain auto-provisioning logic in plugins.
This page explains how to author a toolchain resolver plugin.
For details on how toolchain auto-provisioning interacts with these plugins, see <a href="#sub:download_repositories">Toolchains</a>.</p>
</div>
<div class="sect3">
<h4 id="provide_a_download_uri"><a class="anchor" href="#provide_a_download_uri"></a><a class="link" href="#provide_a_download_uri">Provide a download URI</a></h4>
<div class="paragraph">
<p>Toolchain resolver plugins provide logic to map a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/jvm/toolchain/JavaToolchainRequest.html">toolchain request</a> to a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/jvm/toolchain/JavaToolchainDownload.html">download response</a>.
At the moment the download response only contains a download URL, but may be extended in the future.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
For the download URL only secure protocols like <code>https</code> are accepted.
This is required to make sure no one can tamper with the download in flight.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The plugins provide the mapping logic via an implementation of <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/jvm/toolchain/JavaToolchainResolver.html">JavaToolchainResolver</a>:</p>
</div>
<div class="listingblock">
<div class="title">JavaToolchainResolverImplementation.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">JavaToolchainResolverImplementation</span>
        <span class="directive">implements</span> JavaToolchainResolver { // <b class="conum">(1)</b>

    <span class="directive">public</span> Optional&lt;JavaToolchainDownload&gt; resolve(JavaToolchainRequest request) { // <b class="conum">(2)</b>
        <span class="keyword">return</span> Optional.empty(); <span class="comment">// custom mapping logic goes here instead</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This class is <code>abstract</code> because <code>JavaToolchainResolver</code> is a <a href="#build_services">build service</a>. Gradle provides dynamic implementations for certain abstract methods at runtime.</p>
</li>
<li>
<p>The mapping method returns a download response wrapped in an <code>Optional</code>. If the resolver implementation can&#8217;t provide a matching toolchain, the enclosing <code>Optional</code> contains an empty value.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="register_the_resolver_in_a_plugin"><a class="anchor" href="#register_the_resolver_in_a_plugin"></a><a class="link" href="#register_the_resolver_in_a_plugin">Register the resolver in a plugin</a></h4>
<div class="paragraph">
<p>Use a settings plugin (<code>Plugin&lt;Settings&gt;</code>) to register the <code>JavaToolchainResolver</code> implementation:</p>
</div>
<div class="listingblock">
<div class="title">JavaToolchainResolverPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">JavaToolchainResolverPlugin</span> <span class="directive">implements</span> Plugin&lt;Settings&gt; { // <b class="conum">(1)</b>
    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> <span class="directive">abstract</span> JavaToolchainResolverRegistry getToolchainResolverRegistry(); // <b class="conum">(2)</b>

    <span class="directive">public</span> <span class="type">void</span> apply(Settings settings) {
        settings.getPlugins().apply(<span class="string"><span class="delimiter">&quot;</span><span class="content">jvm-toolchain-management</span><span class="delimiter">&quot;</span></span>); // <b class="conum">(3)</b>

        JavaToolchainResolverRegistry registry = getToolchainResolverRegistry();
        registry.register(JavaToolchainResolverImplementation.class);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The plugin uses <a href="service_injection.html#property_injection">property injection</a>, so it must be <code>abstract</code> and a settings plugin.</p>
</li>
<li>
<p>To register the resolver implementation, use property injection to access the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/jvm/toolchain/JavaToolchainResolverRegistry.html">JavaToolchainResolverRegistry</a> Gradle service.</p>
</li>
<li>
<p>Resolver plugins must apply the <code>jvm-toolchain-management</code> base plugin. This dynamically adds the <code>jvm</code> block to <code>toolchainManagement</code>, which makes registered toolchain repositories usable from the build.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jvm_plugins"><a class="anchor" href="#jvm_plugins"></a><a class="link" href="#jvm_plugins">JVM PLUGINS</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="java_library_plugin"><a class="anchor" href="#java_library_plugin"></a><a class="link" href="#java_library_plugin">The Java Library Plugin</a></h3>
<div class="paragraph">
<p>The Java Library plugin expands the capabilities of the <a href="java_plugin.html#java_plugin">Java Plugin (<code>java</code>)</a> by providing specific knowledge about Java libraries.
In particular, a Java library exposes an API to consumers (i.e., other projects using the Java or the Java Library plugin).
All the source sets, tasks and configurations exposed by the Java plugin are implicitly available when using this plugin.</p>
</div>
<div class="sect3">
<h4 id="sec:java_library_usage"><a class="anchor" href="#sec:java_library_usage"></a><a class="link" href="#sec:java_library_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Java Library plugin, include the following in your build script:</p>
</div>
<div id="ex-using-the-java-library-plugin" class="exampleblock">
<div class="title">Example 53. <a href="#ex-using-the-java-library-plugin">Using the Java Library plugin</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_library_separation"><a class="anchor" href="#sec:java_library_separation"></a><a class="link" href="#sec:java_library_separation">API and implementation separation</a></h4>
<div class="paragraph">
<p>The key difference between the standard Java plugin and the Java Library plugin is that the latter introduces the concept of an <em>API</em> exposed to consumers. A library is a Java component meant to be consumed by other components. It&#8217;s a very common use case in multi-project builds, but also as soon as you have external dependencies.</p>
</div>
<div class="paragraph">
<p>The plugin exposes two <a href="#sec:what-are-dependency-configurations">configurations</a> that can be used to declare dependencies: <code>api</code> and <code>implementation</code>.
The <code>api</code> configuration should be used to declare dependencies which are exported by the library API, whereas the <code>implementation</code> configuration should be used to declare dependencies which are internal to the component.</p>
</div>
<div id="ex-declaring-api-and-implementation-dependencies" class="exampleblock">
<div class="title">Example 54. <a href="#ex-declaring-api-and-implementation-dependencies">Declaring API and implementation dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    api(&quot;org.apache.httpcomponents:httpclient:4.5.7&quot;)
    implementation(&quot;org.apache.commons:commons-lang3:3.5&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    api <span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient:4.5.7</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-lang3:3.5</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Dependencies appearing in the <code>api</code> configurations will be transitively exposed to consumers of the library, and as such will appear on the compile classpath of consumers. Dependencies found in the <code>implementation</code> configuration will, on the other hand, not be exposed to consumers, and therefore not leak into the consumers' compile classpath. This comes with several benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dependencies do not leak into the compile classpath of consumers anymore, so you will never accidentally depend on a transitive dependency</p>
</li>
<li>
<p>faster compilation thanks to reduced classpath size</p>
</li>
<li>
<p>less recompilations when implementation dependencies change: consumers would not need to be recompiled</p>
</li>
<li>
<p>cleaner publishing: when used in conjunction with the new <code>maven-publish</code> plugin, Java libraries produce POM files that distinguish exactly between what is required to compile against the library and what is required to use the library at runtime (in other words, don&#8217;t mix what is needed to compile the library itself and what is needed to compile against the library).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>compile</code> and <code>runtime</code> configurations have been removed with Gradle 7.0.
Please refer to the <a href="upgrading_version_6.html#sec:configuration_removal">upgrade guide</a> how to migrate to <code>implementation</code> and <code>api</code> configurations`.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If your build consumes a published module with POM metadata, the Java and Java Library plugins both honor api and implementation separation through the scopes used in the POM.
Meaning that the compile classpath only includes Maven <code>compile</code> scoped dependencies, while the runtime classpath adds the Maven <code>runtime</code> scoped dependencies as well.</p>
</div>
<div class="paragraph">
<p>This often does not have an effect on modules published with Maven, where the POM that defines the project is directly published as metadata.
There, the compile scope includes both dependencies that were required to compile the project (i.e. implementation dependencies) and dependencies required to compile against the published library (i.e. API dependencies).
For most published libraries, this means that all dependencies belong to the compile scope.
If you encounter such an issue with an existing library, you can consider a <a href="#sec:component_metadata_rules">component metadata rule</a> to fix the incorrect metadata in your build.
However, as mentioned above, if the library is published with Gradle, the produced POM file only puts <code>api</code> dependencies into the compile scope and the remaining <code>implementation</code> dependencies into the runtime scope.</p>
</div>
<div class="paragraph">
<p>If your build consumes modules with Ivy metadata, you might be able to activate api and implementation separation as described <a href="#sub:ivy-mapping-to-variants">here</a> if all modules follow a certain structure.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Separating compile and runtime scope of modules is active by default in Gradle 5.0+.
In Gradle 4.6+, you need to activate it by adding <code>enableFeaturePreview('IMPROVED_POM_SUPPORT')</code> in <em>settings.gradle</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_library_recognizing_dependencies"><a class="anchor" href="#sec:java_library_recognizing_dependencies"></a><a class="link" href="#sec:java_library_recognizing_dependencies">Recognizing API and implementation dependencies</a></h4>
<div class="paragraph">
<p>This section will help you identify API and Implementation dependencies in your code using simple rules of thumb. The first of these is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prefer the <code>implementation</code> configuration over <code>api</code> when possible</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This keeps the dependencies off of the consumer&#8217;s compilation classpath. In addition, the consumers will immediately fail to compile if any implementation types accidentally leak into the public API.</p>
</div>
<div class="paragraph">
<p>So when should you use the <code>api</code> configuration? An API dependency is one that contains at least one type that is exposed in the library binary interface, often referred to as its ABI (Application Binary Interface). This includes, but is not limited to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>types used in super classes or interfaces</p>
</li>
<li>
<p>types used in public method parameters, including generic parameter types (where <em>public</em> is something that is visible to compilers. I.e. , <em>public</em>, <em>protected</em> and <em>package private</em> members in the Java world)</p>
</li>
<li>
<p>types used in public fields</p>
</li>
<li>
<p>public annotation types</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By contrast, any type that is used in the following list is irrelevant to the ABI, and therefore should be declared as an <code>implementation</code> dependency:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>types exclusively used in method bodies</p>
</li>
<li>
<p>types exclusively used in private members</p>
</li>
<li>
<p>types exclusively found in internal classes (future versions of Gradle will let you declare which packages belong to the public API)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following class makes use of a couple of third-party libraries, one of which is exposed in the class&#8217;s public API and the other is only used internally. The import statements don&#8217;t help us determine which is which, so we have to look at the fields, constructors and methods instead:</p>
</div>
<div class="sect4">
<h5 id="example_making_the_difference_between_api_and_implementation"><a class="anchor" href="#example_making_the_difference_between_api_and_implementation"></a><a class="link" href="#example_making_the_difference_between_api_and_implementation">Example: Making the difference between API and implementation</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">src/main/java/org/gradle/HttpClientWrapper.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// The following types can appear anywhere in the code</span>
<span class="comment">// but say nothing about API or implementation usage</span>
<span class="keyword">import</span> <span class="include">org.apache.commons.lang3.exception.ExceptionUtils</span>;
<span class="keyword">import</span> <span class="include">org.apache.http.HttpEntity</span>;
<span class="keyword">import</span> <span class="include">org.apache.http.HttpResponse</span>;
<span class="keyword">import</span> <span class="include">org.apache.http.HttpStatus</span>;
<span class="keyword">import</span> <span class="include">org.apache.http.client.HttpClient</span>;
<span class="keyword">import</span> <span class="include">org.apache.http.client.methods.HttpGet</span>;

<span class="keyword">import</span> <span class="include">java.io.ByteArrayOutputStream</span>;
<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.io.UnsupportedEncodingException</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">HttpClientWrapper</span> {

    <span class="directive">private</span> <span class="directive">final</span> HttpClient client; <span class="comment">// private member: implementation details</span>

    <span class="comment">// HttpClient is used as a parameter of a public method</span>
    <span class="comment">// so &quot;leaks&quot; into the public API of this component</span>
    <span class="directive">public</span> HttpClientWrapper(HttpClient client) {
        <span class="local-variable">this</span>.client = client;
    }

    <span class="comment">// public methods belongs to your API</span>
    <span class="directive">public</span> <span class="type">byte</span><span class="type">[]</span> doRawGet(<span class="predefined-type">String</span> url) {
        HttpGet request = <span class="keyword">new</span> HttpGet(url);
        <span class="keyword">try</span> {
            HttpEntity entity = doGet(request);
            <span class="predefined-type">ByteArrayOutputStream</span> baos = <span class="keyword">new</span> <span class="predefined-type">ByteArrayOutputStream</span>();
            entity.writeTo(baos);
            <span class="keyword">return</span> baos.toByteArray();
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
            ExceptionUtils.rethrow(e); <span class="comment">// this dependency is internal only</span>
        } <span class="keyword">finally</span> {
            request.releaseConnection();
        }
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }

    <span class="comment">// HttpGet and HttpEntity are used in a private method, so they don't belong to the API</span>
    <span class="directive">private</span> HttpEntity doGet(HttpGet get) <span class="directive">throws</span> <span class="exception">Exception</span> {
        HttpResponse response = client.execute(get);
        <span class="keyword">if</span> (response.getStatusLine().getStatusCode() != HttpStatus.SC_OK) {
            <span class="predefined-type">System</span>.err.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Method failed: </span><span class="delimiter">&quot;</span></span> + response.getStatusLine());
        }
        <span class="keyword">return</span> response.getEntity();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>public</em> constructor of <code>HttpClientWrapper</code> uses <code>HttpClient</code> as a parameter, so it is exposed to consumers and therefore belongs to the API. Note that <code>HttpGet</code> and <code>HttpEntity</code> are used in the signature of a <em>private</em> method, and so they don&#8217;t count towards making HttpClient an API dependency.</p>
</div>
<div class="paragraph">
<p>On the other hand, the <code>ExceptionUtils</code> type, coming from the <code>commons-lang</code> library, is only used in a method body (not in its signature), so it&#8217;s an implementation dependency.</p>
</div>
<div class="paragraph">
<p>Therefore, we can deduce that <code>httpclient</code> is an API dependency, whereas <code>commons-lang</code> is an implementation dependency. This conclusion translates into the following declaration in the build script:</p>
</div>
<div id="ex-declaring-api-and-implementation-dependencies" class="exampleblock">
<div class="title">Example 55. <a href="#ex-declaring-api-and-implementation-dependencies">Declaring API and implementation dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    api(&quot;org.apache.httpcomponents:httpclient:4.5.7&quot;)
    implementation(&quot;org.apache.commons:commons-lang3:3.5&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    api <span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient:4.5.7</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-lang3:3.5</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_library_configurations_graph"><a class="anchor" href="#sec:java_library_configurations_graph"></a><a class="link" href="#sec:java_library_configurations_graph">The Java Library plugin configurations</a></h4>
<div class="paragraph">
<p>The following graph describes how configurations are setup when the Java Library plugin is in use.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/java-library-ignore-deprecated-main.png" alt="java library ignore deprecated main">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The configurations in <em>green</em> are the ones a user should use to declare dependencies</p>
</li>
<li>
<p>The configurations in <em>pink</em> are the ones used when a component compiles, or runs against the library</p>
</li>
<li>
<p>The configurations in <em>blue</em> are internal to the component, for its own use</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And the next graph describes the test configurations setup:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/java-library-ignore-deprecated-test.png" alt="java library ignore deprecated test">
</div>
</div>
<div class="paragraph">
<p>The role of each configuration is described in the following tables:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 4. Java Library plugin - configurations used to declare dependencies</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration name</th>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Consumable?</th>
<th class="tableblock halign-left valign-top">Resolvable?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring API dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you declare dependencies which are transitively exported to consumers, for compile time and runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>implementation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring implementation dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you declare dependencies which are purely internal and not meant to be exposed to consumers (they are still exposed to consumers at runtime).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compileOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring compile only dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you declare dependencies which are required at compile time, but not at runtime. This typically includes dependencies which are shaded when found at runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compileOnlyApi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring compile only API dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you declare dependencies which are required at compile time by your module and consumers, but not at runtime. This typically includes dependencies which are shaded when found at runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>runtimeOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring runtime dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you declare dependencies which are only required at runtime, and not at compile time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>testImplementation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you declare dependencies which are used to compile tests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>testCompileOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring test compile only dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you declare dependencies which are only required at test compile time, but should not leak into the runtime. This typically includes dependencies which are shaded when found at runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>testRuntimeOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring test runtime dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you declare dependencies which are only required at test runtime, and not at test compile time.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 5. Java Library plugin — configurations used by consumers</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration name</th>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Consumable?</th>
<th class="tableblock halign-left valign-top">Resolvable?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apiElements</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For compiling against this library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration is meant to be used by consumers, to retrieve all the elements necessary to compile against this library.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>runtimeElements</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For executing this library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration is meant to be used by consumers, to retrieve all the elements necessary to run against this library.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 6. Java Library plugin - configurations used by the library itself</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration name</th>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Consumable?</th>
<th class="tableblock halign-left valign-top">Resolvable?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compileClasspath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For compiling this library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration contains the compile classpath of this library, and is therefore used when invoking the java compiler to compile it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">runtimeClasspath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For executing this library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration contains the runtime classpath of this library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">testCompileClasspath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For compiling the tests of this library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration contains the test compile classpath of this library.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">testRuntimeClasspath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For executing tests of this library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration contains the test runtime classpath of this library</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:java_library_modular"><a class="anchor" href="#sec:java_library_modular"></a><a class="link" href="#sec:java_library_modular">Building Modules for the Java Module System</a></h4>
<div class="paragraph">
<p>Since Java 9, Java itself offers a <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html">module system</a> that allows for strict encapsulation during compile and runtime.
You can turn a Java library into a <em>Java Module</em> by creating a <code>module-info.java</code> file in the <code>main/java</code> source folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>src
└── main
    └── java
        └── module-info.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the module info file, you declare a <em>module name</em>, which packages of your module you want to <em>export</em> and which other modules you <em>require</em>.</p>
</div>
<div class="listingblock">
<div class="title">module-info.java file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">module org.gradle.sample {
    requires com.google.gson;          <span class="comment">// real module</span>
    requires org.apache.commons.lang3; <span class="comment">// automatic module</span>
    <span class="comment">// commons-cli-1.4.jar is not a module and cannot be required</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To tell the Java compiler that a Jar is a module, as opposed to a traditional Java library, Gradle needs to place it on the so called <em>module path</em>.
It is an alternative to the <em>classpath</em>, which is the traditional way to tell the compiler about compiled dependencies.
Gradle will automatically put a Jar of your dependencies on the module path, instead of the classpath, if these three things are true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.modularity.inferModulePath</code> is <strong>not</strong> turned off</p>
</li>
<li>
<p>We are actually building a module (as opposed to a traditional library) which we expressed by adding the <code>module-info.java</code> file.
(Another option is to add the <code>Automatic-Module-Name</code> Jar manifest attribute as <a href="#sec:java_library_modular_auto">described further down</a>.)</p>
</li>
<li>
<p>The Jar our module depends on is itself a module, which Gradles decides based on the presence of a <code>module-info.class</code>&#8201;&#8212;&#8201;the compiled version of the module descriptor&#8201;&#8212;&#8201;in the Jar.
(Or, alternatively, the presence of an <code>Automatic-Module-Name</code> attribute the Jar manifest)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following, some more details about defining Java modules and how that interacts with Gradle&#8217;s dependency management are described.
You can also look at a <a href="../samples/sample_java_modules_multi_project.html">ready made example</a> to try out the Java Module support directly.</p>
</div>
<div class="sect4">
<h5 id="declaring_module_dependencies"><a class="anchor" href="#declaring_module_dependencies"></a><a class="link" href="#declaring_module_dependencies">Declaring module dependencies</a></h5>
<div class="paragraph">
<p>There is a direct relationship to the dependencies you declare in the build file and the module dependencies you declare in the <code>module-info.java</code> file.
Ideally the declarations should be in sync as seen in the following table.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 7. Mapping between Java module directives and Gradle configurations to declare dependencies</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Java Module Directive</th>
<th class="tableblock halign-left valign-top">Gradle Configuration</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requires</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>implementation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring implementation dependencies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requires transitive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring API dependencies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requires static</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compileOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring compile only dependencies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requires static transitive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compileOnlyApi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring compile only API dependencies</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Gradle currently does not automatically check if the dependency declarations are in sync.
This may be added in future versions.</p>
</div>
<div class="paragraph">
<p>For more details on declaring module dependencies, please refer to <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html">documentation on the Java Module System</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="declaring_package_visibility_and_services"><a class="anchor" href="#declaring_package_visibility_and_services"></a><a class="link" href="#declaring_package_visibility_and_services">Declaring package visibility and services</a></h5>
<div class="paragraph">
<p>The Java module system supports additional more fine granular encapsulation concepts than Gradle itself currently does.
For example, you explicitly need to declare which packages are part of your API and which are only visible inside your module.
Some of these capabilities might be added to Gradle itself in future versions.
For now, please refer to <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html">documentation on the Java Module System</a> to learn how to use these features in Java Modules.</p>
</div>
</div>
<div class="sect4">
<h5 id="declaring_module_versions"><a class="anchor" href="#declaring_module_versions"></a><a class="link" href="#declaring_module_versions">Declaring module versions</a></h5>
<div class="paragraph">
<p>Java Modules also have a version that is encoded as part of the module identity in the <code>module-info.class</code> file.
This version can be inspected when a module is running.</p>
</div>
<div id="ex-declare-the-module-version-in-the-build-script-or-directly-as-compile-task-option" class="exampleblock">
<div class="title">Example 56. <a href="#ex-declare-the-module-version-in-the-build-script-or-directly-as-compile-task-option">Declare the module version in the build script or directly as compile task option</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">version = &quot;1.2&quot;

tasks.compileJava {
    // use the project's version or define one directly
    options.javaModuleVersion = provider { version as String }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">version = <span class="string"><span class="delimiter">'</span><span class="content">1.2</span><span class="delimiter">'</span></span>

tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">compileJava</span><span class="delimiter">'</span></span>) {
    <span class="comment">// use the project's version or define one directly</span>
    options.javaModuleVersion = provider { version }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using_libraries_that_are_not_modules"><a class="anchor" href="#using_libraries_that_are_not_modules"></a><a class="link" href="#using_libraries_that_are_not_modules">Using libraries that are not modules</a></h5>
<div class="paragraph">
<p>You probably want to use external libraries, like OSS libraries from Maven Central, in your modular Java project.
Some libraries, in their newer versions, are already full modules with a module descriptor.
For example, <code>com.google.code.gson:gson:2.8.9</code> that has the module name <code>com.google.gson</code>.</p>
</div>
<div class="paragraph">
<p>Others, like <code>org.apache.commons:commons-lang3:3.10</code>, may not offer a full module descriptor but will at least contain an <code>Automatic-Module-Name</code> entry in their manifest file to define the module&#8217;s name (<code>org.apache.commons.lang3</code> in the example).
Such modules, that only have a name as module description, are called <em>automatic module</em> that export <strong>all</strong> their packages and can read <strong>all</strong> modules on the module path.</p>
</div>
<div class="paragraph">
<p>A third case are traditional libraries that provide no module information at all&#8201;&#8212;&#8201;for example <code>commons-cli:commons-cli:1.4</code>.
Gradle puts such libraries on the classpath instead of the module path.
The classpath is then treated as one module (the so called <em>unnamed</em> module) by Java.</p>
</div>
<div id="ex-dependencies-to-modules-and-libraries-declared-in-build-file" class="exampleblock">
<div class="title">Example 57. <a href="#ex-dependencies-to-modules-and-libraries-declared-in-build-file">Dependencies to modules and libraries declared in build file</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;com.google.code.gson:gson:2.8.9&quot;)       // real module
    implementation(&quot;org.apache.commons:commons-lang3:3.10&quot;) // automatic module
    implementation(&quot;commons-cli:commons-cli:1.4&quot;)           // plain library
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.code.gson:gson:2.8.9</span><span class="delimiter">'</span></span>       <span class="comment">// real module</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-lang3:3.10</span><span class="delimiter">'</span></span> <span class="comment">// automatic module</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-cli:commons-cli:1.4</span><span class="delimiter">'</span></span>           <span class="comment">// plain library</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Module dependencies declared in module-info.java file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">module org.gradle.sample.lib {
    requires com.google.gson;          <span class="comment">// real module</span>
    requires org.apache.commons.lang3; <span class="comment">// automatic module</span>
    <span class="comment">// commons-cli-1.4.jar is not a module and cannot be required</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>While a real module cannot directly depend on the unnamed module (only by adding command line flags), automatic modules can also see the unnamed module.
Thus, if you cannot avoid to rely on a library without module information, you can wrap that library in an automatic module as part of your project.
How you do that is described in the next section.</p>
</div>
<div class="paragraph">
<p>Another way to deal with non-modules is to enrich existing Jars with module descriptors yourself using <a href="#sec:abm_artifact_transforms">artifact transforms</a>.
<a href="../samples/sample_java_modules_with_transform.html">This sample</a> contains a small <em>buildSrc</em> plugin registering such a transform which you may use and adjust to your needs.
This can be interesting if you want to build a fully <a href="#sec:application_modular">modular application</a> and want the java runtime to treat everything as a real module.</p>
</div>
</div>
<div class="sect4">
<h5 id="disabling_java_module_support"><a class="anchor" href="#disabling_java_module_support"></a><a class="link" href="#disabling_java_module_support">Disabling Java Module support</a></h5>
<div class="paragraph">
<p>In rare cases, you might want to disable the built-in Java Module support and define the module path by other means.
To achieve this, you can disable the functionality to automatically put any Jar on the module path.
Then Gradle puts Jars with module information on the classpath, even if you have a <code>module-info.java</code> in your source set.
This corresponds to the behaviour of Gradle versions &lt;7.0.</p>
</div>
<div class="paragraph">
<p>To make this work, you need to set <code>modularity.inferModulePath = false</code> on the Java extension (for all tasks) or on individual tasks.</p>
</div>
<div id="ex-disable-gradles-module-path-inference" class="exampleblock">
<div class="title">Example 58. <a href="#ex-disable-gradles-module-path-inference">Disable Gradle&#8217;s module path inference</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    modularity.inferModulePath = false
}

tasks.compileJava {
    modularity.inferModulePath = false
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    modularity.inferModulePath = <span class="predefined-constant">false</span>
}

tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">compileJava</span><span class="delimiter">'</span></span>) {
    modularity.inferModulePath = <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:java_library_modular_auto"><a class="anchor" href="#sec:java_library_modular_auto"></a><a class="link" href="#sec:java_library_modular_auto">Building an automatic module</a></h5>
<div class="paragraph">
<p>If you can, you should always write complete <code>module-info.java</code> descriptors for your modules.
Still, there are a few cases where you might consider to (initally) only provide a <em>module name</em> for an automatic module:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You are working on a library that is <strong>not</strong> a module but you want to make it usable as such in the next release.
Adding an <code>Automatic-Module-Name</code> is a good first step (most popular OSS libraries on Maven central have done it by now).</p>
</li>
<li>
<p>As discussed in the previous section, an automatic module can be used as an adapter between your real modules and a traditional library on the classpath.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To turn a normal Java project into an <em>automatic module</em>, just add the manifest entry with the module name:</p>
</div>
<div id="ex-declare-an-automatic-module-name-as-jar-manifest-attribute" class="exampleblock">
<div class="title">Example 59. <a href="#ex-declare-an-automatic-module-name-as-jar-manifest-attribute">Declare an automatic module name as Jar manifest attribute</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.jar {
    manifest {
        attributes(&quot;Automatic-Module-Name&quot; to &quot;org.gradle.sample&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>) {
    manifest {
        attributes(<span class="string"><span class="delimiter">'</span><span class="content">Automatic-Module-Name</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
===
You can define an automatic module as part of a multi-project that otherwise defines real modules (e.g. as an adapter to another library).
While this works fine in the Gradle build, such automatic module projects are not correctly recognized by IDEA/Eclipse at the moment.
You can work around it by manually adding the Jar built for the automatic module to the dependencies of the project that does not find it in the IDE&#8217;s UI.
===
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_library_classes_usage"><a class="anchor" href="#sec:java_library_classes_usage"></a><a class="link" href="#sec:java_library_classes_usage">Using classes instead of jar for compilation</a></h4>
<div class="paragraph">
<p>A feature of the <code>java-library</code> plugin is that projects which consume the library only require the classes folder for compilation, instead of the full JAR.
This enables lighter inter-project dependencies as resources processing (<code>processResources</code> task) and archive construction (<code>jar</code> task) are no longer executed when only Java code compilation is performed during development.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The usage or not of the classes output instead of the JAR is a <em>consumer</em> decision.
For example, Groovy consumers will request classes <em>and</em> processed resources as these may be needed for executing AST transformation as part of the compilation process.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sub:java_library_known_issues_memory"><a class="anchor" href="#sub:java_library_known_issues_memory"></a><a class="link" href="#sub:java_library_known_issues_memory">Increased memory usage for consumers</a></h5>
<div class="paragraph">
<p>An indirect consequence is that up-to-date checking will require more memory, because Gradle will snapshot individual class files instead of a single jar.
This may lead to increased memory consumption for large projects, with the benefit of having the <code>compileJava</code> task up-to-date in more cases (e.g. changing resources no longer changes the input for <code>compileJava</code> tasks of upstream projects)</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:java_library_known_issues_windows_performance"><a class="anchor" href="#sub:java_library_known_issues_windows_performance"></a><a class="link" href="#sub:java_library_known_issues_windows_performance">Significant build performance drop on Windows for huge multi-projects</a></h5>
<div class="paragraph">
<p>Another side effect of the snapshotting of individual class files, only affecting Windows systems, is that the performance can significantly drop when processing a very large amount of class files on the compile classpath.
This only concerns very large multi-projects where a lot of classes are present on the classpath by using many <code>api</code> dependencies.
To mitigate this, you can set the <code>org.gradle.java.compile-classpath-packaging</code> system property to <code>true</code> to change the behavior of the Java Library plugin to use jars instead of class folders for everything on the compile classpath.
Note, since this has other performance impacts and potentially side effects, by triggering all jar tasks at compile time, it is only recommended to activate this if you suffer from the described performance issue on Windows.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:library_distribution"><a class="anchor" href="#sec:library_distribution"></a><a class="link" href="#sec:library_distribution">Distributing a library</a></h4>
<div class="paragraph">
<p>Aside from <a href="#publishing_components">publishing</a> a library to a component repository, you may sometimes need to package a library and its dependencies in a distribution deliverable.
The <a href="java_library_distribution_plugin.html#java_library_distribution_plugin">Java Library Distribution Plugin</a> is there to help you do just that.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="application_plugin"><a class="anchor" href="#application_plugin"></a><a class="link" href="#application_plugin">The Application Plugin</a></h3>
<div class="paragraph">
<p>The Application plugin facilitates creating an executable JVM application. It makes it easy to start the application locally during development, and to package the application as a TAR and/or ZIP including operating system specific start scripts.</p>
</div>
<div class="paragraph">
<p>Applying the Application plugin also implicitly applies the <a href="java_plugin.html#java_plugin">Java plugin</a>. The <code>main</code> source set is effectively the “application”.</p>
</div>
<div class="paragraph">
<p>Applying the Application plugin also implicitly applies the <a href="distribution_plugin.html#distribution_plugin">Distribution plugin</a>. A <code>main</code> distribution is created that packages up the application, including code dependencies and generated start scripts.</p>
</div>
<div class="sect3">
<h4 id="sec:application_usage"><a class="anchor" href="#sec:application_usage"></a><a class="link" href="#sec:application_usage">Building JVM applications</a></h4>
<div class="paragraph">
<p>To use the application plugin, include the following in your build script:</p>
</div>
<div id="ex-using-the-application-plugin" class="exampleblock">
<div class="title">Example 60. <a href="#ex-using-the-application-plugin">Using the application plugin</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    application
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">application</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The only mandatory configuration for the plugin is the specification of the main class (i.e. entry point) of the application.</p>
</div>
<div id="ex-configure-the-application-main-class" class="exampleblock">
<div class="title">Example 61. <a href="#ex-configure-the-application-main-class">Configure the application main class</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    mainClass = &quot;org.gradle.sample.Main&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    mainClass = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample.Main</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can run the application by executing the <code>run</code> task (type: <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/JavaExec.html">JavaExec</a>). This will compile the main source set, and launch a new JVM with its classes (along with all runtime dependencies) as the classpath and using the specified main class. You can launch the application in debug mode with <code>gradle run --debug-jvm</code> (see <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/JavaExec.html#setDebug-boolean-">JavaExec.setDebug(boolean)</a>).</p>
</div>
<div class="paragraph">
<p>Since Gradle 4.9, the command line arguments can be passed with <code>--args</code>. For example, if you want to launch the application with command line arguments <code>foo --bar</code>, you can use <code>gradle run --args="foo --bar"</code> (see <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/JavaExec.html#setArgsString-java.lang.String-">JavaExec.setArgsString(java.lang.String)</a>.</p>
</div>
<div class="paragraph">
<p>If your application requires a specific set of JVM settings or system properties, you can configure the <code>applicationDefaultJvmArgs</code> property. These JVM arguments are applied to the <code>run</code> task and also considered in the generated start scripts of your distribution.</p>
</div>
<div id="ex-configure-default-jvm-settings" class="exampleblock">
<div class="title">Example 62. <a href="#ex-configure-default-jvm-settings">Configure default JVM settings</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    applicationDefaultJvmArgs = listOf(&quot;-Dgreeting.language=en&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    applicationDefaultJvmArgs = [<span class="string"><span class="delimiter">'</span><span class="content">-Dgreeting.language=en</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If your application&#8217;s start scripts should be in a different directory than <code>bin</code>, you can configure the <code>executableDir</code> property.</p>
</div>
<div id="ex-configure-custom-directory-for-start-scripts" class="exampleblock">
<div class="title">Example 63. <a href="#ex-configure-custom-directory-for-start-scripts">Configure custom directory for start scripts</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    executableDir = &quot;custom_bin_dir&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    executableDir = <span class="string"><span class="delimiter">'</span><span class="content">custom_bin_dir</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:application_modular"><a class="anchor" href="#sec:application_modular"></a><a class="link" href="#sec:application_modular">Building applications using the Java Module System</a></h4>
<div class="paragraph">
<p>Gradle supports the building of <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html">Java Modules</a> as described in the <a href="#sec:java_library_modular">corresponding section of the Java Library plugin documentation</a>.
Java modules can also be runnable and you can use the application plugin to run and package such a modular application.
For this, you need to do two things in addition to what you do for a non-modular application.</p>
</div>
<div class="paragraph">
<p>First, you need to add a <code>module-info.java</code> file to describe your application module.
Please refer to the <a href="#sec:java_library_modular">Java Library plugin documentation</a> for more details on this topic.</p>
</div>
<div class="paragraph">
<p>Second, you need to tell Gradle the name of the module you want to run in addition to the main class name like this:</p>
</div>
<div id="ex-configure-the-modular-applications-main-module" class="exampleblock">
<div class="title">Example 64. <a href="#ex-configure-the-modular-applications-main-module">Configure the modular application&#8217;s main module</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    mainModule = &quot;org.gradle.sample.app&quot; // name defined in module-info.java
    mainClass = &quot;org.gradle.sample.Main&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    mainModule = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample.app</span><span class="delimiter">'</span></span> <span class="comment">// name defined in module-info.java</span>
    mainClass = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample.Main</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all.
If you run your application, by executing the <code>run</code> task or through a <a href="#sec:the_distribution">generated start script</a>, it will run as module and respect module boundaries at runtime.
For example, reflective access to an internal package from another module can fail.</p>
</div>
<div class="paragraph">
<p>The configured <em>main class</em> is also baked into the <code>module-info.class</code> file of your application Jar.
If you run the modular application directly using the <code>java</code> command, it is then sufficient to provide the module name.</p>
</div>
<div class="paragraph">
<p>You can also look at a <a href="../samples/sample_java_modules_multi_project.html">ready made example</a> that includes a modular application as part of a multi-project.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:the_distribution"><a class="anchor" href="#sec:the_distribution"></a><a class="link" href="#sec:the_distribution">Building a distribution</a></h4>
<div class="paragraph">
<p>A distribution of the application can be created, by way of the <a href="distribution_plugin.html#distribution_plugin">Distribution plugin</a> (which is automatically applied). A <code>main</code> distribution is created with the following content:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 8. Distribution content</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Content</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(root dir)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>src/dist</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lib</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All runtime dependencies and main source set class files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start scripts (generated by <code>startScripts</code> task).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Static files to be added to the distribution can be simply added to <code>src/dist</code>. More advanced customization can be done by configuring the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopySpec.html">CopySpec</a> exposed by the main distribution.</p>
</div>
<div id="ex-include-output-from-other-tasks-in-the-application-distribution" class="exampleblock">
<div class="title">Example 65. <a href="#ex-include-output-from-other-tasks-in-the-application-distribution">Include output from other tasks in the application distribution</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val createDocs by tasks.registering {
    val docs = layout.buildDirectory.dir(&quot;docs&quot;)
    outputs.dir(docs)
    doLast {
        docs.get().asFile.mkdirs()
        docs.get().file(&quot;readme.txt&quot;).asFile.writeText(&quot;Read me!&quot;)
    }
}

distributions {
    main {
        contents {
            from(createDocs) {
                into(&quot;docs&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">createDocs</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> docs = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">docs</span><span class="delimiter">'</span></span>)
    outputs.dir docs
    doLast {
        docs.get().asFile.mkdirs()
        docs.get().file(<span class="string"><span class="delimiter">'</span><span class="content">readme.txt</span><span class="delimiter">'</span></span>).asFile.write(<span class="string"><span class="delimiter">'</span><span class="content">Read me!</span><span class="delimiter">'</span></span>)
    }
}

distributions {
    main {
        contents {
            from(createDocs) {
                into <span class="string"><span class="delimiter">'</span><span class="content">docs</span><span class="delimiter">'</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By specifying that the distribution should include the task&#8217;s output files (see <a href="#sec:task_inputs_outputs">incremental builds</a>), Gradle knows that the task that produces the files must be invoked before the distribution can be assembled and will take care of this for you.</p>
</div>
<div class="paragraph">
<p>You can run <code>gradle installDist</code> to create an image of the application in <code>build/install/<em>projectName</em></code>. You can run <code>gradle distZip</code> to create a ZIP containing the distribution, <code>gradle distTar</code> to create an application TAR or <code>gradle assemble</code> to build both.</p>
</div>
<div class="sect4">
<h5 id="sec:customizing_start_script_generation"><a class="anchor" href="#sec:customizing_start_script_generation"></a><a class="link" href="#sec:customizing_start_script_generation">Customizing start script generation</a></h5>
<div class="paragraph">
<p>The application plugin can generate Unix (suitable for Linux, macOS etc.) and Windows start scripts out of the box.
The start scripts launch a JVM with the specified settings defined as part of the original build and runtime environment (e.g. <code>JAVA_OPTS</code> env var).
The default script templates are based on the same scripts used to launch Gradle itself, that ship as part of a Gradle distribution.</p>
</div>
<div class="paragraph">
<p>The start scripts are completely customizable.
Please refer to the documentation of <a href="https://docs.gradle.org/8.9/dsl/org.gradle.jvm.application.tasks.CreateStartScripts.html">CreateStartScripts</a> for more details and customization examples.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:application_tasks"><a class="anchor" href="#sec:application_tasks"></a><a class="link" href="#sec:application_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The Application plugin adds the following tasks to the project.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>run</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.JavaExec.html">JavaExec</a></dt>
<dd>
<p><em>Depends on</em>: <code>classes</code></p>
<div class="paragraph">
<p>Starts the application.</p>
</div>
</dd>
<dt class="hdlist1"><code>startScripts</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.jvm.application.tasks.CreateStartScripts.html">CreateStartScripts</a></dt>
<dd>
<p><em>Depends on</em>: <code>jar</code></p>
<div class="paragraph">
<p>Creates OS specific scripts to run the project as a JVM application.</p>
</div>
</dd>
<dt class="hdlist1"><code>installDist</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.Sync.html">Sync</a></dt>
<dd>
<p><em>Depends on</em>: <code>jar</code>, <code>startScripts</code></p>
<div class="paragraph">
<p>Installs the application into a specified directory.</p>
</div>
</dd>
<dt class="hdlist1"><code>distZip</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.Zip.html">Zip</a></dt>
<dd>
<p><em>Depends on</em>: <code>jar</code>, <code>startScripts</code></p>
<div class="paragraph">
<p>Creates a full distribution ZIP archive including runtime libraries and OS specific scripts.</p>
</div>
</dd>
<dt class="hdlist1"><code>distTar</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.Tar.html">Tar</a></dt>
<dd>
<p><em>Depends on</em>: <code>jar</code>, <code>startScripts</code></p>
<div class="paragraph">
<p>Creates a full distribution TAR archive including runtime libraries and OS specific scripts.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:application_extension"><a class="anchor" href="#sec:application_extension"></a><a class="link" href="#sec:application_extension">Application extension</a></h4>
<div class="paragraph">
<p>The Application Plugin adds an extension to the project, which you can use to configure its behavior. See the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.plugins.JavaApplication.html">JavaApplication</a> DSL documentation for more information on the properties available on the extension.</p>
</div>
<div class="paragraph">
<p>You can configure the extension via the <code>application {}</code> block shown earlier, for example using the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    executableDir = &quot;custom_bin_dir&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    executableDir = <span class="string"><span class="delimiter">'</span><span class="content">custom_bin_dir</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:application_licensing"><a class="anchor" href="#sec:application_licensing"></a><a class="link" href="#sec:application_licensing">License of start scripts</a></h4>
<div class="paragraph">
<p>The start scripts generated for the application are licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 Software License</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:application_convention_properties"><a class="anchor" href="#sec:application_convention_properties"></a><a class="link" href="#sec:application_convention_properties">Convention properties (deprecated)</a></h4>
<div class="paragraph">
<p>This plugin also adds some convention properties to the project, which you can use to configure its behavior. These are <strong>deprecated</strong> and superseded by the extension described above. See the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#N14FED">Project</a> DSL documentation for information on them.</p>
</div>
<div class="paragraph">
<p>Unlike the extension properties, these properties appear as top-level project properties in the build script. For example, to change the application name you can just add the following to your build script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application.applicationName = &quot;my-app&quot;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application.applicationName = <span class="string"><span class="delimiter">'</span><span class="content">my-app</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java_platform_plugin"><a class="anchor" href="#java_platform_plugin"></a><a class="link" href="#java_platform_plugin">The Java Platform Plugin</a></h3>
<div class="paragraph">
<p>The Java Platform plugin brings the ability to declare platforms for the Java ecosystem.
A platform can be used for different purposes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a description of modules which are published together (and for example, share the same version)</p>
</li>
<li>
<p>a set of recommended versions for heterogeneous libraries. A typical example includes the <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-build-systems.html#using-boot-dependency-management">Spring Boot BOM</a></p>
</li>
<li>
<p><a href="#sec:java_platform_consumption">sharing a set of dependency versions</a> between subprojects</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A platform is a special kind of software component which doesn&#8217;t contain any sources:
it is only used to reference other libraries, so that they play well together during dependency resolution.</p>
</div>
<div class="paragraph">
<p>Platforms can be published as <a href="https://github.com/gradle/gradle/blob/master/platforms/documentation/docs/src/docs/design/gradle-module-metadata-latest-specification.md">Gradle Module Metadata</a> and <a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Management">Maven BOMs</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>java-platform</code> plugin cannot be used in combination with the <code>java</code> or <code>java-library</code> plugins in a given project.
Conceptually a project is either a platform, with no binaries, <em>or</em> produces binaries.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sec:java_platform_usage"><a class="anchor" href="#sec:java_platform_usage"></a><a class="link" href="#sec:java_platform_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Java Platform plugin, include the following in your build script:</p>
</div>
<div id="ex-using-the-java-platform-plugin" class="exampleblock">
<div class="title">Example 66. <a href="#ex-using-the-java-platform-plugin">Using the Java Platform plugin</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-platform`
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-platform</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_platform_separation"><a class="anchor" href="#sec:java_platform_separation"></a><a class="link" href="#sec:java_platform_separation">API and runtime separation</a></h4>
<div class="paragraph">
<p>A major difference between a Maven BOM and a Java platform is that in Gradle dependencies and <a href="#sub:terminology_dependency_constraint">constraints</a> are declared and scoped to a configuration and the ones extending it.
While many users will only care about declaring constraints for <em>compile time</em> dependencies, thus inherited by runtime and tests ones, it allows declaring dependencies or constraints that only apply to runtime or test.</p>
</div>
<div class="paragraph">
<p>For this purpose, the plugin exposes two <a href="#sec:what-are-dependency-configurations">configurations</a> that can be used to declare dependencies: <code>api</code> and <code>runtime</code>.
The <code>api</code> configuration should be used to declare constraints and dependencies which should be used when compiling against the platform, whereas the <code>runtime</code> configuration should be used to declare constraints or dependencies which are visible at runtime.</p>
</div>
<div id="ex-declaring-api-and-runtime-constraints" class="exampleblock">
<div class="title">Example 67. <a href="#ex-declaring-api-and-runtime-constraints">Declaring API and runtime constraints</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    constraints {
        api(&quot;commons-httpclient:commons-httpclient:3.1&quot;)
        runtime(&quot;org.postgresql:postgresql:42.2.5&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    constraints {
        api <span class="string"><span class="delimiter">'</span><span class="content">commons-httpclient:commons-httpclient:3.1</span><span class="delimiter">'</span></span>
        runtime <span class="string"><span class="delimiter">'</span><span class="content">org.postgresql:postgresql:42.2.5</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that this example makes use of <em>constraints</em> and not dependencies.
In general, this is what you would like to do: constraints will only apply if such a component is added to the dependency graph, either directly or transitively.
This means that all constraints listed in a platform would not add a dependency unless another component brings it in: they can be seen as <em>recommendations</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For example, if a platform declares a constraint on <code>org:foo:1.1</code>, and that nothing else brings in a dependency on <code>foo</code>, <code>foo</code> will <em>not</em> appear in the graph.
However, if <code>foo</code> appears, then usual conflict resolution would kick in.
If a dependency brings in <code>org:foo:1.0</code>, then we would select <code>org:foo:1.1</code> to satisfy the platform constraint.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, in order to avoid the common mistake of adding a dependency in a platform instead of a constraint, Gradle will fail if you try to do so.
If, for some reason, you also want to add <em>dependencies</em> in addition to constraints, you need to enable it explicitly:</p>
</div>
<div id="ex-allowing-declaration-of-dependencies" class="exampleblock">
<div class="title">Example 68. <a href="#ex-allowing-declaration-of-dependencies">Allowing declaration of dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">javaPlatform {
    allowDependencies()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">javaPlatform {
    allowDependencies()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_platform_project_constraints"><a class="anchor" href="#sec:java_platform_project_constraints"></a><a class="link" href="#sec:java_platform_project_constraints">Local project constraints</a></h4>
<div class="paragraph">
<p>If you have a multi-project build and want to publish a platform that links to subprojects, you can do it by declaring constraints on the subprojects which belong to the platform, as in the example below:</p>
</div>
<div id="ex-declaring-constraints-on-subprojects" class="exampleblock">
<div class="title">Example 69. <a href="#ex-declaring-constraints-on-subprojects">Declaring constraints on subprojects</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    constraints {
        api(project(&quot;:core&quot;))
        api(project(&quot;:lib&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    constraints {
        api project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:core</span><span class="delimiter">&quot;</span></span>)
        api project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:lib</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The project notation will become a classical <code>group:name:version</code> notation in the published metadata.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_platform_bom_import"><a class="anchor" href="#sec:java_platform_bom_import"></a><a class="link" href="#sec:java_platform_bom_import">Sourcing constraints from another platform</a></h4>
<div class="paragraph">
<p>Sometimes the platform you define is an extension of another existing platform.</p>
</div>
<div class="paragraph">
<p>In order to have your platform include the constraints from that third party platform, it needs to be imported as a <code>platform</code> <em>dependency</em>:</p>
</div>
<div id="ex-importing-a-platform" class="exampleblock">
<div class="title">Example 70. <a href="#ex-importing-a-platform">Importing a platform</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">javaPlatform {
    allowDependencies()
}

dependencies {
    api(platform(&quot;com.fasterxml.jackson:jackson-bom:2.9.8&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">javaPlatform {
    allowDependencies()
}

dependencies {
    api platform(<span class="string"><span class="delimiter">'</span><span class="content">com.fasterxml.jackson:jackson-bom:2.9.8</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_platform_publishing"><a class="anchor" href="#sec:java_platform_publishing"></a><a class="link" href="#sec:java_platform_publishing">Publishing platforms</a></h4>
<div class="paragraph">
<p>Publishing Java platforms is done by applying the <code>maven-publish</code> plugin and configuring a Maven publication that uses the <code>javaPlatform</code> component:</p>
</div>
<div id="ex-publishing-as-a-bom" class="exampleblock">
<div class="title">Example 71. <a href="#ex-publishing-as-a-bom">Publishing as a BOM</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;myPlatform&quot;) {
            from(components[&quot;javaPlatform&quot;])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        myPlatform(MavenPublication) {
            from components.javaPlatform
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will generate a BOM file for the platform, with a <code>&lt;dependencyManagement&gt;</code> block where its <code>&lt;dependencies&gt;</code> correspond to the constraints defined in the platform module.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_platform_consumption"><a class="anchor" href="#sec:java_platform_consumption"></a><a class="link" href="#sec:java_platform_consumption">Consuming platforms</a></h4>
<div class="paragraph">
<p>Because a Java Platform is a special kind of component, a dependency on a Java platform has to be declared using the <code>platform</code> or <code>enforcedPlatform</code> keyword, as explained in the <a href="#sub:bom_import">managing transitive dependencies</a> section.
For example, if you want to share dependency versions between subprojects, you can define a platform module which would declare all versions:</p>
</div>
<div id="ex-recommend-versions-in-a-platform-module" class="exampleblock">
<div class="title">Example 72. <a href="#ex-recommend-versions-in-a-platform-module">Recommend versions in a platform module</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    constraints {
        // Platform declares some versions of libraries used in subprojects
        api(&quot;commons-httpclient:commons-httpclient:3.1&quot;)
        api(&quot;org.apache.commons:commons-lang3:3.8.1&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    constraints {
        <span class="comment">// Platform declares some versions of libraries used in subprojects</span>
        api <span class="string"><span class="delimiter">'</span><span class="content">commons-httpclient:commons-httpclient:3.1</span><span class="delimiter">'</span></span>
        api <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-lang3:3.8.1</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And then have subprojects depend on the platform to get recommendations:</p>
</div>
<div id="ex-get-recommendations-from-a-platform" class="exampleblock">
<div class="title">Example 73. <a href="#ex-get-recommendations-from-a-platform">Get recommendations from a platform</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // get recommended versions from the platform project
    api(platform(project(&quot;:platform&quot;)))
    // no version required
    api(&quot;commons-httpclient:commons-httpclient&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// get recommended versions from the platform project</span>
    api platform(project(<span class="string"><span class="delimiter">'</span><span class="content">:platform</span><span class="delimiter">'</span></span>))
    <span class="comment">// no version required</span>
    api <span class="string"><span class="delimiter">'</span><span class="content">commons-httpclient:commons-httpclient</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="groovy_plugin"><a class="anchor" href="#groovy_plugin"></a><a class="link" href="#groovy_plugin">The Groovy Plugin</a></h3>
<div class="paragraph">
<p>The Groovy plugin extends the <a href="java_plugin.html#java_plugin">Java plugin</a> to add support for <a href="https://groovy-lang.org/">Groovy</a> projects.
It can deal with Groovy code, mixed Groovy and Java code, and even pure Java code (although we don&#8217;t necessarily recommend to use it for the latter).
The plugin supports <em>joint compilation</em>, which allows you to freely mix and match Groovy and Java code, with dependencies in both directions.
For example, a Groovy class can extend a Java class that in turn extends a Groovy class.
This makes it possible to use the best language for the job, and to rewrite any class in the other language if needed.</p>
</div>
<div class="paragraph">
<p>Note that if you want to benefit from the <a href="#sec:java_library_separation">API / implementation separation</a>, you can also apply the <code>java-library</code> plugin to your Groovy project.</p>
</div>
<div class="sect3">
<h4 id="sec:groovy_usage"><a class="anchor" href="#sec:groovy_usage"></a><a class="link" href="#sec:groovy_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Groovy plugin, include the following in your build script:</p>
</div>
<div id="ex-using-the-groovy-plugin" class="exampleblock">
<div class="title">Example 74. <a href="#ex-using-the-groovy-plugin">Using the Groovy plugin</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    groovy
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovy_tasks"><a class="anchor" href="#sec:groovy_tasks"></a><a class="link" href="#sec:groovy_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The Groovy plugin adds the following tasks to the project.
Information about altering the dependencies to Java compile tasks are found <a href="#sec:building_jvm_lang">here</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>compileGroovy</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.GroovyCompile.html">GroovyCompile</a></dt>
<dd>
<p><em>Depends on</em>: <code>compileJava</code></p>
<div class="paragraph">
<p>Compiles production Groovy source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>compileTestGroovy</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.GroovyCompile.html">GroovyCompile</a></dt>
<dd>
<p><em>Depends on</em>: <code>compileTestJava</code></p>
<div class="paragraph">
<p>Compiles test Groovy source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>compile<em>SourceSet</em>Groovy</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.GroovyCompile.html">GroovyCompile</a></dt>
<dd>
<p><em>Depends on</em>: <code>compile<em>SourceSet</em>Java</code></p>
<div class="paragraph">
<p>Compiles the given source set&#8217;s Groovy source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>groovydoc</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.javadoc.Groovydoc.html">Groovydoc</a></dt>
<dd>
<div class="paragraph">
<p>Generates API documentation for the production Groovy source files.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The Groovy plugin adds the following dependencies to tasks added by the Java plugin.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 9. Groovy plugin - additional task dependencies</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task name</th>
<th class="tableblock halign-left valign-top">Depends on</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>classes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compileGroovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>testClasses</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compileTestGroovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>sourceSet</em>Classes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compile<em>SourceSet</em>Groovy</code></p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="img/groovyPluginTasks.png" alt="groovyPluginTasks">
</div>
<div class="title">Figure 3. Groovy plugin - tasks</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovy_project_layout"><a class="anchor" href="#sec:groovy_project_layout"></a><a class="link" href="#sec:groovy_project_layout">Project layout</a></h4>
<div class="paragraph">
<p>The Groovy plugin assumes the project layout shown in <a href="#groovylayout">Groovy Layout</a>. All the Groovy source directories can contain Groovy <em>and</em> Java code. The Java source directories may only contain Java source code.<sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup> None of these directories need to exist or have anything in them; the Groovy plugin will simply compile whatever it finds.</p>
</div>
<div id="groovylayout" class="dlist">
<dl>
<dt class="hdlist1"><code>src/main/java</code></dt>
<dd>
<p>Production Java source.</p>
</dd>
<dt class="hdlist1"><code>src/main/resources</code></dt>
<dd>
<p>Production resources, such as XML and properties files.</p>
</dd>
<dt class="hdlist1"><code>src/main/groovy</code></dt>
<dd>
<p>Production Groovy source. May also contain Java source files for joint compilation.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>src/test/java</code></dt>
<dd>
<p>Test Java source.</p>
</dd>
<dt class="hdlist1"><code>src/test/resources</code></dt>
<dd>
<p>Test resources.</p>
</dd>
<dt class="hdlist1"><code>src/test/groovy</code></dt>
<dd>
<p>Test Groovy source. May also contain Java source files for joint compilation.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/java</code></dt>
<dd>
<p>Java source for the source set named <em>sourceSet</em>.</p>
</dd>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/resources</code></dt>
<dd>
<p>Resources for the source set named <em>sourceSet</em>.</p>
</dd>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/groovy</code></dt>
<dd>
<p>Groovy source files for the given source set. May also contain Java source files for joint compilation.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="sec:changing_groovy_project_layout"><a class="anchor" href="#sec:changing_groovy_project_layout"></a><a class="link" href="#sec:changing_groovy_project_layout">Changing the project layout</a></h5>
<div class="paragraph">
<p>Just like the Java plugin, the Groovy plugin allows you to configure custom locations for Groovy production and test source files.</p>
</div>
<div id="ex-custom-groovy-source-layout" class="exampleblock">
<div class="title">Example 75. <a href="#ex-custom-groovy-source-layout">Custom Groovy source layout</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    main {
        groovy {
            setSrcDirs(listOf(&quot;src/groovy&quot;))
        }
    }

    test {
        groovy {
            setSrcDirs(listOf(&quot;test/groovy&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    main {
        groovy {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">src/groovy</span><span class="delimiter">'</span></span>]
        }
    }

    test {
        groovy {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">test/groovy</span><span class="delimiter">'</span></span>]
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovy_dependency_management"><a class="anchor" href="#sec:groovy_dependency_management"></a><a class="link" href="#sec:groovy_dependency_management">Dependency management</a></h4>
<div class="paragraph">
<p>Because Gradle&#8217;s build language is based on Groovy, and parts of Gradle are implemented in Groovy, Gradle already ships with a Groovy library. Nevertheless, Groovy projects need to explicitly declare a Groovy dependency. This dependency will then be used on compile and runtime class paths. It will also be used to get hold of the Groovy compiler and Groovydoc tool, respectively.</p>
</div>
<div class="paragraph">
<p>If Groovy is used for production code, the Groovy dependency should be added to the <code>implementation</code> configuration:</p>
</div>
<div id="ex-configuration-of-groovy-dependency" class="exampleblock">
<div class="title">Example 76. <a href="#ex-configuration-of-groovy-dependency">Configuration of Groovy dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;org.codehaus.groovy:groovy-all:2.4.15&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy-all:2.4.15</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If Groovy is only used for test code, the Groovy dependency should be added to the <code>testImplementation</code> configuration:</p>
</div>
<div id="ex-configuration-of-groovy-test-dependency" class="exampleblock">
<div class="title">Example 77. <a href="#ex-configuration-of-groovy-test-dependency">Configuration of Groovy test dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;org.codehaus.groovy:groovy-all:2.4.15&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy-all:2.4.15</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To use the Groovy library that ships with Gradle, declare a <code>localGroovy()</code> dependency. Note that different Gradle versions ship with different Groovy versions; as such, using <code>localGroovy()</code> is less safe then declaring a regular Groovy dependency.</p>
</div>
<div id="ex-configuration-of-bundled-groovy-dependency" class="exampleblock">
<div class="title">Example 78. <a href="#ex-configuration-of-bundled-groovy-dependency">Configuration of bundled Groovy dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(localGroovy())
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation localGroovy()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:automatic_configuration_of_groovyclasspath"><a class="anchor" href="#sec:automatic_configuration_of_groovyclasspath"></a><a class="link" href="#sec:automatic_configuration_of_groovyclasspath">Automatic configuration of groovyClasspath</a></h4>
<div class="paragraph">
<p>The <code>GroovyCompile</code> and <code>Groovydoc</code> tasks consume Groovy code in two ways: on their <code>classpath</code>, and on their <code>groovyClasspath</code>. The former is used to locate classes referenced by the source code, and will typically contain the Groovy library along with other libraries. The latter is used to load and execute the Groovy compiler and Groovydoc tool, respectively, and should only contain the Groovy library and its dependencies.</p>
</div>
<div class="paragraph">
<p>Unless a task&#8217;s <code>groovyClasspath</code> is configured explicitly, the Groovy (base) plugin will try to infer it from the task&#8217;s <code>classpath</code>. This is done as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a <code>groovy-all(-indy)</code> Jar is found on <code>classpath</code>, that jar will be added to <code>groovyClasspath</code>.</p>
</li>
<li>
<p>If a <code>groovy(-indy)</code> jar is found on <code>classpath</code>, and the project has at least one repository declared, a corresponding <code>groovy(-indy)</code> repository dependency will be added to <code>groovyClasspath</code>.</p>
</li>
<li>
<p>Otherwise, execution of the task will fail with a message saying that <code>groovyClasspath</code> could not be inferred.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the “<code>-indy</code>” variation of each jar refers to the version with <code>invokedynamic</code> support.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovy_convention_properties"><a class="anchor" href="#sec:groovy_convention_properties"></a><a class="link" href="#sec:groovy_convention_properties">Convention properties</a></h4>
<div class="paragraph">
<p>The Groovy plugin does not add any convention properties to the project.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovy_source_set_properties"><a class="anchor" href="#sec:groovy_source_set_properties"></a><a class="link" href="#sec:groovy_source_set_properties">Source set properties</a></h4>
<div class="paragraph">
<p>The Groovy plugin adds the following extensions to each source set in the project. You can use these properties in your build script as though they were properties of the source set object.</p>
</div>
<div class="sect4">
<h5 id="groovy_plugin_source_set_properties"><a class="anchor" href="#groovy_plugin_source_set_properties"></a><a class="link" href="#groovy_plugin_source_set_properties">Groovy Plugin — source set properties</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>groovy</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.GroovySourceDirectorySet.html">GroovySourceDirectorySet</a> (read-only)</dt>
<dd>
<p><em>Default value</em>: Not null</p>
<div class="paragraph">
<p>The Groovy source files of this source set. Contains all <code>.groovy</code> and <code>.java</code> files found in the Groovy source directories, and excludes all other types of files.</p>
</div>
</dd>
<dt class="hdlist1"><code>groovy.srcDirs</code> — <code>Set&lt;File&gt;</code></dt>
<dd>
<p><em>Default value</em>: <code>[<em>projectDir</em>/src/<em>name</em>/groovy]</code></p>
<div class="paragraph">
<p>The source directories containing the Groovy source files of this source set. May also contain Java source files for joint compilation. Can set using anything described in <a href="#sec:specifying_multiple_files">Specifying Multiple Files</a>.</p>
</div>
</dd>
<dt class="hdlist1"><code>allGroovy</code> — <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileTree.html">FileTree</a> (read-only)</dt>
<dd>
<p><em>Default value</em>: Not null</p>
<div class="paragraph">
<p>All Groovy source files of this source set. Contains only the <code>.groovy</code> files found in the Groovy source directories.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These properties are provided by a convention object of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.GroovySourceSet.html">GroovySourceSet</a>.</p>
</div>
<div class="paragraph">
<p>The Groovy plugin also modifies some source set properties:</p>
</div>
</div>
<div class="sect4">
<h5 id="groovy_plugin_modified_source_set_properties"><a class="anchor" href="#groovy_plugin_modified_source_set_properties"></a><a class="link" href="#groovy_plugin_modified_source_set_properties">Groovy Plugin - modified source set properties</a></h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Change</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>allJava</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds all <code>.java</code> files found in the Groovy source directories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>allSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds all source files found in the Groovy source directories.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovyCompile"><a class="anchor" href="#sec:groovyCompile"></a><a class="link" href="#sec:groovyCompile">GroovyCompile</a></h4>
<div class="paragraph">
<p>The Groovy plugin adds a <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.GroovyCompile.html">GroovyCompile</a> task for each source set in the project.
The task type shares much with the <code>JavaCompile</code> task by extending <code>AbstractCompile</code> (see <a href="#sec:compile">the relevant Java Plugin section</a>).
The <code>GroovyCompile</code> task supports most configuration options of the official Groovy compiler.
The task can also leverage the <a href="#toolchains">Java toolchain support</a>.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 10. Groovy plugin - GroovyCompile properties</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>classpath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>sourceSet</em>.compileClasspath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileTree.html">FileTree</a>.
Can set using anything described in <a href="#sec:specifying_multiple_files">Specifying Multiple Files</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>sourceSet</em>.groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>destinationDirectory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>File</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>sourceSet</em>.groovy.destinationDirectory</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>groovyClasspath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>groovy</code> configuration if non-empty; Groovy library found on <code>classpath</code> otherwise</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javaLauncher</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Property&lt;JavaLauncher&gt;</code>, see the <a href="#toolchains">toolchain documentation</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None but will be configured if a toolchain is defined on the <code>java</code> extension.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="sec:groovy_compilation_avoidance"><a class="anchor" href="#sec:groovy_compilation_avoidance"></a><a class="link" href="#sec:groovy_compilation_avoidance">Compilation avoidance</a></h5>
<div class="paragraph">
<p><em>Caveat: Groovy compilation avoidance is an incubating feature since Gradle 5.6. There are known inaccuracies so please enable it at your own risk.</em></p>
</div>
<div class="paragraph">
<p>To enable the incubating support for Groovy compilation avoidance, add a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/initialization/Settings.html#enableFeaturePreview-java.lang.String-"><code>enableFeaturePreview</code></a> to your settings file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">enableFeaturePreview(<span class="string"><span class="delimiter">'</span><span class="content">GROOVY_COMPILATION_AVOIDANCE</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">enableFeaturePreview(&quot;GROOVY_COMPILATION_AVOIDANCE&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If a dependent project has changed in an <a href="https://en.wikipedia.org/wiki/Application_binary_interface">ABI</a>-compatible way (only its private API has changed), then Groovy compilation tasks will be up-to-date.
This means that if project <code>A</code> depends on project <code>B</code> and a class in <code>B</code> is changed in an ABI-compatible way (typically, changing only the body of a method), then Gradle won&#8217;t recompile <code>A</code>.</p>
</div>
<div class="paragraph">
<p>See <a href="java_plugin.html#sec:java_compile_avoidance">Java compile avoidance</a> for a detailed list of the types of changes that do not affect the ABI and are ignored.</p>
</div>
<div class="paragraph">
<p>However, similar to Java&#8217;s annotation processing, there are various ways to <a href="https://melix.github.io/blog/2011/05/12/customizing_groovy_compilation_process.html">customize the Groovy compilation process</a>, for which implementation details matter.
Some well-known examples are <a href="https://groovy-lang.org/metaprogramming.html#_code_generation_transformations">Groovy AST transformations</a>.
In these cases, these dependencies must be declared separately in a classpath called <code>astTransformationClasspath</code>:</p>
</div>
<div id="ex-declaring-ast-transformations" class="exampleblock">
<div class="title">Example 79. <a href="#ex-declaring-ast-transformations">Declaring AST transformations</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val astTransformation by configurations.creating
dependencies {
    astTransformation(project(&quot;:ast-transformation&quot;))
}
tasks.withType&lt;GroovyCompile&gt;().configureEach {
    astTransformationClasspath.from(astTransformation)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations { astTransformation }
dependencies {
    astTransformation(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:ast-transformation</span><span class="delimiter">&quot;</span></span>))
}
tasks.withType(GroovyCompile).configureEach {
    astTransformationClasspath.from(configurations.astTransformation)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:incremental_groovy_compilation"><a class="anchor" href="#sec:incremental_groovy_compilation"></a><a class="link" href="#sec:incremental_groovy_compilation">Incremental Groovy compilation</a></h4>
<div class="paragraph">
<p>Since 5.6, Gradle introduces an experimental incremental Groovy compiler. To enable incremental compilation for Groovy, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable <a href="#sec:groovy_compilation_avoidance">Groovy compilation avoidance</a>.</p>
</li>
<li>
<p>Explicitly enable incremental Groovy compilation in the build script:</p>
</li>
</ul>
</div>
<div id="ex-enable-incremental-groovy-compilation" class="exampleblock">
<div class="title">Example 80. <a href="#ex-enable-incremental-groovy-compilation">Enable incremental Groovy compilation</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/myproject.groovy-conventions.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;GroovyCompile&gt;().configureEach {
    options.isIncremental = true
    options.incrementalAfterFailure = true
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/myproject.groovy-conventions.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(GroovyCompile).configureEach {
    options.incremental = <span class="predefined-constant">true</span>
    options.incrementalAfterFailure = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This gives you the following benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Incremental builds are much faster.</p>
</li>
<li>
<p>If only a small set of Groovy source files are changed, only the affected source files will be recompiled.
Classes that don&#8217;t need to be recompiled remain unchanged in the output directory.
For example, if you only change a few Groovy test classes, you don&#8217;t need to recompile all Groovy test source files — only the changed ones need to be recompiled.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To understand how incremental compilation works, see <a href="java_plugin.html#sec:incremental_compile">Incremental Java compilation</a> for a detailed overview.
Note that there&#8217;re several differences from Java incremental compilation:</p>
</div>
<div class="paragraph">
<p>The Groovy compiler doesn&#8217;t keep <code>@Retention</code> in generated annotation class bytecode (<a href="https://issues.apache.org/jira/browse/GROOVY-9185">GROOVY-9185</a>), thus all annotations are <code>RUNTIME</code>.
This means that changes to source-retention annotations won&#8217;t trigger a full recompilation.</p>
</div>
<div class="sect4">
<h5 id="sec:incremental_groovy_compilation_known_issues"><a class="anchor" href="#sec:incremental_groovy_compilation_known_issues"></a><a class="link" href="#sec:incremental_groovy_compilation_known_issues">Known issues</a></h5>
<div class="paragraph">
<p>Also see <a href="java_plugin.html#sec:incremental_compilation_known_issues">Known issues for incremental Java compilation</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changes to resources won&#8217;t trigger a recompilation, this might result in some incorrectness — for example <a href="https://mrhaki.blogspot.com/2013/01/groovy-goodness-adding-extra-methods.html">Extension Modules</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovy_cross_compilation"><a class="anchor" href="#sec:groovy_cross_compilation"></a><a class="link" href="#sec:groovy_cross_compilation">Compiling and testing for Java 6 or Java 7</a></h4>
<div class="paragraph">
<p>With <a href="#toolchains">toolchain support</a> added to <code>GroovyCompile</code>, it is possible to compile Groovy code using a different Java version than the one running Gradle.
If you also have Java source files, this will also configure <code>JavaCompile</code> to use the right Java compiler is used, as can be seen in the <a href="#sec:java_cross_compilation">Java plugin</a> documentation.</p>
</div>
<div class="sect4">
<h5 id="example_configure_java_7_build_for_groovy"><a class="anchor" href="#example_configure_java_7_build_for_groovy"></a><a class="link" href="#example_configure_java_7_build_for_groovy">Example: Configure Java 7 build for Groovy</a></h5>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(7)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(<span class="integer">7</span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scala_plugin"><a class="anchor" href="#scala_plugin"></a><a class="link" href="#scala_plugin">The Scala Plugin</a></h3>
<div class="paragraph">
<p>The Scala plugin extends the <a href="java_plugin.html#java_plugin">Java plugin</a> to add support for <a href="https://www.scala-lang.org/">Scala</a> projects.
The plugin also supports <em>joint compilation</em>, which allows you to freely mix and match Scala and Java code with dependencies in both directions.
For example, a Scala class can extend a Java class that in turn extends a Scala class.
This makes it possible to use the best language for the job, and to rewrite any class in the other language if needed.</p>
</div>
<div class="paragraph">
<p>Note that if you want to benefit from the <a href="#sec:java_library_separation">API / implementation separation</a>, you can also apply the <code>java-library</code> plugin to your Scala project.</p>
</div>
<div class="sect3">
<h4 id="sec:scala_usage"><a class="anchor" href="#sec:scala_usage"></a><a class="link" href="#sec:scala_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Scala plugin, include the following in your build script:</p>
</div>
<div id="ex-using-the-scala-plugin" class="exampleblock">
<div class="title">Example 81. <a href="#ex-using-the-scala-plugin">Using the Scala plugin</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    scala
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">scala</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_tasks"><a class="anchor" href="#sec:scala_tasks"></a><a class="link" href="#sec:scala_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The Scala plugin adds the following tasks to the project.
Information about altering the dependencies to Java compile tasks are found <a href="#sec:building_jvm_lang">here</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>compileScala</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.scala.ScalaCompile.html">ScalaCompile</a></dt>
<dd>
<p><em>Depends on</em>: <code>compileJava</code></p>
<div class="paragraph">
<p>Compiles production Scala source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>compileTestScala</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.scala.ScalaCompile.html">ScalaCompile</a></dt>
<dd>
<p><em>Depends on</em>: <code>compileTestJava</code></p>
<div class="paragraph">
<p>Compiles test Scala source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>compile<em>SourceSet</em>Scala</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.scala.ScalaCompile.html">ScalaCompile</a></dt>
<dd>
<p><em>Depends on</em>: <code>compile<em>SourceSet</em>Java</code></p>
<div class="paragraph">
<p>Compiles the given source set&#8217;s Scala source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>scaladoc</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.scala.ScalaDoc.html">ScalaDoc</a></dt>
<dd>
<div class="paragraph">
<p>Generates API documentation for the production Scala source files.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>ScalaCompile</code> and <code>ScalaDoc</code> tasks support <a href="#toolchains">Java toolchains</a> out of the box.</p>
</div>
<div class="paragraph">
<p>The Scala plugin adds the following dependencies to tasks added by the Java plugin.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Scala plugin - additional task dependencies</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task name</th>
<th class="tableblock halign-left valign-top">Depends on</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>classes</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>compileScala</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>testClasses</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>compileTestScala</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><em>sourceSet</em>Classes</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>compile<em>SourceSet</em>Scala</code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="img/scalaPluginTasks.png" alt="scalaPluginTasks">
</div>
<div class="title">Figure 4. Scala plugin - tasks</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_project_layout"><a class="anchor" href="#sec:scala_project_layout"></a><a class="link" href="#sec:scala_project_layout">Project layout</a></h4>
<div class="paragraph">
<p>The Scala plugin assumes the project layout shown below. All the Scala source directories can contain Scala <em>and</em> Java code. The Java source directories may only contain Java source code. None of these directories need to exist or have anything in them; the Scala plugin will simply compile whatever it finds.</p>
</div>
<div id="scalalayout" class="dlist">
<dl>
<dt class="hdlist1"><code>src/main/java</code></dt>
<dd>
<p>Production Java source.</p>
</dd>
<dt class="hdlist1"><code>src/main/resources</code></dt>
<dd>
<p>Production resources, such as XML and properties files.</p>
</dd>
<dt class="hdlist1"><code>src/main/scala</code></dt>
<dd>
<p>Production Scala source. May also contain Java source files for joint compilation.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>src/test/java</code></dt>
<dd>
<p>Test Java source.</p>
</dd>
<dt class="hdlist1"><code>src/test/resources</code></dt>
<dd>
<p>Test resources.</p>
</dd>
<dt class="hdlist1"><code>src/test/scala</code></dt>
<dd>
<p>Test Scala source. May also contain Java source files for joint compilation.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/java</code></dt>
<dd>
<p>Java source for the source set named <em>sourceSet</em>.</p>
</dd>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/resources</code></dt>
<dd>
<p>Resources for the source set named <em>sourceSet</em>.</p>
</dd>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/scala</code></dt>
<dd>
<p>Scala source files for the given source set. May also contain Java source files for joint compilation.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="sec:changing_scala_project_layout"><a class="anchor" href="#sec:changing_scala_project_layout"></a><a class="link" href="#sec:changing_scala_project_layout">Changing the project layout</a></h5>
<div class="paragraph">
<p>Just like the Java plugin, the Scala plugin allows you to configure custom locations for Scala production and test source files.</p>
</div>
<div id="ex-custom-scala-source-layout" class="exampleblock">
<div class="title">Example 82. <a href="#ex-custom-scala-source-layout">Custom Scala source layout</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    main {
        scala {
            setSrcDirs(listOf(&quot;src/scala&quot;))
        }
    }
    test {
        scala {
            setSrcDirs(listOf(&quot;test/scala&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    main {
        scala {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">src/scala</span><span class="delimiter">'</span></span>]
        }
    }
    test {
        scala {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">test/scala</span><span class="delimiter">'</span></span>]
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_dependency_management"><a class="anchor" href="#sec:scala_dependency_management"></a><a class="link" href="#sec:scala_dependency_management">Dependency management</a></h4>
<div class="paragraph">
<p>Scala projects need to declare a <code>scala-library</code> dependency. This dependency will then be used on compile and runtime class paths. It will also be used to get hold of the Scala compiler and Scaladoc tool, respectively.<sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup></p>
</div>
<div class="paragraph">
<p>If Scala is used for production code, the <code>scala-library</code> dependency should be added to the <code>implementation</code> configuration:</p>
</div>
<div id="ex-declaring-a-scala-dependency-for-production-code" class="exampleblock">
<div class="title">Example 83. <a href="#ex-declaring-a-scala-dependency-for-production-code">Declaring a Scala dependency for production code</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;org.scala-lang:scala-library:2.13.12&quot;)
    testImplementation(&quot;junit:junit:4.13&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.scala-lang:scala-library:2.13.12</span><span class="delimiter">'</span></span>
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.13</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want to use Scala 3 instead of the <code>scala-library</code> dependency you should add the <code>scala3-library_3</code> dependency:</p>
</div>
<div id="ex-declaring-a-scala-3-dependency-for-production-code" class="exampleblock">
<div class="title">Example 84. <a href="#ex-declaring-a-scala-3-dependency-for-production-code">Declaring a Scala 3 dependency for production code</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    scala
}

repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;org.scala-lang:scala3-library_3:3.0.1&quot;)
    testImplementation(&quot;org.scalatest:scalatest_3:3.2.9&quot;)
    testImplementation(&quot;junit:junit:4.13&quot;)
}

dependencies {
    implementation(&quot;commons-collections:commons-collections:3.2.2&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">scala</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.scala-lang:scala3-library_3:3.0.1</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-collections:commons-collections:3.2.2</span><span class="delimiter">'</span></span>
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.scalatest:scalatest_3:3.2.9</span><span class="delimiter">'</span></span>
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.13</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If Scala is only used for test code, the <code>scala-library</code> dependency should be added to the <code>testImplementation</code> configuration:</p>
</div>
<div id="ex-declaring-a-scala-dependency-for-test-code" class="exampleblock">
<div class="title">Example 85. <a href="#ex-declaring-a-scala-dependency-for-test-code">Declaring a Scala dependency for test code</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;org.scala-lang:scala-library:2.13.12&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.scala-lang:scala-library:2.13.12</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:configure_scala_classpath"><a class="anchor" href="#sec:configure_scala_classpath"></a><a class="link" href="#sec:configure_scala_classpath">Automatic configuration of scalaClasspath</a></h4>
<div class="paragraph">
<p>The <code>ScalaCompile</code> and <code>ScalaDoc</code> tasks consume Scala code in two ways: on their <code>classpath</code>, and on their <code>scalaClasspath</code>. The former is used to locate classes referenced by the source code, and will typically contain <code>scala-library</code> along with other libraries. The latter is used to load and execute the Scala compiler and Scaladoc tool, respectively, and should only contain the <code>scala-compiler</code> library and its dependencies.</p>
</div>
<div class="paragraph">
<p>Unless a task&#8217;s <code>scalaClasspath</code> is configured explicitly, the Scala (base) plugin will try to infer it from the task&#8217;s <code>classpath</code>. This is done as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a <code>scala-library</code> jar is found on <code>classpath</code>, and the project has at least one repository declared, a corresponding <code>scala-compiler</code> repository dependency will be added to <code>scalaClasspath</code>.</p>
</li>
<li>
<p>Otherwise, execution of the task will fail with a message saying that <code>scalaClasspath</code> could not be inferred.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sec:configure_zinc_compiler"><a class="anchor" href="#sec:configure_zinc_compiler"></a><a class="link" href="#sec:configure_zinc_compiler">Configuring the Zinc compiler</a></h4>
<div class="paragraph">
<p>The Scala plugin uses a configuration named <code>zinc</code> to resolve the <a href="https://github.com/sbt/zinc">Zinc compiler</a> and its dependencies.
Gradle will provide a default version of Zinc, but if you need to use a particular Zinc version, you can change it.
Gradle supports version 1.6.0 of Zinc and above.</p>
</div>
<div id="ex-declaring-a-version-of-the-zinc-compiler-to-use" class="exampleblock">
<div class="title">Example 86. <a href="#ex-declaring-a-version-of-the-zinc-compiler-to-use">Declaring a version of the Zinc compiler to use</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">scala {
    zincVersion = &quot;1.9.3&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">scala {
    zincVersion = <span class="string"><span class="delimiter">&quot;</span><span class="content">1.9.3</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Zinc compiler itself needs a compatible version of <code>scala-library</code> that may be different from the version required by your application.
Gradle takes care of specifying a compatible version of <code>scala-library</code> for you.</p>
</div>
<div class="paragraph">
<p>You can diagnose problems with the version of the Zinc compiler selected by running <a href="#sec:debugging-build-scans">dependencyInsight</a> for the <code>zinc</code> configuration.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 12. Zinc compatibility table</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Gradle version</th>
<th class="tableblock halign-left valign-top">Supported Zinc versions</th>
<th class="tableblock halign-left valign-top">Zinc coordinates</th>
<th class="tableblock halign-left valign-top">Required Scala version</th>
<th class="tableblock halign-left valign-top">Supported Scala compilation version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.5 and newer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/sbt/zinc">SBT Zinc</a>. Versions 1.6.0 and above.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.scala-sbt:zinc_2.13</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scala <code>2.13.x</code> is required for <em>running</em> Zinc.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scala <code>2.10.x</code> through <code>3.x</code> can be compiled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.0 to 7.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/sbt/zinc">SBT Zinc</a>. Versions 1.2.0 and above.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.scala-sbt:zinc_2.12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scala <code>2.12.x</code> is required for <em>running</em> Zinc.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scala <code>2.10.x</code> through <code>2.13.x</code> can be compiled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.x through 5.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/typesafehub/zinc"><strong>Deprecated</strong> Typesafe Zinc compiler.</a> Versions 0.3.0 and above, except for 0.3.2 through 0.3.5.2.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.typesafe.zinc:zinc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scala <code>2.10.x</code> is required for <em>running</em> Zinc.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scala <code>2.9.x</code> through <code>2.12.x</code> can be compiled.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:scala_compiler_plugins"><a class="anchor" href="#sec:scala_compiler_plugins"></a><a class="link" href="#sec:scala_compiler_plugins">Adding plugins to the Scala compiler</a></h4>
<div class="paragraph">
<p>The Scala plugin adds a configuration named <code>scalaCompilerPlugins</code> which is used to declare and resolve optional compiler plugins.</p>
</div>
<div id="ex-adding-a-dependency-on-a-scala-compiler-plugin" class="exampleblock">
<div class="title">Example 87. <a href="#ex-adding-a-dependency-on-a-scala-compiler-plugin">Adding a dependency on a Scala compiler plugin</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.scala-lang:scala-library:2.13.12&quot;)
    scalaCompilerPlugins(&quot;org.typelevel:kind-projector_2.13.12:0.13.2&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">&quot;</span><span class="content">org.scala-lang:scala-library:2.13.12</span><span class="delimiter">&quot;</span></span>
    scalaCompilerPlugins <span class="string"><span class="delimiter">&quot;</span><span class="content">org.typelevel:kind-projector_2.13.12:0.13.2</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_convention_properties"><a class="anchor" href="#sec:scala_convention_properties"></a><a class="link" href="#sec:scala_convention_properties">Convention properties</a></h4>
<div class="paragraph">
<p>The Scala plugin does not add any convention properties to the project.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_source_set_properties"><a class="anchor" href="#sec:scala_source_set_properties"></a><a class="link" href="#sec:scala_source_set_properties">Source set properties</a></h4>
<div class="paragraph">
<p>The Scala plugin adds the following extensions to each source set in the project. You can use these  in your build script as though they were properties of the source set object.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>scala</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.file.SourceDirectorySet.html">SourceDirectorySet</a> (read-only)</dt>
<dd>
<p>The Scala source files of this source set. Contains all <code>.scala</code> and <code>.java</code> files found in the Scala source directories, and excludes all other types of files. <em>Default value:</em> non-null.</p>
</dd>
<dt class="hdlist1"><code>scala.srcDirs</code> — <code>Set&lt;File&gt;</code></dt>
<dd>
<p>The source directories containing the Scala source files of this source set. May also contain Java source files for joint compilation.
Can set using anything described in <a href="#sec:specifying_multiple_files">Understanding implicit conversion to file collections</a>.
<em>Default value:</em> <code>[<em>projectDir</em>/src/<em>name</em>/scala]</code>.</p>
</dd>
<dt class="hdlist1"><code>allScala</code> — <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileTree.html">FileTree</a> (read-only)</dt>
<dd>
<p>All Scala source files of this source set. Contains only the <code>.scala</code> files found in the Scala source directories. <em>Default value:</em> non-null.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These extensions are backed by an object of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.plugins.scala.ScalaSourceSet.html">ScalaSourceSet</a>.</p>
</div>
<div class="paragraph">
<p>The Scala plugin also modifies some source set properties:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 13. Scala plugin - source set properties</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Change</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>allJava</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds all <code>.java</code> files found in the Scala source directories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>allSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds all source files found in the Scala source directories.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:scala_target"><a class="anchor" href="#sec:scala_target"></a><a class="link" href="#sec:scala_target">Target bytecode level and Java APIs version</a></h4>
<div class="paragraph">
<p>When running the Scala compile task, Gradle will always add a parameter to configure the Java target for the Scala compiler that is derived from the Gradle configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When using toolchains, the <code>-release</code> option, or <code>target</code> for older Scala versions, is selected, with a version matching the Java language level of the toolchain configured.</p>
</li>
<li>
<p>When not using toolchains, Gradle will always pass a <code>target</code> flag&#8201;&#8212;&#8201;with exact value dependent on the Scala version&#8201;&#8212;&#8201;to compile to Java 8 bytecode.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This means that using toolchains with a recent Java version and an old Scala version can result in failures because Scala only supported Java 8 bytecode for some time.
The solution is then to either use the right Java version in the toolchain or explicitly downgrade the target when needed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table explains the values computed by Gradle:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 14. Scala target parameter based on project configuration</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scala version</th>
<th class="tableblock halign-left valign-top">Toolchain in use</th>
<th class="tableblock halign-left valign-top">Parameter value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">version &lt; <code>2.13.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-target:jvm-1.&lt;java_version&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-target:jvm-1.8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>2.13.1</code> &lt;= version &lt; <code>2.13.9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-target:&lt;java_version&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-target:8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>2.13.9</code> &lt;= version &lt; <code>3.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-release:&lt;java_version&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-target:8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>3.0</code> &lt;= version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-release:&lt;java_version&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Xtarget:8</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Setting any of these flags explicitly, or using flags containing <code>java-output-version</code>, on <a href="https://docs.gradle.org/8.9/dsl/org.gradle.language.scala.tasks.BaseScalaCompileOptions.html#org.gradle.language.scala.tasks.BaseScalaCompileOptions:additionalParameters"><code>ScalaCompile.scalaCompileOptions.additionalParameters</code></a> disables that logic in favor of the explicit flag.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_compiling_in_external_process"><a class="anchor" href="#sec:scala_compiling_in_external_process"></a><a class="link" href="#sec:scala_compiling_in_external_process">Compiling in external process</a></h4>
<div class="paragraph">
<p>Scala compilation takes place in an external process.</p>
</div>
<div class="paragraph">
<p>Memory settings for the external process default to the defaults of the JVM. To adjust memory settings, configure the <code>scalaCompileOptions.forkOptions</code> property as needed:</p>
</div>
<div id="ex-adjusting-memory-settings" class="exampleblock">
<div class="title">Example 88. <a href="#ex-adjusting-memory-settings">Adjusting memory settings</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;ScalaCompile&gt;().configureEach {
    scalaCompileOptions.forkOptions.apply {
        memoryMaximumSize = &quot;1g&quot;
        jvmArgs = listOf(&quot;-XX:MaxMetaspaceSize=512m&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(ScalaCompile) {
    scalaCompileOptions.forkOptions.with {
        memoryMaximumSize = <span class="string"><span class="delimiter">'</span><span class="content">1g</span><span class="delimiter">'</span></span>
        jvmArgs = [<span class="string"><span class="delimiter">'</span><span class="content">-XX:MaxMetaspaceSize=512m</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_incremental_compilation"><a class="anchor" href="#sec:scala_incremental_compilation"></a><a class="link" href="#sec:scala_incremental_compilation">Incremental compilation</a></h4>
<div class="paragraph">
<p>By compiling only classes whose source code has changed since the previous compilation, and classes affected by these changes, incremental compilation can significantly reduce Scala compilation time. It is particularly effective when frequently compiling small code increments, as is often done at development time.</p>
</div>
<div class="paragraph">
<p>The Scala plugin defaults to incremental compilation by integrating with <a href="https://github.com/typesafehub/zinc">Zinc</a>, a standalone version of <a href="https://github.com/harrah/xsbt">sbt</a>'s incremental Scala compiler. If you want to disable the incremental compilation, set <code>force = true</code> in your build file:</p>
</div>
<div id="ex-forcing-all-code-to-be-compiled" class="exampleblock">
<div class="title">Example 89. <a href="#ex-forcing-all-code-to-be-compiled">Forcing all code to be compiled</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;ScalaCompile&gt;().configureEach {
    scalaCompileOptions.apply {
        isForce = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(ScalaCompile) {
    scalaCompileOptions.with {
        force = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Note:</em> This will only cause all classes to be recompiled if at least one input source file has changed. If there are no changes to the source files, the <code>compileScala</code> task will still be considered <code>UP-TO-DATE</code> as usual.</p>
</div>
<div class="paragraph">
<p>The Zinc-based Scala Compiler supports joint compilation of Java and Scala code. By default, all Java and Scala code under <code>src/main/scala</code> will participate in joint compilation. Even Java code will be compiled incrementally.</p>
</div>
<div class="paragraph">
<p>Incremental compilation requires dependency analysis of the source code. The results of this analysis are stored in the file designated by <code>scalaCompileOptions.incrementalOptions.analysisFile</code> (which has a sensible default). In a multi-project build, analysis files are passed on to downstream <code>ScalaCompile</code> tasks to enable incremental compilation across project boundaries. For <code>ScalaCompile</code> tasks added by the Scala plugin, no configuration is necessary to make this work. For other <code>ScalaCompile</code> tasks that you might add, the property <code>scalaCompileOptions.incrementalOptions.publishedCode</code> needs to be configured to point to the classes folder or Jar archive by which the code is passed on to compile class paths of downstream <code>ScalaCompile</code> tasks. Note that if <code>publishedCode</code> is not set correctly, downstream tasks may not recompile code affected by upstream changes, leading to incorrect compilation results.</p>
</div>
<div class="paragraph">
<p>Note that Zinc&#8217;s Nailgun based daemon mode is not supported. Instead, we plan to enhance Gradle&#8217;s own compiler daemon to stay alive across Gradle invocations, reusing the same Scala compiler. This is expected to yield another significant speedup for Scala compilation.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:eclipse_integration"><a class="anchor" href="#sec:eclipse_integration"></a><a class="link" href="#sec:eclipse_integration">Eclipse Integration</a></h4>
<div class="paragraph">
<p>When the Eclipse plugin encounters a Scala project, it adds additional configuration to make the project work with Scala IDE out of the box. Specifically, the plugin adds a Scala nature and dependency container.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:intellij_idea_integration"><a class="anchor" href="#sec:intellij_idea_integration"></a><a class="link" href="#sec:intellij_idea_integration">IntelliJ IDEA Integration</a></h4>
<div class="paragraph">
<p>When the IDEA plugin encounters a Scala project, it adds additional configuration to make the project work with IDEA out of the box. Specifically, the plugin adds a Scala SDK (IntelliJ IDEA 14+) and a Scala compiler library that matches the Scala version on the project&#8217;s class path. The Scala plugin is backwards compatible with earlier versions of IntelliJ IDEA and it is possible to add a Scala facet instead of the default Scala SDK by configuring <code>targetVersion</code> on <a href="https://docs.gradle.org/8.9/dsl/org.gradle.plugins.ide.idea.model.IdeaModel.html">IdeaModel</a>.</p>
</div>
<div id="ex-explicitly-specify-a-target-intellij-idea-version" class="exampleblock">
<div class="title">Example 90. <a href="#ex-explicitly-specify-a-target-intellij-idea-version">Explicitly specify a target IntelliJ IDEA version</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">idea {
    targetVersion = &quot;13&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">idea {
    targetVersion = <span class="string"><span class="delimiter">'</span><span class="content">13</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:dependency_management"><a class="anchor" href="#part:dependency_management"></a><a class="link" href="#part:dependency_management"><strong>WORKING WITH DEPENDENCIES</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dependency_management_terminology"><a class="anchor" href="#dependency_management_terminology"></a><a class="link" href="#dependency_management_terminology">Dependency Management Terminology</a></h3>
<div class="paragraph">
<p>Dependency management comes with a wealth of terminology.
Here you can find the most commonly-used terms including references to the user guide to learn about their practical application.</p>
</div>
<div class="sect3">
<h4 id="sub:terminology_artifact"><a class="anchor" href="#sub:terminology_artifact"></a><a class="link" href="#sub:terminology_artifact">Artifact</a></h4>
<div class="paragraph">
<p>A file or directory produced by a build, such as a JAR, a ZIP distribution, or a native executable.</p>
</div>
<div class="paragraph">
<p>Artifacts are typically designed to be used or consumed by users or other projects, or deployed to hosting systems.
In such cases, the artifact is a single file.
Directories are common in the case of inter-project dependencies to avoid the cost of producing the publishable artifact.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_capability"><a class="anchor" href="#sub:terminology_capability"></a><a class="link" href="#sub:terminology_capability">Capability</a></h4>
<div class="paragraph">
<p>A capability identifies a feature offered by one or multiple components.
A capability is identified by coordinates similar to the coordinates used for <a href="#sub:terminology_module_version">module versions</a>.
By default, each module version offers a capability that matches its coordinates, for example <code>com.google:guava:18.0</code>.
Capabilities can be used to express that a component provides multiple <a href="#sub:terminology_feature_variant">feature variants</a> or that two different components implement the same feature (and thus cannot be used together).
For more details, see the section on <a href="#declaring-component-capabilities">capabilities</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_component"><a class="anchor" href="#sub:terminology_component"></a><a class="link" href="#sub:terminology_component">Component</a></h4>
<div class="paragraph">
<p>Any single version of a <a href="#sub:terminology_module">module</a>.</p>
</div>
<div class="paragraph">
<p>For external libraries, the term component refers to one published version of the library.</p>
</div>
<div class="paragraph">
<p>In a build, components are defined by plugins (e.g. the Java Library plugin) and provide a simple way to define a publication for publishing.
They comprise <a href="#sub:terminology_artifact">artifacts</a> as well as the appropriate <a href="#sub:terminology_artifact">metadata</a> that describes a component&#8217;s <a href="#sub:terminology_variant">variants</a> in detail.
For example, the <code>java</code> component in its default setup consists of a JAR — produced by the <code>jar</code> task — and the dependency information of the Java <em>api</em> and <em>runtime</em> variants.
It may also define additional variants, for example <em>sources</em> and <em>Javadoc</em>, with the corresponding artifacts.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_configuration"><a class="anchor" href="#sub:terminology_configuration"></a><a class="link" href="#sub:terminology_configuration">Configuration</a></h4>
<div class="paragraph">
<p>A configuration is a named set of <a href="#sub:terminology_dependency">dependencies</a> grouped together for a specific goal.
Configurations provide access to the underlying, resolved <a href="#sub:terminology_module">modules</a> and their artifacts.
For more information, see the sections on <a href="#sec:what-are-dependency-configurations">dependency configurations</a> as well as <a href="#sec:resolvable-consumable-configs">resolvable and consumable configurations</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The word "configuration" is an overloaded term and has a different meaning outside of the context of dependency management.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_dependency"><a class="anchor" href="#sub:terminology_dependency"></a><a class="link" href="#sub:terminology_dependency">Dependency</a></h4>
<div class="paragraph">
<p>A dependency is a pointer to another piece of software required to build, test or run a <a href="#sub:terminology_module">module</a>.
For more information, see the section on <a href="#declaring-dependencies">declaring dependencies</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_dependency_constraint"><a class="anchor" href="#sub:terminology_dependency_constraint"></a><a class="link" href="#sub:terminology_dependency_constraint">Dependency constraint</a></h4>
<div class="paragraph">
<p>A dependency constraint defines requirements that need to be met by a module to make it a valid resolution result for the dependency.
For example, a dependency constraint can narrow down the set of supported module versions.
Dependency constraints can be used to express such requirements for transitive dependencies.
For more information, see the sections on <a href="#dependency-constraints">upgrading</a> and <a href="#downgrading_versions_and_excluding_dependencies">downgrading</a> transitive dependencies.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_feature_variant"><a class="anchor" href="#sub:terminology_feature_variant"></a><a class="link" href="#sub:terminology_feature_variant">Feature Variant</a></h4>
<div class="paragraph">
<p>A feature variant is a <a href="#sub:terminology_variant">variant</a> representing a feature of a component that can be individually selected or not.
A feature variant is identified by one or more <a href="#sub:terminology_capability">capabilities</a>.
For more information, see the sections on <a href="#feature_variants">modeling feature variants and optional dependencies</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_module"><a class="anchor" href="#sub:terminology_module"></a><a class="link" href="#sub:terminology_module">Module</a></h4>
<div class="paragraph">
<p>A piece of software that evolves over time e.g. <a href="https://github.com/google/guava">Google Guava</a>.
Every module has a name. Each release of a module is optimally represented by a <a href="#sub:terminology_module_version">module version</a>.
For convenient consumption, modules can be hosted in a <a href="#sub:terminology_repository">repository</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_module_metadata"><a class="anchor" href="#sub:terminology_module_metadata"></a><a class="link" href="#sub:terminology_module_metadata">Module metadata</a></h4>
<div class="paragraph">
<p>Releases of a <a href="#sub:terminology_module">module</a> provide metadata.
Metadata is the data that describes the module in more detail e.g. information about the location of artifacts or required <a href="#sub:terminology_transitive_dependency">transitive dependencies</a>.
Gradle offers its own metadata format called <a href="https://github.com/gradle/gradle/blob/master/platforms/documentation/docs/src/docs/design/gradle-module-metadata-latest-specification.md">Gradle Module Metadata</a> (<code>.module</code> file) but also supports Maven (<code>.pom</code>) and Ivy (<code>ivy.xml</code>) metadata.
See the section on <a href="#sec:understanding-gradle-module-md">understanding Gradle Module Metadata</a> for more information on the supported metadata formats.</p>
</div>
</div>
<div class="sect3">
<h4 id="component_metadata_rule"><a class="anchor" href="#component_metadata_rule"></a><a class="link" href="#component_metadata_rule">Component metadata rule</a></h4>
<div class="paragraph">
<p>A component metadata rule is a rule that modifies a component&#8217;s metadata after it was fetched from a repository, e.g. to add missing information or to correct wrong information.
In contrast to <a href="#sub:terminology_resolution_rule">resolution rules</a>, component metadata rules are applied <strong>before</strong> resolution starts.
Component metadata rules are defined as part of the build logic and can be shared through plugins.
For more information, see the section on <a href="#sec:component_metadata_rules">fixing metadata with component metadata rules</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_module_version"><a class="anchor" href="#sub:terminology_module_version"></a><a class="link" href="#sub:terminology_module_version">Module version</a></h4>
<div class="paragraph">
<p>A module version represents a distinct set of changes of a released <a href="#sub:terminology_module">module</a>.
For example <code>18.0</code> represents the version of the module with the coordinates <code>com.google:guava:18.0</code>.
In practice there&#8217;s no limitation to the scheme of the module version.
Timestamps, numbers, special suffixes like <code>-GA</code> are all allowed identifiers.
The most widely-used versioning strategy is <a href="https://semver.org/">semantic versioning</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub::terminology_platform"><a class="anchor" href="#sub::terminology_platform"></a><a class="link" href="#sub::terminology_platform">Platform</a></h4>
<div class="paragraph">
<p>A platform is a set of modules aimed to be used together. There are different categories of platforms, corresponding to different use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>module set: often a set of modules published together as a whole. Using one module of the set often means we want to use the same version for all modules of the set. For example, if using <code>groovy</code> 1.2, also use <code>groovy-json</code> 1.2.</p>
</li>
<li>
<p>runtime environment: a set of libraries known to work well together. e.g., the Spring Platform, recommending versions for both Spring and components that work well with Spring.</p>
</li>
<li>
<p>deployment environment: Java runtime, application server, &#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition Gradle defines <a href="#sec:virtual_platform">virtual platforms</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Maven&#8217;s BOM (bill-of-material) is a popular kind of platform that <a href="#sub:bom_import">Gradle supports</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_publication"><a class="anchor" href="#sub:terminology_publication"></a><a class="link" href="#sub:terminology_publication">Publication</a></h4>
<div class="paragraph">
<p>A description of the files and metadata that should be published to a repository as a single entity for use by consumers.</p>
</div>
<div class="paragraph">
<p>A publication has a name and consists of one or more artifacts plus information about those artifacts (the <a href="#sub:terminology_module_metadata">metadata</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_repository"><a class="anchor" href="#sub:terminology_repository"></a><a class="link" href="#sub:terminology_repository">Repository</a></h4>
<div class="paragraph">
<p>A repository hosts a set of <a href="#sub:terminology_module">modules</a>, each of which may provide one or many releases (components) indicated by a <a href="#sub:terminology_module_version">module version</a>.
The repository can be based on a binary repository product (e.g. Artifactory or Nexus) or a directory structure in the filesystem.
For more information, see <a href="#declaring-repositories">Declaring Repositories</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_resolution_rule"><a class="anchor" href="#sub:terminology_resolution_rule"></a><a class="link" href="#sub:terminology_resolution_rule">Resolution rule</a></h4>
<div class="paragraph">
<p>A resolution rule influences the behavior of how a <a href="#sub:terminology_dependency">dependency</a> is resolved directly.
Resolution rules are defined as part of the build logic.
For more information, see the section on <a href="#resolution_rules">customizing resolution of a dependency directly</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_transitive_dependency"><a class="anchor" href="#sub:terminology_transitive_dependency"></a><a class="link" href="#sub:terminology_transitive_dependency">Transitive dependency</a></h4>
<div class="paragraph">
<p>A variant of a <a href="#sub:terminology_component">component</a> can have dependencies on other modules to work properly, so-called transitive dependencies.
Releases of a module hosted on a <a href="#sub:terminology_repository">repository</a> can provide <a href="#sub:terminology_module_metadata">metadata</a> to declare those transitive dependencies.
By default, Gradle resolves transitive dependencies automatically.
The version selection for transitive dependencies can be influenced by declaring <a href="#dependency-constraints">dependency constraints</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_variant"><a class="anchor" href="#sub:terminology_variant"></a><a class="link" href="#sub:terminology_variant">Variant (of a component)</a></h4>
<div class="paragraph">
<p>Each <a href="#sub:terminology_component">component</a> consists of one or more variants.
A variant consists of a set of artifacts and defines a set of dependencies.
It is identified by a set of <a href="#sub:terminology_attribute">attributes</a> and <a href="#sub:terminology_capability">capabilities</a>.</p>
</div>
<div class="paragraph">
<p>Gradle&#8217;s dependency resolution is variant-aware and selects one or more variants of each component after a component (i.e. one version of a module) has been selected.
It may also fail if the variant selection result is ambiguous, meaning that Gradle does not have enough information to select one of multiple mutual exclusive variants.
In that case, more information can be provided through <a href="#sub:terminology_attribute">variant attributes</a>.
Examples of variants each Java components typically offers are <em>api</em> and <em>runtime</em> variants.
Others examples are JDK8 and JDK11 variants.
For more information, see the section on <a href="#understanding-variant-selection">variant selection</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:terminology_attribute"><a class="anchor" href="#sub:terminology_attribute"></a><a class="link" href="#sub:terminology_attribute">Variant Attribute</a></h4>
<div class="paragraph">
<p>Attributes are used to identify and select <a href="#sub:terminology_variant">variants</a>.
A variant has one or more attributes defined, for example <code>org.gradle.usage=java-api</code>, <code>org.gradle.jvm.version=11</code>.
When dependencies are resolved, a set of attributes are requested and Gradle finds the best fitting variant(s) for each component in the dependency graph.
Compatibility and disambiguation rules can be implemented for an attribute to express compatibility between values (e.g. Java 8 is compatible with Java 11, but Java 11 should be preferred if the requested version is 11 or higher).
Such rules are typically provided by plugins.
For more information, see the sections on <a href="#understanding-variant-selection">variant selection</a> and <a href="#variant_attributes">declaring attributes</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the_basics_2"><a class="anchor" href="#the_basics_2"></a><a class="link" href="#the_basics_2">THE BASICS</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dependency_management_in_gradle"><a class="anchor" href="#dependency_management_in_gradle"></a><a class="link" href="#dependency_management_in_gradle">Dependency Management</a></h3>
<div class="paragraph">
<p>Software projects rarely work in isolation.
Projects often rely on reusable functionality from libraries.
Some projects organize unrelated functionality into separate parts of a modular system.</p>
</div>
<div class="paragraph">
<p>Dependency management is an automated technique for declaring, resolving, and using functionality required by a project.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
For an overview of dependency management terms, see <a href="#dependency_management_terminology">Dependency Management Terminology</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sec:dependency-mgmt-in-gradle"><a class="anchor" href="#sec:dependency-mgmt-in-gradle"></a><a class="link" href="#sec:dependency-mgmt-in-gradle">Dependency Management in Gradle</a></h4>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-resolution.png" alt="dependency management resolution">
</div>
<div class="title">Figure 5. Dependencies management at a glance</div>
</div>
<div class="paragraph">
<p>Gradle has built-in support for dependency management.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s explore the main concepts with the help of a theoretical but common project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This project builds Java source code.</p>
</li>
<li>
<p>Some Java source files import classes from the <a href="https://github.com/google/guava">Google Guava</a> library.</p>
</li>
<li>
<p>This project uses <a href="http://junit.org/junit5/">JUnit</a> for testing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Gradle build file might look as follows:</p>
</div>
<div id="ex-gradle-build-file-with-dependencies" class="exampleblock">
<div class="title">Example 91. <a href="#ex-gradle-build-file-with-dependencies">Gradle build file with dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

repositories { // <b class="conum">(1)</b>
    google() // <b class="conum">(2)</b>
    mavenCentral()
}

dependencies { // <b class="conum">(3)</b>
    implementation(&quot;com.google.guava:guava:32.1.2-jre&quot;) // <b class="conum">(4)</b>
    testImplementation(&quot;junit:junit:4.13.2&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

repositories { // <b class="conum">(1)</b>
    google() // <b class="conum">(2)</b>
    mavenCentral()
}

dependencies { // <b class="conum">(3)</b>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:32.1.2-jre</span><span class="delimiter">'</span></span> // <b class="conum">(4)</b>
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.13.2</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><strong>Here we define repositories for the project.</strong></p>
</li>
<li>
<p><strong>Here we declare remote and local repositories for dependency locations.</strong></p>
<div class="paragraph">
<p>You can <a href="#declaring-repositories">declare <em>repositories</em></a> to tell Gradle where to fetch local or remote <em>dependencies</em>.<br>
In this example, Gradle fetches <em>dependencies</em> from the <a href="https://repo1.maven.org/maven2/">Maven Central</a> and <a href="https://maven.google.com/">Google</a> <em>repositories</em>.<br>
During a build, Gradle locates and downloads the dependencies, a process called <a href="#sec:how-gradle-downloads-deps"><em>dependency resolution</em></a>.
Gradle then <a href="#sec:dependency_cache">stores resolved dependencies in a local cache</a> called the <em>dependency cache</em>.
Subsequent builds use this cache to avoid unnecessary network calls and speed up the build process.</p>
</div>
</li>
<li>
<p><strong>Here we define dependencies used by the project.</strong></p>
</li>
<li>
<p><strong>Here we declare the specific dependency name and version within a scope.</strong></p>
<div class="paragraph">
<p>You can add code to your Java project from an external library such as <code>com.google.common.base</code> (a Guava package) which becomes a <em>dependency</em>.<br>
In this example, the theoretical project uses Guava version 32.1.2-jre and JUnit 4.13.2 as <em>dependencies</em>.<br>
A build engineer can <a href="#declaring-dependencies">declare dependencies</a> for different scopes. For example, you can declare dependencies that are only used at compile time.
Gradle calls the <a href="#sec:what-are-dependency-configurations">scope of a dependency</a> a <em>configuration</em>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Repositories offer dependencies in multiple formats.
For information about the formats supported by Gradle, see <a href="#sec:dependency-types">dependency types</a>.</p>
</div>
<div class="paragraph">
<p>Metadata describes dependencies.
Some examples of metadata include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>coordinates for finding the dependency in a repository</p>
</li>
<li>
<p>information about the project that created the dependency</p>
</li>
<li>
<p>the authors of the dependency</p>
</li>
<li>
<p>other dependencies required for a dependency to work properly, known as <em>transitive dependencies</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can <a href="#dependency-constraints">customize Gradle&#8217;s handling of transitive dependencies</a> based on the requirements of a project.</p>
</div>
<div class="paragraph">
<p>Projects with hundreds of declared dependencies can be difficult to debug.
Gradle provides tools to visualize and analyze a project&#8217;s dependency graph (i.e. dependency tree).
You can use a <a href="https://scans.gradle.com/get-started">Build Scan&#8482;</a> or <a href="#sec:debugging-build-scans">built-in tasks</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-core-test-build-scan-dependencies.png" alt="gradle core test build scan dependencies">
</div>
<div class="title">Figure 6. Build scan dependencies report</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="declaring-repositories"><a class="anchor" href="#declaring-repositories"></a><a class="link" href="#declaring-repositories">Declaring repositories</a></h3>
<div class="paragraph">
<p>Gradle can resolve dependencies from one or many repositories based on Maven, Ivy or flat directory formats.
Check out the <a href="#sec:repository-types">full reference on all types of repositories</a> for more information.</p>
</div>
<div class="sect3">
<h4 id="sec:declaring_public_repository"><a class="anchor" href="#sec:declaring_public_repository"></a><a class="link" href="#sec:declaring_public_repository">Declaring a publicly-available repository</a></h4>
<div class="paragraph">
<p>Organizations building software may want to leverage public binary repositories to download and consume open source dependencies.
Popular public repositories include <a href="#sub:maven_central">Maven Central</a> and the <a href="#sub:maven_google">Google Android</a> repository.
Gradle provides built-in shorthand notations for these widely-used repositories.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-shortcut-repositories.png" alt="dependency management shortcut repositories">
</div>
<div class="title">Figure 7. Declaring a repository with the help of shorthand notations</div>
</div>
<div class="paragraph">
<p>Under the covers Gradle resolves dependencies from the respective URL of the public repository defined by the shorthand notation.
All shorthand notations are available via the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.dsl.RepositoryHandler.html">RepositoryHandler</a> API.
Alternatively, you can <a href="#sec:declaring_custom_repository">spell out the URL of the repository</a> for more fine-grained control.</p>
</div>
<div class="sect4">
<h5 id="sub:maven_central"><a class="anchor" href="#sub:maven_central"></a><a class="link" href="#sub:maven_central">Maven Central repository</a></h5>
<div class="paragraph">
<p>Maven Central is a popular repository hosting open source libraries for consumption by Java projects.</p>
</div>
<div class="paragraph">
<p>To declare the <a href="https://repo.maven.apache.org/maven2/">Maven Central repository</a> for your build add this to your script:</p>
</div>
<div id="ex-adding-central-maven-repository" class="exampleblock">
<div class="title">Example 92. <a href="#ex-adding-central-maven-repository">Adding central Maven repository</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:maven_google"><a class="anchor" href="#sub:maven_google"></a><a class="link" href="#sub:maven_google">Google Maven repository</a></h5>
<div class="paragraph">
<p>The Google repository hosts Android-specific artifacts including the Android SDK. For usage examples, see the <a href="https://developer.android.com/studio/build/dependencies.html#google-maven">relevant Android documentation</a>.</p>
</div>
<div class="paragraph">
<p>To declare the <a href="https://maven.google.com/">Google Maven repository</a> add this to your build script:</p>
</div>
<div id="ex-adding-google-maven-repository" class="exampleblock">
<div class="title">Example 93. <a href="#ex-adding-google-maven-repository">Adding Google Maven repository</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    google()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    google()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:declaring_custom_repository"><a class="anchor" href="#sec:declaring_custom_repository"></a><a class="link" href="#sec:declaring_custom_repository">Declaring a custom repository by URL</a></h4>
<div class="paragraph">
<p>Most enterprise projects set up a binary repository available only within an intranet.
In-house repositories enable teams to publish internal binaries, setup user management and security measure and ensure uptime and availability.
Specifying a custom URL is also helpful if you want to declare a less popular, but publicly-available repository.</p>
</div>
<div class="paragraph">
<p>Repositories with custom URLs can be specified as Maven or Ivy repositories by calling the corresponding methods available on the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.dsl.RepositoryHandler.html">RepositoryHandler</a> API.
Gradle supports other protocols than <code>http</code> or <code>https</code> as part of the custom URL e.g. <code>file</code>, <code>sftp</code> or <code>s3</code>.
For a full coverage see the <a href="#sec:repository-types">section on supported repository types</a>.</p>
</div>
<div class="paragraph">
<p>You can also <a href="#sub:defining_custom_pattern_layout_for_an_ivy_repository">define your own repository layout</a> by using <code>ivy { }</code> repositories as they are very flexible in terms of how modules are organised in a repository.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:declaring_multiple_repositories"><a class="anchor" href="#sec:declaring_multiple_repositories"></a><a class="link" href="#sec:declaring_multiple_repositories">Declaring multiple repositories</a></h4>
<div class="paragraph">
<p>You can define more than one repository for resolving dependencies.
Declaring multiple repositories is helpful if some dependencies are only available in one repository but not the other.
You can mix any type of repository described in the <a href="#sec:repository-types">reference section</a>.</p>
</div>
<div class="paragraph">
<p>This example demonstrates how to declare various named and custom URL repositories for a project:</p>
</div>
<div id="ex-declaring-multiple-repositories" class="exampleblock">
<div class="title">Example 94. <a href="#ex-declaring-multiple-repositories">Declaring multiple repositories</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
    maven {
        url = uri(&quot;https://repo.spring.io/release&quot;)
    }
    maven {
        url = uri(&quot;https://repository.jboss.org/maven2&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.spring.io/release</span><span class="delimiter">&quot;</span></span>
    }
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repository.jboss.org/maven2</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The order of declaration determines how Gradle will check for dependencies at runtime.
If Gradle finds a module descriptor in a particular repository, it will attempt to download all of the artifacts for that module from <em>the same repository</em>.
You can learn more about the inner workings of <a href="#sec:how-gradle-downloads-deps">dependency downloads</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="strict_limitation_to_declared_repositories"><a class="anchor" href="#strict_limitation_to_declared_repositories"></a><a class="link" href="#strict_limitation_to_declared_repositories">Strict limitation to declared repositories</a></h5>
<div class="paragraph">
<p>Maven POM metadata can reference additional repositories.
These will be <em>ignored</em> by Gradle, which will only use the repositories declared in the build itself.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This is a reproducibility safe-guard but also a security protection.
Without it, an updated version of a dependency could pull artifacts from anywhere into your build.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:repository-types"><a class="anchor" href="#sec:repository-types"></a><a class="link" href="#sec:repository-types">Supported repository types</a></h4>
<div class="paragraph">
<p>Gradle supports a wide range of sources for dependencies, both in terms of format and in terms of connectivity.
You may resolve dependencies from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Different formats</p>
<div class="ulist">
<ul>
<li>
<p>a <a href="#sec:maven_repo">Maven compatible</a> artifact repository (e.g: Maven Central)</p>
</li>
<li>
<p>an <a href="#sec:ivy_repositories">Ivy compatible</a> artifact repository (including custom layouts)</p>
</li>
<li>
<p><a href="#sub:flat_dir_resolver">local (flat) directories</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>with different connectivity</p>
<div class="ulist">
<ul>
<li>
<p><a href="#sec:authentication_schemes">authenticated repositories</a></p>
</li>
<li>
<p>a wide variety of <a href="#sec:supported_transport_protocols">remote protocols</a> such as HTTPS, SFTP, AWS S3 and Google Cloud Storage</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="sub:flat_dir_resolver"><a class="anchor" href="#sub:flat_dir_resolver"></a><a class="link" href="#sub:flat_dir_resolver">Flat directory repository</a></h5>
<div class="paragraph">
<p>Some projects might prefer to store dependencies on a shared drive or as part of the project source code instead of a binary repository product. If you want to use a (flat) filesystem directory as a repository, simply type:</p>
</div>
<div id="ex-flat-repository-resolver" class="exampleblock">
<div class="title">Example 95. <a href="#ex-flat-repository-resolver">Flat repository resolver</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    flatDir {
        dirs(&quot;lib&quot;)
    }
    flatDir {
        dirs(&quot;lib1&quot;, &quot;lib2&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    flatDir {
        dirs <span class="string"><span class="delimiter">'</span><span class="content">lib</span><span class="delimiter">'</span></span>
    }
    flatDir {
        dirs <span class="string"><span class="delimiter">'</span><span class="content">lib1</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lib2</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This adds repositories which look into one or more directories for finding dependencies.</p>
</div>
<div class="paragraph">
<p>This type of repository does not support any meta-data formats like Ivy XML or Maven POM files.
Instead, Gradle will dynamically generate a module descriptor (without any dependency information) based on the presence of artifacts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>As Gradle prefers to use modules whose descriptor has been created from real meta-data rather than being generated, flat directory repositories cannot be used to override artifacts with real meta-data from other repositories declared in the build.</p>
</div>
<div class="paragraph">
<p>For example, if Gradle finds only <code>jmxri-1.2.1.jar</code> in a flat directory repository, but <code>jmxri-1.2.1.pom</code> in another repository that supports meta-data, it will use the second repository to provide the module.</p>
</div>
<div class="paragraph">
<p>For the use case of overriding remote artifacts with local ones consider using an Ivy or Maven repository instead whose URL points to a local directory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you only work with flat directory repositories you don&#8217;t need to set all attributes of a dependency.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:local-repos"><a class="anchor" href="#sub:local-repos"></a><a class="link" href="#sub:local-repos">Local repositories</a></h5>
<div class="paragraph">
<p>The following sections describe repositories format, Maven or Ivy.
These can be declared as local repositories, using a local filesystem path to access them.</p>
</div>
<div class="paragraph">
<p>The difference with the flat directory repository is that they do respect a format and contain metadata.</p>
</div>
<div class="paragraph">
<p>When such a repository is configured, Gradle totally bypasses its <a href="#sec:dependency_cache">dependency cache</a> for it as there can be no guarantee that content may not change between executions.
Because of that limitation, they can have a performance impact.</p>
</div>
<div class="paragraph">
<p>They also make build reproducibility much harder to achieve and their use should be limited to tinkering or prototyping.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:maven_repo"><a class="anchor" href="#sec:maven_repo"></a><a class="link" href="#sec:maven_repo">Maven repositories</a></h4>
<div class="paragraph">
<p>Many organizations host dependencies in an in-house Maven repository only accessible within the company&#8217;s network.
Gradle can declare Maven repositories by URL.</p>
</div>
<div class="paragraph">
<p>For adding a custom Maven repository you can do:</p>
</div>
<div id="ex-adding-custom-maven-repository" class="exampleblock">
<div class="title">Example 96. <a href="#ex-adding-custom-maven-repository">Adding custom Maven repository</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;http://repo.mycompany.com/maven2&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:custom-maven-repo"><a class="anchor" href="#sub:custom-maven-repo"></a><a class="link" href="#sub:custom-maven-repo">Setting up composite Maven repositories</a></h5>
<div class="paragraph">
<p>Sometimes a repository will have the POMs published to one location, and the JARs and other artifacts published at another location.
To define such a repository, you can do:</p>
</div>
<div id="ex-adding-additional-maven-repositories-for-jar-files" class="exampleblock">
<div class="title">Example 97. <a href="#ex-adding-additional-maven-repositories-for-jar-files">Adding additional Maven repositories for JAR files</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        // Look for POMs and artifacts, such as JARs, here
        url = uri(&quot;http://repo2.mycompany.com/maven2&quot;)
        // Look for artifacts here if not found at the above location
        artifactUrls(&quot;http://repo.mycompany.com/jars&quot;)
        artifactUrls(&quot;http://repo.mycompany.com/jars2&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        <span class="comment">// Look for POMs and artifacts, such as JARs, here</span>
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo2.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
        <span class="comment">// Look for artifacts here if not found at the above location</span>
        artifactUrls <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/jars</span><span class="delimiter">&quot;</span></span>
        artifactUrls <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/jars2</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle will look at the base <code>url</code> location for the POM and the JAR.
If the JAR can&#8217;t be found there, the extra <code>artifactUrls</code> are used to look for JARs.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:accessing_secured_maven_repositories"><a class="anchor" href="#sub:accessing_secured_maven_repositories"></a><a class="link" href="#sub:accessing_secured_maven_repositories">Accessing authenticated Maven repositories</a></h5>
<div class="paragraph">
<p>You can specify credentials for Maven repositories secured by different type of authentication.</p>
</div>
<div class="paragraph">
<p>See <a href="#sec:supported_transport_protocols">Supported repository transport protocols</a> for authentication options.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:maven_local"><a class="anchor" href="#sub:maven_local"></a><a class="link" href="#sub:maven_local">Local Maven repository</a></h5>
<div class="paragraph">
<p>Gradle can consume dependencies available in the <a href="https://maven.apache.org/guides/introduction/introduction-to-repositories.html">local Maven repository</a>.
Declaring this repository is beneficial for teams that publish to the local Maven repository with one project and consume the artifacts by Gradle in another project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Gradle stores resolved dependencies in <a href="#sec:dependency_cache">its own cache</a>.
A build does not need to declare the local Maven repository even if you resolve dependencies from a Maven-based, remote repository.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Before adding Maven local as a repository, you should <a href="#sec:case-for-maven-local">make sure this is really required</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To declare the local Maven cache as a repository add this to your build script:</p>
</div>
<div id="ex-adding-the-local-maven-cache-as-a-repository" class="exampleblock">
<div class="title">Example 98. <a href="#ex-adding-the-local-maven-cache-as-a-repository">Adding the local Maven cache as a repository</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenLocal()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenLocal()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle uses the same logic as Maven to identify the location of your local Maven cache.
If a local repository location is defined in a <code>settings.xml</code>, this location will be used.
The <code>settings.xml</code> in <code>&lt;home directory of the current user&gt;/.m2</code> takes precedence over the <code>settings.xml</code> in <code><em>M2_HOME</em>/conf</code>.
If no <code>settings.xml</code> is available, Gradle uses the default location <code>&lt;home directory of the current user&gt;/.m2/repository</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:case-for-maven-local"><a class="anchor" href="#sec:case-for-maven-local"></a><a class="link" href="#sec:case-for-maven-local">The case for mavenLocal()</a></h4>
<div class="paragraph">
<p>As a general advice, you should avoid adding <code>mavenLocal()</code> as a repository.
There are different issues with using <code>mavenLocal()</code> that you should be aware of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven uses it as a cache, not a repository, meaning it can contain partial modules.</p>
<div class="ulist">
<ul>
<li>
<p>For example, if Maven never downloaded the source or javadoc files for a given module, Gradle will not find them either since it <a href="#sec:how-gradle-downloads-deps">searches for files in a single repository</a> once a module has been found.</p>
</li>
</ul>
</div>
</li>
<li>
<p>As a <a href="#sub:local-repos">local repository</a>, Gradle does not trust its content, because:</p>
<div class="ulist">
<ul>
<li>
<p>Origin of artifacts cannot be tracked, which is a correctness and security problem</p>
</li>
<li>
<p>Artifacts can be easily overwritten, which is a security, correctness and reproducibility problem</p>
</li>
</ul>
</div>
</li>
<li>
<p>To mitigate the fact that metadata and/or artifacts can be changed, Gradle does not perform <a href="#sec:dependency_cache">any caching</a> for <a href="#sub:local-repos">local repositories</a></p>
<div class="ulist">
<ul>
<li>
<p>As a consequence, your builds are slower</p>
</li>
<li>
<p>Given that order of repositories is important, adding <code>mavenLocal()</code> <em>first</em> means that all your builds are going to be slower</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are a few cases where you might have to use <code>mavenLocal()</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For interoperability with Maven</p>
<div class="ulist">
<ul>
<li>
<p>For example, project A is built with Maven, project B is built with Gradle, and you need to share the artifacts during development</p>
</li>
<li>
<p>It is <em>always</em> preferable to use an internal full featured repository instead</p>
</li>
<li>
<p>In case this is not possible, you should limit this to <em>local builds only</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>For interoperability with Gradle itself</p>
<div class="ulist">
<ul>
<li>
<p>In a multi-repository world, you want to check that changes to project A work with project B</p>
</li>
<li>
<p>It is preferable to use <a href="#composite_builds">composite builds</a> for this use case</p>
</li>
<li>
<p>If for some reason neither composite builds nor full featured repository are possible, then <code>mavenLocal()</code> is a last resort option</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After all these warnings, if you end up using <code>mavenLocal()</code>, consider combining it with <a href="#sec:repository-content-filtering">a repository filter</a>.
This will make sure it only provides what is expected and nothing else.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:ivy_repositories"><a class="anchor" href="#sec:ivy_repositories"></a><a class="link" href="#sec:ivy_repositories">Ivy repositories</a></h4>
<div class="paragraph">
<p>Organizations might decide to host dependencies in an in-house Ivy repository. Gradle can declare Ivy repositories by URL.</p>
</div>
<div class="sect4">
<h5 id="sub:defining_an_ivy_repository_with_a_standard_layout"><a class="anchor" href="#sub:defining_an_ivy_repository_with_a_standard_layout"></a><a class="link" href="#sub:defining_an_ivy_repository_with_a_standard_layout">Defining an Ivy repository with a standard layout</a></h5>
<div class="paragraph">
<p>To declare an Ivy repository using the standard layout no additional customization is needed. You just declare the URL.</p>
</div>
<div id="ex-ivy-repository" class="exampleblock">
<div class="title">Example 99. <a href="#ex-ivy-repository">Ivy repository</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:defining_a_named_layout_for_an_ivy_repository"><a class="anchor" href="#sub:defining_a_named_layout_for_an_ivy_repository"></a><a class="link" href="#sub:defining_a_named_layout_for_an_ivy_repository">Defining a named layout for an Ivy repository</a></h5>
<div class="paragraph">
<p>You can specify that your repository conforms to the Ivy or Maven default layout by using a named layout.</p>
</div>
<div id="ex-ivy-repository-with-named-layout" class="exampleblock">
<div class="title">Example 100. <a href="#ex-ivy-repository-with-named-layout">Ivy repository with named layout</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        layout(&quot;maven&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        layout <span class="string"><span class="delimiter">&quot;</span><span class="content">maven</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Valid named layout values are <code>'gradle'</code> (the default), <code>'maven'</code> and <code>'ivy'</code>. See <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.repositories.IvyArtifactRepository.html#org.gradle.api.artifacts.repositories.IvyArtifactRepository:layout(java.lang.String)">IvyArtifactRepository.layout(java.lang.String)</a> in the API documentation for details of these named layouts.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:defining_custom_pattern_layout_for_an_ivy_repository"><a class="anchor" href="#sub:defining_custom_pattern_layout_for_an_ivy_repository"></a><a class="link" href="#sub:defining_custom_pattern_layout_for_an_ivy_repository">Defining custom pattern layout for an Ivy repository</a></h5>
<div class="paragraph">
<p>To define an Ivy repository with a non-standard layout, you can define a <em>pattern</em> layout for the repository:</p>
</div>
<div id="ex-ivy-repository-with-pattern-layout" class="exampleblock">
<div class="title">Example 101. <a href="#ex-ivy-repository-with-pattern-layout">Ivy repository with pattern layout</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        patternLayout {
            artifact(&quot;[module]/[revision]/[type]/[artifact].[ext]&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        patternLayout {
            artifact <span class="string"><span class="delimiter">&quot;</span><span class="content">[module]/[revision]/[type]/[artifact].[ext]</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To define an Ivy repository which fetches Ivy files and artifacts from different locations, you can define separate patterns to use to locate the Ivy files and artifacts:</p>
</div>
<div class="paragraph">
<p>Each <code>artifact</code> or <code>ivy</code> specified for a repository adds an <em>additional</em> pattern to use. The patterns are used in the order that they are defined.</p>
</div>
<div id="ex-ivy-repository-with-multiple-custom-patterns" class="exampleblock">
<div class="title">Example 102. <a href="#ex-ivy-repository-with-multiple-custom-patterns">Ivy repository with multiple custom patterns</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        patternLayout {
            artifact(&quot;3rd-party-artifacts/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]&quot;)
            artifact(&quot;company-artifacts/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]&quot;)
            ivy(&quot;ivy-files/[organisation]/[module]/[revision]/ivy.xml&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        patternLayout {
            artifact <span class="string"><span class="delimiter">&quot;</span><span class="content">3rd-party-artifacts/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]</span><span class="delimiter">&quot;</span></span>
            artifact <span class="string"><span class="delimiter">&quot;</span><span class="content">company-artifacts/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]</span><span class="delimiter">&quot;</span></span>
            ivy <span class="string"><span class="delimiter">&quot;</span><span class="content">ivy-files/[organisation]/[module]/[revision]/ivy.xml</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Optionally, a repository with pattern layout can have its <code>'organisation'</code> part laid out in Maven style, with forward slashes replacing dots as separators. For example, the organisation <code>my.company</code> would then be represented as <code>my/company</code>.</p>
</div>
<div id="ex-ivy-repository-with-maven-compatible-layout" class="exampleblock">
<div class="title">Example 103. <a href="#ex-ivy-repository-with-maven-compatible-layout">Ivy repository with Maven compatible layout</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        patternLayout {
            artifact(&quot;[organisation]/[module]/[revision]/[artifact]-[revision].[ext]&quot;)
            setM2compatible(true)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        patternLayout {
            artifact <span class="string"><span class="delimiter">&quot;</span><span class="content">[organisation]/[module]/[revision]/[artifact]-[revision].[ext]</span><span class="delimiter">&quot;</span></span>
            m2compatible = <span class="predefined-constant">true</span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:accessing_secured_ivy_repositories"><a class="anchor" href="#sub:accessing_secured_ivy_repositories"></a><a class="link" href="#sub:accessing_secured_ivy_repositories">Accessing authenticated Ivy repositories</a></h5>
<div class="paragraph">
<p>You can specify credentials for Ivy repositories secured by basic authentication.</p>
</div>
<div id="ex-ivy-repository-with-authentication" class="exampleblock">
<div class="title">Example 104. <a href="#ex-ivy-repository-with-authentication">Ivy repository with authentication</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com&quot;)
        credentials {
            username = &quot;user&quot;
            password = &quot;password&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com</span><span class="delimiter">&quot;</span></span>
        credentials {
            username <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
            password <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#sec:supported_transport_protocols">Supported repository transport protocols</a> for authentication options.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:repository-content-filtering"><a class="anchor" href="#sec:repository-content-filtering"></a><a class="link" href="#sec:repository-content-filtering">Repository content filtering</a></h4>
<div class="paragraph">
<p>Gradle exposes an API to declare what a repository may or may not contain.
There are different use cases for it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>performance, when you know a dependency will never be found in a specific repository</p>
</li>
<li>
<p>security, by avoiding leaking what dependencies are used in a private project</p>
</li>
<li>
<p>reliability, when some repositories contain corrupted metadata or artifacts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s even more important when considering that the declared order of repositories matter.</p>
</div>
<div class="sect4">
<h5 id="sec:declaring-repository-filter"><a class="anchor" href="#sec:declaring-repository-filter"></a><a class="link" href="#sec:declaring-repository-filter">Declaring a repository filter</a></h5>
<div id="ex-declaring-repository-contents" class="exampleblock">
<div class="title">Example 105. <a href="#ex-declaring-repository-contents">Declaring repository contents</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;https://repo.mycompany.com/maven2&quot;)
        content {
            // this repository *only* contains artifacts with group &quot;my.company&quot;
            includeGroup(&quot;my.company&quot;)
        }
    }
    mavenCentral {
        content {
            // this repository contains everything BUT artifacts with group starting with &quot;my.company&quot;
            excludeGroupByRegex(&quot;my\\.company.*&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
        content {
            <span class="comment">// this repository *only* contains artifacts with group &quot;my.company&quot;</span>
            includeGroup <span class="string"><span class="delimiter">&quot;</span><span class="content">my.company</span><span class="delimiter">&quot;</span></span>
        }
    }
    mavenCentral {
        content {
            <span class="comment">// this repository contains everything BUT artifacts with group starting with &quot;my.company&quot;</span>
            excludeGroupByRegex <span class="string"><span class="delimiter">&quot;</span><span class="content">my</span><span class="char">\\</span><span class="content">.company.*</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, repositories include everything and exclude nothing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you declare an include, then it excludes everything <em>but</em> what is included.</p>
</li>
<li>
<p>If you declare an exclude, then it includes everything <em>but</em> what is excluded.</p>
</li>
<li>
<p>If you declare both includes and excludes, then it includes only what is explicitly included and not excluded.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is possible to filter either by explicit <em>group</em>, <em>module</em> or <em>version</em>, either strictly or using regular expressions.
When using a strict version, it is possible to use a version range, using <a href="#single-version-declarations">the format supported</a> by Gradle.
In addition, there are filtering options by resolution context: configuration name or even configuration attributes.
See <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/repositories/RepositoryContentDescriptor.html">RepositoryContentDescriptor</a> for details.</p>
</div>
</div>
<div class="sect4">
<h5 id="declaring_content_exclusively_found_in_one_repository"><a class="anchor" href="#declaring_content_exclusively_found_in_one_repository"></a><a class="link" href="#declaring_content_exclusively_found_in_one_repository">Declaring content exclusively found in one repository</a></h5>
<div class="paragraph">
<p>Filters declared using the <a href="#sec:declaring-repository-filter">repository-level content filter</a> are not exclusive.
This means that declaring that a repository <em>includes</em> an artifact doesn&#8217;t mean that the other repositories can&#8217;t have it either: you must declare what every repository contains in extension.</p>
</div>
<div class="paragraph">
<p>Alternatively, Gradle provides an API which lets you declare that a repository <em>exclusively includes</em> an artifact.
If you do so:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an artifact declared in a repository <em>can&#8217;t</em> be found in any other</p>
</li>
<li>
<p>exclusive repository content must be declared in extension (just like for <a href="#sec:declaring-repository-filter">repository-level content</a>)</p>
</li>
</ul>
</div>
<div id="ex-declaring-exclusive-repository-contents" class="exampleblock">
<div class="title">Example 106. <a href="#ex-declaring-exclusive-repository-contents">Declaring exclusive repository contents</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    // This repository will _not_ be searched for artifacts in my.company
    // despite being declared first
    mavenCentral()
    exclusiveContent {
        forRepository {
            maven {
                url = uri(&quot;https://repo.mycompany.com/maven2&quot;)
            }
        }
        filter {
            // this repository *only* contains artifacts with group &quot;my.company&quot;
            includeGroup(&quot;my.company&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    <span class="comment">// This repository will _not_ be searched for artifacts in my.company</span>
    <span class="comment">// despite being declared first</span>
    mavenCentral()
    exclusiveContent {
        forRepository {
            maven {
                url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
            }
        }
        filter {
            <span class="comment">// this repository *only* contains artifacts with group &quot;my.company&quot;</span>
            includeGroup <span class="string"><span class="delimiter">&quot;</span><span class="content">my.company</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is possible to filter either by explicit <em>group</em>, <em>module</em> or <em>version</em>, either strictly or using regular expressions.
See <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/repositories/InclusiveRepositoryContentDescriptor.html">InclusiveRepositoryContentDescriptor</a> for details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you leverage exclusive content filtering in the <a href="#sec:custom_plugin_repositories"><code>pluginManagement</code> section of the <code>settings.gradle(.kts)</code></a>, it becomes illegal to add more repositories through the project <code>buildscript.repositories</code>.
In that case, the build configuration will fail.</p>
</div>
<div class="paragraph">
<p>Your options are either to declare all repositories in settings or to use non-exclusive content filtering.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="maven_repository_filtering"><a class="anchor" href="#maven_repository_filtering"></a><a class="link" href="#maven_repository_filtering">Maven repository filtering</a></h5>
<div class="paragraph">
<p>For <a href="#sec:maven_repo">Maven repositories</a>, it&#8217;s often the case that a repository would either contain releases or snapshots.
Gradle lets you declare what kind of artifacts are found in a repository using this DSL:</p>
</div>
<div id="ex-splitting-snapshots-and-releases" class="exampleblock">
<div class="title">Example 107. <a href="#ex-splitting-snapshots-and-releases">Splitting snapshots and releases</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;https://repo.mycompany.com/releases&quot;)
        mavenContent {
            releasesOnly()
        }
    }
    maven {
        url = uri(&quot;https://repo.mycompany.com/snapshots&quot;)
        mavenContent {
            snapshotsOnly()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.mycompany.com/releases</span><span class="delimiter">&quot;</span></span>
        mavenContent {
            releasesOnly()
        }
    }
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.mycompany.com/snapshots</span><span class="delimiter">&quot;</span></span>
        mavenContent {
            snapshotsOnly()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:supported_metadata_sources"><a class="anchor" href="#sec:supported_metadata_sources"></a><a class="link" href="#sec:supported_metadata_sources">Supported metadata sources</a></h4>
<div class="paragraph">
<p>When searching for a module in a repository, Gradle, by default, checks for <a href="#sec:supported-metadata-formats">supported metadata file formats</a> in that repository.
In a Maven repository, Gradle looks for a <code>.pom</code> file, in an ivy repository it looks for an <code>ivy.xml</code> file and in a flat directory repository it looks directly for <code>.jar</code> files as it does not expect any metadata.
Starting with 5.0, Gradle also looks for <code>.module</code> (Gradle module metadata) files.</p>
</div>
<div class="paragraph">
<p>However, if you define a customized repository you might want to configure this behavior.
For example, you can define a Maven repository without <code>.pom</code> files but only jars.
To do so, you can configure <em>metadata sources</em> for any repository.</p>
</div>
<div id="ex-maven-repository-that-supports-artifacts-without-metadata" class="exampleblock">
<div class="title">Example 108. <a href="#ex-maven-repository-that-supports-artifacts-without-metadata">Maven repository that supports artifacts without metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        metadataSources {
            mavenPom()
            artifact()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        metadataSources {
            mavenPom()
            artifact()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can specify multiple sources to tell Gradle to keep looking if a file was not found.
In that case, the order of checking for sources is predefined.</p>
</div>
<div class="paragraph">
<p>The following metadata sources are supported:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 15. Supported metadata sources</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metadata source</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Order</th>
<th class="tableblock halign-left valign-top">Maven</th>
<th class="tableblock halign-left valign-top">Ivy / flat dir</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gradleMetadata()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Look for Gradle <code>.module</code> files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1st</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mavenPom()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Look for Maven <code>.pom</code> files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2nd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ivyDescriptor()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Look for <code>ivy.xml</code> files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2nd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>artifact()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Look directly for artifact</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
</tbody>
</table>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The defaults for Ivy and Maven repositories change with Gradle 6.0.
Before 6.0, <code>artifact()</code> was included in the defaults.
Leading to some inefficiency when modules are missing completely.</p>
</div>
<div class="paragraph">
<p>To restore this behavior, for example, for Maven central you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>mavenCentral { metadataSources { mavenPom(); artifact() } }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a similar way, you can opt into the new behavior in older Gradle versions using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>mavenCentral { metadataSources { mavenPom() } }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Since Gradle 5.3, when parsing a metadata file, be it Ivy or Maven, Gradle will look for a marker indicating that a matching Gradle Module Metadata files exists.
If it is found, it will be used instead of the Ivy or Maven file.</p>
</div>
<div class="paragraph">
<p>Starting with Gradle 5.6, you can disable this behavior by adding <code>ignoreGradleMetadataRedirection()</code> to the metadataSources declaration.</p>
</div>
<div id="ex-maven-repository-that-does-not-use-gradle-metadata-redirection" class="exampleblock">
<div class="title">Example 109. <a href="#ex-maven-repository-that-does-not-use-gradle-metadata-redirection">Maven repository that does not use gradle metadata redirection</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        metadataSources {
            mavenPom()
            artifact()
            ignoreGradleMetadataRedirection()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        metadataSources {
            mavenPom()
            artifact()
            ignoreGradleMetadataRedirection()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:plugin-vs-build-repos"><a class="anchor" href="#sec:plugin-vs-build-repos"></a><a class="link" href="#sec:plugin-vs-build-repos">Plugin repositories vs. build repositories</a></h4>
<div class="paragraph">
<p>Gradle will use repositories at two different phases during your build.</p>
</div>
<div class="paragraph">
<p>The first phase is when <a href="#sec:build_phases">configuring your build</a> and loading the plugins it applied.
To do that Gradle will use a special set of repositories.</p>
</div>
<div class="paragraph">
<p>The second phase is during dependency resolution.
At this point Gradle will use the repositories declared in your project, as shown in the previous sections.</p>
</div>
<div class="sect4">
<h5 id="sub:plugin-repos"><a class="anchor" href="#sub:plugin-repos"></a><a class="link" href="#sub:plugin-repos">Plugin repositories</a></h5>
<div class="paragraph">
<p>By default Gradle will use the <a href="http://plugins.gradle.org">Gradle plugin portal</a> to look for plugins.</p>
</div>
<div class="paragraph">
<p>However, for different reasons, there are plugins available in other, public or not, repositories.
When a build requires one of these plugins, additional repositories need to be specified so that Gradle knows where to search.</p>
</div>
<div class="paragraph">
<p>As the way to declare the repositories and what they are expected to contain depends on the way the plugin is applied, it is best to refer to <a href="#sec:custom_plugin_repositories">Custom Plugin Repositories</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sub:centralized-repository-declaration"><a class="anchor" href="#sub:centralized-repository-declaration"></a><a class="link" href="#sub:centralized-repository-declaration">Centralizing repositories declaration</a></h4>
<div class="paragraph">
<p>Instead of declaring repositories in every subproject of your build or via an <code>allprojects</code> block, Gradle offers a way to declare them in a central place for all projects.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Central declaration of repositories is an incubating feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Repositories used by convention in every subproject can be declared in the <code>settings.gradle(.kts)</code> file:</p>
</div>
<div id="ex-declaring-a-maven-repository-in-settings" class="exampleblock">
<div class="title">Example 110. <a href="#ex-declaring-a-maven-repository-in-settings">Declaring a Maven repository in settings</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    repositories {
        mavenCentral()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    repositories {
        mavenCentral()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>dependencyResolutionManagement</code> repositories block accepts the same notations as in a project. This includes Maven or Ivy repositories, with or without credentials, etc.</p>
</div>
<div class="paragraph">
<p>By default, repositories declared by a project in <code>build.gradle(.kts)</code> will <strong>override</strong> whatever is declared in <code>settings.gradle(.kts)</code>:</p>
</div>
<div id="ex-preferring-project-repositories" class="exampleblock">
<div class="title">Example 111. <a href="#ex-preferring-project-repositories">Preferring project repositories</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    repositoriesMode = RepositoriesMode.PREFER_PROJECT
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    repositoriesMode = RepositoriesMode.PREFER_PROJECT
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are three modes for dependency resolution management:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Mode</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default?</th>
<th class="tableblock halign-left valign-top">Use-Case</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PREFER_PROJECT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any repository declared on a project will cause the project to use the repositories declared by the project, ignoring those declared in settings.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Useful when teams need to use different repositories not common among subprojects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PREFER_SETTINGS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any repository declared directly in a project, either directly or via a plugin, will be ignored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Useful for enforcing large teams to use approved repositories only, but will not fail the build when a project or plugin declares a repository.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FAIL_ON_PROJECT_REPOS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any repository declared directly in a project, either directly or via a plugin, will trigger a build error.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Useful for enforcing large teams to use approved repositories only.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can change the behavior to prefer the repositories in the <code>settings.gradle(.kts)</code> file by using <code>repositoriesMode</code>:</p>
</div>
<div id="ex-preferring-settings-repositories" class="exampleblock">
<div class="title">Example 112. <a href="#ex-preferring-settings-repositories">Preferring settings repositories</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    repositoriesMode = RepositoriesMode.PREFER_SETTINGS
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    repositoriesMode = RepositoriesMode.PREFER_SETTINGS
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="sub:fail_build_on_project_repositories" class="paragraph">
<p>Gradle will warn you if a project or a plugin declares a repository in a project.</p>
</div>
<div class="paragraph">
<p>You can force Gradle to <em>fail the build</em> if you want to enforce that <strong>only</strong> settings repositories are used:</p>
</div>
<div id="ex-enforcing-settings-repositories" class="exampleblock">
<div class="title">Example 113. <a href="#ex-enforcing-settings-repositories">Enforcing settings repositories</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    repositoriesMode = RepositoriesMode.FAIL_ON_PROJECT_REPOS
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    repositoriesMode = RepositoriesMode.FAIL_ON_PROJECT_REPOS
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:supported_transport_protocols"><a class="anchor" href="#sec:supported_transport_protocols"></a><a class="link" href="#sec:supported_transport_protocols">Supported repository transport protocols</a></h4>
<div class="paragraph">
<p>Maven and Ivy repositories support the use of various transport protocols. At the moment the following protocols are supported:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 16. Repository transport protocols</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Credential types</th>
<th class="tableblock halign-left valign-top">Link</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username/password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:authentication_schemes">Documentation</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>https</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username/password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:authentication_schemes">Documentation</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sftp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username/password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:authentication_schemes">Documentation</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>s3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access key/secret key/session token or Environment variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:s3-repositories">Documentation</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gcs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developers.google.com/identity/protocols/application-default-credentials">default application credentials</a> sourced from well known files, Environment variables etc.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:gcs-repositories">Documentation</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Username and password should never be checked in plain text into version control as part of your build file.
You can store the credentials in a local <code>gradle.properties</code> file and use one of the open source Gradle plugins for encrypting and consuming credentials e.g. the <a href="https://plugins.gradle.org/plugin/nu.studer.credentials">credentials plugin</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The transport protocol is part of the URL definition for a repository.
The following build script demonstrates how to create HTTP-based Maven and Ivy repositories:</p>
</div>
<div id="ex-declaring-a-maven-and-ivy-repository" class="exampleblock">
<div class="title">Example 114. <a href="#ex-declaring-a-maven-and-ivy-repository">Declaring a Maven and Ivy repository</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;http://repo.mycompany.com/maven2&quot;)
    }

    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
    }

    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to declare SFTP repositories:</p>
</div>
<div id="ex-using-the-sftp-protocol-for-a-repository" class="exampleblock">
<div class="title">Example 115. <a href="#ex-using-the-sftp-protocol-for-a-repository">Using the SFTP protocol for a repository</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;sftp://repo.mycompany.com:22/maven2&quot;)
        credentials {
            username = &quot;user&quot;
            password = &quot;password&quot;
        }
    }

    ivy {
        url = uri(&quot;sftp://repo.mycompany.com:22/repo&quot;)
        credentials {
            username = &quot;user&quot;
            password = &quot;password&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">sftp://repo.mycompany.com:22/maven2</span><span class="delimiter">&quot;</span></span>
        credentials {
            username <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
            password <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
        }
    }

    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">sftp://repo.mycompany.com:22/repo</span><span class="delimiter">&quot;</span></span>
        credentials {
            username <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
            password <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For details on HTTP related authentication, see the section <a href="#sec:authentication_schemes">HTTP(S) authentication schemes configuration</a>.</p>
</div>
<div class="paragraph">
<p>When using an AWS S3 backed repository you need to authenticate using <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.credentials.AwsCredentials.html">AwsCredentials</a>, providing access-key and a private-key. The following example shows how to declare a S3 backed repository and providing AWS credentials:</p>
</div>
<div id="ex-declaring-an-s3-backed-maven-and-ivy-repository" class="exampleblock">
<div class="title">Example 116. <a href="#ex-declaring-an-s3-backed-maven-and-ivy-repository">Declaring an S3 backed Maven and Ivy repository</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;s3://myCompanyBucket/maven2&quot;)
        credentials(AwsCredentials::class) {
            accessKey = &quot;someKey&quot;
            secretKey = &quot;someSecret&quot;
            // optional
            sessionToken = &quot;someSTSToken&quot;
        }
    }

    ivy {
        url = uri(&quot;s3://myCompanyBucket/ivyrepo&quot;)
        credentials(AwsCredentials::class) {
            accessKey = &quot;someKey&quot;
            secretKey = &quot;someSecret&quot;
            // optional
            sessionToken = &quot;someSTSToken&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">s3://myCompanyBucket/maven2</span><span class="delimiter">&quot;</span></span>
        credentials(AwsCredentials) {
            accessKey <span class="string"><span class="delimiter">&quot;</span><span class="content">someKey</span><span class="delimiter">&quot;</span></span>
            secretKey <span class="string"><span class="delimiter">&quot;</span><span class="content">someSecret</span><span class="delimiter">&quot;</span></span>
            <span class="comment">// optional</span>
            sessionToken <span class="string"><span class="delimiter">&quot;</span><span class="content">someSTSToken</span><span class="delimiter">&quot;</span></span>
        }
    }

    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">s3://myCompanyBucket/ivyrepo</span><span class="delimiter">&quot;</span></span>
        credentials(AwsCredentials) {
            accessKey <span class="string"><span class="delimiter">&quot;</span><span class="content">someKey</span><span class="delimiter">&quot;</span></span>
            secretKey <span class="string"><span class="delimiter">&quot;</span><span class="content">someSecret</span><span class="delimiter">&quot;</span></span>
            <span class="comment">// optional</span>
            sessionToken <span class="string"><span class="delimiter">&quot;</span><span class="content">someSTSToken</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also delegate all credentials to the AWS sdk by using the AwsImAuthentication. The following example shows how:</p>
</div>
<div id="ex-declaring-an-s3-backed-maven-and-ivy-repository-using-iam" class="exampleblock">
<div class="title">Example 117. <a href="#ex-declaring-an-s3-backed-maven-and-ivy-repository-using-iam">Declaring an S3 backed Maven and Ivy repository using IAM</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;s3://myCompanyBucket/maven2&quot;)
        authentication {
            create&lt;AwsImAuthentication&gt;(&quot;awsIm&quot;) // load from EC2 role or env var
        }
    }

    ivy {
        url = uri(&quot;s3://myCompanyBucket/ivyrepo&quot;)
        authentication {
            create&lt;AwsImAuthentication&gt;(&quot;awsIm&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">s3://myCompanyBucket/maven2</span><span class="delimiter">&quot;</span></span>
        authentication {
           awsIm(AwsImAuthentication) <span class="comment">// load from EC2 role or env var</span>
        }
    }

    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">s3://myCompanyBucket/ivyrepo</span><span class="delimiter">&quot;</span></span>
        authentication {
           awsIm(AwsImAuthentication)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For details on AWS S3 related authentication, see the section <a href="#sec:s3-repositories">AWS S3 repositories configuration</a>.</p>
</div>
<div class="paragraph">
<p>When using a Google Cloud Storage backed repository default application credentials will be used with no further configuration required:</p>
</div>
<div id="ex-declaring-a-google-cloud-storage-backed-maven-and-ivy-repository-using-default-application-credentials" class="exampleblock">
<div class="title">Example 118. <a href="#ex-declaring-a-google-cloud-storage-backed-maven-and-ivy-repository-using-default-application-credentials">Declaring a Google Cloud Storage backed Maven and Ivy repository using default application credentials</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;gcs://myCompanyBucket/maven2&quot;)
    }

    ivy {
        url = uri(&quot;gcs://myCompanyBucket/ivyrepo&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">gcs://myCompanyBucket/maven2</span><span class="delimiter">&quot;</span></span>
    }

    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">gcs://myCompanyBucket/ivyrepo</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For details on Google GCS related authentication, see the section <a href="#sec:gcs-repositories">Google Cloud Storage repositories configuration</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:authentication_schemes"><a class="anchor" href="#sec:authentication_schemes"></a><a class="link" href="#sec:authentication_schemes">HTTP(S) authentication schemes configuration</a></h4>
<div class="paragraph">
<p>When configuring a repository using HTTP or HTTPS transport protocols, multiple authentication schemes are available. By default, Gradle will attempt to use all schemes that are supported by the Apache HttpClient library, <a href="http://hc.apache.org/httpcomponents-client-ga/">documented here</a>. In some cases, it may be preferable to explicitly specify which authentication schemes should be used when exchanging credentials with a remote server. When explicitly declared, only those schemes are used when authenticating to a remote repository.</p>
</div>
<div class="paragraph">
<p>You can specify credentials for Maven repositories secured by basic authentication using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/credentials/PasswordCredentials.html">PasswordCredentials</a>.</p>
</div>
<div id="ex-accessing-password-protected-maven-repository" class="exampleblock">
<div class="title">Example 119. <a href="#ex-accessing-password-protected-maven-repository">Accessing password-protected Maven repository</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;http://repo.mycompany.com/maven2&quot;)
        credentials {
            username = &quot;user&quot;
            password = &quot;password&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
        credentials {
            username <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
            password <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example show how to configure a repository to use only <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/authentication/http/DigestAuthentication.html">DigestAuthentication</a>:</p>
</div>
<div id="ex-configure-repository-to-use-only-digest-authentication" class="exampleblock">
<div class="title">Example 120. <a href="#ex-configure-repository-to-use-only-digest-authentication">Configure repository to use only digest authentication</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;https://repo.mycompany.com/maven2&quot;)
        credentials {
            username = &quot;user&quot;
            password = &quot;password&quot;
        }
        authentication {
            create&lt;DigestAuthentication&gt;(&quot;digest&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">'</span><span class="content">https://repo.mycompany.com/maven2</span><span class="delimiter">'</span></span>
        credentials {
            username <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
            password <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
        }
        authentication {
            digest(DigestAuthentication)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Currently supported authentication schemes are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/authentication/http/BasicAuthentication.html">BasicAuthentication</a></dt>
<dd>
<p>Basic access authentication over HTTP. When using this scheme, credentials are sent preemptively.</p>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/authentication/http/DigestAuthentication.html">DigestAuthentication</a></dt>
<dd>
<p>Digest access authentication over HTTP.</p>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/authentication/http/HttpHeaderAuthentication.html">HttpHeaderAuthentication</a></dt>
<dd>
<p>Authentication based on any custom HTTP header, e.g. private tokens, OAuth tokens, etc.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="sub:preemptive_authentication"><a class="anchor" href="#sub:preemptive_authentication"></a><a class="link" href="#sub:preemptive_authentication">Using preemptive authentication</a></h5>
<div class="paragraph">
<p>Gradle&#8217;s default behavior is to only submit credentials when a server responds with an authentication challenge in the form of an HTTP 401 response.
In some cases, the server will respond with a different code (ex. for repositories hosted on GitHub a 404 is returned) causing dependency resolution to fail.
To get around this behavior, credentials may be sent to the server preemptively.
To enable preemptive authentication simply configure your repository to explicitly use the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/authentication/http/BasicAuthentication.html">BasicAuthentication</a> scheme:</p>
</div>
<div id="ex-configure-repository-to-use-preemptive-authentication" class="exampleblock">
<div class="title">Example 121. <a href="#ex-configure-repository-to-use-preemptive-authentication">Configure repository to use preemptive authentication</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;https://repo.mycompany.com/maven2&quot;)
        credentials {
            username = &quot;user&quot;
            password = &quot;password&quot;
        }
        authentication {
            create&lt;BasicAuthentication&gt;(&quot;basic&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">'</span><span class="content">https://repo.mycompany.com/maven2</span><span class="delimiter">'</span></span>
        credentials {
            username <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
            password <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
        }
        authentication {
            basic(BasicAuthentication)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:http-header-auth"><a class="anchor" href="#sub:http-header-auth"></a><a class="link" href="#sub:http-header-auth">Using HTTP header authentication</a></h5>
<div class="paragraph">
<p>You can specify any HTTP header for secured Maven repositories requiring token, OAuth2 or other HTTP header based authentication using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/credentials/HttpHeaderCredentials.html">HttpHeaderCredentials</a> with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/authentication/http/HttpHeaderAuthentication.html">HttpHeaderAuthentication</a>.</p>
</div>
<div id="ex-accessing-header-protected-maven-repository" class="exampleblock">
<div class="title">Example 122. <a href="#ex-accessing-header-protected-maven-repository">Accessing header-protected Maven repository</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;http://repo.mycompany.com/maven2&quot;)
        credentials(HttpHeaderCredentials::class) {
            name = &quot;Private-Token&quot;
            value = &quot;TOKEN&quot;
        }
        authentication {
            create&lt;HttpHeaderAuthentication&gt;(&quot;header&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
        credentials(HttpHeaderCredentials) {
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Private-Token</span><span class="delimiter">&quot;</span></span>
            value = <span class="string"><span class="delimiter">&quot;</span><span class="content">TOKEN</span><span class="delimiter">&quot;</span></span>
        }
        authentication {
            header(HttpHeaderAuthentication)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:s3-repositories"><a class="anchor" href="#sec:s3-repositories"></a><a class="link" href="#sec:s3-repositories">AWS S3 repositories configuration</a></h4>
<div class="sect4">
<h5 id="sub:s3_configuration_properties"><a class="anchor" href="#sub:s3_configuration_properties"></a><a class="link" href="#sub:s3_configuration_properties">S3 configuration properties</a></h5>
<div class="paragraph">
<p>The following system properties can be used to configure the interactions with s3 repositories:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.gradle.s3.endpoint</code></dt>
<dd>
<p>Used to override the AWS S3 endpoint when using a non AWS, S3 API compatible, storage service.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.s3.maxErrorRetry</code></dt>
<dd>
<p>Specifies the maximum number of times to retry a request in the event that the S3 server responds with a HTTP 5xx status code. When not specified a default value of 3 is used.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sub:s3_url_formats"><a class="anchor" href="#sub:s3_url_formats"></a><a class="link" href="#sub:s3_url_formats">S3 URL formats</a></h5>
<div class="paragraph">
<p>S3 URL&#8217;s are 'virtual-hosted-style' and must be in the following format</p>
</div>
<div class="listingblock">
<div class="content">
<pre>s3://&lt;bucketName&gt;[.&lt;regionSpecificEndpoint&gt;]/&lt;s3Key&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>e.g. <code>s3://myBucket.s3.eu-central-1.amazonaws.com/maven/release</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>myBucket</code> is the AWS S3 bucket name.</p>
</li>
<li>
<p><code>s3.eu-central-1.amazonaws.com</code> is the <em>optional</em> <a href="http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region">region specific endpoint</a>.</p>
</li>
<li>
<p><code>/maven/release</code> is the AWS S3 key (unique identifier for an object within a bucket)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sub:s3_proxy_settings"><a class="anchor" href="#sub:s3_proxy_settings"></a><a class="link" href="#sub:s3_proxy_settings">S3 proxy settings</a></h5>
<div class="paragraph">
<p>A proxy for S3 can be configured using the following system properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>https.proxyHost</code></p>
</li>
<li>
<p><code>https.proxyPort</code></p>
</li>
<li>
<p><code>https.proxyUser</code></p>
</li>
<li>
<p><code>https.proxyPassword</code></p>
</li>
<li>
<p><code>http.nonProxyHosts</code> (NOTE: this is not a typo.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the <code>org.gradle.s3.endpoint</code> property has been specified with a HTTP (not HTTPS) URI the following system proxy settings can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>http.proxyHost</code></p>
</li>
<li>
<p><code>http.proxyPort</code></p>
</li>
<li>
<p><code>http.proxyUser</code></p>
</li>
<li>
<p><code>http.proxyPassword</code></p>
</li>
<li>
<p><code>http.nonProxyHosts</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sub:s3_v4_signatures"><a class="anchor" href="#sub:s3_v4_signatures"></a><a class="link" href="#sub:s3_v4_signatures">AWS S3 V4 Signatures (AWS4-HMAC-SHA256)</a></h5>
<div class="paragraph">
<p>Some of the AWS S3 regions (eu-central-1 - Frankfurt) require that all HTTP requests are signed in accordance with AWS&#8217;s <a href="http://docs.aws.amazon.com/general/latest/gr/signature-version-4.html">signature version 4</a>. It is recommended to specify S3 URL&#8217;s containing the region specific endpoint when using buckets that require V4 signatures. e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>s3://somebucket.s3.eu-central-1.amazonaws.com/maven/release</pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>When a region-specific endpoint is not specified for buckets requiring V4 Signatures, Gradle will use the default AWS region (us-east-1) and the
following warning will appear on the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Attempting to re-send the request to .... with AWS V4 authentication. To avoid this warning in the future, use region-specific endpoint to access buckets located in regions that require V4 signing.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Failing to specify the region-specific endpoint for buckets requiring V4 signatures means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>3 round-trips to AWS, as opposed to one, for every file upload and download.</p>
</li>
<li>
<p>Depending on location - increased network latencies and slower builds.</p>
</li>
<li>
<p>Increased likelihood of transmission failures.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sub:s3_cross_account"><a class="anchor" href="#sub:s3_cross_account"></a><a class="link" href="#sub:s3_cross_account">AWS S3 Cross Account Access</a></h6>
<div class="paragraph">
<p>Some organizations may have multiple AWS accounts, e.g. one for each team. The AWS account of the bucket owner is often different from the artifact publisher and consumers. The bucket owner needs to be able to grant the consumers access otherwise the artifacts will only be usable by the publisher&#8217;s account. This is done by adding the <code>bucket-owner-full-control</code> <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl">Canned ACL</a> to the uploaded objects. Gradle will do this in every upload. Make sure the publisher has the required IAM permission, <code>PutObjectAcl</code> (and <code>PutObjectVersionAcl</code> if bucket versioning is enabled), either directly or via an assumed IAM Role (depending on your case). You can read more at <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html">AWS S3 Access Permissions</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:gcs-repositories"><a class="anchor" href="#sec:gcs-repositories"></a><a class="link" href="#sec:gcs-repositories">Google Cloud Storage repositories configuration</a></h4>
<div class="sect4">
<h5 id="sub:gcs_configuration_properties"><a class="anchor" href="#sub:gcs_configuration_properties"></a><a class="link" href="#sub:gcs_configuration_properties">GCS configuration properties</a></h5>
<div class="paragraph">
<p>The following system properties can be used to configure the interactions with <a href="https://cloud.google.com/storage/">Google Cloud Storage</a> repositories:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.gradle.gcs.endpoint</code></dt>
<dd>
<p>Used to override the Google Cloud Storage endpoint when using a non-Google Cloud Platform, Google Cloud Storage API compatible, storage service.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.gcs.servicePath</code></dt>
<dd>
<p>Used to override the Google Cloud Storage root service path which the Google Cloud Storage client builds requests from, defaults to <code>/</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sub:gcs_url_formats"><a class="anchor" href="#sub:gcs_url_formats"></a><a class="link" href="#sub:gcs_url_formats">GCS URL formats</a></h5>
<div class="paragraph">
<p>Google Cloud Storage URL&#8217;s are 'virtual-hosted-style' and must be in the following format <code>gcs://&lt;bucketName&gt;/&lt;objectKey&gt;</code></p>
</div>
<div class="paragraph">
<p>e.g. <code>gcs://myBucket/maven/release</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>myBucket</code> is the Google Cloud Storage bucket name.</p>
</li>
<li>
<p><code>/maven/release</code> is the Google Cloud Storage key (unique identifier for an object within a bucket)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:handling_credentials"><a class="anchor" href="#sec:handling_credentials"></a><a class="link" href="#sec:handling_credentials">Handling credentials</a></h4>
<div class="paragraph">
<p>Repository credentials should never be part of your build script but rather be kept external.
Gradle provides <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/repositories/AuthenticationSupported.html#credentials-java.lang.Class-">an API in artifact repositories</a>
that allows you to declare only the type of required credentials. Credential values are looked up from the <a href="#sec:gradle_configuration_properties">Gradle Properties</a>
during the build that requires them.</p>
</div>
<div class="paragraph">
<p>For example, given repository configuration:</p>
</div>
<div id="ex-externalized-repository-credentials" class="exampleblock">
<div class="title">Example 123. <a href="#ex-externalized-repository-credentials">Externalized repository credentials</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        name = &quot;mySecureRepository&quot;
        credentials(PasswordCredentials::class)
        // url = uri(&lt;&lt;some repository url&gt;&gt;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        name = <span class="string"><span class="delimiter">'</span><span class="content">mySecureRepository</span><span class="delimiter">'</span></span>
        credentials(PasswordCredentials)
        <span class="comment">// url = uri(&lt;&lt;some repository url&gt;&gt;)</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The username and password will be looked up from <code>mySecureRepositoryUsername</code> and <code>mySecureRepositoryPassword</code> properties.</p>
</div>
<div class="paragraph">
<p>Note that the configuration property prefix - the identity - is determined from the repository name.
Credentials can then be provided in any of supported ways for Gradle Properties -
<code>gradle.properties</code> file, command line arguments, environment variables or a combination of those options.</p>
</div>
<div class="paragraph">
<p>Also, note that credentials will only be required if the invoked build requires them. If for example a project is configured
to publish artifacts to a secured repository, but the build does not invoke publishing task, Gradle will not require
publishing credentials to be present. On the other hand, if the build needs to execute a task that requires credentials
at some point, Gradle will check for credential presence first thing and will not start running any of the tasks
if it knows that the build will fail at a later point because of missing credentials.</p>
</div>
<div class="paragraph">
<p>Here is a <a href="../samples/sample_publishing_credentials.html">downloadable sample</a> that demonstrates the concept in more detail.</p>
</div>
<div class="paragraph">
<p>Lookup is only supported for credentials listed in the <a href="#credentials_lookup_properties">Table 17</a>.</p>
</div>
<table id="credentials_lookup_properties" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 17. Credentials that support value lookup and their corresponding properties</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Argument</th>
<th class="tableblock halign-left valign-top">Base property name</th>
<th class="tableblock halign-left valign-top">Required?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/credentials/PasswordCredentials.html">PasswordCredentials</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><code><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/credentials/AwsCredentials.html">AwsCredentials</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>accessKey</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccessKey</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secretKey</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SecretKey</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sessionToken</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SessionToken</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/credentials/HttpHeaderCredentials.html">HttpHeaderCredentials</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthHeaderName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthHeaderValue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="declaring-dependencies"><a class="anchor" href="#declaring-dependencies"></a><a class="link" href="#declaring-dependencies">Declaring dependencies</a></h3>
<div class="paragraph">
<p>Before looking at dependency declarations themselves, the concept of <em>dependency configuration</em> needs to be defined.</p>
</div>
<div class="sect3">
<h4 id="sec:what-are-dependency-configurations"><a class="anchor" href="#sec:what-are-dependency-configurations"></a><a class="link" href="#sec:what-are-dependency-configurations">What are dependency configurations</a></h4>
<div class="paragraph">
<p>Every dependency declared for a Gradle project applies to a specific scope.
For example some dependencies should be used for compiling source code whereas others only need to be available at runtime.
Gradle represents the scope of a dependency with the help of a <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.Configuration.html">Configuration</a>.
Every configuration can be identified by a unique name.</p>
</div>
<div class="paragraph">
<p>Many Gradle plugins add pre-defined configurations to your project.
The Java plugin, for example, adds configurations to represent the various classpaths it needs for source code compilation, executing tests and the like.
See <a href="java_plugin.html#sec:java_plugin_and_dependency_management">the Java plugin chapter</a> for an example.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-configurations.png" alt="dependency management configurations">
</div>
<div class="title">Figure 8. Configurations use declared dependencies for specific purposes</div>
</div>
<div class="paragraph">
<p>For more examples on the usage of configurations to navigate, inspect and post-process metadata and artifacts of assigned dependencies, have a look at the <a href="#sec:programmatic_api">resolution result APIs</a>.</p>
</div>
<div class="sect4">
<h5 id="sub:config-inheritance-composition"><a class="anchor" href="#sub:config-inheritance-composition"></a><a class="link" href="#sub:config-inheritance-composition">Configuration inheritance and composition</a></h5>
<div class="paragraph">
<p>A configuration can extend other configurations to form an inheritance hierarchy.
Child configurations inherit the whole set of dependencies declared for any of its superconfigurations.</p>
</div>
<div class="paragraph">
<p>Configuration inheritance is heavily used by Gradle core plugins like the <a href="java_plugin.html#sec:java_plugin_and_dependency_management">Java plugin</a>.
For example the <code>testImplementation</code> configuration extends the <code>implementation</code> configuration.
 The configuration hierarchy has a practical purpose: compiling tests requires the dependencies of the source code under test on top of the dependencies needed write the test class.
 A Java project that uses JUnit to write and execute test code also needs Guava if its classes are imported in the production source code.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-configuration-inheritance.png" alt="dependency management configuration inheritance">
</div>
<div class="title">Figure 9. Configuration inheritance provided by the Java plugin</div>
</div>
<div class="paragraph">
<p>Under the covers the <code>testImplementation</code> and <code>implementation</code> configurations form an inheritance hierarchy by calling the method <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.Configuration.html#org.gradle.api.artifacts.Configuration:extendsFrom(org.gradle.api.artifacts.Configuration[])">Configuration.extendsFrom(org.gradle.api.artifacts.Configuration[])</a>.
A configuration can extend any other configuration irrespective of its definition in the build script or a plugin.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you wanted to write a suite of smoke tests.
Each smoke test makes a HTTP call to verify a web service endpoint.
As the underlying test framework the project already uses JUnit.
You can define a new configuration named <code>smokeTest</code> that extends from the <code>testImplementation</code> configuration to reuse the existing test framework dependency.</p>
</div>
<div id="ex-extending-a-configuration-from-another-configuration" class="exampleblock">
<div class="title">Example 124. <a href="#ex-extending-a-configuration-from-another-configuration">Extending a configuration from another configuration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val smokeTest by configurations.creating {
    extendsFrom(configurations.testImplementation.get())
}

dependencies {
    testImplementation(&quot;junit:junit:4.13&quot;)
    smokeTest(&quot;org.apache.httpcomponents:httpclient:4.5.5&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    smokeTest.extendsFrom testImplementation
}

dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.13</span><span class="delimiter">'</span></span>
    smokeTest <span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient:4.5.5</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:resolvable-consumable-configs"><a class="anchor" href="#sec:resolvable-consumable-configs"></a><a class="link" href="#sec:resolvable-consumable-configs">Resolvable and consumable configurations</a></h4>
<div class="paragraph">
<p>Configurations are a fundamental part of dependency resolution in Gradle.
In the context of dependency resolution, it is useful to distinguish between a <em>consumer</em> and a <em>producer</em>. Along these lines, configurations have at least 3 different roles:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>to declare dependencies</p>
</li>
<li>
<p>as a <em>consumer</em>, to resolve a set of dependencies to files</p>
</li>
<li>
<p>as a <em>producer</em>, to expose artifacts and their dependencies for consumption by other projects
(such <em>consumable</em> configurations usually represent the <a href="#understanding-variant-selection">variants</a> the producer offers to its consumers)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, to express that an application <code>app</code> <em>depends on</em> library <code>lib</code>, <em>at least</em> one configuration is required:</p>
</div>
<div id="ex-configurations-are-used-to-declare-dependencies" class="exampleblock">
<div class="title">Example 125. <a href="#ex-configurations-are-used-to-declare-dependencies">Configurations are used to declare dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// declare a &quot;configuration&quot; named &quot;someConfiguration&quot;
val someConfiguration by configurations.creating

dependencies {
    // add a project dependency to the &quot;someConfiguration&quot; configuration
    someConfiguration(project(&quot;:lib&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    <span class="comment">// declare a &quot;configuration&quot; named &quot;someConfiguration&quot;</span>
    someConfiguration
}
dependencies {
    <span class="comment">// add a project dependency to the &quot;someConfiguration&quot; configuration</span>
    someConfiguration project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:lib</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Configurations can inherit dependencies from other configurations by extending from them.
Now, notice that the code above doesn&#8217;t tell us anything about the intended <em>consumer</em> of this configuration.
In particular, it doesn&#8217;t tell us how the configuration is meant to be <em>used</em>.
Let&#8217;s say that <code>lib</code> is a Java library: it might expose different things, such as its API, implementation, or test fixtures.
It might be necessary to change how we resolve the dependencies of <code>app</code> depending upon the task we&#8217;re performing (compiling against the API of <code>lib</code>, executing the application, compiling tests, etc.).
To address this problem, you&#8217;ll often find companion configurations, which are meant to unambiguously declare the usage:</p>
</div>
<div id="ex-configurations-representing-concrete-dependency-graphs" class="exampleblock">
<div class="title">Example 126. <a href="#ex-configurations-representing-concrete-dependency-graphs">Configurations representing concrete dependency graphs</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    // declare a configuration that is going to resolve the compile classpath of the application
    compileClasspath {
        extendsFrom(someConfiguration)
    }

    // declare a configuration that is going to resolve the runtime classpath of the application
    runtimeClasspath {
        extendsFrom(someConfiguration)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    <span class="comment">// declare a configuration that is going to resolve the compile classpath of the application</span>
    compileClasspath.extendsFrom(someConfiguration)

    <span class="comment">// declare a configuration that is going to resolve the runtime classpath of the application</span>
    runtimeClasspath.extendsFrom(someConfiguration)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At this point, we have 3 different configurations with different roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>someConfiguration</code> declares the dependencies of my application. It is simply a collection of dependencies.</p>
</li>
<li>
<p><code>compileClasspath</code> and <code>runtimeClasspath</code> are configurations <em>meant to be resolved</em>: when resolved they should contain the compile classpath, and the runtime classpath of the application respectively.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This distinction is represented by the <code>canBeResolved</code> flag in the <code>Configuration</code> type.
A configuration that <em>can be resolved</em> is a configuration for which we can compute a dependency graph, because it contains all the necessary information for resolution to happen.
That is to say we&#8217;re going to compute a dependency graph, resolve the components in the graph, and eventually get artifacts.
A configuration which has <code>canBeResolved</code> set to <code>false</code> is not meant to be resolved.
Such a configuration is there <em>only to declare dependencies</em>.
The reason is that depending on the usage (compile classpath, runtime classpath), it <em>can</em> resolve to different graphs.
It is an error to try to resolve a configuration which has <code>canBeResolved</code> set to <code>false</code>.
To some extent, this is similar to an <em>abstract class</em> (<code>canBeResolved</code>=false) which is not supposed to be instantiated, and a concrete class extending the abstract class (<code>canBeResolved</code>=true).
A resolvable configuration will extend at least one non-resolvable configuration (and may extend more than one).</p>
</div>
<div class="paragraph">
<p>On the other end, at the library project side (the <em>producer</em>), we also use configurations to represent what can be consumed.
For example, the library may expose an API or a runtime, and we would attach artifacts to either one, the other, or both.
Typically, to compile against <code>lib</code>, we need the API of <code>lib</code>, but we don&#8217;t need its runtime dependencies.
So the <code>lib</code> project will expose an <code>apiElements</code> configuration, which is aimed at consumers looking for its API.
Such a configuration is consumable, but is not meant to be resolved.
This is expressed via the <em>canBeConsumed</em> flag of a <code>Configuration</code>:</p>
</div>
<div id="ex-setting-up-configurations" class="exampleblock">
<div class="title">Example 127. <a href="#ex-setting-up-configurations">Setting up configurations</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    // A configuration meant for consumers that need the API of this component
    create(&quot;exposedApi&quot;) {
        // This configuration is an &quot;outgoing&quot; configuration, it's not meant to be resolved
        isCanBeResolved = false
        // As an outgoing configuration, explain that consumers may want to consume it
        assert(isCanBeConsumed)
    }
    // A configuration meant for consumers that need the implementation of this component
    create(&quot;exposedRuntime&quot;) {
        isCanBeResolved = false
        assert(isCanBeConsumed)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    <span class="comment">// A configuration meant for consumers that need the API of this component</span>
    exposedApi {
        <span class="comment">// This configuration is an &quot;outgoing&quot; configuration, it's not meant to be resolved</span>
        canBeResolved = <span class="predefined-constant">false</span>
        <span class="comment">// As an outgoing configuration, explain that consumers may want to consume it</span>
        <span class="keyword">assert</span> canBeConsumed
    }
    <span class="comment">// A configuration meant for consumers that need the implementation of this component</span>
    exposedRuntime {
        canBeResolved = <span class="predefined-constant">false</span>
        <span class="keyword">assert</span> canBeConsumed
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In short, a configuration&#8217;s role is determined by the <code>canBeResolved</code> and <code>canBeConsumed</code> flag combinations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Configuration roles</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">can be resolved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">can be consumed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dependency Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolve for certain usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exposed to consumers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy, don&#8217;t use</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For backwards compatibility, both flags have a default value of <code>true</code>, but as a plugin author, you should always determine the right values for those flags, or you might accidentally introduce resolution errors.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:choosing-configuration"><a class="anchor" href="#sec:choosing-configuration"></a><a class="link" href="#sec:choosing-configuration">Choosing the right configuration for dependencies</a></h4>
<div class="paragraph">
<p>The choice of the configuration where you declare a dependency is important.
However there is no fixed rule into which configuration a dependency must go.
It mostly depends on the way the configurations are organised, which is most often a property of the applied plugin(s).</p>
</div>
<div class="paragraph">
<p>For example, in the <code>java</code> plugin, the created configuration are <a href="java_plugin.html#tab:configurations">documented</a> and should serve as the basis for determining where to declare a dependency, based on its role for your code.</p>
</div>
<div class="paragraph">
<p>As a recommendation, plugins should clearly document the way their configurations are linked together and should strive as much as possible to isolate their <a href="#sec:resolvable-consumable-configs">roles</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:deprecated-configurations"><a class="anchor" href="#sec:deprecated-configurations"></a><a class="link" href="#sec:deprecated-configurations">Deprecated configurations</a></h4>
<div class="paragraph">
<p>Configurations are intended to be used for a single role: declaring dependencies, performing resolution, or defining consumable variants.
In the past, some configurations did not define which role they were intended to be used for.
A deprecation warning is emitted when a configuration is used in a way that was not intended.
To fix the deprecation, you will need to stop using the configuration in the deprecated role.
The exact changes required depend on how the configuration is used and if there are alternative configurations that should be used instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:defining-custom-configurations"><a class="anchor" href="#sec:defining-custom-configurations"></a><a class="link" href="#sec:defining-custom-configurations">Defining custom configurations</a></h4>
<div class="paragraph">
<p>You can define configurations yourself, so-called <em>custom configurations</em>.
A custom configuration is useful for separating the scope of dependencies needed for a dedicated purpose.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you wanted to declare a dependency on the <a href="https://tomcat.apache.org/tomcat-9.0-doc/jasper-howto.html">Jasper Ant task</a> for the purpose of pre-compiling JSP files that should <em>not</em> end up in the classpath for compiling your source code.
It&#8217;s fairly simple to achieve that goal by introducing a custom configuration and using it in a task.</p>
</div>
<div id="ex-declaring-and-using-a-custom-configuration" class="exampleblock">
<div class="title">Example 128. <a href="#ex-declaring-and-using-a-custom-configuration">Declaring and using a custom configuration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val jasper by configurations.creating

repositories {
    mavenCentral()
}

dependencies {
    jasper(&quot;org.apache.tomcat.embed:tomcat-embed-jasper:9.0.2&quot;)
}

tasks.register(&quot;preCompileJsps&quot;) {
    val jasperClasspath = jasper.asPath
    val projectLayout = layout
    doLast {
        ant.withGroovyBuilder {
            &quot;taskdef&quot;(&quot;classname&quot; to &quot;org.apache.jasper.JspC&quot;,
                      &quot;name&quot; to &quot;jasper&quot;,
                      &quot;classpath&quot; to jasperClasspath)
            &quot;jasper&quot;(&quot;validateXml&quot; to false,
                     &quot;uriroot&quot; to projectLayout.projectDirectory.file(&quot;src/main/webapp&quot;).asFile,
                     &quot;outputDir&quot; to projectLayout.buildDirectory.file(&quot;compiled-jsps&quot;).get().asFile)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    jasper
}

repositories {
    mavenCentral()
}

dependencies {
    jasper <span class="string"><span class="delimiter">'</span><span class="content">org.apache.tomcat.embed:tomcat-embed-jasper:9.0.2</span><span class="delimiter">'</span></span>
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">preCompileJsps</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> jasperClasspath = configurations.jasper.asPath
    <span class="keyword">def</span> projectLayout = layout
    doLast {
        ant.taskdef(<span class="key">classname</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.apache.jasper.JspC</span><span class="delimiter">'</span></span>,
                    <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">jasper</span><span class="delimiter">'</span></span>,
                    <span class="key">classpath</span>: jasperClasspath)
        ant.jasper(<span class="key">validateXml</span>: <span class="predefined-constant">false</span>,
                   <span class="key">uriroot</span>: projectLayout.projectDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>).asFile,
                   <span class="key">outputDir</span>: projectLayout.buildDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">compiled-jsps</span><span class="delimiter">&quot;</span></span>).get().asFile)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can manage project configurations with a <code>configurations</code> object.
Configurations have a name and can extend each other.
To learn more about this API have a look at <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.ConfigurationContainer.html">ConfigurationContainer</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:dependency-types"><a class="anchor" href="#sec:dependency-types"></a><a class="link" href="#sec:dependency-types">Different kinds of dependencies</a></h4>
<div class="sect4">
<h5 id="sub:module_dependencies"><a class="anchor" href="#sub:module_dependencies"></a><a class="link" href="#sub:module_dependencies">Module dependencies</a></h5>
<div class="paragraph">
<p>Module dependencies are the most common dependencies. They refer to a module in a repository.</p>
</div>
<div id="ex-module-dependencies" class="exampleblock">
<div class="title">Example 129. <a href="#ex-module-dependencies">Module dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    runtimeOnly(group = &quot;org.springframework&quot;, name = &quot;spring-core&quot;, version = &quot;2.5&quot;)
    runtimeOnly(&quot;org.springframework:spring-aop:2.5&quot;)
    runtimeOnly(&quot;org.hibernate:hibernate:3.0.5&quot;) {
        isTransitive = true
    }
    runtimeOnly(group = &quot;org.hibernate&quot;, name = &quot;hibernate&quot;, version = &quot;3.0.5&quot;) {
        isTransitive = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    runtimeOnly <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.springframework</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">spring-core</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">2.5</span><span class="delimiter">'</span></span>
    runtimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-core:2.5</span><span class="delimiter">'</span></span>,
            <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-aop:2.5</span><span class="delimiter">'</span></span>
    runtimeOnly(
        [<span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.springframework</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">spring-core</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">2.5</span><span class="delimiter">'</span></span>],
        [<span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.springframework</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">spring-aop</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">2.5</span><span class="delimiter">'</span></span>]
    )
    runtimeOnly(<span class="string"><span class="delimiter">'</span><span class="content">org.hibernate:hibernate:3.0.5</span><span class="delimiter">'</span></span>) {
        transitive = <span class="predefined-constant">true</span>
    }
    runtimeOnly <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">hibernate</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">3.0.5</span><span class="delimiter">'</span></span>, <span class="key">transitive</span>: <span class="predefined-constant">true</span>
    runtimeOnly(<span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">hibernate</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">3.0.5</span><span class="delimiter">'</span></span>) {
        transitive = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html">DependencyHandler</a> class in the API documentation for more examples and a complete reference.</p>
</div>
<div class="paragraph">
<p>Gradle provides different notations for module dependencies. There is a string notation and a map notation. A module dependency has an API which allows further configuration. Have a look at <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ExternalModuleDependency.html">ExternalModuleDependency</a> to learn all about the API. This API provides properties and configuration methods. Via the string notation you can define a subset of the properties. With the map notation you can define all properties. To have access to the complete API, either with the map or with the string notation, you can assign a single dependency to a configuration together with a closure.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you declare a module dependency, Gradle looks for a module metadata file (<code>.module</code>, <code>.pom</code> or <code>ivy.xml</code>) in the repositories.
If such a module metadata file exists, it is parsed and the artifacts of this module (e.g. <code>hibernate-3.0.5.jar</code>) as well as its dependencies (e.g. <code>cglib</code>) are downloaded.
If no such module metadata file exists, as of Gradle 6.0, you need to configure <a href="#sec:supported_metadata_sources">metadata sources definitions</a> to look for an artifact file called <code>hibernate-3.0.5.jar</code> directly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>In Maven, a module can have one and only one artifact.</p>
</div>
<div class="paragraph">
<p>In Gradle and Ivy, a module can have multiple artifacts.
Each artifact can have a different set of dependencies.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sub:file_dependencies"><a class="anchor" href="#sub:file_dependencies"></a><a class="link" href="#sub:file_dependencies">File dependencies</a></h5>
<div class="paragraph">
<p>Projects sometimes do not rely on a binary repository product e.g. JFrog Artifactory or Sonatype Nexus for hosting and resolving external dependencies.
It&#8217;s common practice to host those dependencies on a shared drive or check them into version control alongside the project source code.
Those dependencies are referred to as <em>file dependencies</em>, the reason being that they represent a file without any <a href="#sub:terminology_module_metadata">metadata</a> (like information about transitive dependencies, the origin or its author) attached to them.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-file-dependencies.png" alt="dependency management file dependencies">
</div>
<div class="title">Figure 10. Resolving file dependencies from the local file system and a shared drive</div>
</div>
<div class="paragraph">
<p>The following example resolves file dependencies from the directories <code>ant</code>, <code>libs</code> and <code>tools</code>.</p>
</div>
<div id="ex-declaring-multiple-file-dependencies" class="exampleblock">
<div class="title">Example 130. <a href="#ex-declaring-multiple-file-dependencies">Declaring multiple file dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;antContrib&quot;)
    create(&quot;externalLibs&quot;)
    create(&quot;deploymentTools&quot;)
}

dependencies {
    &quot;antContrib&quot;(files(&quot;ant/antcontrib.jar&quot;))
    &quot;externalLibs&quot;(files(&quot;libs/commons-lang.jar&quot;, &quot;libs/log4j.jar&quot;))
    &quot;deploymentTools&quot;(fileTree(&quot;tools&quot;) { include(&quot;*.exe&quot;) })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    antContrib
    externalLibs
    deploymentTools
}

dependencies {
    antContrib files(<span class="string"><span class="delimiter">'</span><span class="content">ant/antcontrib.jar</span><span class="delimiter">'</span></span>)
    externalLibs files(<span class="string"><span class="delimiter">'</span><span class="content">libs/commons-lang.jar</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">libs/log4j.jar</span><span class="delimiter">'</span></span>)
    deploymentTools(fileTree(<span class="string"><span class="delimiter">'</span><span class="content">tools</span><span class="delimiter">'</span></span>) { include <span class="string"><span class="delimiter">'</span><span class="content">*.exe</span><span class="delimiter">'</span></span> })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see in the code example, every dependency has to define its exact location in the file system.
The most prominent methods for creating a file reference are
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(java.lang.Object&#8230;&#8203;)</a>,
<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ProjectLayout.html#files-java.lang.Object...-">ProjectLayout.files(java.lang.Object&#8230;&#8203;)</a>
and <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:fileTree(java.lang.Object)">Project.fileTree(java.lang.Object)</a>
Alternatively, you can also define the source directory of one or many file dependencies in the form of a <a href="#sub:flat_dir_resolver">flat directory repository</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The order of the files in a <code>FileTree</code> is not stable, even on a single computer.
It means that dependency configuration seeded with such a construct may produce a resolution result which has a different ordering, possibly impacting the cacheability of tasks using the result as an input.
Using the simpler <code>files</code> instead is recommended where possible.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>File dependencies allow you to directly add a set of files to a configuration, without first adding them to a repository. This can be useful if you cannot, or do not want to, place certain files in a repository. Or if you do not want to use any repositories at all for storing your dependencies.</p>
</div>
<div class="paragraph">
<p>To add some files as a dependency for a configuration, you simply pass a <a href="#sec:file_collections">file collection</a> as a dependency:</p>
</div>
<div id="ex-file-dependencies" class="exampleblock">
<div class="title">Example 131. <a href="#ex-file-dependencies">File dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    runtimeOnly(files(&quot;libs/a.jar&quot;, &quot;libs/b.jar&quot;))
    runtimeOnly(fileTree(&quot;libs&quot;) { include(&quot;*.jar&quot;) })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    runtimeOnly files(<span class="string"><span class="delimiter">'</span><span class="content">libs/a.jar</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">libs/b.jar</span><span class="delimiter">'</span></span>)
    runtimeOnly fileTree(<span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>) { include <span class="string"><span class="delimiter">'</span><span class="content">*.jar</span><span class="delimiter">'</span></span> }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>File dependencies are not included in the published dependency descriptor for your project.
However, file dependencies are included in transitive project dependencies within the same build.
This means they cannot be used outside the current build, but they can be used within the same build.</p>
</div>
<div class="paragraph">
<p>You can declare which tasks produce the files for a file dependency.
You might do this when, for example, the files are generated by the build.</p>
</div>
<div id="ex-generated-file-dependencies" class="exampleblock">
<div class="title">Example 132. <a href="#ex-generated-file-dependencies">Generated file dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(files(layout.buildDirectory.dir(&quot;classes&quot;)) {
        builtBy(&quot;compile&quot;)
    })
}

tasks.register(&quot;compile&quot;) {
    doLast {
        println(&quot;compiling classes&quot;)
    }
}

tasks.register(&quot;list&quot;) {
    val compileClasspath: FileCollection = configurations[&quot;compileClasspath&quot;]
    dependsOn(compileClasspath)
    doLast {
        println(&quot;classpath = ${compileClasspath.map { file: File -&gt; file.name }}&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation files(layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">classes</span><span class="delimiter">'</span></span>)) {
        builtBy <span class="string"><span class="delimiter">'</span><span class="content">compile</span><span class="delimiter">'</span></span>
    }
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">compile</span><span class="delimiter">'</span></span>) {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">compiling classes</span><span class="delimiter">'</span></span>
    }
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">list</span><span class="delimiter">'</span></span>) {
    FileCollection compileClasspath = configurations.compileClasspath
    dependsOn compileClasspath
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">classpath = </span><span class="inline"><span class="inline-delimiter">${</span>compileClasspath.collect { <span class="predefined-type">File</span> file -&gt; file.name }<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q list
compiling classes
classpath = [classes]</pre>
</div>
</div>
<div class="sect5">
<h6 id="sec:versioning_file_dependencies"><a class="anchor" href="#sec:versioning_file_dependencies"></a><a class="link" href="#sec:versioning_file_dependencies">Versioning of file dependencies</a></h6>
<div class="paragraph">
<p>It is recommended to clearly express the intention and a concrete version for file dependencies.
File dependencies are not considered by Gradle&#8217;s <a href="#sec:how-gradle-downloads-deps">version conflict resolution</a>.
Therefore, it is extremely important to assign a version to the file name to indicate the distinct set of changes shipped with it.
For example <code>commons-beanutils-1.3.jar</code> lets you track the changes of the library by the release notes.</p>
</div>
<div class="paragraph">
<p>As a result, the dependencies of the project are easier to maintain and organize.
It is much easier to uncover potential API incompatibilities by the assigned version.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:project_dependencies"><a class="anchor" href="#sub:project_dependencies"></a><a class="link" href="#sub:project_dependencies">Project dependencies</a></h5>
<div class="paragraph">
<p>Software projects often break up software components into modules to improve maintainability and prevent strong coupling.
Modules can define dependencies between each other to reuse code within the same project.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-project-dependencies.png" alt="dependency management project dependencies">
</div>
<div class="title">Figure 11. Dependencies between projects</div>
</div>
<div class="paragraph">
<p>Gradle can model dependencies between modules.
Those dependencies are called <em>project dependencies</em> because each module is represented by a Gradle project.</p>
</div>
<div id="ex-project-dependencies" class="exampleblock">
<div class="title">Example 133. <a href="#ex-project-dependencies">Project dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(project(&quot;:shared&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:shared</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At runtime, the build automatically ensures that project dependencies are built in the correct order and added to the classpath for compilation.
The chapter <a href="#multi_project_builds">Authoring Multi-Project Builds</a> discusses how to set up and configure multi-project builds in more detail.</p>
</div>
<div class="paragraph">
<p>For more information see the API documentation for <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ProjectDependency.html">ProjectDependency</a>.</p>
</div>
<div class="paragraph">
<p>The following example declares the dependencies on the <code>utils</code> and <code>api</code> project from the <code>web-service</code> project. The method <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:project(java.lang.String)">Project.project(java.lang.String)</a> creates a reference to a specific subproject by path.</p>
</div>
<div id="ex-declaring-project-dependencies" class="exampleblock">
<div class="title">Example 134. <a href="#ex-declaring-project-dependencies">Declaring project dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">web-service/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(project(&quot;:utils&quot;))
    implementation(project(&quot;:api&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">web-service/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:utils</span><span class="delimiter">'</span></span>)
    implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:api</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:type-safe-project-accessors"><a class="anchor" href="#sec:type-safe-project-accessors"></a><a class="link" href="#sec:type-safe-project-accessors">Type-safe project dependencies</a></h6>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Type-safe project accessors are an incubating feature which must be enabled explicitly.
Implementation may change at any time.</p>
</div>
<div class="paragraph">
<p>To add support for type-safe project accessors, add this to your <code>settings.gradle(.kts)</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>enableFeaturePreview(&quot;TYPESAFE_PROJECT_ACCESSORS&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>One issue with the <code>project(":some:path")</code> notation is that you have to remember the path to every project you want to depend on.
In addition, changing a <a href="#sec:project_path">project path</a> requires you to change all places where the project dependency is used, but it is easy to miss one or more occurrences (because you have to rely on search and replace).</p>
</div>
<div class="paragraph">
<p>Since Gradle 7, Gradle offers an experimental type-safe API for project dependencies.
The same example as above can now be rewritten as:</p>
</div>
<div id="ex-declaring-project-dependencies-using-the-type-safe-api" class="exampleblock">
<div class="title">Example 135. <a href="#ex-declaring-project-dependencies-using-the-type-safe-api">Declaring project dependencies using the type-safe API</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">web-service/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(projects.utils)
    implementation(projects.api)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">web-service/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation projects.utils
    implementation projects.api
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The type-safe API has the advantage of providing IDE completion so you don&#8217;t need to figure out the actual names of the projects.</p>
</div>
<div class="paragraph">
<p>If you add or remove a project that uses the Kotlin DSL, build script compilation fails if you forget to update a dependency.</p>
</div>
<div class="paragraph">
<p>The project accessors are mapped from the <em>project path</em>.
For example, if a project path is <code>:commons:utils:some:lib</code> then the project accessor will be <code>projects.commons.utils.some.lib</code> (which is the short-hand notation for <code>projects.getCommons().getUtils().getSome().getLib()</code>).</p>
</div>
<div class="paragraph">
<p>A project name with kebab case (<code>some-lib</code>) or snake case (<code>some_lib</code>) will be converted to camel case in accessors: <code>projects.someLib</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="local_forks_of_module_dependencies"><a class="anchor" href="#local_forks_of_module_dependencies"></a><a class="link" href="#local_forks_of_module_dependencies">Local forks of module dependencies</a></h5>
<div class="paragraph">
<p>A module dependency can be substituted by a dependency to a local fork of the sources of that module, if the module itself is built with Gradle.
This can be done by utilising <a href="#defining_composite_builds">composite builds</a>.
This allows you, for example, to fix an issue in a library you use in an application by using, and building, a locally patched version instead of the published binary version.
The details of this are described in the section on <a href="#defining_composite_builds">composite builds</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:gradle_distribution_dependencies"><a class="anchor" href="#sub:gradle_distribution_dependencies"></a><a class="link" href="#sub:gradle_distribution_dependencies">Gradle distribution-specific dependencies</a></h5>
<div class="sect5">
<h6 id="sub:api_dependencies"><a class="anchor" href="#sub:api_dependencies"></a><a class="link" href="#sub:api_dependencies">Gradle API dependency</a></h6>
<div class="paragraph">
<p>You can declare a dependency on the API of the current version of Gradle by using the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html#org.gradle.api.artifacts.dsl.DependencyHandler:gradleApi()">DependencyHandler.gradleApi()</a> method. This is useful when you are developing custom Gradle tasks or plugins.</p>
</div>
<div id="ex-gradle-api-dependencies" class="exampleblock">
<div class="title">Example 136. <a href="#ex-gradle-api-dependencies">Gradle API dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(gradleApi())
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation gradleApi()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sub:testkit_dependencies"><a class="anchor" href="#sub:testkit_dependencies"></a><a class="link" href="#sub:testkit_dependencies">Gradle TestKit dependency</a></h6>
<div class="paragraph">
<p>You can declare a dependency on the TestKit API of the current version of Gradle by using the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html#org.gradle.api.artifacts.dsl.DependencyHandler:gradleTestKit()">DependencyHandler.gradleTestKit()</a> method. This is useful for writing and executing functional tests for Gradle plugins and build scripts.</p>
</div>
<div id="ex-gradle-testkit-dependencies" class="exampleblock">
<div class="title">Example 137. <a href="#ex-gradle-testkit-dependencies">Gradle TestKit dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(gradleTestKit())
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation gradleTestKit()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="#test_kit">The TestKit chapter</a> explains the use of TestKit by example.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:groovy_dependencies"><a class="anchor" href="#sub:groovy_dependencies"></a><a class="link" href="#sub:groovy_dependencies">Local Groovy dependency</a></h6>
<div class="paragraph">
<p>You can declare a dependency on the Groovy that is distributed with Gradle by using the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html#org.gradle.api.artifacts.dsl.DependencyHandler:localGroovy()">DependencyHandler.localGroovy()</a> method. This is useful when you are developing custom Gradle tasks or plugins in Groovy.</p>
</div>
<div id="ex-gradles-groovy-dependencies" class="exampleblock">
<div class="title">Example 138. <a href="#ex-gradles-groovy-dependencies">Gradle&#8217;s Groovy dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(localGroovy())
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation localGroovy()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:documenting-dependencies"><a class="anchor" href="#sec:documenting-dependencies"></a><a class="link" href="#sec:documenting-dependencies">Documenting dependencies</a></h4>
<div class="paragraph">
<p>When you declare a dependency or a <a href="#sec:adding-constraints-transitive-deps">dependency constraint</a>, you can provide a custom reason for the declaration.
This makes the dependency declarations in your build script and the <a href="#sec:identifying_reason_dependency_selection">dependency insight report</a> easier to interpret.</p>
</div>
<div id="ex-giving-a-reason-for-choosing-a-certain-module-version-in-a-dependency-declaration" class="exampleblock">
<div class="title">Example 139. <a href="#ex-giving-a-reason-for-choosing-a-certain-module-version-in-a-dependency-declaration">Giving a reason for choosing a certain module version in a dependency declaration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;org.ow2.asm:asm:7.1&quot;) {
        because(&quot;we require a JDK 9 compatible bytecode generator&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
}

dependencies {
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.ow2.asm:asm:7.1</span><span class="delimiter">'</span></span>) {
        because <span class="string"><span class="delimiter">'</span><span class="content">we require a JDK 9 compatible bytecode generator</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example_using_the_dependency_insight_report_with_custom_reasons"><a class="anchor" href="#example_using_the_dependency_insight_report_with_custom_reasons"></a><a class="link" href="#example_using_the_dependency_insight_report_with_custom_reasons">Example: Using the dependency insight report with custom reasons</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q dependencyInsight --dependency asm</code></strong></div>
<div class="content">
<pre>&gt; gradle -q dependencyInsight --dependency asm
org.ow2.asm:asm:7.1
  Variant compile:
    | Attribute Name                 | Provided | Requested    |
    |--------------------------------|----------|--------------|
    | org.gradle.status              | release  |              |
    | org.gradle.category            | library  | library      |
    | org.gradle.libraryelements     | jar      | classes      |
    | org.gradle.usage               | java-api | java-api     |
    | org.gradle.dependency.bundling |          | external     |
    | org.gradle.jvm.environment     |          | standard-jvm |
    | org.gradle.jvm.version         |          | 11           |
   Selection reasons:
      - Was requested: we require a JDK 9 compatible bytecode generator

org.ow2.asm:asm:7.1
\--- compileClasspath

A web-based, searchable dependency report is available by adding the --scan option.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:resolve_specific_artifacts_from_dependency"><a class="anchor" href="#sec:resolve_specific_artifacts_from_dependency"></a><a class="link" href="#sec:resolve_specific_artifacts_from_dependency">Resolving specific artifacts from a module dependency</a></h4>
<div class="paragraph">
<p>Whenever Gradle tries to resolve a module from a Maven or Ivy repository, it looks for a metadata file and the default artifact file, a JAR. The build fails if none of these artifact files can be resolved. Under certain conditions, you might want to tweak the way Gradle resolves artifacts for a dependency.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The dependency only provides a non-standard artifact without any metadata e.g. a ZIP file.</p>
</li>
<li>
<p>The module metadata declares more than one artifact e.g. as part of an Ivy dependency descriptor.</p>
</li>
<li>
<p>You only want to download a specific artifact without any of the transitive dependencies declared in the metadata.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle is a polyglot build tool and not limited to just resolving Java libraries. Let&#8217;s assume you wanted to build a web application using JavaScript as the client technology. Most projects check in external JavaScript libraries into version control. An external JavaScript library is no different than a reusable Java library so why not download it from a repository instead?</p>
</div>
<div class="paragraph">
<p><a href="https://developers.google.com/speed/libraries/">Google Hosted Libraries</a> is a distribution platform for popular, open-source JavaScript libraries. With the help of the artifact-only notation you can download a JavaScript library file e.g. JQuery. The <code>@</code> character separates the dependency&#8217;s coordinates from the artifact&#8217;s file extension.</p>
</div>
<div id="ex-resolving-a-javascript-artifact-for-a-declared-dependency" class="exampleblock">
<div class="title">Example 140. <a href="#ex-resolving-a-javascript-artifact-for-a-declared-dependency">Resolving a JavaScript artifact for a declared dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;https://ajax.googleapis.com/ajax/libs&quot;)
        patternLayout {
            artifact(&quot;[organization]/[revision]/[module].[ext]&quot;)
        }
        metadataSources {
            artifact()
        }
    }
}

configurations {
    create(&quot;js&quot;)
}

dependencies {
    &quot;js&quot;(&quot;jquery:jquery:3.2.1@js&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">'</span><span class="content">https://ajax.googleapis.com/ajax/libs</span><span class="delimiter">'</span></span>
        patternLayout {
            artifact <span class="string"><span class="delimiter">'</span><span class="content">[organization]/[revision]/[module].[ext]</span><span class="delimiter">'</span></span>
        }
        metadataSources {
            artifact()
        }
    }
}

configurations {
    js
}

dependencies {
    js <span class="string"><span class="delimiter">'</span><span class="content">jquery:jquery:3.2.1@js</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Some modules ship different "flavors" of the same artifact or they publish multiple artifacts that belong to a specific module version but have a different purpose. It&#8217;s common for a Java library to publish the artifact with the compiled class files, another one with just the source code in it and a third one containing the Javadocs.</p>
</div>
<div class="paragraph">
<p>In JavaScript, a library may exist as uncompressed or minified artifact. In Gradle, a specific artifact identifier is called <em>classifier</em>, a term generally used in Maven and Ivy dependency management.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say we wanted to download the minified artifact of the JQuery library instead of the uncompressed file. You can provide the classifier <code>min</code> as part of the dependency declaration.</p>
</div>
<div id="ex-resolving-a-javascript-artifact-with-classifier-for-a-declared-dependency" class="exampleblock">
<div class="title">Example 141. <a href="#ex-resolving-a-javascript-artifact-with-classifier-for-a-declared-dependency">Resolving a JavaScript artifact with classifier for a declared dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;https://ajax.googleapis.com/ajax/libs&quot;)
        patternLayout {
            artifact(&quot;[organization]/[revision]/[module](.[classifier]).[ext]&quot;)
        }
        metadataSources {
            artifact()
        }
    }
}

configurations {
    create(&quot;js&quot;)
}

dependencies {
    &quot;js&quot;(&quot;jquery:jquery:3.2.1:min@js&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">'</span><span class="content">https://ajax.googleapis.com/ajax/libs</span><span class="delimiter">'</span></span>
        patternLayout {
            artifact <span class="string"><span class="delimiter">'</span><span class="content">[organization]/[revision]/[module](.[classifier]).[ext]</span><span class="delimiter">'</span></span>
        }
        metadataSources {
            artifact()
        }
    }
}

configurations {
    js
}

dependencies {
    js <span class="string"><span class="delimiter">'</span><span class="content">jquery:jquery:3.2.1:min@js</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:supported-metadata-formats"><a class="anchor" href="#sec:supported-metadata-formats"></a><a class="link" href="#sec:supported-metadata-formats">Supported Metadata formats</a></h4>
<div class="paragraph">
<p>External module dependencies require module metadata (so that, typically, Gradle can figure out the transitive dependencies of a module).
To do so, Gradle supports different metadata formats.</p>
</div>
<div class="paragraph">
<p>You can also tweak which format will be looked up in the <a href="#sec:supported_metadata_sources">repository definition</a>.</p>
</div>
<div class="sect4">
<h5 id="sub:supported-md-gradle"><a class="anchor" href="#sub:supported-md-gradle"></a><a class="link" href="#sub:supported-md-gradle">Gradle Module Metadata files</a></h5>
<div class="paragraph">
<p>Gradle Module Metadata has been specifically designed to support all features of Gradle&#8217;s dependency management model and is hence the preferred format.
You can find its <a href="https://github.com/gradle/gradle/blob/master/platforms/documentation/docs/src/docs/design/gradle-module-metadata-latest-specification.md">specification here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:supported-md-pom"><a class="anchor" href="#sub:supported-md-pom"></a><a class="link" href="#sub:supported-md-pom">POM files</a></h5>
<div class="paragraph">
<p>Gradle natively supports <a href="https://maven.apache.org/pom.html">Maven POM files</a>.
It&#8217;s worth noting that by default Gradle will first look for a POM file, but if this file contains a special marker, Gradle will use <a href="#sub:supported-md-gradle">Gradle Module Metadata</a> instead.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:supported-md-ivy"><a class="anchor" href="#sub:supported-md-ivy"></a><a class="link" href="#sub:supported-md-ivy">Ivy files</a></h5>
<div class="paragraph">
<p>Similarly, Gradle supports <a href="http://ant.apache.org/ivy/">Apache Ivy metadata files</a>.
Again, Gradle will first look for an <code>ivy.xml</code> file, but if this file contains a special marker, Gradle will use <a href="#sub:supported-md-gradle">Gradle Module Metadata</a> instead.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec:understanding-diff-libraries-and-apps"><a class="anchor" href="#sec:understanding-diff-libraries-and-apps"></a><a class="link" href="#sec:understanding-diff-libraries-and-apps">Understanding the difference between libraries and applications</a></h3>
<div class="sect3">
<h4 id="sub:producers-vs-consumers"><a class="anchor" href="#sub:producers-vs-consumers"></a><a class="link" href="#sub:producers-vs-consumers">Producers vs consumers</a></h4>
<div class="paragraph">
<p>A key concept in dependency management with Gradle is the difference between consumers and producers.</p>
</div>
<div class="paragraph">
<p>When you <em>build</em> a library, you are effectively on the <em>producer</em> side: you are producing <em>artifacts</em> which are going to be <em>consumed</em> by someone else, the <em>consumer</em>.</p>
</div>
<div class="paragraph">
<p>A lot of problems with traditional build systems is that they don&#8217;t make the difference between a producer and a consumer.</p>
</div>
<div class="paragraph">
<p>A <em>consumer</em> needs to be understood in the large sense:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a project that depends on another project is a <em>consumer</em></p>
</li>
<li>
<p>a <em>task</em> that depends on an artifact is a finer grained consumer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In dependency management, a lot of the decisions we make depend on the type of project we are building, that is to say, <a href="#sub:being-respectful-consumers">what kind of <em>consumer</em> we are</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:producer-variants"><a class="anchor" href="#sub:producer-variants"></a><a class="link" href="#sub:producer-variants">Producer variants</a></h4>
<div class="paragraph">
<p>A producer may want to generate different artifacts for different kinds of consumers: for the same source code, different <em>binaries</em> are produced.
Or, a project may produce artifacts which are for consumption by other projects (same repository) but not for external use.</p>
</div>
<div class="paragraph">
<p>A typical example in the Java world is the Guava library which is published in different versions: one for Java projects, and one for Android projects.</p>
</div>
<div class="paragraph">
<p>However, it&#8217;s the consumer responsibility to tell what version to use, and it&#8217;s the dependency management engine responsibility to ensure <em>consistency of the graph</em> (for example making sure that you don&#8217;t end up with both Java and Android versions of Guava on your classpath).
This is where the <a href="#understanding-variant-selection">variant model</a> of Gradle comes into play.</p>
</div>
<div class="paragraph">
<p>In Gradle, <em>producer variants</em> are exposed via <a href="#sec:resolvable-consumable-configs">consumable configurations</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:strong-encapsulation"><a class="anchor" href="#sub:strong-encapsulation"></a><a class="link" href="#sub:strong-encapsulation">Strong encapsulation</a></h4>
<div class="paragraph">
<p>In order for a producer to compile a library, it needs all its <em>implementation dependencies</em> on the compile classpath.
There are dependencies which are only required <em>as an implementation detail</em> of the library and there are libraries which are effectively part of the API.</p>
</div>
<div class="paragraph">
<p>However, a library <em>depending</em> on this produced library only needs to "see" the public API of your library and therefore the dependencies of this API.
It&#8217;s a subset of the compile classpath of the producer: this is strong encapsulation of dependencies.</p>
</div>
<div class="paragraph">
<p>The consequence is that a dependency which is assigned to the <code>implementation</code> configuration of a library <em>does not end up on the compile classpath of the consumer</em>.
On the other hand, a dependency which is assigned to the <code>api</code> configuration of a library <em>would end up on the compile classpath of the consumer</em>.
At <em>runtime</em>, however, all dependencies are required.
Gradle makes the difference between different kinds of consumer even within a single project: the Java compile task, for example, is a different consumer than the Java exec task.</p>
</div>
<div class="paragraph">
<p>More details on the segregation of API and runtime dependencies in the Java world <a href="#java_library_plugin">can be found here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:being-respectful-consumers"><a class="anchor" href="#sub:being-respectful-consumers"></a><a class="link" href="#sub:being-respectful-consumers">Being respectful of consumers</a></h4>
<div class="paragraph">
<p>Whenever, as a developer, you decide to include a dependency, you must understand that there are <em>consequences for your consumers</em>.
For example, if you add a dependency to your project, it becomes a <em>transitive dependency</em> of your consumers, and therefore may participate in conflict resolution if the consumer needs a different version.</p>
</div>
<div class="paragraph">
<p>A lot of the problems Gradle handles are about fixing the mismatch between the expectations of a consumer and a producer.</p>
</div>
<div class="paragraph">
<p>However, some projects are easier than others:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if you are at the end of the consumption chain, that is to say you build an <em>application</em>, then there are effectively <em>no consumer</em> of your project (apart from final customers): adding <a href="#sec:excluding-transitive-deps">exclusions</a> will have no other consequence than fixing your problem.</p>
</li>
<li>
<p>however if you are a library, adding <a href="#sec:excluding-transitive-deps">exclusions</a> may prevent consumers from working properly, because they would exercise a path of the code that you don&#8217;t</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Always keep in mind that the solution you choose to fix a problem can "leak" to your consumers.
This documentation aims at guiding you to find the right solution to the right problem, and more importantly, make decisions which help the resolution engine to take the right decisions in case of conflicts.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec:debugging-build-scans"><a class="anchor" href="#sec:debugging-build-scans"></a><a class="link" href="#sec:debugging-build-scans">View and Debug Dependencies</a></h3>
<div class="paragraph">
<p>Gradle provides tooling to navigate dependency graphs and mitigate <a href="https://en.wikipedia.org/wiki/Dependency_hell">dependency hell</a>.
Users can render the full graph of dependencies as well as identify the selection reason and origin for a dependency.
Dependencies can originate through build script declared dependencies or transitive dependencies.
You can visualize dependencies with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the built-in Gradle CLI <code>dependencies</code> task</p>
</li>
<li>
<p>the built-in Gradle CLI <code>dependencyInsight</code> task</p>
</li>
<li>
<p><a href="https://scans.gradle.com/">build scans</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="sec:listing_dependencies"><a class="anchor" href="#sec:listing_dependencies"></a><a class="link" href="#sec:listing_dependencies">List Project Dependencies</a></h4>
<div class="paragraph">
<p>Gradle provides the built-in <code>dependencies</code> task to render a dependency tree from the command line.
By default, the dependency tree renders dependencies for all <a href="#sec:what-are-dependency-configurations">configurations</a> within a <a href="#executing_tasks_in_multi_project_builds">single project</a>.
The dependency tree indicates the selected version of each dependency.
It also displays information about dependency conflict resolution.</p>
</div>
<div class="paragraph">
<p>The <code>dependencies</code> task can be especially helpful for issues related to transitive dependencies.
Your build file lists direct dependencies, but the <code>dependencies</code> task can help you understand which transitive dependencies resolve during your build.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Graph of dependencies <a href="#sec:build_script_external_dependencies">declared in the <code>buildscript</code> <code>classpath</code> configuration</a> can be rendered using <a href="#sec:listing_project_dependencies">task <code>buildEnvironment</code></a>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="output_annotations"><a class="anchor" href="#output_annotations"></a><a class="link" href="#output_annotations">Output Annotations</a></h5>
<div class="paragraph">
<p>The <code>dependencies</code> task marks dependency trees with the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>(*)</code>: Indicates repeated occurrences of a transitive dependency subtree. Gradle expands transitive dependency subtrees only once per project; repeat occurrences only display the root of the subtree, followed by this annotation.</p>
</li>
<li>
<p><code>(c)</code>: This element is a <a href="#sec:direct-vs-transitive-deps">dependency constraint</a>, not a dependency. Look for the matching dependency elsewhere in the tree.</p>
</li>
<li>
<p><code>(n)</code>: A dependency or dependency configuration that <a href="#sec:resolvable-consumable-configs">cannot be resolved</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="specify_a_dependency_configuration"><a class="anchor" href="#specify_a_dependency_configuration"></a><a class="link" href="#specify_a_dependency_configuration">Specify a Dependency Configuration</a></h5>
<div class="paragraph">
<p>To focus on the information about one dependency configuration, provide the optional parameter <code>--configuration</code>.
Just like <a href="#sec:name_abbreviation">project and task names</a>, Gradle accepts abbreviated names to select a dependency configuration.
For example, you can specify <code>tRC</code> instead of <code>testRuntimeClasspath</code> if the pattern matches to a single dependency configuration.
Both of the following examples show dependencies in the <code>testRuntimeClasspath</code> dependency configuration of a Java project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; gradle -q dependencies --configuration testRuntimeClasspath</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; gradle -q dependencies --configuration tRC</pre>
</div>
</div>
<div class="paragraph">
<p>To see a list of all the configurations available in a project, including those added by any plugins, you can run a <code>resolvableConfigurations</code> report.</p>
</div>
<div class="paragraph">
<p>For more info, see that plugin&#8217;s documentation (for instance, the Java Plugin is documented <a href="java_plugin.html#sec:java_plugin_and_dependency_management">here</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="example_2"><a class="anchor" href="#example_2"></a><a class="link" href="#example_2">Example</a></h5>
<div class="paragraph">
<p>Consider a project that uses the <a href="https://www.eclipse.org/jgit/">JGit library</a> to execute Source Control Management (SCM) operations for a release process.
You can declare dependencies for external tooling with the help of a <a href="#sec:what-are-dependency-configurations">custom dependency configuration</a>.
This avoids polluting other contexts, such as the compilation classpath for your production source code.</p>
</div>
<div class="paragraph">
<p>The following example declares a custom dependency configuration named "scm" that contains the JGit dependency:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

configurations {
    create(&quot;scm&quot;)
}

dependencies {
    &quot;scm&quot;(&quot;org.eclipse.jgit:org.eclipse.jgit:4.9.2.201712150930-r&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

configurations {
    scm
}

dependencies {
    scm <span class="string"><span class="delimiter">'</span><span class="content">org.eclipse.jgit:org.eclipse.jgit:4.9.2.201712150930-r</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Use the following command to view a dependency tree for the <code>scm</code> dependency configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; gradle -q dependencies --configuration scm

------------------------------------------------------------
Root project 'dependencies-report'
------------------------------------------------------------

scm
\--- org.eclipse.jgit:org.eclipse.jgit:4.9.2.201712150930-r
     +--- com.jcraft:jsch:0.1.54
     +--- com.googlecode.javaewah:JavaEWAH:1.1.6
     +--- org.apache.httpcomponents:httpclient:4.3.6
     |    +--- org.apache.httpcomponents:httpcore:4.3.3
     |    +--- commons-logging:commons-logging:1.1.3
     |    \--- commons-codec:commons-codec:1.6
     \--- org.slf4j:slf4j-api:1.7.2

A web-based, searchable dependency report is available by adding the --scan option.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:identifying_reason_dependency_selection"><a class="anchor" href="#sec:identifying_reason_dependency_selection"></a><a class="link" href="#sec:identifying_reason_dependency_selection">Identify the Dependency Version Selected</a></h4>
<div class="paragraph">
<p>A project may request two different versions of the same dependency either directly or transitively.
Gradle applies <a href="#sec:version-conflict">version conflict resolution</a> to ensure that only one version of the dependency exists in the dependency graph.
The following example introduces a conflict with <code>commons-codec:commons-codec</code>, added both as a direct dependency and a transitive dependency of JGit:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

configurations {
    create(&quot;scm&quot;)
}

dependencies {
    &quot;scm&quot;(&quot;org.eclipse.jgit:org.eclipse.jgit:4.9.2.201712150930-r&quot;)
    &quot;scm&quot;(&quot;commons-codec:commons-codec:1.7&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

configurations {
    scm
}

dependencies {
    scm <span class="string"><span class="delimiter">'</span><span class="content">org.eclipse.jgit:org.eclipse.jgit:4.9.2.201712150930-r</span><span class="delimiter">'</span></span>
    scm <span class="string"><span class="delimiter">'</span><span class="content">commons-codec:commons-codec:1.7</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The dependency tree in a <a href="https://scans.gradle.com/">build scan</a> shows information about conflicts.
Click on a dependency and select the "Required By" tab to see the selection reason and origin of the dependency.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-dependency-insight-report-build-scan.png" alt="dependency management dependency insight report build scan">
</div>
</div>
<div class="sect4">
<h5 id="dependency_insights"><a class="anchor" href="#dependency_insights"></a><a class="link" href="#dependency_insights">Dependency Insights</a></h5>
<div class="paragraph">
<p>Gradle provides the built-in <code>dependencyInsight</code> task to render a  <em>dependency insight report</em> from the command line.
Dependency insights provide information about a single dependency within a single <a href="#sec:what-are-dependency-configurations">configuration</a>.
Given a dependency, you can identify the selection reason and origin.</p>
</div>
<div class="paragraph">
<p><code>dependencyInsight</code> accepts the following parameters:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--dependency &lt;dependency&gt;</code> (mandatory)</dt>
<dd>
<p>The dependency to investigate.
You can supply a complete <code>group:name</code>, or part of it.
If multiple dependencies match, Gradle generates a report covering all matching dependencies.</p>
</dd>
<dt class="hdlist1"><code>--configuration &lt;name&gt;</code> (mandatory)</dt>
<dd>
<p>The dependency configuration which resolves the given dependency.
This parameter is optional for projects that use the <a href="java_plugin.html#java_plugin">Java plugin</a>, since the plugin provides a default value of <code>compileClasspath</code>.</p>
</dd>
<dt class="hdlist1"><code>--single-path</code> (optional)</dt>
<dd>
<p>Render only a single path to the dependency.</p>
</dd>
<dt class="hdlist1"><code>--all-variants</code> (optional)</dt>
<dd>
<p>Render information about all variants, not only the selected variant.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following code snippet demonstrates how to run a dependency insight report for all paths to a dependency named "commons-codec" within the "scm" configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; gradle -q dependencyInsight --dependency commons-codec --configuration scm
commons-codec:commons-codec:1.7
  Variant default:
    | Attribute Name    | Provided | Requested |
    |-------------------|----------|-----------|
    | org.gradle.status | release  |           |
   Selection reasons:
      - By conflict resolution: between versions 1.7 and 1.6

commons-codec:commons-codec:1.7
\--- scm

commons-codec:commons-codec:1.6 -&gt; 1.7
\--- org.apache.httpcomponents:httpclient:4.3.6
     \--- org.eclipse.jgit:org.eclipse.jgit:4.9.2.201712150930-r
          \--- scm

A web-based, searchable dependency report is available by adding the --scan option.</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about configurations, see the <a href="#sec:what-are-dependency-configurations">dependency configuration documentation</a>.</p>
</div>
<div class="sect5">
<h6 id="selection_reasons"><a class="anchor" href="#selection_reasons"></a><a class="link" href="#selection_reasons">Selection Reasons</a></h6>
<div class="paragraph">
<p>The "Selection reasons" section of the dependency insight report lists the reasons why a dependency was selected.
Have a look at the table below to understand the meaning of the different terms used:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 19. Terminology</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Reason</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Absent)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No reason other than a reference, direct or transitive, was present.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Was requested : &lt;text&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The dependency appears in the graph, and the inclusion came with a <a href="#sec:documenting-dependencies"><code>because</code> text</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Was requested : didn&#8217;t match versions &lt;versions&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The dependency appears with a <a href="#sub:declaring_dependency_with_dynamic_version">dynamic version</a> which did not include the listed versions.
May be followed by a <code>because</code> text.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Was requested : reject version &lt;versions&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The dependency appears with a <a href="#rich-version-constraints">rich version</a> containing one or more <code>reject</code>.
May be followed by a <code>because</code> text.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">By conflict resolution : between versions &lt;version&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The dependency appeared multiple times, with different version requests.
This resulted in <a href="#sec:version-conflict">conflict resolution</a> to select the most appropriate version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">By constraint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="#sec:adding-constraints-transitive-deps">dependency constraint</a> participated in the version selection.
May be followed by a <code>because</code> text.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">By ancestor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">There is a <a href="#rich-version-constraints">rich version</a> with a <code>strictly</code> which enforces the version of this dependency.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selected by rule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="#resolution_rules">dependency resolution rule</a> overruled the default selection process.
May be followed by a <code>because</code> text.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rejection : &lt;version&gt; by rule because &lt;text&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>ComponentSelection.reject</code> <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.ComponentSelection.html#org.gradle.api.artifacts.ComponentSelection:reject(java.lang.String)">rejected the given version</a> of the dependency.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rejection: version &lt;version&gt;: &lt;attributes information&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The dependency has a dynamic version and some versions did not match the <a href="#sec:variant-aware-matching">requested attributes</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forced</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The build enforces the version of the dependency through an enforced platform or resolution strategy.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If multiple selection reasons exist, the insight report lists all of them.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="troubleshooting"><a class="anchor" href="#troubleshooting"></a><a class="link" href="#troubleshooting">Troubleshooting</a></h4>
<div class="sect4">
<h5 id="sec:resolving-version-conflict"><a class="anchor" href="#sec:resolving-version-conflict"></a><a class="link" href="#sec:resolving-version-conflict">Version Conflicts</a></h5>
<div class="paragraph">
<p>If the selected version does not match your expectation, Gradle offers a series of tools to help you <a href="#dependency-constraints">control transitive dependencies</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:resolving-variant-aware-errors"><a class="anchor" href="#sec:resolving-variant-aware-errors"></a><a class="link" href="#sec:resolving-variant-aware-errors">Variant Selection Errors</a></h5>
<div class="paragraph">
<p>Sometimes a selection error happens at the <a href="#understanding-variant-selection">variant selection level</a>.
Have a look at the <a href="#sec:variant-select-errors">dedicated section</a> to understand these errors and how to resolve them.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:resolving-unsafe-configuration-resolution-errors"><a class="anchor" href="#sub:resolving-unsafe-configuration-resolution-errors"></a><a class="link" href="#sub:resolving-unsafe-configuration-resolution-errors">Unsafe Configuration Resolution Errors</a></h5>
<div class="paragraph">
<p>Resolving a configuration can have side effects on Gradle&#8217;s project model.
As a result, Gradle must manage access to each project&#8217;s configurations.
There are a number of ways a configuration might be resolved unsafely.
For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A task from one project directly resolves a configuration in another project in the task&#8217;s action.</p>
</li>
<li>
<p>A task specifies a configuration from another project as an input file collection.</p>
</li>
<li>
<p>A build script for one project resolves a configuration in another project during evaluation.</p>
</li>
<li>
<p>Project configurations are resolved in the settings file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle produces a deprecation warning for each unsafe access.
Unsafe access can cause indeterminate errors.
You should <a href="#sec:command_line_warnings">fix unsafe access warnings</a> in your build.</p>
</div>
<div class="paragraph">
<p>In most cases, you can resolve unsafe accesses by creating a cross-project dependency on the other project.
See the documentation for <a href="#cross_project_publications">sharing outputs between projects</a> for more information.</p>
</div>
<div class="paragraph">
<p>If you find a use case that can&#8217;t be resolved using these techniques, please let us know by filing a <a href="https://github.com/gradle/gradle/issues">GitHub Issue</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="understanding_dependency_resolution"><a class="anchor" href="#understanding_dependency_resolution"></a><a class="link" href="#understanding_dependency_resolution">Understanding dependency resolution</a></h3>
<div class="paragraph">
<p>This chapter covers the way dependency resolution works <em>inside</em> Gradle.
After covering how you can declare <a href="#declaring-repositories">repositories</a> and <a href="#declaring-dependencies">dependencies</a>, it makes sense to explain how these declarations come together during dependency resolution.</p>
</div>
<div class="paragraph">
<p>Dependency resolution is a process that consists of two phases, which are repeated until the dependency graph is complete:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a new dependency is added to the graph, perform conflict resolution to determine which version should be added to the graph.</p>
</li>
<li>
<p>When a specific dependency, that is a module with a version, is identified as part of the graph, retrieve its metadata so that its dependencies can be added in turn.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following section will describe what Gradle identifies as conflicts and how it can resolve them automatically.
After that, the retrieval of metadata will be covered, explaining how Gradle can <a href="#sec:how-gradle-downloads-deps">follow dependency links</a>.</p>
</div>
<div class="sect3">
<h4 id="sec:conflict-resolution"><a class="anchor" href="#sec:conflict-resolution"></a><a class="link" href="#sec:conflict-resolution">How Gradle handles conflicts?</a></h4>
<div class="paragraph">
<p>When doing dependency resolution, Gradle handles two types of conflicts:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Version conflicts</dt>
<dd>
<p>That is when two or more dependencies require a given dependency but with different versions.</p>
</dd>
<dt class="hdlist1">Implementation conflicts</dt>
<dd>
<p>That is when the dependency graph contains multiple modules that provide the same implementation, or capability in Gradle terminology.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following sections will explain in detail how Gradle attempts to resolve these conflicts.</p>
</div>
<div class="paragraph">
<p>The dependency resolution process is highly customizable to meet enterprise requirements.
For more information, see the chapter on <a href="#dependency-constraints">Controlling transitive dependencies</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:version-conflict"><a class="anchor" href="#sec:version-conflict"></a><a class="link" href="#sec:version-conflict">Version conflict resolution</a></h4>
<div class="paragraph">
<p>A version conflict occurs when two components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Depend on the same module, let&#8217;s say <code>com.google.guava:guava</code></p>
</li>
<li>
<p>But on different versions, let&#8217;s say <code>20.0</code> and <code>25.1-android</code></p>
<div class="ulist">
<ul>
<li>
<p>Our project itself depends on <code>com.google.guava:guava:20.0</code></p>
</li>
<li>
<p>Our project also depends on <code>com.google.inject:guice:4.2.2</code> which itself depends on <code>com.google.guava:guava:25.1-android</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="sub:resolution-strategy"><a class="anchor" href="#sub:resolution-strategy"></a><a class="link" href="#sub:resolution-strategy">Resolution strategy</a></h5>
<div class="paragraph">
<p>Given the conflict above, there exist multiple ways to handle it, either by selecting a version or failing the resolution.
Different tools that handle dependency management have different ways of handling these type of conflicts.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><a href="https://maven.apache.org/">Apache Maven</a> uses a nearest first strategy.</p>
</div>
<div class="paragraph">
<p>Maven will take the <em>shortest</em> path to a dependency and use that version.
In case there are multiple paths of the same length, the first one wins.</p>
</div>
<div class="paragraph">
<p>This means that in the example above, the version of <code>guava</code> will be <code>20.0</code> because the direct dependency is <em>closer</em> than the <code>guice</code> dependency.</p>
</div>
<div class="paragraph">
<p>The main drawback of this method is that it is ordering dependent.
Keeping order in a very large graph can be a challenge.
For example, what if the new version of a dependency ends up having its own dependency declarations in a different order than the previous version?</p>
</div>
<div class="paragraph">
<p>With Maven, this could have unwanted impact on resolved versions.</p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><a href="https://ant.apache.org/ivy/">Apache Ivy</a> is a very flexible dependency management tool.
It offers the possibility to customize dependency resolution, including conflict resolution.</p>
</div>
<div class="paragraph">
<p>This flexibility comes with the price of making it hard to reason about.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Gradle will consider <em>all</em> requested versions, wherever they appear in the dependency graph.
Out of these versions, it will select the <em>highest</em> one. More information on version ordering
<a href="#version_ordering">here</a>.</p>
</div>
<div class="paragraph">
<p>As you have seen, Gradle supports a concept of <a href="#rich-version-constraints">rich version declaration</a>, so what is the highest version depends on the way versions were declared:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If no ranges are involved, then the highest version that is not rejected will be selected.</p>
<div class="ulist">
<ul>
<li>
<p>If a version declared as <code>strictly</code> is lower than that version, selection will fail.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If ranges are involved:</p>
<div class="ulist">
<ul>
<li>
<p>If there is a non range version that falls within the specified ranges or is higher than their upper bound, it will be selected.</p>
</li>
<li>
<p>If there are only ranges, the selection will depend on the intersection of ranges:</p>
<div class="ulist">
<ul>
<li>
<p>If all the ranges intersect, then the highest <em>existing</em> version of the intersection will be selected.</p>
</li>
<li>
<p>If there is no clear intersection between all the ranges, the highest <em>existing</em> version will be selected from the highest range. If there is no version available for the highest range, the resolution will fail.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If a version declared as <code>strictly</code> is lower than that version, selection will fail.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that in the case where ranges come into play, Gradle requires metadata to determine which versions do exist for the considered range.
This causes an intermediate lookup for metadata, as described in <a href="#sec:how-gradle-downloads-deps">How Gradle retrieves dependency metadata?</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:base-version-comparison"><a class="anchor" href="#sec:base-version-comparison"></a><a class="link" href="#sec:base-version-comparison">Qualifiers</a></h5>
<div class="paragraph">
<p>There is a caveat to comparing versions when it comes to selecting the <em>highest</em> one.
All the rules of <a href="#version_ordering">version ordering</a> still apply, but the conflict resolver
has a bias towards versions without qualifiers.</p>
</div>
<div class="paragraph">
<p>The "qualifier" of a version, if it exists, is the tail end of the version string, starting at the first non-dot separator
found in it. The other (first) part of the version string is called the "base form" of the version. Here are some examples
to illustrate:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Original version</th>
<th class="tableblock halign-left valign-top">Base version</th>
<th class="tableblock halign-left valign-top">Qualifier</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;none&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2-3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1_alpha</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">alpha</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">abc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;none&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2b3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">b3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">abc.1+3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abc.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">b1-2-3.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-2-3.3</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As you can see separators are any of the <code>.</code>, <code>-</code>, <code>_</code>, <code>+</code> characters, plus the empty string when a numeric and a non-numeric part of the version are next to each-other.</p>
</div>
<div class="paragraph">
<p>When resolving the conflict between competing versions, the following logic applies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first the versions with the highest base version are selected, the rest are discarded</p>
</li>
<li>
<p>if there are still multiple competing versions left, then one is picked with a preference for not having a qualifier or having release status.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:implementation-conflict"><a class="anchor" href="#sec:implementation-conflict"></a><a class="link" href="#sec:implementation-conflict">Implementation conflict resolution</a></h4>
<div class="paragraph">
<p>Gradle uses variants and capabilities to identify what a module <em>provides</em>.</p>
</div>
<div class="paragraph">
<p>This is a unique feature that deserves its <a href="#understanding-variant-selection">own chapter</a> to understand what it means and enables.</p>
</div>
<div class="paragraph">
<p>A conflict occurs the moment two modules either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Attempt to select incompatible variants,</p>
</li>
<li>
<p>Declare the same capability</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Learn more about handling these type of conflicts in <a href="#sub:selecting-between-candidates">Selecting between candidates</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:how-gradle-downloads-deps"><a class="anchor" href="#sec:how-gradle-downloads-deps"></a><a class="link" href="#sec:how-gradle-downloads-deps">How Gradle retrieves dependency metadata?</a></h4>
<div class="paragraph">
<p>Gradle requires metadata about the modules included in your dependency graph.
That information is required for two main points:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Determine the existing versions of a module when the declared version is dynamic.</p>
</li>
<li>
<p>Determine the dependencies of the module for a given version.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="discovering_versions"><a class="anchor" href="#discovering_versions"></a><a class="link" href="#discovering_versions">Discovering versions</a></h5>
<div class="paragraph">
<p>Faced with a dynamic version, Gradle needs to identify the concrete matching versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each repository is inspected, Gradle does not stop on the first one returning some metadata.
When multiple are defined, they are inspected <em>in the order they were added</em>.</p>
</li>
<li>
<p>For Maven repositories, Gradle will use the <code>maven-metadata.xml</code> which provides information about the available versions.</p>
</li>
<li>
<p>For Ivy repositories, Gradle will resort to directory listing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This process results in a list of candidate versions that are then matched to the dynamic version expressed.
At this point, <a href="#sub:resolution-strategy">version conflict resolution</a> is resumed.</p>
</div>
<div class="paragraph">
<p>Note that Gradle caches the version information, more information can be found in the section <a href="#sec:controlling-dynamic-version-caching">Controlling dynamic version caching</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="obtaining_module_metadata"><a class="anchor" href="#obtaining_module_metadata"></a><a class="link" href="#obtaining_module_metadata">Obtaining module metadata</a></h5>
<div class="paragraph">
<p>Given a required dependency, with a version, Gradle attempts to resolve the dependency by searching for the module the dependency points at.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each repository is inspected in order.</p>
<div class="ulist">
<ul>
<li>
<p>Depending on the type of repository, Gradle looks for metadata files describing the module (<code>.module</code>, <code>.pom</code> or <code>ivy.xml</code> file) or directly for artifact files.</p>
</li>
<li>
<p>Modules that have a module metadata file (<code>.module</code>, <code>.pom</code> or <code>ivy.xml</code> file) are preferred over modules that have an artifact file only.</p>
</li>
<li>
<p>Once a repository returns a <em>metadata</em> result, following repositories are ignored.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Metadata for the dependency is retrieved and parsed, if found</p>
<div class="ulist">
<ul>
<li>
<p>If the module metadata is a POM file that has a parent POM declared, Gradle will recursively attempt to resolve each of the parent modules for the POM.</p>
</li>
</ul>
</div>
</li>
<li>
<p>All of the artifacts for the module are then requested from the <em>same repository</em> that was chosen in the process above.</p>
</li>
<li>
<p>All of that data, including the repository source and potential misses are then stored in the <a href="#sec:dependency_cache">The Dependency Cache</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The penultimate point above is what can make the integration with <a href="#sec:case-for-maven-local">Maven Local</a> problematic.
As it is a cache for Maven, it will sometimes miss some artifacts of a given module.
If Gradle is sourcing such a module from Maven Local, it will consider the missing artifacts to be missing altogether.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="repository_disabling"><a class="anchor" href="#repository_disabling"></a><a class="link" href="#repository_disabling">Repository disabling</a></h5>
<div class="paragraph">
<p>When Gradle fails to retrieve information from a repository, it will disable it for the duration of the build and fail all dependency resolution.</p>
</div>
<div class="paragraph">
<p>That last point is important for reproducibility.
If the build was allowed to continue, ignoring the faulty repository, subsequent builds could have a different result once the repository is back online.</p>
</div>
<div class="sect5">
<h6 id="sub:http-retries"><a class="anchor" href="#sub:http-retries"></a><a class="link" href="#sub:http-retries">HTTP Retries</a></h6>
<div class="paragraph">
<p>Gradle will make several attempts to connect to a given repository before disabling it.
If connection fails, Gradle will retry on certain errors which have a chance of being transient, increasing the amount of time waiting between each retry.</p>
</div>
<div class="paragraph">
<p>Blacklisting happens when the repository cannot be contacted, either because of a permanent error or because the maximum retries was reached.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:dependency_cache"><a class="anchor" href="#sec:dependency_cache"></a><a class="link" href="#sec:dependency_cache">The Dependency Cache</a></h4>
<div class="paragraph">
<p>Gradle contains a highly sophisticated dependency caching mechanism, which seeks to minimise the number of remote requests made in dependency resolution, while striving to guarantee that the results of dependency resolution are correct and reproducible.</p>
</div>
<div class="paragraph">
<p>The Gradle dependency cache consists of two storage types located under <code>$<a href="#dir:gradle_user_home">GRADLE_USER_HOME</a>/caches</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A file-based store of downloaded artifacts, including binaries like jars as well as raw downloaded meta-data like POM files and Ivy files.
The storage path for a downloaded artifact includes the SHA1 checksum, meaning that 2 artifacts with the same name but different content can easily be cached.</p>
</li>
<li>
<p>A binary store of resolved module metadata, including the results of resolving dynamic versions, module descriptors, and artifacts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Gradle cache does not allow the local cache to hide problems and create other mysterious and difficult to debug behavior.
Gradle enables reliable and reproducible enterprise builds with a focus on bandwidth and storage efficiency.</p>
</div>
<div class="sect4">
<h5 id="sub:cache_metadata"><a class="anchor" href="#sub:cache_metadata"></a><a class="link" href="#sub:cache_metadata">Separate metadata cache</a></h5>
<div class="paragraph">
<p>Gradle keeps a record of various aspects of dependency resolution in binary format in the metadata cache.
The information stored in the metadata cache includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The result of resolving a dynamic version (e.g. <code>1.+</code>) to a concrete version (e.g. <code>1.2</code>).</p>
</li>
<li>
<p>The resolved module metadata for a particular module, including module artifacts and module dependencies.</p>
</li>
<li>
<p>The resolved artifact metadata for a particular artifact, including a pointer to the downloaded artifact file.</p>
</li>
<li>
<p>The <em>absence</em> of a particular module or artifact in a particular repository, eliminating repeated attempts to access a resource that does not exist.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every entry in the metadata cache includes a record of the repository that provided the information as well as a timestamp that can be used for cache expiry.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:cache_repository_independence"><a class="anchor" href="#sub:cache_repository_independence"></a><a class="link" href="#sub:cache_repository_independence">Repository caches are independent</a></h5>
<div class="paragraph">
<p>As described above, for each repository there is a separate metadata cache.
A repository is identified by its URL, type and layout.
If a module or artifact has not been previously resolved from <em>this repository</em>, Gradle will attempt to resolve the module against the repository.
This will always involve a remote lookup on the repository, however in many cases <a href="#sub:cache_artifact_reuse">no download will be required</a>.</p>
</div>
<div class="paragraph">
<p>Dependency resolution will fail if the required artifacts are not available in any repository specified by the build, even if the local cache has a copy of this artifact which was retrieved from a different repository.
Repository independence allows builds to be isolated from each other in an advanced way that no build tool has done before.
This is a key feature to create builds that are reliable and reproducible in any environment.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:cache_artifact_reuse"><a class="anchor" href="#sub:cache_artifact_reuse"></a><a class="link" href="#sub:cache_artifact_reuse">Artifact reuse</a></h5>
<div class="paragraph">
<p>Before downloading an artifact, Gradle tries to determine the checksum of the required artifact by downloading the sha file associated with that artifact.
If the checksum can be retrieved, an artifact is not downloaded if an artifact already exists with the same id and checksum.
If the checksum cannot be retrieved from the remote server, the artifact will be downloaded (and ignored if it matches an existing artifact).</p>
</div>
<div class="paragraph">
<p>As well as considering artifacts downloaded from a different repository, Gradle will also attempt to reuse artifacts found in the local Maven Repository.
If a candidate artifact has been downloaded by Maven, Gradle will use this artifact if it can be verified to match the checksum declared by the remote server.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:cache_checksum_storage"><a class="anchor" href="#sub:cache_checksum_storage"></a><a class="link" href="#sub:cache_checksum_storage">Checksum based storage</a></h5>
<div class="paragraph">
<p>It is possible for different repositories to provide a different binary artifact in response to the same artifact identifier.
This is often the case with Maven SNAPSHOT artifacts, but can also be true for any artifact which is republished without changing its identifier.
By caching artifacts based on their SHA1 checksum, Gradle is able to maintain multiple versions of the same artifact.
This means that when resolving against one repository Gradle will never overwrite the cached artifact file from a different repository.
This is done without requiring a separate artifact file store per repository.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:cache_locking"><a class="anchor" href="#sub:cache_locking"></a><a class="link" href="#sub:cache_locking">Cache Locking</a></h5>
<div class="paragraph">
<p>The Gradle dependency cache uses file-based locking to ensure that it can safely be used by multiple Gradle processes concurrently.
The lock is held whenever the binary metadata store is being read or written, but is released for slow operations such as downloading remote artifacts.</p>
</div>
<div class="paragraph">
<p>This concurrent access is only supported if the different Gradle processes can communicate together. This is usually <em>not the case</em> for containerized builds.</p>
</div>
<div class="sect5">
<h6 id="sub:cache_cleanup"><a class="anchor" href="#sub:cache_cleanup"></a><a class="link" href="#sub:cache_cleanup">Cache Cleanup</a></h6>
<div class="paragraph">
<p>Gradle keeps track of which artifacts in the dependency cache are accessed.
Using this information, the cache is periodically (at most every 24 hours) scanned for artifacts that have not been used for more than 30 days.
Obsolete artifacts are then deleted to ensure the cache does not grow indefinitely.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sub:ephemeral-ci-cache"><a class="anchor" href="#sub:ephemeral-ci-cache"></a><a class="link" href="#sub:ephemeral-ci-cache">Dealing with ephemeral builds</a></h4>
<div class="paragraph">
<p>It&#8217;s a common practice to run builds in ephemeral containers.
A container is typically spawned to only execute a single build before it is destroyed.
This can become a practical problem when a build depends on a lot of dependencies which each container has to re-download.
To help with this scenario, Gradle provides a couple of options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sub:cache_copy">copying the dependency cache</a> into each container</p>
</li>
<li>
<p><a href="#sub:shared-readonly-cache">sharing a read-only dependency cache</a> between multiple containers</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="sub:cache_copy"><a class="anchor" href="#sub:cache_copy"></a><a class="link" href="#sub:cache_copy">Copying and reusing the cache</a></h5>
<div class="paragraph">
<p>The dependency cache, both the file and metadata parts, are fully encoded using relative paths.
This means that it is perfectly possible to copy a cache around and see Gradle benefit from it.</p>
</div>
<div class="paragraph">
<p>The path that can be copied is <code>$GRADLE_USER_HOME/caches/modules-&lt;version&gt;</code>.
The only constraint is placing it using the same structure at the destination, where the value of <code>GRADLE_USER_HOME</code> can be different.</p>
</div>
<div class="paragraph">
<p>Do not copy the <code>*.lock</code> or <code>gc.properties</code> files if they exist.</p>
</div>
<div class="paragraph">
<p>Note that creating the cache and consuming it should be done using compatible Gradle version, as shown in the table below.
Otherwise, the build might still require some interactions with remote repositories to complete missing information, which might be available in a different version.
If multiple incompatible Gradle versions are in play, all should be used when seeding the cache.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 20. Dependency cache compatibility</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Module cache version</th>
<th class="tableblock halign-left valign-top">File cache version</th>
<th class="tableblock halign-left valign-top">Metadata cache version</th>
<th class="tableblock halign-left valign-top">Gradle version(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modules-2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>files-2.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata-2.95</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gradle 6.1 to Gradle 6.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modules-2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>files-2.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata-2.96</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gradle 6.4 to Gradle 6.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modules-2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>files-2.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata-2.97</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gradle 6.8 to Gradle 7.4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modules-2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>files-2.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata-2.99</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gradle 7.5 to Gradle 7.6.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modules-2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>files-2.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata-2.101</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gradle 7.6.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modules-2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>files-2.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata-2.100</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gradle 8.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modules-2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>files-2.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata-2.105</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gradle 8.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modules-2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>files-2.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata-2.106</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gradle 8.2 and above</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="sub:shared-readonly-cache"><a class="anchor" href="#sub:shared-readonly-cache"></a><a class="link" href="#sub:shared-readonly-cache">Sharing the dependency cache with other Gradle instances</a></h5>
<div class="paragraph">
<p>Instead of <a href="#sub:cache_copy">copying the dependency cache into each container</a>, it&#8217;s possible to mount a shared, read-only directory that will act as a dependency cache for all containers.
This cache, unlike the classical dependency cache, is accessed without locking, making it possible for multiple builds to read from the cache concurrently. It&#8217;s important that the read-only cache
is not written to when other builds may be reading from it.</p>
</div>
<div class="paragraph">
<p>When using the shared read-only cache, Gradle looks for dependencies (artifacts or metadata) in both the writable cache in the local Gradle User Home directory and the shared read-only cache.
If a dependency is present in the read-only cache, it will not be downloaded.
If a dependency is missing from the read-only cache, it will be downloaded and added to the writable cache.
In practice, this means that the writable cache will only contain dependencies that are unavailable in the read-only cache.</p>
</div>
<div class="paragraph">
<p>The read-only cache should be sourced from a Gradle dependency cache that already contains some of the required dependencies.
The cache can be incomplete; however, an empty shared cache will only add overhead.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The shared read-only dependency cache is an incubating feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The first step in using a shared dependency cache is to create one by copying of an existing <em>local</em> cache.
For this you need to follow the <a href="#sub:cache_copy">instructions above</a>.</p>
</div>
<div class="paragraph">
<p>Then set the <code>GRADLE_RO_DEP_CACHE</code> environment variable to point to the directory containing the cache:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$GRADLE_RO_DEP_CACHE
   |-- modules-2 : the read-only dependency cache, should be mounted with read-only privileges

$GRADLE_HOME
   |-- caches
         |-- modules-2 : the container specific dependency cache, should be writable
         |-- ...
   |-- ...</pre>
</div>
</div>
<div class="paragraph">
<p>In a CI environment, it&#8217;s a good idea to have one build which "seeds" a Gradle dependency cache, which is then <em>copied</em> to a different directory.
This directory can then be used as the read-only cache for other builds.
You shouldn&#8217;t use an existing Gradle installation cache as the read-only cache, because this directory may contain locks and may be modified by the seeding build.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:programmatic_api"><a class="anchor" href="#sec:programmatic_api"></a><a class="link" href="#sec:programmatic_api">Accessing the resolution result programmatically</a></h4>
<div class="paragraph">
<p>While most users only need access to a "flat list" of files, there are cases where it can be interesting to reason on a <em>graph</em> and get more information about the resolution result:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for tooling integration, where a model of the dependency graph is required</p>
</li>
<li>
<p>for tasks generating a visual representation (image, <code>.dot</code> file, &#8230;&#8203;) of a dependency graph</p>
</li>
<li>
<p>for tasks providing diagnostics (similar to the <code>dependencyInsight</code> task)</p>
</li>
<li>
<p>for tasks which need to perform dependency resolution at execution time (e.g, download files on demand)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For those use cases, Gradle provides lazy, thread-safe APIs, accessible by calling the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/Configuration.html#getIncoming--">Configuration.getIncoming()</a> method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ResolvableDependencies.html#getResolutionResult--">ResolutionResult API</a> gives access to a resolved dependency graph, whether the resolution was successful or not.</p>
</li>
<li>
<p>the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ResolvableDependencies.html#getArtifacts--">artifacts API</a> provides a simple access to the resolved artifacts, untransformed, but with lazy download of artifacts (they would only be downloaded on demand).</p>
</li>
<li>
<p>the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ResolvableDependencies.html#artifactView-org.gradle.api.Action-">artifact view API</a> provides an advanced, filtered view of artifacts, possibly <a href="#sec:abm_artifact_transforms">transformed</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
See the documentation on <a href="#sec:task_input_using_dependency_resolution_results">using dependency resolution results</a> for more details on how to consume the results in a task.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verifying-dependencies"><a class="anchor" href="#verifying-dependencies"></a><a class="link" href="#verifying-dependencies">Verifying dependencies</a></h3>
<div class="paragraph">
<p>Working with external dependencies and plugins published on third-party repositories puts your build at risk.
In particular, you need to be aware of what binaries are brought in transitively and if they are legit.
To mitigate the security risks and avoid integrating compromised dependencies in your project, Gradle supports <em>dependency verification</em>.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Dependency verification is, by nature, an inconvenient feature to use.
It means that whenever you&#8217;re going to update a dependency, builds are likely to fail.
It means that merging branches are going to be harder because each branch can have different dependencies.
It means that you will be tempted to switch it off.</p>
</div>
<div class="paragraph">
<p>So why should you bother?</p>
</div>
<div class="paragraph">
<p>Dependency verification is about <strong>trust</strong> in what you get and what you ship.</p>
</div>
<div class="paragraph">
<p>Without dependency verification it&#8217;s easy for an attacker to compromise your supply chain.
There are many real world examples of tools compromised by adding a malicious dependency.
Dependency verification is meant to protect yourself from those attacks, by forcing you to ensure that the artifacts you include in your build are the ones that you expect.
It is not meant, however, to prevent you from including <em>vulnerable</em> dependencies.</p>
</div>
<div class="paragraph">
<p>Finding the right balance between security and convenience is hard but Gradle will try to let you choose the "right level" for you.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Dependency verification consists of two different and complementary operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>checksum verification</em>, which allows asserting the integrity of a dependency</p>
</li>
<li>
<p><em>signature verification</em>, which allows asserting the provenance of a dependency</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle supports both checksum and signature verification out of the box but performs no dependency verification by default.
This section will guide you into configuring dependency verification properly for your needs.</p>
</div>
<div class="paragraph">
<p>This feature can be used for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>detecting compromised dependencies</p>
</li>
<li>
<p>detecting compromised plugins</p>
</li>
<li>
<p>detecting tampered dependencies in the local dependency caches</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="sub:enabling-verification"><a class="anchor" href="#sub:enabling-verification"></a><a class="link" href="#sub:enabling-verification">Enabling dependency verification</a></h4>
<div class="sect4">
<h5 id="sub:verification-metadata"><a class="anchor" href="#sub:verification-metadata"></a><a class="link" href="#sub:verification-metadata">The verification metadata file</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Currently the only source of dependency verification metadata is this XML configuration file.
Future versions of Gradle may include other sources (for example via external services).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Dependency verification is automatically enabled once the configuration file for dependency verification is discovered.
This configuration file is located at <code>$PROJECT_ROOT/gradle/verification-metadata.xml</code>.
This file minimally consists of the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification https://schema.gradle.org/dependency-verification/dependency-verification-1.3.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-metadata&gt;</span>true<span class="tag">&lt;/verify-metadata&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>false<span class="tag">&lt;/verify-signatures&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Doing so, Gradle will verify all artifacts using <a href="#sec:checksum-verification">checksums</a>, but will not verify <a href="#sec:signature-verification">signatures</a>.
Gradle will verify any artifact downloaded using its dependency management engine, which includes, but is not limited to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>artifact files (e.g jar files, zips, &#8230;&#8203;) used during a build</p>
</li>
<li>
<p>metadata artifacts (POM files, Ivy descriptors, Gradle Module Metadata)</p>
</li>
<li>
<p>plugins (both project and settings plugins)</p>
</li>
<li>
<p>artifacts resolved using the advanced dependency resolution APIs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle will <em>not</em> verify changing dependencies (in particular <code>SNAPSHOT</code> dependencies) nor locally produced artifacts (typically jars produced during the build itself) as by nature their checksums and signatures would always change.</p>
</div>
<div class="paragraph">
<p>With such a minimal configuration file, a project using <em>any</em> external dependency or plugin would immediately start failing because it doesn&#8217;t contain any checksum to verify.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:verification-scope"><a class="anchor" href="#sec:verification-scope"></a><a class="link" href="#sec:verification-scope">Scope of the dependency verification</a></h5>
<div class="paragraph">
<p>A dependency verification configuration is <em>global</em>: a single file is used to configure verification of the whole build.
In particular, the same file is used for both the (sub)projects and <code>buildSrc</code>.</p>
</div>
<div class="paragraph">
<p>If an included build is used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the configuration file of the <em>current</em> build is used for verification</p>
</li>
<li>
<p>so if the included build itself uses verification, its configuration is ignored in favor of the current one</p>
</li>
<li>
<p>which means that including a build works similarly to upgrading a dependency: it may require you to update your current verification metadata</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An easy way to get started is therefore to generate the minimal configuration for an existing build.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:verification-console-output"><a class="anchor" href="#sec:verification-console-output"></a><a class="link" href="#sec:verification-console-output">Configuring the console output</a></h5>
<div class="paragraph">
<p>By default, if dependency verification fails, Gradle will generate a small summary about the verification failure as well as an HTML report containing the full information about the failures.
If your environment prevents you from reading this HTML report file (for example if you run a build on CI and that it&#8217;s not easy to fetch the remote artifacts), Gradle provides a way to opt-in a verbose console report.
For this, you need to add this Gradle property to your <code>gradle.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org.gradle.dependency.verification.console=verbose</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:bootstrapping-verification"><a class="anchor" href="#sec:bootstrapping-verification"></a><a class="link" href="#sec:bootstrapping-verification">Bootstrapping dependency verification</a></h5>
<div class="paragraph">
<p>It&#8217;s worth mentioning that while Gradle can generate a dependency verification file for you, you should always check whatever Gradle generated for you because your build may <em>already</em> contain compromised dependencies without you knowing about it.
Please refer to the appropriate <a href="#sec:checksum-verification">checksum verification</a> or <a href="#sec:signature-verification">signature verification</a> section for more information.</p>
</div>
<div class="paragraph">
<p>If you plan on using <a href="#sec:signature-verification">signature verification</a>, please also read the <a href="#sec:bootstrapping-signature-verification">corresponding section</a> of the docs.</p>
</div>
<div class="paragraph">
<p>Bootstrapping can either be used to create a file from the beginning, or also to <em>update</em> an existing file with new information.
Therefore, it&#8217;s recommended to always use the same parameters once you started bootstrapping.</p>
</div>
<div class="paragraph">
<p>The dependency verification file can be generated with the following CLI instructions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle --write-verification-metadata sha256 help</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>write-verification-metadata</code> flag requires the list of <a href="#sec:checksum-verification">checksums</a> that you want to generate or <code>pgp</code> for <a href="#sec:signature-verification">signatures</a>.</p>
</div>
<div class="paragraph">
<p>Executing this command line will cause Gradle to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>resolve all <a href="#sec:resolvable-consumable-configs">resolvable configurations</a>, which includes:</p>
<div class="ulist">
<ul>
<li>
<p>configurations from the root project</p>
</li>
<li>
<p>configurations from all subprojects</p>
</li>
<li>
<p>configurations from <code>buildSrc</code></p>
</li>
<li>
<p>included builds configurations</p>
</li>
<li>
<p>configurations used by plugins</p>
</li>
</ul>
</div>
</li>
<li>
<p>download all artifacts discovered during resolution</p>
</li>
<li>
<p>compute the requested checksums and possibly verify signatures depending on what you asked</p>
</li>
<li>
<p>At the end of the build, generate the configuration file which will contain the inferred <em>verification metadata</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a consequence, the <code>verification-metadata.xml</code> file will be used in subsequent builds to verify dependencies.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>There are dependencies that Gradle <em>cannot</em> discover this way.
In particular, you will notice that the CLI above uses the <code>help</code> task.
If you don&#8217;t specify any task, Gradle will automatically run the default task and generate a configuration file at the end of the build too.</p>
</div>
<div class="paragraph">
<p>The difference is that Gradle <em>may</em> discover more dependencies and artifacts depending on the tasks you execute.
As a matter of fact, Gradle cannot automatically discover <em>detached configurations</em>, which are basically dependency graphs resolved as an internal implementation detail of the execution of a task: they are not, in particular, declared as an input of the task because they effectively depend on the configuration of the task at execution time.</p>
</div>
<div class="paragraph">
<p>A good way to start is just to use the simplest task, <code>help</code>, which will discover as much as possible, and if subsequent builds fail with a verification error, you can re-execute generation with the appropriate tasks to "discover" more dependencies.</p>
</div>
<div class="paragraph">
<p>Gradle won&#8217;t verify either checksums or signatures of plugins which use their own HTTP clients.
Only plugins which use the infrastructure provided by Gradle for performing requests will see their requests verified.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:verification-update"><a class="anchor" href="#sec:verification-update"></a><a class="link" href="#sec:verification-update">Using generation for incremental updates</a></h5>
<div class="paragraph">
<p>The verification file generated by Gradle has a strict ordering for all its content.
It also uses the information from the existing state to limit changes to the strict minimum.</p>
</div>
<div class="paragraph">
<p>This means that generation is actually a convenient tool for <em>updating</em> a verification file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Checksum entries generated by Gradle will have a clear <code>origin</code> that starts with "Generated by Gradle", which is a good indicator that an entry needs to be reviewed,</p>
</li>
<li>
<p>Entries added by hand will immediately be accounted for, and appear at the right location after writing the file,</p>
</li>
<li>
<p>The header comments of the file will be preserved, i.e. comments before the root XML node.
This allows you to have a license header or instructions on which tasks and which parameters to use for generating that file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the above benefits, it is really easy to account for new dependencies or dependency versions by simply generating the file again and reviewing the changes.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:verification-dry-mode"><a class="anchor" href="#sec:verification-dry-mode"></a><a class="link" href="#sec:verification-dry-mode">Using dry mode</a></h5>
<div class="paragraph">
<p>By default, bootstrapping is incremental, which means that if you run it multiple times, information is <em>added</em> to the file and in particular you can rely on your VCS to check the diffs.
There are situations where you would just want to <em>see</em> what the generated verification metadata file would look like without actually changing the existing one or overwriting it.</p>
</div>
<div class="paragraph">
<p>For this purpose, you can just add <code>--dry-run</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle --write-verification-metadata sha256 help --dry-run</pre>
</div>
</div>
<div class="paragraph">
<p>Then instead of generating the <code>verification-metadata.xml</code> file, a <em>new file</em> will be generated, called <code>verification-metadata.dryrun.xml</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Because <code>--dry-run</code> doesn&#8217;t execute tasks, this would be much faster, but it will miss any resolution happening at task execution time.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:disabling-metadata-verification"><a class="anchor" href="#sec:disabling-metadata-verification"></a><a class="link" href="#sec:disabling-metadata-verification">Disabling metadata verification</a></h5>
<div class="paragraph">
<p>By default, Gradle will not only verify artifacts (jars, &#8230;&#8203;) but also the metadata associated with those artifacts (typically POM files).
Verifying this ensures the maximum level of security: metadata files typically tell what transitive dependencies will be included, so a compromised metadata file may cause the introduction of undesired dependencies in the graph.
However, because all artifacts are verified, such artifacts would in general easily be discovered by you, because they would cause a checksum verification failure (checksums would be <em>missing</em> from verification metadata).
Because metadata verification can significantly increase the size of your configuration file, you may therefore want to disable verification of metadata.
If you understand the risks of doing so, set the <code>&lt;verify-metadata&gt;</code> flag to <code>false</code> in the configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification https://schema.gradle.org/dependency-verification/dependency-verification-1.3.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-metadata&gt;</span>false<span class="tag">&lt;/verify-metadata&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>false<span class="tag">&lt;/verify-signatures&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
    <span class="comment">&lt;!-- the rest of this file doesn't need to declare anything about metadata files --&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:checksum-verification"><a class="anchor" href="#sec:checksum-verification"></a><a class="link" href="#sec:checksum-verification">Verifying dependency checksums</a></h4>
<div class="paragraph">
<p>Checksum verification allows you to ensure the integrity of an artifact.
This is the simplest thing that Gradle can do for you to make sure that the artifacts you use are un-tampered.</p>
</div>
<div class="paragraph">
<p>Gradle supports MD5, SHA1, SHA-256 and SHA-512 checksums.
However, only SHA-256 and SHA-512 checksums are considered secure nowadays.</p>
</div>
<div class="sect4">
<h5 id="adding_the_checksum_for_an_artifact"><a class="anchor" href="#adding_the_checksum_for_an_artifact"></a><a class="link" href="#adding_the_checksum_for_an_artifact">Adding the checksum for an artifact</a></h5>
<div class="paragraph">
<p>External components are identified by GAV coordinates, then each of the artifacts by their file names.
To declare the checksums of an artifact, you need to add the corresponding section in the verification metadata file.
For example, to declare the checksum for <a href="https://pdfbox.apache.org">Apache PDFBox</a>.
The GAV coordinates are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>group <code>org.apache.pdfbox</code></p>
</li>
<li>
<p>name <code>pdfbox</code></p>
</li>
<li>
<p>version <code>2.0.17</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using this dependency will trigger the download of 2 different files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pdfbox-2.0.17.jar</code> which is the main artifact</p>
</li>
<li>
<p><code>pdfbox-2.0.17.pom</code> which is the metadata file associated with this artifact</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a consequence, you need to declare the checksums for both of them (unless you <a href="#sec:disabling-metadata-verification">disabled metadata verification</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification https://schema.gradle.org/dependency-verification/dependency-verification-1.3.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-metadata&gt;</span>true<span class="tag">&lt;/verify-metadata&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>false<span class="tag">&lt;/verify-signatures&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
   <span class="tag">&lt;components&gt;</span>
      <span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.pdfbox</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pdfbox</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0.17</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pdfbox-2.0.17.jar</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;sha512</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7e11e54a21c395d461e59552e88b0de0ebaf1bf9d9bcacadf17b240d9bbc29bf6beb8e36896c186fe405d287f5d517b02c89381aa0fcc5e0aa5814e44f0ab331</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">origin</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PDFBox Official site (https://pdfbox.apache.org/download.cgi)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/artifact&gt;</span>
         <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pdfbox-2.0.17.pom</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;sha512</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">82de436b38faf6121d8d2e71dda06e79296fc0f7bc7aba0766728c8d306fd1b0684b5379c18808ca724bf91707277eba81eb4fe19518e99e8f2a56459b79742f</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">origin</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Generated by Gradle</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/artifact&gt;</span>
      <span class="tag">&lt;/component&gt;</span>
   <span class="tag">&lt;/components&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="where_to_get_checksums_from"><a class="anchor" href="#where_to_get_checksums_from"></a><a class="link" href="#where_to_get_checksums_from">Where to get checksums from?</a></h5>
<div class="paragraph">
<p>In general, checksums are published alongside artifacts on public repositories.
However, if a dependency is compromised in a repository, it&#8217;s likely its checksum will be too, so it&#8217;s a good practice to get the checksum from a different place, usually the website of the library itself.</p>
</div>
<div class="paragraph">
<p>In fact, it&#8217;s a good security practice to publish the checksums of artifacts on a <em>different server</em> than the server where the artifacts themselves are hosted: it&#8217;s harder to compromise a library both on the repository <em>and</em> the official website.</p>
</div>
<div class="paragraph">
<p>In the example above, the checksum was published on the website for the JAR, but not the POM file.
This is why it&#8217;s usually easier to <a href="#sec:bootstrapping-verification">let Gradle generate the checksums</a> and verify by reviewing the generated file carefully.</p>
</div>
<div class="paragraph">
<p>In this example, not only could we check that the checksum was correct, but we could also find it on the official website, which is why we changed the value of the of <code>origin</code> attribute on the <code>sha512</code> element from <code>Generated by Gradle</code> to <code>PDFBox Official site</code>.
Changing the <code>origin</code> gives users a sense of how trustworthy your build it.</p>
</div>
<div class="paragraph">
<p>Interestingly, using <code>pdfbox</code> will require <em>much more</em> than those 2 artifacts, because it will also bring in transitive dependencies.
If the dependency verification file only included the checksums for the main artifacts you used, the build would fail with an error like this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution failed for task ':compileJava'.
&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact commons-logging-1.2.jar (commons-logging:commons-logging:1.2) in repository 'MavenRepo': checksum is missing from verification metadata.
    - On artifact commons-logging-1.2.pom (commons-logging:commons-logging:1.2) in repository 'MavenRepo': checksum is missing from verification metadata.</pre>
</div>
</div>
<div class="paragraph">
<p>What this indicates is that your build requires <code>commons-logging</code> when executing <code>compileJava</code>, however the verification file doesn&#8217;t contain enough information for Gradle to verify the integrity of the dependencies, meaning you need to add the required information to the verification metadata file.</p>
</div>
<div class="paragraph">
<p>See <a href="#sec:troubleshooting-verification">troubleshooting dependency verification</a> for more insights on what to do in this situation.</p>
</div>
</div>
<div class="sect4">
<h5 id="what_checksums_are_verified"><a class="anchor" href="#what_checksums_are_verified"></a><a class="link" href="#what_checksums_are_verified">What checksums are verified?</a></h5>
<div class="paragraph">
<p>If a dependency verification metadata file declares more than one checksum for a dependency, Gradle will verify <em>all of them</em> and fail if <em>any of them fails</em>.
For example, the following configuration would check both the <code>md5</code> and <code>sha1</code> checksums:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.pdfbox</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pdfbox</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0.17</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pdfbox-2.0.17.jar</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;md5</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c713a8e252d0add65e9282b151adf6b4</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">origin</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">official site</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;sha1</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b5c8dff799bd967c70ccae75e6972327ae640d35</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">origin</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">official site</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Additional check for this artifact</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/artifact&gt;</span>
<span class="tag">&lt;/component&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are multiple reasons why you&#8217;d like to do so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>an official site doesn&#8217;t publish <em>secure</em> checksums (SHA-256, SHA-512) but publishes multiple insecure ones (MD5, SHA1).
While it&#8217;s easy to fake a MD5 checksum and hard but possible to fake a SHA1 checksum, it&#8217;s harder to fake both of them for the same artifact.</p>
</li>
<li>
<p>you might want to add generated checksums to the list above</p>
</li>
<li>
<p>when <em>updating</em> dependency verification file with more secure checksums, you don&#8217;t want to accidentally erase checksums</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:signature-verification"><a class="anchor" href="#sec:signature-verification"></a><a class="link" href="#sec:signature-verification">Verifying dependency signatures</a></h4>
<div class="paragraph">
<p>In addition to <a href="#sec:checksum-verification">checksums</a>, Gradle supports verification of signatures.
Signatures are used to assess the <em>provenance</em> of a dependency (it tells who signed the artifacts, which usually corresponds to who produced it).</p>
</div>
<div class="paragraph">
<p>As enabling signature verification usually means a higher level of security, you might want to replace checksum verification with signature verification.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Signatures <em>can</em> also be used to assess the integrity of a dependency similarly to checksums.
Signatures are signatures of the <em>hash</em> of artifacts, not artifacts themselves.
This means that if the signature is done on an <em>unsafe hash</em> (even SHA1), then you&#8217;re not correctly assessing the <em>integrity</em> of a file.
For this reason, if you care about both, you need to add both signatures <em>and</em> checksums to your verification metadata.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle only supports verification of signatures published on remote repositories as ASCII-armored PGP files</p>
</li>
<li>
<p>Not all artifacts are published with signatures</p>
</li>
<li>
<p>A good signature doesn&#8217;t mean that the signatory was legit</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a consequence, signature verification will often be used alongside checksum verification.</p>
</div>
<div class="openblock">
<div class="title">About expired keys</div>
<div class="content">
<div class="paragraph">
<p>It&#8217;s very common to find artifacts which are signed with an expired key.
This is not a problem for <em>verification</em>: key expiry is mostly used to avoid signing with a stolen key.
If an artifact was signed before expiry, it&#8217;s still valid.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="enabling_signature_verification"><a class="anchor" href="#enabling_signature_verification"></a><a class="link" href="#enabling_signature_verification">Enabling signature verification</a></h5>
<div class="paragraph">
<p>Because verifying signatures is more expensive (both I/O and CPU wise) and harder to check manually, it&#8217;s not enabled by default.</p>
</div>
<div class="paragraph">
<p>Enabling it requires you to change the configuration option in the <code>verification-metadata.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification https://schema.gradle.org/dependency-verification/dependency-verification-1.3.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>true<span class="tag">&lt;/verify-signatures&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:understanding-signature-verification"><a class="anchor" href="#sec:understanding-signature-verification"></a><a class="link" href="#sec:understanding-signature-verification">Understanding signature verification</a></h4>
<div class="paragraph">
<p>Once signature verification is enabled, for each artifact, Gradle will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>try to download the corresponding <code>.asc</code> file</p>
</li>
<li>
<p>if it&#8217;s present</p>
<div class="ulist">
<ul>
<li>
<p>automatically download the keys required to perform verification of the signature</p>
</li>
<li>
<p>verify the artifact using the downloaded public keys</p>
</li>
<li>
<p>if signature verification passes, perform additional requested checksum verification</p>
</li>
</ul>
</div>
</li>
<li>
<p>if it&#8217;s absent, fallback to checksum verification</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>That is to say that Gradle&#8217;s verification mechanism is much stronger if signature verification is enabled than just with checksum verification.
In particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if an artifact is signed with multiple keys, all of them must pass validation or the build will fail</p>
</li>
<li>
<p>if an artifact passes verification, any additional checksum configured for the artifact <em>will also be checked</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, it&#8217;s not because an artifact passes signature verification that you can trust it: you need to <em>trust the keys</em>.</p>
</div>
<div class="paragraph">
<p>In practice, it means you need to list the keys that you trust for each artifact, which is done by adding a <code>pgp</code> entry instead of a <code>sha1</code> for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.javaparser</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javaparser-core</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.6.11</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javaparser-core-3.6.11.jar</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;pgp</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8756c4f765c9ac3cb6b85d62379ce192d401ab61</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/artifact&gt;</span>
<span class="tag">&lt;/component&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>For the <code>pgp</code> and <code>trusted-key</code> elements, Gradle <em>requires</em> full fingerprint IDs (e.g. <code>b801e2f8ef035068ec1139cc29579f18fa8fd93b</code> instead of a long ID <code>29579f18fa8fd93b</code>).
This minimizes the chance of a <a href="https://en.wikipedia.org/wiki/Collision_attack">collision attack</a>.</p>
</div>
<div class="paragraph">
<p>At the time, <a href="https://www.rfc-editor.org/rfc/rfc4880#section-12.2">V4 key fingerprints</a> are of 160-bit (40 characters) length. We accept longer keys to be future-proof in case a longer key fingerprint is introduced.</p>
</div>
<div class="paragraph">
<p>In <code>ignore-key</code> elements, either fingerprints or long (64-bit) IDs can be used. A shorter ID can only result in a bigger range of exclusion, therefore, it&#8217;s safe to use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This effectively means that you trust <code>com.github.javaparser:javaparser-core:3.6.11</code> if it&#8217;s signed with the key <code>8756c4f765c9ac3cb6b85d62379ce192d401ab61</code>.</p>
</div>
<div class="paragraph">
<p>Without this, the build would fail with this error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact javaparser-core-3.6.11.jar (com.github.javaparser:javaparser-core:3.6.11) in repository 'MavenRepo': Artifact was signed with key '8756c4f765c9ac3cb6b85d62379ce192d401ab61' (Bintray (by JFrog) &lt;****&gt;) and passed verification but the key isn't in your trusted keys list.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The key IDs that Gradle shows in error messages are the key IDs found in the signature file it tries to verify.
It doesn&#8217;t mean that it&#8217;s necessarily the keys that you should trust.
In particular, if the signature is correct but done by a malicious entity, Gradle wouldn&#8217;t tell you.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sec:trusting-keys-globally"><a class="anchor" href="#sec:trusting-keys-globally"></a><a class="link" href="#sec:trusting-keys-globally">Trusting keys globally</a></h5>
<div class="paragraph">
<p>Signature verification has the advantage that it can make the configuration of dependency verification easier by not having to explicitly list all artifacts like for checksum verification only.
In fact, it&#8217;s common that the same key can be used to sign several artifacts.
If this is the case, you can move the trusted key from the artifact level to the global configuration block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification https://schema.gradle.org/dependency-verification/dependency-verification-1.3.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-metadata&gt;</span>true<span class="tag">&lt;/verify-metadata&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>true<span class="tag">&lt;/verify-signatures&gt;</span>
      <span class="tag">&lt;trusted-keys&gt;</span>
         <span class="tag">&lt;trusted-key</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8756c4f765c9ac3cb6b85d62379ce192d401ab61</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.javaparser</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/trusted-keys&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
   <span class="tag">&lt;components</span><span class="tag">/&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration above means that for any artifact belonging to the group <code>com.github.javaparser</code>, we trust it if it&#8217;s signed with the <code>8756c4f765c9ac3cb6b85d62379ce192d401ab61</code> fingerprint.</p>
</div>
<div class="paragraph">
<p>The <code>trusted-key</code> element works similarly to the <a href="#sec:trusting-artifacts">trusted-artifact</a> element:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group</code>, the group of the artifact to trust</p>
</li>
<li>
<p><code>name</code>, the name of the artifact to trust</p>
</li>
<li>
<p><code>version</code>, the version of the artifact to trust</p>
</li>
<li>
<p><code>file</code>, the name of the artifact <em>file</em> to trust</p>
</li>
<li>
<p><code>regex</code>, a boolean saying if the <code>group</code>, <code>name</code>, <code>version</code> and <code>file</code> attributes need to be interpreted as regular expressions (defaults to <code>false</code>)</p>
</li>
</ul>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>You should be careful when trusting a key globally.</p>
</div>
<div class="paragraph">
<p>Try to limit it to the appropriate groups or artifacts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a valid key may have been used to sign artifact <code>A</code> which you trust</p>
</li>
<li>
<p>later on, the key is stolen and used to sign artifact <code>B</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It means you can trust the key <code>A</code> for the first artifact, probably only up to the released version before the key was stolen, but not for <code>B</code>.</p>
</div>
<div class="paragraph">
<p>Remember that anybody can put an arbitrary name when generating a PGP key, so never trust the key solely based on the key name.
Verify if the key is listed at the official site.
For example, Apache projects typically provide a KEYS.txt file that you can trust.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:ignoring-keys"><a class="anchor" href="#sec:ignoring-keys"></a><a class="link" href="#sec:ignoring-keys">Specifying key servers and ignoring keys</a></h5>
<div class="paragraph">
<p>Gradle will automatically download the public keys required to verify a signature.
For this it uses a list of well known and trusted key servers (the list may change between Gradle versions, please refer to the implementation to figure out what servers are used by default).</p>
</div>
<div class="paragraph">
<p>You can explicitly set the list of key servers that you want to use by adding them to the configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification https://schema.gradle.org/dependency-verification/dependency-verification-1.3.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-metadata&gt;</span>true<span class="tag">&lt;/verify-metadata&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>true<span class="tag">&lt;/verify-signatures&gt;</span>
      <span class="tag">&lt;key-servers&gt;</span>
         <span class="tag">&lt;key-server</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hkp://my-key-server.org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;key-server</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://my-other-key-server.org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/key-servers&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Despite this, it&#8217;s possible that a key is not available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>because it wasn&#8217;t published to a public key server</p>
</li>
<li>
<p>because it was lost</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this case, you can ignore a key in the configuration block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification https://schema.gradle.org/dependency-verification/dependency-verification-1.3.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-metadata&gt;</span>true<span class="tag">&lt;/verify-metadata&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>true<span class="tag">&lt;/verify-signatures&gt;</span>
      <span class="tag">&lt;ignored-keys&gt;</span>
         <span class="tag">&lt;ignored-key</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">abcdef1234567890</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Key is not available in any key server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/ignored-keys&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As soon as a key is ignored, it will not be used for verification, even if the signature file mentions it.
However, if the signature cannot be verified with at least one other key, Gradle will mandate that you provide a checksum.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If Gradle cannot download a key while bootstrapping, it will mark it as ignored.
If you can find the key but Gradle does not, you can <a href="#sec:add-manual-keyring">manually add it</a> to the keyring file.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:local-keyring"><a class="anchor" href="#sec:local-keyring"></a><a class="link" href="#sec:local-keyring">Exporting keys for faster verification</a></h5>
<div class="paragraph">
<p>Gradle automatically downloads the required keys but this operation can be quite slow and requires everyone to download the keys.
To avoid this, Gradle offers the ability to use a local keyring file containing the required public keys.
Note that only public key packets and a single userId per key are stored and used.
All other information (user attributes, signatures, etc.) is stripped from downloaded or exported keys.</p>
</div>
<div class="paragraph">
<p>Gradle supports 2 different file formats for keyrings: a binary format (<code>.gpg</code> file) and a plain text format (<code>.keys</code>), also known as ASCII-armored format.</p>
</div>
<div class="paragraph">
<p>There are pros and cons for each of the formats: the binary format is more compact and can be updated directly via GPG commands, but is completely opaque (binary).
On the opposite, the ASCII-armored format is human-readable, can be easily updated by hand and makes it easier to do code reviews thanks to readable diffs.</p>
</div>
<div class="paragraph">
<p>You can configure which file type would be used by adding the <code>keyring-format</code> configuration option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification https://schema.gradle.org/dependency-verification/dependency-verification-1.3.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-metadata&gt;</span>true<span class="tag">&lt;/verify-metadata&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>true<span class="tag">&lt;/verify-signatures&gt;</span>
      <span class="tag">&lt;keyring-format&gt;</span>armored<span class="tag">&lt;/keyring-format&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Available options for keyring format are <code>armored</code> and <code>binary</code>.</p>
</div>
<div class="paragraph">
<p>Without <code>keyring-format</code>, if the <code>gradle/verification-keyring.gpg</code> or <code>gradle/verification-keyring.keys</code> file is present, Gradle will search for keys there in priority.
The plain text file will be ignored if there&#8217;s already a <code>.gpg</code> file (the binary version takes precedence).</p>
</div>
<div class="paragraph">
<p>You can <em>ask Gradle to export all keys it used for verification of this build to the keyring</em> during bootstrapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew --write-verification-metadata pgp,sha256 --export-keys</pre>
</div>
</div>
<div class="paragraph">
<p>Unless <code>keyring-format</code> is specified, this command will generate <strong>both</strong> the binary version and the ASCII-armored file.
Use this option to choose the preferred format.
You should only pick one for your project.</p>
</div>
<div class="paragraph">
<p>It&#8217;s a good idea to commit this file to VCS (as long as you trust your VCS).
If you use git and use the binary version, make sure to make it treat this file as binary, by adding this to your <code>.gitattributes</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>*.gpg           binary</pre>
</div>
</div>
<div class="paragraph">
<p>You can also ask Gradle to export all trusted keys without updating the verification metadata file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew --export-keys</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This command will not report verification errors, only export keys.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:bootstrapping-signature-verification"><a class="anchor" href="#sec:bootstrapping-signature-verification"></a><a class="link" href="#sec:bootstrapping-signature-verification">Bootstrapping and signature verification</a></h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Signature verification bootstrapping takes an <em>optimistic point of view</em> that signature verification is <em>enough</em>.
Therefore, if you also care about <em>integrity</em>, you <strong>must</strong> first bootstrap using checksum verification, <em>then</em> with signature verification.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Similarly to bootstrapping for checksums, Gradle provides a convenience for bootstrapping a configuration file with signature verification enabled.
For this, just add the <code>pgp</code> option to the list of verifications to generate.
However, because there might be verification failures, missing keys or missing signature files, you <strong>must</strong> provide a fallback checksum verification algorithm:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew --write-verification-metadata pgp,sha256</pre>
</div>
</div>
<div class="paragraph">
<p>this means that Gradle will verify the signatures and fallback to SHA-256 checksums when there&#8217;s a problem.</p>
</div>
<div class="paragraph">
<p>When bootstrapping, Gradle performs <em>optimistic verification</em> and therefore assumes a sane build environment.
It will therefore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>automatically add the trusted keys as soon as verification passes</p>
</li>
<li>
<p>automatically add ignored keys for keys which couldn&#8217;t be downloaded from public key servers.
See <a href="#sec:add-manual-keyring">here</a> how to manually add keys if needed</p>
</li>
<li>
<p>automatically generate checksums for artifacts without signatures or ignored keys</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If, for some reason, verification fails during the generation, Gradle will automatically generate an ignored key entry but warn you that you must absolutely check what happens.</p>
</div>
<div class="paragraph">
<p>This situation is common as explained for <a href="#sec:trusting-several-checksums">this section</a>: a typical case is when the POM file for a dependency differs from one repository to the other (often in a non-meaningful way).</p>
</div>
<div class="paragraph">
<p>In addition, Gradle will try to group keys automatically and generate the <code>trusted-keys</code> block which reduced the configuration file size as much as possible.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:local-keyring-only"><a class="anchor" href="#sec:local-keyring-only"></a><a class="link" href="#sec:local-keyring-only">Forcing use of local keyrings only</a></h4>
<div class="paragraph">
<p>The local keyring files (<code>.gpg</code> or <code>.keys</code>) can be used to avoid reaching out to key servers whenever a key is required to verify an artifact.
However, it may be that the local keyring doesn&#8217;t contain a key, in which case Gradle would use the key servers to fetch the missing key.
If the local keyring file isn&#8217;t regularly updated, using <a href="#sec:local-keyring">key export</a>, then it may be that your CI builds, for example, would reach out to key servers too often (especially if you use disposable containers for builds).</p>
</div>
<div class="paragraph">
<p>To avoid this, Gradle offers the ability to disallow use of key servers altogether: only the local keyring file would be used, and if a key is missing from this file, the build will fail.</p>
</div>
<div class="paragraph">
<p>To enable this mode, you need to disable key servers in the configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification https://schema.gradle.org/dependency-verification/dependency-verification-1.3.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;key-servers</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      ...
   <span class="tag">&lt;/configuration&gt;</span>
   ...
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are asking Gradle to <a href="#sec:bootstrapping-verification">generate a verification metadata file</a> and that an existing verification metadata file sets <code>enabled</code> to <code>false</code>, then this flag will be ignored, so that potentially missing keys are downloaded.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:disabling-verification"><a class="anchor" href="#sec:disabling-verification"></a><a class="link" href="#sec:disabling-verification">Disabling verification or making it lenient</a></h4>
<div class="paragraph">
<p>Dependency verification can be expensive, or sometimes verification could get in the way of day to day development (because of frequent dependency upgrades, for example).</p>
</div>
<div class="paragraph">
<p>Alternatively, you might want to enable verification on CI servers but not on local machines.</p>
</div>
<div class="paragraph">
<p>Gradle actually provides 3 different verification modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>strict</code>, which is the default.
Verification fails <em>as early as possible</em>, in order to avoid the use of compromised dependencies during the build.</p>
</li>
<li>
<p><code>lenient</code>, which will run the build even if there are verification failures.
The verification errors will be displayed during the build without causing a build failure.</p>
</li>
<li>
<p><code>off</code> when verification is totally ignored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All those modes can be activated on the CLI using the <code>--dependency-verification</code> flag, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew --dependency-verification lenient build</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can set the <code>org.gradle.dependency.verification</code> system property, either on the CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew -Dorg.gradle.dependency.verification=lenient build</pre>
</div>
</div>
<div class="paragraph">
<p>or in a <code>gradle.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org.gradle.dependency.verification=lenient</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sub:disabling-specific-verification"><a class="anchor" href="#sub:disabling-specific-verification"></a><a class="link" href="#sub:disabling-specific-verification">Disabling dependency verification for some configurations only</a></h4>
<div class="paragraph">
<p>In order to provide the strongest security level possible, dependency verification is enabled globally.
This will ensure, for example, that you trust all the plugins you use.
However, the plugins themselves may need to resolve additional dependencies that it doesn&#8217;t make sense to ask the user to accept.
For this purpose, Gradle provides an API which allows <em>disabling dependency verification on some specific configurations</em>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Disabling dependency verification, if you care about security, is not a good idea.
This API mostly exist for cases where it doesn&#8217;t make sense to check dependencies.
However, in order to be on the safe side, Gradle will systematically print a warning whenever verification has been disabled for a specific configuration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an example, a plugin may want to check if there are <em>newer</em> versions of a library available and list those versions.
It doesn&#8217;t make sense, in this context, to ask the user to put the checksums of the POM files of the newer releases because by definition, they don&#8217;t know about them.
So the plugin might need to run its code <em>independently of the dependency verification configuration</em>.</p>
</div>
<div class="paragraph">
<p>To do this, you need to call the <code>ResolutionStrategy#disableDependencyVerification</code> method:</p>
</div>
<div id="ex-disabling-dependency-verification" class="exampleblock">
<div class="title">Example 142. <a href="#ex-disabling-dependency-verification">Disabling dependency verification</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    &quot;myPluginClasspath&quot; {
        resolutionStrategy {
            disableDependencyVerification()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    myPluginClasspath {
        resolutionStrategy {
            disableDependencyVerification()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s also possible to disable verification on detached configurations like in the following example:</p>
</div>
<div id="ex-disabling-dependency-verification" class="exampleblock">
<div class="title">Example 143. <a href="#ex-disabling-dependency-verification">Disabling dependency verification</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;checkDetachedDependencies&quot;) {
    val detachedConf: FileCollection = configurations.detachedConfiguration(dependencies.create(&quot;org.apache.commons:commons-lang3:3.3.1&quot;)).apply {
        resolutionStrategy.disableDependencyVerification()
    }
    doLast {
        println(detachedConf.files)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">checkDetachedDependencies</span><span class="delimiter">&quot;</span></span>) {
    <span class="keyword">def</span> detachedConf = configurations.detachedConfiguration(dependencies.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons:commons-lang3:3.3.1</span><span class="delimiter">&quot;</span></span>))
    detachedConf.resolutionStrategy.disableDependencyVerification()
    doLast {
        println(detachedConf.files)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:trusting-artifacts"><a class="anchor" href="#sec:trusting-artifacts"></a><a class="link" href="#sec:trusting-artifacts">Trusting some particular artifacts</a></h4>
<div class="paragraph">
<p>You might want to trust some artifacts more than others.
For example, it&#8217;s legitimate to think that artifacts produced in your company and found in your internal repository only are safe, but you want to check every external component.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This is a typical <em>company policy</em>.
In practice, <strong>nothing</strong> prevents your internal repository from being compromised, so it&#8217;s a good idea to check your internal artifacts too!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For this purpose, Gradle offers a way to automatically trust some artifacts.
You can trust all artifacts in a group by adding this to your configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification https://schema.gradle.org/dependency-verification/dependency-verification-1.3.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;trusted-artifacts&gt;</span>
         <span class="tag">&lt;trust</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">We trust mycompany artifacts</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/trusted-artifacts&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that all components which group is <code>com.mycompany</code> will automatically be trusted.
Trusted means that Gradle will not perform any verification whatsoever.</p>
</div>
<div class="paragraph">
<p>The <code>trust</code> element accepts those attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group</code>, the group of the artifact to trust</p>
</li>
<li>
<p><code>name</code>, the name of the artifact to trust</p>
</li>
<li>
<p><code>version</code>, the version of the artifact to trust</p>
</li>
<li>
<p><code>file</code>, the name of the artifact <em>file</em> to trust</p>
</li>
<li>
<p><code>regex</code>, a boolean saying if the <code>group</code>, <code>name</code>, <code>version</code> and <code>file</code> attributes need to be interpreted as regular expressions (defaults to <code>false</code>)</p>
</li>
<li>
<p><code>reason</code>, an optional reason, why matched artifacts are trusted</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the example above it means that the trusted artifacts would be artifacts in <code>com.mycompany</code> but not <code>com.mycompany.other</code>.
To trust all artifacts in <code>com.mycompany</code> and all subgroups, you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://schema.gradle.org/dependency-verification https://schema.gradle.org/dependency-verification/dependency-verification-1.3.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;trusted-artifacts&gt;</span>
         <span class="tag">&lt;trust</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">^com[.]mycompany($|([.].*))</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">regex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">We trust all mycompany artifacts</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/trusted-artifacts&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:trusting-several-checksums"><a class="anchor" href="#sec:trusting-several-checksums"></a><a class="link" href="#sec:trusting-several-checksums">Trusting multiple checksums for an artifact</a></h4>
<div class="paragraph">
<p>It&#8217;s quite common to have <em>different checksums for the same artifact</em> in the wild.
How is that possible?
Despite progress, it&#8217;s often the case that developers publish, for example, to Maven Central and another repository separately, using different builds.
In general, this is not a problem but sometimes it means that the metadata files would be different (different timestamps, additional whitespaces, &#8230;&#8203;).
Add to this that your build may use several repositories or repository mirrors and it makes it quite likely that a single build can "see" different metadata files for the same component!
In general, it&#8217;s not malicious (but you <strong>must</strong> verify that the artifact is actually correct), so Gradle lets you declare the additional artifact checksums.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">      <span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">apache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">13</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">apache-13.pom</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;sha256</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2fafa38abefe1b40283016f506ba9e844bfcf18713497284264166a5dbf4b95e</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
               <span class="tag">&lt;also-trust</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ff513db0361fd41237bef4784968bc15aae478d4ec0a9496f811072ccaf3841d</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/sha256&gt;</span>
         <span class="tag">&lt;/artifact&gt;</span>
      <span class="tag">&lt;/component&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can have as many <code>also-trust</code> entries as needed, but in general you shouldn&#8217;t have more than 2.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:skipping-javadocs"><a class="anchor" href="#sec:skipping-javadocs"></a><a class="link" href="#sec:skipping-javadocs">Skipping Javadocs and sources</a></h4>
<div class="paragraph">
<p>By default Gradle will verify <em>all</em> downloaded artifacts, which includes Javadocs and sources.
In general this is not a problem but you might face an issue with IDEs which automatically try to download them during import: if you didn&#8217;t set the checksums for those too, importing would fail.</p>
</div>
<div class="paragraph">
<p>To avoid this, you can configure Gradle to trust automatically all javadocs/sources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;trusted-artifacts&gt;</span>
   <span class="tag">&lt;trust</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">.*-javadoc[.]jar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">regex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;trust</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">.*-sources[.]jar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">regex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/trusted-artifacts&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:add-manual-keyring"><a class="anchor" href="#sec:add-manual-keyring"></a><a class="link" href="#sec:add-manual-keyring">Adding keys manually to the keyring</a></h4>
<div class="sect4">
<h5 id="sec:add-ascii-keyring"><a class="anchor" href="#sec:add-ascii-keyring"></a><a class="link" href="#sec:add-ascii-keyring">Adding keys to the ASCII-armored keyring</a></h5>
<div class="paragraph">
<p>The added key must be ASCII-armored formatted and can be simply added at the end of the file.
If you already downloaded the key in the right format, you can simply append it to the file.</p>
</div>
<div class="paragraph">
<p>Or you can amend an existing KEYS file by issuing the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gpg --no-default-keyring --keyring /tmp/keyring.gpg --recv-keys 8756c4f765c9ac3cb6b85d62379ce192d401ab61

gpg: keybox '/tmp/keyring.gpg' created
gpg: key 379CE192D401AB61: public key &quot;Bintray (by JFrog) &lt;****&gt;&quot; imported
gpg: Total number processed: 1
gpg:               imported: 1

# Write its ASCII-armored version
$ gpg --keyring /tmp/keyring.gpg --export --armor 8756c4f765c9ac3cb6b85d62379ce192d401ab61 &gt; gradle/verification-keyring.keys</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once done, make sure to run <a href="#sec:verification-update">the generation command again</a> so that the key is processed by Gradle.
This will do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a standard header to the key</p>
</li>
<li>
<p>Rewrite the key using Gradle&#8217;s own format, which trims the key to the bare minimum</p>
</li>
<li>
<p>Move the key to its sorted location, keeping the file reproducible</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:add-binary-keyring"><a class="anchor" href="#sec:add-binary-keyring"></a><a class="link" href="#sec:add-binary-keyring">Adding keys to the binary keyring</a></h5>
<div class="paragraph">
<p>You can add keys to the binary version using GPG, for example issuing the following commands (syntax may depend on the tool you use):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gpg --no-default-keyring --keyring gradle/verification-keyring.gpg --recv-keys 8756c4f765c9ac3cb6b85d62379ce192d401ab61

gpg: keybox 'gradle/verification-keyring.gpg' created
gpg: key 379CE192D401AB61: public key &quot;Bintray (by JFrog) &lt;****&gt;&quot; imported
gpg: Total number processed: 1
gpg:               imported: 1

$ gpg --no-default-keyring --keyring gradle/verification-keyring.gpg --recv-keys 6f538074ccebf35f28af9b066a0975f8b1127b83

gpg: key 0729A0AFF8999A87: public key &quot;Kotlin Release &lt;****&gt;&quot; imported
gpg: Total number processed: 1
gpg:               imported: 1</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:dealing-verification-failure"><a class="anchor" href="#sec:dealing-verification-failure"></a><a class="link" href="#sec:dealing-verification-failure">Dealing with a verification failure</a></h4>
<div class="paragraph">
<p>Dependency verification can fail in different ways, this section explains how you should deal with the various cases.</p>
</div>
<div class="sect4">
<h5 id="missing_verification_metadata"><a class="anchor" href="#missing_verification_metadata"></a><a class="link" href="#missing_verification_metadata">Missing verification metadata</a></h5>
<div class="paragraph">
<p>The simplest failure you can have is when verification metadata is missing from the dependency verification file.
This is the case for example if you use <a href="#sec:checksum-verification">checksum verification</a>, then you update a dependency and new versions of the dependency (and potentially its transitive dependencies) are brought in.</p>
</div>
<div class="paragraph">
<p>Gradle will tell you what metadata is missing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution failed for task ':compileJava'.
&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact commons-logging-1.2.jar (commons-logging:commons-logging:1.2) in repository 'MavenRepo': checksum is missing from verification metadata.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>the missing module group is <code>commons-logging</code>, it&#8217;s artifact name is <code>commons-logging</code> and its version is <code>1.2</code>.
The corresponding artifact is <code>commons-logging-1.2.jar</code> so you need to add the following entry to the verification file:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-logging</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-logging</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-logging-1.2.jar</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;sha256</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">daddea1ea0be0f56978ab3006b8ac92834afeefbd9b7e4e6316fca57df0fa636</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">origin</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">official distribution</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/artifact&gt;</span>
<span class="tag">&lt;/component&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can ask Gradle to generate the missing information by using the <a href="#sec:bootstrapping-verification">bootstrapping mechanism</a>: existing information in the metadata file will be preserved, Gradle will only add the missing verification metadata.</p>
</div>
</div>
<div class="sect4">
<h5 id="incorrect_checksums"><a class="anchor" href="#incorrect_checksums"></a><a class="link" href="#incorrect_checksums">Incorrect checksums</a></h5>
<div class="paragraph">
<p>A more problematic issue is when the actual checksum verification fails:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution failed for task ':compileJava'.
&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact commons-logging-1.2.jar (commons-logging:commons-logging:1.2) in repository 'MavenRepo': expected a 'sha256' checksum of '91f7a33096ea69bac2cbaf6d01feb934cac002c48d8c8cfa9c240b40f1ec21df' but was 'daddea1ea0be0f56978ab3006b8ac92834afeefbd9b7e4e6316fca57df0fa636'</pre>
</div>
</div>
<div class="paragraph">
<p>This time, Gradle tells you what dependency is at fault, what was the expected checksum (the one you declared in the verification metadata file) and the one which was actually computed during verification.</p>
</div>
<div class="paragraph">
<p>Such a failure indicates that a <strong>dependency may have been compromised</strong>.
At this stage, you <strong>must</strong> perform manual verification and check what happens.
Several things can happen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a dependency was tampered in the local dependency cache of Gradle.
This is usually harmless: erase the file from the cache and Gradle would redownload the dependency.</p>
</li>
<li>
<p>a dependency is available in multiple sources with slightly different binaries (additional whitespace, &#8230;&#8203;)</p>
<div class="ulist">
<ul>
<li>
<p>please inform the maintainers of the library that they have such an issue</p>
</li>
<li>
<p>you can use <a href="#sec:trusting-several-checksums"><code>also-trust</code></a> to accept the additional checksums</p>
</li>
</ul>
</div>
</li>
<li>
<p>the dependency was compromised</p>
<div class="ulist">
<ul>
<li>
<p>immediately inform the maintainers of the library</p>
</li>
<li>
<p>notify the repository maintainers of the compromised library</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that a variation of a compromised library is often <em>name squatting</em>, when a hacker would use GAV coordinates which <em>look legit</em> but are actually different by one character, or <em>repository shadowing</em>, when a dependency with the official GAV coordinates is published in a malicious repository which comes first in your build.</p>
</div>
</div>
<div class="sect4">
<h5 id="untrusted_signatures"><a class="anchor" href="#untrusted_signatures"></a><a class="link" href="#untrusted_signatures">Untrusted signatures</a></h5>
<div class="paragraph">
<p>If you have signature verification enabled, Gradle will perform verification of the signatures but will not trust them automatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact javaparser-core-3.6.11.jar (com.github.javaparser:javaparser-core:3.6.11) in repository 'MavenRepo': Artifact was signed with key '379ce192d401ab61' (Bintray (by JFrog) &lt;****&gt;) and passed verification but the key isn't in your trusted keys list.</pre>
</div>
</div>
<div class="paragraph">
<p>In this case it means you need to check yourself if the key that was used for verification (and therefore the signature) can be trusted, in which case refer to <a href="#sec:understanding-signature-verification">this section of the documentation</a> to figure out how to declare trusted keys.</p>
</div>
</div>
<div class="sect4">
<h5 id="failed_signature_verification"><a class="anchor" href="#failed_signature_verification"></a><a class="link" href="#failed_signature_verification">Failed signature verification</a></h5>
<div class="paragraph">
<p>If Gradle fails to verify a signature, you will need to take action and verify artifacts manually because this <strong>may indicate a compromised dependency</strong>.</p>
</div>
<div class="paragraph">
<p>If such a thing happens, Gradle will fail with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact javaparser-core-3.6.11.jar (com.github.javaparser:javaparser-core:3.6.11) in repository 'MavenRepo': Artifact was signed with key '379ce192d401ab61' (Bintray (by JFrog) &lt;****&gt;) but signature didn't match</pre>
</div>
</div>
<div class="paragraph">
<p>There are several options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>signature was wrong in the first place, which happens frequently with <a href="#sec:trusting-several-checksums">dependencies published on different repositories</a>.</p>
</li>
<li>
<p>the signature is correct but the artifact has been compromised (either in the local dependency cache or remotely)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The right approach here is to go to the official site of the dependency and see if they publish signatures for their artifacts.
If they do, verify that the signature that Gradle downloaded matches the one published.</p>
</div>
<div class="paragraph">
<p>If you have <a href="#sec:manual-checking-dependency">checked that the dependency is <em>not</em> compromised</a> and that it&#8217;s "only" the signature which is wrong, you should declare an <em>artifact level key exclusion</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">   <span class="tag">&lt;components&gt;</span>
       <span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.javaparser</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javaparser-core</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.6.11</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javaparser-core-3.6.11.pom</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
             <span class="tag">&lt;ignored-keys&gt;</span>
                <span class="tag">&lt;ignored-key</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">379ce192d401ab61</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">internal repo has corrupted POM</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
             <span class="tag">&lt;/ignored-keys&gt;</span>
          <span class="tag">&lt;/artifact&gt;</span>
       <span class="tag">&lt;/component&gt;</span>
   <span class="tag">&lt;/components&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if you only do so, Gradle will still fail because all keys for this artifact will be ignored and you didn&#8217;t provide a checksum:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">   <span class="tag">&lt;components&gt;</span>
       <span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.javaparser</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javaparser-core</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.6.11</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javaparser-core-3.6.11.pom</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
             <span class="tag">&lt;ignored-keys&gt;</span>
                <span class="tag">&lt;ignored-key</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">379ce192d401ab61</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">internal repo has corrupted POM</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
             <span class="tag">&lt;/ignored-keys&gt;</span>
             <span class="tag">&lt;sha256</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a2023504cfd611332177f96358b6f6db26e43d96e8ef4cff59b0f5a2bee3c1e1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/artifact&gt;</span>
       <span class="tag">&lt;/component&gt;</span>
   <span class="tag">&lt;/components&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:manual-checking-dependency"><a class="anchor" href="#sec:manual-checking-dependency"></a><a class="link" href="#sec:manual-checking-dependency">Manual verification of a dependency</a></h5>
<div class="paragraph">
<p>You will likely face a dependency verification failure (either checksum verification or signature verification) and will need to figure out if the dependency has been compromised or not.</p>
</div>
<div class="paragraph">
<p>In this section we give <em>an example</em> how you can manually check if a dependency was compromised.</p>
</div>
<div class="paragraph">
<p>For this we will take this example failure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Dependency verification failed for configuration ':compileClasspath':
- On artifact j2objc-annotations-1.1.jar (com.google.j2objc:j2objc-annotations:1.1) in repository 'MyCompany Mirror': Artifact was signed with key '29579f18fa8fd93b' but signature didn't match</pre>
</div>
</div>
<div class="paragraph">
<p>This error message gives us the GAV coordinates of the problematic dependency, as well as an indication of where the dependency was fetched from.
Here, the dependency comes from <code>MyCompany Mirror</code>, which is a repository declared in our build.</p>
</div>
<div class="paragraph">
<p>The first thing to do is therefore to download the artifact and its signature manually from the mirror:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://my-company-mirror.com/repo/com/google/j2objc/j2objc-annotations/1.1/j2objc-annotations-1.1.jar --output j2objc-annotations-1.1.jar
$ curl https://my-company-mirror.com/repo/com/google/j2objc/j2objc-annotations/1.1/j2objc-annotations-1.1.jar.asc --output j2objc-annotations-1.1.jar.asc</pre>
</div>
</div>
<div class="paragraph">
<p>Then we can use the key information provided in the error message to import the key locally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gpg --recv-keys B801E2F8EF035068EC1139CC29579F18FA8FD93B</pre>
</div>
</div>
<div class="paragraph">
<p>And perform verification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gpg --verify j2objc-annotations-1.1.jar.asc
gpg: assuming signed data in 'j2objc-annotations-1.1.jar'
gpg: Signature made Thu 19 Jan 2017 12:06:51 AM CET
gpg:                using RSA key 29579F18FA8FD93B
gpg: BAD signature from "Tom Ball &lt;****&gt;" [unknown]</pre>
</div>
</div>
<div class="paragraph">
<p>What this tells us is that the problem is <em>not</em> on the local machine: the repository <em>already contains a bad signature</em>.</p>
</div>
<div class="paragraph">
<p>The next step is to do the same by downloading what is actually on Maven Central:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://my-company-mirror.com/repo/com/google/j2objc/j2objc-annotations/1.1/j2objc-annotations-1.1.jar  --output central-j2objc-annotations-1.1.jar
$ curl https://my-company-mirror.com/repo/com/google/j2objc/j2objc-annotations/1/1/j2objc-annotations-1.1.jar.asc  --output central-j2objc-annotations-1.1.jar.asc</pre>
</div>
</div>
<div class="paragraph">
<p>And we can now check the signature again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gpg --verify central-j2objc-annotations-1.1.jar.asc

gpg: assuming signed data in 'central-j2objc-annotations-1.1.jar'
gpg: Signature made Thu 19 Jan 2017 12:06:51 AM CET
gpg:                using RSA key 29579F18FA8FD93B
gpg: Good signature from "Tom Ball &lt;****&gt;" [unknown]
gpg: WARNING: This key is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: B801 E2F8 EF03 5068 EC11  39CC 2957 9F18 FA8F D93B</pre>
</div>
</div>
<div class="paragraph">
<p>This indicates that the dependency is <em>valid</em> on Maven Central.
At this stage, we already know that the problem lives in the mirror, it <em>may</em> have been compromised, but we need to verify.</p>
</div>
<div class="paragraph">
<p>A good idea is to compare the 2 artifacts, which you can do with a tool like <a href="https://try.diffoscope.org/">diffoscope</a>.</p>
</div>
<div class="paragraph">
<p>We then figure out that the intent wasn&#8217;t malicious but that somehow a build has been overwritten with a newer version (the version in Central is newer than the one in our repository).</p>
</div>
<div class="paragraph">
<p>In this case, you can decide to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ignore the signature for this artifact and trust the different possible checksums (both for the old artifact and the new version)</p>
</li>
<li>
<p>or cleanup your mirror so that it contains the same version as in Maven Central</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s worth noting that if you choose to delete the version from your repository, you will <em>also</em> need to remove it from the local Gradle cache.</p>
</div>
<div class="paragraph">
<p>This is facilitated by the fact the error message tells you were the file is located:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact j2objc-annotations-1.1.jar (com.google.j2objc:j2objc-annotations:1.1) in repository 'MyCompany Mirror': Artifact was signed with key '29579f18fa8fd93b' but signature didn't match

  This can indicate that a dependency has been compromised. Please carefully verify the signatures and checksums.

  For your information here are the path to the files which failed verification:
    - $&lt;&lt;directory_layout.adoc#dir:gradle_user_home,GRADLE_USER_HOME&gt;&gt;/caches/modules-2/files-2.1/com.google.j2objc/j2objc-annotations/1.1/976d8d30bebc251db406f2bdb3eb01962b5685b3/j2objc-annotations-1.1.jar (signature: GRADLE_USER_HOME/caches/modules-2/files-2.1/com.google.j2objc/j2objc-annotations/1.1/82e922e14f57d522de465fd144ec26eb7da44501/j2objc-annotations-1.1.jar.asc)

  GRADLE_USER_HOME = /home/jiraya/.gradle</pre>
</div>
</div>
<div class="paragraph">
<p>You can safely delete the artifact file as Gradle would automatically re-download it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>rm -rf ~/.gradle/caches/modules-2/files-2.1/com.google.j2objc/j2objc-annotations/1.1</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:verification-metadata-hygiene"><a class="anchor" href="#sec:verification-metadata-hygiene"></a><a class="link" href="#sec:verification-metadata-hygiene">Cleaning up the verification file</a></h4>
<div class="paragraph">
<p>If you do nothing, the dependency verification metadata will grow over time as you add new dependencies or change versions: Gradle will not automatically remove <em>unused</em> entries from this file.
The reason is that there&#8217;s no way for Gradle to know upfront if a dependency will effectively be used during the build or not.</p>
</div>
<div class="paragraph">
<p>As a consequence, adding dependencies or changing dependency version can easily lead to more entries in the file, while leaving unnecessary entries out there.</p>
</div>
<div class="paragraph">
<p>One option to cleanup the file is to move the existing <code>verification-metadata.xml</code> file to a different location and call Gradle with the <a href="#sec:verification-dry-mode"><code>--dry-run</code> mode</a>: while not perfect (it will not notice dependencies only resolved at configuration time), it generates <em>a new file</em> that you can compare with the existing one.</p>
</div>
<div class="paragraph">
<p>We need to move the existing file because both the bootstrapping mode and the dry-run mode are incremental: they copy information from the existing metadata verification file (in particular, trusted keys).</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:refreshing-missing-keys"><a class="anchor" href="#sec:refreshing-missing-keys"></a><a class="link" href="#sec:refreshing-missing-keys">Refreshing missing keys</a></h4>
<div class="paragraph">
<p>Gradle caches missing keys for 24 hours, meaning it will not attempt to re-download the missing keys for 24 hours after failing.</p>
</div>
<div class="paragraph">
<p>If you want to retry immediately, you can run with the <code>--refresh-keys</code> CLI flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew build --refresh-keys</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#sec:add-manual-keyring">here</a> how to manually add keys if Gradle keeps failing to download them.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="declaring_versions"><a class="anchor" href="#declaring_versions"></a><a class="link" href="#declaring_versions">DECLARING VERSIONS</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="single-version-declarations"><a class="anchor" href="#single-version-declarations"></a><a class="link" href="#single-version-declarations">Declaring Versions and Ranges</a></h3>
<div class="paragraph">
<p>The simplest version declaration is a <em>simple string</em> representing the version to use.
Gradle supports different ways of declaring a version string:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An exact version: e.g. <code>1.3</code>, <code>1.3.0-beta3</code>, <code>1.0-20150201.131010-1</code></p>
</li>
<li>
<p>A Maven-style version range: e.g. <code>[1.0,)</code>, <code>[1.1, 2.0)</code>, <code>(1.2, 1.5]</code></p>
<div class="ulist">
<ul>
<li>
<p>The <code>[</code> and <code>]</code> symbols indicate an inclusive bound; <code>(</code> and <code>)</code> indicate an exclusive bound.</p>
</li>
<li>
<p>When the upper or lower bound is missing, the range has no upper or lower bound.</p>
</li>
<li>
<p>The symbol <code>]</code> can be used instead of <code>(</code> for an exclusive lower bound, and <code>[</code> instead of <code>)</code> for exclusive upper bound. e.g <code>]1.0, 2.0[</code></p>
</li>
<li>
<p>An upper bound exclude acts as a prefix exclude.
This means that <code>[1.0, 2.0[</code> will also exclude all versions starting with <code>2.0</code> that are smaller than <code>2.0</code>.
For example versions like <code>2.0-dev1</code> or <code>2.0-SNAPSHOT</code> are no longer included in the range.</p>
</li>
</ul>
</div>
</li>
<li>
<p>A <em>prefix</em> version range: e.g. <code>1.+</code>, <code>1.3.+</code></p>
<div class="ulist">
<ul>
<li>
<p>Only versions exactly matching the portion before the <code>+</code> are included.</p>
</li>
<li>
<p>The range <code>+</code> on its own will include any version.</p>
</li>
</ul>
</div>
</li>
<li>
<p>A <code>latest-status</code> version: e.g. <code>latest.integration</code>, <code>latest.release</code></p>
<div class="ulist">
<ul>
<li>
<p>Will match the highest versioned module with the specified status. See <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ComponentMetadata.html#getStatus--">ComponentMetadata.getStatus()</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>A Maven <code>SNAPSHOT</code> version identifier: e.g. <code>1.0-SNAPSHOT</code>, <code>1.4.9-beta1-SNAPSHOT</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="version_ordering"><a class="anchor" href="#version_ordering"></a><a class="link" href="#version_ordering">Version ordering</a></h4>
<div class="paragraph">
<p>Versions have an implicit ordering. Version ordering is used to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Determine if a particular version is included in a range.</p>
</li>
<li>
<p>Determine which version is 'newest' when performing conflict resolution (watch out though, conflict resolution uses
<a href="#sec:base-version-comparison">"base versions"</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Versions are ordered based on the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each version is split into it&#8217;s constituent "parts":</p>
<div class="ulist">
<ul>
<li>
<p>The characters <code>[. - _ +]</code> are used to separate the different "parts" of a version.</p>
</li>
<li>
<p>Any part that contains both digits and letters is split into separate parts for each: <code>1a1 == 1.a.1</code></p>
</li>
<li>
<p>Only the parts of a version are compared. The actual separator characters are not significant: <code>1.a.1 == 1-a+1 == 1.a-1 == 1a1</code> (watch out though, in the context of conflict resolution there are <a href="#sec:base-version-comparison">exceptions to this rule</a>).</p>
</li>
</ul>
</div>
</li>
<li>
<p>The equivalent parts of 2 versions are compared using the following rules:</p>
<div class="ulist">
<ul>
<li>
<p>If both parts are numeric, the highest numeric value is <strong>higher</strong>: <code>1.1</code> &lt; <code>1.2</code></p>
</li>
<li>
<p>If one part is numeric, it is considered <strong>higher</strong> than the non-numeric part: <code>1.a</code> &lt; <code>1.1</code></p>
</li>
<li>
<p>If both are non-numeric, the parts are compared <strong>alphabetically</strong>, in a <strong>case-sensitive</strong> manner: <code>1.A</code> &lt; <code>1.B</code> &lt; <code>1.a</code> &lt; <code>1.b</code></p>
</li>
<li>
<p>A version with an extra numeric part is considered <strong>higher</strong> than a version without (even when it&#8217;s zero): <code>1.1</code> &lt; <code>1.1.0</code></p>
</li>
<li>
<p>A version with an extra non-numeric part is considered <strong>lower</strong> than a version without: <code>1.1.a</code> &lt; <code>1.1</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Certain non-numeric parts have special meaning for the purposes of ordering:</p>
<div class="ulist">
<ul>
<li>
<p><code>dev</code> is consider <strong>lower</strong> than any other non-numeric part: <code>1.0-dev</code> &lt; <code>1.0-ALPHA</code> &lt; <code>1.0-alpha</code> &lt; <code>1.0-rc</code>.</p>
</li>
<li>
<p>The strings <code>rc</code>, <code>snapshot</code>, <code>final</code>, <code>ga</code>, <code>release</code> and <code>sp</code> are considered <strong>higher</strong> than any other string part (sorted in this order): <code>1.0-zeta</code> &lt; <code>1.0-rc</code> &lt; <code>1.0-snapshot</code> &lt; <code>1.0-final</code> &lt; <code>1.0-ga</code> &lt; <code>1.0-release</code> &lt; <code>1.0-sp</code> &lt; <code>1.0</code>.</p>
</li>
<li>
<p>These special values are <strong>NOT case sensitive</strong>, as opposed to regular string parts and they do not depend on the separator used around them: <code>1.0-RC-1</code> == <code>1.0.rc.1</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="simple_version_declaration_semantics"><a class="anchor" href="#simple_version_declaration_semantics"></a><a class="link" href="#simple_version_declaration_semantics">Simple version declaration semantics</a></h4>
<div class="paragraph">
<p>When you declare a version using the short-hand notation, for example:</p>
</div>
<div id="ex-a-simple-declaration" class="exampleblock">
<div class="title">Example 144. <a href="#ex-a-simple-declaration">A simple declaration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.slf4j:slf4j-api:1.7.15&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-api:1.7.15</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then the version is considered a <a href="#sec:required-version">required version</a> which means that it should <em>minimally</em> be <code>1.7.15</code> but can be upgraded by the engine (optimistic upgrade).</p>
</div>
<div class="paragraph">
<p>There is, however, a shorthand notation for <a href="#sec:strict-version">strict versions</a>, using the <code>!!</code> notation:</p>
</div>
<div id="ex-shorthand-notation-for-strict-dependencies" class="exampleblock">
<div class="title">Example 145. <a href="#ex-shorthand-notation-for-strict-dependencies">Shorthand notation for strict dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // short-hand notation with !!
    implementation(&quot;org.slf4j:slf4j-api:1.7.15!!&quot;)
    // is equivalent to
    implementation(&quot;org.slf4j:slf4j-api&quot;) {
        version {
           strictly(&quot;1.7.15&quot;)
        }
    }

    // or...
    implementation(&quot;org.slf4j:slf4j-api:[1.7, 1.8[!!1.7.25&quot;)
    // is equivalent to
    implementation(&quot;org.slf4j:slf4j-api&quot;) {
        version {
           strictly(&quot;[1.7, 1.8[&quot;)
           prefer(&quot;1.7.25&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// short-hand notation with !!</span>
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-api:1.7.15!!</span><span class="delimiter">'</span></span>)
    <span class="comment">// is equivalent to</span>
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.slf4j:slf4j-api</span><span class="delimiter">&quot;</span></span>) {
        version {
           strictly <span class="string"><span class="delimiter">'</span><span class="content">1.7.15</span><span class="delimiter">'</span></span>
        }
    }

    <span class="comment">// or...</span>
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-api:[1.7, 1.8[!!1.7.25</span><span class="delimiter">'</span></span>)
    <span class="comment">// is equivalent to</span>
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-api</span><span class="delimiter">'</span></span>) {
        version {
           strictly <span class="string"><span class="delimiter">'</span><span class="content">[1.7, 1.8[</span><span class="delimiter">'</span></span>
           prefer <span class="string"><span class="delimiter">'</span><span class="content">1.7.25</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A strict version <em>cannot be upgraded</em> and overrides whatever transitive dependencies originating from this dependency provide.
It is recommended to use ranges for strict versions.</p>
</div>
<div class="paragraph">
<p>The notation <code>[1.7, 1.8[!!1.7.25</code> above is equivalent to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>strictly <code>[1.7, 1.8[</code></p>
</li>
<li>
<p>prefer <code>1.7.25</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>which means that the engine <strong>must</strong> select a version between 1.7 (included) and 1.8 (excluded), and that if no other component in the graph needs a different version, it should <em>prefer</em> <code>1.7.25</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:declaring_without_version"><a class="anchor" href="#sec:declaring_without_version"></a><a class="link" href="#sec:declaring_without_version">Declaring a dependency without version</a></h4>
<div class="paragraph">
<p>A recommended practice for larger projects is to declare dependencies without versions and use <a href="#sec:adding-constraints-transitive-deps">dependency constraints</a> for version declaration.
The advantage is that dependency constraints allow you to manage versions of all dependencies, including transitive ones, in one place.</p>
</div>
<div id="ex-declaring-a-dependency-without-version" class="exampleblock">
<div class="title">Example 146. <a href="#ex-declaring-a-dependency-without-version">Declaring a dependency without version</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.springframework:spring-web&quot;)
}

dependencies {
    constraints {
        implementation(&quot;org.springframework:spring-web:5.0.2.RELEASE&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-web</span><span class="delimiter">'</span></span>
}

dependencies {
    constraints {
        implementation <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-web:5.0.2.RELEASE</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rich-version-constraints"><a class="anchor" href="#rich-version-constraints"></a><a class="link" href="#rich-version-constraints">Declaring Rich Versions</a></h3>
<div class="paragraph">
<p>Gradle supports a rich model for declaring versions, which allows to combine different level of version information.
The terms and their meaning are explained below, from the strongest to the weakest:</p>
</div>
<div id="sec:strict-version" class="dlist">
<dl>
<dt class="hdlist1"><code>strictly</code></dt>
<dd>
<p>Any version not matched by this version notation will be excluded.
This is the strongest version declaration.
On a declared dependency, a <code>strictly</code> can downgrade a version.
When on a transitive dependency, it will cause dependency resolution to fail if no version acceptable by this clause can be selected.
See <a href="#sec:enforcing_dependency_version">overriding dependency version</a> for details.
This term supports dynamic versions.</p>
<div class="paragraph">
<p>When defined, this overrides any previous <code>require</code> declaration and clears previous <code>reject</code>.</p>
</div>
</dd>
</dl>
</div>
<div id="sec:required-version" class="dlist">
<dl>
<dt class="hdlist1"><code>require</code></dt>
<dd>
<p>Implies that the selected version cannot be lower than what <code>require</code> accepts but could be higher through conflict resolution, even if higher has an exclusive higher bound.
This is what a direct dependency translates to.
This term supports dynamic versions.</p>
<div class="paragraph">
<p>When defined, this overrides any previous <code>strictly</code> declaration and clears previous <code>reject</code>.</p>
</div>
</dd>
</dl>
</div>
<div id="sec:preferred-version" class="dlist">
<dl>
<dt class="hdlist1"><code>prefer</code></dt>
<dd>
<p>This is a very soft version declaration.
It applies only if there is no stronger non dynamic opinion on a version for the module.
This term does not support dynamic versions.</p>
<div class="paragraph">
<p>Definition can complement <code>strictly</code> or <code>require</code>.</p>
</div>
<div class="paragraph">
<p>When defined, this overrides any previous <code>prefer</code> declaration and clears previous <code>reject</code>.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>There is also an additional term outside of the level hierarchy:</p>
</div>
<div id="sec:rejected-version" class="dlist">
<dl>
<dt class="hdlist1"><code>reject</code></dt>
<dd>
<p>Declares that specific version(s) are not accepted for the module.
This will cause dependency resolution to fail if the only versions selectable are also rejected.
This term supports dynamic versions.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following table illustrates a number of use cases and how to combine the different terms for rich version declaration:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 21. Rich version use cases</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Which version(s) of this dependency are acceptable?</th>
<th class="tableblock halign-left valign-top"><code>strictly</code></th>
<th class="tableblock halign-left valign-top"><code>require</code></th>
<th class="tableblock halign-left valign-top"><code>prefer</code></th>
<th class="tableblock halign-left valign-top"><code>rejects</code></th>
<th class="tableblock halign-left valign-top">Selection result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested with version <code>1.5</code>, believe all future versions should work.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any version starting from <code>1.5</code>, equivalent of <code>org:foo:1.5</code>. An upgrade to <code>2.4</code> is accepted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested with <code>1.5</code>, soft constraint upgrades according to semantic versioning.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1.0, 2.0[</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any version between <code>1.0</code> and <code>2.0</code>, <code>1.5</code> if nobody else cares. An upgrade to <code>2.4</code> is accepted.<br>
🔒</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested with <code>1.5</code>, but follows semantic versioning.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1.0, 2.0[</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any version between <code>1.0</code> and <code>2.0</code> (exclusive), <code>1.5</code> if nobody else cares.<br>
Overwrites versions from transitive dependencies.<br>
🔒</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as above, with <code>1.4</code> known broken.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1.0, 2.0[</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any version between <code>1.0</code> and <code>2.0</code> (exclusive) except for <code>1.4</code>, <code>1.5</code> if nobody else cares.<br>
Overwrites versions from transitive dependencies.<br>
🔒</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No opinion, works with <code>1.5</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.5</code> if no other opinion, any otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No opinion, prefer latest release.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>latest.release</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The latest release at build time.<br>
🔒</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">On the edge, latest release, no downgrade.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>latest.release</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The latest release at build time.<br>
🔒</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No other version than 1.5.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5, or failure if another <code>strict</code> or higher <code>require</code> constraint disagrees.<br>
Overwrites versions from transitive dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.5</code> or a patch version of it exclusively.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1.5,1.6[</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Latest <code>1.5.x</code> patch release, or failure if another <code>strict</code> or higher <code>require</code> constraint disagrees.<br>
Overwrites versions from transitive dependencies.<br>
🔒</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Lines annotated with a lock (🔒) indicate that leveraging <a href="#dependency-locking">dependency locking</a> makes sense in this context.
Another concept that relates with rich version declaration is the ability to publish <a href="#publishing_maven:resolved_dependencies">resolved versions</a> instead of declared ones.</p>
</div>
<div class="paragraph">
<p>Using <code>strictly</code>, especially for a library, must be a well thought process as it has an impact on downstream consumers.
At the same time, used correctly, it will help consumers understand what combination of libraries do not work together in their context.
See <a href="#sec:enforcing_dependency_version">overriding dependency version</a> for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Rich version information will be preserved in the Gradle Module Metadata format.
However conversion to Ivy or Maven metadata formats will be lossy.
The highest level will be published, that is <code>strictly</code> or <code>require</code> over <code>prefer</code>.
In addition, any <code>reject</code> will be ignored.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Rich version declaration is accessed through the <code>version</code> DSL method on a dependency or constraint declaration which gives access to <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/MutableVersionConstraint.html">MutableVersionConstraint</a>.</p>
</div>
<div id="ex-rich-version-declaration" class="exampleblock">
<div class="title">Example 147. <a href="#ex-rich-version-declaration">Rich version declaration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.slf4j:slf4j-api&quot;) {
        version {
            strictly(&quot;[1.7, 1.8[&quot;)
            prefer(&quot;1.7.25&quot;)
        }
    }

    constraints {
        add(&quot;implementation&quot;, &quot;org.springframework:spring-core&quot;) {
            version {
                require(&quot;4.2.9.RELEASE&quot;)
                reject(&quot;4.3.16.RELEASE&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-api</span><span class="delimiter">'</span></span>) {
        version {
            strictly <span class="string"><span class="delimiter">'</span><span class="content">[1.7, 1.8[</span><span class="delimiter">'</span></span>
            prefer <span class="string"><span class="delimiter">'</span><span class="content">1.7.25</span><span class="delimiter">'</span></span>
        }
    }

    constraints {
        implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-core</span><span class="delimiter">'</span></span>) {
            version {
                require <span class="string"><span class="delimiter">'</span><span class="content">4.2.9.RELEASE</span><span class="delimiter">'</span></span>
                reject <span class="string"><span class="delimiter">'</span><span class="content">4.3.16.RELEASE</span><span class="delimiter">'</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec:dynamic_versions_and_changing_modules"><a class="anchor" href="#sec:dynamic_versions_and_changing_modules"></a><a class="link" href="#sec:dynamic_versions_and_changing_modules">Handling versions which change over time</a></h3>
<div class="paragraph">
<p>There are many situations when you want to use the latest version of a particular module dependency, or the latest in a range of versions.
This can be a requirement during development, or you may be developing a library that is designed to work with a range of dependency versions.
You can easily depend on these constantly changing dependencies by using a <em>dynamic version</em>.
A <a href="#sub:declaring_dependency_with_dynamic_version">dynamic version</a> can be either a version range (e.g. <code>2.+</code>) or it can be a placeholder for the latest version available e.g. <code>latest.integration</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively, the module you request can change over time even for the same version, a so-called <a href="#sub:declaring_dependency_with_changing_version">changing version</a>.
An example of this type of <em>changing module</em> is a Maven <code>SNAPSHOT</code> module, which always points at the latest artifact published.
In other words, a standard Maven snapshot is a module that is continually evolving, it is a "changing module".</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Using dynamic versions and changing modules can lead to unreproducible builds. As new versions of a particular module are published, its API may become incompatible with your source code. Use this feature with caution!
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sub:declaring_dependency_with_dynamic_version"><a class="anchor" href="#sub:declaring_dependency_with_dynamic_version"></a><a class="link" href="#sub:declaring_dependency_with_dynamic_version">Declaring a dynamic version</a></h4>
<div class="paragraph">
<p>Projects might adopt a more aggressive approach for consuming dependencies to modules.
For example you might want to always integrate the latest version of a dependency to consume cutting edge features at any given time.
A <em>dynamic version</em> allows for resolving the latest version or the latest version of a version range for a given module.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Using dynamic versions in a build bears the risk of potentially breaking it. As soon as a new version of the dependency is released that contains an incompatible API change your source code might stop compiling.
</td>
</tr>
</table>
</div>
<div id="ex-declaring-a-dependency-with-a-dynamic-version" class="exampleblock">
<div class="title">Example 148. <a href="#ex-declaring-a-dependency-with-a-dynamic-version">Declaring a dependency with a dynamic version</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;org.springframework:spring-web:5.+&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-web:5.+</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A <a href="https://scans.gradle.com/">build scan</a> can effectively visualize dynamic dependency versions and their respective, selected versions.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-dynamic-dependency-build-scan.png" alt="dependency management dynamic dependency build scan">
</div>
<div class="title">Figure 12. Dynamic dependencies in build scan</div>
</div>
<div class="paragraph">
<p>By default, Gradle caches dynamic versions of dependencies for 24 hours. Within this time frame, Gradle does not try to resolve newer versions from the declared repositories.
The <a href="#sec:controlling-dynamic-version-caching">threshold can be configured</a> as needed for example if you want to resolve new versions earlier.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:declaring_dependency_with_changing_version"><a class="anchor" href="#sub:declaring_dependency_with_changing_version"></a><a class="link" href="#sub:declaring_dependency_with_changing_version">Declaring a changing version</a></h4>
<div class="paragraph">
<p>A team might decide to implement a series of features before releasing a new version of the application or library. A common strategy to allow consumers to integrate an unfinished version of their artifacts early and often is to release a module with a so-called <em>changing version</em>.
A changing version indicates that the feature set is still under active development and hasn&#8217;t released a stable version for general availability yet.</p>
</div>
<div class="paragraph">
<p>In Maven repositories, changing versions are commonly referred to as <a href="https://maven.apache.org/guides/getting-started/index.html#what-is-a-snapshot-version">snapshot versions</a>.
Snapshot versions contain the suffix <code>-SNAPSHOT</code>.
The following example demonstrates how to declare a snapshot version on the Spring dependency.</p>
</div>
<div id="ex-declaring-a-dependency-with-a-changing-version" class="exampleblock">
<div class="title">Example 149. <a href="#ex-declaring-a-dependency-with-a-changing-version">Declaring a dependency with a changing version</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

repositories {
    mavenCentral()
    maven {
        url = uri(&quot;https://repo.spring.io/snapshot/&quot;)
    }
}

dependencies {
    implementation(&quot;org.springframework:spring-web:5.0.3.BUILD-SNAPSHOT&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
    maven {
        url <span class="string"><span class="delimiter">'</span><span class="content">https://repo.spring.io/snapshot/</span><span class="delimiter">'</span></span>
    }
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-web:5.0.3.BUILD-SNAPSHOT</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, Gradle caches changing versions of dependencies for 24 hours.
Within this time frame, Gradle does not try to resolve newer versions from the declared repositories. The <a href="#sec:controlling-dynamic-version-caching">threshold can be configured</a> as needed for example if you want to resolve new snapshot versions earlier.</p>
</div>
<div class="paragraph">
<p>Gradle is flexible enough to treat any version as changing version e.g. if you wanted to model snapshot behavior for an Ivy module.
All you need to do is to set the property <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ExternalModuleDependency.html#setChanging-boolean-">ExternalModuleDependency.setChanging(boolean)</a> to <code>true</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:controlling-dynamic-version-caching"><a class="anchor" href="#sec:controlling-dynamic-version-caching"></a><a class="link" href="#sec:controlling-dynamic-version-caching">Controlling dynamic version caching</a></h4>
<div class="paragraph">
<p>By default, Gradle caches dynamic versions and changing modules for 24 hours. During that time frame Gradle does not contact any of the declared, remote repositories for new versions. If you want Gradle to check the remote repository more frequently or with every execution of your build, then you will need to change the time to live (TTL) threshold.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Using a short TTL threshold for dynamic or changing versions may result in longer build times due to the increased number of HTTP(s) calls.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can override the default cache modes using <a href="#sec:controlling_dependency_caching_command_line">command line options</a>. You can also <a href="#sec:controlling_dependency_caching_programmatically">change the cache expiry times in your build programmatically</a> using the resolution strategy.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:controlling_dependency_caching_programmatically"><a class="anchor" href="#sec:controlling_dependency_caching_programmatically"></a><a class="link" href="#sec:controlling_dependency_caching_programmatically">Controlling dependency caching programmatically</a></h4>
<div class="paragraph">
<p>You can fine-tune certain aspects of caching programmatically using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ResolutionStrategy.html">ResolutionStrategy</a> for a configuration. The programmatic approach is useful if you would like to change the settings permanently.</p>
</div>
<div class="paragraph">
<p>By default, Gradle caches dynamic versions for 24 hours. To change how long Gradle will cache the resolved version for a dynamic version, use:</p>
</div>
<div id="ex-dynamic-version-cache-control" class="exampleblock">
<div class="title">Example 150. <a href="#ex-dynamic-version-cache-control">Dynamic version cache control</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.cacheDynamicVersionsFor(10, &quot;minutes&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.cacheDynamicVersionsFor <span class="integer">10</span>, <span class="string"><span class="delimiter">'</span><span class="content">minutes</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, Gradle caches changing modules for 24 hours. To change how long Gradle will cache the meta-data and artifacts for a changing module, use:</p>
</div>
<div id="ex-changing-module-cache-control" class="exampleblock">
<div class="title">Example 151. <a href="#ex-changing-module-cache-control">Changing module cache control</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.cacheChangingModulesFor(4, &quot;hours&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.cacheChangingModulesFor <span class="integer">4</span>, <span class="string"><span class="delimiter">'</span><span class="content">hours</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:controlling_dependency_caching_command_line"><a class="anchor" href="#sec:controlling_dependency_caching_command_line"></a><a class="link" href="#sec:controlling_dependency_caching_command_line">Controlling dependency caching from the command line</a></h4>
<div class="sect4">
<h5 id="sec:offline-mode"><a class="anchor" href="#sec:offline-mode"></a><a class="link" href="#sec:offline-mode">Avoiding network access with offline mode</a></h5>
<div class="paragraph">
<p>The <code>--offline</code> command line switch tells Gradle to always use dependency modules from the cache, regardless if they are due to be checked again. When running with offline, Gradle will never attempt to access the network to perform dependency resolution. If required modules are not present in the dependency cache, build execution will fail.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:refreshing-dependencies"><a class="anchor" href="#sec:refreshing-dependencies"></a><a class="link" href="#sec:refreshing-dependencies">Refreshing dependencies</a></h5>
<div class="paragraph">
<p>You can control the behavior of dependency caching for a distinct build invocation from the command line.
Command line options are helpful for making a selective, ad-hoc choice for a single execution of the build.</p>
</div>
<div class="paragraph">
<p>At times, the Gradle Dependency Cache can become out of sync with the actual state of the configured repositories.
Perhaps a repository was initially misconfigured, or perhaps a "non-changing" module was published incorrectly.
To refresh all dependencies in the dependency cache, use the <code>--refresh-dependencies</code> option on the command line.</p>
</div>
<div class="paragraph">
<p>The <code>--refresh-dependencies</code> option tells Gradle to ignore all cached entries for resolved modules and artifacts.
A fresh resolve will be performed against all configured repositories, with dynamic versions recalculated, modules refreshed, and artifacts downloaded.
However, where possible Gradle will check if the previously downloaded artifacts are valid before downloading again.
This is done by comparing published SHA1 values in the repository with the SHA1 values for existing downloaded artifacts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>new versions of dynamic dependencies</p>
</li>
<li>
<p>new versions of changing modules (modules which use the same version string but can have different contents)</p>
</li>
</ul>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Refreshing dependencies will cause Gradle to invalidate its listing caches.
However:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it will perform HTTP HEAD requests on metadata files but <em>will not re-download them</em> if they are identical</p>
</li>
<li>
<p>it will perform HTTP HEAD requests on artifact files but <em>will not re-download them</em> if they are identical</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In other words, refreshing dependencies <em>only</em> has an impact if you actually use dynamic dependencies <em>or</em> that you have changing dependencies that you were not aware of (in which case it is your responsibility to declare them correctly to Gradle as changing dependencies).</p>
</div>
<div class="paragraph">
<p>It&#8217;s a common misconception to think that using <code>--refresh-dependencies</code> will force download of dependencies.
This is <strong>not</strong> the case: Gradle will only perform what is strictly required to refresh the dynamic dependencies.
This <em>may</em> involve downloading new listing or metadata files, or even artifacts, but if nothing changed, the impact is minimal.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:component_selection_rules"><a class="anchor" href="#sec:component_selection_rules"></a><a class="link" href="#sec:component_selection_rules">Using component selection rules</a></h4>
<div class="paragraph">
<p>Component selection rules may influence which component instance should be selected when multiple versions are available that match a version selector.
Rules are applied against every available version and allow the version to be explicitly rejected by rule.
This allows Gradle to ignore any component instance that does not satisfy conditions set by the rule.
Examples include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For a dynamic version like <code>1.+</code> certain versions may be explicitly rejected from selection.</p>
</li>
<li>
<p>For a static version like <code>1.4</code> an instance may be rejected based on extra component metadata such as the Ivy branch attribute, allowing an instance from a subsequent repository to be used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Rules are configured via the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.ComponentSelectionRules.html">ComponentSelectionRules</a> object.
Each rule configured will be called with a <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.ComponentSelection.html">ComponentSelection</a> object as an argument which contains information about the candidate version being considered.
Calling <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.ComponentSelection.html#org.gradle.api.artifacts.ComponentSelection:reject(java.lang.String)">ComponentSelection.reject(java.lang.String)</a> causes the given candidate version to be explicitly rejected, in which case the candidate will not be considered for the selector.</p>
</div>
<div class="paragraph">
<p>The following example shows a rule that disallows a particular version of a module but allows the dynamic version to choose the next best candidate.</p>
</div>
<div id="ex-component-selection-rule" class="exampleblock">
<div class="title">Example 152. <a href="#ex-component-selection-rule">Component selection rule</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;rejectConfig&quot;) {
        resolutionStrategy {
            componentSelection {
                // Accept the highest version matching the requested version that isn't '1.5'
                all {
                    if (candidate.group == &quot;org.sample&quot; &amp;&amp; candidate.module == &quot;api&quot; &amp;&amp; candidate.version == &quot;1.5&quot;) {
                        reject(&quot;version 1.5 is broken for 'org.sample:api'&quot;)
                    }
                }
            }
        }
    }
}

dependencies {
    &quot;rejectConfig&quot;(&quot;org.sample:api:1.+&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    rejectConfig {
        resolutionStrategy {
            componentSelection {
                <span class="comment">// Accept the highest version matching the requested version that isn't '1.5'</span>
                all { ComponentSelection selection -&gt;
                    <span class="keyword">if</span> (selection.candidate.group == <span class="string"><span class="delimiter">'</span><span class="content">org.sample</span><span class="delimiter">'</span></span> &amp;&amp; selection.candidate.module == <span class="string"><span class="delimiter">'</span><span class="content">api</span><span class="delimiter">'</span></span> &amp;&amp; selection.candidate.version == <span class="string"><span class="delimiter">'</span><span class="content">1.5</span><span class="delimiter">'</span></span>) {
                        selection.reject(<span class="string"><span class="delimiter">&quot;</span><span class="content">version 1.5 is broken for 'org.sample:api'</span><span class="delimiter">&quot;</span></span>)
                    }
                }
            }
        }
    }
}

dependencies {
    rejectConfig <span class="string"><span class="delimiter">&quot;</span><span class="content">org.sample:api:1.+</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that version selection is applied starting with the highest version first.
The version selected will be the first version found that all component selection rules accept.
A version is considered accepted if no rule explicitly rejects it.</p>
</div>
<div class="paragraph">
<p>Similarly, rules can be targeted at specific modules.
Modules must be specified in the form of <code>group:module</code>.</p>
</div>
<div id="ex-component-selection-rule-with-module-target" class="exampleblock">
<div class="title">Example 153. <a href="#ex-component-selection-rule-with-module-target">Component selection rule with module target</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;targetConfig&quot;) {
        resolutionStrategy {
            componentSelection {
                withModule(&quot;org.sample:api&quot;) {
                    if (candidate.version == &quot;1.5&quot;) {
                        reject(&quot;version 1.5 is broken for 'org.sample:api'&quot;)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    targetConfig {
        resolutionStrategy {
            componentSelection {
                withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.sample:api</span><span class="delimiter">&quot;</span></span>) { ComponentSelection selection -&gt;
                    <span class="keyword">if</span> (selection.candidate.version == <span class="string"><span class="delimiter">&quot;</span><span class="content">1.5</span><span class="delimiter">&quot;</span></span>) {
                        selection.reject(<span class="string"><span class="delimiter">&quot;</span><span class="content">version 1.5 is broken for 'org.sample:api'</span><span class="delimiter">&quot;</span></span>)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Component selection rules can also consider component metadata when selecting a version.
Possible additional metadata that can be considered are <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ComponentMetadata.html">ComponentMetadata</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ivy/IvyModuleDescriptor.html">IvyModuleDescriptor</a>.
Note that this extra information may not always be available and thus should be checked for <code>null</code> values.</p>
</div>
<div id="ex-component-selection-rule-with-metadata" class="exampleblock">
<div class="title">Example 154. <a href="#ex-component-selection-rule-with-metadata">Component selection rule with metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;metadataRulesConfig&quot;) {
        resolutionStrategy {
            componentSelection {
                // Reject any versions with a status of 'experimental'
                all {
                    if (candidate.group == &quot;org.sample&quot; &amp;&amp; metadata?.status == &quot;experimental&quot;) {
                        reject(&quot;don't use experimental candidates from 'org.sample'&quot;)
                    }
                }
                // Accept the highest version with either a &quot;release&quot; branch or a status of 'milestone'
                withModule(&quot;org.sample:api&quot;) {
                    if (getDescriptor(IvyModuleDescriptor::class)?.branch != &quot;release&quot; &amp;&amp; metadata?.status != &quot;milestone&quot;) {
                        reject(&quot;'org.sample:api' must have testing branch or milestone status&quot;)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    metadataRulesConfig {
        resolutionStrategy {
            componentSelection {
                <span class="comment">// Reject any versions with a status of 'experimental'</span>
                all { ComponentSelection selection -&gt;
                    <span class="keyword">if</span> (selection.candidate.group == <span class="string"><span class="delimiter">'</span><span class="content">org.sample</span><span class="delimiter">'</span></span> &amp;&amp; selection.metadata?.status == <span class="string"><span class="delimiter">'</span><span class="content">experimental</span><span class="delimiter">'</span></span>) {
                        selection.reject(<span class="string"><span class="delimiter">&quot;</span><span class="content">don't use experimental candidates from 'org.sample'</span><span class="delimiter">&quot;</span></span>)
                    }
                }
                <span class="comment">// Accept the highest version with either a &quot;release&quot; branch or a status of 'milestone'</span>
                withModule(<span class="string"><span class="delimiter">'</span><span class="content">org.sample:api</span><span class="delimiter">'</span></span>) { ComponentSelection selection -&gt;
                    <span class="keyword">if</span> (selection.getDescriptor(IvyModuleDescriptor)?.branch != <span class="string"><span class="delimiter">&quot;</span><span class="content">release</span><span class="delimiter">&quot;</span></span> &amp;&amp; selection.metadata?.status != <span class="string"><span class="delimiter">'</span><span class="content">milestone</span><span class="delimiter">'</span></span>) {
                        selection.reject(<span class="string"><span class="delimiter">&quot;</span><span class="content">'org.sample:api' must be a release branch or have milestone status</span><span class="delimiter">&quot;</span></span>)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that a <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.ComponentSelection.html">ComponentSelection</a> argument is <em>always</em> required as parameter when declaring a component selection rule.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dependency-locking"><a class="anchor" href="#dependency-locking"></a><a class="link" href="#dependency-locking">Locking dependency versions</a></h3>
<div class="paragraph">
<p>Use of dynamic dependency versions (e.g. <code>1.+</code> or <code>[1.0,2.0)</code>) makes builds non-deterministic.
This causes builds to break without any obvious change, and worse, can be caused by a transitive dependency that the build author has no control over.</p>
</div>
<div class="paragraph">
<p>To achieve <a href="https://reproducible-builds.org/">reproducible builds</a>, it is necessary to <em>lock</em> versions of dependencies and transitive dependencies such that a build with the same inputs will always resolve the same module versions.
This is called <em>dependency locking</em>.</p>
</div>
<div class="paragraph">
<p>It enables, amongst others, the following scenarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Companies dealing with multi repositories no longer need to rely on <code>-SNAPSHOT</code> or changing dependencies,
which sometimes result in cascading failures when a dependency introduces a bug or incompatibility.
Now dependencies can be declared against major or minor version range, enabling to test with the latest versions on CI while leveraging locking for stable developer builds.</p>
</li>
<li>
<p>Teams that want to always use the latest of their dependencies can use dynamic versions, locking their dependencies only for releases.
The release tag will contain the lock states, allowing that build to be fully reproducible when bug fixes need to be developed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Combined with <a href="#publishing_maven:resolved_dependencies">publishing resolved versions</a>, you can also replace the declared dynamic version part at publication time.
Consumers will instead see the versions that your release resolved.</p>
</div>
<div class="paragraph">
<p>Locking is enabled per <a href="#sec:what-are-dependency-configurations">dependency configuration</a>.
Once enabled, you must create an initial lock state.
It will cause Gradle to verify that resolution results do not change, resulting in the same selected dependencies even if newer versions are produced.
Modifications to your build that would impact the resolved set of dependencies will cause it to fail.
This makes sure that changes, either in published dependencies or build definitions, do not alter resolution without adapting the lock state.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Dependency locking makes sense only with <a href="#sub:declaring_dependency_with_dynamic_version">dynamic versions</a>.
It will have no impact on <a href="#sub:declaring_dependency_with_changing_version">changing versions</a> (like <code>-SNAPSHOT</code>) whose coordinates remain the same, though the content may change.
Gradle will even emit a warning when persisting lock state and changing dependencies are present in the resolution result.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="enabling_locking_on_configurations"><a class="anchor" href="#enabling_locking_on_configurations"></a><a class="link" href="#enabling_locking_on_configurations">Enabling locking on configurations</a></h4>
<div class="paragraph">
<p>Locking of a configuration happens through the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.ResolutionStrategy.html">ResolutionStrategy</a>:</p>
</div>
<div id="ex-locking-a-specific-configuration" class="exampleblock">
<div class="title">Example 155. <a href="#ex-locking-a-specific-configuration">Locking a specific configuration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    compileClasspath {
        resolutionStrategy.activateDependencyLocking()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    compileClasspath {
        resolutionStrategy.activateDependencyLocking()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Only configurations that can be resolved will have lock state attached to them.
Applying locking on non resolvable-configurations is simply a no-op.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Or the following, as a way to lock all configurations:</p>
</div>
<div id="ex-locking-all-configurations" class="exampleblock">
<div class="title">Example 156. <a href="#ex-locking-all-configurations">Locking all configurations</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyLocking {
    lockAllConfigurations()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyLocking {
    lockAllConfigurations()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The above will lock all <em>project</em> configurations, but not the <em>buildscript</em> ones.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also disable locking on a specific configuration.
This can be useful if a plugin configured locking on all configurations but you happen to add one that should not be locked.</p>
</div>
<div id="ex-unlocking-a-specific-configuration" class="exampleblock">
<div class="title">Example 157. <a href="#ex-unlocking-a-specific-configuration">Unlocking a specific configuration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.compileClasspath {
    resolutionStrategy.deactivateDependencyLocking()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    compileClasspath {
        resolutionStrategy.deactivateDependencyLocking()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="locking_buildscript_classpath_configuration"><a class="anchor" href="#locking_buildscript_classpath_configuration"></a><a class="link" href="#locking_buildscript_classpath_configuration">Locking buildscript classpath configuration</a></h5>
<div class="paragraph">
<p>If you apply plugins to your build, you may want to leverage dependency locking there as well.
In order to lock the <a href="#sec:applying_plugins_buildscript"><code>classpath</code> configuration</a> used for script plugins, do the following:</p>
</div>
<div id="ex-locking-buildscript-classpath-configuration" class="exampleblock">
<div class="title">Example 158. <a href="#ex-locking-buildscript-classpath-configuration">Locking buildscript classpath configuration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildscript {
    configurations.classpath {
        resolutionStrategy.activateDependencyLocking()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    configurations.classpath {
        resolutionStrategy.activateDependencyLocking()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="generating_and_updating_dependency_locks"><a class="anchor" href="#generating_and_updating_dependency_locks"></a><a class="link" href="#generating_and_updating_dependency_locks">Generating and updating dependency locks</a></h4>
<div class="paragraph">
<p>In order to generate or update lock state, you specify the <code>--write-locks</code> command line argument in addition to the normal tasks that would trigger configurations to be resolved.
This will cause the creation of lock state for each resolved configuration in that build execution.
Note that if lock state existed previously, it is overwritten.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Gradle will not write lock state to disk if the build fails.
This prevents persisting possibly invalid state.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="lock_all_configurations_in_one_build_execution"><a class="anchor" href="#lock_all_configurations_in_one_build_execution"></a><a class="link" href="#lock_all_configurations_in_one_build_execution">Lock all configurations in one build execution</a></h5>
<div class="paragraph">
<p>When locking multiple configurations, you may want to lock them all at once, during a single build execution.</p>
</div>
<div class="paragraph">
<p>For this, you have two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run <code>gradle dependencies --write-locks</code>.
This will effectively lock all resolvable configurations that have locking enabled.
Note that in a multi project setup, <code>dependencies</code> only is executed on <em>one</em> project, the root one in this case.</p>
</li>
<li>
<p>Declare a custom task that resolves all configurations. This does not work for Android projects.</p>
</li>
</ul>
</div>
<div id="ex-resolving-all-configurations" class="exampleblock">
<div class="title">Example 159. <a href="#ex-resolving-all-configurations">Resolving all configurations</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;resolveAndLockAll&quot;) {
    notCompatibleWithConfigurationCache(&quot;Filters configurations at execution time&quot;)
    doFirst {
        require(gradle.startParameter.isWriteDependencyLocks) { &quot;$path must be run from the command line with the `--write-locks` flag&quot; }
    }
    doLast {
        configurations.filter {
            // Add any custom filtering on the configurations to be resolved
            it.isCanBeResolved
        }.forEach { it.resolve() }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">resolveAndLockAll</span><span class="delimiter">'</span></span>) {
    notCompatibleWithConfigurationCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">Filters configurations at execution time</span><span class="delimiter">&quot;</span></span>)
    doFirst {
        <span class="keyword">assert</span> gradle.startParameter.writeDependencyLocks : <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>path</span><span class="content"> must be run from the command line with the `--write-locks` flag</span><span class="delimiter">&quot;</span></span>
    }
    doLast {
        configurations.findAll {
            <span class="comment">// Add any custom filtering on the configurations to be resolved</span>
            <span class="local-variable">it</span>.canBeResolved
        }.each { <span class="local-variable">it</span>.resolve() }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>That second option, with proper selection of configurations, can be the only option in the native world, where not all configurations can be resolved on a single platform.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="lock_state_location_and_format"><a class="anchor" href="#lock_state_location_and_format"></a><a class="link" href="#lock_state_location_and_format">Lock state location and format</a></h4>
<div class="paragraph">
<p>Lock state will be preserved in a file located at the root of the project or subproject directory.
Each file is named <code>gradle.lockfile</code>.
The one exception to this rule is for the lock file for the <a href="#sec:applying_plugins_buildscript">buildscript itself</a>.
In that case the file will be named <code>buildscript-gradle.lockfile</code>.</p>
</div>
<div class="paragraph">
<p>The lockfile will have the following content:</p>
</div>
<div class="listingblock">
<div class="title">gradle.lockfile</div>
<div class="content">
<pre># This is a Gradle generated file for dependency locking.
# Manual edits can break the build and are not advised.
# This file is expected to be part of source control.
org.springframework:spring-beans:5.0.5.RELEASE=compileClasspath, runtimeClasspath
org.springframework:spring-core:5.0.5.RELEASE=compileClasspath, runtimeClasspath
org.springframework:spring-jcl:5.0.5.RELEASE=compileClasspath, runtimeClasspath
empty=annotationProcessor</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Each line still represents a single dependency in the <code>group:artifact:version</code> notation</p>
</li>
<li>
<p>It then lists all configurations that contain the given dependency</p>
</li>
<li>
<p>Module and configurations are ordered alphabetically, to ease diffs</p>
</li>
<li>
<p>The last line of the file lists all empty configurations, that is configurations known to have no dependencies</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>which matches the following dependency declaration:</p>
</div>
<div id="ex-dynamic-dependency-declaration" class="exampleblock">
<div class="title">Example 160. <a href="#ex-dynamic-dependency-declaration">Dynamic dependency declaration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    compileClasspath {
        resolutionStrategy.activateDependencyLocking()
    }
    runtimeClasspath {
        resolutionStrategy.activateDependencyLocking()
    }
    annotationProcessor {
        resolutionStrategy.activateDependencyLocking()
    }
}

dependencies {
    implementation(&quot;org.springframework:spring-beans:[5.0,6.0)&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    compileClasspath {
        resolutionStrategy.activateDependencyLocking()
    }
    runtimeClasspath {
        resolutionStrategy.activateDependencyLocking()
    }
    annotationProcessor {
        resolutionStrategy.activateDependencyLocking()
    }
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-beans:[5.0,6.0)</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="migrate_single_lockfile"><a class="anchor" href="#migrate_single_lockfile"></a><a class="link" href="#migrate_single_lockfile">Migrating from the lockfile per configuration format</a></h5>
<div class="paragraph">
<p>If your project uses the legacy lock file format of a file per locked configuration, follow these instructions to migrate to the new format:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Follow the documentation for <a href="#lock_all_configurations_in_one_build_execution">writing</a> or <a href="#selectively_updating_lock_state_entries">updating</a> dependency lock state.</p>
</li>
<li>
<p>Upon writing the single lock file per project, Gradle will also delete all lock files per configuration for which the state was transferred.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Migration can be done one configuration at a time.
Gradle will keep sourcing the lock state from the per configuration files as long as there is no information for that configuration in the single lock file.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="configuring_the_per_project_lock_file_name_and_location"><a class="anchor" href="#configuring_the_per_project_lock_file_name_and_location"></a><a class="link" href="#configuring_the_per_project_lock_file_name_and_location">Configuring the per project lock file name and location</a></h5>
<div class="paragraph">
<p>When using the single lock file per project, you can configure its name and location.
The main reason for providing this is to enable having a file name that is determined by some project properties, effectively allowing a single project to store different lock state for different execution contexts.
One trivial example in the JVM ecosystem is the Scala version that is often found in artifact coordinates.</p>
</div>
<div id="ex-changing-the-lock-file-name" class="exampleblock">
<div class="title">Example 161. <a href="#ex-changing-the-lock-file-name">Changing the lock file name</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val scalaVersion = &quot;2.12&quot;
dependencyLocking {
    lockFile = file(&quot;$projectDir/locking/gradle-${scalaVersion}.lockfile&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> scalaVersion = <span class="string"><span class="delimiter">&quot;</span><span class="content">2.12</span><span class="delimiter">&quot;</span></span>
dependencyLocking {
    lockFile = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>projectDir</span><span class="content">/locking/gradle-</span><span class="inline"><span class="inline-delimiter">${</span>scalaVersion<span class="inline-delimiter">}</span></span><span class="content">.lockfile</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running_a_build_with_lock_state_present"><a class="anchor" href="#running_a_build_with_lock_state_present"></a><a class="link" href="#running_a_build_with_lock_state_present">Running a build with lock state present</a></h4>
<div class="paragraph">
<p>The moment a build needs to resolve a configuration that has locking enabled and it finds a matching lock state,
it will use it to verify that the given configuration still resolves the same versions.</p>
</div>
<div class="paragraph">
<p>A successful build indicates that the same dependencies are used as stored in the lock state, regardless if new versions matching the dynamic selector have been produced.</p>
</div>
<div class="paragraph">
<p>The complete validation is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Existing entries in the lock state must be matched in the build</p>
<div class="ulist">
<ul>
<li>
<p>A version mismatch or missing resolved module causes a build failure</p>
</li>
</ul>
</div>
</li>
<li>
<p>Resolution result must not contain extra dependencies compared to the lock state</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="fine_tuning_dependency_locking_behaviour_with_lock_mode"><a class="anchor" href="#fine_tuning_dependency_locking_behaviour_with_lock_mode"></a><a class="link" href="#fine_tuning_dependency_locking_behaviour_with_lock_mode">Fine tuning dependency locking behaviour with lock mode</a></h5>
<div class="paragraph">
<p>While the default lock mode behaves as described above, two other modes are available:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Strict mode</dt>
<dd>
<p>In this mode, in addition to the validations above, dependency locking will fail if a configuration marked as <em>locked</em> does not have lock state associated with it.</p>
</dd>
<dt class="hdlist1">Lenient mode</dt>
<dd>
<p>In this mode, dependency locking will still pin dynamic versions but otherwise changes to the dependency resolution are no longer errors.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The lock mode can be controlled from the <code>dependencyLocking</code> block as shown below:</p>
</div>
<div id="ex-setting-the-lock-mode" class="exampleblock">
<div class="title">Example 162. <a href="#ex-setting-the-lock-mode">Setting the lock mode</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyLocking {
    lockMode = LockMode.STRICT
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyLocking {
    lockMode = LockMode.STRICT
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selectively_updating_lock_state_entries"><a class="anchor" href="#selectively_updating_lock_state_entries"></a><a class="link" href="#selectively_updating_lock_state_entries">Selectively updating lock state entries</a></h4>
<div class="paragraph">
<p>In order to update only specific modules of a configuration, you can use the <code>--update-locks</code> command line flag.
It takes a comma (<code>,</code>) separated list of module notations.
In this mode, the existing lock state is still used as input to resolution, filtering out the modules targeted by the update.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle dependencies --update-locks org.apache.commons:commons-lang3,org.slf4j:slf4j-api</pre>
</div>
</div>
<div class="paragraph">
<p>Wildcards, indicated with <code>*</code>, can be used in the group or module name. They can be the only character or appear at the end of the group or module respectively.
The following wildcard notation examples are valid:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.apache.commons:*</code>: will let all modules belonging to group <code>org.apache.commons</code> update</p>
</li>
<li>
<p><code>*:guava</code>: will let all modules named <code>guava</code>, whatever their group, update</p>
</li>
<li>
<p><code>org.springframework.spring*:spring*</code>: will let all modules having their group starting with <code>org.springframework.spring</code> and name starting with <code>spring</code> update</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The resolution may cause other module versions to update, as dictated by the Gradle resolution rules.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="disabling_dependency_locking"><a class="anchor" href="#disabling_dependency_locking"></a><a class="link" href="#disabling_dependency_locking">Disabling dependency locking</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that the configuration for which you no longer want locking is not configured with locking.</p>
</li>
<li>
<p>Next time you update the save lock state, Gradle will automatically clean up all stale lock state from it.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Gradle needs to resolve a configuration, no longer marked as locked, to detect that associated lock state can be dropped.</p>
</div>
</div>
<div class="sect3">
<h4 id="ignoring_dependencies"><a class="anchor" href="#ignoring_dependencies"></a><a class="link" href="#ignoring_dependencies">Ignoring specific dependencies from the lock state</a></h4>
<div class="paragraph">
<p>Dependency locking can be used in cases where reproducibility is not the main goal.
As a build author, you may want to have different frequency of dependency version updates, based on their origin for example.
In that case, it might be convenient to ignore some dependencies because you always want to use the latest version for those.
An example is the internal dependencies in an organization which should always use the latest version as opposed to third party dependencies which have a different upgrade cycle.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This feature can break reproducibility and should be used with caution.
There are scenarios that are better served with leveraging  <a href="#fine_tuning_dependency_locking_behaviour_with_lock_mode">different lock modes</a> or <a href="#configuring_the_per_project_lock_file_name_and_location">using different names for lock files</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can configure ignored dependencies in the <code>dependencyLocking</code> project extension:</p>
</div>
<div id="ex-ignoring-dependencies-for-the-lock-state" class="exampleblock">
<div class="title">Example 163. <a href="#ex-ignoring-dependencies-for-the-lock-state">Ignoring dependencies for the lock state</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyLocking {
    ignoredDependencies.add(&quot;com.example:*&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyLocking {
    ignoredDependencies.add(<span class="string"><span class="delimiter">'</span><span class="content">com.example:*</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The notation is a <code>&lt;group&gt;:&lt;name&gt;</code> dependency notation, where <code>*</code> can be used as a trailing wildcard.
See <a href="#selectively_updating_lock_state_entries">the description</a> on updating lock files for more details.
Note that the value <code>*:*</code> is not accepted as it is equivalent to disabling locking.</p>
</div>
<div class="paragraph">
<p>Ignoring dependencies will have the following effects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An ignored dependency applies to all locked configurations. The setting is project scoped.</p>
</li>
<li>
<p>Ignoring a dependency does not mean lock state ignores its transitive dependencies.</p>
</li>
<li>
<p>There is no validation that an ignored dependency is present in any configuration resolution.</p>
</li>
<li>
<p>If the dependency is present in lock state, loading it will filter out the dependency.</p>
</li>
<li>
<p>If the dependency is present in the resolution result, it will be ignored when validating that resolution matches the lock state.</p>
</li>
<li>
<p>Finally, if the dependency is present in the resolution result and the lock state is persisted, it will be absent from the written lock state.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="locking_limitations"><a class="anchor" href="#locking_limitations"></a><a class="link" href="#locking_limitations">Locking limitations</a></h4>
<div class="ulist">
<ul>
<li>
<p>Locking cannot yet be applied to source dependencies.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="nebula_locking_plugin"><a class="anchor" href="#nebula_locking_plugin"></a><a class="link" href="#nebula_locking_plugin">Nebula locking plugin</a></h4>
<div class="paragraph">
<p>This feature is inspired by the <a href="https://github.com/nebula-plugins/gradle-dependency-lock-plugin">Nebula Gradle dependency lock plugin</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="controlling_transitives"><a class="anchor" href="#controlling_transitives"></a><a class="link" href="#controlling_transitives">CONTROLLING TRANSITIVES</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dependency-constraints"><a class="anchor" href="#dependency-constraints"></a><a class="link" href="#dependency-constraints">Upgrading versions of transitive dependencies</a></h3>
<div class="sect3">
<h4 id="sec:direct-vs-transitive-deps"><a class="anchor" href="#sec:direct-vs-transitive-deps"></a><a class="link" href="#sec:direct-vs-transitive-deps">Direct dependencies vs dependency constraints</a></h4>
<div class="paragraph">
<p>A component may have two different kinds of dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>direct dependencies are <em>directly required by the component</em>.
A direct dependency is also referred to as a <em>first level dependency</em>.
For example, if your project source code requires Guava, Guava should be declared as <em>direct dependency</em>.</p>
</li>
<li>
<p>transitive dependencies are dependencies that your component needs, but only because another dependency needs them.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s quite common that issues with dependency management are about <em>transitive dependencies</em>.
Often developers incorrectly fix transitive dependency issues by adding <em>direct dependencies</em>.
To avoid this, Gradle provides the concept of <em>dependency constraints</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:adding-constraints-transitive-deps"><a class="anchor" href="#sec:adding-constraints-transitive-deps"></a><a class="link" href="#sec:adding-constraints-transitive-deps">Adding constraints on transitive dependencies</a></h4>
<div class="paragraph">
<p>Dependency constraints allow you to define the version or the version range of both dependencies declared in the build script and transitive dependencies.
It is the preferred method to express constraints that should be applied to all dependencies of a configuration.
When Gradle attempts to resolve a dependency to a module version, all <a href="#rich-version-constraints">dependency declarations with version</a>, all transitive dependencies and all dependency constraints for that module are taken into consideration.
The highest version that matches all conditions is selected.
If no such version is found, Gradle fails with an error showing the conflicting declarations.
If this happens you can adjust your dependencies or dependency constraints declarations, or make other adjustments to the transitive dependencies if needed.
Similar to dependency declarations, dependency constraint declarations are <a href="#sec:what-are-dependency-configurations">scoped by configurations</a> and can therefore be selectively defined for parts of a build.
If a dependency constraint influenced the resolution result, any type of <a href="#sec:dependency_resolve_rules">dependency resolve rules</a> may still be applied afterwards.</p>
</div>
<div id="ex-define-dependency-constraints" class="exampleblock">
<div class="title">Example 164. <a href="#ex-define-dependency-constraints">Define dependency constraints</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.apache.httpcomponents:httpclient&quot;)
    constraints {
        implementation(&quot;org.apache.httpcomponents:httpclient:4.5.3&quot;) {
            because(&quot;previous versions have a bug impacting this application&quot;)
        }
        implementation(&quot;commons-codec:commons-codec:1.11&quot;) {
            because(&quot;version 1.9 pulled from httpclient has bugs affecting this application&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient</span><span class="delimiter">'</span></span>
    constraints {
        implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient:4.5.3</span><span class="delimiter">'</span></span>) {
            because <span class="string"><span class="delimiter">'</span><span class="content">previous versions have a bug impacting this application</span><span class="delimiter">'</span></span>
        }
        implementation(<span class="string"><span class="delimiter">'</span><span class="content">commons-codec:commons-codec:1.11</span><span class="delimiter">'</span></span>) {
            because <span class="string"><span class="delimiter">'</span><span class="content">version 1.9 pulled from httpclient has bugs affecting this application</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example, all versions are omitted from the dependency declaration.
Instead, the versions are defined in the constraints block.
The version definition for <code>commons-codec:1.11</code> is only taken into account if <code>commons-codec</code> is brought in as transitive dependency, since <code>commons-codec</code> is not defined as dependency in the project.
Otherwise, the constraint has no effect.
Dependency constraints can also define a <a href="#rich-version-constraints">rich version constraint</a> and support <a href="#sec:strict-version">strict versions</a> to enforce a version even if it contradicts with the version defined by a transitive dependency (e.g. if the version needs to be downgraded).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Dependency constraints are only published when using <a href="#sec:understanding-gradle-module-md">Gradle Module Metadata</a>.
This means that currently they are only fully supported if Gradle is used for publishing and consuming (i.e. they are 'lost' when consuming modules with Maven or Ivy).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Dependency constraints themselves can also be added transitively.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="downgrading_versions_and_excluding_dependencies"><a class="anchor" href="#downgrading_versions_and_excluding_dependencies"></a><a class="link" href="#downgrading_versions_and_excluding_dependencies">Downgrading versions and excluding dependencies</a></h3>
<div class="sect3">
<h4 id="sec:enforcing_dependency_version"><a class="anchor" href="#sec:enforcing_dependency_version"></a><a class="link" href="#sec:enforcing_dependency_version">Overriding transitive dependency versions</a></h4>
<div class="paragraph">
<p>Gradle resolves any dependency version conflicts by selecting the latest version found in the dependency graph.
Some projects might need to divert from the default behavior and enforce an earlier version of a dependency e.g. if the source code of the project depends on an older API of a dependency than some of the external libraries.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Forcing a version of a dependency requires a conscious decision.
Changing the version of a transitive dependency might lead to runtime errors if external libraries do not properly function without them.
Consider upgrading your source code to use a newer version of the library as an alternative approach.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In general, forcing dependencies is done to downgrade a dependency.
There might be different use cases for downgrading:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a bug was discovered in the latest release</p>
</li>
<li>
<p>your code depends on a lower version which is not binary compatible</p>
</li>
<li>
<p>your code doesn&#8217;t depend on the code paths which need a higher version of a dependency</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all situations, this is best expressed saying that your code <em>strictly depends on</em> a version of a transitive.
Using <a href="#sec:strict-version">strict versions</a>, you will effectively depend on the version you declare, even if a transitive dependency says otherwise.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Strict dependencies are to some extent similar to Maven&#8217;s <em>nearest first</em> strategy, but there are subtle differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>strict dependencies</em> don&#8217;t suffer an ordering problem: they are applied transitively to the subgraph, and it doesn&#8217;t matter in which order dependencies are declared.</p>
</li>
<li>
<p>conflicting strict dependencies will trigger a build failure that you have to resolve</p>
</li>
<li>
<p>strict dependencies can be used with rich versions, meaning that <a href="#sec:strict-version-consequences">it&#8217;s better to express the requirement in terms of a <em>strict range</em> combined with a single <em>preferred version</em></a>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s say a project uses the <a href="https://hc.apache.org/httpcomponents-client-ga/">HttpClient library</a> for performing HTTP calls. HttpClient pulls in <a href="https://commons.apache.org/proper/commons-codec/">Commons Codec</a> as transitive dependency with version 1.10.
However, the production source code of the project requires an API from Commons Codec 1.9 which is not available in 1.10 anymore.
A dependency version can be enforced by declaring it as strict it in the build script:</p>
</div>
<div id="ex-setting-a-strict-version" class="exampleblock">
<div class="title">Example 165. <a href="#ex-setting-a-strict-version">Setting a strict version</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.apache.httpcomponents:httpclient:4.5.4&quot;)
    implementation(&quot;commons-codec:commons-codec&quot;) {
        version {
            strictly(&quot;1.9&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient:4.5.4</span><span class="delimiter">'</span></span>
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">commons-codec:commons-codec</span><span class="delimiter">'</span></span>) {
        version {
            strictly <span class="string"><span class="delimiter">'</span><span class="content">1.9</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:strict-version-consequences"><a class="anchor" href="#sec:strict-version-consequences"></a><a class="link" href="#sec:strict-version-consequences">Consequences of using strict versions</a></h5>
<div class="paragraph">
<p>Using a strict version must be carefully considered, in particular by library authors.
As the <em>producer</em>, a strict version will effectively behave like a <em>force</em>: the version declaration takes precedence over whatever is found in the transitive dependency graph.
In particular, a <em>strict version</em> will override any other <em>strict version</em> on the same module found transitively.</p>
</div>
<div class="paragraph">
<p>However, for consumers, strict versions are still considered globally during graph resolution and <em>may trigger an error</em> if the consumer disagrees.</p>
</div>
<div class="paragraph">
<p>For example, imagine that your project <code>B</code> <em>strictly</em> depends on <code>C:1.0</code>.
Now, a consumer, <code>A</code>, depends on both <code>B</code> and <code>C:1.1</code>.</p>
</div>
<div class="paragraph">
<p>Then this would trigger a resolution error because <code>A</code> says it needs <code>C:1.1</code> but <code>B</code>, <em>within its subgraph</em>, strictly needs <code>1.0</code>.
This means that if you choose a <em>single version</em> in a strict constraint, then the version can <em>no longer be upgraded</em>, unless the consumer also sets a strict version constraint on the same module.</p>
</div>
<div class="paragraph">
<p>In the example above, <code>A</code> would have to say it <em>strictly depends on 1.1</em>.</p>
</div>
<div class="paragraph">
<p>For this reason, a good practice is that if you use <em>strict versions</em>, you should express them in terms of ranges and a preferred version within this range.
For example, <code>B</code> might say, instead of <code>strictly 1.0</code>, that it <em>strictly depends</em> on the <code>[1.0, 2.0[</code> range, but <em>prefers</em> <code>1.0</code>.
Then if a consumer chooses 1.1 (or any other version in the range), the build will <em>no longer fail</em> (constraints are resolved).</p>
</div>
</div>
<div class="sect4">
<h5 id="forced_dependencies_vs_strict_dependencies"><a class="anchor" href="#forced_dependencies_vs_strict_dependencies"></a><a class="link" href="#forced_dependencies_vs_strict_dependencies">Forced dependencies vs strict dependencies</a></h5>
<div class="paragraph">
<p>If the project requires a specific version of a dependency at the configuration-level this can be achieved by calling the method <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.ResolutionStrategy.html#org.gradle.api.artifacts.ResolutionStrategy:force(java.lang.Object[])">ResolutionStrategy.force(java.lang.Object[])</a>.</p>
</div>
<div id="ex-enforcing-a-dependency-version-on-the-configuration-level" class="exampleblock">
<div class="title">Example 166. <a href="#ex-enforcing-a-dependency-version-on-the-configuration-level">Enforcing a dependency version on the configuration-level</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    &quot;compileClasspath&quot; {
        resolutionStrategy.force(&quot;commons-codec:commons-codec:1.9&quot;)
    }
}

dependencies {
    implementation(&quot;org.apache.httpcomponents:httpclient:4.5.4&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    compileClasspath {
        resolutionStrategy.force <span class="string"><span class="delimiter">'</span><span class="content">commons-codec:commons-codec:1.9</span><span class="delimiter">'</span></span>
    }
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient:4.5.4</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:excluding-transitive-deps"><a class="anchor" href="#sec:excluding-transitive-deps"></a><a class="link" href="#sec:excluding-transitive-deps">Excluding transitive dependencies</a></h4>
<div class="paragraph">
<p>While the previous section showed how you can enforce a certain version of a transitive dependency, this section covers <em>excludes</em> as a way to remove a transitive dependency completely.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Similar to forcing a version of a dependency, excluding a dependency completely requires a conscious decision.
Excluding a transitive dependency might lead to runtime errors if external libraries do not properly function without them.
If you use excludes, make sure that you do not utilise any code path requiring the excluded dependency by sufficient test coverage.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Transitive dependencies can be excluded on the level of a declared dependency.
Exclusions are spelled out as a key/value pair via the attributes <code>group</code> and/or <code>module</code> as shown in the example below.
For more information, refer to <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ModuleDependency.html#exclude-java.util.Map-">ModuleDependency.exclude(java.util.Map)</a>.</p>
</div>
<div id="ex-excluding-a-transitive-dependency-for-a-particular-dependency-declaration" class="exampleblock">
<div class="title">Example 167. <a href="#ex-excluding-a-transitive-dependency-for-a-particular-dependency-declaration">Excluding a transitive dependency for a particular dependency declaration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;commons-beanutils:commons-beanutils:1.9.4&quot;) {
        exclude(group = &quot;commons-collections&quot;, module = &quot;commons-collections&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">commons-beanutils:commons-beanutils:1.9.4</span><span class="delimiter">'</span></span>) {
        exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, we add a dependency to <code>commons-beanutils</code> but exclude the transitive dependency <code>commons-collections</code>.
In our code, shown below, we only use one method from the beanutils library, <code>PropertyUtils.setSimpleProperty()</code>.
Using this method for existing setters does not require any functionality from <code>commons-collections</code> as we verified through test coverage.</p>
</div>
<div id="ex-using-a-utility-from-the-beanutils-library" class="exampleblock">
<div class="title">Example 168. <a href="#ex-using-a-utility-from-the-beanutils-library">Using a utility from the beanutils library</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">src/main/java/Main.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.apache.commons.beanutils.PropertyUtils</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Main</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">Object</span> person = <span class="keyword">new</span> Person();
        PropertyUtils.setSimpleProperty(person, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bart Simpson</span><span class="delimiter">&quot;</span></span>);
        PropertyUtils.setSimpleProperty(person, <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">38</span>);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Effectively, we are expressing that we only use a <em>subset</em> of the library, which does not require the <code>commons-collection</code> library.
This can be seen as implicitly defining a <a href="#feature_variants">feature variant</a> that has not been explicitly declared by <code>commons-beanutils</code> itself.
However, the risk of breaking an untested code path increased by doing this.</p>
</div>
<div class="paragraph">
<p>For example, here we use the <code>setSimpleProperty()</code> method to modify properties defined by setters in the <code>Person</code> class, which works fine.
If we would attempt to set a property not existing on the class, we <em>should</em> get an error like <code>Unknown property on class Person</code>.
However, because the error handling path uses a class from <code>commons-collections</code>, the error we now get is <code>NoClassDefFoundError: org/apache/commons/collections/FastHashMap</code>.
So if our code would be more dynamic, and we would forget to cover the error case sufficiently, consumers of our library might be confronted with unexpected errors.</p>
</div>
<div class="paragraph">
<p>This is only an example to illustrate potential pitfalls.
In practice, larger libraries or frameworks can bring in a huge set of dependencies.
If those libraries fail to declare features separately and can only be consumed in a "all or nothing" fashion, excludes can be a valid method to reduce the library to the feature set actually required.</p>
</div>
<div class="paragraph">
<p>On the upside, Gradle&#8217;s exclude handling is, in contrast to Maven, taking the whole dependency graph into account.
So if there are multiple dependencies on a library, excludes are only exercised if all dependencies agree on them.
For example, if we add <code>opencsv</code> as another dependency to our project above, which also depends on <code>commons-beanutils</code>, <code>commons-collection</code> is no longer excluded as <code>opencsv</code> itself does <strong>not</strong> exclude it.</p>
</div>
<div id="ex-excludes-only-apply-if-all-dependency-declarations-agree-on-an-exclude" class="exampleblock">
<div class="title">Example 169. <a href="#ex-excludes-only-apply-if-all-dependency-declarations-agree-on-an-exclude">Excludes only apply if all dependency declarations agree on an exclude</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;commons-beanutils:commons-beanutils:1.9.4&quot;) {
        exclude(group = &quot;commons-collections&quot;, module = &quot;commons-collections&quot;)
    }
    implementation(&quot;com.opencsv:opencsv:4.6&quot;) // depends on 'commons-beanutils' without exclude and brings back 'commons-collections'
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">commons-beanutils:commons-beanutils:1.9.4</span><span class="delimiter">'</span></span>) {
        exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>
    }
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.opencsv:opencsv:4.6</span><span class="delimiter">'</span></span> <span class="comment">// depends on 'commons-beanutils' without exclude and brings back 'commons-collections'</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we still want to have <code>commons-collections</code> excluded, because our combined usage of <code>commons-beanutils</code> and <code>opencsv</code> does not need it, we need to exclude it from the transitive dependencies of <code>opencsv</code> as well.</p>
</div>
<div id="ex-excluding-a-transitive-dependency-for-multiple-dependency-declaration" class="exampleblock">
<div class="title">Example 170. <a href="#ex-excluding-a-transitive-dependency-for-multiple-dependency-declaration">Excluding a transitive dependency for multiple dependency declaration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;commons-beanutils:commons-beanutils:1.9.4&quot;) {
        exclude(group = &quot;commons-collections&quot;, module = &quot;commons-collections&quot;)
    }
    implementation(&quot;com.opencsv:opencsv:4.6&quot;) {
        exclude(group = &quot;commons-collections&quot;, module = &quot;commons-collections&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">commons-beanutils:commons-beanutils:1.9.4</span><span class="delimiter">'</span></span>) {
        exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>
    }
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">com.opencsv:opencsv:4.6</span><span class="delimiter">'</span></span>) {
        exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Historically, excludes were also used as a band aid to fix other issues not supported by some dependency management systems.
Gradle however, offers a variety of features that might be better suited to solve a certain use case.
You may consider to look into the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sec:enforcing_dependency_version">Update</a> or <a href="#sec:enforcing_dependency_version">downgrade</a> dependency versions:
If versions of dependencies clash, it is usually better to adjust the version through a dependency constraint, instead of attempting to exclude the dependency with the undesired version.</p>
</li>
<li>
<p><a href="#sec:component_metadata_rules">Component Metadata Rules</a>:
If a library&#8217;s metadata is clearly wrong, for example if it includes a compile time dependency which is never needed at compile time, a possible solution is to remove the dependency in a component metadata rule.
By this, you tell Gradle that a dependency between two modules is never needed — i.e. the metadata was wrong — and therefore should <strong>never</strong> be considered.
If you are developing a library, you have to be aware that this information is not published, and so sometimes an <em>exclude</em> can be the better alternative.</p>
</li>
<li>
<p><a href="#sec:handling-mutually-exclusive-deps">Resolving mutually exclusive dependency conflicts</a>:
Another situation that you often see solved by excludes is that two dependencies cannot be used together because they represent two implementations of the same thing (the same <a href="#sub:capabilities">capability</a>).
Some popular examples are clashing logging API implementations (like <code>log4j</code> and <code>log4j-over-slf4j</code>) or modules that have different coordinates in different versions (like <code>com.google.collections</code> and <code>guava</code>).
In these cases, if this information is not known to Gradle, it is recommended to add the missing capability information via component metadata rules as described in the <a href="#sub:declaring-component-capabilities">declaring component capabilities</a> section.
Even if you are developing a library, and your consumers will have to deal with resolving the conflict again, it is often the right solution to leave the decision to the final consumers of libraries.
I.e. you as a library author should not have to decide which logging implementation your consumers use in the end.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec:sharing-dep-versions-between-projects"><a class="anchor" href="#sec:sharing-dep-versions-between-projects"></a><a class="link" href="#sec:sharing-dep-versions-between-projects">Sharing dependency versions between projects</a></h3>
<div class="sect3">
<h4 id="sub:central-declaration-of-dependencies"><a class="anchor" href="#sub:central-declaration-of-dependencies"></a><a class="link" href="#sub:central-declaration-of-dependencies">Central declaration of dependencies</a></h4>
<div class="sect4">
<h5 id="sub:version-catalog"><a class="anchor" href="#sub:version-catalog"></a><a class="link" href="#sub:version-catalog">Using a version catalog</a></h5>
<div class="paragraph">
<p>A <em>version catalog</em> is a list of dependencies, represented as dependency coordinates, that a user can pick from when declaring dependencies in a build script.</p>
</div>
<div class="paragraph">
<p>For example, instead of declaring a dependency using a string notation, the dependency coordinates can be picked from a <em>version catalog</em>:</p>
</div>
<div id="ex-using-a-library-declared-in-a-version-catalog" class="exampleblock">
<div class="title">Example 171. <a href="#ex-using-a-library-declared-in-a-version-catalog">Using a library declared in a version catalog</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(libs.groovy.core)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(libs.groovy.core)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this context, <code>libs</code> is a catalog and <code>groovy</code> represents a dependency available in this catalog. A version catalog provides a number of advantages over declaring the dependencies directly in build scripts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For each catalog, Gradle generates <em>type-safe accessors</em> so that you can easily add dependencies with autocompletion in the IDE.</p>
</li>
<li>
<p>Each catalog is visible to all projects of a build. It is a central place to declare a version of a dependency and to make sure that a change to that version applies to every subproject.</p>
</li>
<li>
<p>Catalogs can declare <a href="#sec:dependency-bundles">dependency bundles</a>, which are "groups of dependencies" that are commonly used together.</p>
</li>
<li>
<p>Catalogs can separate the group and name of a dependency from its actual version and use <a href="#sec:common-version-numbers">version references</a> instead, making it possible to share a version declaration between multiple dependencies.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Adding a dependency using the <code>libs.someLib</code> notation works exactly like if you had hardcoded the group, artifact and version directly in the build script.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
A dependency catalog doesn&#8217;t enforce the version of a dependency: like a regular dependency notation, it declares the requested version or a <a href="#rich-version-constraints">rich version</a>.
That version is not necessarily the version that is selected during <a href="#understanding_dependency_resolution">conflict resolution</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sub:version-catalog-declaration"><a class="anchor" href="#sub:version-catalog-declaration"></a><a class="link" href="#sub:version-catalog-declaration">Declaring a version catalog</a></h5>
<div class="paragraph">
<p>Version catalogs can be declared in the <code>settings.gradle(.kts)</code> file.
In the example above, in order to make <code>groovy</code> available via the <code>libs</code> catalog, we need to associate an alias with GAV (group, artifact, version) coordinates:</p>
</div>
<div id="ex-declaring-a-version-catalog" class="exampleblock">
<div class="title">Example 172. <a href="#ex-declaring-a-version-catalog">Declaring a version catalog</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    versionCatalogs {
        create(&quot;libs&quot;) {
            library(&quot;groovy-core&quot;, &quot;org.codehaus.groovy:groovy:3.0.5&quot;)
            library(&quot;groovy-json&quot;, &quot;org.codehaus.groovy:groovy-json:3.0.5&quot;)
            library(&quot;groovy-nio&quot;, &quot;org.codehaus.groovy:groovy-nio:3.0.5&quot;)
            library(&quot;commons-lang3&quot;, &quot;org.apache.commons&quot;, &quot;commons-lang3&quot;).version {
                strictly(&quot;[3.8, 4.0[&quot;)
                prefer(&quot;3.9&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    versionCatalogs {
        libs {
            library(<span class="string"><span class="delimiter">'</span><span class="content">groovy-core</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy:3.0.5</span><span class="delimiter">'</span></span>)
            library(<span class="string"><span class="delimiter">'</span><span class="content">groovy-json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy-json:3.0.5</span><span class="delimiter">'</span></span>)
            library(<span class="string"><span class="delimiter">'</span><span class="content">groovy-nio</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy-nio:3.0.5</span><span class="delimiter">'</span></span>)
            library(<span class="string"><span class="delimiter">'</span><span class="content">commons-lang3</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">commons-lang3</span><span class="delimiter">'</span></span>).version {
                strictly <span class="string"><span class="delimiter">'</span><span class="content">[3.8, 4.0[</span><span class="delimiter">'</span></span>
                prefer <span class="string"><span class="delimiter">'</span><span class="content">3.9</span><span class="delimiter">'</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sub:mapping-aliases-to-accessors"><a class="anchor" href="#sub:mapping-aliases-to-accessors"></a><a class="link" href="#sub:mapping-aliases-to-accessors">Aliases and their mapping to type safe accessors</a></h6>
<div class="paragraph">
<p>Aliases must consist of a series of identifiers separated by a dash (<code>-</code>, recommended), an underscore (<code>_</code>) or a dot (<code>.</code>).
Identifiers themselves must consist of ascii characters, preferably lowercase, eventually followed by numbers.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>guava</code> is a valid alias</p>
</li>
<li>
<p><code>groovy-core</code> is a valid alias</p>
</li>
<li>
<p><code>commons-lang3</code> is a valid alias</p>
</li>
<li>
<p><code>androidx.awesome.lib</code> is also a valid alias</p>
</li>
<li>
<p>but <code>this.#is.not!</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then type safe accessors are generated for <em>each subgroup</em>.
For example, given the following aliases in a version catalog named <code>libs</code>:</p>
</div>
<div class="paragraph">
<p><code>guava</code>, <code>groovy-core</code>, <code>groovy-xml</code>, <code>groovy-json</code>, <code>androidx.awesome.lib</code></p>
</div>
<div class="paragraph">
<p>We would generate the following type-safe accessors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>libs.guava</code></p>
</li>
<li>
<p><code>libs.groovy.core</code></p>
</li>
<li>
<p><code>libs.groovy.xml</code></p>
</li>
<li>
<p><code>libs.groovy.json</code></p>
</li>
<li>
<p><code>libs.androidx.awesome.lib</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where the <code>libs</code> prefix comes from the version catalog name.</p>
</div>
<div class="paragraph">
<p>In case you want to avoid the generation of a subgroup accessor, we recommend relying on case to differentiate.
For example the aliases <code>groovyCore</code>, <code>groovyJson</code> and <code>groovyXml</code> would be mapped to the <code>libs.groovyCore</code>, <code>libs.groovyJson</code> and <code>libs.groovyXml</code> accessors respectively.</p>
</div>
<div class="paragraph">
<p>When declaring aliases, it&#8217;s worth noting that any of the <code>-</code>, <code>_</code> and <code>.</code> characters can be used as separators, but the generated catalog will have all normalized to <code>.</code>:
for example <code>foo-bar</code> as an alias is converted to <code>foo.bar</code> automatically.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Some keywords are reserved, so they cannot be used as an alias. Next words cannot be used as an alias:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>extensions</p>
</li>
<li>
<p>class</p>
</li>
<li>
<p>convention</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional to that next words cannot be used as a first subgroup of an alias for dependencies (for bundles, versions and plugins this restriction doesn&#8217;t apply):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>bundles</p>
</li>
<li>
<p>versions</p>
</li>
<li>
<p>plugins</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So for example for dependencies an alias <code>versions-dependency</code> is not valid, but <code>versionsDependency</code> or <code>dependency-versions</code> are valid.</p>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:common-version-numbers"><a class="anchor" href="#sec:common-version-numbers"></a><a class="link" href="#sec:common-version-numbers">Dependencies with same version numbers</a></h6>
<div class="paragraph">
<p>In the first example in <a href="#sub:version-catalog-declaration">declaring a version catalog</a>, we can see that we declare 3 aliases for various components of the <code>groovy</code> library and that all of them share the same version number.</p>
</div>
<div class="paragraph">
<p>Instead of repeating the same version number, we can declare a version and reference it:</p>
</div>
<div id="ex-declaring-versions-separately-from-libraries" class="exampleblock">
<div class="title">Example 173. <a href="#ex-declaring-versions-separately-from-libraries">Declaring versions separately from libraries</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    versionCatalogs {
        create(&quot;libs&quot;) {
            version(&quot;groovy&quot;, &quot;3.0.5&quot;)
            version(&quot;checkstyle&quot;, &quot;8.37&quot;)
            library(&quot;groovy-core&quot;, &quot;org.codehaus.groovy&quot;, &quot;groovy&quot;).versionRef(&quot;groovy&quot;)
            library(&quot;groovy-json&quot;, &quot;org.codehaus.groovy&quot;, &quot;groovy-json&quot;).versionRef(&quot;groovy&quot;)
            library(&quot;groovy-nio&quot;, &quot;org.codehaus.groovy&quot;, &quot;groovy-nio&quot;).versionRef(&quot;groovy&quot;)
            library(&quot;commons-lang3&quot;, &quot;org.apache.commons&quot;, &quot;commons-lang3&quot;).version {
                strictly(&quot;[3.8, 4.0[&quot;)
                prefer(&quot;3.9&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    versionCatalogs {
        libs {
            version(<span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">3.0.5</span><span class="delimiter">'</span></span>)
            version(<span class="string"><span class="delimiter">'</span><span class="content">checkstyle</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">8.37</span><span class="delimiter">'</span></span>)
            library(<span class="string"><span class="delimiter">'</span><span class="content">groovy-core</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>).versionRef(<span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>)
            library(<span class="string"><span class="delimiter">'</span><span class="content">groovy-json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">groovy-json</span><span class="delimiter">'</span></span>).versionRef(<span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>)
            library(<span class="string"><span class="delimiter">'</span><span class="content">groovy-nio</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">groovy-nio</span><span class="delimiter">'</span></span>).versionRef(<span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>)
            library(<span class="string"><span class="delimiter">'</span><span class="content">commons-lang3</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">commons-lang3</span><span class="delimiter">'</span></span>).version {
                strictly <span class="string"><span class="delimiter">'</span><span class="content">[3.8, 4.0[</span><span class="delimiter">'</span></span>
                prefer <span class="string"><span class="delimiter">'</span><span class="content">3.9</span><span class="delimiter">'</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Versions declared separately are <em>also</em> available via type-safe accessors, making them usable for more use cases than dependency versions, in particular for tooling:</p>
</div>
<div id="ex-using-a-version-declared-in-a-version-catalog" class="exampleblock">
<div class="title">Example 174. <a href="#ex-using-a-version-declared-in-a-version-catalog">Using a version declared in a version catalog</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">checkstyle {
    // will use the version declared in the catalog
    toolVersion = libs.versions.checkstyle.get()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">checkstyle {
    <span class="comment">// will use the version declared in the catalog</span>
    toolVersion = libs.versions.checkstyle.get()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the alias of a declared version is also a prefix of some more specific alias, as in <code>libs.versions.zinc</code> and <code>libs.versions.zinc.apiinfo</code>, then
the value of the more generic version is available via <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/ProviderConvertible.html#asProvider--"><code>asProvider()</code></a> on the type-safe accessor:</p>
</div>
<div id="ex-using-a-version-from-a-version-catalog-when-there-are-more-specific-aliases" class="exampleblock">
<div class="title">Example 175. <a href="#ex-using-a-version-from-a-version-catalog-when-there-are-more-specific-aliases">Using a version from a version catalog when there are more specific aliases</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">scala {
    zincVersion = libs.versions.zinc.asProvider().get()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">scala {
    zincVersion = libs.versions.zinc.asProvider().get()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Dependencies declared in a catalog are exposed to build scripts via an extension corresponding to their name.
In the example above, because the catalog declared in settings is named <code>libs</code>, the extension is available via the name <code>libs</code> in all build scripts of the current build.
Declaring dependencies using the following notation&#8230;&#8203;</p>
</div>
<div id="ex-dependency-notation-correspondance" class="exampleblock">
<div class="title">Example 176. <a href="#ex-dependency-notation-correspondance">Dependency notation correspondance</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(libs.groovy.core)
    implementation(libs.groovy.json)
    implementation(libs.groovy.nio)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation libs.groovy.core
    implementation libs.groovy.json
    implementation libs.groovy.nio
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;has <strong>exactly the same</strong> effect as writing:</p>
</div>
<div id="ex-dependency-notation-correspondance" class="exampleblock">
<div class="title">Example 177. <a href="#ex-dependency-notation-correspondance">Dependency notation correspondance</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.codehaus.groovy:groovy:3.0.5&quot;)
    implementation(&quot;org.codehaus.groovy:groovy-json:3.0.5&quot;)
    implementation(&quot;org.codehaus.groovy:groovy-nio:3.0.5&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy:3.0.5</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy-json:3.0.5</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy-nio:3.0.5</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Versions declared in the catalog are <a href="#rich-version-constraints">rich versions</a>.
Please refer to the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/initialization/dsl/VersionCatalogBuilder.html">version catalog builder API</a> for the full version declaration support documentation.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:dependency-bundles"><a class="anchor" href="#sec:dependency-bundles"></a><a class="link" href="#sec:dependency-bundles">Dependency bundles</a></h6>
<div class="paragraph">
<p>Because it&#8217;s frequent that some dependencies are systematically used together in different projects, a version catalog offers the concept of a "dependency bundle".
A bundle is basically an alias for several dependencies.
For example, instead of declaring 3 individual dependencies like above, you could write:</p>
</div>
<div id="ex-using-a-dependency-bundle" class="exampleblock">
<div class="title">Example 178. <a href="#ex-using-a-dependency-bundle">Using a dependency bundle</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(libs.bundles.groovy)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation libs.bundles.groovy
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The bundle named <code>groovy</code> needs to be declared in the catalog:</p>
</div>
<div id="ex-declaring-a-dependency-bundle" class="exampleblock">
<div class="title">Example 179. <a href="#ex-declaring-a-dependency-bundle">Declaring a dependency bundle</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    versionCatalogs {
        create(&quot;libs&quot;) {
            version(&quot;groovy&quot;, &quot;3.0.5&quot;)
            version(&quot;checkstyle&quot;, &quot;8.37&quot;)
            library(&quot;groovy-core&quot;, &quot;org.codehaus.groovy&quot;, &quot;groovy&quot;).versionRef(&quot;groovy&quot;)
            library(&quot;groovy-json&quot;, &quot;org.codehaus.groovy&quot;, &quot;groovy-json&quot;).versionRef(&quot;groovy&quot;)
            library(&quot;groovy-nio&quot;, &quot;org.codehaus.groovy&quot;, &quot;groovy-nio&quot;).versionRef(&quot;groovy&quot;)
            library(&quot;commons-lang3&quot;, &quot;org.apache.commons&quot;, &quot;commons-lang3&quot;).version {
                strictly(&quot;[3.8, 4.0[&quot;)
                prefer(&quot;3.9&quot;)
            }
            bundle(&quot;groovy&quot;, listOf(&quot;groovy-core&quot;, &quot;groovy-json&quot;, &quot;groovy-nio&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    versionCatalogs {
        libs {
            version(<span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">3.0.5</span><span class="delimiter">'</span></span>)
            version(<span class="string"><span class="delimiter">'</span><span class="content">checkstyle</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">8.37</span><span class="delimiter">'</span></span>)
            library(<span class="string"><span class="delimiter">'</span><span class="content">groovy-core</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>).versionRef(<span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>)
            library(<span class="string"><span class="delimiter">'</span><span class="content">groovy-json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">groovy-json</span><span class="delimiter">'</span></span>).versionRef(<span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>)
            library(<span class="string"><span class="delimiter">'</span><span class="content">groovy-nio</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">groovy-nio</span><span class="delimiter">'</span></span>).versionRef(<span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>)
            library(<span class="string"><span class="delimiter">'</span><span class="content">commons-lang3</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">commons-lang3</span><span class="delimiter">'</span></span>).version {
                strictly <span class="string"><span class="delimiter">'</span><span class="content">[3.8, 4.0[</span><span class="delimiter">'</span></span>
                prefer <span class="string"><span class="delimiter">'</span><span class="content">3.9</span><span class="delimiter">'</span></span>
            }
            bundle(<span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>, [<span class="string"><span class="delimiter">'</span><span class="content">groovy-core</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">groovy-json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">groovy-nio</span><span class="delimiter">'</span></span>])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The semantics are again equivalent: adding a single bundle is equivalent to adding all dependencies which are part of the bundle individually.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:plugins_ver"><a class="anchor" href="#sec:plugins_ver"></a><a class="link" href="#sec:plugins_ver">Plugins</a></h6>
<div class="paragraph">
<p>In addition to libraries, version catalog supports declaring plugin versions.
While libraries are represented by their group, artifact and version coordinates, Gradle plugins are identified by their id and version only.
Therefore, they need to be declared separately:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
You cannot use a plugin declared in a version catalog in your settings file or settings plugin (because catalogs are defined in settings themselves, it would be a chicken and egg problem).
</td>
</tr>
</table>
</div>
<div id="ex-declaring-a-plugin-version" class="exampleblock">
<div class="title">Example 180. <a href="#ex-declaring-a-plugin-version">Declaring a plugin version</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    versionCatalogs {
        create(&quot;libs&quot;) {
            plugin(&quot;versions&quot;, &quot;com.github.ben-manes.versions&quot;).version(&quot;0.45.0&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    versionCatalogs {
        libs {
            plugin(<span class="string"><span class="delimiter">'</span><span class="content">versions</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">com.github.ben-manes.versions</span><span class="delimiter">'</span></span>).version(<span class="string"><span class="delimiter">'</span><span class="content">0.45.0</span><span class="delimiter">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then the plugin is accessible in the <code>plugins</code> block and can be consumed in any project of the build using:</p>
</div>
<div id="ex-using-a-plugin-declared-in-a-catalog" class="exampleblock">
<div class="title">Example 181. <a href="#ex-using-a-plugin-declared-in-a-catalog">Using a plugin declared in a catalog</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
    checkstyle
    alias(libs.plugins.versions)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">checkstyle</span><span class="delimiter">'</span></span>
    <span class="comment">// Use the plugin `versions` as declared in the `libs` version catalog</span>
    alias(libs.plugins.versions)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:multiple"><a class="anchor" href="#sec:multiple"></a><a class="link" href="#sec:multiple">Using multiple catalogs</a></h6>
<div class="paragraph">
<p>Aside from the conventional <code>libs</code> catalog, you can declare any number of catalogs through the <code>Settings</code> API.
This allows you to separate dependency declarations in multiple sources in a way that makes sense for your projects.</p>
</div>
<div id="ex-using-a-custom-catalog" class="exampleblock">
<div class="title">Example 182. <a href="#ex-using-a-custom-catalog">Using a custom catalog</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    versionCatalogs {
        create(&quot;testLibs&quot;) {
            val junit5 = version(&quot;junit5&quot;, &quot;5.7.1&quot;)
            library(&quot;junit-api&quot;, &quot;org.junit.jupiter&quot;, &quot;junit-jupiter-api&quot;).versionRef(junit5)
            library(&quot;junit-engine&quot;, &quot;org.junit.jupiter&quot;, &quot;junit-jupiter-engine&quot;).versionRef(junit5)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    versionCatalogs {
        testLibs {
            <span class="keyword">def</span> junit5 = version(<span class="string"><span class="delimiter">'</span><span class="content">junit5</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">5.7.1</span><span class="delimiter">'</span></span>)
            library(<span class="string"><span class="delimiter">'</span><span class="content">junit-api</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.junit.jupiter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">junit-jupiter-api</span><span class="delimiter">'</span></span>).versionRef(junit5)
            library(<span class="string"><span class="delimiter">'</span><span class="content">junit-engine</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.junit.jupiter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">junit-jupiter-engine</span><span class="delimiter">'</span></span>).versionRef(junit5)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Each catalog will generate an extension applied to all projects for accessing its content.
As such it makes sense to reduce the chance of collisions by picking a name that reduces the potential conflicts.
As an example, one option is to pick a name that ends with <code>Libs</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:conventional-dependencies-toml"><a class="anchor" href="#sub:conventional-dependencies-toml"></a><a class="link" href="#sub:conventional-dependencies-toml">The libs.versions.toml file</a></h5>
<div class="paragraph">
<p>In addition to the settings API above, Gradle offers a conventional file to declare a catalog.
If a <code>libs.versions.toml</code> file is found in the <code>gradle</code> subdirectory of the root build, then a catalog will be automatically declared with the contents of this file.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Declaring a <code>libs.versions.toml</code> file doesn&#8217;t make it the single source of truth for dependencies: it&#8217;s a conventional location where dependencies can be declared.
As soon as you start using catalogs, it&#8217;s strongly recommended to declare all your dependencies in a catalog and not hardcode group/artifact/version strings in build scripts.
Be aware that it may happen that plugins add dependencies, which are dependencies defined outside of this file.</p>
</div>
<div class="paragraph">
<p>Just like <code>src/main/java</code> is a convention to find the Java sources, which doesn&#8217;t prevent additional source directories to be declared (either in a build script or a plugin), the presence of the <code>libs.versions.toml</code> file doesn&#8217;t prevent the declaration of dependencies elsewhere.</p>
</div>
<div class="paragraph">
<p>The presence of this file does, however, suggest that most dependencies, if not all, will be declared in this file.
Therefore, updating a dependency version, for most users, should only consists of changing a line in this file.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, the <code>libs.versions.toml</code> file will be an input to the <code>libs</code> catalog.
It is possible to change the name of the default catalog, for example if you already have an extension with the same name:</p>
</div>
<div id="ex-changing-the-default-extension-name" class="exampleblock">
<div class="title">Example 183. <a href="#ex-changing-the-default-extension-name">Changing the default extension name</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    defaultLibrariesExtensionName = &quot;projectLibs&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    defaultLibrariesExtensionName = <span class="string"><span class="delimiter">'</span><span class="content">projectLibs</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sub::toml-dependencies-format"><a class="anchor" href="#sub::toml-dependencies-format"></a><a class="link" href="#sub::toml-dependencies-format">The version catalog TOML file format</a></h6>
<div class="paragraph">
<p>The <a href="https://toml.io/">TOML</a> file consists of 4 major sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>[versions]</code> section is used to declare versions which can be referenced by dependencies</p>
</li>
<li>
<p>the <code>[libraries]</code> section is used to declare the aliases to coordinates</p>
</li>
<li>
<p>the <code>[bundles]</code> section is used to declare dependency bundles</p>
</li>
<li>
<p>the <code>[plugins]</code> section is used to declare plugins</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">The libs.versions.toml file</div>
<div class="content">
<pre>[versions]
groovy = "3.0.5"
checkstyle = "8.37"

[libraries]
groovy-core = { module = "org.codehaus.groovy:groovy", version.ref = "groovy" }
groovy-json = { module = "org.codehaus.groovy:groovy-json", version.ref = "groovy" }
groovy-nio = { module = "org.codehaus.groovy:groovy-nio", version.ref = "groovy" }
commons-lang3 = { group = "org.apache.commons", name = "commons-lang3", version = { strictly = "[3.8, 4.0[", prefer="3.9" } }

[bundles]
groovy = ["groovy-core", "groovy-json", "groovy-nio"]

[plugins]
versions = { id = "com.github.ben-manes.versions", version = "0.45.0" }</pre>
</div>
</div>
<div class="paragraph">
<p>Versions can be declared either as a single string, in which case they are interpreted as a <em>required</em> version, or as a <a href="#rich-version-constraints">rich versions</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>[versions]
my-lib = { strictly = &quot;[1.0, 2.0[&quot;, prefer = &quot;1.2&quot; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Supported members of a version declaration are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>require</code>: the <a href="#sec:required-version">required version</a></p>
</li>
<li>
<p><code>strictly</code>: the <a href="#sec:strict-version">strict version</a></p>
</li>
<li>
<p><code>prefer</code>: the <a href="#sec:preferred-version">preferred version</a></p>
</li>
<li>
<p><code>reject</code>: the list of <a href="#sec:rejected-version">rejected versions</a></p>
</li>
<li>
<p><code>rejectAll</code>: a boolean to reject all <a href="#sec:rejected-version">versions</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dependency declaration can either be declared as a simple string, in which case they are interpreted as <code>group:artifact:version</code> coordinates, or separating the version declaration from the group and name:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For aliases, the rules described in the section <a href="#sub:mapping-aliases-to-accessors">aliases and their mapping to type safe accessors</a> apply as well.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Different dependency notations</div>
<div class="content">
<pre>[versions]
common = "1.4"

[libraries]
my-lib = "com.mycompany:mylib:1.4"
my-lib-no-version.module = "com.mycompany:mylib"
my-other-lib = { module = "com.mycompany:other", version = "1.4" }
my-other-lib2 = { group = "com.mycompany", name = "alternate", version = "1.4" }
mylib-full-format = { group = "com.mycompany", name = "alternate", version = { require = "1.4" } }

[plugins]
short-notation = "some.plugin.id:1.4"
long-notation = { id = "some.plugin.id", version = "1.4" }
reference-notation = { id = "some.plugin.id", version.ref = "common" }</pre>
</div>
</div>
<div class="paragraph">
<p>In case you want to reference a version declared in the <code>[versions]</code> section, you should use the <code>version.ref</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>[versions]
some = &quot;1.4&quot;

[libraries]
my-lib = { group = &quot;com.mycompany&quot;, name=&quot;mylib&quot;, version.ref=&quot;some&quot; }</code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The TOML file format is very lenient and lets you write "dotted" properties as shortcuts to full object declarations.
For example, this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>a.b.c=&quot;d&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>a.b = { c = &quot;d&quot; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>a = { b = { c = &quot;d&quot; } }</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://toml.io">TOML specification</a> for details.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:type-unsafe-access-to-catalog"><a class="anchor" href="#sub:type-unsafe-access-to-catalog"></a><a class="link" href="#sub:type-unsafe-access-to-catalog">Type unsafe API</a></h5>
<div class="paragraph">
<p>Version catalogs can be accessed through a type unsafe API. This API is available in situations where generated accessors are not. It is accessed through the version catalog extension:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val versionCatalog = versionCatalogs.named(&quot;libs&quot;)
println(&quot;Library aliases: ${versionCatalog.libraryAliases}&quot;)
dependencies {
    versionCatalog.findLibrary(&quot;groovy-json&quot;).ifPresent {
        implementation(it)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> versionCatalog = versionCatalogs.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">libs</span><span class="delimiter">&quot;</span></span>)
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Library aliases: </span><span class="inline"><span class="inline-delimiter">${</span>versionCatalog.libraryAliases<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
dependencies {
    versionCatalog.findLibrary(<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy-json</span><span class="delimiter">&quot;</span></span>).ifPresent {
        implementation(<span class="local-variable">it</span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Check the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/VersionCatalog.html">version catalog API</a> for all supported methods.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:sharing-catalogs"><a class="anchor" href="#sec:sharing-catalogs"></a><a class="link" href="#sec:sharing-catalogs">Sharing catalogs</a></h4>
<div class="paragraph">
<p>Version catalogs are used in a single build (possibly multi-project build) but may also be shared between builds.
For example, an organization may want to create a catalog of dependencies that different projects, from different teams, may use.</p>
</div>
<div class="sect4">
<h5 id="sec:importing-catalog-from-file"><a class="anchor" href="#sec:importing-catalog-from-file"></a><a class="link" href="#sec:importing-catalog-from-file">Importing a catalog from a TOML file</a></h5>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/initialization/dsl/VersionCatalogBuilder.html">version catalog builder API</a> supports including a model from an external file.
This makes it possible to reuse the catalog of the main build for <code>buildSrc</code>, if needed.
For example, the <code>buildSrc/settings.gradle(.kts)</code> file can include this file using:</p>
</div>
<div id="ex-sharing-the-dependency-catalog-with-buildsrc" class="exampleblock">
<div class="title">Example 184. <a href="#ex-sharing-the-dependency-catalog-with-buildsrc">Sharing the dependency catalog with buildSrc</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    versionCatalogs {
        create(&quot;libs&quot;) {
            from(files(&quot;../gradle/libs.versions.toml&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    versionCatalogs {
        libs {
            from(files(<span class="string"><span class="delimiter">&quot;</span><span class="content">../gradle/libs.versions.toml</span><span class="delimiter">&quot;</span></span>))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Only a single file will be accepted when using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/initialization/dsl/VersionCatalogBuilder.html#from-java.lang.Object-">VersionCatalogBuilder.from(Object dependencyNotation)</a> method.
This means that notations like <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(java.lang.Object&#8230;&#8203;)</a> must refer to a single file, otherwise the build will fail.</p>
</div>
<div class="paragraph">
<p>If a more complicated structure is required (version catalogs imported from multiple files), it&#8217;s advisable to use a code-based approach, instead of TOML file.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This technique can therefore be used to declare multiple catalogs from different files:</p>
</div>
<div id="ex-declaring-additional-catalogs" class="exampleblock">
<div class="title">Example 185. <a href="#ex-declaring-additional-catalogs">Declaring additional catalogs</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    versionCatalogs {
        // declares an additional catalog, named 'testLibs', from the 'test-libs.versions.toml' file
        create(&quot;testLibs&quot;) {
            from(files(&quot;gradle/test-libs.versions.toml&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    versionCatalogs {
        <span class="comment">// declares an additional catalog, named 'testLibs', from the 'test-libs.versions.toml' file</span>
        testLibs {
            from(files(<span class="string"><span class="delimiter">'</span><span class="content">gradle/test-libs.versions.toml</span><span class="delimiter">'</span></span>))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:version-catalog-plugin"><a class="anchor" href="#sec:version-catalog-plugin"></a><a class="link" href="#sec:version-catalog-plugin">The version catalog plugin</a></h5>
<div class="paragraph">
<p>While importing catalogs from local files is convenient, it doesn&#8217;t solve the problem of sharing a catalog in an organization or for external consumers.
One option to share a catalog is to write a settings plugin, publish it on the Gradle plugin portal or an internal repository, and let the consumers apply the plugin on their settings file.</p>
</div>
<div class="paragraph">
<p>Alternatively, Gradle offers a <em>version catalog</em> plugin, which offers the ability to declare, then publish a catalog.</p>
</div>
<div class="paragraph">
<p>To do this, you need to apply the <code>version-catalog</code> plugin:</p>
</div>
<div id="ex-applying-the-version-catalog-plugin" class="exampleblock">
<div class="title">Example 186. <a href="#ex-applying-the-version-catalog-plugin">Applying the version catalog plugin</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `version-catalog`
    `maven-publish`
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">version-catalog</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This plugin will then expose the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/plugins/catalog/CatalogPluginExtension.html">catalog extension</a> that you can use to declare a catalog:</p>
</div>
<div id="ex-definition-of-a-catalog" class="exampleblock">
<div class="title">Example 187. <a href="#ex-definition-of-a-catalog">Definition of a catalog</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">catalog {
    // declare the aliases, bundles and versions in this block
    versionCatalog {
        library(&quot;my-lib&quot;, &quot;com.mycompany:mylib:1.2&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">catalog {
    <span class="comment">// declare the aliases, bundles and versions in this block</span>
    versionCatalog {
        library(<span class="string"><span class="delimiter">'</span><span class="content">my-lib</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">com.mycompany:mylib:1.2</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Such a catalog can then be published by applying either the <code>maven-publish</code> or <code>ivy-publish</code> plugin and configuring the publication to use the <code>versionCatalog</code> component:</p>
</div>
<div id="ex-publishing-a-catalog" class="exampleblock">
<div class="title">Example 188. <a href="#ex-publishing-a-catalog">Publishing a catalog</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;maven&quot;) {
            from(components[&quot;versionCatalog&quot;])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        maven(MavenPublication) {
            from components.versionCatalog
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When publishing such a project, a <code>libs.versions.toml</code> file will automatically be generated (and uploaded), which can then be <a href="#sec:importing-published-catalog">consumed from other Gradle builds</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:importing-published-catalog"><a class="anchor" href="#sec:importing-published-catalog"></a><a class="link" href="#sec:importing-published-catalog">Importing a published catalog</a></h5>
<div class="paragraph">
<p>A catalog produced by the <a href="#sec:version-catalog-plugin">version catalog plugin</a> can be imported via the settings API:</p>
</div>
<div id="ex-using-a-published-catalog" class="exampleblock">
<div class="title">Example 189. <a href="#ex-using-a-published-catalog">Using a published catalog</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    versionCatalogs {
        create(&quot;libs&quot;) {
            from(&quot;com.mycompany:catalog:1.0&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    versionCatalogs {
        libs {
            from(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany:catalog:1.0</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:overwriting-catalog-versions"><a class="anchor" href="#sec:overwriting-catalog-versions"></a><a class="link" href="#sec:overwriting-catalog-versions">Overwriting catalog versions</a></h6>
<div class="paragraph">
<p>In case a catalog declares a version, you can overwrite the version when importing the catalog:</p>
</div>
<div id="ex-overwriting-versions-declared-in-a-published-catalog" class="exampleblock">
<div class="title">Example 190. <a href="#ex-overwriting-versions-declared-in-a-published-catalog">Overwriting versions declared in a published catalog</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    versionCatalogs {
        create(&quot;amendedLibs&quot;) {
            from(&quot;com.mycompany:catalog:1.0&quot;)
            // overwrite the &quot;groovy&quot; version declared in the imported catalog
            version(&quot;groovy&quot;, &quot;3.0.6&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    versionCatalogs {
        amendedLibs {
            from(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany:catalog:1.0</span><span class="delimiter">&quot;</span></span>)
            <span class="comment">// overwrite the &quot;groovy&quot; version declared in the imported catalog</span>
            version(<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">3.0.6</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, any dependency which was using the <code>groovy</code> version as reference will be automatically updated to use <code>3.0.6</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Again, overwriting a version doesn&#8217;t mean that the actual <em>resolved</em> dependency version will be the same: this only changes what is <em>imported</em>, that is to say what is used when declaring a dependency.
The actual version will be subject to traditional conflict resolution, if any.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sub:using-platform-to-control-transitive-deps"><a class="anchor" href="#sub:using-platform-to-control-transitive-deps"></a><a class="link" href="#sub:using-platform-to-control-transitive-deps">Using a platform to control transitive versions</a></h4>
<div class="paragraph">
<p>A <a href="#sub::terminology_platform">platform</a> is a special software component which can be used to control transitive dependency versions.
In most cases it&#8217;s exclusively composed of <a href="#sec:adding-constraints-transitive-deps">dependency constraints</a> which will either <em>suggest</em> dependency versions or <em>enforce</em> some versions.
As such, this is a perfect tool whenever you need to <em>share dependency versions between projects</em>.
In this case, a project will typically be organized this way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>platform</code> project which defines constraints for the various dependencies found in the different sub-projects</p>
</li>
<li>
<p>a number of sub-projects which <em>depend on</em> the platform and declare dependencies <em>without version</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the Java ecosystem, Gradle provides a <a href="#java_platform_plugin">plugin</a> for this purpose.</p>
</div>
<div class="paragraph">
<p>It&#8217;s also common to find platforms published as Maven BOMs which <a href="#sub:bom_import">Gradle supports natively</a>.</p>
</div>
<div class="paragraph">
<p>A dependency on a platform is created using the <code>platform</code> keyword:</p>
</div>
<div id="ex-getting-versions-declared-in-a-platform" class="exampleblock">
<div class="title">Example 191. <a href="#ex-getting-versions-declared-in-a-platform">Getting versions declared in a platform</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // get recommended versions from the platform project
    api(platform(project(&quot;:platform&quot;)))
    // no version required
    api(&quot;commons-httpclient:commons-httpclient&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// get recommended versions from the platform project</span>
    api platform(project(<span class="string"><span class="delimiter">'</span><span class="content">:platform</span><span class="delimiter">'</span></span>))
    <span class="comment">// no version required</span>
    api <span class="string"><span class="delimiter">'</span><span class="content">commons-httpclient:commons-httpclient</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This <code>platform</code> notation is a short-hand notation which actually performs several operations under the hood:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/Category.html">org.gradle.category attribute</a> to <code>platform</code>, which means that Gradle will select the <em>platform</em> component of the dependency.</p>
</li>
<li>
<p>it sets the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ModuleDependency.html#endorseStrictVersions--">endorseStrictVersions</a> behavior by default, meaning that if the platform declares strict dependencies, they will be enforced.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This means that by default, a dependency to a platform triggers the inheritance of all <a href="#sec:strict-version">strict versions</a> defined in that platform, which can be useful for platform authors to make sure that all consumers respect their decisions in terms of versions of dependencies.
This can be turned off by explicitly calling the <code>doNotEndorseStrictVersions</code> method.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sub:bom_import"><a class="anchor" href="#sub:bom_import"></a><a class="link" href="#sub:bom_import">Importing Maven BOMs</a></h4>
<div class="paragraph">
<p>Gradle provides support for importing <a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Importing_Dependencies">bill of materials (BOM) files</a>, which are effectively <code>.pom</code> files that use <code>&lt;dependencyManagement&gt;</code> to control the dependency versions of direct and transitive dependencies.
The BOM support in Gradle works similar to using <code>&lt;scope&gt;import&lt;/scope&gt;</code> when depending on a BOM in Maven.
In Gradle however, it is done via a regular dependency declaration on the BOM:</p>
</div>
<div id="ex-depending-on-a-bom-to-import-its-dependency-constraints" class="exampleblock">
<div class="title">Example 192. <a href="#ex-depending-on-a-bom-to-import-its-dependency-constraints">Depending on a BOM to import its dependency constraints</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // import a BOM
    implementation(platform(&quot;org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE&quot;))

    // define dependencies without versions
    implementation(&quot;com.google.code.gson:gson&quot;)
    implementation(&quot;dom4j:dom4j&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// import a BOM</span>
    implementation platform(<span class="string"><span class="delimiter">'</span><span class="content">org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE</span><span class="delimiter">'</span></span>)

    <span class="comment">// define dependencies without versions</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.code.gson:gson</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">dom4j:dom4j</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example, the versions of <code>gson</code> and <code>dom4j</code> are provided by the Spring Boot BOM.
This way, if you are developing for a platform like Spring Boot, you do not have to declare any versions yourself but can rely on the versions the platform provides.</p>
</div>
<div class="paragraph">
<p>Gradle treats all entries in the <code>&lt;dependencyManagement&gt;</code> block of a BOM similar to <a href="#sec:adding-constraints-transitive-deps">Gradle&#8217;s dependency constraints</a>.
This means that any version defined in the <code>&lt;dependencyManagement&gt;</code> block can impact the dependency resolution result.
In order to qualify as a BOM, a <code>.pom</code> file needs to have <code>&lt;packaging&gt;pom&lt;/packaging&gt;</code> set.</p>
</div>
<div class="paragraph">
<p>However often BOMs are not only providing versions as recommendations, but also a way to override any other version found in the graph.
You can enable this behavior by using the <code>enforcedPlatform</code> keyword, instead of <code>platform</code>, when importing the BOM:</p>
</div>
<div id="ex-importing-a-bom-making-sure-the-versions-it-defines-override-any-other-version-found" class="exampleblock">
<div class="title">Example 193. <a href="#ex-importing-a-bom-making-sure-the-versions-it-defines-override-any-other-version-found">Importing a BOM, making sure the versions it defines override any other version found</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // import a BOM. The versions used in this file will override any other version found in the graph
    implementation(enforcedPlatform(&quot;org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE&quot;))

    // define dependencies without versions
    implementation(&quot;com.google.code.gson:gson&quot;)
    implementation(&quot;dom4j:dom4j&quot;)

    // this version will be overridden by the one found in the BOM
    implementation(&quot;org.codehaus.groovy:groovy:1.8.6&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// import a BOM. The versions used in this file will override any other version found in the graph</span>
    implementation enforcedPlatform(<span class="string"><span class="delimiter">'</span><span class="content">org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE</span><span class="delimiter">'</span></span>)

    <span class="comment">// define dependencies without versions</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.code.gson:gson</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">dom4j:dom4j</span><span class="delimiter">'</span></span>

    <span class="comment">// this version will be overridden by the one found in the BOM</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy:1.8.6</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using <code>enforcedPlatform</code> needs to be considered with care if your software component can be consumed by others.
This declaration is effectively transitive and so will apply to the dependency graph of your consumers.
Unfortunately they will have to use <code>exclude</code> if they happen to disagree with one of the forced versions.
Instead, if your reusable software component has a strong opinion on some third party dependency versions, consider using a <a href="#sec:strict-version">rich version declaration</a> with a <code>strictly</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sub:platforms-vs-catalog"><a class="anchor" href="#sub:platforms-vs-catalog"></a><a class="link" href="#sub:platforms-vs-catalog">Should I use a platform or a catalog?</a></h4>
<div class="paragraph">
<p>Because platforms and catalogs both talk about dependency versions and can both be used to share dependency versions in a project, there might be a confusion regarding what to use and if one is preferable to the other.</p>
</div>
<div class="paragraph">
<p>In short, you should:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use catalogs to only define dependencies and their versions for projects and to generate type-safe accessors</p>
</li>
<li>
<p>use platform to apply versions to dependency graph and to affect dependency resolution</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A catalog helps with centralizing the dependency versions and is only, as it name implies, a catalog of dependencies you can pick from.
We recommend using it to declare the coordinates of your dependencies, in all cases.
It will be used by Gradle to generate type-safe accessors, present short-hand notations for external dependencies and it allows sharing those coordinates between different projects easily.
Using a catalog will not have any kind of consequence on downstream consumers: it&#8217;s transparent to them.</p>
</div>
<div class="paragraph">
<p>A platform is a more heavyweight construct: it&#8217;s a component of a dependency graph, like any other library.
If you depend on a platform, that platform is itself a component in the graph.
It means, in particular, that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#dependency-constraints">Constraints</a> defined in a platform can influence <em>transitive</em> dependencies, not only the direct dependencies of your project.</p>
</li>
<li>
<p>A platform is versioned, and a transitive dependency in the graph can depend on a different version of the platform, causing various dependency upgrades.</p>
</li>
<li>
<p>A platform can tie components together, and in particular can be used as a construct for <a href="#version_alignment">aligning versions</a>.</p>
</li>
<li>
<p>A dependency on a platform is "inherited" by the consumers of your dependency: it means that a dependency on a platform can influence what versions of libraries would be used by your consumers even if you don&#8217;t directly, or transitively, depend on components the platform references.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In summary, using a catalog is always a good engineering practice as it centralizes common definitions, allows sharing of dependency versions or plugin versions, but it is an "implementation detail" of the build: it will not be visible to consumers and unused elements of a catalog are just ignored.</p>
</div>
<div class="paragraph">
<p>A platform is meant to influence the dependency resolution graph, for example by adding constraints on transitive dependencies: it&#8217;s a solution for structuring a dependency graph and influencing the resolution result.</p>
</div>
<div class="paragraph">
<p>In practice, your project can both use a catalog <em>and</em> declare a platform which itself uses the catalog:</p>
</div>
<div id="ex-using-a-catalog-within-a-platform-definition" class="exampleblock">
<div class="title">Example 194. <a href="#ex-using-a-catalog-within-a-platform-definition">Using a catalog within a platform definition</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-platform`
}

dependencies {
    constraints {
        api(libs.mylib)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-platform</span><span class="delimiter">'</span></span>
}

dependencies {
    constraints {
        api(libs.mylib)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="version_alignment"><a class="anchor" href="#version_alignment"></a><a class="link" href="#version_alignment">Aligning dependency versions</a></h3>
<div class="paragraph">
<p>Dependency version alignment allows different modules belonging to the same logical group (a <em>platform</em>) to have identical versions in a dependency graph.</p>
</div>
<div class="sect3">
<h4 id="handling_inconsistent_module_versions"><a class="anchor" href="#handling_inconsistent_module_versions"></a><a class="link" href="#handling_inconsistent_module_versions">Handling inconsistent module versions</a></h4>
<div class="paragraph">
<p>Gradle supports aligning versions of modules which belong to the same "platform".
It is often preferable, for example, that the API and implementation modules of a component are using the same version.
However, because of the game of transitive dependency resolution, it is possible that different modules belonging to the same platform end up using different versions.
For example, your project may depend on the <code>jackson-databind</code> and <code>vert.x</code> libraries, as illustrated below:</p>
</div>
<div id="ex-declaring-dependencies" class="exampleblock">
<div class="title">Example 195. <a href="#ex-declaring-dependencies">Declaring dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // a dependency on Jackson Databind
    implementation(&quot;com.fasterxml.jackson.core:jackson-databind:2.8.9&quot;)

    // and a dependency on vert.x
    implementation(&quot;io.vertx:vertx-core:3.5.3&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// a dependency on Jackson Databind</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.fasterxml.jackson.core:jackson-databind:2.8.9</span><span class="delimiter">'</span></span>

    <span class="comment">// and a dependency on vert.x</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">io.vertx:vertx-core:3.5.3</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Because <code>vert.x</code> depends on <code>jackson-core</code>, we would actually resolve the following dependency versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jackson-core</code> version <code>2.9.5</code> (brought by <code>vertx-core</code>)</p>
</li>
<li>
<p><code>jackson-databind</code> version <code>2.9.5</code> (by conflict resolution)</p>
</li>
<li>
<p><code>jackson-annotation</code> version <code>2.9.0</code> (dependency of <code>jackson-databind:2.9.5</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s easy to end up with a set of versions which do not work well together.
To fix this, Gradle supports dependency version alignment, which is supported by the concept of platforms.
A platform represents a set of modules which "work well together".
Either because they are actually published as a whole (when one of the members of the platform is published, all other modules are also published with the same version), or because someone tested the modules and indicates that they work well together (typically, the Spring Platform).</p>
</div>
</div>
<div class="sect3">
<h4 id="aligning_versions_natively_with_gradle"><a class="anchor" href="#aligning_versions_natively_with_gradle"></a><a class="link" href="#aligning_versions_natively_with_gradle">Aligning versions natively with Gradle</a></h4>
<div class="paragraph">
<p>Gradle natively supports alignment of modules produced by Gradle.
This is a direct consequence of the transitivity of <a href="#sec:adding-constraints-transitive-deps">dependency constraints</a>.
So if you have a multi-project build, and you wish that consumers get the same version of all your modules, Gradle provides a simple way to do this using the <a href="#java_platform_plugin">Java Platform Plugin</a>.</p>
</div>
<div class="paragraph">
<p>For example, if you have a project that consists of 3 modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>lib</code></p>
</li>
<li>
<p><code>utils</code></p>
</li>
<li>
<p><code>core</code>, depending on <code>lib</code> and <code>utils</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And a consumer that declares the following dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>core</code> version 1.0</p>
</li>
<li>
<p><code>lib</code> version 1.1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then by default resolution would select <code>core:1.0</code> and <code>lib:1.1</code>, because <code>lib</code> has no dependency on <code>core</code>.
We can fix this by adding a new module in our project, a <em>platform</em>, that will add constraints on all the modules of your project:</p>
</div>
<div id="ex-the-platform-module" class="exampleblock">
<div class="title">Example 196. <a href="#ex-the-platform-module">The platform module</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-platform`
}

dependencies {
    // The platform declares constraints on all components that
    // require alignment
    constraints {
        api(project(&quot;:core&quot;))
        api(project(&quot;:lib&quot;))
        api(project(&quot;:utils&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-platform</span><span class="delimiter">'</span></span>
}

dependencies {
    <span class="comment">// The platform declares constraints on all components that</span>
    <span class="comment">// require alignment</span>
    constraints {
        api(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:core</span><span class="delimiter">&quot;</span></span>))
        api(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:lib</span><span class="delimiter">&quot;</span></span>))
        api(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:utils</span><span class="delimiter">&quot;</span></span>))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once this is done, we need to make sure that all modules now <em>depend on the platform</em>, like this:</p>
</div>
<div id="ex-declaring-a-dependency-on-the-platform" class="exampleblock">
<div class="title">Example 197. <a href="#ex-declaring-a-dependency-on-the-platform">Declaring a dependency on the platform</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // Each project has a dependency on the platform
    api(platform(project(&quot;:platform&quot;)))

    // And any additional dependency required
    implementation(project(&quot;:lib&quot;))
    implementation(project(&quot;:utils&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// Each project has a dependency on the platform</span>
    api(platform(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:platform</span><span class="delimiter">&quot;</span></span>)))

    <span class="comment">// And any additional dependency required</span>
    implementation(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:lib</span><span class="delimiter">&quot;</span></span>))
    implementation(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:utils</span><span class="delimiter">&quot;</span></span>))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is important that the platform contains a constraint on all the components, but also that each component has a dependency on the platform.
By doing this, whenever Gradle will add a dependency to a module of the platform on the graph, it will <em>also</em> include constraints on the other modules of the platform.
This means that if we see another module belonging to the same platform, we will automatically upgrade to the same version.</p>
</div>
<div class="paragraph">
<p>In our example, it means that we first see <code>core:1.0</code>, which brings a platform <code>1.0</code> with constraints on <code>lib:1.0</code> and <code>lib:1.0</code>.
Then we add <code>lib:1.1</code> which has a dependency on <code>platform:1.1</code>.
By conflict resolution, we select the <code>1.1</code> platform, which has a constraint on <code>core:1.1</code>.
Then we conflict resolve between <code>core:1.0</code> and <code>core:1.1</code>, which means that <code>core</code> and <code>lib</code> are now aligned properly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This behavior is enforced for published components only if you use Gradle Module Metadata.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:align-versions-unpublished"><a class="anchor" href="#sec:align-versions-unpublished"></a><a class="link" href="#sec:align-versions-unpublished">Aligning versions of modules not published with Gradle</a></h4>
<div class="paragraph">
<p>Whenever the publisher doesn&#8217;t use Gradle, like in our Jackson example, we can explain to Gradle that all Jackson modules "belong to" the same platform and benefit from the same behavior as with native alignment.
There are two options to express that a set of modules belong to a platform:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A platform is <strong>published</strong> as a <a href="#sub:bom_import">BOM</a> and can be used:
For example, <code>com.fasterxml.jackson:jackson-bom</code> can be used as platform.
The information missing to Gradle in that case is that the platform should be added to the dependencies if one of its members is used.</p>
</li>
<li>
<p>No existing platform can be used. Instead, a <strong>virtual platform</strong> should be created by Gradle:
In this case, Gradle builds up the platform itself based on all the members that are used.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To provide the missing information to Gradle, you can define <a href="#sec:component_metadata_rules">component metadata rules</a> as explained in the following.</p>
</div>
<div class="sect4">
<h5 id="sec:align_bom_platform"><a class="anchor" href="#sec:align_bom_platform"></a><a class="link" href="#sec:align_bom_platform">Align versions of modules using a published BOM</a></h5>
<div id="ex-a-dependency-version-alignment-rule" class="exampleblock">
<div class="title">Example 198. <a href="#ex-a-dependency-version-alignment-rule">A dependency version alignment rule</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class JacksonBomAlignmentRule: ComponentMetadataRule {
    override fun execute(ctx: ComponentMetadataContext) {
        ctx.details.run {
            if (id.group.startsWith(&quot;com.fasterxml.jackson&quot;)) {
                // declare that Jackson modules belong to the platform defined by the Jackson BOM
                belongsTo(&quot;com.fasterxml.jackson:jackson-bom:${id.version}&quot;, false)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">JacksonBomAlignmentRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext ctx) {
        ctx.details.with {
            <span class="keyword">if</span> (id.group.startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.fasterxml.jackson</span><span class="delimiter">&quot;</span></span>)) {
                <span class="comment">// declare that Jackson modules belong to the platform defined by the Jackson BOM</span>
                belongsTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.fasterxml.jackson:jackson-bom:</span><span class="inline"><span class="inline-delimiter">${</span>id.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">false</span>)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By using the <code>belongsTo</code> with <code>false</code> (<strong>not</strong> virtual), we declare that all modules belong to the same <em>published platform</em>.
In this case, the platform is <code>com.fasterxml.jackson:jackson-bom</code> and Gradle will look for it, as for any other module, in the declared repositories.</p>
</div>
<div id="ex-making-use-of-a-dependency-version-alignment-rule" class="exampleblock">
<div class="title">Example 199. <a href="#ex-making-use-of-a-dependency-version-alignment-rule">Making use of a dependency version alignment rule</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    components.all&lt;JacksonBomAlignmentRule&gt;()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    components.all(JacksonBomAlignmentRule)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using the rule, the versions in the example above align to whatever the selected version of <code>com.fasterxml.jackson:jackson-bom</code> defines.
In this case, <code>com.fasterxml.jackson:jackson-bom:2.9.5</code> will be selected as <code>2.9.5</code> is the highest version of a module selected.
In that BOM, the following versions are defined and will be used:
<code>jackson-core:2.9.5</code>,
<code>jackson-databind:2.9.5</code> and
<code>jackson-annotation:2.9.0</code>.
The lower versions of <code>jackson-annotation</code> here might be the desired result as it is what the BOM recommends.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This behavior is working reliable since Gradle 6.1. Effectively, it is similar to a <a href="#sec:component_metadata_rules">component metadata rule</a> that adds a platform dependency to all members of the platform using <code>withDependencies</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:virtual_platform"><a class="anchor" href="#sec:virtual_platform"></a><a class="link" href="#sec:virtual_platform">Align versions of modules without a published platform</a></h5>
<div id="ex-a-dependency-version-alignment-rule" class="exampleblock">
<div class="title">Example 200. <a href="#ex-a-dependency-version-alignment-rule">A dependency version alignment rule</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class JacksonAlignmentRule: ComponentMetadataRule {
    override fun execute(ctx: ComponentMetadataContext) {
        ctx.details.run {
            if (id.group.startsWith(&quot;com.fasterxml.jackson&quot;)) {
                // declare that Jackson modules all belong to the Jackson virtual platform
                belongsTo(&quot;com.fasterxml.jackson:jackson-virtual-platform:${id.version}&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">JacksonAlignmentRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext ctx) {
        ctx.details.with {
            <span class="keyword">if</span> (id.group.startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.fasterxml.jackson</span><span class="delimiter">&quot;</span></span>)) {
                <span class="comment">// declare that Jackson modules all belong to the Jackson virtual platform</span>
                belongsTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.fasterxml.jackson:jackson-virtual-platform:</span><span class="inline"><span class="inline-delimiter">${</span>id.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By using the <code>belongsTo</code> keyword without further parameter (platform <strong>is</strong> virtual), we declare that all modules belong to the same <em>virtual platform</em>, which is treated specially by the engine.
A virtual platform will not be retrieved from a repository.
The identifier, in this case <code>com.fasterxml.jackson:jackson-virtual-platform</code>, is something you as the build author define yourself.
The "content" of the platform is then created by Gradle on the fly by collecting all <code>belongsTo</code> statements pointing at the same virtual platform.</p>
</div>
<div id="ex-making-use-of-a-dependency-version-alignment-rule" class="exampleblock">
<div class="title">Example 201. <a href="#ex-making-use-of-a-dependency-version-alignment-rule">Making use of a dependency version alignment rule</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    components.all&lt;JacksonAlignmentRule&gt;()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    components.all(JacksonAlignmentRule)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using the rule, all versions in the example above would align to <code>2.9.5</code>.
In this case, also <code>jackson-annotation:2.9.5</code> will be taken, as that is how we defined our local virtual platform.</p>
</div>
<div class="paragraph">
<p>For both published and virtual platforms, Gradle lets you override the version choice of the platform itself by specifying an <em>enforced</em> dependency on the platform:</p>
</div>
<div id="ex-forceful-platform-downgrade" class="exampleblock">
<div class="title">Example 202. <a href="#ex-forceful-platform-downgrade">Forceful platform downgrade</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // Forcefully downgrade the virtual Jackson platform to 2.8.9
    implementation(enforcedPlatform(&quot;com.fasterxml.jackson:jackson-virtual-platform:2.8.9&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// Forcefully downgrade the virtual Jackson platform to 2.8.9</span>
    implementation enforcedPlatform(<span class="string"><span class="delimiter">'</span><span class="content">com.fasterxml.jackson:jackson-virtual-platform:2.8.9</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec:handling-mutually-exclusive-deps"><a class="anchor" href="#sec:handling-mutually-exclusive-deps"></a><a class="link" href="#sec:handling-mutually-exclusive-deps">Handling mutually exclusive dependencies</a></h3>
<div class="sect3">
<h4 id="sub:capabilities"><a class="anchor" href="#sub:capabilities"></a><a class="link" href="#sub:capabilities">Introduction to component capabilities</a></h4>
<div class="paragraph">
<p>Often a dependency graph would accidentally contain multiple implementations of the same API.
This is particularly common with logging frameworks, where multiple bindings are available, and that one library chooses a binding when another transitive dependency chooses another.
Because those implementations live at different GAV coordinates, the build tool has usually no way to find out that there&#8217;s a conflict between those libraries.
To solve this, Gradle provides the concept of <em>capability</em>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s illegal to find two components providing the same <em>capability</em> in a single dependency graph.
Intuitively, it means that if Gradle finds two components that provide the same thing on classpath, it&#8217;s going to fail with an error indicating what modules are in conflict.
In our example, it means that different bindings of a logging framework provide the same capability.</p>
</div>
</div>
<div class="sect3">
<h4 id="capability_coordinates"><a class="anchor" href="#capability_coordinates"></a><a class="link" href="#capability_coordinates">Capability coordinates</a></h4>
<div class="paragraph">
<p>A <em>capability</em> is defined by a <code>(group, module, version)</code> triplet.
Each component defines an implicit capability corresponding to its GAV coordinates (group, artifact, version).
For example, the <code>org.apache.commons:commons-lang3:3.8</code> module has an implicit capability with group <code>org.apache.commons</code>, name <code>commons-lang3</code> and version <code>3.8</code>.
It is important to realize that capabilities are <em>versioned</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:declaring-component-capabilities"><a class="anchor" href="#sub:declaring-component-capabilities"></a><a class="link" href="#sub:declaring-component-capabilities">Declaring component capabilities</a></h4>
<div class="paragraph">
<p>By default, Gradle will fail if two components in the dependency graph provide the same capability.
Because most modules are currently published without Gradle Module Metadata, capabilities are not always automatically discovered by Gradle.
It is however interesting to use <em>rules</em> to declare component capabilities in order to discover conflicts as soon as possible, during the build instead of runtime.</p>
</div>
<div class="paragraph">
<p>A typical example is whenever a component is relocated at different coordinates in a new release.
For example, the ASM library lived at <code>asm:asm</code> coordinates until version <code>3.3.1</code>, then changed to <code>org.ow2.asm:asm</code> since <code>4.0</code>.
It is illegal to have both ASM &lt;= 3.3.1 and 4.0+ on the classpath, because they provide the same feature, it&#8217;s just that the component has been relocated.
Because each component has an implicit capability corresponding to its GAV coordinates, we can "fix" this by having a rule that will declare that the <code>asm:asm</code> module provides the <code>org.ow2.asm:asm</code> capability:</p>
</div>
<div id="ex-conflict-resolution-by-capability" class="exampleblock">
<div class="title">Example 203. <a href="#ex-conflict-resolution-by-capability">Conflict resolution by capability</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">class AsmCapability : ComponentMetadataRule {
    override
    fun execute(context: ComponentMetadataContext) = context.details.run {
        if (id.group == &quot;asm&quot; &amp;&amp; id.name == &quot;asm&quot;) {
            allVariants {
                withCapabilities {
                    // Declare that ASM provides the org.ow2.asm:asm capability, but with an older version
                    addCapability(&quot;org.ow2.asm&quot;, &quot;asm&quot;, id.version)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">AsmCapability</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.with {
            <span class="keyword">if</span> (id.group == <span class="string"><span class="delimiter">&quot;</span><span class="content">asm</span><span class="delimiter">&quot;</span></span> &amp;&amp; id.name == <span class="string"><span class="delimiter">&quot;</span><span class="content">asm</span><span class="delimiter">&quot;</span></span>) {
                allVariants {
                    <span class="local-variable">it</span>.withCapabilities {
                        <span class="comment">// Declare that ASM provides the org.ow2.asm:asm capability, but with an older version</span>
                        <span class="local-variable">it</span>.addCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.ow2.asm</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">asm</span><span class="delimiter">&quot;</span></span>, id.version)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now the build is going to <em>fail</em> whenever the two components are found in the same dependency graph.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>At this stage, Gradle will <em>only</em> make more builds fail.
It will <strong>not</strong> automatically fix the problem for you, but it helps you realize that you have a problem.
It is recommended to write such rules in <em>plugins</em> which are then applied to your builds.
Then, users <em>have to</em> express their preferences, if possible, or fix the problem of having incompatible things on the classpath, as explained in the following section.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sub:selecting-between-candidates"><a class="anchor" href="#sub:selecting-between-candidates"></a><a class="link" href="#sub:selecting-between-candidates">Selecting between candidates</a></h4>
<div class="paragraph">
<p>At some point, a dependency graph is going to include either <em>incompatible modules</em>, or modules which are <em>mutually exclusive</em>.
For example, you may have different logger implementations and you need to choose one binding.
<a href="#sub:capabilities">Capabilities</a> help <em>realizing</em> that you have a conflict, but Gradle also provides tools to express how to solve the conflicts.</p>
</div>
<div class="sect4">
<h5 id="sub:selecting-preferred-capability-provider"><a class="anchor" href="#sub:selecting-preferred-capability-provider"></a><a class="link" href="#sub:selecting-preferred-capability-provider">Selecting between different capability candidates</a></h5>
<div class="paragraph">
<p>In the relocation example above, Gradle was able to tell you that you have two versions of the same API on classpath: an "old" module and a "relocated" one.
Now we can solve the conflict by automatically choosing the component which has the highest capability version:</p>
</div>
<div id="ex-conflict-resolution-by-capability-versioning" class="exampleblock">
<div class="title">Example 204. <a href="#ex-conflict-resolution-by-capability-versioning">Conflict resolution by capability versioning</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.capabilitiesResolution.withCapability(&quot;org.ow2.asm:asm&quot;) {
        selectHighestVersion()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.capabilitiesResolution.withCapability(<span class="string"><span class="delimiter">'</span><span class="content">org.ow2.asm:asm</span><span class="delimiter">'</span></span>) {
        selectHighestVersion()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, fixing by choosing the highest capability version conflict resolution is not always suitable.
For a logging framework, for example, it doesn&#8217;t matter what version of the logging frameworks we use, we should always select Slf4j.</p>
</div>
<div class="paragraph">
<p>In this case, we can fix it by explicitly selecting slf4j as the winner:</p>
</div>
<div id="ex-substitute-log4j-with-slf4j" class="exampleblock">
<div class="title">Example 205. <a href="#ex-substitute-log4j-with-slf4j">Substitute log4j with slf4j</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.capabilitiesResolution.withCapability(&quot;log4j:log4j&quot;) {
        val toBeSelected = candidates.firstOrNull { it.id.let { id -&gt; id is ModuleComponentIdentifier &amp;&amp; id.module == &quot;log4j-over-slf4j&quot; } }
        if (toBeSelected != null) {
            select(toBeSelected)
        }
        because(&quot;use slf4j in place of log4j&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.capabilitiesResolution.withCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">log4j:log4j</span><span class="delimiter">&quot;</span></span>) {
        <span class="keyword">def</span> toBeSelected = candidates.find { <span class="local-variable">it</span>.id <span class="keyword">instanceof</span> ModuleComponentIdentifier &amp;&amp; <span class="local-variable">it</span>.id.module == <span class="string"><span class="delimiter">'</span><span class="content">log4j-over-slf4j</span><span class="delimiter">'</span></span> }
        <span class="keyword">if</span> (toBeSelected != <span class="predefined-constant">null</span>) {
            select(toBeSelected)
        }
        because <span class="string"><span class="delimiter">'</span><span class="content">use slf4j in place of log4j</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that this approach works also well if you have multiple <em>Slf4j bindings</em> on the classpath:
bindings are basically different logger implementations and you need only one.
However, the selected implementation may depend on the configuration being resolved.
For example, for tests, <code>slf4j-simple</code> may be enough but for production, <code>slf4-over-log4j</code> may be better.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Resolution can only be made in favor of a module <em>found</em> in the graph.</p>
</div>
<div class="paragraph">
<p>The <code>select</code> method only accepts a module found in the <em>current</em> candidates.
If the module you want to select is not part of the conflict, you can abstain from performing a selection, effectively not resolving <em>this</em> conflict.
It might be that another conflict exists in the graph for the same capability and will have the module you want to select.</p>
</div>
<div class="paragraph">
<p>If no resolution is given for all conflicts on a given capability, the build will fail given the module chosen for resolution was not part of the graph at all.</p>
</div>
<div class="paragraph">
<p>In addition <code>select(null)</code> will result in an error and so should be avoided.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>For more information, check out the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ResolutionStrategy.html#capabilitiesResolution">the capabilities resolution API</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec:component_metadata_rules"><a class="anchor" href="#sec:component_metadata_rules"></a><a class="link" href="#sec:component_metadata_rules">Fixing metadata with component metadata rules</a></h3>
<div class="paragraph">
<p>Each module that is pulled from a repository has metadata associated with it, such as its group, name, version as well as the different variants it provides with their artifacts and dependencies.
Sometimes, this metadata is incomplete or incorrect.
To manipulate such incomplete metadata from within the build script, Gradle offers an API to write <em>component metadata rules</em>.
These rules take effect after a module&#8217;s metadata has been downloaded, but before it is used in dependency resolution.</p>
</div>
<div class="sect3">
<h4 id="basics_of_writing_a_component_metadata_rule"><a class="anchor" href="#basics_of_writing_a_component_metadata_rule"></a><a class="link" href="#basics_of_writing_a_component_metadata_rule">Basics of writing a component metadata rule</a></h4>
<div class="paragraph">
<p>Component metadata rules are applied in the components (<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.dsl.ComponentMetadataHandler.html">ComponentMetadataHandler</a>) section of the dependencies block (<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html">DependencyHandler</a>) of a build script or in the settings script.
The rules can be defined in two different ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>As an action directly when they are applied in the <em>components</em> section</p>
</li>
<li>
<p>As an isolated class implementing the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ComponentMetadataRule.html">ComponentMetadataRule</a> interface</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>While defining rules inline as action can be convenient for experimentation, it is generally recommended to define rules as separate classes.
Rules that are written as isolated classes can be annotated with <code>@CacheableRule</code> to cache the results of their application such that they do not need to be re-executed each time dependencies are resolved.</p>
</div>
<div id="ex-example-of-a-configurable-component-metadata-rule" class="exampleblock">
<div class="title">Example 206. <a href="#ex-example-of-a-configurable-component-metadata-rule">Example of a configurable component metadata rule</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableRule
abstract class TargetJvmVersionRule @Inject constructor(val jvmVersion: Int) : ComponentMetadataRule {
    @get:Inject abstract val objects: ObjectFactory

    override fun execute(context: ComponentMetadataContext) {
        context.details.withVariant(&quot;compile&quot;) {
            attributes {
                attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, jvmVersion)
                attribute(Usage.USAGE_ATTRIBUTE, objects.named(Usage.JAVA_API))
            }
        }
    }
}
dependencies {
    components {
        withModule&lt;TargetJvmVersionRule&gt;(&quot;commons-io:commons-io&quot;) {
            params(7)
        }
        withModule&lt;TargetJvmVersionRule&gt;(&quot;commons-collections:commons-collections&quot;) {
            params(8)
        }
    }
    implementation(&quot;commons-io:commons-io:2.6&quot;)
    implementation(&quot;commons-collections:commons-collections:3.2.2&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableRule</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">TargetJvmVersionRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="directive">final</span> <span class="predefined-type">Integer</span> jvmVersion
    <span class="annotation">@Inject</span> TargetJvmVersionRule(<span class="predefined-type">Integer</span> jvmVersion) {
        <span class="local-variable">this</span>.jvmVersion = jvmVersion
    }

    <span class="annotation">@Inject</span> <span class="directive">abstract</span> <span class="predefined-type">ObjectFactory</span> getObjects()

    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.withVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span>) {
            attributes {
                attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, jvmVersion)
                attribute(Usage.USAGE_ATTRIBUTE, objects.named(Usage, Usage.JAVA_API))
            }
        }
    }
}
dependencies {
    components {
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-io:commons-io</span><span class="delimiter">&quot;</span></span>, TargetJvmVersionRule) {
            params(<span class="integer">7</span>)
        }
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-collections:commons-collections</span><span class="delimiter">&quot;</span></span>, TargetJvmVersionRule) {
            params(<span class="integer">8</span>)
        }
    }
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-io:commons-io:2.6</span><span class="delimiter">&quot;</span></span>)
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-collections:commons-collections:3.2.2</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As can be seen in the examples above, component metadata rules are defined by implementing <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ComponentMetadataRule.html">ComponentMetadataRule</a> which has a single <code>execute</code> method receiving an instance of <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ComponentMetadataContext.html">ComponentMetadataContext</a> as parameter.
In this example, the rule is also further configured through an <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/ActionConfiguration.html">ActionConfiguration</a>.
This is supported by having a constructor in your implementation of <code>ComponentMetadataRule</code> accepting the parameters that were configured and the services that need injecting.</p>
</div>
<div class="paragraph">
<p>Gradle enforces isolation of instances of <code>ComponentMetadataRule</code>.
This means that all parameters must be <code>Serializable</code> or known Gradle types that can be isolated.</p>
</div>
<div class="paragraph">
<p>In addition, Gradle services can be injected into your <code>ComponentMetadataRule</code>.
Because of this, the moment you have a constructor, it must be annotated with <code>@javax.inject.Inject</code>.
A commonly required service is <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html">ObjectFactory</a> to create instances of strongly typed value objects like a value for setting an <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/Attribute.html">Attribute</a>.
A service which is helpful for advanced usage of component metadata rules with custom metadata is the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/repositories/RepositoryResourceAccessor.html">RepositoryResourceAccessor</a>.</p>
</div>
<div class="paragraph">
<p>A component metadata rule can be applied to all modules — <code>all(rule)</code> — or to a selected module — <code>withModule(groupAndName, rule)</code>.
Usually, a rule is specifically written to enrich metadata of one specific module and hence the <code>withModule</code> API should be preferred.</p>
</div>
<div class="sect4">
<h5 id="sec:rules_in_settings"><a class="anchor" href="#sec:rules_in_settings"></a><a class="link" href="#sec:rules_in_settings">Declaring rules in a central place</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Declaring component metadata rules in settings is an incubating feature
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Instead of declaring rules for each subproject individually, it is possible to declare rules in the <code>settings.gradle(.kts)</code> file for the whole build.
Rules declared in settings are the <em>conventional</em> rules applied to each project: if the project doesn&#8217;t declare any rules, the rules from the settings script will be used.</p>
</div>
<div id="ex-declaring-a-rule-in-settings" class="exampleblock">
<div class="title">Example 207. <a href="#ex-declaring-a-rule-in-settings">Declaring a rule in settings</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    components {
        withModule&lt;GuavaRule&gt;(&quot;com.google.guava:guava&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    components {
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.guava:guava</span><span class="delimiter">&quot;</span></span>, GuavaRule)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, rules declared in a project will <strong>override</strong> whatever is declared in settings.
It is possible to change this default, for example to always prefer the settings rules:</p>
</div>
<div id="ex-preferring-rules-declared-in-settings" class="exampleblock">
<div class="title">Example 208. <a href="#ex-preferring-rules-declared-in-settings">Preferring rules declared in settings</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    rulesMode = RulesMode.PREFER_SETTINGS
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    rulesMode = RulesMode.PREFER_SETTINGS
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If this method is called and that a project or plugin declares rules, a warning will be issued.
You can make this a failure instead by using this alternative:</p>
</div>
<div id="ex-enforcing-rules-declared-in-settings" class="exampleblock">
<div class="title">Example 209. <a href="#ex-enforcing-rules-declared-in-settings">Enforcing rules declared in settings</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    rulesMode = RulesMode.FAIL_ON_PROJECT_RULES
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    rulesMode = RulesMode.FAIL_ON_PROJECT_RULES
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The default behavior is equivalent to calling this method:</p>
</div>
<div id="ex-preferring-rules-declared-in-projects" class="exampleblock">
<div class="title">Example 210. <a href="#ex-preferring-rules-declared-in-projects">Preferring rules declared in projects</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyResolutionManagement {
    rulesMode = RulesMode.PREFER_PROJECT
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyResolutionManagement {
    rulesMode = RulesMode.PREFER_PROJECT
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:component_metadata_rules_details"><a class="anchor" href="#sec:component_metadata_rules_details"></a><a class="link" href="#sec:component_metadata_rules_details">Which parts of metadata can be modified?</a></h4>
<div class="paragraph">
<p>The component metadata rules API is oriented at the features supported by <a href="https://github.com/gradle/gradle/blob/master/platforms/documentation/docs/src/docs/design/gradle-module-metadata-latest-specification.md">Gradle Module Metadata</a> and the <em>dependencies</em> API in build scripts.
The main difference between writing rules and defining dependencies and artifacts in the build script is that component metadata rules, following the structure of Gradle Module Metadata, operate on <a href="#understanding-variant-selection">variants</a> directly.
On the contrary, in build scripts you often influence the shape of multiple variants at once (e.g. an <em>api</em> dependency is added to the <em>api</em> and <em>runtime</em> variant of a Java library, the artifact produced by the <em>jar</em> task is also added to these two variants).</p>
</div>
<div class="paragraph">
<p>Variants can be addressed for modification through the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>allVariants</code>: modify all variants of a component</p>
</li>
<li>
<p><code>withVariant(name)</code>: modify a single variant identified by its name</p>
</li>
<li>
<p><code>addVariant(name)</code> or <code>addVariant(name, base)</code>: add a new variant to the component either <em>from scratch</em> or by <em>copying</em> the details of an existing variant (base)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following details of each variant can be adjusted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="#sec:abm_configuration_attributes">attributes</a> that identify the variant — <code>attributes {}</code> block</p>
</li>
<li>
<p>The <a href="#declaring-component-capabilities">capabilities</a> the variant provides — <code>withCapabilities { }</code> block</p>
</li>
<li>
<p>The <a href="#declaring-dependencies">dependencies</a> of the variant, including <a href="#rich-version-constraints">rich versions</a> — <code>withDependencies {}</code> block</p>
</li>
<li>
<p>The <a href="#sec:adding-constraints-transitive-deps">dependency constraints</a> of the variant, including <a href="#rich-version-constraints">rich versions</a> — <code>withDependencyConstraints {}</code> block</p>
</li>
<li>
<p>The location of the published files that make up the actual content of the variant — <code>withFiles { }</code> block</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are also a few properties of the whole component that can be changed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>component level attributes</em>, currently the only meaningful attribute there is <code>org.gradle.status</code></p>
</li>
<li>
<p>The <em>status scheme</em> to influence interpretation of the <code>org.gradle.status</code> attribute during version selection</p>
</li>
<li>
<p>The <em>belongsTo</em> property for <a href="#sec:declaring-capabilities-external-modules">version alignment through virtual platforms</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Depending on the format of the metadata of a module, it is mapped differently to the variant-centric representation of the metadata:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the module has Gradle Module Metadata, the data structure the rule operates on is very similar to what you find in the module&#8217;s <code>.module</code> file.</p>
</li>
<li>
<p>If the module was published only with <code>.pom</code> metadata, a number of fixed variants is derived as explained in the <a href="#sub:maven-mapping-to-variants">mapping of POM files to variants</a> section.</p>
</li>
<li>
<p>If the module was published only with an <code>ivy.xml</code> file, the <em>Ivy configurations</em> defined in the file can be accessed instead of variants.
Their dependencies, dependency constraints and files can be modified.
Additionally, the <code>addVariant(name, baseVariantOrConfiguration) { }</code> API can be used to derive variants from <em>Ivy configurations</em> if desired (for example, <a href="#sub:ivy-mapping-to-variants"><em>compile</em> and <em>runtime</em> variants for the Java library plugin</a> can be defined with this).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="when_to_use_component_metadata_rules"><a class="anchor" href="#when_to_use_component_metadata_rules"></a><a class="link" href="#when_to_use_component_metadata_rules">When to use Component Metadata Rules?</a></h4>
<div class="paragraph">
<p>In general, if you consider using component metadata rules to adjust the metadata of a certain module, you should check first if that module was published with Gradle Module Metadata (<code>.module</code> file) or traditional metadata only (<code>.pom</code> or <code>ivy.xml</code>).</p>
</div>
<div class="paragraph">
<p>If a module was published with Gradle Module Metadata, the metadata is likely complete although there can still be cases where something is just plainly wrong.
For these modules you should only use component metadata rules if you have clearly identified a problem with the metadata itself.
If you have an issue with the dependency resolution result, you should first check if you can solve the issue by declaring <a href="#rich-version-constraints">dependency constraints with rich versions</a>.
In particular, if you are developing a library that you publish, you should remember that dependency constraints, in contrast to component metadata rules, are published as part of the metadata of your own library.
So with dependency constraints, you automatically share the solution of dependency resolution issues with your consumers, while component metadata rules are only applied to your own build.</p>
</div>
<div class="paragraph">
<p>If a module was published with traditional metadata (<code>.pom</code> or <code>ivy.xml</code> only, no <code>.module</code> file) it is more likely that the metadata is incomplete as features such as variants or dependency constraints are not supported in these formats.
Still, conceptually such modules can contain different variants or might have dependency constraints they just omitted (or wrongly defined as dependencies).
In the next sections, we explore a number existing oss modules with such incomplete metadata and the rules for adding the missing metadata information.</p>
</div>
<div class="paragraph">
<p>As a rule of thumb, you should contemplate if the rule you are writing also works out of context of your build.
That is, does the rule still produce a correct and useful result if applied in any other build that uses the module(s) it affects?</p>
</div>
</div>
<div class="sect3">
<h4 id="fixing_wrong_dependency_details"><a class="anchor" href="#fixing_wrong_dependency_details"></a><a class="link" href="#fixing_wrong_dependency_details">Fixing wrong dependency details</a></h4>
<div class="paragraph">
<p>Let&#8217;s consider as an example the publication of the Jaxen XPath Engine on <a href="https://repo1.maven.org/maven2/jaxen/jaxen">Maven central</a>.
The pom of version 1.1.3 declares a number of dependencies in the compile scope which are not actually needed for compilation.
These have been removed in the 1.1.4 pom.
Assuming that we need to work with 1.1.3 for some reason, we can fix the metadata with the following rule:</p>
</div>
<div id="ex-rule-to-remove-unused-dependencies-of-jaxen-metadata" class="exampleblock">
<div class="title">Example 211. <a href="#ex-rule-to-remove-unused-dependencies-of-jaxen-metadata">Rule to remove unused dependencies of Jaxen metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableRule
abstract class JaxenDependenciesRule: ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        context.details.allVariants {
            withDependencies {
                removeAll { it.group in listOf(&quot;dom4j&quot;, &quot;jdom&quot;, &quot;xerces&quot;,  &quot;maven-plugins&quot;, &quot;xml-apis&quot;, &quot;xom&quot;) }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableRule</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">JaxenDependenciesRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.allVariants {
            withDependencies {
                removeAll { <span class="local-variable">it</span>.group <span class="keyword">in</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">dom4j</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">jdom</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">xerces</span><span class="delimiter">&quot;</span></span>,  <span class="string"><span class="delimiter">&quot;</span><span class="content">maven-plugins</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">xml-apis</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">xom</span><span class="delimiter">&quot;</span></span>] }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Within the <code>withDependencies</code> block you have access to the full list of dependencies and can use all methods available on the Java collection interface to inspect and modify that list.
In addition, there are <code>add(notation, configureAction)</code> methods accepting the usual notations similar to <a href="#declaring-dependencies">declaring dependencies</a> in the build script.
Dependency constraints can be inspected and modified the same way in the <code>withDependencyConstraints</code> block.</p>
</div>
<div class="paragraph">
<p>If we take a closer look at the Jaxen 1.1.4 pom, we observe that the <em>dom4j</em>, <em>jdom</em> and <em>xerces</em> dependencies are still there but marked as <em>optional</em>.
Optional dependencies in poms are not automatically processed by Gradle nor Maven.
The reason is that they indicate that there are <a href="#feature_variants">optional feature variants</a> provided by the Jaxen library which require one or more of these dependencies, but the information what these features are and which dependency belongs to which is missing.
Such information cannot be represented in pom files, but in Gradle Module Metadata through variants and <a href="#declaring-component-capabilities">capabilities</a>.
Hence, we can add this information in a rule as well.</p>
</div>
<div id="ex-rule-to-add-optional-feature-to-jaxen-metadata" class="exampleblock">
<div class="title">Example 212. <a href="#ex-rule-to-add-optional-feature-to-jaxen-metadata">Rule to add optional feature to Jaxen metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableRule
abstract class JaxenCapabilitiesRule: ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        context.details.addVariant(&quot;runtime-dom4j&quot;, &quot;runtime&quot;) {
            withCapabilities {
                removeCapability(&quot;jaxen&quot;, &quot;jaxen&quot;)
                addCapability(&quot;jaxen&quot;, &quot;jaxen-dom4j&quot;, context.details.id.version)
            }
            withDependencies {
                add(&quot;dom4j:dom4j:1.6.1&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableRule</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">JaxenCapabilitiesRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">runtime-dom4j</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>) {
            withCapabilities {
                removeCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen</span><span class="delimiter">&quot;</span></span>)
                addCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen-dom4j</span><span class="delimiter">&quot;</span></span>, context.details.id.version)
            }
            withDependencies {
                add(<span class="string"><span class="delimiter">&quot;</span><span class="content">dom4j:dom4j:1.6.1</span><span class="delimiter">&quot;</span></span>)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, we first use the <code>addVariant(name, baseVariant)</code> method to create an additional variant, which we identify as <em>feature variant</em> by defining a new capability <em>jaxen-dom4j</em> to represent the optional dom4j integration feature of Jaxen.
This works similar to <a href="#sec::declare_feature_variants">defining optional feature variants</a> in build scripts.
We then use one of the <code>add</code> methods for adding dependencies to define which dependencies this optional feature needs.</p>
</div>
<div class="paragraph">
<p>In the build script, we can then add a <a href="#sec::consuming_feature_variants">dependency to the optional feature</a> and Gradle will use the enriched metadata to discover the correct transitive dependencies.</p>
</div>
<div id="ex-applying-and-utilising-rules-for-jaxen-metadata" class="exampleblock">
<div class="title">Example 213. <a href="#ex-applying-and-utilising-rules-for-jaxen-metadata">Applying and utilising rules for Jaxen metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    components {
        withModule&lt;JaxenDependenciesRule&gt;(&quot;jaxen:jaxen&quot;)
        withModule&lt;JaxenCapabilitiesRule&gt;(&quot;jaxen:jaxen&quot;)
    }
    implementation(&quot;jaxen:jaxen:1.1.3&quot;)
    runtimeOnly(&quot;jaxen:jaxen:1.1.3&quot;) {
        capabilities { requireCapability(&quot;jaxen:jaxen-dom4j&quot;) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    components {
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen:jaxen</span><span class="delimiter">&quot;</span></span>, JaxenDependenciesRule)
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen:jaxen</span><span class="delimiter">&quot;</span></span>, JaxenCapabilitiesRule)
    }
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen:jaxen:1.1.3</span><span class="delimiter">&quot;</span></span>)
    runtimeOnly(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen:jaxen:1.1.3</span><span class="delimiter">&quot;</span></span>) {
        capabilities { requireCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen:jaxen-dom4j</span><span class="delimiter">&quot;</span></span>) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="making_variants_published_as_classified_jars_explicit"><a class="anchor" href="#making_variants_published_as_classified_jars_explicit"></a><a class="link" href="#making_variants_published_as_classified_jars_explicit">Making variants published as classified jars explicit</a></h4>
<div class="paragraph">
<p>While in the previous example, all variants, "main variants" and optional features, were packaged in one jar file, it is common to publish certain variants as separate files.
In particular, when the variants are mutual exclusive — i.e. they are <strong>not</strong> feature variants, but different variants offering alternative choices.
One example <strong>all</strong> pom-based libraries already have are the <em>runtime</em> and <em>compile</em> variants, where Gradle can choose only one depending on the task at hand.
Another of such alternatives discovered often in the Java ecosystems are jars targeting different Java versions.</p>
</div>
<div class="paragraph">
<p>As example, we look at version 0.7.9 of the asynchronous programming library Quasar published on <a href="https://repo1.maven.org/maven2/co/paralleluniverse/quasar-core/0.7.9">Maven central</a>.
If we inspect the directory listing, we discover that a <code>quasar-core-0.7.9-jdk8.jar</code> was published, in addition to <code>quasar-core-0.7.9.jar</code>.
Publishing additional jars with a <em>classifier</em> (here <em>jdk8</em>) is common practice in maven repositories.
And while both Maven and Gradle allow you to reference such jars by classifier, they are not mentioned at all in the metadata.
Thus, there is no information that these jars exist and if there are any other differences, like different dependencies, between the variants represented by such jars.</p>
</div>
<div class="paragraph">
<p>In Gradle Module Metadata, this variant information would be present and for the already published Quasar library, we can add it using the following rule:</p>
</div>
<div id="ex-rule-to-add-jdk-8-variants-to-quasar-metadata" class="exampleblock">
<div class="title">Example 214. <a href="#ex-rule-to-add-jdk-8-variants-to-quasar-metadata">Rule to add JDK 8 variants to Quasar metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableRule
abstract class QuasarRule: ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        listOf(&quot;compile&quot;, &quot;runtime&quot;).forEach { base -&gt;
            context.details.addVariant(&quot;jdk8${base.capitalize()}&quot;, base) {
                attributes {
                    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, 8)
                }
                withFiles {
                    removeAllFiles()
                    addFile(&quot;${context.details.id.name}-${context.details.id.version}-jdk8.jar&quot;)
                }
            }
            context.details.withVariant(base) {
                attributes {
                    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, 7)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableRule</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">QuasarRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        [<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>].each { base -&gt;
            context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdk8</span><span class="inline"><span class="inline-delimiter">${</span>base.capitalize()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>, base) {
                attributes {
                    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, <span class="integer">8</span>)
                }
                withFiles {
                    removeAllFiles()
                    addFile(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>context.details.id.name<span class="inline-delimiter">}</span></span><span class="content">-</span><span class="inline"><span class="inline-delimiter">${</span>context.details.id.version<span class="inline-delimiter">}</span></span><span class="content">-jdk8.jar</span><span class="delimiter">&quot;</span></span>)
                }
            }
            context.details.withVariant(base) {
                attributes {
                    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, <span class="integer">7</span>)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, it is pretty clear that the classifier stands for a target Java version, which is a <a href="#sec:variant-aware-matching">known Java ecosystem attribute</a>.
Because we also need both a <em>compile</em> and <em>runtime</em> for Java 8, we create two new variants but use the existing <em>compile</em> and <em>runtime</em> variants as <em>base</em>.
This way, all other Java ecosystem attributes are already set correctly and all dependencies are carried over.
Then we set the <code>TARGET_JVM_VERSION_ATTRIBUTE</code> to <code>8</code> for both variants, remove any existing file from the new variants with <code>removeAllFiles()</code>, and add the jdk8 jar file with <code>addFile()</code>.
The <code>removeAllFiles()</code> is needed, because the reference to the main jar <code>quasar-core-0.7.5.jar</code> is copied from the corresponding base variant.</p>
</div>
<div class="paragraph">
<p>We also enrich the existing <em>compile</em> and <em>runtime</em> variants with the information that they target Java 7 — <code>attribute(TARGET_JVM_VERSION_ATTRIBUTE, 7)</code>.</p>
</div>
<div class="paragraph">
<p>Now, we can request a Java 8 versions for all of our dependencies on the compile classpath in the build script and Gradle will automatically select the best fitting variant for each library.
In the case of Quasar this will now be the <em>jdk8Compile</em> variant exposing the <code>quasar-core-0.7.9-jdk8.jar</code>.</p>
</div>
<div id="ex-applying-and-utilising-rule-for-quasar-metadata" class="exampleblock">
<div class="title">Example 215. <a href="#ex-applying-and-utilising-rule-for-quasar-metadata">Applying and utilising rule for Quasar metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations[&quot;compileClasspath&quot;].attributes {
    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, 8)
}
dependencies {
    components {
        withModule&lt;QuasarRule&gt;(&quot;co.paralleluniverse:quasar-core&quot;)
    }
    implementation(&quot;co.paralleluniverse:quasar-core:0.7.9&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.compileClasspath.attributes {
    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, <span class="integer">8</span>)
}
dependencies {
    components {
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">co.paralleluniverse:quasar-core</span><span class="delimiter">&quot;</span></span>, QuasarRule)
    }
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">co.paralleluniverse:quasar-core:0.7.9</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="making_variants_encoded_in_versions_explicit"><a class="anchor" href="#making_variants_encoded_in_versions_explicit"></a><a class="link" href="#making_variants_encoded_in_versions_explicit">Making variants encoded in versions explicit</a></h4>
<div class="paragraph">
<p>Another solution to publish multiple alternatives for the same library is the usage of a versioning pattern as done by the popular Guava library.
Here, each new version is published twice by appending the classifier to the version instead of the jar artifact.
In the case of Guava 28 for example, we can find a <em>28.0-jre</em> (Java 8) and <em>28.0-android</em> (Java 6) version on <a href="https://repo1.maven.org/maven2/com/google/guava/guava">Maven central</a>.
The advantage of using this pattern when working only with pom metadata is that both variants are discoverable through the version.
The disadvantage is that there is no information what the different version suffixes mean semantically.
So in the case of conflict, Gradle would just pick the highest version when comparing the version strings.</p>
</div>
<div class="paragraph">
<p>Turning this into proper variants is a bit more tricky, as Gradle first selects a version of a module and then selects the best fitting variant.
So the concept that variants are encoded as versions is not supported directly.
However, since both variants are always published together we can assume that the files are physically located in the same repository.
And since they are published with Maven repository conventions, we know the location of each file if we know module name and version.
We can write the following rule:</p>
</div>
<div id="ex-rule-to-add-jdk-6-and-jdk-8-variants-to-guava-metadata" class="exampleblock">
<div class="title">Example 216. <a href="#ex-rule-to-add-jdk-6-and-jdk-8-variants-to-guava-metadata">Rule to add JDK 6 and JDK 8 variants to Guava metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableRule
abstract class GuavaRule: ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        val variantVersion = context.details.id.version
        val version = variantVersion.substring(0, variantVersion.indexOf(&quot;-&quot;))
        listOf(&quot;compile&quot;, &quot;runtime&quot;).forEach { base -&gt;
            mapOf(6 to &quot;android&quot;, 8 to &quot;jre&quot;).forEach { (targetJvmVersion, jarName) -&gt;
                context.details.addVariant(&quot;jdk$targetJvmVersion${base.capitalize()}&quot;, base) {
                    attributes {
                        attributes.attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, targetJvmVersion)
                    }
                    withFiles {
                        removeAllFiles()
                        addFile(&quot;guava-$version-$jarName.jar&quot;, &quot;../$version-$jarName/guava-$version-$jarName.jar&quot;)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableRule</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">GuavaRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        <span class="keyword">def</span> variantVersion = context.details.id.version
        <span class="keyword">def</span> version = variantVersion.substring(<span class="integer">0</span>, variantVersion.indexOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">-</span><span class="delimiter">&quot;</span></span>))
        [<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>].each { base -&gt;
            [<span class="integer">6</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">android</span><span class="delimiter">&quot;</span></span>, <span class="integer">8</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jre</span><span class="delimiter">&quot;</span></span>].each { targetJvmVersion, jarName -&gt;
                context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdk</span><span class="inline"><span class="inline-delimiter">$</span>targetJvmVersion</span><span class="inline"><span class="inline-delimiter">${</span>base.capitalize()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>, base) {
                    attributes {
                        attributes.attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, targetJvmVersion)
                    }
                    withFiles {
                        removeAllFiles()
                        addFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">guava-</span><span class="inline"><span class="inline-delimiter">$</span>version</span><span class="content">-</span><span class="inline"><span class="inline-delimiter">${</span>jarName<span class="inline-delimiter">}</span></span><span class="content">.jar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">../</span><span class="inline"><span class="inline-delimiter">$</span>version</span><span class="content">-</span><span class="inline"><span class="inline-delimiter">$</span>jarName</span><span class="content">/guava-</span><span class="inline"><span class="inline-delimiter">$</span>version</span><span class="content">-</span><span class="inline"><span class="inline-delimiter">${</span>jarName<span class="inline-delimiter">}</span></span><span class="content">.jar</span><span class="delimiter">&quot;</span></span>)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Similar to the previous example, we add runtime and compile variants for both Java versions.
In the <code>withFiles</code> block however, we now also specify a relative path for the corresponding jar file which allows Gradle to find the file no matter if it has selected a <em>-jre</em> or <em>-android</em> version.
The path is always relative to the location of the metadata (in this case <code>pom</code>) file of the selection module version.
So with this rules, both Guava 28 "versions" carry both the <em>jdk6</em> and <em>jdk8</em> variants.
So it does not matter to which one Gradle resolves.
The variant, and with it the correct jar file, is determined based on the requested <code>TARGET_JVM_VERSION_ATTRIBUTE</code> value.</p>
</div>
<div id="ex-applying-and-utilising-rule-for-guava-metadata" class="exampleblock">
<div class="title">Example 217. <a href="#ex-applying-and-utilising-rule-for-guava-metadata">Applying and utilising rule for Guava metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations[&quot;compileClasspath&quot;].attributes {
    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, 6)
}
dependencies {
    components {
        withModule&lt;GuavaRule&gt;(&quot;com.google.guava:guava&quot;)
    }
    // '23.3-android' and '23.3-jre' are now the same as both offer both variants
    implementation(&quot;com.google.guava:guava:23.3+&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.compileClasspath.attributes {
    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, <span class="integer">6</span>)
}
dependencies {
    components {
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.guava:guava</span><span class="delimiter">&quot;</span></span>, GuavaRule)
    }
    <span class="comment">// '23.3-android' and '23.3-jre' are now the same as both offer both variants</span>
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.guava:guava:23.3+</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="adding_variants_for_native_jars"><a class="anchor" href="#adding_variants_for_native_jars"></a><a class="link" href="#adding_variants_for_native_jars">Adding variants for native jars</a></h4>
<div class="paragraph">
<p>Jars with classifiers are also used to separate parts of a library for which multiple alternatives exists, for example native code, from the main artifact.
This is for example done by the Lightweight Java Game Library (LWGJ), which publishes several platform specific jars to <a href="https://repo1.maven.org/maven2/org/lwjgl/lwjgl/3.2.3">Maven central</a> from which always one is needed, in addition to the main jar, at runtime.
It is not possible to convey this information in pom metadata as there is no concept of putting multiple artifacts in relation through the metadata.
In Gradle Module Metadata, each variant can have arbitrary many files and we can leverage that by writing the following rule:</p>
</div>
<div id="ex-rule-to-add-native-runtime-variants-to-lwgj-metadata" class="exampleblock">
<div class="title">Example 218. <a href="#ex-rule-to-add-native-runtime-variants-to-lwgj-metadata">Rule to add native runtime variants to LWGJ metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableRule
abstract class LwjglRule: ComponentMetadataRule {
    data class NativeVariant(val os: String, val arch: String, val classifier: String)

    private val nativeVariants = listOf(
        NativeVariant(OperatingSystemFamily.LINUX,   &quot;arm32&quot;,  &quot;natives-linux-arm32&quot;),
        NativeVariant(OperatingSystemFamily.LINUX,   &quot;arm64&quot;,  &quot;natives-linux-arm64&quot;),
        NativeVariant(OperatingSystemFamily.WINDOWS, &quot;x86&quot;,    &quot;natives-windows-x86&quot;),
        NativeVariant(OperatingSystemFamily.WINDOWS, &quot;x86-64&quot;, &quot;natives-windows&quot;),
        NativeVariant(OperatingSystemFamily.MACOS,   &quot;x86-64&quot;, &quot;natives-macos&quot;)
    )

    @get:Inject abstract val objects: ObjectFactory

    override fun execute(context: ComponentMetadataContext) {
        context.details.withVariant(&quot;runtime&quot;) {
            attributes {
                attributes.attribute(OperatingSystemFamily.OPERATING_SYSTEM_ATTRIBUTE, objects.named(&quot;none&quot;))
                attributes.attribute(MachineArchitecture.ARCHITECTURE_ATTRIBUTE, objects.named(&quot;none&quot;))
            }
        }
        nativeVariants.forEach { variantDefinition -&gt;
            context.details.addVariant(&quot;${variantDefinition.classifier}-runtime&quot;, &quot;runtime&quot;) {
                attributes {
                    attributes.attribute(OperatingSystemFamily.OPERATING_SYSTEM_ATTRIBUTE, objects.named(variantDefinition.os))
                    attributes.attribute(MachineArchitecture.ARCHITECTURE_ATTRIBUTE, objects.named(variantDefinition.arch))
                }
                withFiles {
                    addFile(&quot;${context.details.id.name}-${context.details.id.version}-${variantDefinition.classifier}.jar&quot;)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableRule</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">LwjglRule</span> <span class="directive">implements</span> ComponentMetadataRule { <span class="comment">//val os: String, val arch: String, val classifier: String)</span>
    <span class="directive">private</span> <span class="keyword">def</span> nativeVariants = [
        [<span class="key">os</span>: OperatingSystemFamily.LINUX,   <span class="key">arch</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">arm32</span><span class="delimiter">&quot;</span></span>,  <span class="key">classifier</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">natives-linux-arm32</span><span class="delimiter">&quot;</span></span>],
        [<span class="key">os</span>: OperatingSystemFamily.LINUX,   <span class="key">arch</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">arm64</span><span class="delimiter">&quot;</span></span>,  <span class="key">classifier</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">natives-linux-arm64</span><span class="delimiter">&quot;</span></span>],
        [<span class="key">os</span>: OperatingSystemFamily.WINDOWS, <span class="key">arch</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x86</span><span class="delimiter">&quot;</span></span>,    <span class="key">classifier</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">natives-windows-x86</span><span class="delimiter">&quot;</span></span>],
        [<span class="key">os</span>: OperatingSystemFamily.WINDOWS, <span class="key">arch</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x86-64</span><span class="delimiter">&quot;</span></span>, <span class="key">classifier</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">natives-windows</span><span class="delimiter">&quot;</span></span>],
        [<span class="key">os</span>: OperatingSystemFamily.MACOS,   <span class="key">arch</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x86-64</span><span class="delimiter">&quot;</span></span>, <span class="key">classifier</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">natives-macos</span><span class="delimiter">&quot;</span></span>]
    ]

    <span class="annotation">@Inject</span> <span class="directive">abstract</span> <span class="predefined-type">ObjectFactory</span> getObjects()

    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.withVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>) {
            attributes {
                attributes.attribute(OperatingSystemFamily.OPERATING_SYSTEM_ATTRIBUTE, objects.named(OperatingSystemFamily, <span class="string"><span class="delimiter">&quot;</span><span class="content">none</span><span class="delimiter">&quot;</span></span>))
                attributes.attribute(MachineArchitecture.ARCHITECTURE_ATTRIBUTE, objects.named(MachineArchitecture, <span class="string"><span class="delimiter">&quot;</span><span class="content">none</span><span class="delimiter">&quot;</span></span>))
            }
        }
        nativeVariants.each { variantDefinition -&gt;
            context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>variantDefinition.classifier<span class="inline-delimiter">}</span></span><span class="content">-runtime</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>) {
                attributes {
                    attributes.attribute(OperatingSystemFamily.OPERATING_SYSTEM_ATTRIBUTE, objects.named(OperatingSystemFamily, variantDefinition.os))
                    attributes.attribute(MachineArchitecture.ARCHITECTURE_ATTRIBUTE, objects.named(MachineArchitecture, variantDefinition.arch))
                }
                withFiles {
                    addFile(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>context.details.id.name<span class="inline-delimiter">}</span></span><span class="content">-</span><span class="inline"><span class="inline-delimiter">${</span>context.details.id.version<span class="inline-delimiter">}</span></span><span class="content">-</span><span class="inline"><span class="inline-delimiter">${</span>variantDefinition.classifier<span class="inline-delimiter">}</span></span><span class="content">.jar</span><span class="delimiter">&quot;</span></span>)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This rule is quite similar to the Quasar library example above.
Only this time we have five different runtime variants we add and nothing we need to change for the compile variant.
The runtime variants are all based on the existing <em>runtime</em> variant and we do not change any existing information.
All Java ecosystem attributes, the dependencies and the main jar file stay part of each of the runtime variants.
We only set the additional attributes <code>OPERATING_SYSTEM_ATTRIBUTE</code> and <code>ARCHITECTURE_ATTRIBUTE</code> which are defined as part of Gradle&#8217;s <a href="building_cpp_projects.html#building_cpp_projects">native support</a>.
And we add the corresponding native jar file so that each runtime variant now carries two files: the main jar and the native jar.</p>
</div>
<div class="paragraph">
<p>In the build script, we can now request a specific variant and Gradle will fail with a selection error if more information is needed to make a decision.</p>
</div>
<div class="paragraph">
<p>Gradle is able to understand the common case where a single attribute is missing that would have removed the ambiguity.
In this case, rather than listing information about all attributes on all available variants, Gradle helpfully lists only possible values for that attribute along with the variants each value would select.</p>
</div>
<div id="ex-applying-and-utilising-rule-for-lwgj-metadata" class="exampleblock">
<div class="title">Example 219. <a href="#ex-applying-and-utilising-rule-for-lwgj-metadata">Applying and utilising rule for LWGJ metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations[&quot;runtimeClasspath&quot;].attributes {
    attribute(OperatingSystemFamily.OPERATING_SYSTEM_ATTRIBUTE, objects.named(&quot;windows&quot;))
}
dependencies {
    components {
        withModule&lt;LwjglRule&gt;(&quot;org.lwjgl:lwjgl&quot;)
    }
    implementation(&quot;org.lwjgl:lwjgl:3.2.3&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations[<span class="string"><span class="delimiter">&quot;</span><span class="content">runtimeClasspath</span><span class="delimiter">&quot;</span></span>].attributes {
    attribute(OperatingSystemFamily.OPERATING_SYSTEM_ATTRIBUTE, objects.named(OperatingSystemFamily, <span class="string"><span class="delimiter">&quot;</span><span class="content">windows</span><span class="delimiter">&quot;</span></span>))
}
dependencies {
    components {
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.lwjgl:lwjgl</span><span class="delimiter">&quot;</span></span>, LwjglRule)
    }
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.lwjgl:lwjgl:3.2.3</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Gradle fails to select a variant because a machine architecture needs to be chosen</div>
<div class="content">
<pre>&gt; Could not resolve all files for configuration ':runtimeClasspath'.
   &gt; Could not resolve org.lwjgl:lwjgl:3.2.3.
     Required by:
         project :
      &gt; The consumer was configured to find a library for use during runtime, compatible with Java 11, packaged as a jar, preferably optimized for standard JVMs, and its dependencies declared externally, as well as attribute 'org.gradle.native.operatingSystem' with value 'windows'. There are several available matching variants of org.lwjgl:lwjgl:3.2.3
       The only attribute distinguishing these variants is 'org.gradle.native.architecture'. Add this attribute to the consumer's configuration to resolve the ambiguity:
          - Value: 'x86-64' selects variant: 'natives-windows-runtime'
          - Value: 'x86' selects variant: 'natives-windows-x86-runtime'</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="making_different_flavors_of_a_library_available_through_capabilities"><a class="anchor" href="#making_different_flavors_of_a_library_available_through_capabilities"></a><a class="link" href="#making_different_flavors_of_a_library_available_through_capabilities">Making different flavors of a library available through capabilities</a></h4>
<div class="paragraph">
<p>Because it is difficult to model <a href="#feature_variants">optional feature variants</a> as separate jars with pom metadata, libraries sometimes compose different jars with a different feature set.
That is, instead of composing your flavor of the library from different feature variants, you select one of the pre-composed variants (offering everything in one jar).
One such library is the well-known dependency injection framework Guice, published on <a href="https://repo1.maven.org/maven2/com/google/inject/guice/4.2.2">Maven central</a>, which offers a complete flavor (the main jar) and a reduced variant without aspect-oriented programming support (<code>guice-4.2.2-no_aop.jar</code>).
That second variant with a classifier is not mentioned in the pom metadata.
With the following rule, we create compile and runtime variants based on that file and make it selectable through a capability named <code>com.google.inject:guice-no_aop</code>.</p>
</div>
<div id="ex-rule-to-add-no-aop-feature-variant-to-guice-metadata" class="exampleblock">
<div class="title">Example 220. <a href="#ex-rule-to-add-no-aop-feature-variant-to-guice-metadata">Rule to add no_aop feature variant to Guice metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableRule
abstract class GuiceRule: ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        listOf(&quot;compile&quot;, &quot;runtime&quot;).forEach { base -&gt;
            context.details.addVariant(&quot;noAop${base.capitalize()}&quot;, base) {
                withCapabilities {
                    addCapability(&quot;com.google.inject&quot;, &quot;guice-no_aop&quot;, context.details.id.version)
                }
                withFiles {
                    removeAllFiles()
                    addFile(&quot;guice-${context.details.id.version}-no_aop.jar&quot;)
                }
                withDependencies {
                    removeAll { it.group == &quot;aopalliance&quot; }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableRule</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">GuiceRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        [<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>].each { base -&gt;
            context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">noAop</span><span class="inline"><span class="inline-delimiter">${</span>base.capitalize()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>, base) {
                withCapabilities {
                    addCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.inject</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">guice-no_aop</span><span class="delimiter">&quot;</span></span>, context.details.id.version)
                }
                withFiles {
                    removeAllFiles()
                    addFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">guice-</span><span class="inline"><span class="inline-delimiter">${</span>context.details.id.version<span class="inline-delimiter">}</span></span><span class="content">-no_aop.jar</span><span class="delimiter">&quot;</span></span>)
                }
                withDependencies {
                    removeAll { <span class="local-variable">it</span>.group == <span class="string"><span class="delimiter">&quot;</span><span class="content">aopalliance</span><span class="delimiter">&quot;</span></span> }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The new variants also have the dependency on the standardized aop interfaces library <code>aopalliance:aopalliance</code> removed, as this is clearly not needed by these variants.
Again, this is information that cannot be expressed in pom metadata.
We can now select a <code>guice-no_aop</code> variant and will get the correct jar file <strong>and</strong> the correct dependencies.</p>
</div>
<div id="ex-applying-and-utilising-rule-for-guice-metadata" class="exampleblock">
<div class="title">Example 221. <a href="#ex-applying-and-utilising-rule-for-guice-metadata">Applying and utilising rule for Guice metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    components {
        withModule&lt;GuiceRule&gt;(&quot;com.google.inject:guice&quot;)
    }
    implementation(&quot;com.google.inject:guice:4.2.2&quot;) {
        capabilities { requireCapability(&quot;com.google.inject:guice-no_aop&quot;) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    components {
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.inject:guice</span><span class="delimiter">&quot;</span></span>, GuiceRule)
    }
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.inject:guice:4.2.2</span><span class="delimiter">&quot;</span></span>) {
        capabilities { requireCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.inject:guice-no_aop</span><span class="delimiter">&quot;</span></span>) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="adding_missing_capabilities_to_detect_conflicts"><a class="anchor" href="#adding_missing_capabilities_to_detect_conflicts"></a><a class="link" href="#adding_missing_capabilities_to_detect_conflicts">Adding missing capabilities to detect conflicts</a></h4>
<div class="paragraph">
<p>Another usage of capabilities is to express that two different modules, for example <code>log4j</code> and <code>log4j-over-slf4j</code>, provide alternative implementations of the same thing.
By declaring that both provide the same capability, Gradle only accepts one of them in a dependency graph.
This example, and how it can be tackled with a component metadata rule, is described in detail in the  <a href="#sec:declaring-capabilities-external-modules">feature modelling</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="making_ivy_modules_variant_aware"><a class="anchor" href="#making_ivy_modules_variant_aware"></a><a class="link" href="#making_ivy_modules_variant_aware">Making Ivy modules variant-aware</a></h4>
<div class="paragraph">
<p>Modules with Ivy metadata, do not have variants by default.
However, <em>Ivy configurations</em> can be mapped to variants as the <code>addVariant(name, baseVariantOrConfiguration)</code> accepts any Ivy configuration that was published as base.
This can be used, for example, to define runtime and compile variants.
An example of a corresponding rule can be found <a href="#sub:ivy-mapping-to-variants">here</a>.
Ivy details of Ivy configurations (e.g. dependencies and files) can also be modified using the <code>withVariant(configurationName)</code> API.
However, modifying attributes or capabilities on Ivy configurations has no effect.</p>
</div>
<div class="paragraph">
<p>For very Ivy specific use cases, the component metadata rules API also offers access to other details only found in Ivy metadata.
These are available through the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ivy/IvyModuleDescriptor.html">IvyModuleDescriptor</a> interface and can be accessed using <code>getDescriptor(IvyModuleDescriptor)</code> on the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ComponentMetadataContext.html">ComponentMetadataContext</a>.</p>
</div>
<div id="ex-ivy-component-metadata-rule" class="exampleblock">
<div class="title">Example 222. <a href="#ex-ivy-component-metadata-rule">Ivy component metadata rule</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableRule
abstract class IvyComponentRule : ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        val descriptor = context.getDescriptor(IvyModuleDescriptor::class)
        if (descriptor != null &amp;&amp; descriptor.branch == &quot;testing&quot;) {
            context.details.status = &quot;rc&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableRule</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">IvyComponentRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        <span class="keyword">def</span> descriptor = context.getDescriptor(IvyModuleDescriptor)
        <span class="keyword">if</span> (descriptor != <span class="predefined-constant">null</span> &amp;&amp; descriptor.branch == <span class="string"><span class="delimiter">&quot;</span><span class="content">testing</span><span class="delimiter">&quot;</span></span>) {
            context.details.status = <span class="string"><span class="delimiter">&quot;</span><span class="content">rc</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="filter_using_maven_metadata"><a class="anchor" href="#filter_using_maven_metadata"></a><a class="link" href="#filter_using_maven_metadata">Filter using Maven metadata</a></h4>
<div class="paragraph">
<p>For Maven specific use cases, the component metadata rules API also offers access to other details only found in POM metadata.
These are available through the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/maven/PomModuleDescriptor.html">PomModuleDescriptor</a> interface and can be accessed using <code>getDescriptor(PomModuleDescriptor)</code> on the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ComponentMetadataContext.html">ComponentMetadataContext</a>.</p>
</div>
<div id="ex-access-pom-packaging-type-in-component-metadata-rule" class="exampleblock">
<div class="title">Example 223. <a href="#ex-access-pom-packaging-type-in-component-metadata-rule">Access pom packaging type in component metadata rule</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableRule
abstract class MavenComponentRule : ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        val descriptor = context.getDescriptor(PomModuleDescriptor::class)
        if (descriptor != null &amp;&amp; descriptor.packaging == &quot;war&quot;) {
            // ...
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableRule</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">MavenComponentRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        <span class="keyword">def</span> descriptor = context.getDescriptor(PomModuleDescriptor)
        <span class="keyword">if</span> (descriptor != <span class="predefined-constant">null</span> &amp;&amp; descriptor.packaging == <span class="string"><span class="delimiter">&quot;</span><span class="content">war</span><span class="delimiter">&quot;</span></span>) {
            <span class="comment">// ...</span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="modifying_metadata_on_the_component_level_for_alignment"><a class="anchor" href="#modifying_metadata_on_the_component_level_for_alignment"></a><a class="link" href="#modifying_metadata_on_the_component_level_for_alignment">Modifying metadata on the component level for alignment</a></h4>
<div class="paragraph">
<p>While all the examples above made modifications to variants of a component, there is also a limited set of modifications that can be done to the metadata of the component itself.
This information can influence the <a href="#understanding_dependency_resolution">version selection</a> process for a module during dependency resolution, which is performed <em>before</em> one or multiple variants of a component are selected.</p>
</div>
<div class="paragraph">
<p>The first API available on the component is <code>belongsTo()</code> to create virtual platforms for aligning versions of multiple modules without Gradle Module Metadata.
It is explained in detail in the section on <a href="#sec:align-versions-unpublished">aligning versions of modules not published with Gradle</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:custom_status_scheme"><a class="anchor" href="#sec:custom_status_scheme"></a><a class="link" href="#sec:custom_status_scheme">Modifying metadata on the component level for version selection based on status</a></h4>
<div class="paragraph">
<p>Gradle and Gradle Module Metadata also allow attributes to be set on the whole component instead of a single variant.
Each of these attributes carries special semantics as they influence version selection which is done <em>before</em> variant selection.
While variant selection can handle <a href="#sec:declaring_attributes">any custom attribute</a>, version selection only considers attributes for which specific semantics are implemented.
At the moment, the only attribute with meaning here is <code>org.gradle.status</code>.
It is therefore recommended to only modify this attribute, if any, on the component level.
A dedicated API <code>setStatus(value)</code> is available for this.
To modify another attribute for all variants of a component <code>withAllVariants { attributes {} }</code> should be utilised instead.</p>
</div>
<div class="paragraph">
<p>A module&#8217;s status is taken into consideration when a <a href="#single-version-declarations"><em>latest</em> version selector</a> is resolved.
Specifically, <code>latest.someStatus</code> will resolve to the highest module version that has status <code>someStatus</code> or a more mature status.
For example, <code>latest.integration</code> will select the highest module version regardless of its status (because <code>integration</code> is the least mature status as explained below), whereas <code>latest.release</code> will select the highest module version with status <code>release</code>.</p>
</div>
<div class="paragraph">
<p>The interpretation of the status can be influenced by changing a module&#8217;s <em>status scheme</em> through the <code>setStatusScheme(valueList)</code> API.
This concept models the different levels of maturity that a module transitions through over time with different publications.
The default status scheme, ordered from least to most mature status, is <code>integration</code>, <code>milestone</code>, <code>release</code>.
The <code>org.gradle.status</code> attribute must be set, to one of the values in the components status scheme.
Thus each component always has a status which is determined from the metadata as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle Module Metadata: the value that was published for the <code>org.gradle.status</code> attribute on the component</p>
</li>
<li>
<p>Ivy metadata: <code>status</code> defined in the ivy.xml, defaults to <code>integration</code> if missing</p>
</li>
<li>
<p>Pom metadata: <code>integration</code> for modules with a SNAPSHOT version, <code>release</code> for all others</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example demonstrates <code>latest</code> selectors based on a custom status scheme declared in a component metadata rule that applies to all modules:</p>
</div>
<div id="ex-custom-status-scheme" class="exampleblock">
<div class="title">Example 224. <a href="#ex-custom-status-scheme">Custom status scheme</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableRule
abstract class CustomStatusRule : ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        context.details.statusScheme = listOf(&quot;nightly&quot;, &quot;milestone&quot;, &quot;rc&quot;, &quot;release&quot;)
        if (context.details.status == &quot;integration&quot;) {
            context.details.status = &quot;nightly&quot;
        }
    }
}

dependencies {
    components {
        all&lt;CustomStatusRule&gt;()
    }
    implementation(&quot;org.apache.commons:commons-lang3:latest.rc&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableRule</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">CustomStatusRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.statusScheme = [<span class="string"><span class="delimiter">&quot;</span><span class="content">nightly</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">milestone</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">rc</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">release</span><span class="delimiter">&quot;</span></span>]
        <span class="keyword">if</span> (context.details.status == <span class="string"><span class="delimiter">&quot;</span><span class="content">integration</span><span class="delimiter">&quot;</span></span>) {
            context.details.status = <span class="string"><span class="delimiter">&quot;</span><span class="content">nightly</span><span class="delimiter">&quot;</span></span>
        }
    }
}

dependencies {
    components {
        all(CustomStatusRule)
    }
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons:commons-lang3:latest.rc</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Compared to the default scheme, the rule inserts a new status <code>rc</code> and replaces <code>integration</code> with <code>nightly</code>.
Existing modules with the state <code>integration</code> are mapped to <code>nightly</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="resolution_rules"><a class="anchor" href="#resolution_rules"></a><a class="link" href="#resolution_rules">Customizing resolution of a dependency directly</a></h3>
<div class="paragraph">
<p>This section covers mechanisms Gradle offers to directly influence the behavior of the dependency resolution engine.
In contrast to the other concepts covered in this chapter, like <a href="#dependency-constraints">dependency constraints</a> or <a href="#sec:component_metadata_rules">component metadata rules</a>, which are all <strong>inputs</strong> to resolution, the following mechanisms allow you to write rules which are directly injected into the resolution engine.
Because of this, they can be seen as <em>brute force</em> solutions, that may hide future problems (e.g. if new dependencies are added).
Therefore, the general advice is to only use the following mechanisms if other means are not sufficient.
If you are authoring a <a href="#sec:understanding-diff-libraries-and-apps">library</a>, you should always prefer <a href="#dependency-constraints">dependency constraints</a> as they are published for your consumers.</p>
</div>
<div class="sect3">
<h4 id="sec:dependency_resolve_rules"><a class="anchor" href="#sec:dependency_resolve_rules"></a><a class="link" href="#sec:dependency_resolve_rules">Using dependency resolve rules</a></h4>
<div class="paragraph">
<p>A dependency resolve rule is executed for each resolved dependency, and offers a powerful api for manipulating a requested dependency prior to that dependency being resolved.
The feature currently offers the ability to change the group, name and/or version of a requested dependency, allowing a dependency to be substituted with a completely different module during resolution.</p>
</div>
<div class="paragraph">
<p>Dependency resolve rules provide a very powerful way to control the dependency resolution process, and can be used to implement all sorts of advanced patterns in dependency management.
Some of these patterns are outlined below.
For more information and code samples see the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.ResolutionStrategy.html">ResolutionStrategy</a> class in the API documentation.</p>
</div>
<div class="sect4">
<h5 id="sec:custom_versioning_scheme"><a class="anchor" href="#sec:custom_versioning_scheme"></a><a class="link" href="#sec:custom_versioning_scheme">Implementing a custom versioning scheme</a></h5>
<div class="paragraph">
<p>In some corporate environments, the list of module versions that can be declared in Gradle builds is maintained and audited externally.
Dependency resolve rules provide a neat implementation of this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the build script, the developer declares dependencies with the module group and name, but uses a placeholder version, for example: <code>default</code>.</p>
</li>
<li>
<p>The <code>default</code> version is resolved to a specific version via a dependency resolve rule, which looks up the version in a corporate catalog of approved modules.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This rule implementation can be neatly encapsulated in a corporate plugin, and shared across all builds within the organisation.</p>
</div>
<div id="ex-using-a-custom-versioning-scheme" class="exampleblock">
<div class="title">Example 225. <a href="#ex-using-a-custom-versioning-scheme">Using a custom versioning scheme</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.eachDependency {
        if (requested.version == &quot;default&quot;) {
            val version = findDefaultVersionInCatalog(requested.group, requested.name)
            useVersion(version.version)
            because(version.because)
        }
    }
}

data class DefaultVersion(val version: String, val because: String)

fun findDefaultVersionInCatalog(group: String, name: String): DefaultVersion {
    //some custom logic that resolves the default version into a specific version
    return DefaultVersion(version = &quot;1.0&quot;, because = &quot;tested by QA&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.eachDependency { DependencyResolveDetails details -&gt;
        <span class="keyword">if</span> (details.requested.version == <span class="string"><span class="delimiter">'</span><span class="content">default</span><span class="delimiter">'</span></span>) {
            <span class="keyword">def</span> version = findDefaultVersionInCatalog(details.requested.group, details.requested.name)
            details.useVersion version.version
            details.because version.because
        }
    }
}

<span class="keyword">def</span> <span class="function">findDefaultVersionInCatalog</span>(<span class="predefined-type">String</span> group, <span class="predefined-type">String</span> name) {
    <span class="comment">//some custom logic that resolves the default version into a specific version</span>
    [<span class="key">version</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>, <span class="key">because</span>: <span class="string"><span class="delimiter">'</span><span class="content">tested by QA</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:denying_version"><a class="anchor" href="#sec:denying_version"></a><a class="link" href="#sec:denying_version">Denying a particular version with a replacement</a></h5>
<div class="paragraph">
<p>Dependency resolve rules provide a mechanism for denying a particular version of a dependency and providing a replacement version.
This can be useful if a certain dependency version is broken and should not be used, where a dependency resolve rule causes this version to be replaced with a known good version.
One example of a broken module is one that declares a dependency on a library that cannot be found in any of the public repositories, but there are many other reasons why a particular module version is unwanted and a different version is preferred.</p>
</div>
<div class="paragraph">
<p>In example below, imagine that version <code>1.2.1</code> contains important fixes and should always be used in preference to <code>1.2</code>.
The rule provided will enforce just this: any time version <code>1.2</code> is encountered it will be replaced with <code>1.2.1</code>.
Note that this is different from a forced version as described above, in that any other versions of this module would not be affected.
This means that the 'newest' conflict resolution strategy would still select version <code>1.3</code> if this version was also pulled transitively.</p>
</div>
<div id="ex-example-blacklisting-a-version-with-a-replacement" class="exampleblock">
<div class="title">Example 226. <a href="#ex-example-blacklisting-a-version-with-a-replacement">Example: Blacklisting a version with a replacement</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.eachDependency {
        if (requested.group == &quot;org.software&quot; &amp;&amp; requested.name == &quot;some-library&quot; &amp;&amp; requested.version == &quot;1.2&quot;) {
            useVersion(&quot;1.2.1&quot;)
            because(&quot;fixes critical bug in 1.2&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.eachDependency { DependencyResolveDetails details -&gt;
        <span class="keyword">if</span> (details.requested.group == <span class="string"><span class="delimiter">'</span><span class="content">org.software</span><span class="delimiter">'</span></span> &amp;&amp; details.requested.name == <span class="string"><span class="delimiter">'</span><span class="content">some-library</span><span class="delimiter">'</span></span> &amp;&amp; details.requested.version == <span class="string"><span class="delimiter">'</span><span class="content">1.2</span><span class="delimiter">'</span></span>) {
            details.useVersion <span class="string"><span class="delimiter">'</span><span class="content">1.2.1</span><span class="delimiter">'</span></span>
            details.because <span class="string"><span class="delimiter">'</span><span class="content">fixes critical bug in 1.2</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There&#8217;s a difference with using the <em>reject</em> directive of <a href="#rich-version-constraints">rich version constraints</a>: rich versions will cause the build to fail if a rejected version is found in the graph, or select a non rejected version when using dynamic dependencies.
Here, we <em>manipulate the requested versions</em> in order to select a different version when we find a rejected one.
In other words, this is a <em>solution</em> to rejected versions, while rich version constraints allow declaring the <em>intent</em> (you should not use this version).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:module_replacement"><a class="anchor" href="#sec:module_replacement"></a><a class="link" href="#sec:module_replacement">Using module replacement rules</a></h4>
<div class="paragraph">
<p>It is preferable to express module conflicts in terms of <a href="#sub:capabilities">capabilities conflicts</a>.
However, if there&#8217;s no such rule declared or that you are working on versions of Gradle which do not support capabilities, Gradle provides tooling to work around those issues.</p>
</div>
<div class="paragraph">
<p>Module replacement rules allow a build to declare that a legacy library has been replaced by a new one.
A good example when a new library replaced a legacy one is the <code>google-collections</code> -&gt; <code>guava</code> migration.
The team that created google-collections decided to change the module name from <code>com.google.collections:google-collections</code> into <code>com.google.guava:guava</code>.
This is a legal scenario in the industry: teams need to be able to change the names of products they maintain, including the module coordinates. Renaming of the module coordinates has impact on conflict resolution.</p>
</div>
<div class="paragraph">
<p>To explain the impact on conflict resolution, let&#8217;s consider the <code>google-collections</code> -&gt; <code>guava</code> scenario.
It may happen that both libraries are pulled into the same dependency graph.
For example, <em>our project</em> depends on <code>guava</code> but some of <em>our dependencies</em> pull in a legacy version of <code>google-collections</code>.
This can cause runtime errors, for example during test or application execution.
Gradle does not automatically resolve the <code>google-collections</code> -&gt; <code>guava</code> conflict because it is not considered as a <em>version conflict</em>.
It&#8217;s because the module coordinates for both libraries are completely different and conflict resolution is activated when <code>group</code> and <code>module</code> coordinates are the same but there are different versions available in the dependency graph (for more info, refer to the section on conflict resolution).
Traditional remedies to this problem are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declare exclusion rule to avoid pulling in <code>google-collections</code> to graph. It is probably the most popular approach.</p>
</li>
<li>
<p>Avoid dependencies that pull in legacy libraries.</p>
</li>
<li>
<p>Upgrade the dependency version if the new version no longer pulls in a legacy library.</p>
</li>
<li>
<p>Downgrade to <code>google-collections</code>. It&#8217;s not recommended, just mentioned for completeness.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Traditional approaches work but they are not general enough.
For example, an organisation wants to resolve the <code>google-collections</code> -&gt; <code>guava</code> conflict resolution problem in all projects.
It is possible to declare that certain module was replaced by other.
This enables organisations to include the information about module replacement in the corporate plugin suite and resolve the problem holistically for all Gradle-powered projects in the enterprise.</p>
</div>
<div id="ex-declaring-a-module-replacement" class="exampleblock">
<div class="title">Example 227. <a href="#ex-declaring-a-module-replacement">Declaring a module replacement</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    modules {
        module(&quot;com.google.collections:google-collections&quot;) {
            replacedBy(&quot;com.google.guava:guava&quot;, &quot;google-collections is now part of Guava&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    modules {
        module(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.collections:google-collections</span><span class="delimiter">&quot;</span></span>) {
            replacedBy(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.guava:guava</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">google-collections is now part of Guava</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more examples and detailed API, refer to the DSL reference for <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/dsl/ComponentMetadataHandler.html">ComponentMetadataHandler</a>.</p>
</div>
<div class="paragraph">
<p>What happens when we declare that <code>google-collections</code> is replaced by <code>guava</code>?
Gradle can use this information for conflict resolution. Gradle will consider every version of <code>guava</code> newer/better than any version of <code>google-collections</code>.
Also, Gradle will ensure that only guava jar is present in the classpath / resolved file list.
Note that if only <code>google-collections</code> appears in the dependency graph (e.g. no <code>guava</code>) Gradle will not eagerly replace it with <code>guava</code>.
Module replacement is an information that Gradle uses for resolving conflicts.
If there is no conflict (e.g. only <code>google-collections</code> or only <code>guava</code> in the graph) the replacement information is not used.</p>
</div>
<div class="paragraph">
<p>Currently it is not possible to declare that a given module is replaced by a set of modules.
However, it is possible to declare that multiple modules are replaced by a single module.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:dependency_substitution_rules"><a class="anchor" href="#sec:dependency_substitution_rules"></a><a class="link" href="#sec:dependency_substitution_rules">Using dependency substitution rules</a></h4>
<div class="paragraph">
<p>Dependency substitution rules work similarly to dependency resolve rules.
In fact, many capabilities of dependency resolve rules can be implemented with dependency substitution rules.
 They allow project and module dependencies to be transparently substituted with specified replacements.
 Unlike dependency resolve rules, dependency substitution rules allow project and module dependencies to be substituted interchangeably.</p>
</div>
<div class="paragraph">
<p><em>Adding a dependency substitution rule to a configuration changes the timing of when that configuration is resolved.</em>
Instead of being resolved on first use, the configuration is instead resolved when the task graph is being constructed.
This can have unexpected consequences if the configuration is being further modified during task execution, or if the configuration relies on modules that are published during execution of another task.</p>
</div>
<div class="paragraph">
<p>To explain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>Configuration</code> can be declared as an input to any Task, and that configuration can include project dependencies when it is resolved.</p>
</li>
<li>
<p>If a project dependency is an input to a Task (via a configuration), then tasks to build the project artifacts must be added to the task dependencies.</p>
</li>
<li>
<p>In order to determine the project dependencies that are inputs to a task, Gradle needs to resolve the <code>Configuration</code> inputs.</p>
</li>
<li>
<p>Because the Gradle task graph is fixed once task execution has commenced, Gradle needs to perform this resolution prior to executing any tasks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the absence of dependency substitution rules, Gradle knows that an external module dependency will never transitively reference a project dependency.
This makes it easy to determine the full set of project dependencies for a configuration through simple graph traversal.
With this functionality, Gradle can no longer make this assumption, and must perform a full resolve in order to determine the project dependencies.</p>
</div>
<div class="sect4">
<h5 id="sub:module_to_project_substitution"><a class="anchor" href="#sub:module_to_project_substitution"></a><a class="link" href="#sub:module_to_project_substitution">Substituting an external module dependency with a project dependency</a></h5>
<div class="paragraph">
<p>One use case for dependency substitution is to use a locally developed version of a module in place of one that is downloaded from an external repository.
This could be useful for testing a local, patched version of a dependency.</p>
</div>
<div class="paragraph">
<p>The module to be replaced can be declared with or without a version specified.</p>
</div>
<div id="ex-substituting-a-module-with-a-project" class="exampleblock">
<div class="title">Example 228. <a href="#ex-substituting-a-module-with-a-project">Substituting a module with a project</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute(module(&quot;org.utils:api&quot;))
            .using(project(&quot;:api&quot;)).because(&quot;we work with the unreleased development version&quot;)
        substitute(module(&quot;org.utils:util:2.5&quot;)).using(project(&quot;:util&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute module(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.utils:api</span><span class="delimiter">&quot;</span></span>) using project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:api</span><span class="delimiter">&quot;</span></span>) because <span class="string"><span class="delimiter">&quot;</span><span class="content">we work with the unreleased development version</span><span class="delimiter">&quot;</span></span>
        substitute module(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.utils:util:2.5</span><span class="delimiter">&quot;</span></span>) using project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:util</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that a project that is substituted must be included in the multi-project build (via <code>settings.gradle</code>).
Dependency substitution rules take care of replacing the module dependency with the project dependency and wiring up any task dependencies, but do not implicitly include the project in the build.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:project_to_module_substitution"><a class="anchor" href="#sub:project_to_module_substitution"></a><a class="link" href="#sub:project_to_module_substitution">Substituting a project dependency with a module replacement</a></h5>
<div class="paragraph">
<p>Another way to use substitution rules is to replace a project dependency with a module in a multi-project build.
This can be useful to speed up development with a large multi-project build, by allowing a subset of the project dependencies to be downloaded from a repository rather than being built.</p>
</div>
<div class="paragraph">
<p>The module to be used as a replacement must be declared with a version specified.</p>
</div>
<div id="ex-substituting-a-project-with-a-module" class="exampleblock">
<div class="title">Example 229. <a href="#ex-substituting-a-project-with-a-module">Substituting a project with a module</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute(project(&quot;:api&quot;))
            .using(module(&quot;org.utils:api:1.3&quot;)).because(&quot;we use a stable version of org.utils:api&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:api</span><span class="delimiter">&quot;</span></span>) using module(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.utils:api:1.3</span><span class="delimiter">&quot;</span></span>) because <span class="string"><span class="delimiter">&quot;</span><span class="content">we use a stable version of org.utils:api</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When a project dependency has been replaced with a module dependency, that project is still included in the overall multi-project build.
However, tasks to build the replaced dependency will not be executed in order to resolve the depending <code>Configuration</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:conditional_dependency_substitution"><a class="anchor" href="#sub:conditional_dependency_substitution"></a><a class="link" href="#sub:conditional_dependency_substitution">Conditionally substituting a dependency</a></h5>
<div class="paragraph">
<p>A common use case for dependency substitution is to allow more flexible assembly of sub-projects within a multi-project build.
This can be useful for developing a local, patched version of an external dependency or for building a subset of the modules within a large multi-project build.</p>
</div>
<div class="paragraph">
<p>The following example uses a dependency substitution rule to replace any module dependency with the group <code>org.example</code>, but only if a local project matching the dependency name can be located.</p>
</div>
<div id="ex-conditionally-substituting-a-dependency" class="exampleblock">
<div class="title">Example 230. <a href="#ex-conditionally-substituting-a-dependency">Conditionally substituting a dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.dependencySubstitution.all {
        requested.let {
            if (it is ModuleComponentSelector &amp;&amp; it.group == &quot;org.example&quot;) {
                val targetProject = findProject(&quot;:${it.module}&quot;)
                if (targetProject != null) {
                    useTarget(targetProject)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.dependencySubstitution.all { DependencySubstitution dependency -&gt;
        <span class="keyword">if</span> (dependency.requested <span class="keyword">instanceof</span> ModuleComponentSelector &amp;&amp; dependency.requested.group == <span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span>) {
            <span class="keyword">def</span> targetProject = findProject(<span class="string"><span class="delimiter">&quot;</span><span class="content">:</span><span class="inline"><span class="inline-delimiter">${</span>dependency.requested.module<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
            <span class="keyword">if</span> (targetProject != <span class="predefined-constant">null</span>) {
                dependency.useTarget targetProject
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that a project that is substituted must be included in the multi-project build (via <code>settings.gradle</code>).
Dependency substitution rules take care of replacing the module dependency with the project dependency, but do not implicitly include the project in the build.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:variant_aware_substitutions"><a class="anchor" href="#sec:variant_aware_substitutions"></a><a class="link" href="#sec:variant_aware_substitutions">Substituting a dependency with another variant</a></h5>
<div class="paragraph">
<p>Gradle&#8217;s dependency management engine is <a href="#understanding-variant-selection">variant-aware</a> meaning that for a single component, the engine may select different artifacts and transitive dependencies.</p>
</div>
<div class="paragraph">
<p>What to select is determined by the attributes of the consumer configuration and the attributes of the variants found on the producer side.
It is, however, possible that some specific dependencies override attributes from the configuration itself.
This is typically the case when using the <a href="#java_platform_plugin">Java Platform plugin</a>: this plugin builds a special kind of component which is called a "platform" and can be addressed by setting the component category attribute to <code>platform</code>, in opposition to typical dependencies which are targetting libraries.</p>
</div>
<div class="paragraph">
<p>Therefore, you may face situations where you want to substitute a platform dependency with a regular dependency, or the other way around.</p>
</div>
<div class="sect5">
<h6 id="sec:substitution_with_attributes"><a class="anchor" href="#sec:substitution_with_attributes"></a><a class="link" href="#sec:substitution_with_attributes">Substituting a dependency with attributes</a></h6>
<div class="paragraph">
<p>Let&#8217;s imagine that you want to substitute a platform dependency with a regular dependency.
This means that the library you are consuming declared something like this:</p>
</div>
<div id="ex-an-incorrect-dependency-on-a-platform" class="exampleblock">
<div class="title">Example 231. <a href="#ex-an-incorrect-dependency-on-a-platform">An incorrect dependency on a platform</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">lib/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // This is a platform dependency but you want the library
    implementation(platform(&quot;com.google.guava:guava:28.2-jre&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">lib/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// This is a platform dependency but you want the library</span>
    implementation platform(<span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:28.2-jre</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>platform</code> keyword is actually a short-hand notation for a <em>dependency with attributes</em>.
If we want to substitute this dependency with a regular dependency, then we need to select precisely the dependencies which have the <code>platform</code> attribute.</p>
</div>
<div class="paragraph">
<p>This can be done by using a substitution rule:</p>
</div>
<div id="ex-substitute-a-platform-dependency-with-a-regular-dependency" class="exampleblock">
<div class="title">Example 232. <a href="#ex-substitute-a-platform-dependency-with-a-regular-dependency">Substitute a platform dependency with a regular dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute(platform(module(&quot;com.google.guava:guava:28.2-jre&quot;)))
            .using(module(&quot;com.google.guava:guava:28.2-jre&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute(platform(module(<span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:28.2-jre</span><span class="delimiter">'</span></span>))).
            using module(<span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:28.2-jre</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The same rule <em>without</em> the <code>platform</code> keyword would try to substitute <em>regular dependencies</em> with a regular dependency, which is not what you want, so it&#8217;s important to understand that the substitution rules apply on a <em>dependency specification</em>: it matches the requested dependency (<code>substitute XXX</code>) with a substitute (<code>using YYY</code>).</p>
</div>
<div class="paragraph">
<p>You can have attributes on both the requested dependency <em>or</em> the substitute and the substitution is not limited to <code>platform</code>: you can actually specify the whole set of dependency attributes using the <code>variant</code> notation.
The following rule is <em>strictly equivalent</em> to the rule above:</p>
</div>
<div id="ex-substitute-a-platform-dependency-with-a-regular-dependency-using-the-variant-notation" class="exampleblock">
<div class="title">Example 233. <a href="#ex-substitute-a-platform-dependency-with-a-regular-dependency-using-the-variant-notation">Substitute a platform dependency with a regular dependency using the variant notation</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute(variant(module(&quot;com.google.guava:guava:28.2-jre&quot;)) {
            attributes {
                attribute(Category.CATEGORY_ATTRIBUTE, objects.named(Category.REGULAR_PLATFORM))
            }
        }).using(module(&quot;com.google.guava:guava:28.2-jre&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute variant(module(<span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:28.2-jre</span><span class="delimiter">'</span></span>)) {
            attributes {
                attribute(Category.CATEGORY_ATTRIBUTE, objects.named(Category, Category.REGULAR_PLATFORM))
            }
        } using module(<span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:28.2-jre</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Please refer to the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/DependencySubstitutions.html#variant-org.gradle.api.artifacts.component.ComponentSelector-org.gradle.api.Action-">Substitution DSL API docs</a> for a complete reference of the variant substitution API.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
In <a href="#composite_build_intro">composite builds</a>, the rule that you have to match the exact requested dependency attributes is not applied: when using composites, Gradle will automatically match the requested attributes.
In other words, it is implicit that if you include another build, you are substituting <em>all variants</em> of the substituted module with an equivalent variant in the included build.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="sec:substitution_with_capabilities"><a class="anchor" href="#sec:substitution_with_capabilities"></a><a class="link" href="#sec:substitution_with_capabilities">Substituting a dependency with a dependency with capabilities</a></h6>
<div class="paragraph">
<p>Similarly to <a href="#sec:substitution_with_attributes">attributes substitution</a>, Gradle lets you substitute a dependency with or without capabilities with another dependency with or without capabilities.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s imagine that you need to substitute a regular dependency with its <a href="#sec:java_test_fixtures">test fixtures</a> instead.
You can achieve this by using the following dependency substitution rule:</p>
</div>
<div id="ex-substitute-a-dependency-with-its-test-fixtures" class="exampleblock">
<div class="title">Example 234. <a href="#ex-substitute-a-dependency-with-its-test-fixtures">Substitute a dependency with its test fixtures</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.testCompileClasspath {
    resolutionStrategy.dependencySubstitution {
        substitute(module(&quot;com.acme:lib:1.0&quot;)).using(variant(module(&quot;com.acme:lib:1.0&quot;)) {
            capabilities {
                requireCapability(&quot;com.acme:lib-test-fixtures&quot;)
            }
        })
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.testCompileClasspath {
    resolutionStrategy.dependencySubstitution {
        substitute(module(<span class="string"><span class="delimiter">'</span><span class="content">com.acme:lib:1.0</span><span class="delimiter">'</span></span>))
            .using variant(module(<span class="string"><span class="delimiter">'</span><span class="content">com.acme:lib:1.0</span><span class="delimiter">'</span></span>)) {
            capabilities {
                requireCapability(<span class="string"><span class="delimiter">'</span><span class="content">com.acme:lib-test-fixtures</span><span class="delimiter">'</span></span>)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Capabilities which are declared in a substitution rule on the requested dependency constitute part of the dependency match specification, and therefore dependencies which do <em>not</em> require the capabilities will not be matched.</p>
</div>
<div class="paragraph">
<p>Please refer to the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/DependencySubstitutions.html#variant-org.gradle.api.artifacts.component.ComponentSelector-org.gradle.api.Action-">Substitution DSL API docs</a> for a complete reference of the variant substitution API.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:substitution_with_classifier"><a class="anchor" href="#sec:substitution_with_classifier"></a><a class="link" href="#sec:substitution_with_classifier">Substituting a dependency with a classifier or artifact</a></h5>
<div class="paragraph">
<p>While external modules are in general addressed via their group/artifact/version coordinates, it is common that such modules are published with additional artifacts that you may want to use in place of the main artifact.
This is typically the case for <em>classified</em> artifacts, but you may also need to select an artifact with a different file type or extension.
Gradle discourages use of classifiers in dependencies and prefers to model such artifacts as <a href="#understanding-variant-selection">additional variants of a module</a>.
There are lots of advantages of using variants instead of classified artifacts, including, but not only, a different set of dependencies for those artifacts.</p>
</div>
<div class="paragraph">
<p>However, in order to help bridging the two models, Gradle provides means to change or remove a classifier in a substitution rule.</p>
</div>
<div id="ex-dependencies-which-will-lead-to-a-resolution-error" class="exampleblock">
<div class="title">Example 235. <a href="#ex-dependencies-which-will-lead-to-a-resolution-error">Dependencies which will lead to a resolution error</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;com.google.guava:guava:28.2-jre&quot;)
    implementation(&quot;co.paralleluniverse:quasar-core:0.8.0&quot;)
    implementation(project(&quot;:lib&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:28.2-jre</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">co.paralleluniverse:quasar-core:0.8.0</span><span class="delimiter">'</span></span>
    implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:lib</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, the first level dependency on <code>quasar</code> makes us think that Gradle would resolve <code>quasar-core-0.8.0.jar</code> but it&#8217;s not the case: the build would fail with this message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Execution failed for task ':resolve'.
&gt; Could not resolve all files for configuration ':runtimeClasspath'.
   &gt; Could not find quasar-core-0.8.0-jdk8.jar (co.paralleluniverse:quasar-core:0.8.0).
     Searched in the following locations:
         https://repo1.maven.org/maven2/co/paralleluniverse/quasar-core/0.8.0/quasar-core-0.8.0-jdk8.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s because there&#8217;s a dependency on another project, <code>lib</code>, which itself depends on a different version of <code>quasar-core</code>:</p>
</div>
<div id="ex-a-classified-dependency" class="exampleblock">
<div class="title">Example 236. <a href="#ex-a-classified-dependency">A "classified" dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">lib/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;co.paralleluniverse:quasar-core:0.7.10:jdk8&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">lib/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">&quot;</span><span class="content">co.paralleluniverse:quasar-core:0.7.10:jdk8</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>What happens is that Gradle would perform conflict resolution between <code>quasar-core</code> 0.8.0 and <code>quasar-core</code> 0.7.10.
Because 0.8.0 is higher, we select this version, but the dependency in <code>lib</code> has a classifier, <code>jdk8</code> and this classifier <em>doesn&#8217;t exist anymore</em> in release 0.8.0.</p>
</div>
<div class="paragraph">
<p>To fix this problem, you can ask Gradle to resolve both dependencies <em>without classifier</em>:</p>
</div>
<div id="ex-a-resolution-rule-to-disable-selection-of-a-classifier" class="exampleblock">
<div class="title">Example 237. <a href="#ex-a-resolution-rule-to-disable-selection-of-a-classifier">A resolution rule to disable selection of a classifier</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute(module(&quot;co.paralleluniverse:quasar-core&quot;))
            .using(module(&quot;co.paralleluniverse:quasar-core:0.8.0&quot;))
            .withoutClassifier()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute module(<span class="string"><span class="delimiter">'</span><span class="content">co.paralleluniverse:quasar-core</span><span class="delimiter">'</span></span>) using module(<span class="string"><span class="delimiter">'</span><span class="content">co.paralleluniverse:quasar-core:0.8.0</span><span class="delimiter">'</span></span>) withoutClassifier()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This rule effectively replaces any dependency on <code>quasar-core</code> found in the graph with a dependency without classifier.</p>
</div>
<div class="paragraph">
<p>Alternatively, it&#8217;s possible to select a dependency <em>with</em> a specific classifier or, for more specific use cases, substitute with a very specific artifact (type, extension and classifier).</p>
</div>
<div class="paragraph">
<p>For more information, please refer to the following API documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>artifact selection via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/DependencySubstitutions.Substitution.html">Substitution DSL</a></p>
</li>
<li>
<p>artifact selection via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/DependencySubstitution.html#artifactSelection-org.gradle.api.Action-">DependencySubstitution API</a></p>
</li>
<li>
<p>artifact selection via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ResolutionStrategy.html#dependencySubstitution-org.gradle.api.Action-">ResolutionStrategy API</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:disabling_resolution_transitive_dependencies"><a class="anchor" href="#sec:disabling_resolution_transitive_dependencies"></a><a class="link" href="#sec:disabling_resolution_transitive_dependencies">Disabling transitive resolution</a></h4>
<div class="paragraph">
<p>By default Gradle resolves all transitive dependencies specified by the dependency metadata.
Sometimes this behavior may not be desirable e.g. if the metadata is incorrect or defines a large graph of transitive dependencies.
You can tell Gradle to disable transitive dependency management for a dependency by setting <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ModuleDependency.html#setTransitive-boolean-">ModuleDependency.setTransitive(boolean)</a> to <code>false</code>.
As a result only the main artifact will be resolved for the declared dependency.</p>
</div>
<div id="ex-disabling-transitive-dependency-resolution-for-a-declared-dependency" class="exampleblock">
<div class="title">Example 238. <a href="#ex-disabling-transitive-dependency-resolution-for-a-declared-dependency">Disabling transitive dependency resolution for a declared dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;com.google.guava:guava:23.0&quot;) {
        isTransitive = false
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:23.0</span><span class="delimiter">'</span></span>) {
        transitive = <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Disabling transitive dependency resolution will likely require you to declare the necessary runtime dependencies in your build script which otherwise would have been resolved automatically. Not doing so might lead to runtime classpath issues.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A project can decide to disable transitive dependency resolution completely.
You either don&#8217;t want to rely on the metadata published to the consumed repositories or you want to gain full control over the dependencies in your graph.
For more information, see <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/Configuration.html#setTransitive-boolean-">Configuration.setTransitive(boolean)</a>.</p>
</div>
<div id="ex-disabling-transitive-dependency-resolution-on-the-configuration-level" class="exampleblock">
<div class="title">Example 239. <a href="#ex-disabling-transitive-dependency-resolution-on-the-configuration-level">Disabling transitive dependency resolution on the configuration-level</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    isTransitive = false
}

dependencies {
    implementation(&quot;com.google.guava:guava:23.0&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    transitive = <span class="predefined-constant">false</span>
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:23.0</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changing_configuration_dependencies_prior_to_resolution"><a class="anchor" href="#changing_configuration_dependencies_prior_to_resolution"></a><a class="link" href="#changing_configuration_dependencies_prior_to_resolution">Changing configuration dependencies prior to resolution</a></h4>
<div class="paragraph">
<p>At times, a plugin may want to modify the dependencies of a configuration before it is resolved.
The <code>withDependencies</code> method permits dependencies to be added, removed or modified programmatically.</p>
</div>
<div id="ex-modifying-dependencies-on-a-configuration" class="exampleblock">
<div class="title">Example 240. <a href="#ex-modifying-dependencies-on-a-configuration">Modifying dependencies on a configuration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;implementation&quot;) {
        withDependencies {
            val dep = this.find { it.name == &quot;to-modify&quot; } as ExternalModuleDependency
            dep.version {
                strictly(&quot;1.2&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    implementation {
        withDependencies { DependencySet dependencies -&gt;
            ExternalModuleDependency dep = dependencies.find { <span class="local-variable">it</span>.name == <span class="string"><span class="delimiter">'</span><span class="content">to-modify</span><span class="delimiter">'</span></span> } <span class="keyword">as</span> ExternalModuleDependency
            dep.version {
                strictly <span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuration_defaults"><a class="anchor" href="#sec:configuration_defaults"></a><a class="link" href="#sec:configuration_defaults">Setting default configuration dependencies</a></h4>
<div class="paragraph">
<p>A configuration can be configured with default dependencies to be used if no dependencies are explicitly set for the configuration.
A primary use case of this functionality is for developing plugins that make use of versioned tools that the user might override.
By specifying default dependencies, the plugin can use a default version of the tool only if the user has not specified a particular version to use.</p>
</div>
<div id="ex-specifying-default-dependencies-on-a-configuration" class="exampleblock">
<div class="title">Example 241. <a href="#ex-specifying-default-dependencies-on-a-configuration">Specifying default dependencies on a configuration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;pluginTool&quot;) {
        defaultDependencies {
            add(project.dependencies.create(&quot;org.gradle:my-util:1.0&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    pluginTool {
        defaultDependencies { dependencies -&gt;
            dependencies.add(project.dependencies.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle:my-util:1.0</span><span class="delimiter">&quot;</span></span>))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="excluding_a_dependency_from_a_configuration_completely"><a class="anchor" href="#excluding_a_dependency_from_a_configuration_completely"></a><a class="link" href="#excluding_a_dependency_from_a_configuration_completely">Excluding a dependency from a configuration completely</a></h4>
<div class="paragraph">
<p>Similar to <a href="#sec:excluding-transitive-deps">excluding a dependency in a dependency declaration</a>, you can exclude a transitive dependency for a particular configuration completely by using <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.Configuration.html#org.gradle.api.artifacts.Configuration:exclude(java.util.Map)">Configuration.exclude(java.util.Map)</a>.
This will automatically exclude the transitive dependency for all dependencies declared on the configuration.</p>
</div>
<div id="ex-excluding-transitive-dependency-for-a-particular-configuration" class="exampleblock">
<div class="title">Example 242. <a href="#ex-excluding-transitive-dependency-for-a-particular-configuration">Excluding transitive dependency for a particular configuration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    &quot;implementation&quot; {
        exclude(group = &quot;commons-collections&quot;, module = &quot;commons-collections&quot;)
    }
}

dependencies {
    implementation(&quot;commons-beanutils:commons-beanutils:1.9.4&quot;)
    implementation(&quot;com.opencsv:opencsv:4.6&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    implementation {
        exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>
    }
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-beanutils:commons-beanutils:1.9.4</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.opencsv:opencsv:4.6</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="matching_dependencies_to_repositories"><a class="anchor" href="#matching_dependencies_to_repositories"></a><a class="link" href="#matching_dependencies_to_repositories">Matching dependencies to repositories</a></h4>
<div class="paragraph">
<p>Gradle exposes an API to declare what a repository may or may not contain.
This feature offers a fine grained control on which repository serve which artifacts, which can be one way of controlling the source of dependencies.</p>
</div>
<div class="paragraph">
<p>Head over to <a href="#sec:repository-content-filtering">the section on repository content filtering</a> to know more about this feature.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:ivy_dynamic_resolve_mode"><a class="anchor" href="#sec:ivy_dynamic_resolve_mode"></a><a class="link" href="#sec:ivy_dynamic_resolve_mode">Enabling Ivy dynamic resolve mode</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s Ivy repository implementations support the equivalent to Ivy&#8217;s dynamic resolve mode.
Normally, Gradle will use the <code>rev</code> attribute for each dependency definition included in an <code>ivy.xml</code> file.
In dynamic resolve mode, Gradle will instead prefer the <code>revConstraint</code> attribute over the <code>rev</code> attribute for a given dependency definition.
If the <code>revConstraint</code> attribute is not present, the <code>rev</code> attribute is used instead.</p>
</div>
<div class="paragraph">
<p>To enable dynamic resolve mode, you need to set the appropriate option on the repository definition.
A couple of examples are shown below.
Note that dynamic resolve mode is only available for Gradle&#8217;s Ivy repositories.
It is not available for Maven repositories, or custom Ivy <code>DependencyResolver</code> implementations.</p>
</div>
<div id="ex-enabling-dynamic-resolve-mode" class="exampleblock">
<div class="title">Example 243. <a href="#ex-enabling-dynamic-resolve-mode">Enabling dynamic resolve mode</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Can enable dynamic resolve mode when you define the repository
repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        resolve.isDynamicMode = true
    }
}

// Can use a rule instead to enable (or disable) dynamic resolve mode for all repositories
repositories.withType&lt;IvyArtifactRepository&gt; {
    resolve.isDynamicMode = true
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Can enable dynamic resolve mode when you define the repository</span>
repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        resolve.dynamicMode = <span class="predefined-constant">true</span>
    }
}

<span class="comment">// Can use a rule instead to enable (or disable) dynamic resolve mode for all repositories</span>
repositories.withType(IvyArtifactRepository) {
    resolve.dynamicMode = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="resolution-strategy-safety-nets"><a class="anchor" href="#resolution-strategy-safety-nets"></a><a class="link" href="#resolution-strategy-safety-nets">Preventing accidental dependency upgrades</a></h3>
<div class="paragraph">
<p>In some situations, you might want to be in total control of the dependency graph.
In particular, you may want to make sure that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the versions declared in a build script actually correspond to the ones being resolved</p>
</li>
<li>
<p>or make sure that dependency resolution is reproducible over time</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle provides ways to perform this by configuring the resolution strategy.</p>
</div>
<div class="sect3">
<h4 id="fail-version-conflict"><a class="anchor" href="#fail-version-conflict"></a><a class="link" href="#fail-version-conflict">Failing on version conflict</a></h4>
<div class="paragraph">
<p>There&#8217;s a version conflict whenever Gradle finds the same module in two different versions in a dependency graph.
By default, Gradle performs <em>optimistic upgrades</em>, meaning that if version <code>1.1</code> and <code>1.3</code> are found in the graph, we resolve to the highest version, <code>1.3</code>.
However, it is easy to miss that some dependencies are upgraded because of a transitive dependency.
In the example above, if <code>1.1</code> was a version used in your build script and <code>1.3</code> a version brought transitively, you could use <code>1.3</code> without actually noticing.</p>
</div>
<div class="paragraph">
<p>To make sure that you are aware of such upgrades, Gradle provides a mode that can be activated in the resolution strategy of a configuration.
Imagine the following dependencies declaration:</p>
</div>
<div id="ex-direct-dependency-version-not-matching-a-transitive-version" class="exampleblock">
<div class="title">Example 244. <a href="#ex-direct-dependency-version-not-matching-a-transitive-version">Direct dependency version not matching a transitive version</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.apache.commons:commons-lang3:3.0&quot;)
    // the following dependency brings lang3 3.8.1 transitively
    implementation(&quot;com.opencsv:opencsv:4.6&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-lang3:3.0</span><span class="delimiter">'</span></span>
    <span class="comment">// the following dependency brings lang3 3.8.1 transitively</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.opencsv:opencsv:4.6</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then by default Gradle would upgrade <code>commons-lang3</code>, but it is possible to <em>fail</em> the build:</p>
</div>
<div id="ex-fail-on-version-conflict" class="exampleblock">
<div class="title">Example 245. <a href="#ex-fail-on-version-conflict">Fail on version conflict</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy {
        failOnVersionConflict()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy {
        failOnVersionConflict()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reproducible-resolution"><a class="anchor" href="#reproducible-resolution"></a><a class="link" href="#reproducible-resolution">Making sure resolution is reproducible</a></h4>
<div class="paragraph">
<p>There are cases where dependency resolution can be <em>unstable</em> over time.
That is to say that if you build at date D, building at date D+x may give a different resolution result.</p>
</div>
<div class="paragraph">
<p>This is possible in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dynamic dependency versions are used (version ranges, <code>latest.release</code>, <code>1.+</code>, &#8230;&#8203;)</p>
</li>
<li>
<p>or <em>changing</em> versions are used (SNAPSHOTs, fixed version with changing contents, &#8230;&#8203;)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The recommended way to deal with dynamic versions is to use <a href="#dependency-locking">dependency locking</a>.
However, it is possible to prevent the use of dynamic versions altogether, which is an alternate strategy:</p>
</div>
<div id="ex-failing-on-dynamic-versions" class="exampleblock">
<div class="title">Example 246. <a href="#ex-failing-on-dynamic-versions">Failing on dynamic versions</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy {
        failOnDynamicVersions()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy {
        failOnDynamicVersions()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Likewise, it&#8217;s possible to prevent the use of changing versions by activating this flag:</p>
</div>
<div id="ex-failing-on-changing-versions" class="exampleblock">
<div class="title">Example 247. <a href="#ex-failing-on-changing-versions">Failing on changing versions</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy {
        failOnChangingVersions()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy {
        failOnChangingVersions()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s a good practice to fail on changing versions at release time.</p>
</div>
<div class="paragraph">
<p>Eventually, it&#8217;s possible to combine both failing on dynamic versions and changing versions using a single call:</p>
</div>
<div id="ex-failing-on-non-reproducible-resolution" class="exampleblock">
<div class="title">Example 248. <a href="#ex-failing-on-non-reproducible-resolution">Failing on non-reproducible resolution</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy {
        failOnNonReproducibleResolution()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy {
        failOnNonReproducibleResolution()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resolution_consistency"><a class="anchor" href="#resolution_consistency"></a><a class="link" href="#resolution_consistency">Getting consistent dependency resolution results</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Dependency resolution consistency is an incubating feature
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s a common misconception that there&#8217;s a single dependency graph for an application.
In fact Gradle will, during a build, resolve a number of distinct dependency graphs, even within a single project.
For example, the graph of dependencies to use at compile time is different from the graph of dependencies to use at runtime.
In general, the graph of dependencies at runtime is a superset of the compile dependencies (there are exceptions to the rule, for example in case some dependencies are repackaged within the runtime binary).</p>
</div>
<div class="paragraph">
<p>Gradle resolves those dependency graphs independently.
This means, in the Java ecosystem for example, that the resolution of the "compile classpath" doesn&#8217;t influence the resolution of the "runtime classpath".
Similarly, test dependencies could end up bumping the version of production dependencies, causing some surprising results when executing tests.</p>
</div>
<div class="paragraph">
<p>These surprising behaviors can be mitigated by enabling dependency resolution consistency.</p>
</div>
<div class="sect4">
<h5 id="sec::project_dependency_resolution_consistency"><a class="anchor" href="#sec::project_dependency_resolution_consistency"></a><a class="link" href="#sec::project_dependency_resolution_consistency">Enabling project-local dependency resolution consistency</a></h5>
<div class="paragraph">
<p>For example, imagine that your Java library depends on the following libraries:</p>
</div>
<div id="ex-first-level-dependencies" class="exampleblock">
<div class="title">Example 249. <a href="#ex-first-level-dependencies">First-level dependencies</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.codehaus.groovy:groovy:3.0.1&quot;)
    runtimeOnly(&quot;io.vertx:vertx-lang-groovy:3.9.4&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy:3.0.1</span><span class="delimiter">'</span></span>
    runtimeOnly <span class="string"><span class="delimiter">'</span><span class="content">io.vertx:vertx-lang-groovy:3.9.4</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then resolving the <code>compileClasspath</code> configuration would resolve the <code>groovy</code> library to version <code>3.0.1</code> as expected.
However, resolving the <code>runtimeClasspath</code> configuration would instead return <code>groovy 3.0.2</code>.</p>
</div>
<div class="paragraph">
<p>The reason for this is that a transitive dependency of <code>vertx</code>, which is a <code>runtimeOnly</code> dependency, brings a higher version of <code>groovy</code>.
In general, this isn&#8217;t a problem, but it also means that the version of the Groovy library that you are going to use at runtime is going to be different from the one that you used for compilation.</p>
</div>
<div class="paragraph">
<p>In order to avoid this situation, Gradle offers an API to explain that configurations should be resolved consistently.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:configuration_consistency"><a class="anchor" href="#sec:configuration_consistency"></a><a class="link" href="#sec:configuration_consistency">Declaring resolution consistency between configurations</a></h5>
<div class="paragraph">
<p>In the example above, we can declare that we want, at runtime, the same versions of the common dependencies as compile time, by declaring that the "runtime classpath" <em>should be consistent with</em> the "compile classpath":</p>
</div>
<div id="ex-declaring-consistency-between-configurations" class="exampleblock">
<div class="title">Example 250. <a href="#ex-declaring-consistency-between-configurations">Declaring consistency between configurations</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    runtimeClasspath.get().shouldResolveConsistentlyWith(compileClasspath.get())
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    runtimeClasspath.shouldResolveConsistentlyWith(compileClasspath)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As a result, both the <code>runtimeClasspath</code> and <code>compileClasspath</code> will resolve Groovy 3.0.1.</p>
</div>
<div class="paragraph">
<p>The relationship is <em>directed</em>, which means that if the <code>runtimeClasspath</code> configuration has to be resolved, Gradle will <em>first</em> resolve the <code>compileClasspath</code> and then "inject" the result of resolution as <a href="#sec:strict-version">strict constraints</a> into the <code>runtimeClasspath</code>.</p>
</div>
<div class="paragraph">
<p>If, for some reason, the versions of the two graphs cannot be "aligned", then resolution will fail with a call to action.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:java_consistency"><a class="anchor" href="#sec:java_consistency"></a><a class="link" href="#sec:java_consistency">Declaring consistent resolution in the Java ecosystem</a></h5>
<div class="paragraph">
<p>The <code>runtimeClasspath</code> and <code>compileClasspath</code> example above are common in the Java ecosystem.
However, it&#8217;s often not enough to declare consistency between those two configurations only.
For example, you most likely want the <em>test runtime classpath</em> to be consistent with the
<em>runtime classpath</em>.</p>
</div>
<div class="paragraph">
<p>To make this easier, Gradle provides a way to configure consistent resolution for the Java ecosystem using the <code>java</code> extension:</p>
</div>
<div id="ex-declaring-consistency-in-the-java-ecosystem" class="exampleblock">
<div class="title">Example 251. <a href="#ex-declaring-consistency-in-the-java-ecosystem">Declaring consistency in the Java ecosystem</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    consistentResolution {
        useCompileClasspathVersions()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    consistentResolution {
        useCompileClasspathVersions()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Please refer to the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/plugins/JavaPluginExtension.html">Java Plugin Extension docs</a> for more configuration options.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="producing_and_consuming_variants_of_libraries"><a class="anchor" href="#producing_and_consuming_variants_of_libraries"></a><a class="link" href="#producing_and_consuming_variants_of_libraries">PRODUCING AND CONSUMING VARIANTS OF LIBRARIES</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="declaring-component-capabilities"><a class="anchor" href="#declaring-component-capabilities"></a><a class="link" href="#declaring-component-capabilities">Declaring Capabilities of a Library</a></h3>
<div class="sect3">
<h4 id="capabilities_as_first_level_concept"><a class="anchor" href="#capabilities_as_first_level_concept"></a><a class="link" href="#capabilities_as_first_level_concept">Capabilities as first-level concept</a></h4>
<div class="paragraph">
<p>Components provide a number of features which are often orthogonal to the software architecture used to provide those features.
For example, a library may include several features in a single artifact.
However, such a library would be published at single GAV (group, artifact and version) coordinates.
This means that, at single coordinates, potentially co-exist different "features" of a component.</p>
</div>
<div class="paragraph">
<p>With Gradle it becomes interesting to explicitly declare what features a component provides.
For this, Gradle provides the concept of <a href="#sec:adding-constraints-transitive-deps">capability</a>.</p>
</div>
<div class="paragraph">
<p>A feature is often built by combining different <em>capabilities</em>.</p>
</div>
<div class="paragraph">
<p>In an ideal world, components shouldn&#8217;t declare dependencies on explicit GAVs, but rather express their requirements in terms of capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"give me a component which provides logging"</p>
</li>
<li>
<p>"give me a scripting engine"</p>
</li>
<li>
<p>"give me a scripting engine that supports Groovy"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By modeling <em>capabilities</em>, the dependency management engine can be smarter and tell you whenever you have <em>incompatible capabilities</em> in a dependency graph, or ask you to choose whenever different modules in a graph provide the same <em>capability</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:declaring-capabilities-external-modules"><a class="anchor" href="#sec:declaring-capabilities-external-modules"></a><a class="link" href="#sec:declaring-capabilities-external-modules">Declaring capabilities for external modules</a></h4>
<div class="paragraph">
<p>It&#8217;s worth noting that Gradle supports declaring capabilities for components you build, but also for external components in case they didn&#8217;t.</p>
</div>
<div class="paragraph">
<p>For example, if your build file contains the following dependencies:</p>
</div>
<div id="ex-a-build-file-with-an-implicit-conflict-of-logging-frameworks" class="exampleblock">
<div class="title">Example 252. <a href="#ex-a-build-file-with-an-implicit-conflict-of-logging-frameworks">A build file with an implicit conflict of logging frameworks</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // This dependency will bring log4:log4j transitively
    implementation(&quot;org.apache.zookeeper:zookeeper:3.4.9&quot;)

    // We use log4j over slf4j
    implementation(&quot;org.slf4j:log4j-over-slf4j:1.7.10&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// This dependency will bring log4:log4j transitively</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.zookeeper:zookeeper:3.4.9</span><span class="delimiter">'</span></span>

    <span class="comment">// We use log4j over slf4j</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:log4j-over-slf4j:1.7.10</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As is, it&#8217;s pretty hard to figure out that you will end up with two logging frameworks on the classpath.
In fact, <code>zookeeper</code> will bring in <code>log4j</code>, where what we want to use is <code>log4j-over-slf4j</code>.
We can preemptively detect the conflict by adding a rule which will declare that both logging frameworks provide the same capability:</p>
</div>
<div id="ex-a-build-file-with-an-implicit-conflict-of-logging-frameworks" class="exampleblock">
<div class="title">Example 253. <a href="#ex-a-build-file-with-an-implicit-conflict-of-logging-frameworks">A build file with an implicit conflict of logging frameworks</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // Activate the &quot;LoggingCapability&quot; rule
    components.all(LoggingCapability::class.java)
}

class LoggingCapability : ComponentMetadataRule {
    val loggingModules = setOf(&quot;log4j&quot;, &quot;log4j-over-slf4j&quot;)

    override
    fun execute(context: ComponentMetadataContext) = context.details.run {
        if (loggingModules.contains(id.name)) {
            allVariants {
                withCapabilities {
                    // Declare that both log4j and log4j-over-slf4j provide the same capability
                    addCapability(&quot;log4j&quot;, &quot;log4j&quot;, id.version)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// Activate the &quot;LoggingCapability&quot; rule</span>
    components.all(LoggingCapability)
}

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">LoggingCapability</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="directive">final</span> <span class="directive">static</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; LOGGING_MODULES = [<span class="string"><span class="delimiter">&quot;</span><span class="content">log4j</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">log4j-over-slf4j</span><span class="delimiter">&quot;</span></span>] <span class="keyword">as</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt;

    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.with {
            <span class="keyword">if</span> (LOGGING_MODULES.contains(id.name)) {
                allVariants {
                    <span class="local-variable">it</span>.withCapabilities {
                        <span class="comment">// Declare that both log4j and log4j-over-slf4j provide the same capability</span>
                        <span class="local-variable">it</span>.addCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">log4j</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">log4j</span><span class="delimiter">&quot;</span></span>, id.version)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By adding this rule, we will make sure that Gradle <em>will</em> detect conflicts and properly fail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Could not resolve all files for configuration ':compileClasspath'.
   &gt; Could not resolve org.slf4j:log4j-over-slf4j:1.7.10.
     Required by:
         project :
      &gt; Module 'org.slf4j:log4j-over-slf4j' has been rejected:
           Cannot select module with conflict on capability 'log4j:log4j:1.7.10' also provided by [log4j:log4j:1.2.16(compile)]
   &gt; Could not resolve log4j:log4j:1.2.16.
     Required by:
         project : &gt; org.apache.zookeeper:zookeeper:3.4.9
      &gt; Module 'log4j:log4j' has been rejected:
           Cannot select module with conflict on capability 'log4j:log4j:1.2.16' also provided by [org.slf4j:log4j-over-slf4j:1.7.10(compile)]</pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="#sub:selecting-between-candidates">capabilities section of the documentation</a> to figure out how to fix capability conflicts.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:declaring-additional-capabilities-for-a-local-component"><a class="anchor" href="#sec:declaring-additional-capabilities-for-a-local-component"></a><a class="link" href="#sec:declaring-additional-capabilities-for-a-local-component">Declaring additional capabilities for a local component</a></h4>
<div class="paragraph">
<p>All components have an <em>implicit capability</em> corresponding to the same GAV coordinates as the component.
However, it is also possible to declare additional <em>explicit capabilities</em> for a component.
This is convenient whenever a library published at different GAV coordinates is an <em>alternate implementation</em> of the same API:</p>
</div>
<div id="ex-declaring-capabilities-of-a-component" class="exampleblock">
<div class="title">Example 254. <a href="#ex-declaring-capabilities-of-a-component">Declaring capabilities of a component</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    apiElements {
        outgoing {
            capability(&quot;com.acme:my-library:1.0&quot;)
            capability(&quot;com.other:module:1.1&quot;)
        }
    }
    runtimeElements {
        outgoing {
            capability(&quot;com.acme:my-library:1.0&quot;)
            capability(&quot;com.other:module:1.1&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    apiElements {
        outgoing {
            capability(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme:my-library:1.0</span><span class="delimiter">&quot;</span></span>)
            capability(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.other:module:1.1</span><span class="delimiter">&quot;</span></span>)
        }
    }
    runtimeElements {
        outgoing {
            capability(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme:my-library:1.0</span><span class="delimiter">&quot;</span></span>)
            capability(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.other:module:1.1</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Capabilities must be attached to <em>outgoing configurations</em>, which are <a href="#sec:resolvable-consumable-configs">consumable configurations</a> of a component.</p>
</div>
<div class="paragraph">
<p>This example shows that we declare two capabilities:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>com.acme:my-library:1.0</code>, which corresponds to the <em>implicit capability</em> of the library</p>
</li>
<li>
<p><code>com.other:module:1.1</code>, which corresponds to another capability of this library</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It&#8217;s worth noting we need to do 1. because as soon as you start declaring <em>explicit</em> capabilities, then <em>all</em> capabilities need to be declared, including the <em>implicit</em> one.</p>
</div>
<div class="paragraph">
<p>The second capability can be specific to this library, or it can correspond to a capability provided by an external component.
In that case, if <code>com.other:module</code> appears in the same dependency graph, the build will fail and consumers <a href="#sub:selecting-between-candidates">will have to choose what module to use</a>.</p>
</div>
<div class="paragraph">
<p>Capabilities are published to Gradle Module Metadata.
However, they have <em>no equivalent</em> in POM or Ivy metadata files.
As a consequence, when publishing such a component, Gradle will warn you that this feature is only for Gradle consumers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Maven publication 'maven' contains dependencies that cannot be represented in a published pom file.
  - Declares capability com.acme:my-library:1.0
  - Declares capability com.other:module:1.1</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="feature_variants"><a class="anchor" href="#feature_variants"></a><a class="link" href="#feature_variants">Modeling library features</a></h3>
<div class="paragraph">
<p>Gradle supports the concept of <em>features</em>: it&#8217;s often the case that a single library can be split up into multiple related yet distinct libraries, where each <em>feature</em> can be used alongside the <em>main</em> library.</p>
</div>
<div class="paragraph">
<p>Features allow a component to expose multiple related libraries, each of which can declare its own dependencies.
These libraries are exposed as variants, similar to how the <em>main</em> library exposes variants for its API and runtime.</p>
</div>
<div class="paragraph">
<p>This allows for a number of different scenarios (list is non-exhaustive):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a (better) substitute for <a href="https://maven.apache.org/guides/introduction/introduction-to-optional-and-excludes-dependencies.html">Maven optional dependencies</a></p>
</li>
<li>
<p>a <em>main</em> library is built with support for different mutually-exclusive implementations of runtime features; the <a href="#sec::incompatible_variants">user must choose one, and only one, implementation of each such feature</a></p>
</li>
<li>
<p>a <em>main</em> library is built with support for optional runtime features, each of which requires a different set of dependencies</p>
</li>
<li>
<p>a <em>main</em> library comes with supplementary features like <em>test fixtures</em></p>
</li>
<li>
<p>a <em>main</em> library comes with a main artifact, and enabling an additional feature requires additional artifacts</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="sec::feature_variant_selection"><a class="anchor" href="#sec::feature_variant_selection"></a><a class="link" href="#sec::feature_variant_selection">Selection of features via capabilities</a></h4>
<div class="paragraph">
<p>Declaring a dependency on a component is usually done by providing a set of coordinates (group, artifact, version also known as GAV coordinates).
This allows the engine to determine the <em>component</em> we&#8217;re looking for, but such a component may provide different <em>variants</em>.
A <em>variant</em> is typically chosen based on the usage. For example, we might choose a different variant for compiling against a component (in which case we need the API of the component) or when executing code (in which case we need the runtime of the component).
All variants of a component provide a number of <a href="#sub:capabilities">capabilities</a>, which are denoted similarly using GAV coordinates.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>A capability is denoted by GAV coordinates, but you must think of it as feature description:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"I provide an SLF4J binding"</p>
</li>
<li>
<p>"I provide runtime support for MySQL"</p>
</li>
<li>
<p>"I provide a Groovy runtime"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And in general, having two components that provide the <em>same thing</em> in the graph is a problem (they conflict).</p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is an important concept because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By default, a variant provides a capability corresponding to the GAV coordinates of its component</p>
</li>
<li>
<p>No two variants in a dependency graph can provide the same capability</p>
</li>
<li>
<p>Multiple variants of a single component may be selected as long as they provide <em>different capabilities</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A typical component will <strong>only</strong> provide variants with the default capability.
A Java library, for example, exposes two variants (API and runtime) which provide the <em>same capability</em>.
As a consequence, it is an error to have both the <em>API</em> and <em>runtime</em> of a single component in a dependency graph.</p>
</div>
<div class="paragraph">
<p>However, imagine that you need the <em>runtime</em> and the <em>test fixtures runtime</em> of a component.
Then it is allowed as long as the <em>runtime</em> and <em>test fixtures runtime</em> variant of the library declare different capabilities.</p>
</div>
<div class="paragraph">
<p>If we do so, a consumer would then have to declare two dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one on the "main" feature, the library</p>
</li>
<li>
<p>one on the "test fixtures" feature, by <em>requiring its capability</em></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
While the resolution engine supports multi-variant components independently of the ecosystem, <em>features</em> are currently only available using the Java plugins.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec::declare_feature_variants"><a class="anchor" href="#sec::declare_feature_variants"></a><a class="link" href="#sec::declare_feature_variants">Registering features</a></h4>
<div class="paragraph">
<p>Features can be declared by applying the <code>java-library</code> plugin.
The following code illustrates how to declare a feature named <code>mongodbSupport</code>:</p>
</div>
<div id="ex-registering-a-feature" class="exampleblock">
<div class="title">Example 255. <a href="#ex-registering-a-feature">Registering a feature</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    create(&quot;mongodbSupport&quot;) {
        java {
            srcDir(&quot;src/mongodb/java&quot;)
        }
    }
}

java {
    registerFeature(&quot;mongodbSupport&quot;) {
        usingSourceSet(sourceSets[&quot;mongodbSupport&quot;])
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    mongodbSupport {
        java {
            srcDir <span class="string"><span class="delimiter">'</span><span class="content">src/mongodb/java</span><span class="delimiter">'</span></span>
        }
    }
}

java {
    registerFeature(<span class="string"><span class="delimiter">'</span><span class="content">mongodbSupport</span><span class="delimiter">'</span></span>) {
        usingSourceSet(sourceSets.mongodbSupport)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle will automatically set up a number of things for you, in a very similar way to how the <a href="#java_library_plugin">Java Library Plugin</a> sets up configurations.</p>
</div>
<div class="paragraph">
<p>Dependency scope configurations are created in the same manner as for the main feature:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the configuration <code>mongodbSupportApi</code>, used to <em>declare API dependencies</em> for this feature</p>
</li>
<li>
<p>the configuration <code>mongodbSupportImplementation</code>, used to <em>declare implementation dependencies</em> for this feature</p>
</li>
<li>
<p>the configuration <code>mongodbSupportRuntimeOnly</code>, used to <em>declare runtime-only dependencies</em> for this feature</p>
</li>
<li>
<p>the configuration <code>mongodbSupportCompileOnly</code>, used to <em>declare compile-only dependencies</em> for this feature</p>
</li>
<li>
<p>the configuration <code>mongodbSupportCompileOnlyApi</code>, used to <em>declare compile-only API dependencies</em> for this feature</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Furthermore, consumable configurations are created in the same manner as for the main feature:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the configuration <code>mongodbSupportApiElements</code>, used by consumers to fetch the artifacts and API dependencies of this feature</p>
</li>
<li>
<p>the configuration <code>mongodbSupportRuntimeElements</code>, used by consumers to fetch the artifacts and runtime dependencies of this feature</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A feature should have a <em>source set</em> with the same name.
Gradle will create a <code>Jar</code> task to bundle the classes built from the feature source set, using a classifier corresponding to the kebab-case name of the feature.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Do not use the <em>main</em> source set when registering a feature. This behavior will be deprecated in a future version of Gradle.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Most users will only need to care about the dependency scope configurations, to declare the specific dependencies of this feature:</p>
</div>
<div id="ex-declaring-dependencies-of-a-feature" class="exampleblock">
<div class="title">Example 256. <a href="#ex-declaring-dependencies-of-a-feature">Declaring dependencies of a feature</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    &quot;mongodbSupportImplementation&quot;(&quot;org.mongodb:mongodb-driver-sync:3.9.1&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    mongodbSupportImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.mongodb:mongodb-driver-sync:3.9.1</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>By convention, Gradle maps the feature name to a capability whose group and version are the same as the group and version of the main component, respectively, but whose name is the main component name followed by a <code>-</code> followed by the kebab-cased feature name.</p>
</div>
<div class="paragraph">
<p>For example, if the component&#8217;s group is <code>org.gradle.demo</code>, its name is <code>provider</code>, its version is <code>1.0</code>, and the feature is named <code>mongodbSupport</code>, the feature&#8217;s variants will have the <code>org.gradle.demo:provider-mongodb-support:1.0</code> capability.</p>
</div>
<div class="paragraph">
<p>If you choose the capability name yourself or add more capabilities to a variant, it is recommended to follow the same convention.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec::publishing_feature_variants"><a class="anchor" href="#sec::publishing_feature_variants"></a><a class="link" href="#sec::publishing_feature_variants">Publishing features</a></h4>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Depending on the metadata file format, publishing features may be lossy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>using <a href="https://github.com/gradle/gradle/blob/master/subprojects/docs/src/docs/design/gradle-module-metadata-latest-specification.md">Gradle Module Metadata</a>, everything is published and consumers will get the full benefit of features</p>
</li>
<li>
<p>using POM metadata (Maven), features are published as <strong>optional dependencies</strong> and artifacts of features are published with different <em>classifiers</em></p>
</li>
<li>
<p>using Ivy metadata, features are published as extra configurations, which are <em>not</em> extended by the <code>default</code> configuration</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Publishing features is supported using the <code>maven-publish</code> and <code>ivy-publish</code> plugins only.
The Java Library Plugin will take care of registering the additional variants for you, so there&#8217;s no additional configuration required, only the regular publications:</p>
</div>
<div id="ex-publishing-a-component-with-features" class="exampleblock">
<div class="title">Example 257. <a href="#ex-publishing-a-component-with-features">Publishing a component with features</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
    `maven-publish`
}
// ...
publishing {
    publications {
        create(&quot;myLibrary&quot;, MavenPublication::class.java) {
            from(components[&quot;java&quot;])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
}
<span class="comment">// ...</span>
publishing {
    publications {
        myLibrary(MavenPublication) {
            from components.java
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:javadoc_sources_features_variants"><a class="anchor" href="#sub:javadoc_sources_features_variants"></a><a class="link" href="#sub:javadoc_sources_features_variants">Adding javadoc and sources JARs</a></h5>
<div class="paragraph">
<p>Similar to the <a href="#sec:java_packaging">main Javadoc and sources JARs</a>, you can configure the added feature so that it produces JARs for the Javadoc and sources.</p>
</div>
<div id="ex-producing-javadoc-and-sources-jars-for-features" class="exampleblock">
<div class="title">Example 258. <a href="#ex-producing-javadoc-and-sources-jars-for-features">Producing javadoc and sources JARs for features</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    registerFeature(&quot;mongodbSupport&quot;) {
        usingSourceSet(sourceSets[&quot;mongodbSupport&quot;])
        withJavadocJar()
        withSourcesJar()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    registerFeature(<span class="string"><span class="delimiter">'</span><span class="content">mongodbSupport</span><span class="delimiter">'</span></span>) {
        usingSourceSet(sourceSets.mongodbSupport)
        withJavadocJar()
        withSourcesJar()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec::consuming_feature_variants"><a class="anchor" href="#sec::consuming_feature_variants"></a><a class="link" href="#sec::consuming_feature_variants">Dependencies on features</a></h4>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>As mentioned earlier, features can be lossy when published.
As a consequence, a consumer can depend on a feature only in these cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>with a project dependency (in a multi-project build)</p>
</li>
<li>
<p>with Gradle Module Metadata available, that is the publisher MUST have published it</p>
</li>
<li>
<p>within the Ivy world, by declaring a dependency on the configuration matching the feature</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>A consumer can specify that it needs a specific feature of a producer by declaring required capabilities.
For example, if a producer declares a "MySQL support" feature like this:</p>
</div>
<div id="ex-a-library-declaring-a-feature-to-support-mysql" class="exampleblock">
<div class="title">Example 259. <a href="#ex-a-library-declaring-a-feature-to-support-mysql">A library declaring a feature to support MySQL</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">group = &quot;org.gradle.demo&quot;

sourceSets {
    create(&quot;mysqlSupport&quot;) {
        java {
            srcDir(&quot;src/mysql/java&quot;)
        }
    }
}

java {
    registerFeature(&quot;mysqlSupport&quot;) {
        usingSourceSet(sourceSets[&quot;mysqlSupport&quot;])
    }
}

dependencies {
    &quot;mysqlSupportImplementation&quot;(&quot;mysql:mysql-connector-java:8.0.14&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">group = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>

sourceSets {
    mysqlSupport {
        java {
            srcDir <span class="string"><span class="delimiter">'</span><span class="content">src/mysql/java</span><span class="delimiter">'</span></span>
        }
    }
}

java {
    registerFeature(<span class="string"><span class="delimiter">'</span><span class="content">mysqlSupport</span><span class="delimiter">'</span></span>) {
        usingSourceSet(sourceSets.mysqlSupport)
    }
}

dependencies {
    mysqlSupportImplementation <span class="string"><span class="delimiter">'</span><span class="content">mysql:mysql-connector-java:8.0.14</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then the consumer can declare a dependency on the MySQL support feature by doing this:</p>
</div>
<div id="ex-consuming-specific-features-in-a-multi-project-build" class="exampleblock">
<div class="title">Example 260. <a href="#ex-consuming-specific-features-in-a-multi-project-build">Consuming specific features in a multi-project build</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // This project requires the main producer component
    implementation(project(&quot;:producer&quot;))

    // But we also want to use its MySQL support
    runtimeOnly(project(&quot;:producer&quot;)) {
        capabilities {
            requireCapability(&quot;org.gradle.demo:producer-mysql-support&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// This project requires the main producer component</span>
    implementation(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:producer</span><span class="delimiter">&quot;</span></span>))

    <span class="comment">// But we also want to use its MySQL support</span>
    runtimeOnly(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:producer</span><span class="delimiter">&quot;</span></span>)) {
        capabilities {
            requireCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.demo:producer-mysql-support</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will automatically bring the <code>mysql-connector-java</code> dependency on the runtime classpath.
If there were more than one dependency, all of them would be brought, meaning that a feature can be used to group dependencies which contribute to a feature together.</p>
</div>
<div class="paragraph">
<p>Similarly, if an external library with features was published with <a href="https://github.com/gradle/gradle/blob/master/subprojects/docs/src/docs/design/gradle-module-metadata-latest-specification.md">Gradle Module Metadata</a>, it is possible to depend on a feature provided by that library:</p>
</div>
<div id="ex-consuming-specific-features-from-an-external-repository" class="exampleblock">
<div class="title">Example 261. <a href="#ex-consuming-specific-features-from-an-external-repository">Consuming specific features from an external repository</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // This project requires the main producer component
    implementation(&quot;org.gradle.demo:producer:1.0&quot;)

    // But we also want to use its MongoDB support
    runtimeOnly(&quot;org.gradle.demo:producer:1.0&quot;) {
        capabilities {
            requireCapability(&quot;org.gradle.demo:producer-mongodb-support&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// This project requires the main producer component</span>
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo:producer:1.0</span><span class="delimiter">'</span></span>)

    <span class="comment">// But we also want to use its MongoDB support</span>
    runtimeOnly(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo:producer:1.0</span><span class="delimiter">'</span></span>) {
        capabilities {
            requireCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.demo:producer-mongodb-support</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec::incompatible_variants"><a class="anchor" href="#sec::incompatible_variants"></a><a class="link" href="#sec::incompatible_variants">Handling mutually exclusive variants</a></h4>
<div class="paragraph">
<p>The main advantage of using <em>capabilities</em> as a way to handle features is that you can precisely handle compatibility of variants.
The rule is simple:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>No two variants in a dependency graph can provide the same capability</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>We can leverage this to ensure that Gradle fails whenever the user mis-configures dependencies.
Consider a situation where your library supports MySQL, Postgres and MongoDB, but that it&#8217;s only allowed to choose <em>one</em> of those at the same time.
We can model this restriction by ensuring each feature also provides the same capability, thus making it impossible for these features to be used together in the same graph.</p>
</div>
<div id="ex-a-producer-of-multiple-features-that-are-mutually-exclusive" class="exampleblock">
<div class="title">Example 262. <a href="#ex-a-producer-of-multiple-features-that-are-mutually-exclusive">A producer of multiple features that are mutually exclusive</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    registerFeature(&quot;mysqlSupport&quot;) {
        usingSourceSet(sourceSets[&quot;mysqlSupport&quot;])
        capability(&quot;org.gradle.demo&quot;, &quot;producer-db-support&quot;, &quot;1.0&quot;)
        capability(&quot;org.gradle.demo&quot;, &quot;producer-mysql-support&quot;, &quot;1.0&quot;)
    }
    registerFeature(&quot;postgresSupport&quot;) {
        usingSourceSet(sourceSets[&quot;postgresSupport&quot;])
        capability(&quot;org.gradle.demo&quot;, &quot;producer-db-support&quot;, &quot;1.0&quot;)
        capability(&quot;org.gradle.demo&quot;, &quot;producer-postgres-support&quot;, &quot;1.0&quot;)
    }
    registerFeature(&quot;mongoSupport&quot;) {
        usingSourceSet(sourceSets[&quot;mongoSupport&quot;])
        capability(&quot;org.gradle.demo&quot;, &quot;producer-db-support&quot;, &quot;1.0&quot;)
        capability(&quot;org.gradle.demo&quot;, &quot;producer-mongo-support&quot;, &quot;1.0&quot;)
    }
}

dependencies {
    &quot;mysqlSupportImplementation&quot;(&quot;mysql:mysql-connector-java:8.0.14&quot;)
    &quot;postgresSupportImplementation&quot;(&quot;org.postgresql:postgresql:42.2.5&quot;)
    &quot;mongoSupportImplementation&quot;(&quot;org.mongodb:mongodb-driver-sync:3.9.1&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    registerFeature(<span class="string"><span class="delimiter">'</span><span class="content">mysqlSupport</span><span class="delimiter">'</span></span>) {
        usingSourceSet(sourceSets.mysqlSupport)
        capability(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">producer-db-support</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>)
        capability(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">producer-mysql-support</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>)
    }
    registerFeature(<span class="string"><span class="delimiter">'</span><span class="content">postgresSupport</span><span class="delimiter">'</span></span>) {
        usingSourceSet(sourceSets.postgresSupport)
        capability(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">producer-db-support</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>)
        capability(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">producer-postgres-support</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>)
    }
    registerFeature(<span class="string"><span class="delimiter">'</span><span class="content">mongoSupport</span><span class="delimiter">'</span></span>) {
        usingSourceSet(sourceSets.mongoSupport)
        capability(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">producer-db-support</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>)
        capability(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">producer-mongo-support</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>)
    }
}

dependencies {
    mysqlSupportImplementation <span class="string"><span class="delimiter">'</span><span class="content">mysql:mysql-connector-java:8.0.14</span><span class="delimiter">'</span></span>
    postgresSupportImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.postgresql:postgresql:42.2.5</span><span class="delimiter">'</span></span>
    mongoSupportImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.mongodb:mongodb-driver-sync:3.9.1</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, the producer declares 3 features, one for each database runtime support:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mysql-support</code> provides both the <code>db-support</code> and <code>mysql-support</code> capabilities</p>
</li>
<li>
<p><code>postgres-support</code> provides both the <code>db-support</code> and <code>postgres-support</code> capabilities</p>
</li>
<li>
<p><code>mongo-support</code> provides both the <code>db-support</code> and <code>mongo-support</code> capabilities</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then if the consumer tries to get both the <code>postgres-support</code> and <code>mysql-support</code> features (this also works transitively):</p>
</div>
<div id="ex-a-consumer-trying-to-use-2-incompatible-variants-at-the-same-time" class="exampleblock">
<div class="title">Example 263. <a href="#ex-a-consumer-trying-to-use-2-incompatible-variants-at-the-same-time">A consumer trying to use 2 incompatible variants at the same time</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // This project requires the main producer component
    implementation(project(&quot;:producer&quot;))

    // Let's try to ask for both MySQL and Postgres support
    runtimeOnly(project(&quot;:producer&quot;)) {
        capabilities {
            requireCapability(&quot;org.gradle.demo:producer-mysql-support&quot;)
        }
    }
    runtimeOnly(project(&quot;:producer&quot;)) {
        capabilities {
            requireCapability(&quot;org.gradle.demo:producer-postgres-support&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:producer</span><span class="delimiter">&quot;</span></span>))

    <span class="comment">// Let's try to ask for both MySQL and Postgres support</span>
    runtimeOnly(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:producer</span><span class="delimiter">&quot;</span></span>)) {
        capabilities {
            requireCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.demo:producer-mysql-support</span><span class="delimiter">&quot;</span></span>)
        }
    }
    runtimeOnly(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:producer</span><span class="delimiter">&quot;</span></span>)) {
        capabilities {
            requireCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.demo:producer-postgres-support</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Dependency resolution would fail with the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Cannot choose between
   org.gradle.demo:producer:1.0 variant mysqlSupportRuntimeElements and
   org.gradle.demo:producer:1.0 variant postgresSupportRuntimeElements
   because they provide the same capability: org.gradle.demo:producer-db-support:1.0</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="understanding-variant-selection"><a class="anchor" href="#understanding-variant-selection"></a><a class="link" href="#understanding-variant-selection">Understanding variant selection</a></h3>
<div class="paragraph">
<p>In other dependency management engines, like Apache Maven™, dependencies and artifacts are bound to a component that is published at a particular GAV (group-artifact-version) coordinates.
The set of dependencies for this component are always the same, regardless of which artifact may be used from the component.</p>
</div>
<div class="paragraph">
<p>If the component does have multiple artifacts, each one is identified by a cumbersome <em>classifier</em>.
There are no common semantics associated with classifiers and that makes it difficult to guarantee a globally consistent dependency graph.
This means that nothing prevents multiple artifacts for a single component (e.g., <code>jdk7</code> and <code>jdk8</code> classifiers) from appearing in a classpath and causing hard to diagnose problems.</p>
</div>
<div class="sect3">
<h4 id="maven_component_model"><a class="anchor" href="#maven_component_model"></a><a class="link" href="#maven_component_model">Maven component model</a></h4>
<div class="imageblock">
<div class="content">
<img src="img/component-model-maven.png" alt="component model maven">
</div>
<div class="title">Figure 13. The Maven component model</div>
</div>
</div>
<div class="sect3">
<h4 id="gradle_component_model"><a class="anchor" href="#gradle_component_model"></a><a class="link" href="#gradle_component_model">Gradle component model</a></h4>
<div class="imageblock">
<div class="content">
<img src="img/component-model-gradle.png" alt="component model gradle">
</div>
<div class="title">Figure 14. The Gradle component model</div>
</div>
<div class="paragraph">
<p>Gradle&#8217;s dependency management engine is <em>variant aware</em>.</p>
</div>
<div class="paragraph">
<p>In addition to a component, Gradle has the concept of <em>variants</em> of a component.
Variants correspond to the different ways a component can be used, such as for Java compilation or native linking or documentation.
Artifacts are attached to a <em>variant</em> and each variant can have a different set of dependencies.</p>
</div>
<div class="paragraph">
<p>How does Gradle know which variant to choose when there&#8217;s more than one?
Variants are matched by use of <a href="#variant_attributes">attributes</a>, which provide semantics to the variants and help the engine to produce a <em>consistent</em> resolution result.</p>
</div>
<div class="paragraph">
<p>Gradle differentiates between two kind of components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>local components (like projects), built from sources</p>
</li>
<li>
<p>external components, published to repositories</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For local components, <a href="#sec:abm_configuration_attributes">variants are mapped to consumable configurations</a>.
For external components, variants are defined by published Gradle Module Metadata or <a href="#sec:mapping-maven-ivy-to-variants">are derived from Ivy/Maven metadata</a>.</p>
</div>
<div class="openblock">
<div class="title">Variants vs configurations</div>
<div class="content">
<div class="paragraph">
<p>Variants and configurations are sometimes used interchangeably in the documentation, DSL or API for historical reasons.</p>
</div>
<div class="paragraph">
<p>All components provide <em>variants</em> and those variants may be backed by a consumable configuration.
Not all configurations are variants because they may be used for declaring or resolving dependencies.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:abm_configuration_attributes"><a class="anchor" href="#sec:abm_configuration_attributes"></a><a class="link" href="#sec:abm_configuration_attributes">Variant attributes</a></h4>
<div class="paragraph">
<p><a href="#variant_attributes">Attributes</a> are type-safe key-value pairs that are defined by the consumer (for a resolvable configuration) and the producer (for each variant).</p>
</div>
<div class="paragraph">
<p>The consumer can define any number of attributes.
Each attribute helps narrow the possible variants that can be selected.
Attribute values do not need to be exact matches.</p>
</div>
<div class="paragraph">
<p>The variant can also define any number of attributes.
The attributes should describe how the variant is intended to be used.
For example, Gradle uses an attribute named <code>org.gradle.usage</code> to describe with how a component is used by the consumer (for compilation, for runtime execution, etc).
It is not unusual for a variant to have more attributes than the consumer needs to provide to select it.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:variant-aware-matching"><a class="anchor" href="#sec:variant-aware-matching"></a><a class="link" href="#sec:variant-aware-matching">Variant attribute matching</a></h4>
<div class="openblock">
<div class="title">About producer variants</div>
<div class="content">
<div class="paragraph">
<p>The variant <em>name</em> is mostly for debugging purposes and error messages.
The name does not participate variant matching&#8212;&#8203;only its attributes do.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>There are no restrictions on the number of variants a component can define.
Usually, a component has at least an implementation variant, but it could also expose test fixtures, documentation or source code.
A component may also expose <em>different variants</em> for different consumers for the same usage. For example, when compiling, a component could have different headers for Linux vs Windows vs macOS.</p>
</div>
<div class="paragraph">
<p>Gradle performs <em>variant aware selection</em> by matching the attributes requested by the consumer against attributes defined by the producer. The <a href="#sec:abm_algorithm">selection algorithm</a> is detailed in another section.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There are two exceptions to this rule that bypass variant aware resolution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when a producer has no variants, a default artifact is chosen.</p>
</li>
<li>
<p>when a consumer <em>explicitly selects a configuration by name</em>, the artifacts of the configuration are chosen.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="a_simple_example"><a class="anchor" href="#a_simple_example"></a><a class="link" href="#a_simple_example">A simple example</a></h4>
<div class="paragraph">
<p>Let&#8217;s consider an example where a consumer is trying to use a library for compilation.</p>
</div>
<div class="paragraph">
<p>First, the consumer needs to explain how it&#8217;s going to use the result of dependency resolution. This is done by setting <em>attributes</em> on the resolvable configuration of the consumer.</p>
</div>
<div class="paragraph">
<p>The consumer wants to resolve a variant that matches: <code>org.gradle.usage=java-api</code></p>
</div>
<div class="paragraph">
<p>Second, the producer needs to expose the different variants of the component.</p>
</div>
<div class="paragraph">
<p>The producer component exposes 2 variants:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>its API (named <code>apiElements</code>) with attribute <code>org.gradle.usage=java-api</code></p>
</li>
<li>
<p>its runtime (named <code>runtimeElements</code>) with attribute <code>org.gradle.usage=java-runtime</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, Gradle selects the appropriate variant by looking at the variant attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the consumer wants a variant with attributes <code>org.gradle.usage=java-api</code></p>
</li>
<li>
<p>the producer has a matching variant (<code>apiElements</code>)</p>
</li>
<li>
<p>the producer has a non-matching variant (<code>runtimeElements</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle provides the artifacts and dependencies from the <code>apiElements</code> variant to the consumer.</p>
</div>
</div>
<div class="sect3">
<h4 id="a_more_complicated_example"><a class="anchor" href="#a_more_complicated_example"></a><a class="link" href="#a_more_complicated_example">A more complicated example</a></h4>
<div class="paragraph">
<p>In the real world, consumers and producers have more than one attribute.</p>
</div>
<div class="paragraph">
<p>A Java Library project in Gradle will involve several different attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.gradle.usage</code> that describes how the variant is used</p>
</li>
<li>
<p><code>org.gradle.dependency.bundling</code> that describes how the variant handles dependencies (shadow jar vs fat jar vs regular jar)</p>
</li>
<li>
<p><code>org.gradle.libraryelements</code>, that describes the packaging of the variant (classes or jar)</p>
</li>
<li>
<p><code>org.gradle.jvm.version</code> that describes the <em>minimal version</em> of Java this variant targets</p>
</li>
<li>
<p><code>org.gradle.jvm.environment</code> that describes the type of JVM this variant targets</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s consider an example where the consumer wants to run tests with a library on Java 8 and the producer supports two different Java versions (Java 8 and Java 11).</p>
</div>
<div class="paragraph">
<p>First, the consumer needs to explain which version of the Java it needs.</p>
</div>
<div class="paragraph">
<p>The consumer wants to resolve a variant that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>can be used at runtime (has <code>org.gradle.usage=java-runtime</code>)</p>
</li>
<li>
<p>can be run on <em>at least</em> Java 8 (<code>org.gradle.jvm.version=8</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Second, the producer needs to expose the different variants of the component.</p>
</div>
<div class="paragraph">
<p>Like in the simple example, there is both a API (compilation) and runtime variant. These exist for both the Java 8 and Java 11 version of the component.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>its API for Java 8 consumers (named <code>apiJava8Elements</code>) with attribute <code>org.gradle.usage=java-api</code> and <code>org.gradle.jvm.version=8</code></p>
</li>
<li>
<p>its runtime for Java 8 consumers (named <code>runtime8Elements</code>) with attribute <code>org.gradle.usage=java-runtime</code> and <code>org.gradle.jvm.version=8</code></p>
</li>
<li>
<p>its API for Java 11 consumers (named <code>apiJava11Elements</code>) with attribute <code>org.gradle.usage=java-api</code> and <code>org.gradle.jvm.version=11</code></p>
</li>
<li>
<p>its runtime for Java 11 consumers (named <code>runtime11Elements</code>) with attribute <code>org.gradle.usage=java-runtime</code> and <code>org.gradle.jvm.version=11</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, Gradle selects the best matching variant by looking at all of the attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the consumer wants a variant with compatible attributes to <code>org.gradle.usage=java-runtime</code> and <code>org.gradle.jvm.version=8</code></p>
</li>
<li>
<p>the variants <code>runtime8Elements</code> and <code>runtime11Elements</code> have `org.gradle.usage=java-runtime</p>
</li>
<li>
<p>the variants <code>apiJava8Elements</code> and <code>apiJava11Elements</code> are incompatible</p>
</li>
<li>
<p>the variant <code>runtime8Elements</code> is compatible because it can run on Java 8</p>
</li>
<li>
<p>the variant <code>runtime11Elements</code> is incompatible because it cannot run on Java 8</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle provides the artifacts and dependencies from the <code>runtime8Elements</code> variant to the consumer.</p>
</div>
<div class="openblock">
<div class="title">Compatibility of variants</div>
<div class="content">
<div class="paragraph">
<p>What if the consumer sets <code>org.gradle.jvm.version</code> to 7?</p>
</div>
<div class="paragraph">
<p>Dependency resolution would <em>fail</em> with an error message explaining that there&#8217;s no suitable variant.
Gradle recognizes that the consumer wants a Java 7 compatible library and the <em>minimal</em> version of Java available on the producer is 8.</p>
</div>
<div class="paragraph">
<p>If the consumer requested <code>org.gradle.jvm.version=15</code>, then Gradle knows either the Java 8 or Java 11 variants could work. Gradle select the highest compatible Java version (11).</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:variant-select-errors"><a class="anchor" href="#sec:variant-select-errors"></a><a class="link" href="#sec:variant-select-errors">Variant selection errors</a></h4>
<div class="paragraph">
<p>When selecting the most compatible variant of a component, resolution may fail:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when more than one variant from the producer matches the consumer attributes (ambiguity error)</p>
</li>
<li>
<p>when no variants from the producer match the consumer attributes (incompatibility error)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="sub:variant-ambiguity"><a class="anchor" href="#sub:variant-ambiguity"></a><a class="link" href="#sub:variant-ambiguity">Dealing with ambiguity errors</a></h5>
<div class="paragraph">
<p>An ambiguous variant selection looks like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Could not resolve all files for configuration ':compileClasspath'.
   &gt; Could not resolve project :lib.
     Required by:
         project :ui
      &gt; Cannot choose between the following variants of project :lib:
          - feature1ApiElements
          - feature2ApiElements
        All of them match the consumer attributes:
          - Variant 'feature1ApiElements' capability org.test:test-capability:1.0:
              - Unmatched attribute:
                  - Found org.gradle.category 'library' but wasn't required.
              - Compatible attributes:
                  - Provides org.gradle.dependency.bundling 'external'
                  - Provides org.gradle.jvm.version '11'
                  - Required org.gradle.libraryelements 'classes' and found value 'jar'.
                  - Provides org.gradle.usage 'java-api'
          - Variant 'feature2ApiElements' capability org.test:test-capability:1.0:
              - Unmatched attribute:
                  - Found org.gradle.category 'library' but wasn't required.
              - Compatible attributes:
                  - Provides org.gradle.dependency.bundling 'external'
                  - Provides org.gradle.jvm.version '11'
                  - Required org.gradle.libraryelements 'classes' and found value 'jar'.
                  - Provides org.gradle.usage 'java-api'</pre>
</div>
</div>
<div class="paragraph">
<p>All <em>compatible</em> candidate variants are displayed with their attributes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unmatched attributes are presented first, as they might be the missing piece in selecting the proper variant.</p>
</li>
<li>
<p>Compatible attributes are presented second as they indicate what the consumer wanted and how these variants do match that request.</p>
</li>
<li>
<p>There will not be any incompatible attributes as the variant would not be considered a candidate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the example above, the fix does not lie in attribute matching but in <a href="#sub:selecting-between-candidates">capability matching</a>, which are shown next to the variant name.
Because these two variants effectively provide the same attributes and capabilities, they cannot be disambiguated.
So in this case, the fix is most likely to provide different capabilities on the producer side (<code>project :lib</code>) and express a capability choice on the consumer side (<code>project :ui</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:variant-no-match"><a class="anchor" href="#sub:variant-no-match"></a><a class="link" href="#sub:variant-no-match">Dealing with no matching variant errors</a></h5>
<div class="paragraph">
<p>A no matching variant error looks like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; No variants of project :lib match the consumer attributes:
  - Configuration ':lib:compile':
      - Incompatible attribute:
          - Required artifactType 'dll' and found incompatible value 'jar'.
      - Other compatible attribute:
          - Provides usage 'api'
  - Configuration ':lib:compile' variant debug:
      - Incompatible attribute:
          - Required artifactType 'dll' and found incompatible value 'jar'.
      - Other compatible attributes:
          - Found buildType 'debug' but wasn't required.
          - Provides usage 'api'
  - Configuration ':lib:compile' variant release:
      - Incompatible attribute:
          - Required artifactType 'dll' and found incompatible value 'jar'.
      - Other compatible attributes:
          - Found buildType 'release' but wasn't required.
          - Provides usage 'api'</pre>
</div>
</div>
<div class="paragraph">
<p>or like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; No variants of project : match the consumer attributes:
   - Configuration ':myElements' declares attribute 'color' with value 'blue':
       - Incompatible because this component declares attribute 'artifactType' with value 'jar' and the consumer needed attribute 'artifactType' with value 'dll'
   - Configuration ':myElements' variant secondary declares attribute 'color' with value 'blue':
       - Incompatible because this component declares attribute 'artifactType' with value 'jar' and the consumer needed attribute 'artifactType' with value 'dll'</pre>
</div>
</div>
<div class="paragraph">
<p>depending upon the stage in the variant selection algorithm where the error occurs.</p>
</div>
<div class="paragraph">
<p>All <em>potentially compatible</em> candidate variants are displayed with their attributes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Incompatible attributes are presented first, as they usually are the key in understanding why a variant could not be selected.</p>
</li>
<li>
<p>Other attributes are presented second, this includes <em>requested</em> and <em>compatible</em> ones as well as all extra <em>producer</em> attributes that are not requested by the consumer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Similar to the ambiguous variant error, the goal is to understand which variant should be selected. In some cases, there may not be any compatible variants from the producer (e.g., trying to run on Java 8 with a library built for Java 11).</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:variant-incompatible"><a class="anchor" href="#sub:variant-incompatible"></a><a class="link" href="#sub:variant-incompatible">Dealing with incompatible variant errors</a></h5>
<div class="paragraph">
<p>An incompatible variant error looks like the following example, where a consumer wants to select a variant with <code>color=green</code>, but the only variant available has <code>color=blue</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Could not resolve all dependencies for configuration ':resolveMe'.
   &gt; Could not resolve project :.
     Required by:
         project :
      &gt; Configuration 'mismatch' in project : does not match the consumer attributes
        Configuration 'mismatch':
          - Incompatible because this component declares attribute 'color' with value 'blue' and the consumer needed attribute 'color' with value 'green'</pre>
</div>
</div>
<div class="paragraph">
<p>It occurs when Gradle cannot select a single variant of a dependency because an explicitly requested attribute value does not match (and is not compatible with) the value of that attribute on any of the variants of the dependency.</p>
</div>
<div class="paragraph">
<p>A sub-type of this failure occurs when Gradle <strong>successfully</strong> selects multiple variants of the same component, but the selected variants are incompatible with <strong>each other</strong>.</p>
</div>
<div class="paragraph">
<p>This looks like the following, where a consumer wants to select two different variants of a component, each supplying different capabilities, which is acceptable.
Unfortunately one variant has <code>color=blue</code> and the other has <code>color=green</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Could not resolve all dependencies for configuration ':resolveMe'.
   &gt; Could not resolve project :.
     Required by:
         project :
      &gt; Multiple incompatible variants of org.example:nyvu:1.0 were selected:
           - Variant org.example:nyvu:1.0 variant blueElementsCapability1 has attributes {color=blue}
           - Variant org.example:nyvu:1.0 variant greenElementsCapability2 has attributes {color=green}

   &gt; Could not resolve project :.
     Required by:
         project :
      &gt; Multiple incompatible variants of org.example:pi2e5:1.0 were selected:
           - Variant org.example:pi2e5:1.0 variant blueElementsCapability1 has attributes {color=blue}
           - Variant org.example:pi2e5:1.0 variant greenElementsCapability2 has attributes {color=green}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:transform-ambiguity"><a class="anchor" href="#sub:transform-ambiguity"></a><a class="link" href="#sub:transform-ambiguity">Dealing with ambiguous transformation errors</a></h5>
<div class="paragraph">
<p>ArtifactTransforms can be used to transform artifacts from one type to another, changing their attributes.
Variant selection can use the attributes available as the result of an artifact transform as a candidate variant.</p>
</div>
<div class="paragraph">
<p>If a project registers multiple artifact transforms, needs to use an artifact transform to produce a matching variant for a consumer&#8217;s request, and multiple artifact transforms could each be used to accomplish this, then Gradle will fail with an ambiguous transformation error like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Could not resolve all dependencies for configuration ':resolveMe'.
   &gt; Found multiple transforms that can produce a variant of project : with requested attributes:
       - color 'red'
       - shape 'round'
     Found the following transforms:
       - From 'configuration ':roundBlueLiquidElements'':
           - With source attributes:
               - color 'blue'
               - shape 'round'
               - state 'liquid'
           - Candidate transform(s):
               - Transform 'BrokenTransform' producing attributes:
                   - color 'red'
                   - shape 'round'
                   - state 'gas'
               - Transform 'BrokenTransform' producing attributes:
                   - color 'red'
                   - shape 'round'
                   - state 'solid'</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:variant-visual"><a class="anchor" href="#sec:variant-visual"></a><a class="link" href="#sec:variant-visual">Visualizing variant information</a></h4>
<div class="sect4">
<h5 id="outgoing_variants_report"><a class="anchor" href="#outgoing_variants_report"></a><a class="link" href="#outgoing_variants_report">Outgoing variants report</a></h5>
<div class="paragraph">
<p>The report task <code>outgoingVariants</code> shows the list of variants available for selection by consumers of the project. It displays the capabilities, attributes and artifacts for each variant.</p>
</div>
<div class="paragraph">
<p>This task is similar to the <code>dependencyInsight</code> <a href="#sec:identifying_reason_dependency_selection">reporting task</a>.</p>
</div>
<div class="paragraph">
<p>By default, <code>outgoingVariants</code> prints information about all variants.
It offers the optional parameter <code>--variant &lt;variantName&gt;</code> to select a single variant to display.
It also accepts the <code>--all</code> flag to include information about legacy and deprecated configurations, or <code>--no-all</code> to exclude this information.</p>
</div>
<div class="paragraph">
<p>Here is the output of the <code>outgoingVariants</code> task on a freshly generated <code>java-library</code> project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Task :outgoingVariants
--------------------------------------------------
Variant apiElements
--------------------------------------------------
API elements for the 'main' feature.

Capabilities
    - new-java-library:lib:unspecified (default capability)
Attributes
    - org.gradle.category            = library
    - org.gradle.dependency.bundling = external
    - org.gradle.jvm.version         = 11
    - org.gradle.libraryelements     = jar
    - org.gradle.usage               = java-api
Artifacts
    - build/libs/lib.jar (artifactType = jar)

Secondary Variants (*)

    --------------------------------------------------
    Secondary Variant classes
    --------------------------------------------------
        Description = Directories containing compiled class files for main.

        Attributes
            - org.gradle.category            = library
            - org.gradle.dependency.bundling = external
            - org.gradle.jvm.version         = 11
            - org.gradle.libraryelements     = classes
            - org.gradle.usage               = java-api
        Artifacts
            - build/classes/java/main (artifactType = java-classes-directory)

--------------------------------------------------
Variant mainSourceElements (i)
--------------------------------------------------
Description = List of source directories contained in the Main SourceSet.

Capabilities
    - new-java-library:lib:unspecified (default capability)
Attributes
    - org.gradle.category            = verification
    - org.gradle.dependency.bundling = external
    - org.gradle.verificationtype    = main-sources
Artifacts
    - src/main/java (artifactType = directory)
    - src/main/resources (artifactType = directory)

--------------------------------------------------
Variant runtimeElements
--------------------------------------------------
Runtime elements for the 'main' feature.

Capabilities
    - new-java-library:lib:unspecified (default capability)
Attributes
    - org.gradle.category            = library
    - org.gradle.dependency.bundling = external
    - org.gradle.jvm.version         = 11
    - org.gradle.libraryelements     = jar
    - org.gradle.usage               = java-runtime
Artifacts
    - build/libs/lib.jar (artifactType = jar)

Secondary Variants (*)

    --------------------------------------------------
    Secondary Variant classes
    --------------------------------------------------
        Description = Directories containing compiled class files for main.

        Attributes
            - org.gradle.category            = library
            - org.gradle.dependency.bundling = external
            - org.gradle.jvm.version         = 11
            - org.gradle.libraryelements     = classes
            - org.gradle.usage               = java-runtime
        Artifacts
            - build/classes/java/main (artifactType = java-classes-directory)

    --------------------------------------------------
    Secondary Variant resources
    --------------------------------------------------
        Description = Directories containing the project's assembled resource files for use at runtime.

        Attributes
            - org.gradle.category            = library
            - org.gradle.dependency.bundling = external
            - org.gradle.jvm.version         = 11
            - org.gradle.libraryelements     = resources
            - org.gradle.usage               = java-runtime
        Artifacts
            - build/resources/main (artifactType = java-resources-directory)

--------------------------------------------------
Variant testResultsElementsForTest (i)
--------------------------------------------------
Description = Directory containing binary results of running tests for the test Test Suite's test target.

Capabilities
    - new-java-library:lib:unspecified (default capability)
Attributes
    - org.gradle.category              = verification
    - org.gradle.testsuite.name        = test
    - org.gradle.testsuite.target.name = test
    - org.gradle.testsuite.type        = unit-test
    - org.gradle.verificationtype      = test-results
Artifacts
    - build/test-results/test/binary (artifactType = directory)

(i) Configuration uses incubating attributes such as Category.VERIFICATION.
(*) Secondary variants are variants created via the Configuration#getOutgoing(): ConfigurationPublications API which also participate in selection, in addition to the configuration itself.</pre>
</div>
</div>
<div class="paragraph">
<p>From this you can see the two main variants that are exposed by a java library, <code>apiElements</code> and <code>runtimeElements</code>.
Notice that the main difference is on the <code>org.gradle.usage</code> attribute, with values <code>java-api</code> and <code>java-runtime</code>.
As they indicate, this is where the difference is made between what needs to be on the <em>compile</em> classpath of consumers, versus what&#8217;s needed on the <em>runtime</em> classpath.</p>
</div>
<div class="paragraph">
<p>It also shows <em>secondary</em> variants, which are exclusive to Gradle projects and not published.
For example, the secondary variant <code>classes</code> from <code>apiElements</code> is what allows Gradle to skip the JAR creation when compiling against a <a href="#sec:java_library_classes_usage"><code>java-library</code> project</a>.</p>
</div>
<div class="sect5">
<h6 id="information_about_invalid_consumable_configurations"><a class="anchor" href="#information_about_invalid_consumable_configurations"></a><a class="link" href="#information_about_invalid_consumable_configurations">Information about invalid consumable configurations</a></h6>
<div class="paragraph">
<p>A project cannot have multiple configurations with the same attributes and capabilities.
In that case, the project will fail to build.</p>
</div>
<div class="paragraph">
<p>In order to be able to visualize such issues, the outgoing variant reports handle those errors in a lenient fashion.
This allows the report to display information about the issue.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="resolvable_configurations_report"><a class="anchor" href="#resolvable_configurations_report"></a><a class="link" href="#resolvable_configurations_report">Resolvable configurations report</a></h5>
<div class="paragraph">
<p>Gradle also offers a complimentary report task called <code>resolvableConfigurations</code> that displays the <em>resolvable</em> configurations of a project, which are those which can have dependencies added and be resolved.  The report will list their attributes and any configurations that they extend.  It will also list a summary of any attributes which will be affected by <a href="#sec:abm_compatibility_rules">Compatibility Rules</a> or <a href="#sec:abm_disambiguation_rules">Disambiguation Rules</a> during resolution.</p>
</div>
<div class="paragraph">
<p>By default, <code>resolvableConfigurations</code> prints information about all purely resolvable configurations.
These are configurations that are marked resolvable but <strong>not</strong> marked consumable.
Though some resolvable configurations are also marked consumable, these are legacy configurations that should <strong>not</strong> have dependencies added in build scripts.
This report offers the optional parameter <code>--configuration &lt;configurationName&gt;</code> to select a single configuration to display.
It also accepts the <code>--all</code> flag to include information about legacy and deprecated configurations, or <code>--no-all</code> to exclude this information.
Finally, it accepts the <code>--recursive</code> flag to list in the extended configurations section those configurations which are extended <em>transitively</em> rather than directly.
Alternatively, <code>--no-recursive</code> can be used to exclude this information.</p>
</div>
<div class="paragraph">
<p>Here is the output of the <code>resolvableConfigurations</code> task on a freshly generated <code>java-library</code> project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Task :resolvableConfigurations
--------------------------------------------------
Configuration annotationProcessor
--------------------------------------------------
Description = Annotation processors and their dependencies for source set 'main'.

Attributes
    - org.gradle.category            = library
    - org.gradle.dependency.bundling = external
    - org.gradle.jvm.environment     = standard-jvm
    - org.gradle.libraryelements     = jar
    - org.gradle.usage               = java-runtime

--------------------------------------------------
Configuration compileClasspath
--------------------------------------------------
Description = Compile classpath for source set 'main'.

Attributes
    - org.gradle.category            = library
    - org.gradle.dependency.bundling = external
    - org.gradle.jvm.environment     = standard-jvm
    - org.gradle.jvm.version         = 11
    - org.gradle.libraryelements     = classes
    - org.gradle.usage               = java-api
Extended Configurations
    - compileOnly
    - implementation

--------------------------------------------------
Configuration runtimeClasspath
--------------------------------------------------
Description = Runtime classpath of source set 'main'.

Attributes
    - org.gradle.category            = library
    - org.gradle.dependency.bundling = external
    - org.gradle.jvm.environment     = standard-jvm
    - org.gradle.jvm.version         = 11
    - org.gradle.libraryelements     = jar
    - org.gradle.usage               = java-runtime
Extended Configurations
    - implementation
    - runtimeOnly

--------------------------------------------------
Configuration testAnnotationProcessor
--------------------------------------------------
Description = Annotation processors and their dependencies for source set 'test'.

Attributes
    - org.gradle.category            = library
    - org.gradle.dependency.bundling = external
    - org.gradle.jvm.environment     = standard-jvm
    - org.gradle.libraryelements     = jar
    - org.gradle.usage               = java-runtime

--------------------------------------------------
Configuration testCompileClasspath
--------------------------------------------------
Description = Compile classpath for source set 'test'.

Attributes
    - org.gradle.category            = library
    - org.gradle.dependency.bundling = external
    - org.gradle.jvm.environment     = standard-jvm
    - org.gradle.jvm.version         = 11
    - org.gradle.libraryelements     = classes
    - org.gradle.usage               = java-api
Extended Configurations
    - testCompileOnly
    - testImplementation

--------------------------------------------------
Configuration testRuntimeClasspath
--------------------------------------------------
Description = Runtime classpath of source set 'test'.

Attributes
    - org.gradle.category            = library
    - org.gradle.dependency.bundling = external
    - org.gradle.jvm.environment     = standard-jvm
    - org.gradle.jvm.version         = 11
    - org.gradle.libraryelements     = jar
    - org.gradle.usage               = java-runtime
Extended Configurations
    - testImplementation
    - testRuntimeOnly

--------------------------------------------------
Compatibility Rules
--------------------------------------------------
Description = The following Attributes have compatibility rules defined.

    - org.gradle.dependency.bundling
    - org.gradle.jvm.environment
    - org.gradle.jvm.version
    - org.gradle.libraryelements
    - org.gradle.plugin.api-version
    - org.gradle.usage

--------------------------------------------------
Disambiguation Rules
--------------------------------------------------
Description = The following Attributes have disambiguation rules defined.

    - org.gradle.category
    - org.gradle.dependency.bundling
    - org.gradle.jvm.environment
    - org.gradle.jvm.version
    - org.gradle.libraryelements
    - org.gradle.plugin.api-version
    - org.gradle.usage</pre>
</div>
</div>
<div class="paragraph">
<p>From this you can see the two main configurations used to resolve dependencies, <code>compileClasspath</code> and <code>runtimeClasspath</code>, as well as their corresponding test configurations.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:mapping-maven-ivy-to-variants"><a class="anchor" href="#sec:mapping-maven-ivy-to-variants"></a><a class="link" href="#sec:mapping-maven-ivy-to-variants">Mapping from Maven/Ivy to Gradle variants</a></h4>
<div class="paragraph">
<p>Neither Maven nor Ivy have the concept of <em>variants</em>, which are only natively supported by Gradle Module Metadata.
Gradle can still work with Maven and Ivy by using different variant derivation strategies.</p>
</div>
<div class="openblock">
<div class="title">Relationship with Gradle Module Metadata</div>
<div class="content">
<div class="paragraph">
<p>Gradle Module Metadata is a metadata format for modules published on Maven, Ivy and other kinds of repositories.
It is similar to the <code>pom.xml</code> or <code>ivy.xml</code> metadata file, but this format contains details about variants.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://github.com/gradle/gradle/blob/master/platforms/documentation/docs/src/docs/design/gradle-module-metadata-latest-specification.md">Gradle Module Metadata specification</a> for more information.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:maven-mapping-to-variants"><a class="anchor" href="#sub:maven-mapping-to-variants"></a><a class="link" href="#sub:maven-mapping-to-variants">Mapping of Maven POM metadata to variants</a></h5>
<div class="paragraph">
<p>Modules published on a Maven repository are automatically converted into variant-aware modules.</p>
</div>
<div class="paragraph">
<p>There is no way for Gradle to know which kind of component was published:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a BOM that represents a Gradle platform</p>
</li>
<li>
<p>a BOM used as a super-POM</p>
</li>
<li>
<p>a POM that is both a platform <em>and</em> a library</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default strategy used by Java projects in Gradle is to derive 8 different variants:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>two "library" variants (attribute <code>org.gradle.category</code> = <code>library</code>)</p>
<div class="ulist">
<ul>
<li>
<p>the <code>compile</code> variant maps the <code>&lt;scope&gt;compile&lt;/scope&gt;</code> dependencies.
This variant is equivalent to the <code>apiElements</code> variant of the <a href="#java_library_plugin">Java Library plugin</a>.
All dependencies of this scope are considered <em>API dependencies</em>.</p>
</li>
<li>
<p>the <code>runtime</code> variant maps both the <code>&lt;scope&gt;compile&lt;/scope&gt;</code> and <code>&lt;scope&gt;runtime&lt;/scope&gt;</code> dependencies.
This variant is equivalent to the <code>runtimeElements</code> variant of the <a href="#java_library_plugin">Java Library plugin</a>.
All dependencies of those scopes are considered <em>runtime dependencies</em>.</p>
<div class="ulist">
<ul>
<li>
<p>in both cases, the <code>&lt;dependencyManagement&gt;</code> dependencies are <em>not converted to constraints</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>a "sources" variant that represents the sources jar for the component</p>
</li>
<li>
<p>a "javadoc" variant that represents the javadoc jar for the component</p>
</li>
<li>
<p>four "platform" variants derived from the <code>&lt;dependencyManagement&gt;</code> block (attribute <code>org.gradle.category</code> = <code>platform</code>):</p>
<div class="ulist">
<ul>
<li>
<p>the <code>platform-compile</code> variant maps the  <code>&lt;scope&gt;compile&lt;/scope&gt;</code> dependency management dependencies as <em>dependency constraints</em>.</p>
</li>
<li>
<p>the <code>platform-runtime</code> variant maps both the <code>&lt;scope&gt;compile&lt;/scope&gt;</code> and <code>&lt;scope&gt;runtime&lt;/scope&gt;</code> dependency management dependencies as <em>dependency constraints</em>.</p>
</li>
<li>
<p>the <code>enforced-platform-compile</code> is similar to <code>platform-compile</code> but all the constraints are <em>forced</em></p>
</li>
<li>
<p>the <code>enforced-platform-runtime</code> is similar to <code>platform-runtime</code> but all the constraints are <em>forced</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can understand more about the use of platform and enforced platforms variants by looking at the <a href="#sub:bom_import">importing BOMs</a> section of the manual.
By default, whenever you declare a dependency on a Maven module, Gradle is going to look for the <code>library</code> variants.
However, using the <code>platform</code> or <code>enforcedPlatform</code> keyword, Gradle is now looking for one of the "platform" variants, which allows you to import the constraints from the POM files, instead of the dependencies.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:ivy-mapping-to-variants"><a class="anchor" href="#sub:ivy-mapping-to-variants"></a><a class="link" href="#sub:ivy-mapping-to-variants">Mapping of Ivy files to variants</a></h5>
<div class="paragraph">
<p>Gradle has no built-in derivation strategy implemented for Ivy files.
Ivy is a flexible format that allows you to publish arbitrary files and can be heavily customized.</p>
</div>
<div class="paragraph">
<p>If you want to implement a derivation strategy for <em>compile</em> and <em>runtime</em> variants for Ivy, you can do so with <a href="#sec:component_metadata_rules">component metadata rule</a>.
The component metadata rules API allows you to <a href="#sec:component_metadata_rules_details">access Ivy configurations</a> and create variants based on them.
If you know that all the Ivy modules your are consuming have been published with Gradle without further customizations of the <code>ivy.xml</code> file, you can add the following rule to your build:</p>
</div>
<div id="ex-deriving-compile-and-runtime-variants-for-ivy-metadata" class="exampleblock">
<div class="title">Example 264. <a href="#ex-deriving-compile-and-runtime-variants-for-ivy-metadata">Deriving compile and runtime variants for Ivy metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class IvyVariantDerivationRule @Inject internal constructor(objectFactory: ObjectFactory) : ComponentMetadataRule {
    private val jarLibraryElements: LibraryElements
    private val libraryCategory: Category
    private val javaRuntimeUsage: Usage
    private val javaApiUsage: Usage

    init {
        jarLibraryElements = objectFactory.named(LibraryElements.JAR)
        libraryCategory = objectFactory.named(Category.LIBRARY)
        javaRuntimeUsage = objectFactory.named(Usage.JAVA_RUNTIME)
        javaApiUsage = objectFactory.named(Usage.JAVA_API)
    }

    override fun execute(context: ComponentMetadataContext) {
        // This filters out any non Ivy module
        if(context.getDescriptor(IvyModuleDescriptor::class) == null) {
            return
        }

        context.details.addVariant(&quot;runtimeElements&quot;, &quot;default&quot;) {
            attributes {
                attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, jarLibraryElements)
                attribute(Category.CATEGORY_ATTRIBUTE, libraryCategory)
                attribute(Usage.USAGE_ATTRIBUTE, javaRuntimeUsage)
            }
        }
        context.details.addVariant(&quot;apiElements&quot;, &quot;compile&quot;) {
            attributes {
                attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, jarLibraryElements)
                attribute(Category.CATEGORY_ATTRIBUTE, libraryCategory)
                attribute(Usage.USAGE_ATTRIBUTE, javaApiUsage)
            }
        }
    }
}

dependencies {
    components { all&lt;IvyVariantDerivationRule&gt;() }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">IvyVariantDerivationRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="directive">final</span> LibraryElements jarLibraryElements
    <span class="directive">final</span> Category libraryCategory
    <span class="directive">final</span> Usage javaRuntimeUsage
    <span class="directive">final</span> Usage javaApiUsage

    <span class="annotation">@Inject</span>
    IvyVariantDerivationRule(<span class="predefined-type">ObjectFactory</span> objectFactory) {
        jarLibraryElements = objectFactory.named(LibraryElements, LibraryElements.JAR)
        libraryCategory = objectFactory.named(Category, Category.LIBRARY)
        javaRuntimeUsage = objectFactory.named(Usage, Usage.JAVA_RUNTIME)
        javaApiUsage = objectFactory.named(Usage, Usage.JAVA_API)
    }

    <span class="type">void</span> execute(ComponentMetadataContext context) {
        <span class="comment">// This filters out any non Ivy module</span>
        <span class="keyword">if</span>(context.getDescriptor(IvyModuleDescriptor) == <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span>
        }

        context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">runtimeElements</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>) {
            attributes {
                attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, jarLibraryElements)
                attribute(Category.CATEGORY_ATTRIBUTE, libraryCategory)
                attribute(Usage.USAGE_ATTRIBUTE, javaRuntimeUsage)
            }
        }
        context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">apiElements</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span>) {
            attributes {
                attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, jarLibraryElements)
                attribute(Category.CATEGORY_ATTRIBUTE, libraryCategory)
                attribute(Usage.USAGE_ATTRIBUTE, javaApiUsage)
            }
        }
    }
}

dependencies {
    components { all(IvyVariantDerivationRule) }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The rule creates an <code>apiElements</code> variant based on the <code>compile</code> configuration and a <code>runtimeElements</code> variant based on the <code>default</code> configuration of each ivy module.
For each variant, it sets the corresponding <a href="#sec:variant-aware-matching">Java ecosystem attributes</a>.
Dependencies and artifacts of the variants are taken from the underlying configurations.
If not all consumed Ivy modules follow this pattern, the rule can be adjusted or only applied to a selected set of modules.</p>
</div>
<div class="paragraph">
<p>For all Ivy modules without variants, Gradle has a fallback selection method. Gradle does <em>not</em> perform variant aware resolution and instead selects either the <code>default</code> configuration or an explicitly named configuration.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="variant_attributes"><a class="anchor" href="#variant_attributes"></a><a class="link" href="#variant_attributes">Working with Variant Attributes</a></h3>
<div class="paragraph">
<p>As explained in the section on <a href="#sec:variant-aware-matching">variant aware matching</a>, attributes give semantics to variants and are used by Gradle&#8217;s dependency management engine to select the best matching variant.</p>
</div>
<div class="paragraph">
<p>As a user of Gradle, attributes are often hidden as implementation details.
But it might be useful to understand the <em>standard attributes</em> defined by Gradle and its core plugins.</p>
</div>
<div class="paragraph">
<p>As a plugin author, these attributes, and the way they are defined, can serve as a basis for <a href="#sec:declaring_attributes">building your own set of attributes</a> in your ecosystem plugin.</p>
</div>
<div class="sect3">
<h4 id="sec:standard_attributes"><a class="anchor" href="#sec:standard_attributes"></a><a class="link" href="#sec:standard_attributes">Standard attributes defined by Gradle</a></h4>
<div class="paragraph">
<p>Gradle defines a list of standard attributes used by Gradle&#8217;s core plugins.</p>
</div>
<div class="sect4">
<h5 id="ecosystem_independent_standard_attributes"><a class="anchor" href="#ecosystem_independent_standard_attributes"></a><a class="link" href="#ecosystem_independent_standard_attributes">Ecosystem-independent standard attributes</a></h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 22. Ecosystem-independent standard variant attributes</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">compatibility and disambiguation rules</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/Usage.html#USAGE_ATTRIBUTE"><code>org.gradle.usage</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates main purpose of variant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Usage</code> values built from constants defined in <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/Usage.html">Usage</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Following ecosystem semantics (e.g. <code>java-runtime</code> can be used in place of <code>java-api</code> but not the opposite)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/Category.html#CATEGORY_ATTRIBUTE"><code>org.gradle.category</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the category of this software component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Category</code> values built from constants defined in <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/Category.html">Category</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Following ecosystem semantics (e.g. <code>library</code> is default on the JVM, no compatibility otherwise)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/LibraryElements.html#LIBRARY_ELEMENTS_ATTRIBUTE"><code>org.gradle.libraryelements</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the contents of a <code>org.gradle.category=library</code> variant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LibraryElements</code> values built from constants defined in <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/LibraryElements.html">LibraryElements</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Following ecosystem semantics(e.g. in the JVM world, <code>jar</code> is the default and is compatible with <code>classes</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/DocsType.html#DOCS_TYPE_ATTRIBUTE"><code>org.gradle.docstype</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the contents of a <code>org.gradle.category=documentation</code> variant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DocsType</code> values built from constants defined in <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/DocsType.html">DocsType</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default, no compatibility</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/Bundling.html#BUNDLING_ATTRIBUTE"><code>org.gradle.dependency.bundling</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates how dependencies of a variant are accessed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Bundling</code> values built from constants defined in <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/Bundling.html">Bundling</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Following ecosystem semantics (e.g. in the JVM world, <code>embedded</code> is compatible with <code>external</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/VerificationType.html#VERIFICATION_TYPE_ATTRIBUTE"><code>org.gradle.verificationtype</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates what kind of verification task produced this output.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VerificationType</code> values built from constants defined in <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/VerificationType.html">VerificationType</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default, no compatibility</p></td>
</tr>
</tbody>
</table>
<div id="sec:verification_category" class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>When the <code>Category</code> attribute is present with the incubating value <code>org.gradle.category=verification</code> on a variant, that variant is considered to be a verification-time only variant.</p>
</div>
<div class="paragraph">
<p>These variants are meant to contain only the results of running verification tasks, such as test results or code coverage reports.
They are <strong>not publishable</strong>, and will produce an error if added to a component which is published.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 23. Ecosystem-independent standard component attributes</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">compatibility and disambiguation rules</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.gradle.status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component level attribute, derived</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Based on <a href="#sec:custom_status_scheme">a status scheme</a>, with a default one existing based on the source repository.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Based on the scheme in use</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="sub:jvm_default_attributes"><a class="anchor" href="#sub:jvm_default_attributes"></a><a class="link" href="#sub:jvm_default_attributes">JVM ecosystem specific attributes</a></h5>
<div class="paragraph">
<p>In addition to the ecosystem independent attributes defined above, the JVM ecosystem adds the following attribute:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 24. JVM ecosystem standard component attributes</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">compatibility and disambiguation rules</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/java/TargetJvmVersion.html#TARGET_JVM_VERSION_ATTRIBUTE"><code>org.gradle.jvm.version</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the JVM version compatibility.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer using the version after the <code>1.</code> for Java 1.4 and before, the major version for Java 5 and beyond.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defaults to the JVM version used by Gradle, lower is compatible with higher, prefers highest compatible.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/java/TargetJvmEnvironment.html#TARGET_JVM_ENVIRONMENT_ATTRIBUTE"><code>org.gradle.jvm.environment</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that a variant is optimized for a certain JVM environment.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common values are <code>standard-jvm</code> and <code>android</code>. Other values are allowed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The attribute is used to prefer one variant over another if multiple are available, but in general all values are compatible. The default is <code>standard-jvm</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/TestSuiteType.html#TEST_SUITE_NAME_ATTRIBUTE"><code>org.gradle.testsuite.name</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testing/base/TestSuite.html">TestSuite</a> that produced this output.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value is the name of the Suite.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default, no compatibility</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/TestSuiteTargetName.html#TEST_SUITE_TARGET_NAME_ATTRIBUTE"><code>org.gradle.testsuite.target.name</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testing/base/TestSuiteTarget.html">TestSuiteTarget</a> that produced this output.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value is the name of the Target.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default, no compatibility</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/TestSuiteType.html#TEST_SUITE_TYPE_ATTRIBUTE"><code>org.gradle.testsuite.type</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the type of test suite (unit test, integration test, performance test, etc.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TestSuiteType</code> values built from constants defined in <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/TestSuiteType.html">TestSuiteType</a> or other custom values for user-defined test suite types.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default, no compatibility</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The JVM ecosystem also contains a number of compatibility and disambiguation rules over the different attributes.
The reader willing to know more can take a look at the code for <code>org.gradle.api.internal.artifacts.JavaEcosystemSupport</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="native_ecosystem_specific_attributes"><a class="anchor" href="#native_ecosystem_specific_attributes"></a><a class="link" href="#native_ecosystem_specific_attributes">Native ecosystem specific attributes</a></h5>
<div class="paragraph">
<p>In addition to the ecosystem independent attributes defined above, the native ecosystem adds the following attributes:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 25. Native ecosystem standard component attributes</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">compatibility and disambiguation rules</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/language/cpp/CppBinary.html#DEBUGGABLE_ATTRIBUTE"><code>org.gradle.native.debuggable</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates if the binary was built with debugging symbols</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/language/cpp/CppBinary.html#OPTIMIZED_ATTRIBUTE"><code>org.gradle.native.optimized</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates if the binary was built with optimization flags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/nativeplatform/MachineArchitecture.html#ARCHITECTURE_ATTRIBUTE"><code>org.gradle.native.architecture</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the target architecture of the binary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MachineArchitecture</code> values built from constants defined in <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/nativeplatform/MachineArchitecture.html">MachineArchitecture</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/nativeplatform/OperatingSystemFamily.html#OPERATING_SYSTEM_ATTRIBUTE"><code>org.gradle.native.operatingSystem</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the target operating system of the binary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OperatingSystemFamily</code> values built from constants defined in <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/nativeplatform/OperatingSystemFamily.html">OperatingSystemFamily</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="sub:gradle_plugins_default_attributes"><a class="anchor" href="#sub:gradle_plugins_default_attributes"></a><a class="link" href="#sub:gradle_plugins_default_attributes">Gradle plugin ecosystem specific attributes</a></h5>
<div class="paragraph">
<p>For Gradle plugin development, the following attribute is supported since Gradle 7.0.
A Gradle plugin variant can specify compatibility with a Gradle API version through this attribute.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 26. Gradle plugin ecosystem standard component attributes</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">compatibility and disambiguation rules</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/plugin/GradlePluginApiVersion.html#GRADLE_PLUGIN_API_VERSION_ATTRIBUTE"><code>org.gradle.plugin.api&#8209;version</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the Gradle API version compatibility.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid Gradle version strings.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defaults to the currently running Gradle, lower is compatible with higher, prefers highest compatible.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:declaring_attributes"><a class="anchor" href="#sec:declaring_attributes"></a><a class="link" href="#sec:declaring_attributes">Declaring custom attributes</a></h4>
<div class="paragraph">
<p>If you are extending Gradle, e.g. by writing a plugin for another ecosystem, declaring custom attributes could be an option if you want to support variant-aware dependency management features in your plugin.
However, you should be cautious if you also attempt to publish libraries.
Semantics of new attributes are usually defined through a plugin, which can carry <a href="#sec:abm_compatibility_rules">compatibility</a> and <a href="#sec:abm_disambiguation_rules">disambiguation</a> rules.
Consequently, builds that consume libraries published for a certain ecosystem, also need to apply the corresponding plugin to interpret attributes correctly.
If your plugin is intended for a larger audience, i.e. if it is openly available and libraries are published to public repositories, defining new attributes effectively extends the semantics of Gradle Module Metadata and comes with responsibilities.
E.g., support for attributes that are already published should not be removed again, or should be handled in some kind of compatibility layer in future versions of the plugin.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating_attributes_in_a_build_script_or_plugin"><a class="anchor" href="#creating_attributes_in_a_build_script_or_plugin"></a><a class="link" href="#creating_attributes_in_a_build_script_or_plugin">Creating attributes in a build script or plugin</a></h4>
<div class="paragraph">
<p>Attributes are <em>typed</em>. An attribute can be created via the <code>Attribute&lt;T&gt;.of</code> method:</p>
</div>
<div id="ex-define-attributes" class="exampleblock">
<div class="title">Example 265. <a href="#ex-define-attributes">Define attributes</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// An attribute of type `String`
val myAttribute = Attribute.of(&quot;my.attribute.name&quot;, String::class.java)
// An attribute of type `Usage`
val myUsage = Attribute.of(&quot;my.usage.attribute&quot;, Usage::class.java)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// An attribute of type `String`</span>
<span class="keyword">def</span> myAttribute = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.attribute.name</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>)
<span class="comment">// An attribute of type `Usage`</span>
<span class="keyword">def</span> myUsage = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.usage.attribute</span><span class="delimiter">&quot;</span></span>, Usage)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Attribute types support most Java primitive classes; such as <code>String</code> and <code>Integer</code>; Or anything extending <code>org.gradle.api.Named</code>.
Attributes should always be declared in the <em>attribute schema</em> found on the <code>dependencies</code> handler:</p>
</div>
<div id="ex-registering-attributes-on-the-attributes-schema" class="exampleblock">
<div class="title">Example 266. <a href="#ex-registering-attributes-on-the-attributes-schema">Registering attributes on the attributes schema</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies.attributesSchema {
    // registers this attribute to the attributes schema
    attribute(myAttribute)
    attribute(myUsage)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies.attributesSchema {
    <span class="comment">// registers this attribute to the attributes schema</span>
    attribute(myAttribute)
    attribute(myUsage)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Registering an attribute with the schema is required in order to use Compatibility and Disambiguation rules that can resolve ambiguity between multiple selectable variants during <a href="#sec:attribute_matching">Attribute Matching</a>.</p>
</div>
<div class="paragraph">
<p>Each configuration has a container of attributes.  Attributes can be configured to set values:</p>
</div>
<div id="ex-setting-attributes-on-configurations" class="exampleblock">
<div class="title">Example 267. <a href="#ex-setting-attributes-on-configurations">Setting attributes on configurations</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;myConfiguration&quot;) {
        attributes {
            attribute(myAttribute, &quot;my-value&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    myConfiguration {
        attributes {
            attribute(myAttribute, <span class="string"><span class="delimiter">'</span><span class="content">my-value</span><span class="delimiter">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For attributes which type extends <code>Named</code>, the value of the attribute <strong>must</strong> be created via the <em>object factory</em>:</p>
</div>
<div id="ex-named-attributes" class="exampleblock">
<div class="title">Example 268. <a href="#ex-named-attributes">Named attributes</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    &quot;myConfiguration&quot; {
        attributes {
            attribute(myUsage, project.objects.named(Usage::class.java, &quot;my-value&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    myConfiguration {
        attributes {
            attribute(myUsage, project.objects.named(Usage, <span class="string"><span class="delimiter">'</span><span class="content">my-value</span><span class="delimiter">'</span></span>))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:attribute_matching"><a class="anchor" href="#sec:attribute_matching"></a><a class="link" href="#sec:attribute_matching">Attribute matching</a></h4>
<div class="sect4">
<h5 id="sec:abm_compatibility_rules"><a class="anchor" href="#sec:abm_compatibility_rules"></a><a class="link" href="#sec:abm_compatibility_rules">Attribute compatibility rules</a></h5>
<div class="paragraph">
<p>Attributes let the engine select <em>compatible variants</em>.
There are cases where a producer may not have <em>exactly</em> what the consumer requests but has a variant that can be used.</p>
</div>
<div class="paragraph">
<p>For example, if the consumer is asking for the API of a library and the producer doesn&#8217;t have an exactly matching variant, the <em>runtime</em> variant could be considered compatible.
This is typical of libraries published to external repositories.
In this case, we know that even if we don&#8217;t have an exact match (API), we can still compile against the runtime variant (it contains <em>more</em> than what we need to compile but it&#8217;s still ok to use).</p>
</div>
<div class="paragraph">
<p>Gradle provides <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/AttributeCompatibilityRule.html">attribute compatibility rules</a> that can be defined for each attribute.
The role of a compatibility rule is to explain which attribute values are <em>compatible</em> based on what the consumer asked for.</p>
</div>
<div class="paragraph">
<p>Attribute compatibility rules have to be registered via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/AttributeMatchingStrategy.html">attribute matching strategy</a> that you can obtain from the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/AttributesSchema.html">attributes schema</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:abm_disambiguation_rules"><a class="anchor" href="#sec:abm_disambiguation_rules"></a><a class="link" href="#sec:abm_disambiguation_rules">Attribute disambiguation rules</a></h5>
<div class="paragraph">
<p>Since multiple values for an attribute can be <em>compatible</em>, Gradle needs to choose the "best" candidate between all compatible candidates. This is called "disambiguation".</p>
</div>
<div class="paragraph">
<p>This is done by implementing an <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/AttributeDisambiguationRule.html">attribute disambiguation rule</a>.</p>
</div>
<div class="paragraph">
<p>Attribute disambiguation rules have to be registered via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/AttributeMatchingStrategy.html">attribute matching strategy</a> that you can obtain from the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/attributes/AttributesSchema.html">attributes schema</a>, which is a member of <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/dsl/DependencyHandler.html">DependencyHandler</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:abm_algorithm"><a class="anchor" href="#sec:abm_algorithm"></a><a class="link" href="#sec:abm_algorithm">Variant attribute matching algorithm</a></h5>
<div class="paragraph">
<p>Finding the best variant can get complicated when there are many different variants available for a component and many different attributes. Gradle&#8217;s dependency resolution engine performs the following algorithm when finding the best result (or failing):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Each candidate&#8217;s attribute value is compared to the consumer&#8217;s requested attribute value. A candidate is considered compatible if its value matches the consumer&#8217;s value exactly, passes the attribute&#8217;s compatibility rule or is not provided.</p>
</li>
<li>
<p>If only one candidate is considered compatible, that candidate wins.</p>
</li>
<li>
<p>If several candidates are compatible, but one of the candidates matches all of the same attributes as the other candidates, Gradle chooses that candidate. This is the candidate with the "longest" match.</p>
</li>
<li>
<p>If several candidates are compatible and are compatible with an equal number of attributes, Gradle needs to disambiguate the candidates.</p>
<div class="olist loweralpha">
<ol class="loweralpha">
<li>
<p>For each requested attribute, if a candidate does not have a value matching the disambiguation rule, it&#8217;s eliminated from consideration.</p>
</li>
<li>
<p>If the attribute has a known precedence, Gradle will stop as soon as there is a single candidate remaining.</p>
</li>
<li>
<p>If the attribute does not have a known precedence, Gradle must consider all attributes.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If several candidates still remain, Gradle will start to consider "extra" attributes to disambiguate between multiple candidates. Extra attributes are attributes that were not requested by the consumer but are present on at least one candidate. These extra attributes are considered in precedence order.</p>
<div class="olist loweralpha">
<ol class="loweralpha">
<li>
<p>If the attribute has a known precedence, Gradle will stop as soon as there is a single candidate remaining.</p>
</li>
<li>
<p>After all extra attributes with precedence are considered, the remaining candidates can be chosen if they are compatible with all of the non-ordered disambiguation rules.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If several candidates still remain, Gradle will consider extra attributes again. A candidate can be chosen if it has the fewest number of extra attributes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If at any step no candidates remain compatible, resolution fails.
Additionally, Gradle outputs a list of all compatible candidates from step 1 to help with debugging variant matching failures.</p>
</div>
<div class="paragraph">
<p>Plugins and ecosystems can influence the selection algorithm by implementing compatibility rules, disambiguation rules and telling Gradle the precedence of attributes. Attributes with a higher precedence are used to eliminate compatible matches in order.</p>
</div>
<div class="paragraph">
<p>For example, in the Java ecosystem, the <code>org.gradle.usage</code> attribute has a higher precedence than <code>org.gradle.libraryelements</code>. This means that if two candidates were available with compatible values for both <code>org.gradle.usage</code> and <code>org.gradle.libraryelements</code>, Gradle will choose the candidate that passes the disambiguation rule for <code>org.gradle.usage</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cross_project_publications"><a class="anchor" href="#cross_project_publications"></a><a class="link" href="#cross_project_publications">Sharing outputs between projects</a></h3>
<div class="paragraph">
<p>A common pattern, in multi-project builds, is that one project consumes the artifacts of another project.
In general, the simplest consumption form in the Java ecosystem is that when <code>A</code> depends on <code>B</code>, then <code>A</code> would depend on the <code>jar</code> produced by project <code>B</code>.
As previously described in this chapter, this is modeled by <code>A</code> depending on a <em>variant of</em> <code>B</code>, where the variant is selected based on the needs of <code>A</code>.
For compilation, we need the API dependencies of <code>B</code>, provided by the <code>apiElements</code> variant.
For runtime, we need the runtime dependencies of <code>B</code>, provided by the <code>runtimeElements</code> variant.</p>
</div>
<div class="paragraph">
<p>However, what if you need a <em>different</em> artifact than the main one?
Gradle provides, for example, built-in support for depending on the <a href="#sec:java_test_fixtures">test fixtures</a> of another project, but sometimes the artifact you need to depend on simply isn&#8217;t exposed as a variant.</p>
</div>
<div class="paragraph">
<p>In order to be <em>safe to share</em> between projects and allow maximum performance (parallelism), such artifacts must be exposed via <em>outgoing configurations</em>.</p>
</div>
<div class="openblock">
<div class="title">Don&#8217;t reference other project tasks directly</div>
<div class="content">
<div class="paragraph">
<p>A frequent anti-pattern to declare cross-project dependencies is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
   <span class="comment">// this is unsafe!</span>
   implementation project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:other</span><span class="delimiter">&quot;</span></span>).tasks.someOtherJar
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This publication model is <em>unsafe</em> and can lead to non-reproducible and hard to parallelize builds.
This section explains how to <em>properly create cross-project boundaries</em> by defining "exchanges" between projects by using <em>variants</em>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>There are two, complementary, options to share artifacts between projects.
The <a href="#sec:simple-sharing-artifacts-between-projects">simplified version</a> is only suitable if what you need to share is a simple artifact that doesn&#8217;t depend on the consumer.
The simple solution is also limited to cases where this artifact is not published to a repository.
This also implies that the consumer does not publish a dependency to this artifact.
In cases where the consumer resolves to different artifacts in different contexts (e.g., different target platforms) or that publication is required, you need to use the <a href="#sec:variant-aware-sharing">advanced version</a>.</p>
</div>
<div class="sect3">
<h4 id="sec:simple-sharing-artifacts-between-projects"><a class="anchor" href="#sec:simple-sharing-artifacts-between-projects"></a><a class="link" href="#sec:simple-sharing-artifacts-between-projects">Simple sharing of artifacts between projects</a></h4>
<div class="paragraph">
<p>First, a producer needs to declare a configuration which is going to be <em>exposed</em> to consumers.
As explained in the <a href="#sec:resolvable-consumable-configs">configurations chapter</a>, this corresponds to a <em>consumable configuration</em>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s imagine that the consumer requires <em>instrumented classes</em> from the producer, but that this artifact is <em>not</em> the main one.
The producer can expose its instrumented classes by creating a configuration that will "carry" this artifact:</p>
</div>
<div id="ex-declaring-an-outgoing-variant" class="exampleblock">
<div class="title">Example 269. <a href="#ex-declaring-an-outgoing-variant">Declaring an outgoing variant</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val instrumentedJars by configurations.creating {
    isCanBeConsumed = true
    isCanBeResolved = false
    // If you want this configuration to share the same dependencies, otherwise omit this line
    extendsFrom(configurations[&quot;implementation&quot;], configurations[&quot;runtimeOnly&quot;])
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    instrumentedJars {
        canBeConsumed = <span class="predefined-constant">true</span>
        canBeResolved = <span class="predefined-constant">false</span>
        <span class="comment">// If you want this configuration to share the same dependencies, otherwise omit this line</span>
        extendsFrom implementation, runtimeOnly
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This configuration is <em>consumable</em>, which means it&#8217;s an "exchange" meant for consumers.
We&#8217;re now going to add artifacts to this configuration, that consumers would get when they consume it:</p>
</div>
<div id="ex-attaching-an-artifact-to-an-outgoing-configuration" class="exampleblock">
<div class="title">Example 270. <a href="#ex-attaching-an-artifact-to-an-outgoing-configuration">Attaching an artifact to an outgoing configuration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">artifacts {
    add(&quot;instrumentedJars&quot;, instrumentedJar)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">artifacts {
    instrumentedJars(instrumentedJar)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here the "artifact" we&#8217;re attaching is a <em>task</em> that actually generates a Jar.
Doing so, Gradle can automatically track dependencies of this task and build them as needed.
This is possible because the <code>Jar</code> task extends <code>AbstractArchiveTask</code>.
If it&#8217;s not the case, you will need to explicitly declare how the artifact is generated.</p>
</div>
<div id="ex-explicitly-declaring-the-task-dependency-of-an-artifact" class="exampleblock">
<div class="title">Example 271. <a href="#ex-explicitly-declaring-the-task-dependency-of-an-artifact">Explicitly declaring the task dependency of an artifact</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">artifacts {
    add(&quot;instrumentedJars&quot;, someTask.outputFile) {
        builtBy(someTask)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">artifacts {
    instrumentedJars(someTask.outputFile) {
        builtBy(someTask)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now the <em>consumer</em> needs to depend on this configuration in order to get the right artifact:</p>
</div>
<div id="ex-an-explicit-configuration-dependency" class="exampleblock">
<div class="title">Example 272. <a href="#ex-an-explicit-configuration-dependency">An explicit configuration dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    instrumentedClasspath(project(mapOf(
        &quot;path&quot; to &quot;:producer&quot;,
        &quot;configuration&quot; to &quot;instrumentedJars&quot;)))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    instrumentedClasspath(project(<span class="key">path</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">:producer</span><span class="delimiter">&quot;</span></span>, <span class="key">configuration</span>: <span class="string"><span class="delimiter">'</span><span class="content">instrumentedJars</span><span class="delimiter">'</span></span>))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Declaring a dependency on an explicit target configuration is <em>not recommended</em>.
If you plan to publish the component which has this dependency, this will likely lead to broken metadata.
If you need to publish the component on a remote repository, follow the instructions of the <a href="#sec:variant-aware-sharing">variant-aware cross publication documentation</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case, we&#8217;re adding the dependency to the <em>instrumentedClasspath</em> configuration, which is a <em>consumer specific configuration</em>.
In Gradle terminology, this is called a <a href="#sec:resolvable-consumable-configs">resolvable configuration</a>, which is defined this way:</p>
</div>
<div id="ex-declaring-a-resolvable-configuration-on-the-consumer" class="exampleblock">
<div class="title">Example 273. <a href="#ex-declaring-a-resolvable-configuration-on-the-consumer">Declaring a resolvable configuration on the consumer</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val instrumentedClasspath by configurations.creating {
    isCanBeConsumed = false
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    instrumentedClasspath {
        canBeConsumed = <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:variant-aware-sharing"><a class="anchor" href="#sec:variant-aware-sharing"></a><a class="link" href="#sec:variant-aware-sharing">Variant-aware sharing of artifacts between projects</a></h4>
<div class="paragraph">
<p>In the <a href="#sec:simple-sharing-artifacts-between-projects">simple sharing solution</a>, we defined a configuration on the producer side which serves as an exchange of artifacts between the producer and the consumer.
However, the consumer has to explicitly tell which configuration it depends on, which is something we want to avoid in <em>variant aware resolution</em>.
In fact, we also <a href="#understanding-variant-selection">have explained</a> that it is possible for a consumer to express requirements using <em>attributes</em> and that the producer should provide the appropriate outgoing variants using attributes too.
This allows for smarter selection, because using a single dependency declaration, without any explicit target configuration, the consumer may resolve different things.
The typical example is that using a single dependency declaration <code>project(":myLib")</code>, we would either choose the <code>arm64</code> or <code>i386</code> version of <code>myLib</code> depending on the architecture.</p>
</div>
<div class="paragraph">
<p>To do this, we will add attributes to both the consumer and the producer.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>It is important to understand that once configurations have attributes, they participate in <em>variant aware resolution</em>, which means that they are candidates considered whenever <em>any</em> notation like <code>project(":myLib")</code> is used.
In other words, the attributes set on the producer <em>must be consistent with the other variants produced on the same project</em>.
They must not, in particular, introduce ambiguity for the existing selection.</p>
</div>
<div class="paragraph">
<p>In practice, it means that the attribute set used on the configuration you create are likely to be dependent on the <em>ecosystem</em> in use (Java, C++, &#8230;&#8203;) because the relevant plugins for those ecosystems often use different attributes.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s enhance our previous example which happens to be a Java Library project.
Java libraries expose a couple of variants to their consumers, <code>apiElements</code> and <code>runtimeElements</code>. Now, we&#8217;re adding a 3rd one, <code>instrumentedJars</code>.</p>
</div>
<div class="paragraph">
<p>Therefore, we need to understand what our new variant is used for in order to set the proper attributes on it.
Let&#8217;s look at the attributes we find on the <code>runtimeElements</code> configuration on the producer:</p>
</div>
<div class="listingblock">
<div class="title">gradle outgoingVariants --variant runtimeElements</div>
<div class="content">
<pre>Attributes
    - org.gradle.category            = library
    - org.gradle.dependency.bundling = external
    - org.gradle.jvm.version         = 11
    - org.gradle.libraryelements     = jar
    - org.gradle.usage               = java-runtime</pre>
</div>
</div>
<div class="paragraph">
<p>What it tells us is that the Java Library plugin produces variants with 5 attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.gradle.category</code> tells us that this variant represents a <em>library</em></p>
</li>
<li>
<p><code>org.gradle.dependency.bundling</code> tells us that the dependencies of this variant are found as jars (they are not, for example, repackaged inside the jar)</p>
</li>
<li>
<p><code>org.gradle.jvm.version</code> tells us that the minimum Java version this library supports is Java 11</p>
</li>
<li>
<p><code>org.gradle.libraryelements</code> tells us this variant contains all elements found in a jar (classes and resources)</p>
</li>
<li>
<p><code>org.gradle.usage</code> says that this variant is a Java runtime, therefore suitable for a Java compiler but also at runtime</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a consequence, if we want our instrumented classes to be used in place of this variant when executing tests, we need to attach similar attributes to our variant.
In fact, the attribute we care about is <code>org.gradle.libraryelements</code> which explains <em>what the variant contains</em>, so we can setup the variant this way:</p>
</div>
<div id="ex-declaring-the-variant-attributes" class="exampleblock">
<div class="title">Example 274. <a href="#ex-declaring-the-variant-attributes">Declaring the variant attributes</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val instrumentedJars by configurations.creating {
    isCanBeConsumed = true
    isCanBeResolved = false
    attributes {
        attribute(Category.CATEGORY_ATTRIBUTE, objects.named(Category.LIBRARY))
        attribute(Usage.USAGE_ATTRIBUTE, objects.named(Usage.JAVA_RUNTIME))
        attribute(Bundling.BUNDLING_ATTRIBUTE, objects.named(Bundling.EXTERNAL))
        attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, JavaVersion.current().majorVersion.toInt())
        attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, objects.named(&quot;instrumented-jar&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    instrumentedJars {
        canBeConsumed = <span class="predefined-constant">true</span>
        canBeResolved = <span class="predefined-constant">false</span>
        attributes {
            attribute(Category.CATEGORY_ATTRIBUTE, objects.named(Category, Category.LIBRARY))
            attribute(Usage.USAGE_ATTRIBUTE, objects.named(Usage, Usage.JAVA_RUNTIME))
            attribute(Bundling.BUNDLING_ATTRIBUTE, objects.named(Bundling, Bundling.EXTERNAL))
            attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, JavaVersion.current().majorVersion.toInteger())
            attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, objects.named(LibraryElements, <span class="string"><span class="delimiter">'</span><span class="content">instrumented-jar</span><span class="delimiter">'</span></span>))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Choosing the right attributes to set is the hardest thing in this process, because they carry the semantics of the variant.
Therefore, before adding <em>new attributes</em>, you should always ask yourself if there isn&#8217;t an attribute which carries the semantics you need.
If there isn&#8217;t, then you may add a new attribute.
When adding new attributes, you must also be careful because it&#8217;s possible that it creates ambiguity during selection.
Often adding an attribute means adding it to <em>all</em> existing variants.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>What we have done here is that we have added a <em>new</em> variant, which can be used <em>at runtime</em>, but contains instrumented classes instead of the normal classes.
However, it now means that for runtime, the consumer has to choose between two variants:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>runtimeElements</code>, the regular variant offered by the <code>java-library</code> plugin</p>
</li>
<li>
<p><code>instrumentedJars</code>, the variant we have created</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In particular, say we want the instrumented classes on the test runtime classpath.
We can now, on the consumer, declare our dependency as a regular project dependency:</p>
</div>
<div id="ex-declaring-the-project-dependency" class="exampleblock">
<div class="title">Example 275. <a href="#ex-declaring-the-project-dependency">Declaring the project dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;junit:junit:4.13&quot;)
    testImplementation(project(&quot;:producer&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.13</span><span class="delimiter">'</span></span>
    testImplementation project(<span class="string"><span class="delimiter">'</span><span class="content">:producer</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we stop here, Gradle will still select the <code>runtimeElements</code> variant in place of our <code>instrumentedJars</code> variant.
This is because the <code>testRuntimeClasspath</code> configuration asks for a configuration which <code>libraryelements</code> attribute is <code>jar</code>, and our new <code>instrumented-jars</code> value is <em>not compatible</em>.</p>
</div>
<div class="paragraph">
<p>So we need to change the requested attributes so that we now look for instrumented jars:</p>
</div>
<div id="ex-changing-the-consumer-attributes" class="exampleblock">
<div class="title">Example 276. <a href="#ex-changing-the-consumer-attributes">Changing the consumer attributes</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    testRuntimeClasspath {
        attributes {
            attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, objects.named(LibraryElements::class.java, &quot;instrumented-jar&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    testRuntimeClasspath {
        attributes {
            attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, objects.named(LibraryElements, <span class="string"><span class="delimiter">'</span><span class="content">instrumented-jar</span><span class="delimiter">'</span></span>))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We can look at another report <em>on the consumer side</em> to view exactly what attributes of each dependency will be requested:</p>
</div>
<div class="listingblock">
<div class="title">gradle resolvableConfigurations --configuration testRuntimeClasspath</div>
<div class="content">
<pre>Attributes
    - org.gradle.category            = library
    - org.gradle.dependency.bundling = external
    - org.gradle.jvm.version         = 11
    - org.gradle.libraryelements     = instrumented-jar
    - org.gradle.usage               = java-runtime</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>resolvableConfigurations</code> report is the complement of the <code>outgoingVariants</code> report.
By running both of these reports on the consumer and producer sides of a relationship, respectively, you can see exactly what attributes are involved in matching during dependency resolution and better predict the outcome when configurations are resolved.</p>
</div>
<div class="paragraph">
<p>Now, we&#8217;re saying that whenever we&#8217;re going to resolve the test runtime classpath, what we are looking for is <em>instrumented classes</em>.
There is a problem though: in our dependencies list, we have JUnit, which, obviously, is <em>not</em> instrumented.
So if we stop here, Gradle is going to fail, explaining that there&#8217;s no variant of JUnit which provide instrumented classes.
This is because we didn&#8217;t explain that it&#8217;s fine to use the regular jar, if no instrumented version is available.
To do this, we need to write a <em>compatibility rule</em>:</p>
</div>
<div id="ex-a-compatibility-rule" class="exampleblock">
<div class="title">Example 277. <a href="#ex-a-compatibility-rule">A compatibility rule</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class InstrumentedJarsRule: AttributeCompatibilityRule&lt;LibraryElements&gt; {

    override fun execute(details: CompatibilityCheckDetails&lt;LibraryElements&gt;) = details.run {
        if (consumerValue?.name == &quot;instrumented-jar&quot; &amp;&amp; producerValue?.name == &quot;jar&quot;) {
            compatible()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">InstrumentedJarsRule</span> <span class="directive">implements</span> AttributeCompatibilityRule&lt;LibraryElements&gt; {

    <span class="annotation">@Override</span>
    <span class="type">void</span> execute(CompatibilityCheckDetails&lt;LibraryElements&gt; details) {
        <span class="keyword">if</span> (details.consumerValue.name == <span class="string"><span class="delimiter">'</span><span class="content">instrumented-jar</span><span class="delimiter">'</span></span> &amp;&amp; details.producerValue.name == <span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>) {
            details.compatible()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>which we need to declare on the attributes schema:</p>
</div>
<div id="ex-making-use-of-the-compatibility-rule" class="exampleblock">
<div class="title">Example 278. <a href="#ex-making-use-of-the-compatibility-rule">Making use of the compatibility rule</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    attributesSchema {
        attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE) {
            compatibilityRules.add(InstrumentedJarsRule::class.java)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    attributesSchema {
        attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE) {
            compatibilityRules.add(InstrumentedJarsRule)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And that&#8217;s it! Now we have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>added a variant which provides instrumented jars</p>
</li>
<li>
<p>explained that this variant is a substitute for the runtime</p>
</li>
<li>
<p>explained that the consumer needs this variant <em>only for test runtime</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle therefore offers a powerful mechanism to select the right variants based on preferences and compatibility.
More details can be found in the <a href="#variant_attributes">variant aware plugins section of the documentation</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>By adding a value to an existing attribute like we have done, or by defining new attributes, we are extending the model.
This means that <em>all consumers</em> have to know about this extended model.</p>
</div>
<div class="paragraph">
<p>For local consumers, this is usually not a problem because all projects understand and share the same schema, but if you had to publish this new variant to an external repository, it means that external consumers would have to add the same rules to their builds for them to pass.
This is in general not a problem for <em>ecosystem plugins</em> (e.g: the Kotlin plugin) where consumption is in any case not possible without applying the plugin, but it is a problem if you add custom values or attributes.</p>
</div>
<div class="paragraph">
<p>So, <strong>avoid publishing custom variants</strong> if they are for internal use only.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="targeting-different-platforms"><a class="anchor" href="#targeting-different-platforms"></a><a class="link" href="#targeting-different-platforms">Targeting different platforms</a></h4>
<div class="paragraph">
<p>It is common for a library to target different platforms.
In the Java ecosystem, we often see different artifacts for the same library, distinguished by a different <em>classifier</em>.
A typical example is Guava, which is published as this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>guava-jre</code> for JDK 8 and above</p>
</li>
<li>
<p><code>guava-android</code> for JDK 7</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The problem with this approach is that there&#8217;s no semantics associated with the classifier.
The dependency resolution engine, in particular, cannot determine automatically which version to use based on the consumer requirements.
For example, it would be better to express that you have a dependency on Guava, and let the engine choose between <code>jre</code> and <code>android</code> based on what is compatible.</p>
</div>
<div class="paragraph">
<p>Gradle provides an improved model for this, which doesn&#8217;t have the weakness of classifiers: attributes.</p>
</div>
<div class="paragraph">
<p>In particular, in the Java ecosystem, Gradle provides a built-in attribute that library authors can use to express compatibility with the Java ecosystem: <code>org.gradle.jvm.version</code>.
This attribute expresses the <em>minimal version that a consumer must have in order to work properly</em>.</p>
</div>
<div class="paragraph">
<p>When you apply the <code>java</code> or <code>java-library</code> plugins, Gradle will automatically associate this attribute to the outgoing variants.
This means that all libraries published with Gradle automatically tell which target platform they use.</p>
</div>
<div class="paragraph">
<p>By default, the <code>org.gradle.jvm.version</code> is set to the value of the <a href="#sec:java_cross_compilation"><code>release</code> property</a> (or as fallback to the <code>targetCompatibility</code> value) of the main compilation task of the source set.</p>
</div>
<div class="paragraph">
<p>While this attribute is automatically set, Gradle <em>will not</em>, by default, let you build a project for different JVMs.
If you need to do this, then you will need to create additional variants following the <a href="#sec:variant-aware-sharing">instructions on variant-aware matching</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Future versions of Gradle will provide ways to automatically build for different Java platforms.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec:abm_artifact_transforms"><a class="anchor" href="#sec:abm_artifact_transforms"></a><a class="link" href="#sec:abm_artifact_transforms">Transforming dependency artifacts on resolution</a></h3>
<div class="paragraph">
<p>As described in <a href="#sec:resolvable-consumable-configs">different kinds of configurations</a>, there may be different variants for the same dependency.
For example, an external Maven dependency has a variant which should be used when compiling against the dependency (<code>java-api</code>), and a variant for running an application which uses the dependency (<code>java-runtime</code>).
A project dependency has even more variants, for example the classes of the project which are used for compilation are available as classes directories (<code>org.gradle.usage=java-api, org.gradle.libraryelements=classes</code>) or as JARs (<code>org.gradle.usage=java-api, org.gradle.libraryelements=jar</code>).</p>
</div>
<div class="paragraph">
<p>The variants of a dependency may differ in its transitive dependencies or in the artifact itself.
For example, the <code>java-api</code> and <code>java-runtime</code> variants of a Maven dependency only differ in the transitive dependencies and both use the same artifact — the JAR file.
For a project dependency, the <code>java-api,classes</code> and the <code>java-api,jars</code> variants have the same transitive dependencies and different artifacts — the classes directories and the JAR files respectively.</p>
</div>
<div class="paragraph">
<p>Gradle identifies a variant of a dependency uniquely by its set of <a href="#sec:abm_configuration_attributes">attributes</a>.
The <code>java-api</code> variant of a dependency is the variant identified by the <code>org.gradle.usage</code> attribute with value <code>java-api</code>.</p>
</div>
<div class="paragraph">
<p>When Gradle resolves a configuration, the <a href="#sec:abm_configuration_attributes">attributes</a> on the resolved configuration determine the <em>requested attributes</em>.
For all dependencies in the configuration, the variant with the requested attributes is selected when resolving the configuration.
For example, when the configuration requests <code>org.gradle.usage=java-api, org.gradle.libraryelements=classes</code> on a project dependency, then the classes directory is selected as the artifact.</p>
</div>
<div class="paragraph">
<p>When the dependency does not have a variant with the requested attributes, resolving the configuration fails.
Sometimes it is possible to transform the artifact of the dependency into the requested variant without changing the transitive dependencies.
For example, unzipping a JAR transforms the artifact of the <code>java-api,jars</code> variant into the <code>java-api,classes</code> variant.
Such a transformation is called <em>Artifact Transform</em>.
Gradle allows registering artifact transforms, and when the dependency does not have the requested variant, then Gradle will try to find a chain of artifact transforms for creating the variant.</p>
</div>
<div class="sect3">
<h4 id="artifact_transform_selection_and_execution"><a class="anchor" href="#artifact_transform_selection_and_execution"></a><a class="link" href="#artifact_transform_selection_and_execution">Artifact transform selection and execution</a></h4>
<div class="paragraph">
<p>As described above, when Gradle resolves a configuration and a dependency in the configuration does not have a variant with the requested attributes, Gradle tries to find a chain of artifact transforms to create the variant.
The process of finding a matching chain of artifact transforms is called <em>artifact transform selection</em>.
Each registered transform converts from a set of attributes to a set of attributes.
For example, the unzip transform can convert from <code>org.gradle.usage=java-api, org.gradle.libraryelements=jars</code> to <code>org.gradle.usage=java-api, org.gradle.libraryelements=classes</code>.</p>
</div>
<div class="paragraph">
<p>In order to find a chain, Gradle starts with the requested attributes and then considers all transforms which modify some of the requested attributes as possible paths leading there.
Going backwards, Gradle tries to obtain a path to some existing variant using transforms.</p>
</div>
<div class="paragraph">
<p>For example, consider a <code>minified</code> attribute with two values: <code>true</code> and <code>false</code>.
The minified attribute represents a variant of a dependency with unnecessary class files removed.
There is an artifact transform registered, which can transform <code>minified</code> from <code>false</code> to <code>true</code>.
When <code>minified=true</code> is requested for a dependency, and there are only variants with <code>minified=false</code>, then Gradle selects the registered minify transform.
The minify transform is able to transform the artifact of the dependency with <code>minified=false</code> to the artifact with <code>minified=true</code>.</p>
</div>
<div class="paragraph">
<p>Of all the found transform chains, Gradle tries to select the best one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there is only one transform chain, it is selected.</p>
</li>
<li>
<p>If there are two transform chains, and one is a suffix of the other one, it is selected.</p>
</li>
<li>
<p>If there is a shortest transform chain, then it is selected.</p>
</li>
<li>
<p>In all other cases, the selection fails and an error is reported.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Gradle does not try to select artifact transforms when there is already a variant of the dependency matching the requested attributes.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>artifactType</code> attribute is special, since it is only present on resolved artifacts and not on dependencies.
As a consequence, any transform which is only mutating <code>artifactType</code> will never be selected when resolving a configuration with only the <code>artifactType</code> as requested attribute.
It will only be considered when using an <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ArtifactView.html">ArtifactView</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After selecting the required artifact transforms, Gradle resolves the variants of the dependencies which are necessary for the initial transform in the chain.
As soon as Gradle finishes resolving the artifacts for the variant, either by downloading an external dependency or executing a task producing the artifact, Gradle starts transforming the artifacts of the variant with the selected chain of artifact transforms.
Gradle executes the transform chains in parallel when possible.</p>
</div>
<div class="paragraph">
<p>Picking up the minify example above, consider a configuration with two dependencies, the external <code>guava</code> dependency and a project dependency on the <code>producer</code> project.
The configuration has the attributes <code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=true</code>.
The external <code>guava</code> dependency has two variants:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=false</code> and</p>
</li>
<li>
<p><code>org.gradle.usage=java-api,org.gradle.libraryelements=jar,minified=false</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the minify transform, Gradle can convert the variant <code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=false</code> of <code>guava</code> to <code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=true</code>, which are the requested attributes.
The project dependency also has variants:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=false</code>,</p>
</li>
<li>
<p><code>org.gradle.usage=java-runtime,org.gradle.libraryelements=classes,minified=false</code>,</p>
</li>
<li>
<p><code>org.gradle.usage=java-api,org.gradle.libraryelements=jar,minified=false</code>,</p>
</li>
<li>
<p><code>org.gradle.usage=java-api,org.gradle.libraryelements=classes,minified=false</code></p>
</li>
<li>
<p>and a few more.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Again, using the minify transform, Gradle can convert the variant <code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=false</code> of the project <code>producer</code> to <code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=true</code>, which are the requested attributes.</p>
</div>
<div class="paragraph">
<p>When the configuration is resolved, Gradle needs to download the <code>guava</code> JAR and minify it.
Gradle also needs to execute the <code>producer:jar</code> task to generate the JAR artifact of the project and then minify it.
The downloading and the minification of the <code>guava.jar</code> happens in parallel to the execution of the <code>producer:jar</code> task and the minification of the resulting JAR.</p>
</div>
<div class="paragraph">
<p>Here is how to setup the <code>minified</code> attribute so that the above works.
You need to register the new attribute in the schema, add it to all JAR artifacts and request it on all resolvable configurations.</p>
</div>
<div id="ex-artifact-transform-attribute-setup" class="exampleblock">
<div class="title">Example 279. <a href="#ex-artifact-transform-attribute-setup">Artifact transform attribute setup</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val artifactType = Attribute.of(&quot;artifactType&quot;, String::class.java)
val minified = Attribute.of(&quot;minified&quot;, Boolean::class.javaObjectType)
dependencies {
    attributesSchema {
        attribute(minified)                      // <b class="conum">(1)</b>
    }
    artifactTypes.getByName(&quot;jar&quot;) {
        attributes.attribute(minified, false)    // <b class="conum">(2)</b>
    }
}

configurations.all {
    afterEvaluate {
        if (isCanBeResolved) {
            attributes.attribute(minified, true) // <b class="conum">(3)</b>
        }
    }
}

dependencies {
    registerTransform(Minify::class) {
        from.attribute(minified, false).attribute(artifactType, &quot;jar&quot;)
        to.attribute(minified, true).attribute(artifactType, &quot;jar&quot;)
    }
}

dependencies {                                 // <b class="conum">(4)</b>
    implementation(&quot;com.google.guava:guava:27.1-jre&quot;)
    implementation(project(&quot;:producer&quot;))
}

tasks.register&lt;Copy&gt;(&quot;resolveRuntimeClasspath&quot;) { // <b class="conum">(5)</b>
    from(configurations.runtimeClasspath)
    into(layout.buildDirectory.dir(&quot;runtimeClasspath&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> artifactType = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">'</span><span class="content">artifactType</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
<span class="keyword">def</span> minified = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">'</span><span class="content">minified</span><span class="delimiter">'</span></span>, <span class="predefined-type">Boolean</span>)
dependencies {
    attributesSchema {
        attribute(minified)                      // <b class="conum">(1)</b>
    }
    artifactTypes.getByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">jar</span><span class="delimiter">&quot;</span></span>) {
        attributes.attribute(minified, <span class="predefined-constant">false</span>)    // <b class="conum">(2)</b>
    }
}

configurations.all {
    afterEvaluate {
        <span class="keyword">if</span> (canBeResolved) {
            attributes.attribute(minified, <span class="predefined-constant">true</span>) // <b class="conum">(3)</b>
        }
    }
}

dependencies {
    registerTransform(Minify) {
        from.attribute(minified, <span class="predefined-constant">false</span>).attribute(artifactType, <span class="string"><span class="delimiter">&quot;</span><span class="content">jar</span><span class="delimiter">&quot;</span></span>)
        to.attribute(minified, <span class="predefined-constant">true</span>).attribute(artifactType, <span class="string"><span class="delimiter">&quot;</span><span class="content">jar</span><span class="delimiter">&quot;</span></span>)
    }
}
dependencies {                                 // <b class="conum">(4)</b>
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:27.1-jre</span><span class="delimiter">'</span></span>)
    implementation(project(<span class="string"><span class="delimiter">'</span><span class="content">:producer</span><span class="delimiter">'</span></span>))
}

tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">resolveRuntimeClasspath</span><span class="delimiter">&quot;</span></span>, Copy) {// <b class="conum">(5)</b>
    from(configurations.runtimeClasspath)
    into(layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">runtimeClasspath</span><span class="delimiter">&quot;</span></span>))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Add the attribute to the schema</p>
</li>
<li>
<p>All JAR files are not minified</p>
</li>
<li>
<p>Request <code>minified=true</code> on all resolvable configurations</p>
</li>
<li>
<p>Add the dependencies which will be transformed</p>
</li>
<li>
<p>Add task that requires the transformed artifacts</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can now see what happens when we run the <code>resolveRuntimeClasspath</code> task which resolves the <code>runtimeClasspath</code> configuration.
Observe that Gradle transforms the project dependency before the <code>resolveRuntimeClasspath</code> task starts.
Gradle transforms the binary dependencies when it executes the <code>resolveRuntimeClasspath</code> task.</p>
</div>
<div class="listingblock">
<div class="title">Output when resolving the runtimeClasspath configuration</div>
<div class="content">
<pre>&gt; gradle resolveRuntimeClasspath

&gt; Task :producer:compileJava
&gt; Task :producer:processResources NO-SOURCE
&gt; Task :producer:classes
&gt; Task :producer:jar

&gt; Transform producer.jar (project :producer) with Minify
Nothing to minify - using producer.jar unchanged

&gt; Task :resolveRuntimeClasspath
Minifying guava-27.1-jre.jar
Nothing to minify - using listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar unchanged
Nothing to minify - using jsr305-3.0.2.jar unchanged
Nothing to minify - using checker-qual-2.5.2.jar unchanged
Nothing to minify - using error_prone_annotations-2.2.0.jar unchanged
Nothing to minify - using j2objc-annotations-1.1.jar unchanged
Nothing to minify - using animal-sniffer-annotations-1.17.jar unchanged
Nothing to minify - using failureaccess-1.0.1.jar unchanged

BUILD SUCCESSFUL in 0s
3 actionable tasks: 3 executed</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:implementing-artifact-transforms"><a class="anchor" href="#sec:implementing-artifact-transforms"></a><a class="link" href="#sec:implementing-artifact-transforms">Implementing artifact transforms</a></h4>
<div class="paragraph">
<p>Similar to task types, an artifact transform consists of an action and some parameters.
The major difference to custom task types is that the action and the parameters are implemented as two separate classes.</p>
</div>
<div class="paragraph">
<p>The implementation of the artifact transform action is a class implementing <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.transform.TransformAction.html">TransformAction</a>.
You need to implement the <code>transform()</code> method on the action, which converts an input artifact into zero, one or multiple of output artifacts.
Most artifact transforms will be one-to-one, so the transform method will transform the input artifact to exactly one output artifact.</p>
</div>
<div class="paragraph">
<p>The implementation of the artifact transform action needs to register each output artifact by calling
 <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.transform.TransformOutputs.html#org.gradle.api.artifacts.transform.TransformOutputs:dir(java.lang.Object)">TransformOutputs.dir()</a> or <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.transform.TransformOutputs.html#org.gradle.api.artifacts.transform.TransformOutputs:file(java.lang.Object)">TransformOutputs.file()</a>.</p>
</div>
<div class="paragraph">
<p>You can only supply two types of paths to the <code>dir</code> or <code>file</code> methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An absolute path to the input artifact or in the input artifact (for an input directory).</p>
</li>
<li>
<p>A relative path.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle uses the absolute path as the location of the output artifact.
For example, if the input artifact is an exploded WAR, then the transform action can call <code>TransformOutputs.file()</code> for all jar files in the <code>WEB-INF/lib</code> directory.
The output of the transform would then be the library JARs of the web application.</p>
</div>
<div class="paragraph">
<p>For a relative path, the <code>dir()</code> or <code>file()</code> method returns a workspace to the transform action.
The implementation of the transform action needs to create the transformed artifact at the location of the provided workspace.</p>
</div>
<div class="paragraph">
<p>The output artifacts replace the input artifact in the transformed variant in the order they were registered.
For example, if the configuration consists of the artifacts <code>lib1.jar</code>, <code>lib2.jar</code>, <code>lib3.jar</code>, and the transform action registers a minified output artifact <code>&lt;artifact-name&gt;-min.jar</code> for the input artifact, then the transformed configuration consists of the artifacts <code>lib1-min.jar</code>, <code>lib2-min.jar</code> and <code>lib3-min.jar</code>.</p>
</div>
<div class="paragraph">
<p>Here is the implementation of an <code>Unzip</code> transform which transforms a JAR file into a classes directory by unzipping it.
The <code>Unzip</code> transform does not require any parameters.
Note how the implementation uses <code>@InputArtifact</code> to inject the artifact to transform into the action.
It requests a directory for the unzipped classes by using <code>TransformOutputs.dir()</code> and then unzips the JAR file into this directory.</p>
</div>
<div id="ex-artifact-transform-without-parameters" class="exampleblock">
<div class="title">Example 280. <a href="#ex-artifact-transform-without-parameters">Artifact transform without parameters</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class Unzip : TransformAction&lt;TransformParameters.None&gt; {          // <b class="conum">(1)</b>
    @get:InputArtifact                                                      // <b class="conum">(2)</b>
    abstract val inputArtifact: Provider&lt;FileSystemLocation&gt;

    override
    fun transform(outputs: TransformOutputs) {
        val input = inputArtifact.get().asFile
        val unzipDir = outputs.dir(input.name)                              // <b class="conum">(3)</b>
        unzipTo(input, unzipDir)                                            // <b class="conum">(4)</b>
    }

    private fun unzipTo(zipFile: File, unzipDir: File) {
        // implementation...
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">Unzip</span> <span class="directive">implements</span> TransformAction&lt;TransformParameters.None&gt; { // <b class="conum">(1)</b>
    <span class="annotation">@InputArtifact</span>                                                          // <b class="conum">(2)</b>
    <span class="directive">abstract</span> <span class="predefined-type">Provider</span>&lt;FileSystemLocation&gt; getInputArtifact()

    <span class="annotation">@Override</span>
    <span class="type">void</span> transform(TransformOutputs outputs) {
        <span class="keyword">def</span> input = inputArtifact.get().asFile
        <span class="keyword">def</span> unzipDir = outputs.dir(input.name)                              // <b class="conum">(3)</b>
        unzipTo(input, unzipDir)                                            // <b class="conum">(4)</b>
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">void</span> unzipTo(<span class="predefined-type">File</span> zipFile, <span class="predefined-type">File</span> unzipDir) {
        <span class="comment">// implementation...</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Use <code>TransformParameters.None</code> if the transform does not use parameters</p>
</li>
<li>
<p>Inject the input artifact</p>
</li>
<li>
<p>Request an output location for the unzipped files</p>
</li>
<li>
<p>Do the actual work of the transform</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An artifact transform may require parameters, like a <code>String</code> determining some filter, or some file collection which is used for supporting the transformation of the input artifact.
In order to pass those parameters to the transform action, you need to define a new type with the desired parameters.
The type needs to implement the marker interface <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/transform/TransformParameters.html">TransformParameters</a>.
The parameters must be represented using <a href="properties_providers.html#managed_properties">managed properties</a> and the parameters type must be a <a href="properties_providers.html#managed_types">managed type</a>.
You can use an interface or abstract class declaring the getters and Gradle will generate the implementation.
All getters need to have proper input annotations, see <a href="#table:incremental_build_annotations">incremental build annotations</a> table.</p>
</div>
<div class="paragraph">
<p>You can find out more about implementing artifact transform parameters in <a href="properties_providers.html#properties_and_providers">Developing Custom Gradle Types</a>.</p>
</div>
<div class="paragraph">
<p>Here is the implementation of a <code>Minify</code> transform that makes JARs smaller by only keeping certain classes in them.
The <code>Minify</code> transform requires the classes to keep as parameters.
Observe how you can obtain the parameters by <code>TransformAction.getParameters()</code> in the <code>transform()</code> method.
The implementation of the <code>transform()</code> method requests a location for the minified JAR by using <code>TransformOutputs.file()</code> and then creates the minified JAR at this location.</p>
</div>
<div id="ex-minify-transform-implementation" class="exampleblock">
<div class="title">Example 281. <a href="#ex-minify-transform-implementation">Minify transform implementation</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class Minify : TransformAction&lt;Minify.Parameters&gt; {   // <b class="conum">(1)</b>
    interface Parameters : TransformParameters {               // <b class="conum">(2)</b>
        @get:Input
        var keepClassesByArtifact: Map&lt;String, Set&lt;String&gt;&gt;

    }

    @get:PathSensitive(PathSensitivity.NAME_ONLY)
    @get:InputArtifact
    abstract val inputArtifact: Provider&lt;FileSystemLocation&gt;

    override
    fun transform(outputs: TransformOutputs) {
        val fileName = inputArtifact.get().asFile.name
        for (entry in parameters.keepClassesByArtifact) {      // <b class="conum">(3)</b>
            if (fileName.startsWith(entry.key)) {
                val nameWithoutExtension = fileName.substring(0, fileName.length - 4)
                minify(inputArtifact.get().asFile, entry.value, outputs.file(&quot;${nameWithoutExtension}-min.jar&quot;))
                return
            }
        }
        println(&quot;Nothing to minify - using ${fileName} unchanged&quot;)
        outputs.file(inputArtifact)                            // <b class="conum">(4)</b>
    }

    private fun minify(artifact: File, keepClasses: Set&lt;String&gt;, jarFile: File) {
        println(&quot;Minifying ${artifact.name}&quot;)
        // Implementation ...
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">Minify</span> <span class="directive">implements</span> TransformAction&lt;Parameters&gt; { // <b class="conum">(1)</b>
    <span class="type">interface</span> Parameters <span class="directive">extends</span> TransformParameters {         // <b class="conum">(2)</b>
        <span class="annotation">@Input</span>
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt;&gt; getKeepClassesByArtifact()
        <span class="type">void</span> setKeepClassesByArtifact(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt;&gt; keepClasses)
    }

    <span class="annotation">@PathSensitive</span>(PathSensitivity.NAME_ONLY)
    <span class="annotation">@InputArtifact</span>
    <span class="directive">abstract</span> <span class="predefined-type">Provider</span>&lt;FileSystemLocation&gt; getInputArtifact()

    <span class="annotation">@Override</span>
    <span class="type">void</span> transform(TransformOutputs outputs) {
        <span class="keyword">def</span> fileName = inputArtifact.get().asFile.name
        <span class="keyword">for</span> (entry <span class="keyword">in</span> parameters.keepClassesByArtifact) {      // <b class="conum">(3)</b>
            <span class="keyword">if</span> (fileName.startsWith(entry.key)) {
                <span class="keyword">def</span> nameWithoutExtension = fileName.substring(<span class="integer">0</span>, fileName.length() - <span class="integer">4</span>)
                minify(inputArtifact.get().asFile, entry.value, outputs.file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>nameWithoutExtension<span class="inline-delimiter">}</span></span><span class="content">-min.jar</span><span class="delimiter">&quot;</span></span>))
                <span class="keyword">return</span>
            }
        }
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Nothing to minify - using </span><span class="inline"><span class="inline-delimiter">${</span>fileName<span class="inline-delimiter">}</span></span><span class="content"> unchanged</span><span class="delimiter">&quot;</span></span>
        outputs.file(inputArtifact)                            // <b class="conum">(4)</b>
    }

    <span class="directive">private</span> <span class="type">void</span> minify(<span class="predefined-type">File</span> artifact, <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; keepClasses, <span class="predefined-type">File</span> jarFile) {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Minifying </span><span class="inline"><span class="inline-delimiter">${</span>artifact.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="comment">// Implementation ...</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Declare the parameter type</p>
</li>
<li>
<p>Interface for the transform parameters</p>
</li>
<li>
<p>Use the parameters</p>
</li>
<li>
<p>Use the unchanged input artifact when no minification is required</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Remember that the input artifact is a dependency, which may have its own dependencies.
If your artifact transform needs access to those transitive dependencies, it can declare an abstract getter returning a <code>FileCollection</code> and annotate it with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/transform/InputArtifactDependencies.html">@InputArtifactDependencies</a>.
When your transform runs, Gradle will inject the transitive dependencies into that <code>FileCollection</code> property by implementing the getter.
Note that using input artifact dependencies in a transform has performance implications, only inject them when you really need them.</p>
</div>
<div class="paragraph">
<p>Moreover, artifact transforms can make use of the <a href="#build_cache">build cache</a> for their outputs.
To enable the build cache for an artifact transform, add the <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/transform/CacheableTransform.html">CacheableTransform</a></code> annotation on the action class.
For cacheable transforms, you must annotate its <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/transform/InputArtifact.html">@InputArtifact</a> property — and any property marked with <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/transform/InputArtifactDependencies.html">@InputArtifactDependencies</a> — with normalization annotations such as <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/PathSensitive.html">@PathSensitive</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows a more complicated transform.
It moves some selected classes of a JAR to a different package, rewriting the byte code of the moved classes and all classes using the moved classes (class relocation).
In order to determine the classes to relocate, it looks at the packages of the input artifact and the dependencies of the input artifact.
It also does not relocate packages contained in JAR files in an external classpath.</p>
</div>
<div id="ex-artifact-transform-for-class-relocation" class="exampleblock">
<div class="title">Example 282. <a href="#ex-artifact-transform-for-class-relocation">Artifact transform for class relocation</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableTransform                                                          // <b class="conum">(1)</b>
abstract class ClassRelocator : TransformAction&lt;ClassRelocator.Parameters&gt; {
    interface Parameters : TransformParameters {                             // <b class="conum">(2)</b>
        @get:CompileClasspath                                                // <b class="conum">(3)</b>
        val externalClasspath: ConfigurableFileCollection
        @get:Input
        val excludedPackage: Property&lt;String&gt;
    }

    @get:Classpath                                                           // <b class="conum">(4)</b>
    @get:InputArtifact
    abstract val primaryInput: Provider&lt;FileSystemLocation&gt;

    @get:CompileClasspath
    @get:InputArtifactDependencies                                           // <b class="conum">(5)</b>
    abstract val dependencies: FileCollection

    override
    fun transform(outputs: TransformOutputs) {
        val primaryInputFile = primaryInput.get().asFile
        if (parameters.externalClasspath.contains(primaryInputFile)) {       // <b class="conum">(6)</b>
            outputs.file(primaryInput)
        } else {
            val baseName = primaryInputFile.name.substring(0, primaryInputFile.name.length - 4)
            relocateJar(outputs.file(&quot;$baseName-relocated.jar&quot;))
        }
    }

    private fun relocateJar(output: File) {
        // implementation...
        val relocatedPackages = (dependencies.flatMap { it.readPackages() } + primaryInput.get().asFile.readPackages()).toSet()
        val nonRelocatedPackages = parameters.externalClasspath.flatMap { it.readPackages() }
        val relocations = (relocatedPackages - nonRelocatedPackages).map { packageName -&gt;
            val toPackage = &quot;relocated.$packageName&quot;
            println(&quot;$packageName -&gt; $toPackage&quot;)
            Relocation(packageName, toPackage)
        }
        JarRelocator(primaryInput.get().asFile, output, relocations).run()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableTransform</span>                                                          // <b class="conum">(1)</b>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">ClassRelocator</span> <span class="directive">implements</span> TransformAction&lt;Parameters&gt; {
    <span class="type">interface</span> Parameters <span class="directive">extends</span> TransformParameters {                       // <b class="conum">(2)</b>
        <span class="annotation">@CompileClasspath</span>                                                    // <b class="conum">(3)</b>
        ConfigurableFileCollection getExternalClasspath()
        <span class="annotation">@Input</span>
        Property&lt;<span class="predefined-type">String</span>&gt; getExcludedPackage()
    }

    <span class="annotation">@Classpath</span>                                                               // <b class="conum">(4)</b>
    <span class="annotation">@InputArtifact</span>
    <span class="directive">abstract</span> <span class="predefined-type">Provider</span>&lt;FileSystemLocation&gt; getPrimaryInput()

    <span class="annotation">@CompileClasspath</span>
    <span class="annotation">@InputArtifactDependencies</span>                                               // <b class="conum">(5)</b>
    <span class="directive">abstract</span> FileCollection getDependencies()

    <span class="annotation">@Override</span>
    <span class="type">void</span> transform(TransformOutputs outputs) {
        <span class="keyword">def</span> primaryInputFile = primaryInput.get().asFile
        <span class="keyword">if</span> (parameters.externalClasspath.contains(primaryInput)) {           // <b class="conum">(6)</b>
            outputs.file(primaryInput)
        } <span class="keyword">else</span> {
            <span class="keyword">def</span> baseName = primaryInputFile.name.substring(<span class="integer">0</span>, primaryInputFile.name.length - <span class="integer">4</span>)
            relocateJar(outputs.file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>baseName</span><span class="content">-relocated.jar</span><span class="delimiter">&quot;</span></span>))
        }
    }

    <span class="directive">private</span> relocateJar(<span class="predefined-type">File</span> output) {
        <span class="comment">// implementation...</span>
        <span class="keyword">def</span> relocatedPackages = (dependencies.collectMany { readPackages(<span class="local-variable">it</span>) } + readPackages(primaryInput.get().asFile)) <span class="keyword">as</span> <span class="predefined-type">Set</span>
        <span class="keyword">def</span> nonRelocatedPackages = parameters.externalClasspath.collectMany { readPackages(<span class="local-variable">it</span>) }
        <span class="keyword">def</span> relocations = (relocatedPackages - nonRelocatedPackages).collect { packageName -&gt;
            <span class="keyword">def</span> toPackage = <span class="string"><span class="delimiter">&quot;</span><span class="content">relocated.</span><span class="inline"><span class="inline-delimiter">$</span>packageName</span><span class="delimiter">&quot;</span></span>
            println(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>packageName</span><span class="content"> -&gt; </span><span class="inline"><span class="inline-delimiter">$</span>toPackage</span><span class="delimiter">&quot;</span></span>)
            <span class="keyword">new</span> Relocation(packageName, toPackage)
        }
        <span class="keyword">new</span> JarRelocator(primaryInput.get().asFile, output, relocations).run()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Declare the transform cacheable</p>
</li>
<li>
<p>Interface for the transform parameters</p>
</li>
<li>
<p>Declare input type for each parameter</p>
</li>
<li>
<p>Declare a normalization for the input artifact</p>
</li>
<li>
<p>Inject the input artifact dependencies</p>
</li>
<li>
<p>Use the parameters</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="registering_artifact_transforms"><a class="anchor" href="#registering_artifact_transforms"></a><a class="link" href="#registering_artifact_transforms">Registering artifact transforms</a></h4>
<div class="paragraph">
<p>You need to register the artifact transform actions, providing parameters if necessary, so that they can be selected when resolving dependencies.</p>
</div>
<div class="paragraph">
<p>In order to register an artifact transform, you must use <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html#org.gradle.api.artifacts.dsl.DependencyHandler:registerTransform(java.lang.Class,%20org.gradle.api.Action)">registerTransform()</a> within the <code>dependencies {}</code> block.</p>
</div>
<div class="paragraph">
<p>There are a few points to consider when using <code>registerTransform()</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>from</code> and <code>to</code> attributes are required.</p>
</li>
<li>
<p>The transform action itself can have configuration options. You can configure them with the <code>parameters {}</code> block.</p>
</li>
<li>
<p>You must register the transform on the project that has the configuration that will be resolved.</p>
</li>
<li>
<p>You can supply any type implementing <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.transform.TransformAction.html">TransformAction</a> to the <code>registerTransform()</code> method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, imagine you want to unpack some dependencies and put the unpacked directories and files on the classpath.
You can do so by registering an artifact transform action of type <code>Unzip</code>, as shown here:</p>
</div>
<div id="ex-artifact-transform-registration-without-parameters" class="exampleblock">
<div class="title">Example 283. <a href="#ex-artifact-transform-registration-without-parameters">Artifact transform registration without parameters</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val artifactType = Attribute.of(&quot;artifactType&quot;, String::class.java)

dependencies {
    registerTransform(Unzip::class) {
        from.attribute(artifactType, &quot;jar&quot;)
        to.attribute(artifactType, &quot;java-classes-directory&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> artifactType = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">'</span><span class="content">artifactType</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)

dependencies {
    registerTransform(Unzip) {
        from.attribute(artifactType, <span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>)
        to.attribute(artifactType, <span class="string"><span class="delimiter">'</span><span class="content">java-classes-directory</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Another example is that you want to minify JARs by only keeping some <code>class</code> files from them.
Note the use of the <code>parameters {}</code> block to provide the classes to keep in the minified JARs to the <code>Minify</code> transform.</p>
</div>
<div id="ex-artifact-transform-registration-with-parameters" class="exampleblock">
<div class="title">Example 284. <a href="#ex-artifact-transform-registration-with-parameters">Artifact transform registration with parameters</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val artifactType = Attribute.of(&quot;artifactType&quot;, String::class.java)
val minified = Attribute.of(&quot;minified&quot;, Boolean::class.javaObjectType)
val keepPatterns = mapOf(
    &quot;guava&quot; to setOf(
        &quot;com.google.common.base.Optional&quot;,
        &quot;com.google.common.base.AbstractIterator&quot;
    )
)


dependencies {
    registerTransform(Minify::class) {
        from.attribute(minified, false).attribute(artifactType, &quot;jar&quot;)
        to.attribute(minified, true).attribute(artifactType, &quot;jar&quot;)

        parameters {
            keepClassesByArtifact = keepPatterns
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> artifactType = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">'</span><span class="content">artifactType</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
<span class="keyword">def</span> minified = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">'</span><span class="content">minified</span><span class="delimiter">'</span></span>, <span class="predefined-type">Boolean</span>)
<span class="keyword">def</span> keepPatterns = [
    <span class="string"><span class="delimiter">&quot;</span><span class="content">guava</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.common.base.Optional</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.common.base.AbstractIterator</span><span class="delimiter">&quot;</span></span>
    ] <span class="keyword">as</span> <span class="predefined-type">Set</span>
]


dependencies {
    registerTransform(Minify) {
        from.attribute(minified, <span class="predefined-constant">false</span>).attribute(artifactType, <span class="string"><span class="delimiter">&quot;</span><span class="content">jar</span><span class="delimiter">&quot;</span></span>)
        to.attribute(minified, <span class="predefined-constant">true</span>).attribute(artifactType, <span class="string"><span class="delimiter">&quot;</span><span class="content">jar</span><span class="delimiter">&quot;</span></span>)

        parameters {
            keepClassesByArtifact = keepPatterns
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="implementing_incremental_artifact_transforms"><a class="anchor" href="#implementing_incremental_artifact_transforms"></a><a class="link" href="#implementing_incremental_artifact_transforms">Implementing incremental artifact transforms</a></h4>
<div class="paragraph">
<p>Similar to <a href="#incremental_tasks">incremental tasks</a>, artifact transforms can avoid work by only processing changed files from the last execution.
This is done by using the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.work.InputChanges.html">InputChanges</a> interface.
For artifact transforms, only the input artifact is an incremental input, and therefore the transform can only query for changes there.
In order to use <a href="https://docs.gradle.org/8.9/dsl/org.gradle.work.InputChanges.html">InputChanges</a> in the transform action, inject it into the action.
For more information on how to use <a href="https://docs.gradle.org/8.9/dsl/org.gradle.work.InputChanges.html">InputChanges</a>, see the corresponding documentation for <a href="#incremental_tasks">incremental tasks</a>.</p>
</div>
<div class="paragraph">
<p>Here is an example of an incremental transform that counts the lines of code in Java source files:</p>
</div>
<div id="ex-artifact-transform-for-lines-of-code-counting" class="exampleblock">
<div class="title">Example 285. <a href="#ex-artifact-transform-for-lines-of-code-counting">Artifact transform for lines of code counting</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class CountLoc : TransformAction&lt;TransformParameters.None&gt; {

    @get:Inject                                                         // <b class="conum">(1)</b>
    abstract val inputChanges: InputChanges

    @get:PathSensitive(PathSensitivity.RELATIVE)
    @get:InputArtifact
    abstract val input: Provider&lt;FileSystemLocation&gt;

    override
    fun transform(outputs: TransformOutputs) {
        val outputDir = outputs.dir(&quot;${input.get().asFile.name}.loc&quot;)
        println(&quot;Running transform on ${input.get().asFile.name}, incremental: ${inputChanges.isIncremental}&quot;)
        inputChanges.getFileChanges(input).forEach { change -&gt;          // <b class="conum">(2)</b>
            val changedFile = change.file
            if (change.fileType != FileType.FILE) {
                return@forEach
            }
            val outputLocation = outputDir.resolve(&quot;${change.normalizedPath}.loc&quot;)
            when (change.changeType) {
                ChangeType.ADDED, ChangeType.MODIFIED -&gt; {

                    println(&quot;Processing file ${changedFile.name}&quot;)
                    outputLocation.parentFile.mkdirs()

                    outputLocation.writeText(changedFile.readLines().size.toString())
                }
                ChangeType.REMOVED -&gt; {
                    println(&quot;Removing leftover output file ${outputLocation.name}&quot;)
                    outputLocation.delete()
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">CountLoc</span> <span class="directive">implements</span> TransformAction&lt;TransformParameters.None&gt; {

    <span class="annotation">@Inject</span>                                                             // <b class="conum">(1)</b>
    <span class="directive">abstract</span> InputChanges getInputChanges()

    <span class="annotation">@PathSensitive</span>(PathSensitivity.RELATIVE)
    <span class="annotation">@InputArtifact</span>
    <span class="directive">abstract</span> <span class="predefined-type">Provider</span>&lt;FileSystemLocation&gt; getInput()

    <span class="annotation">@Override</span>
    <span class="type">void</span> transform(TransformOutputs outputs) {
        <span class="keyword">def</span> outputDir = outputs.dir(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>input.get().asFile.name<span class="inline-delimiter">}</span></span><span class="content">.loc</span><span class="delimiter">&quot;</span></span>)
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Running transform on </span><span class="inline"><span class="inline-delimiter">${</span>input.get().asFile.name<span class="inline-delimiter">}</span></span><span class="content">, incremental: </span><span class="inline"><span class="inline-delimiter">${</span>inputChanges.incremental<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
        inputChanges.getFileChanges(input).forEach { change -&gt;          // <b class="conum">(2)</b>
            <span class="keyword">def</span> changedFile = change.file
            <span class="keyword">if</span> (change.fileType != FileType.FILE) {
                <span class="keyword">return</span>
            }
            <span class="keyword">def</span> outputLocation = <span class="keyword">new</span> <span class="predefined-type">File</span>(outputDir, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>change.normalizedPath<span class="inline-delimiter">}</span></span><span class="content">.loc</span><span class="delimiter">&quot;</span></span>)
            <span class="keyword">switch</span> (change.changeType) {
                <span class="keyword">case</span> <span class="key">ADDED</span>:
                <span class="keyword">case</span> <span class="key">MODIFIED</span>:
                    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Processing file </span><span class="inline"><span class="inline-delimiter">${</span>changedFile.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
                    outputLocation.parentFile.mkdirs()

                    outputLocation.text = changedFile.readLines().size()

                <span class="keyword">case</span> <span class="key">REMOVED</span>:
                    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Removing leftover output file </span><span class="inline"><span class="inline-delimiter">${</span>outputLocation.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
                    outputLocation.delete()

            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Inject <code>InputChanges</code></p>
</li>
<li>
<p>Query for changes in the input artifact</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="publishing_libraries"><a class="anchor" href="#publishing_libraries"></a><a class="link" href="#publishing_libraries">PUBLISHING LIBRARIES</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="publishing_components"><a class="anchor" href="#publishing_components"></a><a class="link" href="#publishing_components">Publishing a project as module</a></h3>
<div id="publishing_overview" class="paragraph">
<p>The vast majority of software projects build something that aims to be consumed in some way.
It could be a library that other software projects use or it could be an application for end users.
<em>Publishing</em> is the process by which the thing being built is made available to consumers.</p>
</div>
<div class="paragraph">
<p>In Gradle, that process looks like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define <a href="#publishing_overview:what">what</a> to publish</p>
</li>
<li>
<p>Define <a href="#publishing_overview:where">where</a> to publish it to</p>
</li>
<li>
<p><a href="#publishing_overview:how">Do</a> the publishing</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Each of the these steps is dependent on the type of repository to which you want to publish artifacts.
The two most common types are Maven-compatible and Ivy-compatible repositories, or Maven and Ivy repositories for short.</p>
</div>
<div class="paragraph">
<p>As of Gradle 6.0, the <a href="#sec:understanding-gradle-module-md">Gradle Module Metadata</a> will always be published alongside the Ivy XML or Maven POM metadata file.</p>
</div>
<div class="paragraph">
<p>Gradle makes it easy to publish to these types of repository by providing some prepackaged infrastructure in the form of the <a href="#publishing_maven">Maven Publish Plugin</a> and the <a href="#publishing_ivy">Ivy Publish Plugin</a>.
These plugins allow you to configure what to publish and perform the publishing with a minimum of effort.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/publishing-process.png" alt="publishing process">
</div>
<div class="title">Figure 15. The publishing process</div>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at those steps in more detail:</p>
</div>
<div id="publishing_overview:what" class="dlist">
<dl>
<dt class="hdlist1">What to publish</dt>
<dd>
<p>Gradle needs to know what files and information to publish so that consumers can use your project.
This is typically a combination of <a href="#sub:terminology_artifact">artifacts</a> and metadata that Gradle calls a <a href="#sub:terminology_publication">publication</a>.
Exactly what a publication contains depends on the type of repository it&#8217;s being published to.</p>
<div class="paragraph">
<p>For example, a publication destined for a Maven repository includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more artifacts — typically built by the project,</p>
</li>
<li>
<p>The Gradle Module Metadata file which will describe the variants of the published component,</p>
</li>
<li>
<p>The Maven POM file will identify the primary artifact and its dependencies.
The primary artifact is typically the project&#8217;s production JAR and secondary artifacts might consist of "-sources" and "-javadoc" JARs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, Gradle will publish checksums for all of the above, and <a href="#publishing_maven:signing">signatures</a> when configured to do so.
From Gradle 6.0 onwards, this includes <code>SHA256</code> and <code>SHA512</code> checksums.</p>
</div>
</dd>
</dl>
</div>
<div id="publishing_overview:where" class="dlist">
<dl>
<dt class="hdlist1">Where to publish</dt>
<dd>
<p>Gradle needs to know where to publish artifacts so that consumers can get hold of them. This is done via <a href="#sub:terminology_repository">repositories</a>, which store and make available all sorts of artifact.
Gradle also needs to interact with the repository, which is why you must provide the type of the repository and its location.</p>
</dd>
</dl>
</div>
<div id="publishing_overview:how" class="dlist">
<dl>
<dt class="hdlist1">How to publish</dt>
<dd>
<p>Gradle automatically generates publishing tasks for all possible combinations of publication and repository, allowing you to publish any artifact to any repository. If you&#8217;re publishing to a Maven repository, the tasks are of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html">PublishToMavenRepository</a>, while for Ivy repositories the tasks are of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.tasks.PublishToIvyRepository.html">PublishToIvyRepository</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>What follows is a practical example that demonstrates the entire publishing process.</p>
</div>
<div class="sect3">
<h4 id="sec:basic_publishing"><a class="anchor" href="#sec:basic_publishing"></a><a class="link" href="#sec:basic_publishing">Setting up basic publishing</a></h4>
<div class="paragraph">
<p>The first step in publishing, irrespective of your project type, is to apply the appropriate publishing plugin. As mentioned in the introduction, Gradle supports both Maven and Ivy repositories via the following plugins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#publishing_maven">Maven Publish Plugin</a></p>
</li>
<li>
<p><a href="#publishing_ivy">Ivy Publish Plugin</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These provide the specific publication and repository classes needed to configure publishing for the corresponding repository type. Since Maven repositories are the most commonly used ones, they will be the basis for this example and for the other samples in the chapter. Don&#8217;t worry, we will explain how to adjust individual samples for Ivy repositories.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume we&#8217;re working with a simple Java library project, so only the following plugins are applied:</p>
</div>
<div id="ex-applying-the-necessary-plugins" class="exampleblock">
<div class="title">Example 286. <a href="#ex-applying-the-necessary-plugins">Applying the necessary plugins</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
    `maven-publish`
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once the appropriate plugin has been applied, you can configure the publications and repositories. For this example, we want to publish the project&#8217;s production JAR file — the one produced by the <code>jar</code> task — to a custom Maven repository. We do that with the following <code>publishing {}</code> block, which is backed by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.PublishingExtension.html">PublishingExtension</a>:</p>
</div>
<div id="ex-configuring-a-java-library-for-publishing" class="exampleblock">
<div class="title">Example 287. <a href="#ex-configuring-a-java-library-for-publishing">Configuring a Java library for publishing</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">group = &quot;org.example&quot;
version = &quot;1.0&quot;

publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;myLibrary&quot;) {
            from(components[&quot;java&quot;])
        }
    }

    repositories {
        maven {
            name = &quot;myRepo&quot;
            url = uri(layout.buildDirectory.dir(&quot;repo&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">group = <span class="string"><span class="delimiter">'</span><span class="content">org.example</span><span class="delimiter">'</span></span>
version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>

publishing {
    publications {
        myLibrary(MavenPublication) {
            from components.java
        }
    }

    repositories {
        maven {
            name = <span class="string"><span class="delimiter">'</span><span class="content">myRepo</span><span class="delimiter">'</span></span>
            url = layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">repo</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This defines a publication called "myLibrary" that can be published to a Maven repository by virtue of its type: <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.MavenPublication.html">MavenPublication</a>.
This publication consists of just the production JAR artifact and its metadata, which combined are represented by the <code>java</code> <a href="#sub:terminology_component">component</a> of the project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Components are the standard way of defining a publication. They are provided by plugins, usually of the language or platform variety. For example, the Java Plugin defines the <code>components.java</code> <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/component/SoftwareComponent.html">SoftwareComponent</a>, while the War Plugin defines <code>components.web</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example also defines a file-based Maven repository with the name "myRepo". Such a file-based repository is convenient for a sample, but real-world builds typically work with HTTPS-based repository servers, such as Maven Central or an internal company server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You may define one, and only one, repository without a name. This translates to an implicit name of "Maven" for Maven repositories and "Ivy" for Ivy repositories. All other repository definitions must be given an explicit name.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In combination with the project&#8217;s <code>group</code> and <code>version</code>, the publication and repository definitions provide everything that Gradle needs to publish the project&#8217;s production JAR. Gradle will then create a dedicated <code>publishMyLibraryPublicationToMyRepoRepository</code> task that does just that. Its name is based on the template <code>publish<em>PubName</em>PublicationTo<em>RepoName</em>Repository</code>. See the appropriate publishing plugin&#8217;s documentation for more details on the nature of this task and any other tasks that may be available to you.</p>
</div>
<div class="paragraph">
<p>You can either execute the individual publishing tasks directly, or you can execute <code>publish</code>, which will run all the available publishing tasks. In this example, <code>publish</code> will just run <code>publishMyLibraryPublicationToMavenRepository</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Basic publishing to an Ivy repository is very similar: you simply use the Ivy Publish Plugin, replace  <code>MavenPublication</code> with <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.IvyPublication.html">IvyPublication</a>, and use <code>ivy</code> instead of <code>maven</code> in the repository definition.</p>
</div>
<div class="paragraph">
<p>There are differences between the two types of repository, particularly around the extra metadata that each support — for example, Maven repositories require a POM file while Ivy ones have their own metadata format — so see the plugin chapters for comprehensive information on how to configure both publications and repositories for whichever repository type you&#8217;re working with.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>That&#8217;s everything for the basic use case. However, many projects need more control over what gets published, so we look at several common scenarios in the following sections.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:suppressing_validation_errors"><a class="anchor" href="#sec:suppressing_validation_errors"></a><a class="link" href="#sec:suppressing_validation_errors">Suppressing validation errors</a></h4>
<div class="paragraph">
<p>Gradle performs validation of generated module metadata.
In some cases, validation can fail, indicating that you most likely have an error to fix, but you may have done something intentionally.
If this is the case, Gradle will indicate the name of the validation error you can disable on the <code>GenerateModuleMetadata</code> tasks:</p>
</div>
<div id="ex-disabling-some-validation-errors" class="exampleblock">
<div class="title">Example 288. <a href="#ex-disabling-some-validation-errors">Disabling some validation errors</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;GenerateModuleMetadata&gt; {
    // The value 'enforced-platform' is provided in the validation
    // error message you got
    suppressedValidationErrors.add(&quot;enforced-platform&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(GenerateModuleMetadata).configureEach {
    <span class="comment">// The value 'enforced-platform' is provided in the validation</span>
    <span class="comment">// error message you got</span>
    suppressedValidationErrors.add(<span class="string"><span class="delimiter">'</span><span class="content">enforced-platform</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec:understanding-gradle-module-md"><a class="anchor" href="#sec:understanding-gradle-module-md"></a><a class="link" href="#sec:understanding-gradle-module-md">Understanding Gradle Module Metadata</a></h3>
<div class="paragraph">
<p>Gradle Module Metadata is a format used to serialize the Gradle component model.
It is similar to <a href="https://maven.apache.org/pom.html">Apache Maven™'s POM file</a> or <a href="https://ant.apache.org/ivy/">Apache Ivy™ ivy.xml</a> files.
The goal of metadata files is to provide <em>to consumers</em> a reasonable model of what is published on a repository.</p>
</div>
<div class="paragraph">
<p>Gradle Module Metadata is a unique format aimed at improving dependency resolution by making it multi-platform and variant-aware.</p>
</div>
<div class="paragraph">
<p>In particular, Gradle Module Metadata supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#rich-version-constraints">rich version constraints</a></p>
</li>
<li>
<p><a href="#sec:adding-constraints-transitive-deps">dependency constraints</a></p>
</li>
<li>
<p><a href="#declaring-component-capabilities">component capabilities</a></p>
</li>
<li>
<p><a href="#understanding-variant-selection">variant-aware resolution</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Publication of Gradle Module Metadata will enable better dependency management for your consumers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>early discovery of problems by detecting <a href="#declaring-component-capabilities">incompatible modules</a></p>
</li>
<li>
<p>consistent selection of <a href="#targeting-different-platforms">platform-specific dependencies</a></p>
</li>
<li>
<p>native <a href="#version_alignment">dependency version alignment</a></p>
</li>
<li>
<p>automatically getting dependencies for specific <a href="#feature_variants">features of your library</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle Module Metadata is automatically published when using the <a href="#publishing_maven">Maven Publish plugin</a> or the <a href="#publishing_ivy">Ivy Publish plugin</a>.</p>
</div>
<div class="paragraph">
<p>The specification for Gradle Module Metadata can be found <a href="https://github.com/gradle/gradle/blob/master/platforms/documentation/docs/src/docs/design/gradle-module-metadata-latest-specification.md">here</a>.</p>
</div>
<div class="sect3">
<h4 id="sub:mapping-with-other-formats"><a class="anchor" href="#sub:mapping-with-other-formats"></a><a class="link" href="#sub:mapping-with-other-formats">Mapping with other formats</a></h4>
<div class="paragraph">
<p>Gradle Module Metadata is automatically published on Maven or Ivy repositories.
However, it doesn&#8217;t replace the <em>pom.xml</em> or <em>ivy.xml</em> files: it is published alongside those files.
This is done to maximize compatibility with third-party build tools.</p>
</div>
<div class="paragraph">
<p>Gradle does its best to map Gradle-specific concepts to Maven or Ivy.
When a build file uses features that can only be represented in Gradle Module Metadata, Gradle will warn you at publication time.
The table below summarizes how some Gradle specific features are mapped to Maven and Ivy:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. Mapping of Gradle specific concepts to Maven and Ivy</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Gradle</th>
<th class="tableblock halign-left valign-top">Maven</th>
<th class="tableblock halign-left valign-top">Ivy</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:adding-constraints-transitive-deps">dependency constraints</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;dependencyManagement&gt;</code> dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not published</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gradle dependency constraints are <em>transitive</em>, while Maven&#8217;s dependency management block <em>isn&#8217;t</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#rich-version-constraints">rich version constraints</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Publishes the <em>requires</em> version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published the <em>requires</em> version</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#declaring-component-capabilities">component capabilities</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not published</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not published</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component capabilities are unique to Gradle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#feature_variants">Feature variants</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variant artifacts are uploaded, dependencies are published as <em>optional</em> dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variant artifacts are uploaded, dependencies are not published</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feature variants are a good replacement for optional dependencies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:publishing-custom-components">Custom component types</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Artifacts are uploaded, dependencies are those described by the mapping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Artifacts are uploaded, dependencies are ignored</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom component types are probably not consumable from Maven or Ivy in any case. They usually exist in the context of a custom ecosystem.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="disabling_metadata_compatibility_publication_warnings"><a class="anchor" href="#disabling_metadata_compatibility_publication_warnings"></a><a class="link" href="#disabling_metadata_compatibility_publication_warnings">Disabling metadata compatibility publication warnings</a></h5>
<div class="paragraph">
<p>If you want to suppress warnings, you can use the following APIs to do so:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Maven, see the <code>suppress*</code> methods in <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.MavenPublication.html#org.gradle.api.publish.maven.MavenPublication:suppressAllPomMetadataWarnings()">MavenPublication</a></p>
</li>
<li>
<p>For Ivy, see the <code>suppress*</code> methods in <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.IvyPublication.html#org.gradle.api.publish.ivy.IvyPublication:suppressAllIvyMetadataWarnings()">IvyPublication</a></p>
</li>
</ul>
</div>
<div id="ex-disabling-publication-warnings" class="exampleblock">
<div class="title">Example 289. <a href="#ex-disabling-publication-warnings">Disabling publication warnings</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publications {
    register&lt;MavenPublication&gt;(&quot;maven&quot;) {
        from(components[&quot;java&quot;])
        suppressPomMetadataWarningsFor(&quot;runtimeElements&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publications {
    maven(MavenPublication) {
        from components.java
        suppressPomMetadataWarningsFor(<span class="string"><span class="delimiter">'</span><span class="content">runtimeElements</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sub:interactions-other-build-tools"><a class="anchor" href="#sub:interactions-other-build-tools"></a><a class="link" href="#sub:interactions-other-build-tools">Interactions with other build tools</a></h4>
<div class="paragraph">
<p>Because Gradle Module Metadata is not widely spread and because it aims at <a href="#sub:mapping-with-other-formats">maximizing compatibility with other tools</a>, Gradle does a couple of things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle Module Metadata is systematically published alongside the normal descriptor for a given repository (Maven or Ivy)</p>
</li>
<li>
<p>the <code>pom.xml</code> or <code>ivy.xml</code> file will contain a <em>marker comment</em> which tells Gradle that Gradle Module Metadata exists for this module</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The goal of the marker is <em>not</em> for other tools to parse module metadata: it&#8217;s for Gradle users only.
It explains to Gradle that a <em>better</em> module metadata file exists and that it should use it instead.
It doesn&#8217;t mean that consumption from Maven or Ivy would be broken either, only that it works in <a href="#sub:mapping-with-other-formats">degraded mode</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This must be seen as a <em>performance optimization</em>: instead of having to do 2 network requests, one to get Gradle Module Metadata, then one to get the POM/Ivy file in case of a miss, Gradle will first look at the file which is most likely to be present, then only perform a 2nd request if the module was actually published with Gradle Module Metadata.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you know that the modules you depend on are always published with Gradle Module Metadata, you can optimize the network calls by configuring the metadata sources for a repository:</p>
</div>
<div id="ex-resolving-gradle-module-metadata-only" class="exampleblock">
<div class="title">Example 290. <a href="#ex-resolving-gradle-module-metadata-only">Resolving Gradle Module Metadata only</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        setUrl(&quot;http://repo.mycompany.com/repo&quot;)
        metadataSources {
            gradleMetadata()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        metadataSources {
            gradleMetadata()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sub:gmm-validation"><a class="anchor" href="#sub:gmm-validation"></a><a class="link" href="#sub:gmm-validation">Gradle Module Metadata validation</a></h4>
<div class="paragraph">
<p>Gradle Module Metadata is validated before being published.</p>
</div>
<div class="paragraph">
<p>The following rules are enforced:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Variant names must be unique,</p>
</li>
<li>
<p>Each variant must have at least <a href="#variant_attributes">one attribute</a>,</p>
</li>
<li>
<p>Two variants cannot have the <a href="#understanding-variant-selection">exact same attributes and capabilities</a>,</p>
</li>
<li>
<p>If there are dependencies, at least one, across all variants, must carry <a href="#rich-version-constraints">version information</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These rules ensure the quality of the metadata produced, and help confirm that consumption will not be problematic.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:gmm-reproducible"><a class="anchor" href="#sub:gmm-reproducible"></a><a class="link" href="#sub:gmm-reproducible">Gradle Module Metadata reproducibility</a></h4>
<div class="paragraph">
<p>The task generating the module metadata files is currently never marked <code>UP-TO-DATE</code> by Gradle due to the way it is implemented.
However, if neither build inputs nor build scripts changed, the task result is effectively up-to-date: it always produces the same output.</p>
</div>
<div class="paragraph">
<p>If users desire to have a unique <code>module</code> file per build invocation, it is possible to link an identifier in the produced metadata to the build that created it.
Users can choose to enable this unique identifier in their <code>publication</code>:</p>
</div>
<div id="ex-configuring-the-build-identifier-of-a-publication" class="exampleblock">
<div class="title">Example 291. <a href="#ex-configuring-the-build-identifier-of-a-publication">Configuring the build identifier of a publication</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;myLibrary&quot;) {
            from(components[&quot;java&quot;])
            withBuildIdentifier()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        myLibrary(MavenPublication) {
            from components.java
            withBuildIdentifier()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the changes above, the generated Gradle Module Metadata file will always be different, forcing downstream tasks to consider it out-of-date.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:disabling-gmm-publication"><a class="anchor" href="#sub:disabling-gmm-publication"></a><a class="link" href="#sub:disabling-gmm-publication">Disabling Gradle Module Metadata publication</a></h4>
<div class="paragraph">
<p>There are situations where you might want to disable publication of Gradle Module Metadata:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the repository you are uploading to rejects the metadata file (unknown format)</p>
</li>
<li>
<p>you are using Maven or Ivy specific concepts which are not properly mapped to Gradle Module Metadata</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this case, disabling the publication of Gradle Module Metadata is done simply by disabling the task which generates the metadata file:</p>
</div>
<div id="ex-disabling-publication-of-gradle-module-metadata" class="exampleblock">
<div class="title">Example 292. <a href="#ex-disabling-publication-of-gradle-module-metadata">Disabling publication of Gradle Module Metadata</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;GenerateModuleMetadata&gt; {
    enabled = false
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(GenerateModuleMetadata) {
    enabled = <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="publishing_maven:signing"><a class="anchor" href="#publishing_maven:signing"></a><a class="link" href="#publishing_maven:signing">Signing artifacts</a></h3>
<div class="paragraph">
<p>The <a href="signing_plugin.html#signing_plugin">Signing Plugin</a> can be used to sign all artifacts and metadata files that make up a publication, including Maven POM files and Ivy module descriptors. In order to use it:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Apply the Signing Plugin</p>
</li>
<li>
<p>Configure the <a href="signing_plugin.html#sec:signatory_credentials">signatory credentials</a> — follow the link to see how</p>
</li>
<li>
<p>Specify the publications you want signed</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here&#8217;s an example that configures the plugin to sign the <code>mavenJava</code> publication:</p>
</div>
<div id="ex-signing-a-publication" class="exampleblock">
<div class="title">Example 293. <a href="#ex-signing-a-publication">Signing a publication</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">signing {
    sign(publishing.publications[&quot;mavenJava&quot;])
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">signing {
    sign publishing.publications.mavenJava
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will create a <code>Sign</code> task for each publication you specify and wire all <code>publish<em>PubName</em>PublicationTo<em>RepoName</em>Repository</code> tasks to depend on it. Thus, publishing any publication will automatically create and publish the signatures for its artifacts and metadata, as you can see from this output:</p>
</div>
<div class="sect3">
<h4 id="example_sign_and_publish_a_project"><a class="anchor" href="#example_sign_and_publish_a_project"></a><a class="link" href="#example_sign_and_publish_a_project">Example: Sign and publish a project</a></h4>
<div class="listingblock">
<div class="title">Output of <code>gradle publish</code></div>
<div class="content">
<pre>&gt; gradle publish
&gt; Task :compileJava
&gt; Task :processResources
&gt; Task :classes
&gt; Task :jar
&gt; Task :javadoc
&gt; Task :javadocJar
&gt; Task :sourcesJar
&gt; Task :generateMetadataFileForMavenJavaPublication
&gt; Task :generatePomFileForMavenJavaPublication
&gt; Task :signMavenJavaPublication
&gt; Task :publishMavenJavaPublicationToMavenRepository
&gt; Task :publish

BUILD SUCCESSFUL in 0s
10 actionable tasks: 10 executed</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customizing_publishing"><a class="anchor" href="#customizing_publishing"></a><a class="link" href="#customizing_publishing">Customizing publishing</a></h3>
<div class="sect3">
<h4 id="sec:adding-variants-to-existing-components"><a class="anchor" href="#sec:adding-variants-to-existing-components"></a><a class="link" href="#sec:adding-variants-to-existing-components">Modifying and adding variants to existing components for publishing</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s publication model is based on the notion of <em>components</em>, which are defined by plugins.
For example, the Java Library plugin defines a <code>java</code> component which corresponds to a library, but the Java Platform plugin defines another kind of component, named <code>javaPlatform</code>, which is effectively a different kind of software component (a <em>platform</em>).</p>
</div>
<div class="paragraph">
<p>Sometimes we want to add <em>more variants</em> to or modify <em>existing variants</em> of an existing component.
For example, if you <a href="#targeting-different-platforms">added a variant of a Java library for a different platform</a>, you may just want to declare this additional variant on the <code>java</code> component itself.
In general, declaring additional variants is often the best solution to publish <em>additional artifacts</em>.</p>
</div>
<div class="paragraph">
<p>To perform such additions or modifications, the <code>AdhocComponentWithVariants</code> interface declares two methods called <code>addVariantsFromConfiguration</code> and <code>withVariantsFromConfiguration</code> which accept two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <a href="#sec:resolvable-consumable-configs">outgoing configuration</a> that is used as a variant source</p>
</li>
<li>
<p>a customization action which allows you to <em>filter</em> which variants are going to be published</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To utilise these methods, you must make sure that the <code>SoftwareComponent</code> you work with is itself an <code>AdhocComponentWithVariants</code>, which is the case for the components created by the Java plugins (Java, Java Library, Java Platform).
Adding a variant is then very simple:</p>
</div>
<div id="ex-adding-a-variant-to-an-existing-software-component" class="exampleblock">
<div class="title">Example 294. <a href="#ex-adding-a-variant-to-an-existing-software-component">Adding a variant to an existing software component</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">InstrumentedJarsPlugin.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val javaComponent = components.findByName(&quot;java&quot;) as AdhocComponentWithVariants
javaComponent.addVariantsFromConfiguration(outgoing) {
    // dependencies for this variant are considered runtime dependencies
    mapToMavenScope(&quot;runtime&quot;)
    // and also optional dependencies, because we don't want them to leak
    mapToOptional()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">InstrumentedJarsPlugin.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">AdhocComponentWithVariants javaComponent = (AdhocComponentWithVariants) project.components.findByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">java</span><span class="delimiter">&quot;</span></span>)
javaComponent.addVariantsFromConfiguration(outgoing) {
    <span class="comment">// dependencies for this variant are considered runtime dependencies</span>
    <span class="local-variable">it</span>.mapToMavenScope(<span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>)
    <span class="comment">// and also optional dependencies, because we don't want them to leak</span>
    <span class="local-variable">it</span>.mapToOptional()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In other cases, you might want to modify a variant that was added by one of the Java plugins already.
For example, if you activate publishing of Javadoc and sources, these become additional variants of the <code>java</code> component.
If you only want to publish one of them, e.g. only Javadoc but no sources, you can modify the <code>sources</code> variant to not being published:</p>
</div>
<div id="ex-publish-a-java-library-with-javadoc-but-without-sources" class="exampleblock">
<div class="title">Example 295. <a href="#ex-publish-a-java-library-with-javadoc-but-without-sources">Publish a java library with Javadoc but without sources</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    withJavadocJar()
    withSourcesJar()
}

val javaComponent = components[&quot;java&quot;] as AdhocComponentWithVariants
javaComponent.withVariantsFromConfiguration(configurations[&quot;sourcesElements&quot;]) {
    skip()
}

publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
            from(components[&quot;java&quot;])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    withJavadocJar()
    withSourcesJar()
}

components.java.withVariantsFromConfiguration(configurations.sourcesElements) {
    skip()
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:publishing-custom-components"><a class="anchor" href="#sec:publishing-custom-components"></a><a class="link" href="#sec:publishing-custom-components">Creating and publishing custom components</a></h4>
<div class="paragraph">
<p>In the <a href="#sec:adding-variants-to-existing-components">previous example</a>, we have demonstrated how to extend or modify an existing component, like the components provided by the Java plugins.
But Gradle also allows you to build a custom component (not a Java Library, not a Java Platform, not something supported natively by Gradle).</p>
</div>
<div class="paragraph">
<p>To create a custom component, you first need to create an empty <em>adhoc</em> component.
At the moment, this is only possible via a plugin because you need to get a handle on the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/component/SoftwareComponentFactory.html">SoftwareComponentFactory</a> :</p>
</div>
<div id="ex-injecting-the-software-component-factory" class="exampleblock">
<div class="title">Example 296. <a href="#ex-injecting-the-software-component-factory">Injecting the software component factory</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">InstrumentedJarsPlugin.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">class InstrumentedJarsPlugin @Inject constructor(
    private val softwareComponentFactory: SoftwareComponentFactory) : Plugin&lt;Project&gt; {</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">InstrumentedJarsPlugin.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">private</span> <span class="directive">final</span> SoftwareComponentFactory softwareComponentFactory

<span class="annotation">@Inject</span>
InstrumentedJarsPlugin(SoftwareComponentFactory softwareComponentFactory) {
    <span class="local-variable">this</span>.softwareComponentFactory = softwareComponentFactory
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Declaring <em>what</em> a custom component publishes is still done via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/component/AdhocComponentWithVariants.html">AdhocComponentWithVariants</a> API.
For a custom component, the first step is to create custom outgoing variants, following the instructions in <a href="#sec:variant-aware-sharing">this chapter</a>.
At this stage, what you should have is variants which can be used in cross-project dependencies, but that we are now going to publish to external repositories.</p>
</div>
<div id="ex-creating-a-custom-adhoc-component" class="exampleblock">
<div class="title">Example 297. <a href="#ex-creating-a-custom-adhoc-component">Creating a custom, adhoc component</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">InstrumentedJarsPlugin.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// create an adhoc component
val adhocComponent = softwareComponentFactory.adhoc(&quot;myAdhocComponent&quot;)
// add it to the list of components that this project declares
components.add(adhocComponent)
// and register a variant for publication
adhocComponent.addVariantsFromConfiguration(outgoing) {
    mapToMavenScope(&quot;runtime&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">InstrumentedJarsPlugin.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// create an adhoc component</span>
<span class="keyword">def</span> adhocComponent = softwareComponentFactory.adhoc(<span class="string"><span class="delimiter">&quot;</span><span class="content">myAdhocComponent</span><span class="delimiter">&quot;</span></span>)
<span class="comment">// add it to the list of components that this project declares</span>
project.components.add(adhocComponent)
<span class="comment">// and register a variant for publication</span>
adhocComponent.addVariantsFromConfiguration(outgoing) {
    <span class="local-variable">it</span>.mapToMavenScope(<span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>First we use the factory to create a new adhoc component.
Then we add a variant through the <code>addVariantsFromConfiguration</code> method, which is described in more detail in the <a href="#sec:adding-variants-to-existing-components">previous section</a>.</p>
</div>
<div class="paragraph">
<p>In simple cases, there&#8217;s a one-to-one mapping between a <code>Configuration</code> and a variant, in which case you can publish all variants issued from a single <code>Configuration</code> because they are effectively the same thing.
However, there are cases where a <code>Configuration</code> is associated with additional <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/ConfigurationPublications.html">configuration publications</a> that we also call <em>secondary variants</em>.
Such configurations make sense in the <a href="#cross_project_publications">cross-project publications</a> use case, but not when publishing externally.
This is for example the case when between projects you share a <em>directory of files</em>, but there&#8217;s no way you can publish a <em>directory</em> directly on a Maven repository (only packaged things like jars or zips).
Look at the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/component/ConfigurationVariantDetails.html">ConfigurationVariantDetails</a> class for details about how to skip publication of a particular variant.
If <code>addVariantsFromConfiguration</code> has already been called for a configuration, further modification of the resulting variants can be performed using <code>withVariantsFromConfiguration</code>.</p>
</div>
<div class="paragraph">
<p>When publishing an adhoc component like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle Module Metadata will <em>exactly</em> represent the published variants. In particular, all outgoing variants will inherit dependencies, artifacts and attributes of the published configuration.</p>
</li>
<li>
<p>Maven and Ivy metadata files will be generated, but you need to declare how the dependencies are mapped to Maven scopes via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/component/ConfigurationVariantDetails.html">ConfigurationVariantDetails</a> class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In practice, it means that components created this way can be consumed by Gradle the same way as if they were "local components".</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:publishing_custom_artifacts_to_maven"><a class="anchor" href="#sec:publishing_custom_artifacts_to_maven"></a><a class="link" href="#sec:publishing_custom_artifacts_to_maven">Adding custom artifacts to a publication</a></h4>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Instead of thinking in terms of artifacts, you should embrace the variant aware model of Gradle.
It is expected that a single module may need multiple artifacts.
However this rarely stops there, if the additional artifacts represent an <a href="#feature_variants">optional feature</a>, they might also have different dependencies and more.</p>
</div>
<div class="paragraph">
<p>Gradle, via <em>Gradle Module Metadata</em>, supports the publication of <em>additional variants</em> which make those artifacts known to the dependency resolution engine.
Please refer to the <a href="#sec:variant-aware-sharing">variant-aware sharing</a> section of the documentation to see how to declare such variants and <a href="#sec:publishing-custom-components">check out how to publish custom components</a>.</p>
</div>
<div class="paragraph">
<p>If you attach extra artifacts to a publication directly, they are published "out of context".
That means, they are not referenced in the metadata at all and can then only be addressed directly through a classifier on a dependency.
In contrast to Gradle Module Metadata, Maven pom metadata will not contain information on additional artifacts regardless of whether they are added through a variant or directly, as variants cannot be represented in the pom format.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The following section describes how you publish artifacts directly if you are sure that metadata, for example Gradle or POM metadata, is irrelevant for your use case.
For example, if your project doesn&#8217;t need to be consumed by other projects and the only thing required as result of the publishing are the artifacts themselves.</p>
</div>
<div class="paragraph">
<p>In general, there are two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a publication only with artifacts</p>
</li>
<li>
<p>Add artifacts to a publication based on a component with metadata (not recommended, instead <a href="#sec:adding-variants-to-existing-components">adjust a component</a> or use a <a href="#sec:publishing-custom-components">adhoc component publication</a> which will both also produce metadata fitting your artifacts)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create a publication based on artifacts, start by defining a custom artifact and attaching it to a Gradle <a href="#sub:terminology_configuration">configuration</a> of your choice.
The following sample defines an RPM artifact that is produced by an <code>rpm</code> task (not shown) and attaches that artifact to the <code>conf</code> configuration:</p>
</div>
<div id="ex-defining-a-custom-artifact-for-a-configuration" class="exampleblock">
<div class="title">Example 298. <a href="#ex-defining-a-custom-artifact-for-a-configuration">Defining a custom artifact for a configuration</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;conf&quot;)
}
val rpmFile = layout.buildDirectory.file(&quot;rpms/my-package.rpm&quot;)
val rpmArtifact = artifacts.add(&quot;conf&quot;, rpmFile.get().asFile) {
    type = &quot;rpm&quot;
    builtBy(&quot;rpm&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    conf
}
<span class="keyword">def</span> rpmFile = layout.buildDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">rpms/my-package.rpm</span><span class="delimiter">'</span></span>)
<span class="keyword">def</span> rpmArtifact = artifacts.add(<span class="string"><span class="delimiter">'</span><span class="content">conf</span><span class="delimiter">'</span></span>, rpmFile.get().asFile) {
    type <span class="string"><span class="delimiter">'</span><span class="content">rpm</span><span class="delimiter">'</span></span>
    builtBy <span class="string"><span class="delimiter">'</span><span class="content">rpm</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>artifacts.add()</code> method — from <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.dsl.ArtifactHandler.html">ArtifactHandler</a> — returns an artifact object of type <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/PublishArtifact.html">PublishArtifact</a> that can then be used in defining a publication, as shown in the following sample:</p>
</div>
<div id="ex-attaching-a-custom-publishartifact-to-a-publication" class="exampleblock">
<div class="title">Example 299. <a href="#ex-attaching-a-custom-publishartifact-to-a-publication">Attaching a custom PublishArtifact to a publication</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;maven&quot;) {
            artifact(rpmArtifact)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        maven(MavenPublication) {
            artifact rpmArtifact
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>artifact()</code> method accepts <em>publish artifacts</em> as argument — like <code>rpmArtifact</code> in the sample — as well as any type of argument accepted by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a>, such as a <code>File</code> instance, a string file path or a archive task.</p>
</li>
<li>
<p>Publishing plugins support different artifact configuration properties, so always check the plugin documentation for more details. The <code>classifier</code> and <code>extension</code> properties are supported by both the <a href="#publishing_maven">Maven Publish Plugin</a> and the <a href="#publishing_ivy">Ivy Publish Plugin</a>.</p>
</li>
<li>
<p>Custom artifacts need to be distinct within a publication, typically via a unique combination of <code>classifier</code> and <code>extension</code>. See the documentation for the plugin you&#8217;re using for the precise requirements.</p>
</li>
<li>
<p>If you use <code>artifact()</code> with an archive task, Gradle automatically populates the artifact&#8217;s metadata with the <code>classifier</code> and <code>extension</code> properties from that task.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now you can publish the RPM.</p>
</div>
<div class="paragraph">
<p>If you really want to add an artifact to a publication based on a component, instead of <a href="#sec:adding-variants-to-existing-components">adjusting the component</a> itself, you can combine the <code>from components.someComponent</code> and <code>artifact someArtifact</code> notations.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:publishing_maven:conditional_publishing"><a class="anchor" href="#sec:publishing_maven:conditional_publishing"></a><a class="link" href="#sec:publishing_maven:conditional_publishing">Restricting publications to specific repositories</a></h4>
<div class="paragraph">
<p>When you have defined multiple publications or repositories, you often want to control which publications are published to which repositories. For instance, consider the following sample that defines two publications — one that consists of just a binary and another that contains the binary and associated sources — and two repositories — one for internal use and one for external consumers:</p>
</div>
<div id="ex-adding-multiple-publications-and-repositories" class="exampleblock">
<div class="title">Example 300. <a href="#ex-adding-multiple-publications-and-repositories">Adding multiple publications and repositories</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;binary&quot;) {
            from(components[&quot;java&quot;])
        }
        create&lt;MavenPublication&gt;(&quot;binaryAndSources&quot;) {
            from(components[&quot;java&quot;])
            artifact(tasks[&quot;sourcesJar&quot;])
        }
    }
    repositories {
        // change URLs to point to your repos, e.g. http://my.org/repo
        maven {
            name = &quot;external&quot;
            url = uri(layout.buildDirectory.dir(&quot;repos/external&quot;))
        }
        maven {
            name = &quot;internal&quot;
            url = uri(layout.buildDirectory.dir(&quot;repos/internal&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        binary(MavenPublication) {
            from components.java
        }
        binaryAndSources(MavenPublication) {
            from components.java
            artifact sourcesJar
        }
    }
    repositories {
        <span class="comment">// change URLs to point to your repos, e.g. http://my.org/repo</span>
        maven {
            name = <span class="string"><span class="delimiter">'</span><span class="content">external</span><span class="delimiter">'</span></span>
            url = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">repos/external</span><span class="delimiter">'</span></span>)
        }
        maven {
            name = <span class="string"><span class="delimiter">'</span><span class="content">internal</span><span class="delimiter">'</span></span>
            url = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">repos/internal</span><span class="delimiter">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The publishing plugins will create tasks that allow you to publish either of the publications to either repository. They also attach those tasks to the <code>publish</code> aggregate task. But let&#8217;s say you want to restrict the binary-only publication to the external repository and the binary-with-sources publication to the internal one. To do that, you need to make the publishing <em>conditional</em>.</p>
</div>
<div class="paragraph">
<p>Gradle allows you to skip any task you want based on a condition via the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Task.html#org.gradle.api.Task:onlyIf(java.lang.String,org.gradle.api.specs.Spec)">Task.onlyIf(String, org.gradle.api.specs.Spec)</a> method. The following sample demonstrates how to implement the constraints we just mentioned:</p>
</div>
<div id="ex-configuring-which-artifacts-should-be-published-to-which-repositories" class="exampleblock">
<div class="title">Example 301. <a href="#ex-configuring-which-artifacts-should-be-published-to-which-repositories">Configuring which artifacts should be published to which repositories</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;PublishToMavenRepository&gt;().configureEach {
    val predicate = provider {
        (repository == publishing.repositories[&quot;external&quot;] &amp;&amp;
            publication == publishing.publications[&quot;binary&quot;]) ||
        (repository == publishing.repositories[&quot;internal&quot;] &amp;&amp;
            publication == publishing.publications[&quot;binaryAndSources&quot;])
    }
    onlyIf(&quot;publishing binary to the external repository, or binary and sources to the internal one&quot;) {
        predicate.get()
    }
}
tasks.withType&lt;PublishToMavenLocal&gt;().configureEach {
    val predicate = provider {
        publication == publishing.publications[&quot;binaryAndSources&quot;]
    }
    onlyIf(&quot;publishing binary and sources&quot;) {
        predicate.get()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(PublishToMavenRepository) {
    <span class="keyword">def</span> predicate = provider {
        (repository == publishing.repositories.external &amp;&amp;
            publication == publishing.publications.binary) ||
        (repository == publishing.repositories.internal &amp;&amp;
            publication == publishing.publications.binaryAndSources)
    }
    onlyIf(<span class="string"><span class="delimiter">&quot;</span><span class="content">publishing binary to the external repository, or binary and sources to the internal one</span><span class="delimiter">&quot;</span></span>) {
        predicate.get()
    }
}
tasks.withType(PublishToMavenLocal) {
    <span class="keyword">def</span> predicate = provider {
        publication == publishing.publications.binaryAndSources
    }
    onlyIf(<span class="string"><span class="delimiter">&quot;</span><span class="content">publishing binary and sources</span><span class="delimiter">&quot;</span></span>) {
        predicate.get()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle publish</code></div>
<div class="content">
<pre>&gt; gradle publish
&gt; Task :compileJava
&gt; Task :processResources
&gt; Task :classes
&gt; Task :jar
&gt; Task :generateMetadataFileForBinaryAndSourcesPublication
&gt; Task :generatePomFileForBinaryAndSourcesPublication
&gt; Task :sourcesJar
&gt; Task :publishBinaryAndSourcesPublicationToExternalRepository SKIPPED
&gt; Task :publishBinaryAndSourcesPublicationToInternalRepository
&gt; Task :generateMetadataFileForBinaryPublication
&gt; Task :generatePomFileForBinaryPublication
&gt; Task :publishBinaryPublicationToExternalRepository
&gt; Task :publishBinaryPublicationToInternalRepository SKIPPED
&gt; Task :publish

BUILD SUCCESSFUL in 0s
10 actionable tasks: 10 executed</pre>
</div>
</div>
<div class="paragraph">
<p>You may also want to define your own aggregate tasks to help with your workflow. For example, imagine that you have several publications that should be published to the external repository. It could be very useful to publish all of them in one go without publishing the internal ones.</p>
</div>
<div class="paragraph">
<p>The following sample demonstrates how you can do this by defining an aggregate task — <code>publishToExternalRepository</code> — that depends on all the relevant publish tasks:</p>
</div>
<div id="ex-defining-your-own-shorthand-tasks-for-publishing" class="exampleblock">
<div class="title">Example 302. <a href="#ex-defining-your-own-shorthand-tasks-for-publishing">Defining your own shorthand tasks for publishing</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;publishToExternalRepository&quot;) {
    group = &quot;publishing&quot;
    description = &quot;Publishes all Maven publications to the external Maven repository.&quot;
    dependsOn(tasks.withType&lt;PublishToMavenRepository&gt;().matching {
        it.repository == publishing.repositories[&quot;external&quot;]
    })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">publishToExternalRepository</span><span class="delimiter">'</span></span>) {
    group = <span class="string"><span class="delimiter">'</span><span class="content">publishing</span><span class="delimiter">'</span></span>
    description = <span class="string"><span class="delimiter">'</span><span class="content">Publishes all Maven publications to the external Maven repository.</span><span class="delimiter">'</span></span>
    dependsOn tasks.withType(PublishToMavenRepository).matching {
        <span class="local-variable">it</span>.repository == publishing.repositories.external
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This particular sample automatically handles the introduction or removal of the relevant publishing tasks by using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskCollection.html#withType-java.lang.Class-">TaskCollection.withType(java.lang.Class)</a> with the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html">PublishToMavenRepository</a> task type. You can do the same with <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.tasks.PublishToIvyRepository.html">PublishToIvyRepository</a> if you&#8217;re publishing to Ivy-compatible repositories.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuring_publishing_tasks"><a class="anchor" href="#sec:configuring_publishing_tasks"></a><a class="link" href="#sec:configuring_publishing_tasks">Configuring publishing tasks</a></h4>
<div class="paragraph">
<p>The publishing plugins create their non-aggregate tasks after the project has been evaluated, which means you cannot directly reference them from your build script. If you would like to configure any of these tasks, you should use deferred task configuration. This can be done in a number of ways via the project&#8217;s <code>tasks</code> collection.</p>
</div>
<div class="paragraph">
<p>For example, imagine you want to change where the <code>generatePomFileFor<em>PubName</em>Publication</code> tasks write their POM files. You can do this by using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskCollection.html#withType-java.lang.Class-">TaskCollection.withType(java.lang.Class)</a> method, as demonstrated by this sample:</p>
</div>
<div id="ex-configuring-a-dynamically-named-task-created-by-the-publishing-plugins" class="exampleblock">
<div class="title">Example 303. <a href="#ex-configuring-a-dynamically-named-task-created-by-the-publishing-plugins">Configuring a dynamically named task created by the publishing plugins</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;GenerateMavenPom&gt;().configureEach {
    val matcher = Regex(&quot;&quot;&quot;generatePomFileFor(\w+)Publication&quot;&quot;&quot;).matchEntire(name)
    val publicationName = matcher?.let { it.groupValues[1] }
    destination = layout.buildDirectory.file(&quot;poms/${publicationName}-pom.xml&quot;).get().asFile
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(GenerateMavenPom).all {
    <span class="keyword">def</span> matcher = name =~ <span class="regexp"><span class="delimiter">/</span><span class="content">generatePomFileFor(</span><span class="char">\w</span><span class="content">+)Publication</span><span class="delimiter">/</span></span>
    <span class="keyword">def</span> publicationName = matcher[<span class="integer">0</span>][<span class="integer">1</span>]
    destination = layout.buildDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">poms/</span><span class="inline"><span class="inline-delimiter">${</span>publicationName<span class="inline-delimiter">}</span></span><span class="content">-pom.xml</span><span class="delimiter">&quot;</span></span>).get().asFile
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above sample uses a regular expression to extract the name of the publication from the name of the task. This is so that there is no conflict between the file paths of all the POM files that might be generated. If you only have one publication, then you don&#8217;t have to worry about such conflicts since there will only be one POM file.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="publishing_maven"><a class="anchor" href="#publishing_maven"></a><a class="link" href="#publishing_maven">The Maven Publish Plugin</a></h3>
<div class="paragraph">
<p>The Maven Publish Plugin provides the ability to publish build artifacts to an <a href="https://maven.apache.org/">Apache Maven</a> repository.
A module published to a Maven repository can be consumed by Maven, Gradle (see <a href="#declaring-dependencies">Declaring Dependencies</a>) and other tools that understand the Maven repository format.
You can learn about the fundamentals of publishing in <a href="#publishing_overview">Publishing Overview</a>.</p>
</div>
<div class="sect3">
<h4 id="publishing_maven:usage"><a class="anchor" href="#publishing_maven:usage"></a><a class="link" href="#publishing_maven:usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Maven Publish Plugin, include the following in your build script:</p>
</div>
<div id="ex-applying-the-maven-publish-plugin" class="exampleblock">
<div class="title">Example 304. <a href="#ex-applying-the-maven-publish-plugin">Applying the Maven Publish Plugin</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `maven-publish`
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Maven Publish Plugin uses an extension on the project named <code>publishing</code> of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.PublishingExtension.html">PublishingExtension</a>. This extension provides a container of named publications and a container of named repositories. The Maven Publish Plugin works with <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.MavenPublication.html">MavenPublication</a> publications and <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html">MavenArtifactRepository</a> repositories.</p>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:tasks"><a class="anchor" href="#publishing_maven:tasks"></a><a class="link" href="#publishing_maven:tasks">Tasks</a></h4>
<div id="publishing_maven:generate-pom" class="dlist">
<dl>
<dt class="hdlist1"><code>generatePomFileFor<em>PubName</em>Publication</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.tasks.GenerateMavenPom.html">GenerateMavenPom</a></dt>
<dd>
<p>Creates a POM file for the publication named <em>PubName</em>, populating the known metadata such as project name, project version, and the dependencies. The default location for the POM file is <em>build/publications/$pubName/pom-default.xml</em>.</p>
</dd>
<dt class="hdlist1"><code>publish<em>PubName</em>PublicationTo<em>RepoName</em>Repository</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html">PublishToMavenRepository</a></dt>
<dd>
<p>Publishes the <em>PubName</em> publication to the repository named <em>RepoName</em>. If you have a repository definition without an explicit name, <em>RepoName</em> will be "Maven".</p>
</dd>
<dt class="hdlist1"><code>publish<em>PubName</em>PublicationToMavenLocal</code> — <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/publish/maven/tasks/PublishToMavenLocal.html">PublishToMavenLocal</a></dt>
<dd>
<p>Copies the <em>PubName</em> publication to the local Maven cache — typically <em>&lt;home directory of the current user&gt;/.m2/repository</em> — along with the publication&#8217;s POM file and other metadata.</p>
</dd>
<dt class="hdlist1"><code>publish</code></dt>
<dd>
<p><em>Depends on</em>: All <code>publish<em>PubName</em>PublicationTo<em>RepoName</em>Repository</code> tasks</p>
<div class="paragraph">
<p>An aggregate task that publishes all defined publications to all defined repositories. It does <em>not</em> include copying publications to the local Maven cache.</p>
</div>
</dd>
<dt class="hdlist1"><code>publishToMavenLocal</code></dt>
<dd>
<p><em>Depends on</em>: All <code>publish<em>PubName</em>PublicationToMavenLocal</code> tasks</p>
<div class="paragraph">
<p>Copies all defined publications to the local Maven cache, including their metadata (POM files, etc.).</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:publications"><a class="anchor" href="#publishing_maven:publications"></a><a class="link" href="#publishing_maven:publications">Publications</a></h4>
<div class="paragraph">
<p>This plugin provides <a href="#sub:terminology_publication">publications</a> of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.MavenPublication.html">MavenPublication</a>. To learn how to define and use publications, see the section on <a href="#sec:basic_publishing">basic publishing</a>.</p>
</div>
<div class="paragraph">
<p>There are four main things you can configure in a Maven publication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="#sub:terminology_component">component</a> — via <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.MavenPublication.html#org.gradle.api.publish.maven.MavenPublication:from(org.gradle.api.component.SoftwareComponent)">MavenPublication.from(org.gradle.api.component.SoftwareComponent)</a>.</p>
</li>
<li>
<p><a href="#sec:publishing_custom_artifacts_to_maven">Custom artifacts</a> — via the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.MavenPublication.html#org.gradle.api.publish.maven.MavenPublication:artifact(java.lang.Object)">MavenPublication.artifact(java.lang.Object)</a> method. See <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.MavenArtifact.html">MavenArtifact</a> for the available configuration options for custom Maven artifacts.</p>
</li>
<li>
<p>Standard metadata like <code>artifactId</code>, <code>groupId</code> and <code>version</code>.</p>
</li>
<li>
<p>Other contents of the POM file — via <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.MavenPublication.html#org.gradle.api.publish.maven.MavenPublication:pom(org.gradle.api.Action)">MavenPublication.pom(org.gradle.api.Action)</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see all of these in action in the <a href="#publishing_maven:complete_example">complete publishing example</a>. The API documentation for <code>MavenPublication</code> has additional code samples.</p>
</div>
<div class="sect4">
<h5 id="sec:identity_values_in_the_generated_pom"><a class="anchor" href="#sec:identity_values_in_the_generated_pom"></a><a class="link" href="#sec:identity_values_in_the_generated_pom">Identity values in the generated POM</a></h5>
<div class="paragraph">
<p>The attributes of the generated POM file will contain identity values derived from the following project properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>groupId</code> - <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:group">Project.getGroup()</a></p>
</li>
<li>
<p><code>artifactId</code> - <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:name">Project.getName()</a></p>
</li>
<li>
<p><code>version</code> - <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:version">Project.getVersion()</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Overriding the default identity values is easy: simply specify the <code>groupId</code>, <code>artifactId</code> or <code>version</code> attributes when configuring the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.MavenPublication.html">MavenPublication</a>.</p>
</div>
<div id="ex-customizing-the-publication-identity" class="exampleblock">
<div class="title">Example 305. <a href="#ex-customizing-the-publication-identity">Customizing the publication identity</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;maven&quot;) {
            groupId = &quot;org.gradle.sample&quot;
            artifactId = &quot;library&quot;
            version = &quot;1.1&quot;

            from(components[&quot;java&quot;])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        maven(MavenPublication) {
            groupId = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample</span><span class="delimiter">'</span></span>
            artifactId = <span class="string"><span class="delimiter">'</span><span class="content">library</span><span class="delimiter">'</span></span>
            version = <span class="string"><span class="delimiter">'</span><span class="content">1.1</span><span class="delimiter">'</span></span>

            from components.java
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Certain repositories will not be able to handle all supported characters. For example, the <code>:</code> character cannot be used as an identifier when publishing to a filesystem-backed repository on Windows.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Maven restricts <code>groupId</code> and <code>artifactId</code> to a limited character set (<code>[A-Za-z0-9_\\-.]+</code>) and Gradle enforces this restriction. For <code>version</code> (as well as the artifact <code>extension</code> and <code>classifier</code> properties), Gradle will handle any valid Unicode character.</p>
</div>
<div class="paragraph">
<p>The only Unicode values that are explicitly prohibited are <code>\</code>, <code>/</code> and any ISO control character. Supplied values are validated early in publication.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:modifying_the_generated_pom"><a class="anchor" href="#sec:modifying_the_generated_pom"></a><a class="link" href="#sec:modifying_the_generated_pom">Customizing the generated POM</a></h5>
<div class="paragraph">
<p>The generated POM file can be customized before publishing. For example, when publishing a library to Maven Central you will need to set certain metadata. The Maven Publish Plugin provides a DSL for that purpose. Please see <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.MavenPom.html">MavenPom</a> in the DSL Reference for the complete documentation of available properties and methods. The following sample shows how to use the most common ones:</p>
</div>
<div id="ex-customizing-the-pom-file" class="exampleblock">
<div class="title">Example 306. <a href="#ex-customizing-the-pom-file">Customizing the POM file</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
            pom {
                name = &quot;My Library&quot;
                description = &quot;A concise description of my library&quot;
                url = &quot;http://www.example.com/library&quot;
                properties = mapOf(
                    &quot;myProp&quot; to &quot;value&quot;,
                    &quot;prop.with.dots&quot; to &quot;anotherValue&quot;
                )
                licenses {
                    license {
                        name = &quot;The Apache License, Version 2.0&quot;
                        url = &quot;http://www.apache.org/licenses/LICENSE-2.0.txt&quot;
                    }
                }
                developers {
                    developer {
                        id = &quot;johnd&quot;
                        name = &quot;John Doe&quot;
                        email = &quot;john.doe@example.com&quot;
                    }
                }
                scm {
                    connection = &quot;scm:git:git://example.com/my-library.git&quot;
                    developerConnection = &quot;scm:git:ssh://example.com/my-library.git&quot;
                    url = &quot;http://example.com/my-library/&quot;
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        mavenJava(MavenPublication) {
            pom {
                name = <span class="string"><span class="delimiter">'</span><span class="content">My Library</span><span class="delimiter">'</span></span>
                description = <span class="string"><span class="delimiter">'</span><span class="content">A concise description of my library</span><span class="delimiter">'</span></span>
                url = <span class="string"><span class="delimiter">'</span><span class="content">http://www.example.com/library</span><span class="delimiter">'</span></span>
                properties = [
                    <span class="key">myProp</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">prop.with.dots</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">anotherValue</span><span class="delimiter">&quot;</span></span>
                ]
                licenses {
                    license {
                        name = <span class="string"><span class="delimiter">'</span><span class="content">The Apache License, Version 2.0</span><span class="delimiter">'</span></span>
                        url = <span class="string"><span class="delimiter">'</span><span class="content">http://www.apache.org/licenses/LICENSE-2.0.txt</span><span class="delimiter">'</span></span>
                    }
                }
                developers {
                    developer {
                        id = <span class="string"><span class="delimiter">'</span><span class="content">johnd</span><span class="delimiter">'</span></span>
                        name = <span class="string"><span class="delimiter">'</span><span class="content">John Doe</span><span class="delimiter">'</span></span>
                        email = <span class="string"><span class="delimiter">'</span><span class="content">john.doe@example.com</span><span class="delimiter">'</span></span>
                    }
                }
                scm {
                    connection = <span class="string"><span class="delimiter">'</span><span class="content">scm:git:git://example.com/my-library.git</span><span class="delimiter">'</span></span>
                    developerConnection = <span class="string"><span class="delimiter">'</span><span class="content">scm:git:ssh://example.com/my-library.git</span><span class="delimiter">'</span></span>
                    url = <span class="string"><span class="delimiter">'</span><span class="content">http://example.com/my-library/</span><span class="delimiter">'</span></span>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="publishing_maven:resolved_dependencies"><a class="anchor" href="#publishing_maven:resolved_dependencies"></a><a class="link" href="#publishing_maven:resolved_dependencies">Customizing dependencies versions</a></h5>
<div class="paragraph">
<p>Two strategies are supported for publishing dependencies:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Declared versions (default)</dt>
<dd>
<p>This strategy publishes the versions that are defined by the build script author with the dependency declarations in the <code>dependencies</code> block.
Any other kind of processing, for example through <a href="#resolution_rules">a rule changing the resolved version</a>, will not be taken into account for the publication.</p>
</dd>
<dt class="hdlist1">Resolved versions</dt>
<dd>
<p>This strategy publishes the versions that were resolved during the build, possibly by applying resolution rules and automatic conflict resolution.
This has the advantage that the published versions correspond to the ones the published artifact was tested against.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Example use cases for resolved versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A project uses dynamic versions for dependencies but prefers exposing the resolved version for a given release to its consumers.</p>
</li>
<li>
<p>In combination with <a href="#dependency-locking">dependency locking</a>, you want to publish the locked versions.</p>
</li>
<li>
<p>A project leverages the rich versions constraints of Gradle, which have a lossy conversion to Maven.
Instead of relying on the conversion, it publishes the resolved versions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is done by using the <code>versionMapping</code> DSL method which allows to configure the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/publish/VersionMappingStrategy.html">VersionMappingStrategy</a>:</p>
</div>
<div id="ex-using-resolved-versions" class="exampleblock">
<div class="title">Example 307. <a href="#ex-using-resolved-versions">Using resolved versions</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
            versionMapping {
                usage(&quot;java-api&quot;) {
                    fromResolutionOf(&quot;runtimeClasspath&quot;)
                }
                usage(&quot;java-runtime&quot;) {
                    fromResolutionResult()
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        mavenJava(MavenPublication) {
            versionMapping {
                usage(<span class="string"><span class="delimiter">'</span><span class="content">java-api</span><span class="delimiter">'</span></span>) {
                    fromResolutionOf(<span class="string"><span class="delimiter">'</span><span class="content">runtimeClasspath</span><span class="delimiter">'</span></span>)
                }
                usage(<span class="string"><span class="delimiter">'</span><span class="content">java-runtime</span><span class="delimiter">'</span></span>) {
                    fromResolutionResult()
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, Gradle will use the versions resolved on the <code>runtimeClasspath</code> for dependencies declared in <code>api</code>, which are mapped to the <code>compile</code> scope of Maven.
Gradle will also use the versions resolved on the <code>runtimeClasspath</code> for dependencies declared in <code>implementation</code>, which are mapped to the <code>runtime</code> scope of Maven.
<code>fromResolutionResult()</code> indicates that Gradle should use the default classpath of a variant and <code>runtimeClasspath</code> is the default classpath of <code>java-runtime</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:repositories"><a class="anchor" href="#publishing_maven:repositories"></a><a class="link" href="#publishing_maven:repositories">Repositories</a></h4>
<div class="paragraph">
<p>This plugin provides <a href="#sub:terminology_repository">repositories</a> of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html">MavenArtifactRepository</a>. To learn how to define and use repositories for publishing, see the section on <a href="#sec:basic_publishing">basic publishing</a>.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple example of defining a publishing repository:</p>
</div>
<div id="ex-declaring-repositories-to-publish-to" class="exampleblock">
<div class="title">Example 308. <a href="#ex-declaring-repositories-to-publish-to">Declaring repositories to publish to</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    repositories {
        maven {
            // change to point to your repo, e.g. http://my.org/repo
            url = uri(layout.buildDirectory.dir(&quot;repo&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    repositories {
        maven {
            <span class="comment">// change to point to your repo, e.g. http://my.org/repo</span>
            url = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">repo</span><span class="delimiter">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The two main things you will want to configure are the repository&#8217;s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>URL (required)</p>
</li>
<li>
<p>Name (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can define multiple repositories as long as they have unique names within the build script. You may also declare one (and only one) repository without a name. That repository will take on an implicit name of "Maven".</p>
</div>
<div class="paragraph">
<p>You can also configure any authentication details that are required to connect to the repository. See <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html">MavenArtifactRepository</a> for more details.</p>
</div>
<div class="sect4">
<h5 id="publishing_maven:snapshot_and_release_repositories"><a class="anchor" href="#publishing_maven:snapshot_and_release_repositories"></a><a class="link" href="#publishing_maven:snapshot_and_release_repositories">Snapshot and release repositories</a></h5>
<div class="paragraph">
<p>It is a common practice to publish snapshots and releases to different Maven repositories. A simple way to accomplish this is to configure the repository URL based on the project version. The following sample uses one URL for versions that end with "SNAPSHOT" and a different URL for the rest:</p>
</div>
<div id="ex-configuring-repository-url-based-on-project-version" class="exampleblock">
<div class="title">Example 309. <a href="#ex-configuring-repository-url-based-on-project-version">Configuring repository URL based on project version</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    repositories {
        maven {
            val releasesRepoUrl = layout.buildDirectory.dir(&quot;repos/releases&quot;)
            val snapshotsRepoUrl = layout.buildDirectory.dir(&quot;repos/snapshots&quot;)
            url = uri(if (version.toString().endsWith(&quot;SNAPSHOT&quot;)) snapshotsRepoUrl else releasesRepoUrl)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    repositories {
        maven {
            <span class="keyword">def</span> releasesRepoUrl = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">repos/releases</span><span class="delimiter">'</span></span>)
            <span class="keyword">def</span> snapshotsRepoUrl = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">repos/snapshots</span><span class="delimiter">'</span></span>)
            url = version.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">SNAPSHOT</span><span class="delimiter">'</span></span>) ? snapshotsRepoUrl : releasesRepoUrl
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Similarly, you can use a <a href="#build_environment">project or system property</a> to decide which repository to publish to. The following example uses the release repository if the project property <code>release</code> is set, such as when a user runs <code>gradle -Prelease publish</code>:</p>
</div>
<div id="ex-configuring-repository-url-based-on-project-property" class="exampleblock">
<div class="title">Example 310. <a href="#ex-configuring-repository-url-based-on-project-property">Configuring repository URL based on project property</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    repositories {
        maven {
            val releasesRepoUrl = layout.buildDirectory.dir(&quot;repos/releases&quot;)
            val snapshotsRepoUrl = layout.buildDirectory.dir(&quot;repos/snapshots&quot;)
            url = uri(if (project.hasProperty(&quot;release&quot;)) releasesRepoUrl else snapshotsRepoUrl)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    repositories {
        maven {
            <span class="keyword">def</span> releasesRepoUrl = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">repos/releases</span><span class="delimiter">'</span></span>)
            <span class="keyword">def</span> snapshotsRepoUrl = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">repos/snapshots</span><span class="delimiter">'</span></span>)
            url = project.hasProperty(<span class="string"><span class="delimiter">'</span><span class="content">release</span><span class="delimiter">'</span></span>) ? releasesRepoUrl : snapshotsRepoUrl
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:install"><a class="anchor" href="#publishing_maven:install"></a><a class="link" href="#publishing_maven:install">Publishing to Maven Local</a></h4>
<div class="paragraph">
<p>For integration with a local Maven installation, it is sometimes useful to publish the module into the Maven local repository (typically at <em>&lt;home directory of the current user&gt;/.m2/repository</em>), along with its POM file and other metadata. In Maven parlance, this is referred to as 'installing' the module.</p>
</div>
<div class="paragraph">
<p>The Maven Publish Plugin makes this easy to do by automatically creating a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/publish/maven/tasks/PublishToMavenLocal.html">PublishToMavenLocal</a> task for each <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.MavenPublication.html">MavenPublication</a> in the <code>publishing.publications</code> container. The task name follows the pattern of <code>publish<em>PubName</em>PublicationToMavenLocal</code>. Each of these tasks is wired into the <code>publishToMavenLocal</code> aggregate task. You do not need to have <code>mavenLocal()</code> in your <code>publishing.repositories</code> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:relocation"><a class="anchor" href="#publishing_maven:relocation"></a><a class="link" href="#publishing_maven:relocation">Publishing Maven relocation information</a></h4>
<div class="paragraph">
<p>When a project changes the <code>groupId</code> or <code>artifactId</code> (the <em>coordinates</em>) of an artifact it publishes, it is important to let users know where the new artifact can be found. Maven can help with that through the <em>relocation</em> feature. The way this works is that a project publishes an additional artifact under the old coordinates consisting only of a minimal <em>relocation POM</em>; that POM file specifies where the new artifact can be found. Maven repository browsers and build tools can then inform the user that the coordinates of an artifact have changed.</p>
</div>
<div class="paragraph">
<p>For this, a project adds an additional <code>MavenPublication</code> specifying a <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.maven.MavenPomRelocation.html">MavenPomRelocation</a>:</p>
</div>
<div id="ex-specifying-a-relocation-pom" class="exampleblock">
<div class="title">Example 311. <a href="#ex-specifying-a-relocation-pom">Specifying a relocation POM</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        // ... artifact publications

        // Specify relocation POM
        create&lt;MavenPublication&gt;(&quot;relocation&quot;) {
            pom {
                // Old artifact coordinates
                groupId = &quot;com.example&quot;
                artifactId = &quot;lib&quot;
                version = &quot;2.0.0&quot;

                distributionManagement {
                    relocation {
                        // New artifact coordinates
                        groupId = &quot;com.new-example&quot;
                        artifactId = &quot;lib&quot;
                        version = &quot;2.0.0&quot;
                        message = &quot;groupId has been changed&quot;
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        <span class="comment">// ... artifact publications</span>

        <span class="comment">// Specify relocation POM</span>
        relocation(MavenPublication) {
            pom {
                <span class="comment">// Old artifact coordinates</span>
                groupId = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.example</span><span class="delimiter">&quot;</span></span>
                artifactId = <span class="string"><span class="delimiter">&quot;</span><span class="content">lib</span><span class="delimiter">&quot;</span></span>
                version = <span class="string"><span class="delimiter">&quot;</span><span class="content">2.0.0</span><span class="delimiter">&quot;</span></span>

                distributionManagement {
                    relocation {
                        <span class="comment">// New artifact coordinates</span>
                        groupId = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.new-example</span><span class="delimiter">&quot;</span></span>
                        artifactId = <span class="string"><span class="delimiter">&quot;</span><span class="content">lib</span><span class="delimiter">&quot;</span></span>
                        version = <span class="string"><span class="delimiter">&quot;</span><span class="content">2.0.0</span><span class="delimiter">&quot;</span></span>
                        message = <span class="string"><span class="delimiter">&quot;</span><span class="content">groupId has been changed</span><span class="delimiter">&quot;</span></span>
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Only the property which has changed needs to be specified under <code>relocation</code>, that is <code>artifactId</code> and / or <code>groupId</code>. All other properties are optional.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Specifying the <code>version</code> can be useful when the new artifact has a different version, for example because version numbering has started at 1.0.0 again.</p>
</div>
<div class="paragraph">
<p>A custom <code>message</code> allows explaining why the artifact coordinates have changed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The relocation POM should be created for what would be the next version of the old artifact. For example when the artifact coordinates of <code>com.example:lib:1.0.0</code> are changed and the artifact with the new coordinates continues version numbering and is published as <code>com.new-example:lib:2.0.0</code>, then the relocation POM should specify a relocation from <code>com.example:lib:2.0.0</code> to <code>com.new-example:lib:2.0.0</code>.</p>
</div>
<div class="paragraph">
<p>A relocation POM only has to be published once, the build file configuration for it should be removed again once it has been published.</p>
</div>
<div class="paragraph">
<p>Note that a relocation POM is not suitable for all situations; when an artifact has been split into two or more separate artifacts then a relocation POM might not be helpful.</p>
</div>
<div class="sect4">
<h5 id="publishing_maven:retroactive_relocation"><a class="anchor" href="#publishing_maven:retroactive_relocation"></a><a class="link" href="#publishing_maven:retroactive_relocation">Retroactively publishing relocation information</a></h5>
<div class="paragraph">
<p>It is possible to publish relocation information retroactively after the coordinates of an artifact have changed in the past, and no relocation information was published back then.</p>
</div>
<div class="paragraph">
<p>The same recommendations as described above apply. To ease migration for users, it is important to pay attention to the <code>version</code> specified in the relocation POM. The relocation POM should allow the user to move to the new artifact in one step, and then allow them to update to the latest version in a separate step. For example when for the coordinates of <code>com.new-example:lib:5.0.0</code> were changed in version 2.0.0, then ideally the relocation POM should be published for the old coordinates <code>com.example:lib:2.0.0</code> relocating to <code>com.new-example:lib:2.0.0</code>. The user can then switch from <code>com.example:lib</code> to <code>com.new-example</code> and then separately update from version 2.0.0 to 5.0.0, handling breaking changes (if any) step by step.</p>
</div>
<div class="paragraph">
<p>When relocation information is published retroactively, it is not necessary to wait for next regular release of the project, it can be published in the meantime. As mentioned above, the relocation information should then be removed again from the build file once the relocation POM has been published.</p>
</div>
</div>
<div class="sect4">
<h5 id="publishing_maven:relocation_duplicate_dependencies"><a class="anchor" href="#publishing_maven:relocation_duplicate_dependencies"></a><a class="link" href="#publishing_maven:relocation_duplicate_dependencies">Avoiding duplicate dependencies</a></h5>
<div class="paragraph">
<p>When only the coordinates of the artifact have changed, but package names of the classes inside the artifact have remained the same, dependency conflicts can occur. A project might (transitively) depend on the old artifact but at the same time also have a dependency on the new artifact which both contain the same classes, potentially with incompatible changes.</p>
</div>
<div class="paragraph">
<p>To detect such conflicting duplicate dependencies, <a href="#sub:declaring-component-capabilities">capabilities</a> can be published as part of the <a href="#sec:understanding-gradle-module-md">Gradle Module Metadata</a>.  For an example using a <a href="#java_library_plugin">Java Library</a> project, see <a href="#sec:declaring-additional-capabilities-for-a-local-component">declaring additional capabilities for a local component</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="publishing_maven:relocation_dry_run"><a class="anchor" href="#publishing_maven:relocation_dry_run"></a><a class="link" href="#publishing_maven:relocation_dry_run">Performing a dry run</a></h5>
<div class="paragraph">
<p>To verify that relocation information works as expected before publishing it to a remote repository, it can first be <a href="#publishing_maven:install">published to the local Maven repository</a>. Then a local test Gradle or Maven project can be created which has the relocation artifact as dependency.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:complete_example"><a class="anchor" href="#publishing_maven:complete_example"></a><a class="link" href="#publishing_maven:complete_example">Complete example</a></h4>
<div class="paragraph">
<p>The following example demonstrates how to sign and publish a Java library including sources, Javadoc, and a customized POM:</p>
</div>
<div id="ex-publishing-a-java-library" class="exampleblock">
<div class="title">Example 312. <a href="#ex-publishing-a-java-library">Publishing a Java library</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
    `maven-publish`
    signing
}

group = &quot;com.example&quot;
version = &quot;1.0&quot;

java {
    withJavadocJar()
    withSourcesJar()
}

publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
            artifactId = &quot;my-library&quot;
            from(components[&quot;java&quot;])
            versionMapping {
                usage(&quot;java-api&quot;) {
                    fromResolutionOf(&quot;runtimeClasspath&quot;)
                }
                usage(&quot;java-runtime&quot;) {
                    fromResolutionResult()
                }
            }
            pom {
                name = &quot;My Library&quot;
                description = &quot;A concise description of my library&quot;
                url = &quot;http://www.example.com/library&quot;
                properties = mapOf(
                    &quot;myProp&quot; to &quot;value&quot;,
                    &quot;prop.with.dots&quot; to &quot;anotherValue&quot;
                )
                licenses {
                    license {
                        name = &quot;The Apache License, Version 2.0&quot;
                        url = &quot;http://www.apache.org/licenses/LICENSE-2.0.txt&quot;
                    }
                }
                developers {
                    developer {
                        id = &quot;johnd&quot;
                        name = &quot;John Doe&quot;
                        email = &quot;john.doe@example.com&quot;
                    }
                }
                scm {
                    connection = &quot;scm:git:git://example.com/my-library.git&quot;
                    developerConnection = &quot;scm:git:ssh://example.com/my-library.git&quot;
                    url = &quot;http://example.com/my-library/&quot;
                }
            }
        }
    }
    repositories {
        maven {
            // change URLs to point to your repos, e.g. http://my.org/repo
            val releasesRepoUrl = uri(layout.buildDirectory.dir(&quot;repos/releases&quot;))
            val snapshotsRepoUrl = uri(layout.buildDirectory.dir(&quot;repos/snapshots&quot;))
            url = if (version.toString().endsWith(&quot;SNAPSHOT&quot;)) snapshotsRepoUrl else releasesRepoUrl
        }
    }
}

signing {
    sign(publishing.publications[&quot;mavenJava&quot;])
}

tasks.javadoc {
    if (JavaVersion.current().isJava9Compatible) {
        (options as StandardJavadocDocletOptions).addBooleanOption(&quot;html5&quot;, true)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">signing</span><span class="delimiter">'</span></span>
}

group = <span class="string"><span class="delimiter">'</span><span class="content">com.example</span><span class="delimiter">'</span></span>
version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>

java {
    withJavadocJar()
    withSourcesJar()
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            artifactId = <span class="string"><span class="delimiter">'</span><span class="content">my-library</span><span class="delimiter">'</span></span>
            from components.java
            versionMapping {
                usage(<span class="string"><span class="delimiter">'</span><span class="content">java-api</span><span class="delimiter">'</span></span>) {
                    fromResolutionOf(<span class="string"><span class="delimiter">'</span><span class="content">runtimeClasspath</span><span class="delimiter">'</span></span>)
                }
                usage(<span class="string"><span class="delimiter">'</span><span class="content">java-runtime</span><span class="delimiter">'</span></span>) {
                    fromResolutionResult()
                }
            }
            pom {
                name = <span class="string"><span class="delimiter">'</span><span class="content">My Library</span><span class="delimiter">'</span></span>
                description = <span class="string"><span class="delimiter">'</span><span class="content">A concise description of my library</span><span class="delimiter">'</span></span>
                url = <span class="string"><span class="delimiter">'</span><span class="content">http://www.example.com/library</span><span class="delimiter">'</span></span>
                properties = [
                    <span class="key">myProp</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">prop.with.dots</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">anotherValue</span><span class="delimiter">&quot;</span></span>
                ]
                licenses {
                    license {
                        name = <span class="string"><span class="delimiter">'</span><span class="content">The Apache License, Version 2.0</span><span class="delimiter">'</span></span>
                        url = <span class="string"><span class="delimiter">'</span><span class="content">http://www.apache.org/licenses/LICENSE-2.0.txt</span><span class="delimiter">'</span></span>
                    }
                }
                developers {
                    developer {
                        id = <span class="string"><span class="delimiter">'</span><span class="content">johnd</span><span class="delimiter">'</span></span>
                        name = <span class="string"><span class="delimiter">'</span><span class="content">John Doe</span><span class="delimiter">'</span></span>
                        email = <span class="string"><span class="delimiter">'</span><span class="content">john.doe@example.com</span><span class="delimiter">'</span></span>
                    }
                }
                scm {
                    connection = <span class="string"><span class="delimiter">'</span><span class="content">scm:git:git://example.com/my-library.git</span><span class="delimiter">'</span></span>
                    developerConnection = <span class="string"><span class="delimiter">'</span><span class="content">scm:git:ssh://example.com/my-library.git</span><span class="delimiter">'</span></span>
                    url = <span class="string"><span class="delimiter">'</span><span class="content">http://example.com/my-library/</span><span class="delimiter">'</span></span>
                }
            }
        }
    }
    repositories {
        maven {
            <span class="comment">// change URLs to point to your repos, e.g. http://my.org/repo</span>
            <span class="keyword">def</span> releasesRepoUrl = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">repos/releases</span><span class="delimiter">'</span></span>)
            <span class="keyword">def</span> snapshotsRepoUrl = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">repos/snapshots</span><span class="delimiter">'</span></span>)
            url = version.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">SNAPSHOT</span><span class="delimiter">'</span></span>) ? snapshotsRepoUrl : releasesRepoUrl
        }
    }
}

signing {
    sign publishing.publications.mavenJava
}


javadoc {
    <span class="keyword">if</span>(JavaVersion.current().isJava9Compatible()) {
        options.addBooleanOption(<span class="string"><span class="delimiter">'</span><span class="content">html5</span><span class="delimiter">'</span></span>, <span class="predefined-constant">true</span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The result is that the following artifacts will be published:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The POM: <code>my-library-1.0.pom</code></p>
</li>
<li>
<p>The primary JAR artifact for the Java component: <code>my-library-1.0.jar</code></p>
</li>
<li>
<p>The sources JAR artifact that has been explicitly configured: <code>my-library-1.0-sources.jar</code></p>
</li>
<li>
<p>The Javadoc JAR artifact that has been explicitly configured: <code>my-library-1.0-javadoc.jar</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="signing_plugin.html#signing_plugin">Signing Plugin</a> is used to generate a signature file for each artifact. In addition, checksum files will be generated for all artifacts and signature files.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
publishToMavenLocal` does not create checksum files in <code>$USER_HOME/.m2/repository</code>.
If you want to verify that the checksum files are created correctly, or use them for later publishing, consider configuring a <a href="#sec:maven_repo">custom Maven repository</a> with a <code>file://</code> URL and using that as the publishing target instead.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:deferred_configuration"><a class="anchor" href="#publishing_maven:deferred_configuration"></a><a class="link" href="#publishing_maven:deferred_configuration">Removal of deferred configuration behavior</a></h4>
<div class="paragraph">
<p>Prior to Gradle 5.0, the <code>publishing {}</code> block was (by default) implicitly treated as if all the logic inside it was executed after the project is evaluated.
This behavior caused quite a bit of confusion and was deprecated in Gradle 4.8, because it was the only block that behaved that way.</p>
</div>
<div class="paragraph">
<p>You may have some logic inside your publishing block or in a plugin that is depending on the deferred configuration behavior.
For instance, the following logic assumes that the subprojects will be evaluated when the artifactId is set:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">subprojects {
    publishing {
        publications {
            create&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
                from(components[&quot;java&quot;])
                artifactId = tasks.jar.get().archiveBaseName.get()
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">subprojects {
    publishing {
        publications {
            mavenJava(MavenPublication) {
                from components.java
                artifactId = jar.archiveBaseName
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This kind of logic must now be wrapped in an <code>afterEvaluate {}</code> block.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">subprojects {
    publishing {
        publications {
            create&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
                from(components[&quot;java&quot;])
                afterEvaluate {
                    artifactId = tasks.jar.get().archiveBaseName.get()
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">subprojects {
    publishing {
        publications {
            mavenJava(MavenPublication) {
                from components.java
                afterEvaluate {
                    artifactId = jar.archiveBaseName
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="publishing_ivy"><a class="anchor" href="#publishing_ivy"></a><a class="link" href="#publishing_ivy">The Ivy Publish Plugin</a></h3>
<div class="paragraph">
<p>The Ivy Publish Plugin provides the ability to publish build artifacts in the <a href="http://ant.apache.org/ivy/">Apache Ivy</a> format, usually to a repository for consumption by other builds or projects. What is published is one or more artifacts created by the build, and an Ivy <em>module descriptor</em> (normally <code>ivy.xml</code>) that describes the artifacts and the dependencies of the artifacts, if any.</p>
</div>
<div class="paragraph">
<p>A published Ivy module can be consumed by Gradle (see <a href="#declaring-dependencies">Declaring Dependencies</a>) and other tools that understand the Ivy format. You can learn about the fundamentals of publishing in <a href="#publishing_overview">Publishing Overview</a>.</p>
</div>
<div class="sect3">
<h4 id="publishing_ivy:usage"><a class="anchor" href="#publishing_ivy:usage"></a><a class="link" href="#publishing_ivy:usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Ivy Publish Plugin, include the following in your build script:</p>
</div>
<div id="ex-applying-the-ivy-publish-plugin" class="exampleblock">
<div class="title">Example 313. <a href="#ex-applying-the-ivy-publish-plugin">Applying the Ivy Publish Plugin</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `ivy-publish`
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">ivy-publish</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Ivy Publish Plugin uses an extension on the project named <code>publishing</code> of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.PublishingExtension.html">PublishingExtension</a>. This extension provides a container of named publications and a container of named repositories. The Ivy Publish Plugin works with <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.IvyPublication.html">IvyPublication</a> publications and <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.repositories.IvyArtifactRepository.html">IvyArtifactRepository</a> repositories.</p>
</div>
</div>
<div class="sect3">
<h4 id="publishing_ivy:tasks"><a class="anchor" href="#publishing_ivy:tasks"></a><a class="link" href="#publishing_ivy:tasks">Tasks</a></h4>
<div id="publishing_ivy:descriptor" class="dlist">
<dl>
<dt class="hdlist1"><code>generateDescriptorFileFor<em>PubName</em>Publication</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.tasks.GenerateIvyDescriptor.html">GenerateIvyDescriptor</a></dt>
<dd>
<p>Creates an Ivy descriptor file for the publication named <em>PubName</em>, populating the known metadata such as project name, project version, and the dependencies. The default location for the descriptor file is <em>build/publications/$pubName/ivy.xml</em>.</p>
</dd>
<dt class="hdlist1"><code>publish<em>PubName</em>PublicationTo<em>RepoName</em>Repository</code> — <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.tasks.PublishToIvyRepository.html">PublishToIvyRepository</a></dt>
<dd>
<p>Publishes the <em>PubName</em> publication to the repository named <em>RepoName</em>. If you have a repository definition without an explicit name, <em>RepoName</em> will be "Ivy".</p>
</dd>
<dt class="hdlist1"><code>publish</code></dt>
<dd>
<p><em>Depends on</em>: All <code>publish<em>PubName</em>PublicationTo<em>RepoName</em>Repository</code> tasks</p>
<div class="paragraph">
<p>An aggregate task that publishes all defined publications to all defined repositories.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="publishing_ivy:publications"><a class="anchor" href="#publishing_ivy:publications"></a><a class="link" href="#publishing_ivy:publications">Publications</a></h4>
<div class="paragraph">
<p>This plugin provides <a href="#sub:terminology_publication">publications</a> of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.IvyPublication.html">IvyPublication</a>. To learn how to define and use publications, see the section on <a href="#sec:basic_publishing">basic publishing</a>.</p>
</div>
<div class="paragraph">
<p>There are four main things you can configure in an Ivy publication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="#sub:terminology_component">component</a> — via <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.IvyPublication.html#org.gradle.api.publish.ivy.IvyPublication:from(org.gradle.api.component.SoftwareComponent)">IvyPublication.from(org.gradle.api.component.SoftwareComponent)</a>.</p>
</li>
<li>
<p><a href="#sec:publishing_custom_artifacts_to_maven">Custom artifacts</a> — via the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.IvyPublication.html#org.gradle.api.publish.ivy.IvyPublication:artifact(java.lang.Object)">IvyPublication.artifact(java.lang.Object)</a> method. See <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.IvyArtifact.html">IvyArtifact</a> for the available configuration options for custom Ivy artifacts.</p>
</li>
<li>
<p>Standard metadata like <code>module</code>, <code>organisation</code> and <code>revision</code>.</p>
</li>
<li>
<p>Other contents of the module descriptor — via <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.IvyPublication.html#org.gradle.api.publish.ivy.IvyPublication:descriptor(org.gradle.api.Action)">IvyPublication.descriptor(org.gradle.api.Action)</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see all of these in action in the <a href="#publishing_ivy:example">complete publishing example</a>. The API documentation for <code>IvyPublication</code> has additional code samples.</p>
</div>
<div class="sect4">
<h5 id="sec:identity_values_for_the_published_project"><a class="anchor" href="#sec:identity_values_for_the_published_project"></a><a class="link" href="#sec:identity_values_for_the_published_project">Identity values for the published project</a></h5>
<div class="paragraph">
<p>The generated Ivy module descriptor file contains an <code>&lt;info&gt;</code> element that identifies the module. The default identity values are derived from the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>organisation</code> - <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:group">Project.getGroup()</a></p>
</li>
<li>
<p><code>module</code> - <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:name">Project.getName()</a></p>
</li>
<li>
<p><code>revision</code> - <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:version">Project.getVersion()</a></p>
</li>
<li>
<p><code>status</code> - <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:status">Project.getStatus()</a></p>
</li>
<li>
<p><code>branch</code> - (not set)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Overriding the default identity values is easy: simply specify the <code>organisation</code>, <code>module</code> or <code>revision</code> properties when configuring the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.IvyPublication.html">IvyPublication</a>. <code>status</code> and <code>branch</code> can be set via the <code>descriptor</code> property — see <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.IvyModuleDescriptorSpec.html">IvyModuleDescriptorSpec</a>.</p>
</div>
<div class="paragraph">
<p>The <code>descriptor</code> property can also be used to add additional custom elements as children of the <code>&lt;info&gt;</code> element, like so:</p>
</div>
<div id="ex-customizing-the-publication-identity" class="exampleblock">
<div class="title">Example 314. <a href="#ex-customizing-the-publication-identity">customizing the publication identity</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;IvyPublication&gt;(&quot;ivy&quot;) {
            organisation = &quot;org.gradle.sample&quot;
            module = &quot;project1-sample&quot;
            revision = &quot;1.1&quot;
            descriptor.status = &quot;milestone&quot;
            descriptor.branch = &quot;testing&quot;
            descriptor.extraInfo(&quot;http://my.namespace&quot;, &quot;myElement&quot;, &quot;Some value&quot;)

            from(components[&quot;java&quot;])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        ivy(IvyPublication) {
            organisation = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample</span><span class="delimiter">'</span></span>
            module = <span class="string"><span class="delimiter">'</span><span class="content">project1-sample</span><span class="delimiter">'</span></span>
            revision = <span class="string"><span class="delimiter">'</span><span class="content">1.1</span><span class="delimiter">'</span></span>
            descriptor.status = <span class="string"><span class="delimiter">'</span><span class="content">milestone</span><span class="delimiter">'</span></span>
            descriptor.branch = <span class="string"><span class="delimiter">'</span><span class="content">testing</span><span class="delimiter">'</span></span>
            descriptor.extraInfo <span class="string"><span class="delimiter">'</span><span class="content">http://my.namespace</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">myElement</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Some value</span><span class="delimiter">'</span></span>

            from components.java
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Certain repositories are not able to handle all supported characters. For example, the <code>:</code> character cannot be used as an identifier when publishing to a filesystem-backed repository on Windows.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Gradle will handle any valid Unicode character for <code>organisation</code>, <code>module</code> and <code>revision</code> (as well as the artifact&#8217;s <code>name</code>, <code>extension</code> and <code>classifier</code>). The only values that are explicitly prohibited are <code>\</code>, <code>/</code> and any ISO control character. The supplied values are validated early during publication.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:modifying_the_generated_module_descriptor"><a class="anchor" href="#sec:modifying_the_generated_module_descriptor"></a><a class="link" href="#sec:modifying_the_generated_module_descriptor">Customizing the generated module descriptor</a></h5>
<div class="paragraph">
<p>At times, the module descriptor file generated from the project information will need to be tweaked before publishing. The Ivy Publish Plugin provides a DSL for that purpose. Please see <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.IvyModuleDescriptorSpec.html">IvyModuleDescriptorSpec</a> in the DSL Reference for the complete documentation of available properties and methods.</p>
</div>
<div class="paragraph">
<p>The following sample shows how to use the most common aspects of the DSL:</p>
</div>
<div id="ex-customizing-the-module-descriptor-file" class="exampleblock">
<div class="title">Example 315. <a href="#ex-customizing-the-module-descriptor-file">Customizing the module descriptor file</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publications {
    create&lt;IvyPublication&gt;(&quot;ivyCustom&quot;) {
        descriptor {
            license {
                name = &quot;The Apache License, Version 2.0&quot;
                url = &quot;http://www.apache.org/licenses/LICENSE-2.0.txt&quot;
            }
            author {
                name = &quot;Jane Doe&quot;
                url = &quot;http://example.com/users/jane&quot;
            }
            description {
                text = &quot;A concise description of my library&quot;
                homepage = &quot;http://www.example.com/library&quot;
            }
        }
        versionMapping {
            usage(&quot;java-api&quot;) {
                fromResolutionOf(&quot;runtimeClasspath&quot;)
            }
            usage(&quot;java-runtime&quot;) {
                fromResolutionResult()
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publications {
    ivyCustom(IvyPublication) {
        descriptor {
            license {
                name = <span class="string"><span class="delimiter">'</span><span class="content">The Apache License, Version 2.0</span><span class="delimiter">'</span></span>
                url = <span class="string"><span class="delimiter">'</span><span class="content">http://www.apache.org/licenses/LICENSE-2.0.txt</span><span class="delimiter">'</span></span>
            }
            author {
                name = <span class="string"><span class="delimiter">'</span><span class="content">Jane Doe</span><span class="delimiter">'</span></span>
                url = <span class="string"><span class="delimiter">'</span><span class="content">http://example.com/users/jane</span><span class="delimiter">'</span></span>
            }
            description {
                text = <span class="string"><span class="delimiter">'</span><span class="content">A concise description of my library</span><span class="delimiter">'</span></span>
                homepage = <span class="string"><span class="delimiter">'</span><span class="content">http://www.example.com/library</span><span class="delimiter">'</span></span>
            }
        }
        versionMapping {
            usage(<span class="string"><span class="delimiter">'</span><span class="content">java-api</span><span class="delimiter">'</span></span>) {
                fromResolutionOf(<span class="string"><span class="delimiter">'</span><span class="content">runtimeClasspath</span><span class="delimiter">'</span></span>)
            }
            usage(<span class="string"><span class="delimiter">'</span><span class="content">java-runtime</span><span class="delimiter">'</span></span>) {
                fromResolutionResult()
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example we are simply adding a 'description' element to the generated Ivy dependency descriptor, but this hook allows you to modify any aspect of the generated descriptor. For example, you could replace the version range for a dependency with the actual version used to produce the build.</p>
</div>
<div class="paragraph">
<p>You can also add arbitrary XML to the descriptor file via <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.publish.ivy.IvyModuleDescriptorSpec.html#org.gradle.api.publish.ivy.IvyModuleDescriptorSpec:withXml(org.gradle.api.Action)">IvyModuleDescriptorSpec.withXml(org.gradle.api.Action)</a>, but you cannot use it to modify any part of the module identifier (organisation, module, revision).</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
It is possible to modify the descriptor in such a way that it is no longer a valid Ivy module descriptor, so care must be taken when using this feature.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="publishing_ivy:resolved_dependencies"><a class="anchor" href="#publishing_ivy:resolved_dependencies"></a><a class="link" href="#publishing_ivy:resolved_dependencies">Customizing dependencies versions</a></h5>
<div class="paragraph">
<p>Two strategies are supported for publishing dependencies:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Declared versions (default)</dt>
<dd>
<p>This strategy publishes the versions that are defined by the build script author with the dependency declarations in the <code>dependencies</code> block.
Any other kind of processing, for example through <a href="#resolution_rules">a rule changing the resolved version</a>, will not be taken into account for the publication.</p>
</dd>
<dt class="hdlist1">Resolved versions</dt>
<dd>
<p>This strategy publishes the versions that were resolved during the build, possibly by applying resolution rules and automatic conflict resolution.
This has the advantage that the published versions correspond to the ones the published artifact was tested against.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Example use cases for resolved versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A project uses dynamic versions for dependencies but prefers exposing the resolved version for a given release to its consumers.</p>
</li>
<li>
<p>In combination with <a href="#dependency-locking">dependency locking</a>, you want to publish the locked versions.</p>
</li>
<li>
<p>A project leverages the rich versions constraints of Gradle, which have a lossy conversion to Ivy.
Instead of relying on the conversion, it publishes the resolved versions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is done by using the <code>versionMapping</code> DSL method which allows to configure the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/publish/VersionMappingStrategy.html">VersionMappingStrategy</a>:</p>
</div>
<div id="ex-using-resolved-versions" class="exampleblock">
<div class="title">Example 316. <a href="#ex-using-resolved-versions">Using resolved versions</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publications {
    create&lt;IvyPublication&gt;(&quot;ivyCustom&quot;) {
        versionMapping {
            usage(&quot;java-api&quot;) {
                fromResolutionOf(&quot;runtimeClasspath&quot;)
            }
            usage(&quot;java-runtime&quot;) {
                fromResolutionResult()
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publications {
    ivyCustom(IvyPublication) {
        versionMapping {
            usage(<span class="string"><span class="delimiter">'</span><span class="content">java-api</span><span class="delimiter">'</span></span>) {
                fromResolutionOf(<span class="string"><span class="delimiter">'</span><span class="content">runtimeClasspath</span><span class="delimiter">'</span></span>)
            }
            usage(<span class="string"><span class="delimiter">'</span><span class="content">java-runtime</span><span class="delimiter">'</span></span>) {
                fromResolutionResult()
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, Gradle will use the versions resolved on the <code>runtimeClasspath</code> for dependencies declared in <code>api</code>, which are mapped to the <code>compile</code> configuration of Ivy.
Gradle will also use the versions resolved on the <code>runtimeClasspath</code> for dependencies declared in <code>implementation</code>, which are mapped to the <code>runtime</code> configuration of Ivy.
<code>fromResolutionResult()</code> indicates that Gradle should use the default classpath of a variant and <code>runtimeClasspath</code> is the default classpath of <code>java-runtime</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="publishing_ivy:repositories"><a class="anchor" href="#publishing_ivy:repositories"></a><a class="link" href="#publishing_ivy:repositories">Repositories</a></h4>
<div class="paragraph">
<p>This plugin provides <a href="#sub:terminology_repository">repositories</a> of type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.repositories.IvyArtifactRepository.html">IvyArtifactRepository</a>. To learn how to define and use repositories for publishing, see the section on <a href="#sec:basic_publishing">basic publishing</a>.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple example of defining a publishing repository:</p>
</div>
<div id="ex-declaring-repositories-to-publish-to" class="exampleblock">
<div class="title">Example 317. <a href="#ex-declaring-repositories-to-publish-to">Declaring repositories to publish to</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    repositories {
        ivy {
            // change to point to your repo, e.g. http://my.org/repo
            url = uri(layout.buildDirectory.dir(&quot;repo&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    repositories {
        ivy {
            <span class="comment">// change to point to your repo, e.g. http://my.org/repo</span>
            url = layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">repo</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The two main things you will want to configure are the repository&#8217;s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>URL (required)</p>
</li>
<li>
<p>Name (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can define multiple repositories as long as they have unique names within the build script. You may also declare one (and only one) repository without a name. That repository will take on an implicit name of "Ivy".</p>
</div>
<div class="paragraph">
<p>You can also configure any authentication details that are required to connect to the repository. See <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.artifacts.repositories.IvyArtifactRepository.html">IvyArtifactRepository</a> for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="publishing_ivy:example"><a class="anchor" href="#publishing_ivy:example"></a><a class="link" href="#publishing_ivy:example">Complete example</a></h4>
<div class="paragraph">
<p>The following example demonstrates publishing with a multi-project build.
Each project publishes a Java component configured to also build and publish Javadoc and source code artifacts.
The descriptor file is customized to include the project description for each project.</p>
</div>
<div id="ex-publishing-a-java-module" class="exampleblock">
<div class="title">Example 318. <a href="#ex-publishing-a-java-module">Publishing a Java module</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;ivy-publish-java&quot;
include(&quot;project1&quot;, &quot;project2&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `kotlin-dsl`
}

repositories {
    gradlePluginPortal()
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/myproject.publishing-conventions.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;java-library&quot;)
    id(&quot;ivy-publish&quot;)
}

version = &quot;1.0&quot;
group = &quot;org.gradle.sample&quot;

repositories {
    mavenCentral()
}

java {
    withJavadocJar()
    withSourcesJar()
}

publishing {
    repositories {
        ivy {
            // change to point to your repo, e.g. http://my.org/repo
            url = uri(&quot;${rootProject.buildDir}/repo&quot;)
        }
    }
    publications {
        create&lt;IvyPublication&gt;(&quot;ivy&quot;) {
            from(components[&quot;java&quot;])
            descriptor.description {
                text = providers.provider({ description })
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">project1/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;myproject.publishing-conventions&quot;)
}

description = &quot;The first project&quot;

dependencies {
    implementation(&quot;junit:junit:4.13&quot;)
    implementation(project(&quot;:project2&quot;))
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">project2/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;myproject.publishing-conventions&quot;)
}

description = &quot;The second project&quot;

dependencies {
    implementation(&quot;commons-collections:commons-collections:3.2.2&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">ivy-publish-java</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">project1</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">project2</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">buildSrc/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy-gradle-plugin</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/myproject.publishing-conventions.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">ivy-publish</span><span class="delimiter">'</span></span>
}

version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>
group = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample</span><span class="delimiter">'</span></span>

repositories {
    mavenCentral()
}

java {
    withJavadocJar()
    withSourcesJar()
}

publishing {
    repositories {
        ivy {
            <span class="comment">// change to point to your repo, e.g. http://my.org/repo</span>
            url = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>rootProject.buildDir<span class="inline-delimiter">}</span></span><span class="content">/repo</span><span class="delimiter">&quot;</span></span>
        }
    }
    publications {
        ivy(IvyPublication) {
            from components.java
            descriptor.description {
                text = providers.provider({ description })
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">project1/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">myproject.publishing-conventions</span><span class="delimiter">'</span></span>
}

description = <span class="string"><span class="delimiter">'</span><span class="content">The first project</span><span class="delimiter">'</span></span>

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.13</span><span class="delimiter">'</span></span>
    implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:project2</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">project2/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">myproject.publishing-conventions</span><span class="delimiter">'</span></span>
}

description = <span class="string"><span class="delimiter">'</span><span class="content">The second project</span><span class="delimiter">'</span></span>

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-collections:commons-collections:3.2.2</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The result is that the following artifacts will be published for each project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Gradle Module Metadata file: <code>project1-1.0.module</code>.</p>
</li>
<li>
<p>The Ivy module metadata file: <code>ivy-1.0.xml</code>.</p>
</li>
<li>
<p>The primary JAR artifact for the Java component: <code>project1-1.0.jar</code>.</p>
</li>
<li>
<p>The Javadoc and sources JAR artifacts of the Java component (because we configured <code>withJavadocJar()</code> and <code>withSourcesJar()</code>): <code>project1-1.0-javadoc.jar</code>, <code>project1-1.0-source.jar</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:optimizing_build_times"><a class="anchor" href="#part:optimizing_build_times"></a><a class="link" href="#part:optimizing_build_times"><strong>OPTIMIZING BUILD PERFORMANCE</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="performance_gradle"><a class="anchor" href="#performance_gradle"></a><a class="link" href="#performance_gradle">Improve the Performance of Gradle Builds</a></h3>
<div class="paragraph">
<p>Build performance is critical to productivity.
The longer builds take to complete, the more likely they&#8217;ll disrupt your development flow.
Builds run many times a day, so even small waiting periods add up.
The same is true for Continuous Integration (CI) builds: the less time they take, the faster you can react to new issues
and the more often you can experiment.</p>
</div>
<div class="paragraph">
<p>All this means that it’s worth investing some time and effort into making your build as fast as possible.
This section offers several ways to make a build faster. Additionally, you&#8217;ll find details about what leads to
build performance degradation, and how you can avoid it.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Want faster Gradle Builds? <a href="https://gradle.org/training/#build-cache-deep-dive">Register here</a> for our Build Cache training session to learn how Develocity can speed up builds by up to 90%.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="inspect_your_build"><a class="anchor" href="#inspect_your_build"></a><a class="link" href="#inspect_your_build">Inspect your build</a></h4>
<div class="paragraph">
<p>Before you make any changes, <a href="#inspecting_build_scans">inspect your build</a> with a build scan or profile report. A proper build inspection helps
you understand:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>how long it takes to build your project</p>
</li>
<li>
<p>which parts of your build are slow</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Inspecting provides a comparison point to better understand the impact of the changes recommended on this page.</p>
</div>
<div class="paragraph">
<p>To best make use of this page:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Inspect your build.</p>
</li>
<li>
<p>Make a change.</p>
</li>
<li>
<p>Inspect your build again.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the change improved build times, make it permanent. If you don&#8217;t see an improvement, remove the change and try another.</p>
</div>
</div>
<div class="sect3">
<h4 id="update_versions"><a class="anchor" href="#update_versions"></a><a class="link" href="#update_versions">Update versions</a></h4>
<div class="sect4">
<h5 id="update_gradle"><a class="anchor" href="#update_gradle"></a><a class="link" href="#update_gradle">Gradle</a></h5>
<div class="paragraph">
<p>The Gradle team continuously improves the performance of Gradle builds.
If you’re using an old version of Gradle, you’re missing out on the benefits of that work.
Keeping up with Gradle version upgrades is low risk because the Gradle team ensures backwards compatibility between minor versions of Gradle.
Staying up-to-date also makes transitioning to the next major version easier, since you&#8217;ll get early deprecation warnings.</p>
</div>
</div>
<div class="sect4">
<h5 id="java_2"><a class="anchor" href="#java_2"></a><a class="link" href="#java_2">Java</a></h5>
<div class="paragraph">
<p>Gradle runs on the Java Virtual Machine (JVM). Java performance improvements often benefit Gradle.
For the best Gradle performance, use the latest version of Java.</p>
</div>
</div>
<div class="sect4">
<h5 id="plugins_2"><a class="anchor" href="#plugins_2"></a><a class="link" href="#plugins_2">Plugins</a></h5>
<div class="paragraph">
<p>Plugin writers continuously improve the performance of their plugins.
If you&#8217;re using an old version of a plugin, you&#8217;re missing out on the benefits of that work.
The Android, Java, and Kotlin plugins in particular can significantly impact build performance.
Update to the latest version of these plugins for performance improvements.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="parallel_execution"><a class="anchor" href="#parallel_execution"></a><a class="link" href="#parallel_execution">Enable parallel execution</a></h4>
<div class="paragraph">
<p>Most projects consist of more than one subproject. Usually, some of those subprojects are independent of one another;
that is, they do not share state. Yet by default, Gradle only runs one task at a time.
To execute tasks belonging to different subprojects in parallel, use the <code>parallel</code> flag:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock terminal">
<div class="content">
<pre>$ gradle &lt;task&gt; --parallel</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To execute project tasks in parallel by default, add the following setting to the <code>gradle.properties</code> file in the project root or your Gradle home:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.parallel=true</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Parallel builds can significantly improve build times; how much depends on your project structure and
how many dependencies you have between subprojects.
A build whose execution time is dominated by a single subproject won&#8217;t benefit much at all.
Neither will a project with lots of inter-subproject dependencies.
But most multi-subproject builds see a reduction in build times.</p>
</div>
<div class="sect4">
<h5 id="visualize_parallelism_with_build_scans"><a class="anchor" href="#visualize_parallelism_with_build_scans"></a><a class="link" href="#visualize_parallelism_with_build_scans">Visualize parallelism with build scans</a></h5>
<div class="paragraph">
<p>Build scans give you a visual timeline of task execution. In the following
example build, you can see long-running tasks at the beginning and end of the build:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/parallel-task-slow.png" alt="parallel task slow">
</div>
<div class="title">Figure 16. Bottleneck in parallel execution</div>
</div>
<div class="paragraph">
<p>Tweaking the build configuration to run the two slow tasks early on and in parallel
reduces the overall build time from 8 seconds to 5 seconds:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/parallel-task-fast.png" alt="parallel task fast">
</div>
<div class="title">Figure 17. Optimized parallel execution</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable_daemon"><a class="anchor" href="#enable_daemon"></a><a class="link" href="#enable_daemon">Re-enable the Gradle Daemon</a></h4>
<div class="paragraph">
<p>The Gradle Daemon reduces build times by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>caching project information across builds</p>
</li>
<li>
<p>running in the background so every Gradle build doesn&#8217;t have to wait for JVM startup</p>
</li>
<li>
<p>benefiting from continuous runtime optimization in the JVM</p>
</li>
<li>
<p>watching the file system to calculate exactly what needs to be rebuilt before you run a build</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle enables the Daemon by default, but some builds override this preference.
If your build disables the Daemon, you could see a significant performance improvement
from enabling the daemon.</p>
</div>
<div class="paragraph">
<p>You can enable the Daemon at build time with the <code>daemon</code> flag:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock terminal">
<div class="content">
<pre>$ gradle &lt;task&gt; --daemon</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To enable the Daemon by default in older Gradle versions, add the following setting to the
<code>gradle.properties</code> file in the project root or your Gradle home:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.daemon=true</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>On developer machines, you should see a significant performance improvement.
On CI machines, long-lived agents benefit from the Daemon. But short-lived machines don&#8217;t benefit much.
Daemons automatically shut down on memory pressure in Gradle 3.0 and above, so it&#8217;s always safe to leave the Daemon enabled.</p>
</div>
</div>
<div class="sect3">
<h4 id="enable_configuration_cache"><a class="anchor" href="#enable_configuration_cache"></a><a class="link" href="#enable_configuration_cache">Enable the configuration cache</a></h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>This feature has the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The configuration cache does not support all <a href="#config_cache:plugins:core">core Gradle plugins</a> and <a href="#config_cache:not_yet_implemented">features</a>. Full support is a work in progress.<br></p>
</li>
<li>
<p>Your build and the plugins you depend on might require changes to fulfill the <a href="#config_cache:requirements">requirements</a>.<br></p>
</li>
<li>
<p>IDE imports and syncs do not use the configuration cache.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can cache the result of the configuration phase by enabling the configuration cache.
When build configuration inputs remain the same across builds, the configuration cache
allows Gradle to skip the configuration phase entirely.</p>
</div>
<div class="paragraph">
<p>Build configuration inputs include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Init scripts</p>
</li>
<li>
<p>Settings scripts</p>
</li>
<li>
<p>Build scripts</p>
</li>
<li>
<p>System properties used during the configuration phase</p>
</li>
<li>
<p>Gradle properties used during the configuration phase</p>
</li>
<li>
<p>Environment variables used during the configuration phase</p>
</li>
<li>
<p>Configuration files accessed using value suppliers such as providers</p>
</li>
<li>
<p><code>buildSrc</code> inputs, including build configuration inputs and source files</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, Gradle does not use the configuration cache.
To enable the configuration cache at build time, use the <code>configuration-cache</code> flag:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock terminal">
<div class="content">
<pre>$ gradle &lt;task&gt; --configuration-cache</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To enable the configuration cache by default, add the following setting to the <code>gradle.properties</code> file in the project root or your Gradle home:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.configuration-cache=true</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more information about the configuration cache, check out the
<a href="#config_cache">configuration cache documentation</a>.</p>
</div>
<div class="sect4">
<h5 id="additional_configuration_cache_benefits"><a class="anchor" href="#additional_configuration_cache_benefits"></a><a class="link" href="#additional_configuration_cache_benefits">Additional configuration cache benefits</a></h5>
<div class="paragraph">
<p>The configuration cache enables additional benefits as well. When enabled, Gradle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Executes all tasks in parallel, even those in the same subproject.</p>
</li>
<li>
<p>Caches dependency resolution results.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable_incremental_build_for_custom_tasks"><a class="anchor" href="#enable_incremental_build_for_custom_tasks"></a><a class="link" href="#enable_incremental_build_for_custom_tasks">Enable incremental build for custom tasks</a></h4>
<div class="paragraph">
<p>Incremental build is a Gradle optimization that skips running tasks that have previously executed with the same inputs.
If a task’s inputs and its outputs have not changed since the last execution, Gradle skips that task.</p>
</div>
<div class="paragraph">
<p>Most built-in tasks provided by Gradle work with incremental build.
To make a custom task compatible with incremental build, specify the inputs and outputs:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;processTemplatesAdHoc&quot;) {
    inputs.property(&quot;engine&quot;, TemplateEngineType.FREEMARKER)
    inputs.files(fileTree(&quot;src/templates&quot;))
        .withPropertyName(&quot;sourceFiles&quot;)
        .withPathSensitivity(PathSensitivity.RELATIVE)
    inputs.property(&quot;templateData.name&quot;, &quot;docs&quot;)
    inputs.property(&quot;templateData.variables&quot;, mapOf(&quot;year&quot; to &quot;2013&quot;))
    outputs.dir(layout.buildDirectory.dir(&quot;genOutput2&quot;))
        .withPropertyName(&quot;outputDir&quot;)

    doLast {
        // Process the templates here
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">processTemplatesAdHoc</span><span class="delimiter">'</span></span>) {
    inputs.property(<span class="string"><span class="delimiter">'</span><span class="content">engine</span><span class="delimiter">'</span></span>, TemplateEngineType.FREEMARKER)
    inputs.files(fileTree(<span class="string"><span class="delimiter">'</span><span class="content">src/templates</span><span class="delimiter">'</span></span>))
        .withPropertyName(<span class="string"><span class="delimiter">'</span><span class="content">sourceFiles</span><span class="delimiter">'</span></span>)
        .withPathSensitivity(PathSensitivity.RELATIVE)
    inputs.property(<span class="string"><span class="delimiter">'</span><span class="content">templateData.name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">docs</span><span class="delimiter">'</span></span>)
    inputs.property(<span class="string"><span class="delimiter">'</span><span class="content">templateData.variables</span><span class="delimiter">'</span></span>, [<span class="key">year</span>: <span class="string"><span class="delimiter">'</span><span class="content">2013</span><span class="delimiter">'</span></span>])
    outputs.dir(layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">genOutput2</span><span class="delimiter">'</span></span>))
        .withPropertyName(<span class="string"><span class="delimiter">'</span><span class="content">outputDir</span><span class="delimiter">'</span></span>)

    doLast {
        <span class="comment">// Process the templates here</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more information about incremental builds, check out the
<a href="#incremental_build">incremental build documentation</a>.</p>
</div>
<div class="sect4">
<h5 id="visualize_incremental_builds_with_build_scan_timelines"><a class="anchor" href="#visualize_incremental_builds_with_build_scan_timelines"></a><a class="link" href="#visualize_incremental_builds_with_build_scan_timelines">Visualize incremental builds with build scan timelines</a></h5>
<div class="paragraph">
<p>Look at the build scan timeline view to identify tasks that could benefit from incremental builds.
This can also help you understand why tasks execute when you expect Gradle to skip them.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/timeline.png" alt="timeline">
</div>
<div class="title">Figure 18. The timeline view can help with incremental build inspection</div>
</div>
<div class="paragraph">
<p>As you can see in the build scan above, the task was not up-to-date because one of its inputs
(<em>"timestamp"</em>) changed, forcing the task to re-run.</p>
</div>
<div class="paragraph">
<p>Sort tasks by duration to find the slowest tasks in your project.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable_the_build_cache"><a class="anchor" href="#enable_the_build_cache"></a><a class="link" href="#enable_the_build_cache">Enable the build cache</a></h4>
<div class="paragraph">
<p>The build cache is a Gradle optimization that stores task outputs for specific input.
When you later run that same task with the same input, Gradle retrieves the output from the build cache instead of running the task again.
By default, Gradle does not use the build cache.
To enable the build cache at build time, use the <code>build-cache</code> flag:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock terminal">
<div class="content">
<pre>$ gradle &lt;task&gt; --build-cache</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To enable the build cache by default, add the following setting to the <code>gradle.properties</code> file in the project root or your Gradle home:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.caching=true</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use a local build cache to speed up repeated builds on a single machine.
You can also use a shared build cache to speed up repeated builds across multiple machines.
Develocity <a href="https://gradle.com/build-cache/">provides one</a>.
Shared build caches can decrease build times for both CI and developer builds.</p>
</div>
<div class="paragraph">
<p>For more information about the build cache, check out the
<a href="#use_cases_cache">build cache documentation</a>.</p>
</div>
<div class="sect4">
<h5 id="visualize_the_build_cache_with_build_scans"><a class="anchor" href="#visualize_the_build_cache_with_build_scans"></a><a class="link" href="#visualize_the_build_cache_with_build_scans">Visualize the build cache with build scans</a></h5>
<div class="paragraph">
<p>Build scans can help you investigate build cache effectiveness.
In the performance screen, the <em>"Build cache"</em> tab shows you statistics about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>how many tasks interacted with a cache</p>
</li>
<li>
<p>which cache was used</p>
</li>
<li>
<p>transfer and pack/unpack rates for these cache entries</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/cache-performance.png" alt="cache performance">
</div>
<div class="title">Figure 19. Inspecting the performance of the build cache for a build</div>
</div>
<div class="paragraph">
<p>The <em>"Task execution"</em> tab shows details about task cacheability.
Click on a category to see a timeline screen that highlights tasks of that category.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/task-execution-cacheable.png" alt="task execution cacheable">
</div>
<div class="title">Figure 20. A task oriented view of performance</div>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/timeline-not-cacheable.png" alt="timeline not cacheable">
</div>
<div class="title">Figure 21. Timeline screen with 'not cacheable' tasks only</div>
</div>
<div class="paragraph">
<p>Sort by task duration on the timeline screen to highlight tasks with great time saving potential.
The build scan above shows that <code>:task1</code> and <code>:task3</code> could be improved and made cacheable
and shows why Gradle didn&#8217;t cache them.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create_builds_for_specific_developer_workflows"><a class="anchor" href="#create_builds_for_specific_developer_workflows"></a><a class="link" href="#create_builds_for_specific_developer_workflows">Create builds for specific developer workflows</a></h4>
<div class="paragraph">
<p>The fastest task is one that doesn’t execute.
If you can find ways to skip tasks you don’t need to run, you’ll end up with a faster build overall.</p>
</div>
<div class="paragraph">
<p>If your build includes multiple subprojects, create tasks to build those subprojects
independently. This helps you get the most out of caching, since a change to one
subproject won&#8217;t force a rebuild for unrelated subprojects. And this helps reduce
build times for teams that work on unrelated subprojects: there&#8217;s no need for
front-end developers to build the back-end subprojects every time they change the
front-end. Documentation writers don&#8217;t need to build front-end or back-end code
even if the documentation lives in the same project as that code.</p>
</div>
<div class="paragraph">
<p>Instead, create tasks that match the needs of developers. You&#8217;ll still have a single
task graph for the whole project. Each group of users suggests a restricted view of
the task graph: turn that view into a Gradle workflow that excludes unnecessary tasks.</p>
</div>
<div class="paragraph">
<p>Gradle provides several features to create these workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assign tasks to appropriate <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:group">groups</a></p>
</li>
<li>
<p>Create <em>aggregate tasks</em>: tasks with no action that only depend on other tasks, such as <code>assemble</code></p>
</li>
<li>
<p>Defer configuration via <code>gradle.taskGraph.whenReady()</code> and others, so you can perform verification only when it&#8217;s necessary</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="increase_the_heap_size"><a class="anchor" href="#increase_the_heap_size"></a><a class="link" href="#increase_the_heap_size">Increase the heap size</a></h4>
<div class="paragraph">
<p>By default, Gradle reserves 512MB of heap space for your build. This is plenty for most projects.
However, some very large builds might need more memory to hold Gradle&#8217;s model and caches.
If this is the case for you, you can specify a larger memory requirement.
Specify the following property in the <code>gradle.properties</code> file in your project root or your Gradle home:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">org.gradle.jvmargs=-Xmx2048M</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To learn more, check out the <a href="#sec:configuring_jvm_memory">JVM memory configuration documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="optimize_configuration"><a class="anchor" href="#optimize_configuration"></a><a class="link" href="#optimize_configuration">Optimize Configuration</a></h4>
<div class="paragraph">
<p>As described in <a href="#build_lifecycle">the build lifecycle chapter</a>, a
Gradle build goes through 3 phases: initialization, configuration, and execution.
Configuration code always executes regardless of the tasks that run.
As a result, any expensive work performed during configuration slows down every invocation.
Even simple commands like <code>gradle help</code> and <code>gradle tasks</code>.</p>
</div>
<div class="paragraph">
<p>The next few subsections introduce techniques that can reduce time spent in the configuration phase.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can also <a href="#enable_configuration_cache">enable the configuration cache</a> to reduce the impact of a slow configuration phase. But even machines that use the cache still occasionally execute your configuration phase. As a result, you should make the configuration phase as fast as possible with these techniques.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="avoid_expensive_or_blocking_work"><a class="anchor" href="#avoid_expensive_or_blocking_work"></a><a class="link" href="#avoid_expensive_or_blocking_work">Avoid expensive or blocking work</a></h5>
<div class="paragraph">
<p>You should avoid time-intensive work in the configuration phase.
But sometimes it can sneak into your build in non-obvious places.
It’s usually clear when you’re encrypting data or calling remote services during configuration if that code is in a build file.
But logic like this is more often found in plugins and occasionally custom task classes.
Any expensive work in a plugin&#8217;s <code>apply()</code> method or a tasks&#8217;s constructor is a red flag.</p>
</div>
</div>
<div class="sect4">
<h5 id="only_apply_plugins_where_theyre_needed"><a class="anchor" href="#only_apply_plugins_where_theyre_needed"></a><a class="link" href="#only_apply_plugins_where_theyre_needed">Only apply plugins where they&#8217;re needed</a></h5>
<div class="paragraph">
<p>Every plugin and script that you apply to a project adds to the overall configuration time.
Some plugins have a greater impact than others.
That doesn’t mean you should avoid using plugins, but you should take care to only apply them where they’re needed.
For example, it’s easy to apply plugins to all subprojects via <code>allprojects {}</code> or <code>subprojects {}</code> even if not every project needs them.</p>
</div>
<div class="paragraph">
<p>In the above build scan example, you can see that the root build script applies the <code>script-a.gradle</code>
script to 3 subprojects inside the build:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/script-a-application.png" alt="script a application">
</div>
<div class="title">Figure 22. Showing the application of script-a.gradle to the build</div>
</div>
<div class="paragraph">
<p>This script takes 1 second to run. Since it applies to 3 subprojects,
this script cumulatively delays the configuration phase by 3 seconds.
In this situation, there are several ways to reduce the delay:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If only one subproject uses the script, you could remove the script
application from the other subprojects. This reduces the configuration delay
by two seconds in each Gradle invocation.</p>
</li>
<li>
<p>If multiple subprojects, but not all, use the script, you could refactor the script and
all surrounding logic into a custom plugin located in <a href="#sec:using_buildsrc"><code>buildSrc</code></a>.
Apply the custom plugin to only the relevant subprojects, reducing configuration delay and avoiding code duplication.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="statically_compile_tasks_and_plugins"><a class="anchor" href="#statically_compile_tasks_and_plugins"></a><a class="link" href="#statically_compile_tasks_and_plugins">Statically compile tasks and plugins</a></h5>
<div class="paragraph">
<p>Plugin and task authors often write Groovy for its concise syntax, API extensions to the JDK, and functional methods using closures.
But Groovy syntax comes with the cost of dynamic interpretation. As a result, method calls in Groovy take more time and use
more CPU than method calls in Java or Kotlin.</p>
</div>
<div class="paragraph">
<p>You can reduce this cost with static Groovy compilation: add the <code>@CompileStatic</code> annotation to your Groovy classes when you don&#8217;t
explicitly require dynamic features. If you need dynamic Groovy in a method, add the <code>@CompileDynamic</code> annotation to that method.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can write plugins and tasks in a statically compiled language such as Java or Kotlin.</p>
</div>
<div class="paragraph">
<p><strong>Warning:</strong> Gradle&#8217;s Groovy DSL relies heavily on Groovy’s dynamic features. To use static compilation in your plugins, switch to Java-like syntax.</p>
</div>
<div class="paragraph">
<p>The following example defines a task that copies files without dynamic features:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/groovy/MyPlugin.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">project.tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyFiles</span><span class="delimiter">'</span></span>, Copy) { Task t -&gt;
    t.into(project.layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>))
    t.from(project.configurations.getByName(<span class="string"><span class="delimiter">'</span><span class="content">compile</span><span class="delimiter">'</span></span>))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example uses the <code>register()</code> and <code>getByName()</code> methods available on all Gradle “domain object containers”.
Domain object containers include tasks, configurations, dependencies, extensions, and more.
Some collections, such as <code>TaskContainer</code>, have dedicated types with extra methods like <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.TaskContainer.html#org.gradle.api.tasks.TaskContainer:create(java.lang.String,%20java.lang.Class)">create</a>,
which accepts a task type.</p>
</div>
<div class="paragraph">
<p>When you use static compilation, an IDE can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>quickly show errors related to unrecognised types, properties, and methods</p>
</li>
<li>
<p>auto-complete method names</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dependency_resolution"><a class="anchor" href="#dependency_resolution"></a><a class="link" href="#dependency_resolution">Optimize Dependency resolution</a></h4>
<div class="paragraph">
<p>Dependency resolution simplifies integrating third-party libraries and other dependencies into your projects.
Gradle contacts remote servers to discover and download dependencies. You can optimize the way you reference
dependencies to cut down on these remote server calls.</p>
</div>
<div class="sect4">
<h5 id="avoid_unnecessary_and_unused_dependencies"><a class="anchor" href="#avoid_unnecessary_and_unused_dependencies"></a><a class="link" href="#avoid_unnecessary_and_unused_dependencies">Avoid unnecessary and unused dependencies</a></h5>
<div class="paragraph">
<p>Managing third-party libraries and their transitive dependencies adds a significant
cost to project maintenance and build times.</p>
</div>
<div class="paragraph">
<p>Watch out for unused dependencies: when a third-party library stops being
used by isn&#8217;t removed from the dependency list. This happens frequently during refactors.
You can use the <a href="https://github.com/nebula-plugins/gradle-lint-plugin">Gradle Lint plugin</a>
to identify unused dependencies.</p>
</div>
<div class="paragraph">
<p>If you only use a small number of methods or classes in a third-party library, consider:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>implementing the required code yourself in your project</p>
</li>
<li>
<p>copying the required code from the library (with attribution!) if it is open source</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="optimize_repository_order"><a class="anchor" href="#optimize_repository_order"></a><a class="link" href="#optimize_repository_order">Optimize repository order</a></h5>
<div class="paragraph">
<p>When Gradle resolves dependencies, it searches through each repository in the declared order.
To reduce the time spent searching for dependencies, declare the repository hosting
the largest number of your dependencies first. This minimizes the number of network requests
required to resolve all dependencies.</p>
</div>
</div>
<div class="sect4">
<h5 id="minimize_repository_count"><a class="anchor" href="#minimize_repository_count"></a><a class="link" href="#minimize_repository_count">Minimize repository count</a></h5>
<div class="paragraph">
<p>Limit the number of declared repositories to the minimum possible for your build to work.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re using a custom repository server, create a virtual repository that aggregates
several repositories together. Then, add only that repository to your build file.</p>
</div>
</div>
<div class="sect4">
<h5 id="minimize_dynamic_and_snapshot_versions"><a class="anchor" href="#minimize_dynamic_and_snapshot_versions"></a><a class="link" href="#minimize_dynamic_and_snapshot_versions">Minimize dynamic and snapshot versions</a></h5>
<div class="paragraph">
<p>Dynamic versions (e.g. “2.+”), and changing versions (snapshots) force Gradle to contact remote
repositories to find new releases. By default, Gradle only checks once every 24 hours.
But you can change this programmatically with the following settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cacheDynamicVersionsFor</code></p>
</li>
<li>
<p><code>cacheChangingModulesFor</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a build file or initialization script lowers these values, Gradle queries repositories more often.
When you don&#8217;t need the absolute latest release of a dependency every time you build, consider
removing the custom values for these settings.</p>
</div>
<div class="sect5">
<h6 id="find_dynamic_and_changing_versions_with_build_scans"><a class="anchor" href="#find_dynamic_and_changing_versions_with_build_scans"></a><a class="link" href="#find_dynamic_and_changing_versions_with_build_scans">Find dynamic and changing versions with build scans</a></h6>
<div class="paragraph">
<p>You can find all dependencies with dynamic versions via build scans:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/dependency-dynamic-versions.png" alt="dependency dynamic versions">
</div>
<div class="title">Figure 23. Find dependencies with dynamic versions</div>
</div>
<div class="paragraph">
<p>You may be able to use fixed versions like "1.2" and "3.0.3.GA" that allow Gradle to cache versions.
If you must use dynamic and changing versions, tune the cache settings to best meet your needs.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="avoid_dependency_resolution_during_configuration"><a class="anchor" href="#avoid_dependency_resolution_during_configuration"></a><a class="link" href="#avoid_dependency_resolution_during_configuration">Avoid dependency resolution during configuration</a></h5>
<div class="paragraph">
<p>Dependency resolution is an expensive process, both in terms of I/O and computation.
Gradle reduces the required network traffic through caching. But there is still a cost.
Gradle runs the configuration phase on every build. If you trigger dependency resolution
during the configuration phase, every build pays that cost.</p>
</div>
<div class="sect5">
<h6 id="switch_to_declarative_syntax"><a class="anchor" href="#switch_to_declarative_syntax"></a><a class="link" href="#switch_to_declarative_syntax">Switch to declarative syntax</a></h6>
<div class="paragraph">
<p>If you evaluate a configuration file, your project pays the cost of dependency resolution during configuration.
Normally tasks evaluate these files, since you don’t need the files until you’re ready to do something with them in a task action.
Imagine you’re doing some debugging and want to display the files that make up a configuration.
To implement this, you might inject a print statement:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyFiles&quot;) {
    println(&quot;&gt;&gt; Compilation deps: ${configurations.compileClasspath.get().files.map { it.name }}&quot;)
    into(layout.buildDirectory.dir(&quot;output&quot;))
    from(configurations.compileClasspath)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyFiles</span><span class="delimiter">'</span></span>, Copy) {
    println <span class="string"><span class="delimiter">&quot;</span><span class="content">&gt;&gt; Compilation deps: </span><span class="inline"><span class="inline-delimiter">${</span>configurations.compileClasspath.files.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    into(layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>))
    from(configurations.compileClasspath)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>files</code> property forces Gradle to resolve the dependencies. In this example, that happens during the configuration phase.
Because the configuration phase runs on every build, all builds now pay the performance cost of dependency resolution.
You can avoid this cost with a <code>doFirst()</code> action:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyFiles&quot;) {
    into(layout.buildDirectory.dir(&quot;output&quot;))
    // Store the configuration into a variable because referencing the project from the task action
    // is not compatible with the configuration cache.
    val compileClasspath: FileCollection = configurations.compileClasspath.get()
    from(compileClasspath)
    doFirst {
        println(&quot;&gt;&gt; Compilation deps: ${compileClasspath.files.map { it.name }}&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyFiles</span><span class="delimiter">'</span></span>, Copy) {
    into(layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>))
    <span class="comment">// Store the configuration into a variable because referencing the project from the task action</span>
    <span class="comment">// is not compatible with the configuration cache.</span>
    FileCollection compileClasspath = configurations.compileClasspath
    from(compileClasspath)
    doFirst {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">&gt;&gt; Compilation deps: </span><span class="inline"><span class="inline-delimiter">${</span>compileClasspath.files.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>from()</code> declaration doesn’t resolve the dependencies because you’re using the <a href="#sec:what-are-dependency-configurations">dependency configuration</a> itself as an argument, not the files.
The <code>Copy</code> task resolves the configuration itself during task execution.</p>
</div>
</div>
<div class="sect5">
<h6 id="visualize_dependency_resolution_with_build_scans"><a class="anchor" href="#visualize_dependency_resolution_with_build_scans"></a><a class="link" href="#visualize_dependency_resolution_with_build_scans">Visualize dependency resolution with build scans</a></h6>
<div class="paragraph">
<p>The "Dependency resolution" tab on the performance page of a build scan shows dependency
resolution time during the configuration and execution phases:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/bad-dependency-resolution.png" alt="bad dependency resolution">
</div>
<div class="title">Figure 24. Dependency resolution at configuration time</div>
</div>
<div class="paragraph">
<p>Build scans provide another means of identifying this issue.
Your build should spend 0 seconds resolving dependencies during <em>"project configuration"</em>.
This example shows the build resolves dependencies too early in the lifecycle.
You can also find a "Settings and suggestions" tab on the "Performance" page.
This shows dependencies resolved during the configuration phase.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="remove_or_improve_custom_dependency_resolution_logic"><a class="anchor" href="#remove_or_improve_custom_dependency_resolution_logic"></a><a class="link" href="#remove_or_improve_custom_dependency_resolution_logic">Remove or improve custom dependency resolution logic</a></h5>
<div class="paragraph">
<p>Gradle allows users to model dependency resolution in the way that best suits them.
Simple customizations, such as forcing specific versions of a dependency or substituting
one dependency for another, don&#8217;t have a big impact on dependency resolution times.
More complex customizations, such as custom logic that downloads and parses POMs,
can slow down dependency resolution signficantly.</p>
</div>
<div class="paragraph">
<p>Use build scans or profile reports to check that custom dependency resolution logic
doesn&#8217;t adversely affect dependency resolution times.
This could be custom logic you have written yourself, or it could be part of a plugin.</p>
</div>
</div>
<div class="sect4">
<h5 id="remove_slow_or_unexpected_dependency_downloads"><a class="anchor" href="#remove_slow_or_unexpected_dependency_downloads"></a><a class="link" href="#remove_slow_or_unexpected_dependency_downloads">Remove slow or unexpected dependency downloads</a></h5>
<div class="paragraph">
<p>Slow dependency downloads can impact your overall build performance.
Several things could cause this, including a slow internet connection or an overloaded repository server.
On the "Performance" page of a build scan, you&#8217;ll find a "Network Activity" tab.
This tab lists information including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the time spent downloading dependencies</p>
</li>
<li>
<p>the transfer rate of dependency downloads</p>
</li>
<li>
<p>a list of downloads sorted by download time</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following example, two slow dependency downloads took 20 and 40 seconds and slowed down the overall
performance of a build:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/slow-dependency-downloads.png" alt="slow dependency downloads">
</div>
<div class="title">Figure 25. Identify slow dependency downloads</div>
</div>
<div class="paragraph">
<p>Check the download list for unexpected dependency downloads.
For example, you might see a download caused by a dependency using a dynamic version.</p>
</div>
<div class="paragraph">
<p>Eliminate these slow or unexpected downloads by switching to a different repository or dependency.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="optimize_java_projects"><a class="anchor" href="#optimize_java_projects"></a><a class="link" href="#optimize_java_projects">Optimize Java projects</a></h4>
<div class="paragraph">
<p>The following sections apply only to projects that use the <code>java</code> plugin or another JVM language.</p>
</div>
<div class="sect4">
<h5 id="optimize_tests"><a class="anchor" href="#optimize_tests"></a><a class="link" href="#optimize_tests">Optimize tests</a></h5>
<div class="paragraph">
<p>Projects often spend much of their build time testing.
These could be a mixture of unit and integration tests. Integration tests usually take longer.
Build scans can help you identify the slowest tests. You can then focus on speeding up those tests.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/tests-longest.png" alt="tests longest">
</div>
<div class="title">Figure 26. Tests screen, with tests by project, sorted by duration</div>
</div>
<div class="paragraph">
<p>The above build scan shows an interactive test report for all projects in which tests ran.</p>
</div>
<div class="paragraph">
<p>Gradle has several ways to speed up tests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute tests in parallel</p>
</li>
<li>
<p>Fork tests into multiple processes</p>
</li>
<li>
<p>Disable reports</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s look at each of these in turn.</p>
</div>
<div class="sect5">
<h6 id="execute_tests_in_parallel"><a class="anchor" href="#execute_tests_in_parallel"></a><a class="link" href="#execute_tests_in_parallel">Execute tests in parallel</a></h6>
<div class="paragraph">
<p>Gradle can run multiple test cases in parallel.
To enable this feature, override the value of <code>maxParallelForks</code> on the relevant <code>Test</code> task.
For the best performance, use some number less than or equal to the number of available CPU cores:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;Test&gt;().configureEach {
    maxParallelForks = (Runtime.getRuntime().availableProcessors() / 2).coerceAtLeast(1)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(Test).configureEach {
    maxParallelForks = <span class="predefined-type">Runtime</span>.runtime.availableProcessors().intdiv(<span class="integer">2</span>) ?: <span class="integer">1</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Tests in parallel must be independent. They should not share resources such as files or databases.
If your tests do share resources, they could interfere with each other in random and unpredictable ways.</p>
</div>
</div>
<div class="sect5">
<h6 id="fork_tests_into_multiple_processes"><a class="anchor" href="#fork_tests_into_multiple_processes"></a><a class="link" href="#fork_tests_into_multiple_processes">Fork tests into multiple processes</a></h6>
<div class="paragraph">
<p>By default, Gradle runs all tests in a single forked VM.
If there are a lot of tests, or some tests that consume lots of memory,
your tests may take longer than you expect to run. You can increase the
heap size, but garbage collection may slow down your tests.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can fork a new test VM after a certain number of tests have run with the <code>forkEvery</code> setting:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;Test&gt;().configureEach {
    forkEvery = 100
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(Test).configureEach {
    forkEvery = <span class="integer">100</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Forking a VM is an expensive operation. Setting too small a value here slows down testing.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="disable_reports"><a class="anchor" href="#disable_reports"></a><a class="link" href="#disable_reports">Disable reports</a></h6>
<div class="paragraph">
<p>Gradle automatically creates test reports regardless of whether you want to look at them.
That report generation slows down the overall build. You may not need reports if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>you only care if the tests succeeded (rather than why)</p>
</li>
<li>
<p>you use build scans, which provide more information than a local report</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To disable test reports, set <code>reports.html.required</code> and <code>reports.junitXml.required</code> to <code>false</code> in the <code>Test</code> task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;Test&gt;().configureEach {
    reports.html.required = false
    reports.junitXml.required = false
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(Test).configureEach {
    reports.html.required = <span class="predefined-constant">false</span>
    reports.junitXml.required = <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect6">
<h7 id="conditionally_enable_reports"><a class="anchor" href="#conditionally_enable_reports"></a><a class="link" href="#conditionally_enable_reports">Conditionally enable reports</a></h7>
<div class="paragraph">
<p>You might want to conditionally enable reports so you don&#8217;t have to edit the build file to see them.
To enable the reports based on a project property, check for the presence of a property before disabling reports:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;Test&gt;().configureEach {
    if (!project.hasProperty(&quot;createReports&quot;)) {
        reports.html.required = false
        reports.junitXml.required = false
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(Test).configureEach {
    <span class="keyword">if</span> (!project.hasProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">createReports</span><span class="delimiter">&quot;</span></span>)) {
        reports.html.required = <span class="predefined-constant">false</span>
        reports.junitXml.required = <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then, pass the property with <code>-PcreateReports</code> on the command line to generate the reports.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock terminal">
<div class="content">
<pre>$ gradle &lt;task&gt; -PcreateReports</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Or configure the property in the <code>gradle.properties</code> file in the project root or your Gradle home:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">createReports=true</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="optimize_the_compiler"><a class="anchor" href="#optimize_the_compiler"></a><a class="link" href="#optimize_the_compiler">Optimize the compiler</a></h5>
<div class="paragraph">
<p>The Java compiler is fast. But if you’re compiling hundreds of Java classes, even a short compilation time adds up.
Gradle offers a several optimizations for Java compilation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the compiler as a separate process</p>
</li>
<li>
<p>Switch internal-only dependencies to implementation visibility</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="run_the_compiler_as_a_separate_process"><a class="anchor" href="#run_the_compiler_as_a_separate_process"></a><a class="link" href="#run_the_compiler_as_a_separate_process">Run the compiler as a separate process</a></h6>
<div class="paragraph">
<p>You can run the compiler as a separate process with the following configuration for any <code>JavaCompile</code> task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">&lt;task&gt;.options.isFork = true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;task&gt;.options.fork = <span class="predefined-constant">true</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To apply the configuration to <em>all</em> Java compilation tasks, you can <code>configureEach</code> java compilation task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;JavaCompile&gt;().configureEach {
    options.isFork = true
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(JavaCompile).configureEach {
    options.fork = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle reuses this process within the duration the build, so the forking overhead is minimal.
By forking memory-intensive compilation into a separate process, we minimize garbage collection in the main Gradle process.
Less garbage collection means that Gradle&#8217;s infrastructure can run faster, especially when you also use <a href="#parallel_execution">parallel builds</a>.</p>
</div>
<div class="paragraph">
<p>Forking compilation rarely impacts the performance of small projects.
But you should consider it if a single task compiles more than a thousand source files together.</p>
</div>
</div>
<div class="sect5">
<h6 id="switch_internal_only_dependencies_to_implementation_visibility"><a class="anchor" href="#switch_internal_only_dependencies_to_implementation_visibility"></a><a class="link" href="#switch_internal_only_dependencies_to_implementation_visibility">Switch internal-only dependencies to implementation visibility</a></h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Only libraries can define <code>api</code> dependencies. Use the
<a href="#java_library_plugin"><code>java-library</code></a> plugin to define API dependencies in your libraries. Projects that use the <code>java</code> plugin cannot declare <code>api</code> dependencies.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before Gradle 3.4, projects declared dependencies using the <code>compile</code> configuration.
This exposed all of those dependencies to downstream projects. In Gradle 3.4 and above,
you can separate downstream-facing <code>api</code> dependencies from internal-only <code>implementation</code> details.
Implementation dependencies don&#8217;t leak into the compile classpath of downstream projects.
When implementation details change, Gradle only recompiles <code>api</code> dependencies.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
   api(project(&quot;my-utils&quot;))
   implementation(&quot;com.google.guava:guava:21.0&quot;)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
   api project(<span class="string"><span class="delimiter">'</span><span class="content">my-utils</span><span class="delimiter">'</span></span>)
   implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:21.0</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This can significantly reduce the "ripple" of recompilations caused by a single change in
large multi-project builds.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="improve_the_performance_of_older_gradle_releases"><a class="anchor" href="#improve_the_performance_of_older_gradle_releases"></a><a class="link" href="#improve_the_performance_of_older_gradle_releases">Improve the performance of older Gradle releases</a></h4>
<div class="paragraph">
<p>Some projects cannot easily upgrade to a current Gradle version. While you should
always upgrade Gradle to a recent version when possible, we recognize that it isn&#8217;t always
feasible for certain niche situations. In those select cases, check out these recommendations
to optimize older versions of Gradle.</p>
</div>
<div class="sect4">
<h5 id="enable_the_daemon"><a class="anchor" href="#enable_the_daemon"></a><a class="link" href="#enable_the_daemon">Enable the Daemon</a></h5>
<div class="paragraph">
<p>Gradle 3.0 and above enable the Daemon by default. If you are using an older version,
you should <a href="#update_gradle">update to the latest version of Gradle</a>.
If you cannot update your Gradle version, you can <a href="#enable_daemon">enable the Daemon manually</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="use_incremental_compilation"><a class="anchor" href="#use_incremental_compilation"></a><a class="link" href="#use_incremental_compilation">Use incremental compilation</a></h5>
<div class="paragraph">
<p>Gradle can analyze dependencies down to the individual class level
to recompile only the classes affected by a change.
Gradle 4.10 and above enable incremental compilation by default.
To enable incremental compilation by default in older Gradle versions, add the following setting to your
<code>build.gradle</code> file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;JavaCompile&gt;().configureEach {
    options.isIncremental = true
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(JavaCompile).configureEach {
    options.incremental = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use_compile_avoidance"><a class="anchor" href="#use_compile_avoidance"></a><a class="link" href="#use_compile_avoidance">Use compile avoidance</a></h5>
<div class="paragraph">
<p>Often, updates only change internal implementation details of your code, like the body of a method.
These updates are known as <em>ABI-compatible</em> changes: they have no impact on the binary interface of your project.
In Gradle 3.4 and above, ABI-compatible changes no longer trigger recompiles of downstream projects.
This especially improves build times in large multi-project builds with deep dependency chains.</p>
</div>
<div class="paragraph">
<p>Upgrade to a Gradle version above 3.4 to benefit from compile avoidance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you use annotation processors, you need to explicitly declare them in order for compilation avoidance to work.
To learn more, check out the <a href="java_plugin.html#sec:java_compile_avoidance">compile avoidance documentation</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="optimize_android_projects"><a class="anchor" href="#optimize_android_projects"></a><a class="link" href="#optimize_android_projects">Optimize Android projects</a></h4>
<div class="paragraph">
<p>Everything on this page applies to Android builds, since Android builds use Gradle.
Yet Android introduces unique opportunities for optimization.
For more information, check out the
<a href="https://developer.android.com/studio/build/optimize-your-build.html">Android team performance guide</a>.
You can also <a href="https://www.youtube.com/watch?v=7ll-rkLCtyk">watch the accompanying talk</a>
from Google IO 2017.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gradle_daemon"><a class="anchor" href="#gradle_daemon"></a><a class="link" href="#gradle_daemon">Gradle Daemon</a></h3>
<div class="paragraph">
<p>A daemon is a computer program that runs as a background process rather than being under the direct control of an interactive user.</p>
</div>
<div class="paragraph">
<p>Gradle runs on the Java Virtual Machine (JVM) and uses several supporting libraries with non-trivial initialization time.
Startups can be slow.
The <strong>Gradle Daemon</strong> solves this problem.</p>
</div>
<div class="paragraph">
<p>The Gradle Daemon is a long-lived background process that reduces the time it takes to run a build.</p>
</div>
<div class="paragraph">
<p>The Gradle Daemon reduces build times by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Caching project information across builds</p>
</li>
<li>
<p>Running in the background so every Gradle build doesn&#8217;t have to wait for JVM startup</p>
</li>
<li>
<p>Benefiting from continuous runtime optimization in the JVM</p>
</li>
<li>
<p><a href="#sec:daemon_watch_fs">Watching the file system</a> to calculate exactly what needs to be rebuilt before you run a build</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="understanding_wrapper"><a class="anchor" href="#understanding_wrapper"></a><a class="link" href="#understanding_wrapper">Understanding the Daemon</a></h4>
<div class="paragraph">
<p>The Gradle JVM client sends the Daemon build information such as command line arguments, project directories, and environment variables so that it can run the build.
The Wrapper is responsible for resolving dependencies, executing build scripts, creating and running tasks; when it is done, it sends the client the output.
Communication between the client and the Daemon happens via a local socket connection.</p>
</div>
<div class="paragraph">
<p>Daemons use the JVM&#8217;s default minimum heap size.</p>
</div>
<div class="paragraph">
<p>If the requested build environment does not specify a maximum heap size, the Daemon uses up to 512MB of heap.
512MB is adequate for most builds.
Larger builds with hundreds of subprojects, configuration, and source code may benefit from a larger heap size.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:status"><a class="anchor" href="#sec:status"></a><a class="link" href="#sec:status">Check Daemon status</a></h4>
<div class="paragraph">
<p>To get a list of running Daemons and their statuses, use the <code>--status</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle --status</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>   PID STATUS   INFO
 28486 IDLE     7.5
 34247 BUSY     7.5</pre>
</div>
</div>
<div class="paragraph">
<p>Currently, a given Gradle version can only connect to Daemons of the same version.
This means the status output only shows Daemons spawned running the same version of Gradle as the current project.</p>
</div>
</div>
<div class="sect3">
<h4 id="find_all_daemons"><a class="anchor" href="#find_all_daemons"></a><a class="link" href="#find_all_daemons">Find Daemons</a></h4>
<div class="paragraph">
<p>If you have installed the Java Development Kit (JDK), you can view live daemons with the <code>jps</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ jps</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>33920 Jps
27171 GradleDaemon
22792</pre>
</div>
</div>
<div class="paragraph">
<p>Live Daemons appear under the name <code>GradleDaemon</code>.
Because this command uses the JDK, you can view Daemons running any version of Gradle.</p>
</div>
</div>
<div class="sect3">
<h4 id="enable_deamon"><a class="anchor" href="#enable_deamon"></a><a class="link" href="#enable_deamon">Enable Daemon</a></h4>
<div class="paragraph">
<p>Gradle enables the Daemon by default since Gradle 3.0.
If your project doesn&#8217;t use the Daemon, you can enable it for a single build with the <code>--daemon</code> flag when you run a build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle &lt;task&gt; --daemon</pre>
</div>
</div>
<div class="paragraph">
<p>This flag overrides any settings that disable the Daemon in your project or user <code>gradle.properties</code> files.</p>
</div>
<div class="paragraph">
<p>To enable the Daemon by default in older Gradle versions, add the following setting to the <code>gradle.properties</code> file in the project root or your Gradle User Home (<code>GRADLE_USER_HOME</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.daemon=true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:disabling_the_daemon"><a class="anchor" href="#sec:disabling_the_daemon"></a><a class="link" href="#sec:disabling_the_daemon">Disable Daemon</a></h4>
<div class="paragraph">
<p>You can disable the Daemon in multiple ways but there are important considerations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Single-use Daemon </dt>
<dd>
<p>If the JVM args of the client process don&#8217;t match what the build requires, a single-used Daemon (disposable JVM) is created.
This means the Daemon is required for the build, so it is created, used, and then stopped at the end of the build.</p>
</dd>
<dt class="hdlist1">No Daemon </dt>
<dd>
<p>If the <code>JAVA_OPTS</code> and <code>GRADLE_OPTS</code> match <code>org.gradle.jvmargs</code>, the Daemon will not be used at all since the build happens in the client JVM.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="disable_for_a_build"><a class="anchor" href="#disable_for_a_build"></a><a class="link" href="#disable_for_a_build">Disable for a build</a></h5>
<div class="paragraph">
<p>To disable the Daemon for a single build, pass the <code>--no-daemon</code> flag when you run a build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle &lt;task&gt; --no-daemon</pre>
</div>
</div>
<div class="paragraph">
<p>This flag overrides any settings that enable the Daemon in your project including the <code>gradle.properties</code> files.</p>
</div>
</div>
<div class="sect4">
<h5 id="disable_for_a_project"><a class="anchor" href="#disable_for_a_project"></a><a class="link" href="#disable_for_a_project">Disable for a project</a></h5>
<div class="paragraph">
<p>To disable the Daemon for all builds of a project, add <code>org.gradle.daemon=false</code> to the <code>gradle.properties</code> file in the project root.</p>
</div>
</div>
<div class="sect4">
<h5 id="disable_for_a_user"><a class="anchor" href="#disable_for_a_user"></a><a class="link" href="#disable_for_a_user">Disable for a user</a></h5>
<div class="paragraph">
<p>On Windows, this command disables the Daemon for the current user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">(if not exist &quot;%USERPROFILE%/.gradle&quot; mkdir &quot;%USERPROFILE%/.gradle&quot;) &amp;&amp; (echo. &gt;&gt; &quot;%USERPROFILE%/.gradle/gradle.properties&quot; &amp;&amp; echo org.gradle.daemon=false &gt;&gt; &quot;%USERPROFILE%/.gradle/gradle.properties&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>On UNIX-like operating systems, the following Bash shell command disables the Daemon for the current user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mkdir -p ~/.gradle &amp;&amp; echo &quot;org.gradle.daemon=false&quot; &gt;&gt; ~/.gradle/gradle.properties</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="disable_globally"><a class="anchor" href="#disable_globally"></a><a class="link" href="#disable_globally">Disable globally</a></h5>
<div class="paragraph">
<p>There are two recommended ways to disable the Daemon globally across an environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add <code>org.gradle.daemon=false</code> to the <code>$<a href="#dir:gradle_user_home">GRADLE_USER_HOME</a></code>/gradle.properties` file</p>
</li>
<li>
<p>add the flag <code>-Dorg.gradle.daemon=false</code> to the <code>GRADLE_OPTS</code> environment variable</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Don&#8217;t forget to make sure your JVM arguments and <code>GRADLE_OPTS</code> / <code>JAVA_OPTS</code> match if you want to completely disable the Daemon and not simply invoke a single-use one.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:stopping_an_existing_daemon"><a class="anchor" href="#sec:stopping_an_existing_daemon"></a><a class="link" href="#sec:stopping_an_existing_daemon">Stop Daemon</a></h4>
<div class="paragraph">
<p>It can be helpful to stop the Daemon when troubleshooting or debugging a failure.</p>
</div>
<div class="paragraph">
<p>Daemons automatically stop given any of the following conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Available system memory is low</p>
</li>
<li>
<p>Daemon has been idle for 3 hours</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To stop running Daemon processes, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle --stop</pre>
</div>
</div>
<div class="paragraph">
<p>This terminates all Daemon processes started with the same version of Gradle used to execute the command.</p>
</div>
<div class="paragraph">
<p>You can also kill Daemons manually with your operating system.
To find the PIDs for all Daemons regardless of Gradle version, see <a href="#find_all_daemons">Find Daemons</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:daemon_jvm_criteria"><a class="anchor" href="#sec:daemon_jvm_criteria"></a><a class="link" href="#sec:daemon_jvm_criteria">Configuring the JVM to be used</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Daemon JVM discovery and criteria are <a href="#sec:incubating_state">incubating</a> features and are subject to change in a future release.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, the Gradle daemon runs on the same JVM installation that started the build.
Gradle defaults to the current shell path and <code>JAVA_HOME</code> environment variable to locate a usable JVM.</p>
</div>
<div class="paragraph">
<p>Alternatively, you could specify a different JVM installation for the build using the <a href="#sec:gradle_configuration_properties"><code>org.gradle.java.home</code> Gradle property</a> or programmatically through the Tooling API.</p>
</div>
<div class="paragraph">
<p>Building on the <a href="#toolchains">toolchain feature</a>, you can now use declarative criteria to specify the JVM requirements for the build.</p>
</div>
<div class="sect4">
<h5 id="daemon_jvm_criteria"><a class="anchor" href="#daemon_jvm_criteria"></a><a class="link" href="#daemon_jvm_criteria">Daemon JVM criteria</a></h5>
<div class="paragraph">
<p>The <em>daemon JVM criteria</em> is controlled by a task, similarly to how <a href="#customizing_wrapper"><code>wrapper</code> task</a> updates the wrapper properties.
When the task runs, it creates or updates the criteria in the <code>gradle/gradle-daemon-jvm.properties</code> file.
For more control, the task can be further configured in the build script or via command-line arguments.</p>
</div>
<div class="paragraph">
<p>As with the wrapper, the generated file should be checked into version control.
This will ensure any developer or CI server that runs the build will use the same JVM version.</p>
</div>
<div class="paragraph">
<p>With the following configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.updateDaemonJvm {
    jvmVersion = JavaVersion.VERSION_17
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">updateDaemonJvm</span><span class="delimiter">'</span></span>) {
    jvmVersion = JavaVersion.VERSION_17
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew updateDaemonJvm</pre>
</div>
</div>
<div class="paragraph">
<p>The following file will be generated:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">gradle/gradle-daemon-jvm.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">#This file is generated by updateDaemonJvm
toolchainVersion=17</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The same properties file can be produced without configuring the task in the build script, and using a command-line argument instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew updateDaemonJvm --jvm-version=17</pre>
</div>
</div>
<div class="paragraph">
<p>If you run the task without any arguments, and the properties file does not exist, then the JVM used by the daemon will provide the version value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Currently, Gradle only supports the major JVM version as a criterion.
Support for other toolchains criteria will be added in a future release.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On the next execution of Gradle, the launcher will use this file to locate a compatible JVM installation and start the daemon with it.</p>
</div>
</div>
<div class="sect4">
<h5 id="daemon_jvm_discovery"><a class="anchor" href="#daemon_jvm_discovery"></a><a class="link" href="#daemon_jvm_discovery">Daemon JVM discovery</a></h5>
<div class="paragraph">
<p>To locate a compatible JVM installation, Gradle re-uses the mechanism provided by the <a href="#toolchains">Java Toolchains</a> feature.
This feature is used to locate a JVM installation that matches the criteria specified in the <code>gradle/gradle-daemon-jvm.properties</code> file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Currently, the <em>daemon JVM discovery</em> does not support auto-provisioning of new JVM installations.
This will be added in a future release.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:tools_and_ides"><a class="anchor" href="#sec:tools_and_ides"></a><a class="link" href="#sec:tools_and_ides">Tools &amp; IDEs</a></h4>
<div class="paragraph">
<p>The <a href="#embedding">Gradle Tooling API</a> used by IDEs and other tools to integrate with Gradle <em>always</em> uses the Gradle Daemon to execute builds.
If you execute Gradle builds from within your IDE, you already use the Gradle Daemon.
There is no need to enable it for your environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="continuous_integration"><a class="anchor" href="#continuous_integration"></a><a class="link" href="#continuous_integration">Continuous Integration</a></h4>
<div class="paragraph">
<p>We recommend using the Daemon for developer machines and Continuous Integration (CI) servers.</p>
</div>
</div>
<div class="sect3">
<h4 id="deamon_compatibility"><a class="anchor" href="#deamon_compatibility"></a><a class="link" href="#deamon_compatibility">Compatibility</a></h4>
<div class="paragraph">
<p>Gradle starts a new Daemon if no idle or compatible Daemons exist.</p>
</div>
<div class="paragraph">
<p>The following values determine compatibility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Requested build environment</strong>, including the following:</p>
<div class="ulist">
<ul>
<li>
<p>Java version</p>
</li>
<li>
<p>JVM attributes</p>
</li>
<li>
<p>JVM properties</p>
</li>
</ul>
</div>
</li>
<li>
<p>Gradle version</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Compatibility is based on exact matches of these values.
For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a Daemon is available with a Java 8 runtime, but the requested build environment calls for Java 10,
then the Daemon is not compatible.</p>
</li>
<li>
<p>If a Daemon is available running Gradle 7.0, but the current build uses Gradle 7.4, then the
Daemon is not compatible.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Certain properties of a Java runtime are <em>immutable</em>: they cannot be changed once the JVM has started.
The following JVM system properties are immutable:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>file.encoding</code></p>
</li>
<li>
<p><code>user.language</code></p>
</li>
<li>
<p><code>user.country</code></p>
</li>
<li>
<p><code>user.variant</code></p>
</li>
<li>
<p><code>java.io.tmpdir</code></p>
</li>
<li>
<p><code>javax.net.ssl.keyStore</code></p>
</li>
<li>
<p><code>javax.net.ssl.keyStorePassword</code></p>
</li>
<li>
<p><code>javax.net.ssl.keyStoreType</code></p>
</li>
<li>
<p><code>javax.net.ssl.trustStore</code></p>
</li>
<li>
<p><code>javax.net.ssl.trustStorePassword</code></p>
</li>
<li>
<p><code>javax.net.ssl.trustStoreType</code></p>
</li>
<li>
<p><code>com.sun.management.jmxremote</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following JVM attributes controlled by startup arguments are also immutable:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The maximum heap size (the <code>-Xmx</code> JVM argument)</p>
</li>
<li>
<p>The minimum heap size (the <code>-Xms</code> JVM argument)</p>
</li>
<li>
<p>The boot classpath (the <code>-Xbootclasspath</code> argument)</p>
</li>
<li>
<p>The "assertion" status (the <code>-ea</code> argument)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the requested build environment requirements for any of these properties and attributes
differ from the Daemon&#8217;s JVM requirements, the Daemon is not compatible.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For more information about build environments, see <a href="#build_environment">the build environment documentation</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:why_the_daemon"><a class="anchor" href="#sec:why_the_daemon"></a><a class="link" href="#sec:why_the_daemon">Performance Impact</a></h4>
<div class="paragraph">
<p>The Daemon can reduce build times by 15-75% when you build the same project repeatedly.</p>
</div>
<div class="paragraph">
<p>In between builds, the Daemon waits idly for the next build.
As a result, your machine only loads Gradle into memory once for multiple builds instead of once per build.
This is a significant performance optimization.</p>
</div>
<div class="sect4">
<h5 id="runtime_code_optimizations"><a class="anchor" href="#runtime_code_optimizations"></a><a class="link" href="#runtime_code_optimizations">Runtime Code Optimizations</a></h5>
<div class="paragraph">
<p>The JVM gains significant performance from <strong>runtime code optimization</strong>: optimizations applied to code while it runs.</p>
</div>
<div class="paragraph">
<p>JVM implementations like OpenJDK&#8217;s Hotspot progressively optimize code during execution.
Consequently, subsequent builds can be faster purely due to this optimization process.</p>
</div>
<div class="paragraph">
<p>With the Daemon, perceived build times can drop dramatically between a project&#8217;s 1<sup>st</sup> and 10<sup>th</sup> builds.</p>
</div>
</div>
<div class="sect4">
<h5 id="memory_caching"><a class="anchor" href="#memory_caching"></a><a class="link" href="#memory_caching">Memory Caching</a></h5>
<div class="paragraph">
<p>The Daemon enables in-memory caching across builds.
This includes classes for plugins and build scripts.</p>
</div>
<div class="paragraph">
<p>Similarly, the Daemon maintains in-memory caches of build data, such as the hashes of task inputs and outputs for incremental builds.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="performance_monitoring"><a class="anchor" href="#performance_monitoring"></a><a class="link" href="#performance_monitoring">Performance Monitoring</a></h4>
<div class="paragraph">
<p>Gradle actively monitors heap usage to detect memory leaks in the Daemon.</p>
</div>
<div class="paragraph">
<p>When a memory leak exhausts available heap space, the Daemon:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Finishes the currently running build.</p>
</li>
<li>
<p>Restarts before running the next build.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Gradle enables this monitoring by default.</p>
</div>
<div class="paragraph">
<p>To disable this monitoring, set the <code>org.gradle.daemon.performance.enable-monitoring</code> Daemon option to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>You can do this on the command line with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle &lt;task&gt; -Dorg.gradle.daemon.performance.enable-monitoring=false</pre>
</div>
</div>
<div class="paragraph">
<p>Or you can configure the property in the <code>gradle.properties</code> file in the project root or your GRADLE_USER_HOME (Gradle User Home):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.daemon.performance.enable-monitoring=false</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec:daemon_watch_fs"><a class="anchor" href="#sec:daemon_watch_fs"></a><a class="link" href="#sec:daemon_watch_fs">File System Watching</a></h3>
<div class="paragraph">
<p>Gradle maintains a Virtual File System (VFS) to calculate what needs to be rebuilt on repeat builds of a project.
By watching the file system, Gradle keeps the VFS current between builds.</p>
</div>
<div class="sect3">
<h4 id="enable"><a class="anchor" href="#enable"></a><a class="link" href="#enable">Enable</a></h4>
<div class="paragraph">
<p>Gradle enables file system watching by default for supported operating systems since Gradle 7.</p>
</div>
<div class="paragraph">
<p>Run the build with the '--watch-fs' flag to force file system watching for a build.</p>
</div>
<div class="paragraph">
<p>To force file system watching for all builds (unless disabled with <code>--no-watch-fs</code>), add the following value to <code>gradle.properties</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.vfs.watch=true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="disable"><a class="anchor" href="#disable"></a><a class="link" href="#disable">Disable</a></h4>
<div class="paragraph">
<p>To disable file system watching:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use the <code>--no-watch-fs</code> flag</p>
</li>
<li>
<p>set <code>org.gradle.vfs.watch=false</code> in <code>gradle.properties</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="supported_operating_systems"><a class="anchor" href="#supported_operating_systems"></a><a class="link" href="#supported_operating_systems">Supported Operating Systems</a></h4>
<div class="paragraph">
<p>Gradle uses native operating system features to watch the file system.
Gradle supports file system watching on the following operating systems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Windows 10, version 1709 and later</p>
</li>
<li>
<p>Linux, tested on the following distributions:</p>
<div class="ulist">
<ul>
<li>
<p>Ubuntu 16.04 or later</p>
</li>
<li>
<p>CentOS Stream 8 or later</p>
</li>
<li>
<p>Red Hat Enterprise Linux (RHEL) 8 or later</p>
</li>
<li>
<p>Amazon Linux 2 or later</p>
</li>
</ul>
</div>
</li>
<li>
<p>macOS 12 (Monterey) or later on Intel and ARM architectures</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="supported_file_systems"><a class="anchor" href="#supported_file_systems"></a><a class="link" href="#supported_file_systems">Supported File Systems</a></h4>
<div class="paragraph">
<p>File system watching supports the following file system types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>APFS</p>
</li>
<li>
<p>btrfs</p>
</li>
<li>
<p>ext3</p>
</li>
<li>
<p>ext4</p>
</li>
<li>
<p>XFS</p>
</li>
<li>
<p>HFS+</p>
</li>
<li>
<p>NTFS</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle also supports VirtualBox&#8217;s shared folders.</p>
</div>
<div class="paragraph">
<p>Network file systems like Samba and NFS are not supported.</p>
</div>
<div class="openblock">
<div class="title">Symlinks</div>
<div class="content">
<div class="paragraph">
<p>File system watching is not compatible with symlinks.
If your project files include symlinks, symlinked files do not benefit from file system-watching optimizations.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="unsupported_file_systems"><a class="anchor" href="#unsupported_file_systems"></a><a class="link" href="#unsupported_file_systems">Unsupported File Systems</a></h4>
<div class="paragraph">
<p>When enabled by default, file system watching acts conservatively when it encounters content on unsupported file systems.
This can happen if you mount a project directory or subdirectory from a network drive.
Gradle doesn&#8217;t retain information about unsupported file systems between builds when enabled by default.
If you explicitly enable file system watching, Gradle retains information about unsupported file systems between builds.</p>
</div>
</div>
<div class="sect3">
<h4 id="logging_2"><a class="anchor" href="#logging_2"></a><a class="link" href="#logging_2">Logging</a></h4>
<div class="paragraph">
<p>To view information about Virtual File System (VFS) changes at the beginning and end of a build, enable verbose VFS logging.</p>
</div>
<div class="paragraph">
<p>Set the <code>org.gradle.vfs.verbose</code> Daemon option to <code>true</code> to enable verbose logging.</p>
</div>
<div class="paragraph">
<p>You can do this on the command line with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle &lt;task&gt; -Dorg.gradle.vfs.verbose=true</pre>
</div>
</div>
<div class="paragraph">
<p>Or configure the property in the <code>gradle.properties</code> file in the project root or your Gradle User Home:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.vfs.verbose=true</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This produces the following output at the start and end of the build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle assemble --watch-fs -Dorg.gradle.vfs.verbose=true</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Received 3 file system events since last build while watching 1 locations
Virtual file system retained information about 2 files, 2 directories and 0 missing files since last build
&gt; Task :compileJava NO-SOURCE
&gt; Task :processResources NO-SOURCE
&gt; Task :classes UP-TO-DATE
&gt; Task :jar UP-TO-DATE
&gt; Task :assemble UP-TO-DATE

BUILD SUCCESSFUL in 58ms
1 actionable task: 1 up-to-date
Received 5 file system events during the current build while watching 1 locations
Virtual file system retains information about 3 files, 2 directories and 2 missing files until next build</pre>
</div>
</div>
<div class="paragraph">
<p>On Windows and macOS, Gradle might report changes received since the last build, even if you haven&#8217;t changed anything.
These are harmless notifications about changes to Gradle&#8217;s caches and can be safely ignored.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:daemon_watch_fs_troubleshooting"><a class="anchor" href="#sec:daemon_watch_fs_troubleshooting"></a><a class="link" href="#sec:daemon_watch_fs_troubleshooting">Troubleshooting</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Gradle does not detect some changes</dt>
<dd>
<p><em>Please <a href="https://gradle-community.slack.com/app_redirect?channel=file-system-watching">let us know on the Gradle community Slack</a>.</em>
If a build declares its inputs and outputs correctly, this should not happen.
So it&#8217;s either a bug we must fix or your build lacks declaration for some inputs or outputs.</p>
</dd>
<dt class="hdlist1">VFS state dropped due to lost state</dt>
<dd>
<p>Did you receive a message that reads <code>Dropped VFS state due to lost state</code> during a build?
<em>Please <a href="https://gradle-community.slack.com/app_redirect?channel=file-system-watching">let us know on the Gradle community Slack</a>.</em>
This means that your build cannot benefit from file system watching for one of the following reasons:</p>
<div class="ulist">
<ul>
<li>
<p>the Daemon received an unknown file system event</p>
</li>
<li>
<p>too many changes happened, and the watching API couldn&#8217;t handle it</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Too many open files on macOS</dt>
<dd>
<p>If you receive the <code>java.io.IOException: Too many open files</code> error on macOS, raise your open files limit.
See <a href="https://superuser.com/a/443168/8117">this post</a> for more details.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="sec:inotify_watches_limit"><a class="anchor" href="#sec:inotify_watches_limit"></a><a class="link" href="#sec:inotify_watches_limit">Adjust inotify watches limit on Linux</a></h5>
<div class="paragraph">
<p>File system watching uses <a href="http://en.wikipedia.org/wiki/Inotify">inotify</a> on Linux.
Depending on the size of your build, it may be necessary to increase inotify limits.
If you are using an IDE, then you probably already had to increase the limits in the past.</p>
</div>
<div class="paragraph">
<p>File system watching uses one inotify watch per watched directory.
You can see the current limit of inotify watches per user by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cat /proc/sys/fs/inotify/max_user_watches</code></pre>
</div>
</div>
<div class="paragraph">
<p>To increase the limit to e.g. 512K watches run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">sudo sysctl -p --system</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each used inotify watch takes up to 1KB of memory.
Assuming inotify uses all the 512K watches then file system watching could use up to 500MB.
In a memory-constrained environment, you may want to disable file system watching.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:inotify_instances_limit"><a class="anchor" href="#sec:inotify_instances_limit"></a><a class="link" href="#sec:inotify_instances_limit">Inspect inotify instances limit on Linux</a></h5>
<div class="paragraph">
<p>File system watching initializes one inotify instance per daemon.
You can see the current limit of inotify instances per user by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cat /proc/sys/fs/inotify/max_user_instances</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default per-user instances limit should be high enough, so we don&#8217;t recommend increasing that value manually.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="incremental_build"><a class="anchor" href="#incremental_build"></a><a class="link" href="#incremental_build">Incremental build</a></h3>
<div class="paragraph">
<p>An important part of any build tool is the ability to avoid doing work that has already been done.
Consider the process of compilation.
Once your source files have been compiled, there should be no need to recompile them unless something has changed that affects the output, such as the modification of a source file or the removal of an output file.
And compilation can take a significant amount of time, so skipping the step when it’s not needed saves a lot of time.</p>
</div>
<div class="paragraph">
<p>Gradle supports this behavior out of the box through a feature called <strong>incremental build</strong>.
You have almost certainly already seen it in action.
When you run a task and the task is marked with <code>UP-TO-DATE</code> in the console output, this means incremental build is at work.</p>
</div>
<div class="paragraph">
<p>How does an incremental build work? How can you make sure your tasks support running incrementally? Let’s take a look.</p>
</div>
<div class="sect3">
<h4 id="sec:task_inputs_outputs"><a class="anchor" href="#sec:task_inputs_outputs"></a><a class="link" href="#sec:task_inputs_outputs">Task inputs and outputs</a></h4>
<div class="paragraph">
<p>In the most common case, a task takes some inputs and generates some outputs.
We can consider the process of Java compilation as an example of a task.
The Java source files act as inputs of the task, while the generated class files, i.e. the result of the compilation, are the outputs of the task.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/taskInputsOutputs.png" alt="taskInputsOutputs">
</div>
<div class="title">Figure 27. Example task inputs and outputs</div>
</div>
<div class="paragraph">
<p>An important characteristic of an input is that it affects one or more outputs, as you can see from the previous figure. Different bytecode is generated depending on the content of the source files and the minimum version of the Java runtime you want to run the code on. That makes them task inputs. But whether compilation has 500MB or 600MB of maximum memory available, determined by the <code>memoryMaximumSize</code> property, has no impact on what bytecode gets generated. In Gradle terminology, <code>memoryMaximumSize</code> is just an internal task property.</p>
</div>
<div class="paragraph">
<p>As part of incremental build, Gradle tests whether any of the task inputs or outputs has changed since the last build. If they haven’t, Gradle can consider the task up to date and therefore skip executing its actions. Also note that incremental build won’t work unless a task has at least one task output, although tasks usually have at least one input as well.</p>
</div>
<div class="paragraph">
<p>What this means for build authors is simple: you need to tell Gradle which task properties are inputs and which are outputs. If a task property affects the output, be sure to register it as an input, otherwise the task will be considered up to date when it’s not. Conversely, don’t register properties as inputs if they don’t affect the output, otherwise the task will potentially execute when it doesn’t need to. Also be careful of non-deterministic tasks that may generate different output for exactly the same inputs: these should not be configured for incremental build as the up-to-date checks won’t work.</p>
</div>
<div class="paragraph">
<p>Let’s now look at how you can register task properties as inputs and outputs.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_input_output_annotations"><a class="anchor" href="#sec:task_input_output_annotations"></a><a class="link" href="#sec:task_input_output_annotations">Declaring inputs and outputs via annotations</a></h4>
<div class="paragraph">
<p>If you’re implementing a custom task as a class, then it takes just two steps to make it work with incremental build:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create typed properties (via getter methods) for each of your task inputs and outputs</p>
</li>
<li>
<p>Add the appropriate annotation to each of those properties</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Annotations must be placed on getters or on Groovy properties. Annotations placed on setters, or on a Java field without a corresponding annotated getter, are ignored.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Gradle supports four main categories of inputs and outputs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Simple values</p>
<div class="paragraph">
<p>Things like strings and numbers. More generally, a simple value can have any type that implements <code>Serializable</code>.</p>
</div>
</li>
<li>
<p>Filesystem types</p>
<div class="paragraph">
<p>These consist of <code>RegularFile</code>, <code>Directory</code> and the standard <code>File</code> class but also derivatives of Gradle’s <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a> type and anything else that can be passed to either the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> method — for single file/directory properties — or the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(java.lang.Object...)</a> method.</p>
</div>
</li>
<li>
<p>Dependency resolution results</p>
<div class="paragraph">
<p>This includes the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/result/ResolvedArtifactResult.html">ResolvedArtifactResult</a> type for artifact metadata and the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/result/ResolvedComponentResult.html">ResolvedComponentResult</a> type for dependency graphs.
Note that they are only supported wrapped in a <code>Provider</code>.</p>
</div>
</li>
<li>
<p>Nested values</p>
<div class="paragraph">
<p>Custom types that don’t conform to the other two categories but have their own properties that are inputs or outputs. In effect, the task inputs or outputs are nested inside these custom types.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, imagine you have a task that processes templates of varying types, such as FreeMarker, Velocity, Moustache, etc. It takes template source files and combines them with some model data to generate populated versions of the template files.</p>
</div>
<div class="paragraph">
<p>This task will have three inputs and one output:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Template source files</p>
</li>
<li>
<p>Model data</p>
</li>
<li>
<p>Template engine</p>
</li>
<li>
<p>Where the output files are written</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you’re writing a custom task class, it’s easy to register properties as inputs or outputs via annotations. To demonstrate, here is a skeleton task implementation with some suitable inputs and outputs, along with their annotations:</p>
</div>
<div id="ex-custom-task-class" class="exampleblock">
<div class="title">Example 319. <a href="#ex-custom-task-class">Custom task class</a></div>
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/java/org/example/ProcessTemplates.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.example</span>;

<span class="keyword">import</span> <span class="include">java.util.HashMap</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.ConfigurableFileCollection</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.DirectoryProperty</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.FileSystemOperations</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Property</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks</span>.*;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">ProcessTemplates</span> <span class="directive">extends</span> DefaultTask {

    <span class="annotation">@Input</span>
    <span class="directive">public</span> <span class="directive">abstract</span> Property&lt;TemplateEngineType&gt; getTemplateEngine();

    <span class="annotation">@InputFiles</span>
    <span class="directive">public</span> <span class="directive">abstract</span> ConfigurableFileCollection getSourceFiles();

    <span class="annotation">@Nested</span>
    <span class="directive">public</span> <span class="directive">abstract</span> TemplateData getTemplateData();

    <span class="annotation">@OutputDirectory</span>
    <span class="directive">public</span> <span class="directive">abstract</span> DirectoryProperty getOutputDir();

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> <span class="directive">abstract</span> FileSystemOperations getFs();

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> processTemplates() {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/java/org/example/TemplateData.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.example</span>;

<span class="keyword">import</span> <span class="include">org.gradle.api.provider.MapProperty</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Property</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.Input</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">TemplateData</span> {

    <span class="annotation">@Input</span>
    <span class="directive">public</span> <span class="directive">abstract</span> Property&lt;<span class="predefined-type">String</span>&gt; getName();

    <span class="annotation">@Input</span>
    <span class="directive">public</span> <span class="directive">abstract</span> MapProperty&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; getVariables();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle processTemplates</code></div>
<div class="content">
<pre>&gt; gradle processTemplates
&gt; Task :processTemplates

BUILD SUCCESSFUL in 0s
3 actionable tasks: 3 up-to-date</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle processTemplates</code> (run again)</div>
<div class="content">
<pre>&gt; gradle processTemplates
&gt; Task :processTemplates UP-TO-DATE

BUILD SUCCESSFUL in 0s
3 actionable tasks: 3 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There’s plenty to talk about in this example, so let’s work through each of the input and output properties in turn:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>templateEngine</code></p>
<div class="paragraph">
<p>Represents which engine to use when processing the source templates, e.g. FreeMarker, Velocity, etc. You could implement this as a string, but in this case we have gone for a custom enum as it provides greater type information and safety. Since enums implement <code>Serializable</code> automatically, we can treat this as a simple value and use the <code>@Input</code> annotation, just as we would with a <code>String</code> property.</p>
</div>
</li>
<li>
<p><code>sourceFiles</code></p>
<div class="paragraph">
<p>The source templates that the task will be processing. Single files and collections of files need their own special annotations. In this case, we’re dealing with a collection of input files and so we use the <code>@InputFiles</code> annotation. You’ll see more file-oriented annotations in a table later.</p>
</div>
</li>
<li>
<p><code>templateData</code></p>
<div class="paragraph">
<p>For this example, we’re using a custom class to represent the model data. However, it does not implement <code>Serializable</code>, so we can’t use the <code>@Input</code> annotation. That’s not a problem as the properties within <code>TemplateData</code> — a string and a hash map with serializable type parameters — are serializable and can be annotated with <code>@Input</code>. We use <code>@Nested</code> on <code>templateData</code> to let Gradle know that this is a value with nested input properties.</p>
</div>
</li>
<li>
<p><code>outputDir</code></p>
<div class="paragraph">
<p>The directory where the generated files go. As with input files, there are several annotations for output files and directories. A property representing a single directory requires <code>@OutputDirectory</code>. You’ll learn about the others soon.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>These annotated properties mean that Gradle will skip the task if none of the source files, template engine, model data or generated files has changed since the previous time Gradle executed the task. This will often save a significant amount of time. You can learn how Gradle detects <a href="#sec:how_does_it_work">changes later</a>.</p>
</div>
<div class="paragraph">
<p>This example is particularly interesting because it works with collections of source files. What happens if only one source file changes? Does the task process all the source files again or just the modified one? That depends on the task implementation. If the latter, then the task itself is incremental, but that’s a different feature to the one we’re discussing here. Gradle does help task implementers with this via its <a href="#incremental_tasks">incremental task inputs</a> feature.</p>
</div>
<div class="paragraph">
<p>Now that you have seen some of the input and output annotations in practice, let’s take a look at all the annotations available to you and when you should use them. The table below lists the available annotations and the corresponding property type you can use with each one.</p>
</div>
<table id="table:incremental_build_annotations" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. Incremental build property type annotations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Expected property type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Input.html">Input</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any <code>Serializable</code> type or dependency resolution result types</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A simple input value or dependency resolution results</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/InputFile.html">InputFile</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A single input file (not directory)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/InputDirectory.html">InputDirectory</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A single input directory (not file)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/InputFiles.html">InputFiles</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An iterable of input files and directories</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Classpath.html">Classpath</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An iterable of input files and directories that represent a Java classpath. This allows the task to ignore irrelevant changes to the property, such as different names for the same files. It is similar to annotating the property <code>@PathSensitive(RELATIVE)</code> but it will ignore the names of JAR files directly added to the classpath, and it will consider changes in the order of the files as a change in the classpath. Gradle will inspect the contents of jar files on the classpath and ignore changes that do not affect the semantics of the classpath (such as file dates and entry order). See also <a href="#sec:task_input_using_classpath_annotations">Using the classpath annotations</a>.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> The <code>@Classpath</code> annotation was introduced in Gradle 3.2. To stay compatible with earlier Gradle versions, classpath properties should also be annotated with <code>@InputFiles</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/CompileClasspath.html">CompileClasspath</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An iterable of input files and directories that represent a Java compile classpath. This allows the task to ignore irrelevant changes that do not affect the API of the classes in classpath. See also <a href="#sec:task_input_using_classpath_annotations">Using the classpath annotations</a>.</p>
</div>
<div class="paragraph">
<p>The following kinds of changes to the classpath will be ignored:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changes to the path of jar or top level directories.</p>
</li>
<li>
<p>Changes to timestamps and the order of entries in Jars.</p>
</li>
<li>
<p>Changes to resources and Jar manifests, including adding or removing resources.</p>
</li>
<li>
<p>Changes to private class elements, such as private fields, methods and inner classes.</p>
</li>
<li>
<p>Changes to code, such as method bodies, static initializers and field initializers (except for constants).</p>
</li>
<li>
<p>Changes to debug information, for example when a change to a comment affects the line numbers in class debug information.</p>
</li>
<li>
<p>Changes to directories, including directory entries in Jars.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>NOTE</strong> - The <code>@CompileClasspath</code> annotation was introduced in Gradle 3.4. To stay compatible with Gradle 3.3 and 3.2, compile classpath properties should also be annotated with <code>@Classpath</code>. For compatibility with Gradle versions before 3.2 the property should also be annotated with <code>@InputFiles</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/OutputFile.html">OutputFile</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A single output file (not directory)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/OutputDirectory.html">OutputDirectory</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A single output directory (not file)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/OutputFiles.html">OutputFiles</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Map&lt;String, File&gt;</code>** or <code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An iterable or map of output files.
Using a file tree turns <a href="#sec:task_output_caching">caching</a> off for the task.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/OutputDirectories.html">OutputDirectories</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Map&lt;String, File&gt;</code>** or <code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An iterable of output directories.
Using a file tree turns <a href="#sec:task_output_caching">caching</a> off for the task.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Destroys.html">Destroys</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code> or <code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies one or more files that are removed by this task.  Note that a task can define either inputs/outputs or destroyables, but not both.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/LocalState.html">LocalState</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code> or <code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies one or more files that represent the <a href="#sec:storing_incremental_task_state">local state of the task</a>. These files are removed when the task is loaded from cache.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any custom type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A custom type that may not implement <code>Serializable</code> but does have at least one field or property marked with one of the annotations in this table. It could even be another <code>@Nested</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Console.html">Console</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Indicates that the property is neither an input nor an output. It simply affects the console output of the task in some way, such as increasing or decreasing the verbosity of the task.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Internal.html">Internal</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Indicates that the property is used internally but is neither an input nor an output.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ReplacedBy.html">ReplacedBy</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Indicates that the property has been replaced by another and should be ignored as an input or output.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="skip-when-empty"></a><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/SkipWhenEmpty.html">SkipWhenEmpty</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code> or <code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Used with <code>@InputFiles</code> or <code>@InputDirectory</code> to tell Gradle to skip the task if the corresponding files or directory are empty, along with all other input files declared with this annotation. Tasks that have been skipped due to all of their input files that were declared with this annotation being empty will result in a distinct “no source” outcome. For example, <code>NO-SOURCE</code> will be emitted in the console output.</p>
</div>
<div class="paragraph">
<p>Implies <code><a href="#incremental">@Incremental</a></code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="incremental"></a><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/work/Incremental.html">Incremental</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Provider&lt;FileSystemLocation&gt;</code> or <code>FileCollection</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Used with <code>@InputFiles</code> or <code>@InputDirectory</code> to instruct Gradle to track changes to the annotated file property, so the changes can be queried via <code>@<a href="https://docs.gradle.org/8.9/dsl/org.gradle.work.InputChanges.html">InputChanges.getFileChanges()</a></code>. Required for <a href="#incremental_tasks">incremental tasks</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Optional.html">Optional</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Used with any of the property type annotations listed in the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Optional.html">Optional</a> API documentation. This annotation disables validation checks on the corresponding property. See <a href="#sec:task_input_output_validation">the section on validation</a> for more details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/PathSensitive.html">PathSensitive</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code> or <code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="inputs_path_sensitivity"></a>Used with any input file property to tell Gradle to only consider the given part of the file paths as important. For example, if a property is annotated with <code>@PathSensitive(PathSensitivity.NAME_ONLY)</code>, then moving the files around without changing their contents will not make the task out-of-date.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/IgnoreEmptyDirectories.html">IgnoreEmptyDirectories</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code> or <code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Used with <code>@InputFiles</code> or <code>@InputDirectory</code> to instruct Gradle to track only changes to the contents of directories and not differences in the directories themselves. For example, removing, renaming or adding an empty directory somewhere in the directory structure will not make the task out-of-date.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/work/NormalizeLineEndings.html">NormalizeLineEndings</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code> or <code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Used with <code>@InputFiles</code>, <code>@InputDirectory</code> or <code>@Classpath</code> to instruct Gradle to normalize line endings when calculating up-to-date checks or build cache keys. For example, switching a file between Unix line endings and Windows line endings (or vice-versa) will not make the task out-of-date.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>File</code> can be any type accepted by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> and <code>Iterable&lt;File&gt;</code> can be any type accepted by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(java.lang.Object&#8230;&#8203;)</a>.
This includes instances of <code>Callable</code>, such as closures, allowing for lazy evaluation of the property values.
Be aware that the types <code>FileCollection</code> and <code>FileTree</code> are <code>Iterable&lt;File&gt;</code>s.</p>
</div>
<div class="paragraph">
<p>Similar to the above, <code>File</code> can be any type accepted by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a>. The <code>Map</code> itself can be wrapped in <code>Callable</code>s, such as closures.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Annotations are inherited from all parent types including implemented interfaces. Property type annotations override any other property type annotation declared in a parent type. This way an <code>@InputFile</code> property can be turned into an <code>@InputDirectory</code> property in a child task type.</p>
</div>
<div class="paragraph">
<p>Annotations on a property declared in a type override similar annotations declared by the superclass and in any implemented interfaces. Superclass annotations take precedence over annotations declared in implemented interfaces.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Console.html">Console</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Internal.html">Internal</a> annotations in the table are special cases as they don’t declare either task inputs or task outputs. So why use them? It&#8217;s so that you can take advantage of the <a href="java_gradle_plugin.html#java_gradle_plugin">Java Gradle Plugin Development plugin</a> to help you develop and publish your own plugins. This plugin checks whether any properties of your custom task classes lack an incremental build annotation. This protects you from forgetting to add an appropriate annotation during development.</p>
</div>
<div class="sect4">
<h5 id="sec:task_input_using_dependency_resolution_results"><a class="anchor" href="#sec:task_input_using_dependency_resolution_results"></a><a class="link" href="#sec:task_input_using_dependency_resolution_results">Using dependency resolution results</a></h5>
<div class="paragraph">
<p>Dependency resolution results can be consumed as task inputs in two ways.
First by consuming the graph of the resolved metadata using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/result/ResolvedComponentResult.html">ResolvedComponentResult</a>.
Second by consuming the flat set of the resolved artifacts using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/artifacts/result/ResolvedArtifactResult.html">ResolvedArtifactResult</a>.</p>
</div>
<div class="paragraph">
<p>A resolved graph can be obtained lazily from the incoming resolution result of a <code>Configuration</code> and wired to an <code>@Input</code> property:</p>
</div>
<div id="ex-resolved-graph-as-task-input" class="exampleblock">
<div class="title">Example 320. <a href="#ex-resolved-graph-as-task-input">Resolved graph as task input</a></div>
<div class="content">
<div class="listingblock">
<div class="title">Task declaration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">link:https:<span class="comment">//docs.gradle.org/8.9/samples/writing-tasks/tasks-with-dependency-resolution-result-inputs/common/dependency-reports/src/main/java/com/example/GraphResolvedComponents.java[role=include]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">link:https:<span class="comment">//docs.gradle.org/8.9/samples/writing-tasks/tasks-with-dependency-resolution-result-inputs/common/dependency-reports/src/main/java/com/example/DependencyReportsPlugin.java[role=include]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The resolved set of artifacts can be obtained lazily from the incoming artifacts of a <code>Configuration</code>.
Given the <code>ResolvedArtifactResult</code> type contains both metadata and file information, instances need to be transformed to metadata only before being wired to an <code>@Input</code> property:</p>
</div>
<div id="ex-resolved-artifacts-as-task-input" class="exampleblock">
<div class="title">Example 321. <a href="#ex-resolved-artifacts-as-task-input">Resolved artifacts as task input</a></div>
<div class="content">
<div class="listingblock">
<div class="title">Task declaration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">link:https:<span class="comment">//docs.gradle.org/8.9/samples/writing-tasks/tasks-with-dependency-resolution-result-inputs/common/dependency-reports/src/main/java/com/example/ListResolvedArtifacts.java[role=include]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">link:https:<span class="comment">//docs.gradle.org/8.9/samples/writing-tasks/tasks-with-dependency-resolution-result-inputs/common/dependency-reports/src/main/java/com/example/DependencyReportsPlugin.java[role=include]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Both graph and flat results can be combined and augmented with resolved file information.
This is all demonstrated in the <a href="../samples/sample_tasks_with_dependency_resolution_result_inputs.html">Tasks with dependency resolution result inputs</a> sample.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_input_using_classpath_annotations"><a class="anchor" href="#sec:task_input_using_classpath_annotations"></a><a class="link" href="#sec:task_input_using_classpath_annotations">Using the classpath annotations</a></h5>
<div class="paragraph">
<p>Besides <code>@InputFiles</code>, for JVM-related tasks Gradle understands the concept of classpath inputs. Both runtime and compile classpaths are treated differently when Gradle is looking for changes.</p>
</div>
<div class="paragraph">
<p>As opposed to input properties annotated with <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/InputFiles.html">InputFiles</a></code>, for classpath properties the order of the entries in the file collection matter.
On the other hand, the names and paths of the directories and jar files on the classpath itself are ignored.
Timestamps and the order of class files and resources inside jar files on a classpath are ignored, too, thus recreating a jar file with different file dates will not make the task out of date.</p>
</div>
<div class="paragraph">
<p>Runtime classpaths are marked with <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Classpath.html">Classpath</a></code>, and they offer further customization via <a href="#sec:configure_input_normalization">classpath normalization</a>.</p>
</div>
<div class="paragraph">
<p>Input properties annotated with <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/CompileClasspath.html">CompileClasspath</a></code> are considered Java compile classpaths.
Additionally to the aforementioned general classpath rules, compile classpaths ignore changes to everything but class files. Gradle uses the same class analysis described in <a href="java_plugin.html#sec:java_compile_avoidance">Java compile avoidance</a> to further filter changes that don&#8217;t affect the class' ABIs.
This means that changes which only touch the implementation of classes do not make the task out of date.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_input_nested_inputs"><a class="anchor" href="#sec:task_input_nested_inputs"></a><a class="link" href="#sec:task_input_nested_inputs">Nested inputs</a></h5>
<div class="paragraph">
<p>When analyzing <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code> task properties for declared input and output sub-properties Gradle uses the type of the actual value.
Hence it can discover all sub-properties declared by a runtime sub-type.</p>
</div>
<div class="paragraph">
<p>When adding <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code> to a <code><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/Provider.html">Provider</a></code>, the value of the <code>Provider</code> is treated as a nested input.</p>
</div>
<div class="paragraph">
<p>When adding <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code> to an iterable, each element is treated as a separate nested input.
Each nested input in the iterable is assigned a name, which by default is the dollar sign followed by the index in the iterable, e.g. <code>$2</code>.
If an element of the iterable implements <code><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Named.html">Named</a></code>, then the name is used as property name.
The ordering of the elements in the iterable is crucial for reliable up-to-date checks and caching if not all of the elements implement <code><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Named.html">Named</a></code>.
Multiple elements which have the same name are not allowed.</p>
</div>
<div class="paragraph">
<p>When adding <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code> to a map, then for each value a nested input is added, using the key as name.</p>
</div>
<div class="paragraph">
<p>The type and classpath of nested inputs is tracked, too.
This ensures that changes to the implementation of a nested input causes the build to be out of date.
By this it is also possible to add user provided code as an input, e.g. by annotating an <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Action.html">Action</a></code> property with <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code>.
Note that any inputs to such actions should be tracked, either by annotated properties on the action or by manually registering them with the task.</p>
</div>
<div class="paragraph">
<p>Using nested inputs allows richer modeling and extensibility for tasks, as e.g. shown by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:jvmArgumentProviders">Test.getJvmArgumentProviders()</a>.</p>
</div>
<div class="paragraph">
<p>This allows us to model the JaCoCo Java agent, thus declaring the necessary JVM arguments and providing the inputs and outputs to Gradle:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">JacocoAgent.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">JacocoAgent</span> <span class="directive">implements</span> CommandLineArgumentProvider {
    <span class="directive">private</span> <span class="directive">final</span> JacocoTaskExtension jacoco;

    <span class="directive">public</span> JacocoAgent(JacocoTaskExtension jacoco) {
        <span class="local-variable">this</span>.jacoco = jacoco;
    }

    <span class="annotation">@Nested</span>
    <span class="annotation">@Optional</span>
    <span class="directive">public</span> JacocoTaskExtension getJacoco() {
        <span class="keyword">return</span> jacoco.isEnabled() ? jacoco : <span class="predefined-constant">null</span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Iterable</span>&lt;<span class="predefined-type">String</span>&gt; asArguments() {
        <span class="keyword">return</span> jacoco.isEnabled() ? ImmutableList.of(jacoco.getAsJvmArg()) : <span class="predefined-type">Collections</span>.&lt;<span class="predefined-type">String</span>&gt;emptyList();
    }
}

test.getJvmArgumentProviders().add(<span class="keyword">new</span> JacocoAgent(extension));</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For this to work, <code><a href="https://docs.gradle.org/8.9/dsl/org.gradle.testing.jacoco.plugins.JacocoTaskExtension.html">JacocoTaskExtension</a></code> needs to have the correct input and output annotations.</p>
</div>
<div class="paragraph">
<p>The approach works for Test JVM arguments, since <code><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:jvmArgumentProviders">Test.getJvmArgumentProviders()</a></code> is an <code>Iterable</code> annotated with <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code>.</p>
</div>
<div class="paragraph">
<p>There are other task types where this kind of nested inputs are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.JavaExec.html#org.gradle.api.tasks.JavaExec:argumentProviders">JavaExec.getArgumentProviders()</a> - model e.g. custom tools</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.JavaExec.html#org.gradle.api.tasks.JavaExec:jvmArgumentProviders">JavaExec.getJvmArgumentProviders()</a> - used for Jacoco Java agent</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.CompileOptions.html#org.gradle.api.tasks.compile.CompileOptions:compilerArgumentProviders">CompileOptions.getCompilerArgumentProviders()</a> - model e.g. annotation processors</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.Exec.html#org.gradle.api.tasks.Exec:argumentProviders">Exec.getArgumentProviders()</a> - model e.g. custom tools</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.ForkOptions.html#org.gradle.api.tasks.compile.ForkOptions:jvmArgumentProviders">JavaCompile.getOptions().getForkOptions().getJvmArgumentProviders()</a> - model Java compiler daemon command line arguments</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.GroovyForkOptions.html#org.gradle.api.tasks.compile.GroovyForkOptions:jvmArgumentProviders">GroovyCompile.getGroovyOptions().getForkOptions().getJvmArgumentProviders()</a> - model Groovy compiler daemon command line arguments</p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.scala.ScalaForkOptions.html#org.gradle.api.tasks.scala.ScalaForkOptions:jvmArgumentProviders">ScalaCompile.getScalaOptions().getForkOptions().getJvmArgumentProviders()</a> - model Scala compiler daemon command line arguments</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the same way, this kind of modelling is available to custom tasks.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_input_validation"><a class="anchor" href="#sec:task_input_validation"></a><a class="link" href="#sec:task_input_validation">Validation at runtime</a></h5>
<div class="paragraph">
<p>When executing the build Gradle checks if task types are declared with the proper annotations.
It tries to identify problems where e.g. annotations are used on incompatible types, or on setters etc.
Any getter not annotated with an input/output annotation is also flagged.
These problems then fail the build or are turned into deprecation warnings when the task is executed.</p>
</div>
<div class="paragraph">
<p>Tasks that have a validation warning are executed <strong>without any optimizations</strong>.
Specifically, they never can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>up-to-date,</p>
</li>
<li>
<p>loaded from or stored in the <a href="#build_cache">build cache</a>,</p>
</li>
<li>
<p>executed in parallel with other tasks, even if <a href="#parallel_execution">parallel execution</a> is enabled,</p>
</li>
<li>
<p>executed incrementally.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The in-memory representation of the file system state (<em><a href="#sec:daemon_watch_fs">Virtual File System</a>)</em> is also invalidated before an invalid task is executed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_input_output_runtime_api"><a class="anchor" href="#sec:task_input_output_runtime_api"></a><a class="link" href="#sec:task_input_output_runtime_api">Declaring inputs and outputs via the runtime API</a></h4>
<div class="paragraph">
<p>Custom task classes are an easy way to bring your own build logic into the arena of incremental build, but you don’t always have that option. That&#8217;s why Gradle also provides an alternative API that can be used with any tasks, which we look at next.</p>
</div>
<div class="paragraph">
<p>When you don’t have access to the source for a custom task class, there is no way to add any of the annotations we covered in the previous section. Fortunately, Gradle provides a runtime API for scenarios just like that. It can also be used for ad-hoc tasks, as you&#8217;ll see next.</p>
</div>
<div class="sect4">
<h5 id="sec:runtime_api_for_adhoc"><a class="anchor" href="#sec:runtime_api_for_adhoc"></a><a class="link" href="#sec:runtime_api_for_adhoc">Declaring inputs and outputs of ad-hoc tasks</a></h5>
<div class="paragraph">
<p>This runtime API is provided through a couple of aptly named properties that are available on every Gradle task:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Task.html#org.gradle.api.Task:inputs">Task.getInputs()</a> of type <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskInputs.html">TaskInputs</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Task.html#org.gradle.api.Task:outputs">Task.getOutputs()</a> of type <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskOutputs.html">TaskOutputs</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Task.html#org.gradle.api.Task:destroyables">Task.getDestroyables()</a> of type <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskDestroyables.html">TaskDestroyables</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These objects have methods that allow you to specify files, directories and values which constitute the task’s inputs and outputs.
In fact, the runtime API has almost feature parity with the annotations.</p>
</div>
<div class="paragraph">
<p>It lacks equivalents for</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code></p>
</li>
<li>
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Classpath.html">Classpath</a></code></p>
</li>
<li>
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/CompileClasspath.html">CompileClasspath</a></code></p>
</li>
<li>
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/LocalState.html">LocalState</a></code></p>
</li>
<li>
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ReplacedBy.html">ReplacedBy</a></code></p>
</li>
<li>
<p><code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Internal.html">Internal</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s take the template processing example from before and see how it would look as an ad-hoc task that uses the runtime API:</p>
</div>
<div id="ex-ad-hoc-task" class="exampleblock">
<div class="title">Example 322. <a href="#ex-ad-hoc-task">Ad-hoc task</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;processTemplatesAdHoc&quot;) {
    inputs.property(&quot;engine&quot;, TemplateEngineType.FREEMARKER)
    inputs.files(fileTree(&quot;src/templates&quot;))
        .withPropertyName(&quot;sourceFiles&quot;)
        .withPathSensitivity(PathSensitivity.RELATIVE)
    inputs.property(&quot;templateData.name&quot;, &quot;docs&quot;)
    inputs.property(&quot;templateData.variables&quot;, mapOf(&quot;year&quot; to &quot;2013&quot;))
    outputs.dir(layout.buildDirectory.dir(&quot;genOutput2&quot;))
        .withPropertyName(&quot;outputDir&quot;)

    doLast {
        // Process the templates here
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">processTemplatesAdHoc</span><span class="delimiter">'</span></span>) {
    inputs.property(<span class="string"><span class="delimiter">'</span><span class="content">engine</span><span class="delimiter">'</span></span>, TemplateEngineType.FREEMARKER)
    inputs.files(fileTree(<span class="string"><span class="delimiter">'</span><span class="content">src/templates</span><span class="delimiter">'</span></span>))
        .withPropertyName(<span class="string"><span class="delimiter">'</span><span class="content">sourceFiles</span><span class="delimiter">'</span></span>)
        .withPathSensitivity(PathSensitivity.RELATIVE)
    inputs.property(<span class="string"><span class="delimiter">'</span><span class="content">templateData.name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">docs</span><span class="delimiter">'</span></span>)
    inputs.property(<span class="string"><span class="delimiter">'</span><span class="content">templateData.variables</span><span class="delimiter">'</span></span>, [<span class="key">year</span>: <span class="string"><span class="delimiter">'</span><span class="content">2013</span><span class="delimiter">'</span></span>])
    outputs.dir(layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">genOutput2</span><span class="delimiter">'</span></span>))
        .withPropertyName(<span class="string"><span class="delimiter">'</span><span class="content">outputDir</span><span class="delimiter">'</span></span>)

    doLast {
        <span class="comment">// Process the templates here</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle processTemplatesAdHoc</code></strong></div>
<div class="content">
<pre>&gt; gradle processTemplatesAdHoc
&gt; Task :processTemplatesAdHoc

BUILD SUCCESSFUL in 0s
3 actionable tasks: 3 executed</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As before, there’s much to talk about. To begin with, you should really write a custom task class for this as it’s a non-trivial implementation that has several configuration options. In this case, there are no task properties to store the root source folder, the location of the output directory or any of the other settings. That’s deliberate to highlight the fact that the runtime API doesn’t require the task to have any state. In terms of incremental build, the above ad-hoc task will behave the same as the custom task class.</p>
</div>
<div class="paragraph">
<p>All the input and output definitions are done through the methods on <code>inputs</code> and <code>outputs</code>, such as <code>property()</code>, <code>files()</code>, and <code>dir()</code>.
Gradle performs up-to-date checks on the argument values to determine whether the task needs to run again or not.
Each method corresponds to one of the incremental build annotations, for example <code>inputs.property()</code> maps to <code>@Input</code> and <code>outputs.dir()</code> maps to <code>@OutputDirectory</code>.</p>
</div>
<div class="paragraph">
<p>The files that a task removes can be specified through <code>destroyables.register()</code>.</p>
</div>
<div id="ex-ad-hoc-task-declaring-a-destroyable" class="exampleblock">
<div class="title">Example 323. <a href="#ex-ad-hoc-task-declaring-a-destroyable">Ad-hoc task declaring a destroyable</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;removeTempDir&quot;) {
    val tmpDir = layout.projectDirectory.dir(&quot;tmpDir&quot;)
    destroyables.register(tmpDir)
    doLast {
        tmpDir.asFile.deleteRecursively()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">removeTempDir</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> tempDir = layout.projectDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">tmpDir</span><span class="delimiter">'</span></span>)
    destroyables.register(tempDir)
    doLast {
        tempDir.asFile.deleteDir()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>One notable difference between the runtime API and the annotations is the lack of a method that corresponds directly to <code>@Nested</code>. That’s why the example uses two <code>property()</code> declarations for the template data, one for each <code>TemplateData</code> property. You should utilize the same technique when using the runtime API with nested values.  Any given task can either declare destroyables or inputs/outputs, but cannot declare both.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:runtime_api_configuration"><a class="anchor" href="#sec:runtime_api_configuration"></a><a class="link" href="#sec:runtime_api_configuration">Fine-grained configuration</a></h5>
<div class="paragraph">
<p>The runtime API methods only allow you to declare your inputs and outputs in themselves. However, the file-oriented ones return a builder — of type <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskInputFilePropertyBuilder.html">TaskInputFilePropertyBuilder</a> — that lets you provide additional information about those inputs and outputs.</p>
</div>
<div class="paragraph">
<p>You can learn about all the options provided by the builder in its API documentation, but we’ll show you a simple example here to give you an idea of what you can do.</p>
</div>
<div class="paragraph">
<p>Let’s say we don’t want to run the <code>processTemplates</code> task if there are no source files, regardless of whether it’s a clean build or not. After all, if there are no source files, there’s nothing for the task to do. The builder allows us to configure this like so:</p>
</div>
<div id="ex-using-skipwhenempty-via-the-runtime-api" class="exampleblock">
<div class="title">Example 324. <a href="#ex-using-skipwhenempty-via-the-runtime-api">Using skipWhenEmpty() via the runtime API</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;processTemplatesAdHocSkipWhenEmpty&quot;) {
    // ...

    inputs.files(fileTree(&quot;src/templates&quot;) {
            include(&quot;**/*.fm&quot;)
        })
        .skipWhenEmpty()
        .withPropertyName(&quot;sourceFiles&quot;)
        .withPathSensitivity(PathSensitivity.RELATIVE)
        .ignoreEmptyDirectories()

    // ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">processTemplatesAdHocSkipWhenEmpty</span><span class="delimiter">'</span></span>) {
    <span class="comment">// ...</span>

    inputs.files(fileTree(<span class="string"><span class="delimiter">'</span><span class="content">src/templates</span><span class="delimiter">'</span></span>) {
            include <span class="string"><span class="delimiter">'</span><span class="content">**/*.fm</span><span class="delimiter">'</span></span>
        })
        .skipWhenEmpty()
        .withPropertyName(<span class="string"><span class="delimiter">'</span><span class="content">sourceFiles</span><span class="delimiter">'</span></span>)
        .withPathSensitivity(PathSensitivity.RELATIVE)
        .ignoreEmptyDirectories()

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean processTemplatesAdHocSkipWhenEmpty</code></strong></div>
<div class="content">
<pre>&gt; gradle clean processTemplatesAdHocSkipWhenEmpty
&gt; Task :processTemplatesAdHocSkipWhenEmpty NO-SOURCE

BUILD SUCCESSFUL in 0s
3 actionable tasks: 2 executed, 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>TaskInputs.files()</code> method returns a builder that has a <code>skipWhenEmpty()</code> method. Invoking this method is equivalent to annotating to the property with <a href="#skip-when-empty"><code>@SkipWhenEmpty</code></a>.</p>
</div>
<div class="paragraph">
<p>Now that you have seen both the annotations and the runtime API, you may be wondering which API you should be using. Our recommendation is to use the annotations wherever possible, and it’s sometimes worth creating a custom task class just so that you can make use of them. The runtime API is more for situations in which you can’t use the annotations.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:runtime_api_for_custom_tasks"><a class="anchor" href="#sec:runtime_api_for_custom_tasks"></a><a class="link" href="#sec:runtime_api_for_custom_tasks">Declaring inputs and outputs for custom task types</a></h5>
<div class="paragraph">
<p>Another type of example involves registering additional inputs and outputs for instances of a custom task class.
For example, imagine that the <code>ProcessTemplates</code> task also needs to read <code>src/headers/headers.txt</code> (e.g. because it is included from one of the sources).
You&#8217;d want Gradle to know about this input file, so that it can re-execute the task whenever the contents of this file change.
With the runtime API you can do just that:</p>
</div>
<div id="ex-using-runtime-api-with-custom-task-type" class="exampleblock">
<div class="title">Example 325. <a href="#ex-using-runtime-api-with-custom-task-type">Using runtime API with custom task type</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;ProcessTemplates&gt;(&quot;processTemplatesWithExtraInputs&quot;) {
    // ...

    inputs.file(&quot;src/headers/headers.txt&quot;)
        .withPropertyName(&quot;headers&quot;)
        .withPathSensitivity(PathSensitivity.NONE)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">processTemplatesWithExtraInputs</span><span class="delimiter">'</span></span>, ProcessTemplates) {
    <span class="comment">// ...</span>

    inputs.file(<span class="string"><span class="delimiter">'</span><span class="content">src/headers/headers.txt</span><span class="delimiter">'</span></span>)
        .withPropertyName(<span class="string"><span class="delimiter">'</span><span class="content">headers</span><span class="delimiter">'</span></span>)
        .withPathSensitivity(PathSensitivity.NONE)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using the runtime API like this is a little like using <code>doLast()</code> and <code>doFirst()</code> to attach extra actions to a task, except in this case we’re attaching information about inputs and outputs.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If the task type is already using the incremental build annotations, registering inputs or outputs with the same property names will result in an error.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_input_output_side_effects"><a class="anchor" href="#sec:task_input_output_side_effects"></a><a class="link" href="#sec:task_input_output_side_effects">Benefits of declaring task inputs and outputs</a></h4>
<div class="paragraph">
<p>Once you declare a task’s formal inputs and outputs, Gradle can then infer things about those properties. For example, if an input of one task is set to the output of another, that means the first task depends on the second, right? Gradle knows this and can act upon it.</p>
</div>
<div class="paragraph">
<p>We’ll look at this feature next and also some other features that come from Gradle knowing things about inputs and outputs.</p>
</div>
<div class="sect4">
<h5 id="sec:inferred_task_dependencies"><a class="anchor" href="#sec:inferred_task_dependencies"></a><a class="link" href="#sec:inferred_task_dependencies">Inferred task dependencies</a></h5>
<div class="paragraph">
<p>Consider an archive task that packages the output of the <code>processTemplates</code> task. A build author will see that the archive task obviously requires <code>processTemplates</code> to run first and so may add an explicit <code>dependsOn</code>. However, if you define the archive task like so:</p>
</div>
<div id="ex-inferred-task-dependency-via-task-outputs" class="exampleblock">
<div class="title">Example 326. <a href="#ex-inferred-task-dependency-via-task-outputs">Inferred task dependency via task outputs</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Zip&gt;(&quot;packageFiles&quot;) {
    from(processTemplates.map { it.outputDir })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">packageFiles</span><span class="delimiter">'</span></span>, Zip) {
    from processTemplates.map { <span class="local-variable">it</span>.outputDir }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean packageFiles</code></strong></div>
<div class="content">
<pre>&gt; gradle clean packageFiles
&gt; Task :processTemplates
&gt; Task :packageFiles

BUILD SUCCESSFUL in 0s
5 actionable tasks: 4 executed, 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle will automatically make <code>packageFiles</code> depend on <code>processTemplates</code>. It can do this because it’s aware that one of the inputs of packageFiles requires the output of the processTemplates task. We call this an inferred task dependency.</p>
</div>
<div class="paragraph">
<p>The above example can also be written as</p>
</div>
<div id="ex-inferred-task-dependency-via-a-task-argument" class="exampleblock">
<div class="title">Example 327. <a href="#ex-inferred-task-dependency-via-a-task-argument">Inferred task dependency via a task argument</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Zip&gt;(&quot;packageFiles2&quot;) {
    from(processTemplates)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">packageFiles2</span><span class="delimiter">'</span></span>, Zip) {
    from processTemplates
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean packageFiles2</code></strong></div>
<div class="content">
<pre>&gt; gradle clean packageFiles2
&gt; Task :processTemplates
&gt; Task :packageFiles2

BUILD SUCCESSFUL in 0s
5 actionable tasks: 4 executed, 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is because the <code>from()</code> method can accept a task object as an argument. Behind the scenes, <code>from()</code> uses the <code>project.files()</code> method to wrap the argument, which in turn exposes the task’s formal outputs as a file collection. In other words, it’s a special case!</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_input_output_validation"><a class="anchor" href="#sec:task_input_output_validation"></a><a class="link" href="#sec:task_input_output_validation">Input and output validation</a></h5>
<div class="paragraph">
<p>The incremental build annotations provide enough information for Gradle to perform some basic validation on the annotated properties. In particular, it does the following for each property before the task executes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@InputFile</code> - verifies that the property has a value and that the path corresponds to a file (not a directory) that exists.</p>
</li>
<li>
<p><code>@InputDirectory</code> - same as for <code>@InputFile</code>, except the path must correspond to a directory.</p>
</li>
<li>
<p><code>@OutputDirectory</code> - verifies that the path doesn’t match a file and also creates the directory if it doesn’t already exist.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If one task produces an output in a location and another task consumes that location by referring to it as an input, then Gradle checks that the consumer task depends on the producer task.
When the producer and the consumer tasks are executing at the same time, the build fails to avoid capturing an incorrect state.</p>
</div>
<div class="paragraph">
<p>Such validation improves the robustness of the build, allowing you to identify issues related to inputs and outputs quickly.</p>
</div>
<div class="paragraph">
<p>You will occasionally want to disable some of this validation, specifically when an input file may validly not exist. That’s why Gradle provides the <code>@Optional</code> annotation: you use it to tell Gradle that a particular input is optional and therefore the build should not fail if the corresponding file or directory doesn’t exist.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_input_output_continuous_build"><a class="anchor" href="#sec:task_input_output_continuous_build"></a><a class="link" href="#sec:task_input_output_continuous_build">Continuous build</a></h5>
<div class="paragraph">
<p>Another benefit of defining task inputs and outputs is continuous build. Since Gradle knows what files a task depends on, it can automatically run a task again if any of its inputs change. By activating continuous build when you run Gradle — through the <code>--continuous</code> or <code>-t</code> options — you will put Gradle into a state in which it continually checks for changes and executes the requested tasks when it encounters such changes.</p>
</div>
<div class="paragraph">
<p>You can find out more about this feature in <a href="#sec:continuous_build">Continuous build</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_input_output_parallelism"><a class="anchor" href="#sec:task_input_output_parallelism"></a><a class="link" href="#sec:task_input_output_parallelism">Task parallelism</a></h5>
<div class="paragraph">
<p>One last benefit of defining task inputs and outputs is that Gradle can use this information to make decisions about how to run tasks when the "--parallel" option is used.  For instance, Gradle will inspect the outputs of tasks when selecting the  next task to run and will avoid concurrent execution of tasks that write to the same output directory.  Similarly, Gradle will use the information about what files a task destroys (e.g. specified by the <code>Destroys</code> annotation) and avoid running a task that removes a set of files while another task is running that consumes or creates those same files (and vice versa).  It can also determine that a task that creates a set of files has already run and that a task that consumes those files has yet to run and will avoid running a task that removes those files in between.  By providing task input and output information in this way, Gradle can infer creation/consumption/destruction relationships between tasks and can ensure that task execution does not violate those relationships.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:how_does_it_work"><a class="anchor" href="#sec:how_does_it_work"></a><a class="link" href="#sec:how_does_it_work">How does it work?</a></h4>
<div class="paragraph">
<p>Before a task is executed for the first time, Gradle takes a fingerprint of the inputs.
This fingerprint contains the paths of input files and a hash of the contents of each file.
Gradle then executes the task.
If the task completes successfully, Gradle takes a fingerprint of the outputs.
This fingerprint contains the set of output files and a hash of the contents of each file.
Gradle persists both fingerprints for the next time the task is executed.</p>
</div>
<div class="paragraph">
<p>Each time after that, before the task is executed, Gradle takes a new fingerprint of the inputs and outputs.
If the new fingerprints are the same as the previous fingerprints, Gradle assumes that the outputs are up to date and skips the task.
If they are not the same, Gradle executes the task.
Gradle persists both fingerprints for the next time the task is executed.</p>
</div>
<div class="paragraph">
<p>If the stats of a file (i.e. <code>lastModified</code> and <code>size</code>) did not change, Gradle will reuse the file&#8217;s fingerprint from the previous run.
That means that Gradle does not detect changes when the stats of a file did not change.</p>
</div>
<div class="paragraph">
<p>Gradle also considers the <em>code</em> of the task as part of the inputs to the task. When a task, its actions, or its dependencies change between executions, Gradle considers the task as out-of-date.</p>
</div>
<div class="paragraph">
<p>Gradle understands if a file property (e.g. one holding a Java classpath) is order-sensitive. When comparing the fingerprint of such a property, even a change in the order of the files will result in the task becoming out-of-date.</p>
</div>
<div class="paragraph">
<p>Note that if a task has an output directory specified, any files added to that directory since the last time it was executed are ignored and will NOT cause the task to be out of date. This is so unrelated tasks may share an output directory without interfering with each other. If this is not the behaviour you want for some reason, consider using <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskOutputs.html#upToDateWhen-groovy.lang.Closure-">TaskOutputs.upToDateWhen(groovy.lang.Closure)</a></p>
</div>
<div class="paragraph">
<p>Note also that changing the availability of an unavailable file (e.g. modifying the target of a broken symlink to a valid file, or vice versa), will be detected and handled by up-to-date check.</p>
</div>
<div class="paragraph">
<p>The inputs for the task are also used to calculate the <a href="#build_cache">build cache</a> key used to load task outputs when enabled. For more details see <a href="#sec:task_output_caching">Task output caching</a>.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For tracking the implementation of tasks, task actions and nested inputs, Gradle uses the class name and an identifier for the classpath which contains the implementation.
There are some situations when Gradle is not able to track the implementation precisely:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Unknown classloader</dt>
<dd>
<p>When the classloader which loaded the implementation has not been created by Gradle, the classpath cannot be determined.</p>
</dd>
<dt class="hdlist1">Java lambda</dt>
<dd>
<p>Java lambda classes are created at runtime with a non-deterministic classname.
Therefore, the class name does not identify the implementation of the lambda and changes between different Gradle runs.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When the implementation of a task, task action or a nested input cannot be tracked precisely, Gradle disables any caching for the task.
That means that the task will never be up-to-date or loaded from the <a href="#sec:task_output_caching">build cache</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:advanced_inc_build"><a class="anchor" href="#sec:advanced_inc_build"></a><a class="link" href="#sec:advanced_inc_build">Advanced techniques</a></h4>
<div class="paragraph">
<p>Everything you’ve seen so far in this section will cover most of the use cases you’ll encounter, but there are some scenarios that need special treatment. We’ll present a few of those next with the appropriate solutions.</p>
</div>
<div class="sect4">
<h5 id="sec:add_cached_input_output_methods"><a class="anchor" href="#sec:add_cached_input_output_methods"></a><a class="link" href="#sec:add_cached_input_output_methods">Adding your own cached input/output methods</a></h5>
<div class="paragraph">
<p>Have you ever wondered how the <code>from()</code> method of the <code>Copy</code> task works? It’s not annotated with <code>@InputFiles</code> and yet any files passed to it are treated as formal inputs of the task. What’s happening?</p>
</div>
<div class="paragraph">
<p>The implementation is quite simple and you can use the same technique for your own tasks to improve their APIs. Write your methods so that they add files directly to the appropriate annotated property. As an example, here’s how to add a <code>sources()</code> method to the custom <code>ProcessTemplates</code> class we introduced earlier:</p>
</div>
<div id="ex-declaring-a-method-to-add-task-inputs" class="exampleblock">
<div class="title">Example 328. <a href="#ex-declaring-a-method-to-add-task-inputs">Declaring a method to add task inputs</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;ProcessTemplates&gt;(&quot;processTemplates&quot;) {
    templateEngine = TemplateEngineType.FREEMARKER
    templateData.name = &quot;test&quot;
    templateData.variables = mapOf(&quot;year&quot; to &quot;2012&quot;)
    outputDir = layout.buildDirectory.dir(&quot;genOutput&quot;)

    sources(fileTree(&quot;src/templates&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">processTemplates</span><span class="delimiter">'</span></span>, ProcessTemplates) {
    templateEngine = TemplateEngineType.FREEMARKER
    templateData.name = <span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>
    templateData.variables = [<span class="key">year</span>: <span class="string"><span class="delimiter">'</span><span class="content">2012</span><span class="delimiter">'</span></span>]
    outputDir = file(layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">genOutput</span><span class="delimiter">'</span></span>))

    sources fileTree(<span class="string"><span class="delimiter">'</span><span class="content">src/templates</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">ProcessTemplates.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">ProcessTemplates</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// ...</span>
    <span class="annotation">@SkipWhenEmpty</span>
    <span class="annotation">@InputFiles</span>
    <span class="annotation">@PathSensitive</span>(PathSensitivity.NONE)
    <span class="directive">public</span> <span class="directive">abstract</span> ConfigurableFileCollection getSourceFiles();

    <span class="directive">public</span> <span class="type">void</span> sources(FileCollection sourceFiles) {
        getSourceFiles().from(sourceFiles);
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle processTemplates</code></div>
<div class="content">
<pre>&gt; gradle processTemplates
&gt; Task :processTemplates

BUILD SUCCESSFUL in 0s
3 actionable tasks: 3 executed</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In other words, as long as you add values and files to formal task inputs and outputs during the configuration phase, they will be treated as such regardless from where in the build you add them.</p>
</div>
<div class="paragraph">
<p>If we want to support tasks as arguments as well and treat their outputs as the inputs, we can use the <code>TaskProvider</code> directly like so:</p>
</div>
<div id="ex-declaring-a-method-to-add-a-task-as-an-input" class="exampleblock">
<div class="title">Example 329. <a href="#ex-declaring-a-method-to-add-a-task-as-an-input">Declaring a method to add a task as an input</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val copyTemplates by tasks.registering(Copy::class) {
    into(file(layout.buildDirectory.dir(&quot;tmp&quot;)))
    from(&quot;src/templates&quot;)
}

tasks.register&lt;ProcessTemplates&gt;(&quot;processTemplates2&quot;) {
    // ...
    sources(copyTemplates)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> copyTemplates = tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">copyTemplates</span><span class="delimiter">'</span></span>, Copy) {
    into file(layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">tmp</span><span class="delimiter">'</span></span>))
    from <span class="string"><span class="delimiter">'</span><span class="content">src/templates</span><span class="delimiter">'</span></span>
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">processTemplates2</span><span class="delimiter">'</span></span>, ProcessTemplates) {
    <span class="comment">// ...</span>
    sources copyTemplates
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">ProcessTemplates.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="comment">// ...</span>
    <span class="directive">public</span> <span class="type">void</span> sources(TaskProvider&lt;?&gt; inputTask) {
        getSourceFiles().from(inputTask);
    }
    <span class="comment">// ...</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle processTemplates2</code></div>
<div class="content">
<pre>&gt; gradle processTemplates2
&gt; Task :copyTemplates
&gt; Task :processTemplates2

BUILD SUCCESSFUL in 0s
4 actionable tasks: 4 executed</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This technique can make your custom task easier to use and result in cleaner build files.
As an added benefit, our use of <code>TaskProvider</code> means that our custom method can set up an inferred task dependency.</p>
</div>
<div class="paragraph">
<p>One last thing to note: if you are developing a task that takes collections of source files as inputs, like this example, consider using the built-in <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.SourceTask.html">SourceTask</a>. It will save you having to implement some of the plumbing that we put into <code>ProcessTemplates</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:link_output_dir_to_input_files"><a class="anchor" href="#sec:link_output_dir_to_input_files"></a><a class="link" href="#sec:link_output_dir_to_input_files">Linking an <code>@OutputDirectory</code> to an <code>@InputFiles</code></a></h5>
<div class="paragraph">
<p>When you want to link the output of one task to the input of another, the types often match and a simple property assignment will provide that link. For example, a <code>File</code> output property can be assigned to a <code>File</code> input.</p>
</div>
<div class="paragraph">
<p>Unfortunately, this approach breaks down when you want the files in a task’s <code>@OutputDirectory</code> (of type <code>File</code>) to become the source for another task’s <code>@InputFiles</code> property (of type <code>FileCollection</code>). Since the two have different types, property assignment won’t work.</p>
</div>
<div class="paragraph">
<p>As an example, imagine you want to use the output of a Java compilation task — via the <code>destinationDir</code> property — as the input of a custom task that instruments a set of files containing Java bytecode. This custom task, which we’ll call <code>Instrument</code>, has a <code>classFiles</code> property annotated with <code>@InputFiles</code>. You might initially try to configure the task like so:</p>
</div>
<div id="ex-failed-attempt-at-setting-up-an-inferred-task-dependency" class="exampleblock">
<div class="title">Example 330. <a href="#ex-failed-attempt-at-setting-up-an-inferred-task-dependency">Failed attempt at setting up an inferred task dependency</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;java-library&quot;)
}

tasks.register&lt;Instrument&gt;(&quot;badInstrumentClasses&quot;) {
    classFiles.from(fileTree(tasks.compileJava.flatMap { it.destinationDirectory }))
    destinationDir = layout.buildDirectory.dir(&quot;instrumented&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">badInstrumentClasses</span><span class="delimiter">'</span></span>, <span class="predefined-type">Instrument</span>) {
    classFiles.from fileTree(tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">compileJava</span><span class="delimiter">'</span></span>).flatMap { <span class="local-variable">it</span>.destinationDirectory }) {}
    destinationDir = file(layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">instrumented</span><span class="delimiter">'</span></span>))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean badInstrumentClasses</code></strong></div>
<div class="content">
<pre>&gt; gradle clean badInstrumentClasses
&gt; Task :clean UP-TO-DATE
&gt; Task :badInstrumentClasses NO-SOURCE

BUILD SUCCESSFUL in 0s
3 actionable tasks: 2 executed, 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There’s nothing obviously wrong with this code, but you can see from the console output that the compilation task is missing. In this case you would need to add an explicit task dependency between <code>instrumentClasses</code> and <code>compileJava</code> via <code>dependsOn</code>. The use of <code>fileTree()</code> means that Gradle can’t infer the task dependency itself.</p>
</div>
<div class="paragraph">
<p>One solution is to use the <code>TaskOutputs.files</code> property, as demonstrated by the following example:</p>
</div>
<div id="ex-setting-up-an-inferred-task-dependency-between-output-dir-and-input-files" class="exampleblock">
<div class="title">Example 331. <a href="#ex-setting-up-an-inferred-task-dependency-between-output-dir-and-input-files">Setting up an inferred task dependency between output dir and input files</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Instrument&gt;(&quot;instrumentClasses&quot;) {
    classFiles.from(tasks.compileJava.map { it.outputs.files })
    destinationDir = layout.buildDirectory.dir(&quot;instrumented&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">instrumentClasses</span><span class="delimiter">'</span></span>, <span class="predefined-type">Instrument</span>) {
    classFiles.from tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">compileJava</span><span class="delimiter">'</span></span>).map { <span class="local-variable">it</span>.outputs.files }
    destinationDir = file(layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">instrumented</span><span class="delimiter">'</span></span>))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean instrumentClasses</code></strong></div>
<div class="content">
<pre>&gt; gradle clean instrumentClasses
&gt; Task :clean UP-TO-DATE
&gt; Task :compileJava
&gt; Task :instrumentClasses

BUILD SUCCESSFUL in 0s
5 actionable tasks: 4 executed, 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can get Gradle to access the appropriate property itself by using one of <code>project.files()</code>, <code>project.layout.files()</code> or <code>project.objects.fileCollection()</code> in place of <code>project.fileTree()</code>:</p>
</div>
<div id="ex-setting-up-an-inferred-task-dependency-with-layout-files" class="exampleblock">
<div class="title">Example 332. <a href="#ex-setting-up-an-inferred-task-dependency-with-layout-files">Setting up an inferred task dependency with <code>layout.files()</code></a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Instrument&gt;(&quot;instrumentClasses2&quot;) {
    classFiles.from(layout.files(tasks.compileJava))
    destinationDir = layout.buildDirectory.dir(&quot;instrumented&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">instrumentClasses2</span><span class="delimiter">'</span></span>, <span class="predefined-type">Instrument</span>) {
    classFiles.from layout.files(tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">compileJava</span><span class="delimiter">'</span></span>))
    destinationDir = file(layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">instrumented</span><span class="delimiter">'</span></span>))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean instrumentClasses2</code></strong></div>
<div class="content">
<pre>&gt; gradle clean instrumentClasses2
&gt; Task :clean UP-TO-DATE
&gt; Task :compileJava
&gt; Task :instrumentClasses2

BUILD SUCCESSFUL in 0s
5 actionable tasks: 4 executed, 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Remember that <code>files()</code>, <code>layout.files()</code> and <code>objects.fileCollection()</code> can take tasks as arguments, whereas <code>fileTree()</code> cannot.</p>
</div>
<div class="paragraph">
<p>The downside of this approach is that all file outputs of the source task become the input files of the target — <code>instrumentClasses</code> in this case. That’s fine as long as the source task only has a single file-based output, like the <code>JavaCompile</code> task. But if you have to link just one output property among several, then you need to explicitly tell Gradle which task generates the input files using the <code>builtBy</code> method:</p>
</div>
<div id="ex-setting-up-an-inferred-task-dependency-with-builtby" class="exampleblock">
<div class="title">Example 333. <a href="#ex-setting-up-an-inferred-task-dependency-with-builtby">Setting up an inferred task dependency with builtBy()</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Instrument&gt;(&quot;instrumentClassesBuiltBy&quot;) {
    classFiles.from(fileTree(tasks.compileJava.flatMap { it.destinationDirectory }) {
        builtBy(tasks.compileJava)
    })
    destinationDir = layout.buildDirectory.dir(&quot;instrumented&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">instrumentClassesBuiltBy</span><span class="delimiter">'</span></span>, <span class="predefined-type">Instrument</span>) {
    classFiles.from fileTree(tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">compileJava</span><span class="delimiter">'</span></span>).flatMap { <span class="local-variable">it</span>.destinationDirectory }) {
        builtBy tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">compileJava</span><span class="delimiter">'</span></span>)
    }
    destinationDir = file(layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">instrumented</span><span class="delimiter">'</span></span>))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean instrumentClassesBuiltBy</code></strong></div>
<div class="content">
<pre>&gt; gradle clean instrumentClassesBuiltBy
&gt; Task :clean UP-TO-DATE
&gt; Task :compileJava
&gt; Task :instrumentClassesBuiltBy

BUILD SUCCESSFUL in 0s
5 actionable tasks: 4 executed, 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can of course just add an explicit task dependency via <code>dependsOn</code>, but the above approach provides more semantic meaning, explaining why <code>compileJava</code> has to run beforehand.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:disable-state-tracking"><a class="anchor" href="#sec:disable-state-tracking"></a><a class="link" href="#sec:disable-state-tracking">Disabling up-to-date checks</a></h5>
<div class="paragraph">
<p>Gradle automatically handles up-to-date checks for output files and directories, but what if the task output is something else entirely?
Perhaps it’s an update to a web service or a database table.
Or sometimes you have a task which should always run.</p>
</div>
<div class="paragraph">
<p>That’s where the <code>doNotTrackState()</code> method on <code>Task</code> comes in.
One can use this to disable up-to-date checks completely for a task, like so:</p>
</div>
<div id="ex-ignoring-up-to-date-checks" class="exampleblock">
<div class="title">Example 334. <a href="#ex-ignoring-up-to-date-checks">Ignoring up-to-date checks</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Instrument&gt;(&quot;alwaysInstrumentClasses&quot;) {
    classFiles.from(layout.files(tasks.compileJava))
    destinationDir = layout.buildDirectory.dir(&quot;instrumented&quot;)
    doNotTrackState(&quot;Instrumentation needs to re-run every time&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">alwaysInstrumentClasses</span><span class="delimiter">'</span></span>, <span class="predefined-type">Instrument</span>) {
    classFiles.from layout.files(tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">compileJava</span><span class="delimiter">'</span></span>))
    destinationDir = file(layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">instrumented</span><span class="delimiter">'</span></span>))
    doNotTrackState(<span class="string"><span class="delimiter">&quot;</span><span class="content">Instrumentation needs to re-run every time</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle clean alwaysInstrumentClasses</code></div>
<div class="content">
<pre>&gt; gradle clean alwaysInstrumentClasses
&gt; Task :compileJava
&gt; Task :alwaysInstrumentClasses

BUILD SUCCESSFUL in 0s
4 actionable tasks: 1 executed, 3 up-to-date</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle alwaysInstrumentClasses</code></div>
<div class="content">
<pre>&gt; gradle alwaysInstrumentClasses
&gt; Task :compileJava UP-TO-DATE
&gt; Task :alwaysInstrumentClasses

BUILD SUCCESSFUL in 0s
4 actionable tasks: 1 executed, 3 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you are writing your own task that always should run, then you can also use the <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/UntrackedTask.html">UntrackedTask</a></code> annotation on the task class instead of calling <code>Task.doNotTrackState()</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:untracked_external_tool"><a class="anchor" href="#sec:untracked_external_tool"></a><a class="link" href="#sec:untracked_external_tool">Integrate an external tool which does its own up-to-date checking</a></h5>
<div class="paragraph">
<p>Sometimes you want to integrate an external tool like Git or Npm, both of which do their own up-to-date checking.
In that case it doesn&#8217;t make much sense for Gradle to also do up-to-date checks.
You can disable Gradle&#8217;s up-to-date checks by using the <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/UntrackedTask.html">UntrackedTask</a></code> annotation on the task wrapping the tool.
Alternatively, you can use the runtime API method <code><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Task.html#org.gradle.api.Task:doNotTrackState(java.lang.String)">Task.doNotTrackState()</a></code>.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s say you want to implement a task which clones a Git repository.</p>
</div>
<div id="ex-task-for-git-clone" class="exampleblock">
<div class="title">Example 335. <a href="#ex-task-for-git-clone">Task for Git clone</a></div>
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/java/org/example/GitClone.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@UntrackedTask</span>(because = <span class="string"><span class="delimiter">&quot;</span><span class="content">Git tracks the state</span><span class="delimiter">&quot;</span></span>) // <b class="conum">(1)</b>
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">GitClone</span> <span class="directive">extends</span> DefaultTask {

    <span class="annotation">@Input</span>
    <span class="directive">public</span> <span class="directive">abstract</span> Property&lt;<span class="predefined-type">String</span>&gt; getRemoteUri();

    <span class="annotation">@Input</span>
    <span class="directive">public</span> <span class="directive">abstract</span> Property&lt;<span class="predefined-type">String</span>&gt; getCommitId();

    <span class="annotation">@OutputDirectory</span>
    <span class="directive">public</span> <span class="directive">abstract</span> DirectoryProperty getDestinationDir();

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> gitClone() <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="predefined-type">File</span> destinationDir = getDestinationDir().get().getAsFile().getAbsoluteFile(); // <b class="conum">(2)</b>
        <span class="predefined-type">String</span> remoteUri = getRemoteUri().get();
        <span class="comment">// Fetch origin or clone and checkout</span>
        <span class="comment">// ...</span>
    }

}</code></pre>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;GitClone&gt;(&quot;cloneGradleProfiler&quot;) {
    destinationDir = layout.buildDirectory.dir(&quot;gradle-profiler&quot;) // &lt;3
    remoteUri = &quot;https://github.com/gradle/gradle-profiler.git&quot;
    commitId = &quot;d6c18a21ca6c45fd8a9db321de4478948bdf801b&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">cloneGradleProfiler</span><span class="delimiter">&quot;</span></span>, GitClone) {
    destinationDir = layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">gradle-profiler</span><span class="delimiter">&quot;</span></span>) // <b class="conum">(3)</b>
    remoteUri = <span class="string"><span class="delimiter">&quot;</span><span class="content">https://github.com/gradle/gradle-profiler.git</span><span class="delimiter">&quot;</span></span>
    commitId = <span class="string"><span class="delimiter">&quot;</span><span class="content">d6c18a21ca6c45fd8a9db321de4478948bdf801b</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Declare the task as untracked.</p>
</li>
<li>
<p>Use the output directory to run the external tool.</p>
</li>
<li>
<p>Add the task and configure the output directory in your build.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="sec:configure_input_normalization"><a class="anchor" href="#sec:configure_input_normalization"></a><a class="link" href="#sec:configure_input_normalization">Configure input normalization</a></h5>
<div class="paragraph">
<p>For up to date checks and the <a href="#build_cache">build cache</a> Gradle needs to determine if two task input properties have the same value.
In order to do so, Gradle first normalizes both inputs and then compares the result.
For example, for a compile classpath, Gradle extracts the ABI signature from the classes on the classpath and then compares signatures between the last Gradle run and the current Gradle run as described in <a href="java_plugin.html#sec:java_compile_avoidance">Java compile avoidance</a>.</p>
</div>
<div class="paragraph">
<p>Normalization applies to all zip files on the classpath (e.g. jars, wars, aars, apks, etc).  This allows Gradle to recognize when two zip files are functionally the same, even though the zip files themselves might be slightly different due to metadata (such as timestamps or file order).  Normalization applies not only to zip files directly on the classpath, but also to zip files nested inside directories or inside other zip files on the classpath.</p>
</div>
<div class="paragraph">
<p>It is possible to customize Gradle&#8217;s built-in strategy for runtime classpath normalization.
All inputs annotated with <code>@<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/Classpath.html">Classpath</a></code> are considered to be runtime classpaths.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you want to add a file <code>build-info.properties</code> to all your produced jar files which contains information about the build, e.g. the timestamp when the build started or some ID to identify the CI job that published the artifact.
This file is only for auditing purposes, and has no effect on the outcome of running tests.
Nonetheless, this file is part of the runtime classpath for the <code>test</code> task and changes on every build invocation.
Therefore, the <code>test</code> would be never up-to-date or pulled from the build cache.
In order to benefit from incremental builds again, you are able tell Gradle to ignore this file on the runtime classpath at the project level by using <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:normalization(org.gradle.api.Action)">Project.normalization(org.gradle.api.Action)</a> (in the <em>consuming</em> project):</p>
</div>
<div id="ex-runtime-classpath-normalization" class="exampleblock">
<div class="title">Example 336. <a href="#ex-runtime-classpath-normalization">Runtime classpath normalization</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">normalization {
    runtimeClasspath {
        ignore(&quot;build-info.properties&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">normalization {
    runtimeClasspath {
        ignore <span class="string"><span class="delimiter">'</span><span class="content">build-info.properties</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If adding such a file to your jar files is something you do for all of the projects in your build, and you want to filter this file for all consumers,
you should consider configuring such normalization in a <a href="#sec:convention_plugins">convention plugin</a> to share it between subprojects.</p>
</div>
<div class="paragraph">
<p>The effect of this configuration would be that changes to <code>build-info.properties</code> would be ignored for up-to-date checks and <a href="#build_cache">build cache</a> key calculations.
Note that this will not change the runtime behavior of the <code>test</code> task — i.e. any test is still able to load <code>build-info.properties</code> and the runtime classpath is still the same as before.</p>
</div>
<div class="sect5">
<h6 id="sec:property_file_normalization"><a class="anchor" href="#sec:property_file_normalization"></a><a class="link" href="#sec:property_file_normalization">Properties file normalization</a></h6>
<div class="paragraph">
<p>By default, properties files (i.e. files that end in a <code>.properties</code> extension) will be normalized to ignore differences in comments, whitespace and the order of properties.
Gradle does this by loading the properties files and only considering the individual properties during up-to-date checks or build cache key calculations.</p>
</div>
<div class="paragraph">
<p>It is sometimes the case, though, that certain properties have a runtime impact, while others do not.
If a property is changing that does not have an impact on the runtime classpath, it may be desirable to exclude it from up-to-date checks and <a href="#build_cache">build cache</a> key calculations.
However, excluding the entire file would also exclude the properties that do have a runtime impact.
In this case, properties can be excluded selectively from any or all properties files on the runtime classpath.</p>
</div>
<div class="paragraph">
<p>A rule for ignoring properties can be applied to a specific set of files using the patterns described in <a href="https://docs.gradle.org/8.9/dsl/org.gradle.normalization.RuntimeClasspathNormalization.html">RuntimeClasspathNormalization</a>.
In the event that a file matches a rule, but cannot be loaded as a properties file (e.g. because it is not formatted properly or uses a non-standard encoding), it will be incorporated into the up-to-date or build cache key calculation as a normal file.
In other words, if the file cannot be loaded as a properties file, any changes to whitespace, property order, or comments may cause the task to become out-of-date or cause a cache miss.</p>
</div>
<div id="ex-ignore-a-property-in-selected-properties-files" class="exampleblock">
<div class="title">Example 337. <a href="#ex-ignore-a-property-in-selected-properties-files">Ignore a property in selected properties files</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">normalization {
    runtimeClasspath {
        properties(&quot;**/build-info.properties&quot;) {
            ignoreProperty(&quot;timestamp&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">normalization {
    runtimeClasspath {
        properties(<span class="string"><span class="delimiter">'</span><span class="content">**/build-info.properties</span><span class="delimiter">'</span></span>) {
            ignoreProperty <span class="string"><span class="delimiter">'</span><span class="content">timestamp</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="ex-ignore-a-property-in-all-properties-files" class="exampleblock">
<div class="title">Example 338. <a href="#ex-ignore-a-property-in-all-properties-files">Ignore a property in all properties files</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">normalization {
    runtimeClasspath {
        properties {
            ignoreProperty(&quot;timestamp&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">normalization {
    runtimeClasspath {
        properties {
            ignoreProperty <span class="string"><span class="delimiter">'</span><span class="content">timestamp</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:meta_inf_normalization"><a class="anchor" href="#sec:meta_inf_normalization"></a><a class="link" href="#sec:meta_inf_normalization">Java <code>META-INF</code> normalization</a></h6>
<div class="paragraph">
<p>For files in the <code>META-INF</code> directory of jar archives it&#8217;s not always possible to ignore files completely due to their runtime impact.</p>
</div>
<div class="paragraph">
<p>Manifest files within <code>META-INF</code> are normalized to ignore comments, whitespace and order differences.
Manifest attribute names are compared case-and-order insensitively.
Manifest properties files are normalized according to <a href="#sec:property_file_normalization">Properties File Normalization</a>.</p>
</div>
<div id="ex-ignore-meta-inf-manifest-attributes" class="exampleblock">
<div class="title">Example 339. <a href="#ex-ignore-meta-inf-manifest-attributes">Ignore <code>META-INF</code> manifest attributes</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">normalization {
    runtimeClasspath {
        metaInf {
            ignoreAttribute(&quot;Implementation-Version&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">normalization {
    runtimeClasspath {
        metaInf {
            ignoreAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">Implementation-Version</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="ex-ignore-meta-inf-property-keys" class="exampleblock">
<div class="title">Example 340. <a href="#ex-ignore-meta-inf-property-keys">Ignore <code>META-INF</code> property keys</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">normalization {
    runtimeClasspath {
        metaInf {
            ignoreProperty(&quot;app.version&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">normalization {
    runtimeClasspath {
        metaInf {
            ignoreProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.version</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="ex-ignore-meta-infmanifest-mf" class="exampleblock">
<div class="title">Example 341. <a href="#ex-ignore-meta-infmanifest-mf">Ignore <code>META-INF/MANIFEST.MF</code></a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">normalization {
    runtimeClasspath {
        metaInf {
            ignoreManifest()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">normalization {
    runtimeClasspath {
        metaInf {
            ignoreManifest()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="ex-ignore-all-files-and-directories-inside-meta-inf" class="exampleblock">
<div class="title">Example 342. <a href="#ex-ignore-all-files-and-directories-inside-meta-inf">Ignore all files and directories inside <code>META-INF</code></a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">normalization {
    runtimeClasspath {
        metaInf {
            ignoreCompletely()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">normalization {
    runtimeClasspath {
        metaInf {
            ignoreCompletely()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:custom_up_to_date_logic"><a class="anchor" href="#sec:custom_up_to_date_logic"></a><a class="link" href="#sec:custom_up_to_date_logic">Providing custom up-to-date logic</a></h5>
<div class="paragraph">
<p>Gradle automatically handles up-to-date checks for output files and directories, but what if the task output is something else entirely?
Perhaps it’s an update to a web service or a database table.
Gradle has no way of knowing how to check whether the task is up to date in such cases.</p>
</div>
<div class="paragraph">
<p>That’s where the <code>upToDateWhen()</code> method on <code>TaskOutputs</code> comes in.
This takes a predicate function that is used to determine whether a task is up to date or not.
For example, you could read the version number of your database schema from the database.
Or, you could check whether a particular record in a database table exists or has changed for example.</p>
</div>
<div class="paragraph">
<p>Just be aware that up-to-date checks should <em>save</em> you time.
Don’t add checks that cost as much or more time than the standard execution of the task.
In fact, if a task ends up running frequently anyway, because it’s rarely up to date, then it may not be worth having no up-to-date checks at all as described in <a href="#sec:disable-state-tracking">Disabling up-to-date checks</a>.
Remember that your checks will always run if the task is in the execution task graph.</p>
</div>
<div class="paragraph">
<p>One common mistake is to use <code>upToDateWhen()</code> instead of <code>Task.onlyIf()</code>.
If you want to skip a task on the basis of some condition unrelated to the task inputs and outputs, then you should use <code>onlyIf()</code>.
For example, in cases where you want to skip a task when a particular property is set or not set.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:stale_task_outputs"><a class="anchor" href="#sec:stale_task_outputs"></a><a class="link" href="#sec:stale_task_outputs">Stale task outputs</a></h4>
<div class="paragraph">
<p>When the Gradle version changes, Gradle detects that outputs from tasks that ran with older versions of Gradle need to be removed to ensure that the newest version of the tasks are starting from a known clean state.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Automatic clean-up of stale output directories has only been implemented for the output of source sets (Java/Groovy/Scala compilation).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="config_cache"><a class="anchor" href="#config_cache"></a><a class="link" href="#config_cache">Configuration cache</a></h3>
<div class="sect3">
<h4 id="config_cache:intro"><a class="anchor" href="#config_cache:intro"></a><a class="link" href="#config_cache:intro">Introduction</a></h4>
<div class="paragraph">
<p>The configuration cache is a feature that significantly improves build performance by caching the result of the <a href="#build_lifecycle">configuration phase</a> and reusing this for subsequent builds.
Using the configuration cache, Gradle can skip the configuration phase entirely when nothing that affects the build configuration, such as build scripts, has changed.
Gradle also applies performance improvements to task execution as well.</p>
</div>
<div class="paragraph">
<p>The configuration cache is conceptually similar to the <a href="#build_cache">build cache</a>, but caches different information.
The build cache takes care of caching the outputs and intermediate files of the build, such as task outputs or artifact transform outputs.
The configuration cache takes care of caching the build configuration for a particular set of tasks.
In other words, the configuration cache saves the output of the configuration phase, and the build cache saves the outputs of the execution phase.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is currently not enabled by default. This feature has the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The configuration cache does not support all <a href="#config_cache:plugins:core">core Gradle plugins</a> and <a href="#config_cache:not_yet_implemented">features</a>. Full support is a work in progress.</p>
</li>
<li>
<p>Your build and the plugins you depend on might require changes to fulfil the <a href="#config_cache:requirements">requirements</a>.</p>
</li>
<li>
<p>IDE imports and syncs do not yet use the configuration cache.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="config_cache:intro:how_does_it_work"><a class="anchor" href="#config_cache:intro:how_does_it_work"></a><a class="link" href="#config_cache:intro:how_does_it_work">How does it work?</a></h5>
<div class="paragraph">
<p>When the configuration cache is enabled and you run Gradle for a particular set of tasks, for example by running <code>gradlew check</code>, Gradle checks whether a configuration cache entry is available for the requested set of tasks.
If available, Gradle uses this entry instead of running the configuration phase.
The cache entry contains information about the set of tasks to run, along with their configuration and dependency information.</p>
</div>
<div class="paragraph">
<p>The first time you run a particular set of tasks, there will be no entry in the configuration cache for these tasks and so Gradle will run the configuration phase as normal:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run init scripts.</p>
</li>
<li>
<p>Run the settings script for the build, applying any requested settings plugins.</p>
</li>
<li>
<p>Configure and build the <code>buildSrc</code> project, if present.</p>
</li>
<li>
<p>Run the builds scripts for the build, applying any requested project plugins.</p>
</li>
<li>
<p>Calculate the task graph for the requested tasks, running any deferred configuration actions.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Following the configuration phase, Gradle writes a snapshot of the task graph to a new configuration cache entry, for later Gradle invocations.
Gradle then loads the task graph from the configuration cache, so that it can apply optimizations to the tasks, and then runs the execution phase as normal.
Configuration time will still be spent the first time you run a particular set of tasks.
However, you should see build performance improvement immediately because <a href="#config_cache:intro:performance_improvements">tasks will run in parallel</a>.</p>
</div>
<div class="paragraph">
<p>When you subsequently run Gradle with this same set of tasks, for example by running <code>gradlew check</code> again, Gradle will load the tasks and their configuration directly from the configuration cache and skip the configuration phase entirely.
Before using a configuration cache entry, Gradle checks that none of the "build configuration inputs", such as build scripts, for the entry have changed.
If a build configuration input has changed, Gradle will not use the entry and will run the configuration phase again as above, saving the result for later reuse.</p>
</div>
<div class="paragraph">
<p>Build configuration inputs include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Init scripts</p>
</li>
<li>
<p>Settings scripts</p>
</li>
<li>
<p>Build scripts</p>
</li>
<li>
<p>System properties used during the configuration phase</p>
</li>
<li>
<p>Gradle properties used during the configuration phase</p>
</li>
<li>
<p>Environment variables used during the configuration phase</p>
</li>
<li>
<p>Configuration files accessed using value suppliers such as providers</p>
</li>
<li>
<p><code>buildSrc</code> and plugin included build inputs, including build configuration inputs and source files.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle uses its own optimized serialization mechanism and format to store the configuration cache entries.
It automatically serializes the state of arbitrary object graphs.
If your tasks hold references to objects with simple state or of supported types you don&#8217;t have anything to do to support the serialization.</p>
</div>
<div class="paragraph">
<p>As a fallback and to provide some aid in migrating existing tasks, some semantics of <a href="#config_cache:not_yet_implemented:java_serialization">Java Serialization</a> are supported. But it is not recommended relying on it, mostly for performance reasons.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:intro:performance_improvements"><a class="anchor" href="#config_cache:intro:performance_improvements"></a><a class="link" href="#config_cache:intro:performance_improvements">Performance improvements</a></h5>
<div class="paragraph">
<p>Apart from skipping the configuration phase, the configuration cache provides some additional performance improvements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All tasks run in parallel by default, subject to dependency constraints.</p>
</li>
<li>
<p>Dependency resolution is cached.</p>
</li>
<li>
<p>Configuration state and dependency resolution state is discarded from heap after writing the task graph. This reduces the peak heap usage required for a given set of tasks.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:in_action"><a class="anchor" href="#config_cache:in_action"></a><a class="link" href="#config_cache:in_action">Configuration caching in action</a></h5>
<div class="imageblock">
<div class="content">
<img src="img/configuration-cache/running-help.gif" alt="running help">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="config_cache:usage"><a class="anchor" href="#config_cache:usage"></a><a class="link" href="#config_cache:usage">Using the configuration cache</a></h4>
<div class="paragraph">
<p>It is recommended to get started with the simplest task invocation possible.
Running <code>help</code> with the configuration cache enabled is a good first step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle --configuration-cache help
Calculating task graph as no cached configuration is available for tasks: help
...
BUILD SUCCESSFUL in 4s
1 actionable task: 1 executed
Configuration cache entry stored.</pre>
</div>
</div>
<div class="paragraph">
<p>Running this for the first time, the configuration phase executes, calculating the task graph.</p>
</div>
<div class="paragraph">
<p>Then, run the same command again.
This reuses the cached configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle --configuration-cache help
Reusing configuration cache.
...
BUILD SUCCESSFUL in 500ms
1 actionable task: 1 executed
Configuration cache entry reused.</pre>
</div>
</div>
<div class="paragraph">
<p>If it succeeds on your build, congratulations, you can now try with more useful tasks.
You should target your development loop.
A good example is running tests after making incremental changes.</p>
</div>
<div class="paragraph">
<p>If any problem is found caching or reusing the configuration, an HTML report is generated to help you diagnose and fix the issues. The report also shows detected build configuration inputs like
system properties, environment variables and value suppliers read during the configuration phase.
See the <a href="#config_cache:troubleshooting">Troubleshooting</a> section below for more information.</p>
</div>
<div class="paragraph">
<p>Keep reading to learn how to tweak the configuration cache, manually invalidate the state if something goes wrong and use the configuration cache from an IDE.</p>
</div>
<div class="sect4">
<h5 id="config_cache:usage:enable"><a class="anchor" href="#config_cache:usage:enable"></a><a class="link" href="#config_cache:usage:enable">Enabling the configuration cache</a></h5>
<div class="paragraph">
<p>By default, Gradle does not use the configuration cache.
To enable the cache at build time, use the <code>configuration-cache</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle --configuration-cache</pre>
</div>
</div>
<div class="paragraph">
<p>You can also enable the cache persistently in a <code>gradle.properties</code> file using the <code>org.gradle.configuration-cache</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.configuration-cache=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>If enabled in a <code>gradle.properties</code> file, you can override that setting and disable the cache at build time with the <code>no-configuration-cache</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle --no-configuration-cache</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:usage:ignore_problems"><a class="anchor" href="#config_cache:usage:ignore_problems"></a><a class="link" href="#config_cache:usage:ignore_problems">Ignoring problems</a></h5>
<div class="paragraph">
<p>By default, Gradle will fail the build if any configuration cache problems are encountered.
When gradually improving your plugin or build logic to support the configuration cache it can be useful to temporarily turn problems into warnings, with no guarantee that the build will work.</p>
</div>
<div class="paragraph">
<p>This can be done from the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle --configuration-cache-problems=warn</pre>
</div>
</div>
<div class="paragraph">
<p>or in a <code>gradle.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.configuration-cache.problems=warn</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:usage:max_problems"><a class="anchor" href="#config_cache:usage:max_problems"></a><a class="link" href="#config_cache:usage:max_problems">Allowing a maximum number of problems</a></h5>
<div class="paragraph">
<p>When configuration cache problems are turned into warnings, Gradle will fail the build if <code>512</code> problems are found by default.</p>
</div>
<div class="paragraph">
<p>This can be adjusted by specifying an allowed maximum number of problems on the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle -Dorg.gradle.configuration-cache.max-problems=5</pre>
</div>
</div>
<div class="paragraph">
<p>or in a <code>gradle.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.configuration-cache.max-problems=5</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:usage:invalidate"><a class="anchor" href="#config_cache:usage:invalidate"></a><a class="link" href="#config_cache:usage:invalidate">Invalidating the cache</a></h5>
<div class="paragraph">
<p>The configuration cache is automatically invalidated when inputs to the configuration phase change.
However, certain inputs are not tracked yet, so you may have to manually invalidate the configuration cache when untracked inputs to the configuration phase change.
This can happen if you <a href="#config_cache:usage:ignore_problems">ignored problems</a>.
See the <a href="#config_cache:requirements">Requirements</a> and <a href="#config_cache:not_yet_implemented">Not yet implemented</a> sections below for more information.</p>
</div>
<div class="paragraph">
<p>The configuration cache state is stored on disk in a directory named <code>.gradle/configuration-cache</code> in the root directory of the Gradle build in use.
If you need to invalidate the cache, simply delete that directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ rm -rf .gradle/configuration-cache</pre>
</div>
</div>
<div class="paragraph">
<p>Configuration cache entries are checked periodically (at most every 24 hours) for whether they are still in use.
They are deleted if they haven&#8217;t been used for 7 days.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="config_cache:stable"><a class="anchor" href="#config_cache:stable"></a><a class="link" href="#config_cache:stable">Stable configuration cache</a></h4>
<div class="paragraph">
<p>Working towards the stabilization of configuration caching we implemented some strictness behind a feature flag when it was considered too disruptive for early adopters.</p>
</div>
<div class="paragraph">
<p>You can enable that feature flag as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">enableFeaturePreview(&quot;STABLE_CONFIGURATION_CACHE&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">enableFeaturePreview <span class="string"><span class="delimiter">&quot;</span><span class="content">STABLE_CONFIGURATION_CACHE</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>STABLE_CONFIGURATION_CACHE</code> feature flag enables the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Undeclared shared build service usage</dt>
<dd>
<p>When enabled, tasks using a <a href="#build_services">shared build service</a> without declaring the requirement via the <code>Task.usesService</code> method will emit a deprecation warning.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In addition, when the configuration cache is not enabled but the feature flag is present, deprecations for the following <a href="#config_cache:requirements">configuration cache requirements</a> are also enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#config_cache:requirements:build_listeners">Registering build listeners</a></p>
</li>
<li>
<p><a href="#config_cache:requirements:use_project_during_execution">Using the <code>Project</code> object at execution time</a></p>
</li>
<li>
<p><a href="#config_cache:requirements:task_extensions">Using task extensions and conventions at execution time</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is recommended to enable it as soon as possible in order to be ready for when we remove the flag and make the linked features the default.</p>
</div>
</div>
<div class="sect3">
<h4 id="config_cache:ide"><a class="anchor" href="#config_cache:ide"></a><a class="link" href="#config_cache:ide">IDE support</a></h4>
<div class="paragraph">
<p>If you enable and configure the configuration cache from your <code>gradle.properties</code> file, then the configuration cache will be enabled when your IDE delegates to Gradle.
There&#8217;s nothing more to do.</p>
</div>
<div class="paragraph">
<p><code>gradle.properties</code> is usually checked in to source control.
If you don&#8217;t want to enable the configuration cache for your whole team yet you can also enable the configuration cache from your IDE only as explained below.</p>
</div>
<div class="paragraph">
<p>Note that syncing a build from an IDE doesn&#8217;t benefit from the configuration cache, only running tasks does.</p>
</div>
<div class="sect4">
<h5 id="config_cache:ide:intellij"><a class="anchor" href="#config_cache:ide:intellij"></a><a class="link" href="#config_cache:ide:intellij">IntelliJ based IDEs</a></h5>
<div class="paragraph">
<p>In IntelliJ IDEA or Android Studio this can be done in two ways, either globally or per run configuration.</p>
</div>
<div class="paragraph">
<p>To enable it for the whole build, go to <code>Run &gt; Edit configurations&#8230;&#8203;</code>.
This will open the IntelliJ IDEA or Android Studio dialog to configure Run/Debug configurations.
Select <code>Templates &gt; Gradle</code> and add the necessary system properties to the <code>VM options</code> field.</p>
</div>
<div class="paragraph">
<p>For example to enable the configuration cache, turning problems into warnings, add the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-Dorg.gradle.configuration-cache=true -Dorg.gradle.configuration-cache.problems=warn</pre>
</div>
</div>
<div class="paragraph">
<p>You can also choose to only enable it for a given run configuration.
In this case, leave the <code>Templates &gt; Gradle</code> configuration untouched and edit each run configuration as you see fit.</p>
</div>
<div class="paragraph">
<p>Combining these two ways you can enable globally and disable for certain run configurations, or the opposite.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the <a href="https://github.com/JetBrains/gradle-idea-ext-plugin">gradle-idea-ext-plugin</a> to configure IntelliJ run configurations from your build.
This is a good way to enable the configuration cache only for the IDE.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:ide:eclipse"><a class="anchor" href="#config_cache:ide:eclipse"></a><a class="link" href="#config_cache:ide:eclipse">Eclipse IDEs</a></h5>
<div class="paragraph">
<p>In Eclipse IDEs you can enable and configure the configuration cache through Buildship in two ways, either globally or per run configuration.</p>
</div>
<div class="paragraph">
<p>To enable it globally, go to <code>Preferences &gt; Gradle</code>.
You can use the properties described above as system properties.
For example to enable the configuration cache, turning problems into warnings, add the following JVM arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-Dorg.gradle.configuration-cache=true</code></p>
</li>
<li>
<p><code>-Dorg.gradle.configuration-cache.problems=warn</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To enable it for a given run configuration, go to <code>Run configurations&#8230;&#8203;</code>, find the one you want to change, go to <code>Project Settings</code>, tick the <code>Override project settings</code> checkbox and add the same system properties as a <code>JVM argument</code>.</p>
</div>
<div class="paragraph">
<p>Combining these two ways you can enable globally and disable for certain run configurations, or the opposite.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="config_cache:plugins"><a class="anchor" href="#config_cache:plugins"></a><a class="link" href="#config_cache:plugins">Supported plugins</a></h4>
<div class="paragraph">
<p>The configuration cache is brand new and introduces new requirements for plugin implementations.
As a result, both core Gradle plugins, and community plugins need to be adjusted.
This section provides information about the current support in <a href="#config_cache:plugins:core">core Gradle plugins</a> and <a href="#config_cache:plugins:community">community plugins</a>.</p>
</div>
<div class="sect4">
<h5 id="config_cache:plugins:core"><a class="anchor" href="#config_cache:plugins:core"></a><a class="link" href="#config_cache:plugins:core">Core Gradle plugins</a></h5>
<div class="paragraph">
<p>Not all <a href="#plugin_reference">core Gradle plugins</a> support configuration caching yet.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">JVM languages and frameworks</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Native languages</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Packaging and distribution</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13457"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="java_plugin.html#java_plugin">Java</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13458"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="#java_library_plugin">Java Library</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13459"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="#java_platform_plugin">Java Platform</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13460"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="#groovy_plugin">Groovy</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13461"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="#scala_plugin">Scala</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13462"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="antlr_plugin.html#antlr_plugin">ANTLR</a></p>
</td>
</tr>
</table>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13484"><span class="red">✖</span></a>
</td>
<td class="hdlist2">
<p><a href="cpp_application_plugin.html#cpp_application_plugin">C++ Application</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13485"><span class="red">✖</span></a>
</td>
<td class="hdlist2">
<p><a href="cpp_library_plugin.html#cpp_library_plugin">C++ Library</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13514"><span class="red">✖</span></a>
</td>
<td class="hdlist2">
<p><a href="cpp_unit_test_plugin.html#cpp_unit_test_plugin">C++ Unit Test</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13515"><span class="red">✖</span></a>
</td>
<td class="hdlist2">
<p><a href="swift_application_plugin.html#swift_application_plugin">Swift Application</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13487"><span class="red">✖</span></a>
</td>
<td class="hdlist2">
<p><a href="swift_library_plugin.html#swift_library_plugin">Swift Library</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13488"><span class="red">✖</span></a>
</td>
<td class="hdlist2">
<p><a href="xctest_plugin.html#xctest_plugin">XCTest</a></p>
</td>
</tr>
</table>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13463"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="#application_plugin">Application</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13466"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="war_plugin.html#war_plugin">WAR</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13467"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="ear_plugin.html#ear_plugin">EAR</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/24329"><span class="yellow">⚠</span></a>
</td>
<td class="hdlist2">
<p><a href="#publishing_maven">Maven Publish</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/24328"><span class="yellow">⚠</span></a>
</td>
<td class="hdlist2">
<p><a href="#publishing_ivy">Ivy Publish</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13464"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="distribution_plugin.html#distribution_plugin">Distribution</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13465"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="java_library_distribution_plugin.html#java_library_distribution_plugin">Java Library Distribution</a></p>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"> Code analysis</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock"> IDE project files generation</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Utility</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13475"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="checkstyle_plugin.html#checkstyle_plugin">Checkstyle</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13478"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="codenarc_plugin.html#codenarc_plugin">CodeNarc</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13477"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="jacoco_plugin.html#jacoco_plugin">JaCoCo</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<span class="green">✓</span>
</td>
<td class="hdlist2">
<p><a href="jacoco_report_aggregation_plugin.html#jacoco_report_aggregation_plugin">JaCoCo Report Aggregation</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13476"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="pmd_plugin.html#pmd_plugin">PMD</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<span class="green">✓</span>
</td>
<td class="hdlist2">
<p><a href="test_report_aggregation_plugin.html#test_report_aggregation_plugin">Test Report Aggregation</a></p>
</td>
</tr>
</table>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13479"><span class="red">✖</span></a>
</td>
<td class="hdlist2">
<p><a href="eclipse_plugin.html#eclipse_plugin">Eclipse</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13480"><span class="red">✖</span></a>
</td>
<td class="hdlist2">
<p><a href="idea_plugin.html#idea_plugin">IntelliJ IDEA</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13482"><span class="red">✖</span></a>
</td>
<td class="hdlist2">
<p><a href="visual_studio_plugin.html#visual_studio_plugin">Visual Studio</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13483"><span class="red">✖</span></a>
</td>
<td class="hdlist2">
<p><a href="xcode_plugin.html#xcode_plugin">Xcode</a></p>
</td>
</tr>
</table>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13455"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="base_plugin.html#base_plugin">Base</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13456"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="build_init_plugin.html#build_init_plugin">Build Init</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13470"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="signing_plugin.html#signing_plugin">Signing</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/24537"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="java_gradle_plugin.html#java_gradle_plugin">Java Plugin Development</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/23029"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="#implemention_precompiled_plugins">Groovy DSL Plugin Development</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13472"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="#sec:kotlin-dsl_plugin">Kotlin DSL Plugin Development</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/gradle/gradle/issues/13473"><span class="green">✓</span></a>
</td>
<td class="hdlist2">
<p><a href="project_report_plugin.html#project_report_plugin">Project Report Plugin</a></p>
</td>
</tr>
</table>
</div></div></td>
</tr>
</tbody>
</table>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<span class="green">✓</span>
</td>
<td class="hdlist2">
<p>Supported plugin</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<span class="yellow">⚠</span>
</td>
<td class="hdlist2">
<p>Partially supported plugin</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<span class="red">✖</span>
</td>
<td class="hdlist2">
<p>Unsupported plugin</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:plugins:community"><a class="anchor" href="#config_cache:plugins:community"></a><a class="link" href="#config_cache:plugins:community">Community plugins</a></h5>
<div class="paragraph">
<p>Please refer to issue <a href="https://github.com/gradle/gradle/issues/13490">gradle/gradle#13490</a> to learn about the status of community plugins.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="config_cache:troubleshooting"><a class="anchor" href="#config_cache:troubleshooting"></a><a class="link" href="#config_cache:troubleshooting">Troubleshooting</a></h4>
<div class="paragraph">
<p>The following sections will go through some general guidelines on dealing with problems with the configuration cache.
This applies to both your build logic and to your Gradle plugins.</p>
</div>
<div class="paragraph">
<p>Upon failure to serialize the state required to run the tasks, an HTML report of detected problems is generated.
The Gradle failure output includes a clickable link to the report.
This report is useful and allows you to drill down into problems, understand what is causing them.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a simple example build script that contains a couple problems:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;someTask&quot;) {
    val destination = System.getProperty(&quot;someDestination&quot;) // <b class="conum">(1)</b>
    inputs.dir(&quot;source&quot;)
    outputs.dir(destination)
    doLast {
        project.copy { // <b class="conum">(2)</b>
            from(&quot;source&quot;)
            into(destination)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">someTask</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> destination = <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">someDestination</span><span class="delimiter">'</span></span>) // <b class="conum">(1)</b>
    inputs.dir(<span class="string"><span class="delimiter">'</span><span class="content">source</span><span class="delimiter">'</span></span>)
    outputs.dir(destination)
    doLast {
        project.copy { // <b class="conum">(2)</b>
            from <span class="string"><span class="delimiter">'</span><span class="content">source</span><span class="delimiter">'</span></span>
            into destination
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><a href="#config_cache:requirements:reading_sys_props_and_env_vars">A system property read at configuration time</a></p>
</li>
<li>
<p><a href="#config_cache:requirements:use_project_during_execution">Using the <code>Project</code> object at execution time</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Running that task fails and print the following in the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle --configuration-cache someTask -DsomeDestination=dest
...
* What went wrong:
Configuration cache problems found in this build.

1 problem was found storing the configuration cache.
- Build file 'build.gradle': line 6: invocation of 'Task.project' at execution time is unsupported.
  See https://docs.gradle.org/0.0.0/userguide/configuration_cache.html#config_cache:requirements:use_project_during_execution

See the complete report at file:///home/user/gradle/samples/build/reports/configuration-cache/&lt;hash&gt;/configuration-cache-report.html
&gt; Invocation of 'Task.project' by task ':someTask' at execution time is unsupported.

* Try:
&gt; Run with --stacktrace option to get the stack trace.
&gt; Run with --info or --debug option to get more log output.
&gt; Run with --scan to get full insights.
&gt; Get more help at https://help.gradle.org.

BUILD FAILED in 0s
1 actionable task: 1 executed
Configuration cache entry discarded with 1 problem.</pre>
</div>
</div>
<div class="paragraph">
<p>The configuration cache entry was discarded because of the found problem failing the build.</p>
</div>
<div class="paragraph">
<p>Details can be found in the linked HTML report:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/configuration-cache/problems-report.png" alt="problems report">
</div>
</div>
<div class="paragraph">
<p>The report displays the set of problems twice.
First grouped by problem message, then grouped by task.
The former allows you to quickly see what classes of problems your build is facing.
The latter allows you to quickly see which tasks are problematic.
In both cases you can expand the tree in order to discover where the culprit is in the object graph.</p>
</div>
<div class="paragraph">
<p>The report also includes a list of detected build configuration inputs, such as environment variables, system properties and value suppliers that were read at configuration phase:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/configuration-cache/inputs-report.png" alt="inputs report">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Problems displayed in the report have links to the corresponding <a href="#config_cache:requirements">requirement</a> where you can find guidance on how to fix the problem or to the corresponding <a href="#config_cache:not_yet_implemented">not yet implemented</a> feature.</p>
</div>
<div class="paragraph">
<p>When changing your build or plugin to fix the problems you should consider <a href="#config_cache:testing">testing your build logic with TestKit</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At this stage, you can decide to either <a href="#config_cache:usage:ignore_problems">turn the problems into warnings</a> and continue exploring how your build reacts to the configuration cache, or fix the problems at hand.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s ignore the reported problem, and run the same build again twice to see what happens when reusing the cached problematic configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle --configuration-cache --configuration-cache-problems=warn someTask -DsomeDestination=dest
Calculating task graph as no cached configuration is available for tasks: someTask
&gt; Task :someTask

1 problem was found storing the configuration cache.
- Build file 'build.gradle': line 6: invocation of 'Task.project' at execution time is unsupported.
  See https://docs.gradle.org/0.0.0/userguide/configuration_cache.html#config_cache:requirements:use_project_during_execution

See the complete report at file:///home/user/gradle/samples/build/reports/configuration-cache/&lt;hash&gt;/configuration-cache-report.html

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed
Configuration cache entry stored with 1 problem.
❯ gradle --configuration-cache --configuration-cache-problems=warn someTask -DsomeDestination=dest
Reusing configuration cache.
&gt; Task :someTask

1 problem was found reusing the configuration cache.
- Build file 'build.gradle': line 6: invocation of 'Task.project' at execution time is unsupported.
  See https://docs.gradle.org/0.0.0/userguide/configuration_cache.html#config_cache:requirements:use_project_during_execution

See the complete report at file:///home/user/gradle/samples/build/reports/configuration-cache/&lt;hash&gt;/configuration-cache-report.html

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed
Configuration cache entry reused with 1 problem.</pre>
</div>
</div>
<div class="paragraph">
<p>The two builds succeed reporting the observed problem, storing then reusing the configuration cache.</p>
</div>
<div class="paragraph">
<p>With the help of the links present in the console problem summary and in the HTML report we can fix our problems.
Here&#8217;s a fixed version of the build script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class MyCopyTask : DefaultTask() { // <b class="conum">(1)</b>

    @get:InputDirectory abstract val source: DirectoryProperty // <b class="conum">(2)</b>

    @get:OutputDirectory abstract val destination: DirectoryProperty // <b class="conum">(2)</b>

    @get:Inject abstract val fs: FileSystemOperations // <b class="conum">(3)</b>

    @TaskAction
    fun action() {
        fs.copy { // <b class="conum">(3)</b>
            from(source)
            into(destination)
        }
    }
}

tasks.register&lt;MyCopyTask&gt;(&quot;someTask&quot;) {
    val projectDir = layout.projectDirectory
    source = projectDir.dir(&quot;source&quot;)
    destination = projectDir.dir(System.getProperty(&quot;someDestination&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">MyCopyTask</span> <span class="directive">extends</span> DefaultTask { // <b class="conum">(1)</b>

    <span class="annotation">@InputDirectory</span> <span class="directive">abstract</span> DirectoryProperty getSource() // <b class="conum">(2)</b>

    <span class="annotation">@OutputDirectory</span> <span class="directive">abstract</span> DirectoryProperty getDestination() // <b class="conum">(2)</b>

    <span class="annotation">@Inject</span> <span class="directive">abstract</span> FileSystemOperations getFs() // <b class="conum">(3)</b>

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> action() {
        fs.copy { // <b class="conum">(3)</b>
            from source
            into destination
        }
    }
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">someTask</span><span class="delimiter">'</span></span>, MyCopyTask) {
    <span class="keyword">def</span> projectDir = layout.projectDirectory
    source = projectDir.dir(<span class="string"><span class="delimiter">'</span><span class="content">source</span><span class="delimiter">'</span></span>)
    destination = projectDir.dir(<span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">someDestination</span><span class="delimiter">'</span></span>))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We turned our ad-hoc task into a proper task class,</p>
</li>
<li>
<p>with inputs and outputs declaration,</p>
</li>
<li>
<p>and injected with the <code>FileSystemOperations</code> service, a supported replacement for <a href="#config_cache:requirements:use_project_during_execution"><code>project.copy {}</code></a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Running the task twice now succeeds without reporting any problem and reuses the configuration cache on the second run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle --configuration-cache someTask -DsomeDestination=dest
Calculating task graph as no cached configuration is available for tasks: someTask
&gt; Task :someTask

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed
Configuration cache entry stored.
❯ gradle --configuration-cache someTask -DsomeDestination=dest
Reusing configuration cache.
&gt; Task :someTask

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed
Configuration cache entry reused.</pre>
</div>
</div>
<div class="paragraph">
<p>But, what if we change the value of the system property?</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle --configuration-cache someTask -DsomeDestination=another
Calculating task graph as configuration cache cannot be reused because system property 'someDestination' has changed.
&gt; Task :someTask

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed
Configuration cache entry stored.</pre>
</div>
</div>
<div class="paragraph">
<p>The previous configuration cache entry could not be reused, and the task graph had to be calculated and stored again.
This is because we read the system property at configuration time, hence requiring Gradle to run the configuration phase again when the value of that property changes.
Fixing that is as simple as obtaining the provider of the system property and wiring it to the task input, without reading it at configuration time.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;MyCopyTask&gt;(&quot;someTask&quot;) {
    val projectDir = layout.projectDirectory
    source = projectDir.dir(&quot;source&quot;)
    destination = projectDir.dir(providers.systemProperty(&quot;someDestination&quot;)) // <b class="conum">(1)</b>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">someTask</span><span class="delimiter">'</span></span>, MyCopyTask) {
    <span class="keyword">def</span> projectDir = layout.projectDirectory
    source = projectDir.dir(<span class="string"><span class="delimiter">'</span><span class="content">source</span><span class="delimiter">'</span></span>)
    destination = projectDir.dir(providers.systemProperty(<span class="string"><span class="delimiter">'</span><span class="content">someDestination</span><span class="delimiter">'</span></span>)) // <b class="conum">(1)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We wired the system property provider directly, without reading it at configuration time.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With this simple change in place we can run the task any number of times, change the system property value, and reuse the configuration cache:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle --configuration-cache someTask -DsomeDestination=dest
Calculating task graph as no cached configuration is available for tasks: someTask
&gt; Task :someTask

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed
Configuration cache entry stored.
❯ gradle --configuration-cache someTask -DsomeDestination=another
Reusing configuration cache.
&gt; Task :someTask

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed
Configuration cache entry reused.</pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re now done with fixing the problems with this simple task.</p>
</div>
<div class="paragraph">
<p>Keep reading to learn how to adopt the configuration cache for your build or your plugins.</p>
</div>
<div class="sect4">
<h5 id="config_cache:task_opt_out"><a class="anchor" href="#config_cache:task_opt_out"></a><a class="link" href="#config_cache:task_opt_out">Declare a task incompatible with the configuration cache</a></h5>
<div class="paragraph">
<p>It is possible to declare that a particular task is not compatible with the configuration cache
via the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Task.html#notCompatibleWithConfigurationCache-java.lang.String-">Task.notCompatibleWithConfigurationCache()</a> method.</p>
</div>
<div class="paragraph">
<p>Configuration cache problems found in tasks marked incompatible will no longer cause the build to fail.</p>
</div>
<div class="paragraph">
<p>And, when an incompatible task is scheduled to run, Gradle discards the configuration state at the end of the build. You can use this to help with migration, by temporarily opting out certain tasks that are difficult to change to work with the configuration cache.</p>
</div>
<div class="paragraph">
<p>Check the method documentation for more details.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="config_cache:adoption"><a class="anchor" href="#config_cache:adoption"></a><a class="link" href="#config_cache:adoption">Adoption steps</a></h4>
<div class="paragraph">
<p>An important prerequisite is to keep your Gradle and plugins versions up to date.
The following explores the recommended steps for a successful adoption.
It applies both to builds and plugins.
While going through these steps, keep in mind the HTML report and the solutions explained in the <a href="#config_cache:requirements">requirements</a> chapter below.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Start with <code>:help</code></dt>
<dd>
<p>Always start by trying your build or plugin with the simplest task <code>:help</code>.
This will exercise the minimal configuration phase of your build or plugin.</p>
</dd>
<dt class="hdlist1">Progressively target useful tasks</dt>
<dd>
<p>Don&#8217;t go with running <code>build</code> right away.
You can also use <code>--dry-run</code> to discover more configuration time problems first.</p>
<div class="paragraph">
<p>When working on a build, progressively target your development feedback loop.
For example, running tests after making some changes to the source code.</p>
</div>
<div class="paragraph">
<p>When working on a plugin, progressively target the contributed or configured tasks.</p>
</div>
</dd>
<dt class="hdlist1">Explore by turning problems into warnings</dt>
<dd>
<p>Don&#8217;t stop at the first build failure and <a href="#config_cache:usage:ignore_problems">turn problems into warnings</a> to discover how your build and plugins behave.
If a build fails, use the HTML report to reason about the reported problems related to the failure.
Continue running more useful tasks.</p>
<div class="paragraph">
<p>This will give you a good overview of the nature of the problems your build and plugins are facing.
Remember that when turning problems into warnings you might need to <a href="#config_cache:usage:invalidate">manually invalidate the cache</a> in case of troubles.</p>
</div>
</dd>
<dt class="hdlist1">Step back and fix problems iteratively</dt>
<dd>
<p>When you feel you know enough about what needs to be fixed, take a step back and start iteratively fixing the most important problems.
Use the HTML report and this documentation to help you in this journey.</p>
<div class="paragraph">
<p>Start with problems reported when <em>storing</em> the configuration cache.
Once fixed, you can rely on a valid cached configuration phase and move on to fixing problems reported when <em>loading</em> the configuration cache if any.</p>
</div>
</dd>
<dt class="hdlist1">Report encountered issues</dt>
<dd>
<p>If you face a problem with a <a href="#config_cache:not_yet_implemented">Gradle feature</a> or with a <a href="#config_cache:plugins:core">Gradle core plugin</a> that is not covered by this documentation, please report an issue on <a href="https://github.com/gradle/gradle/issues/new/choose"><code>gradle/gradle</code></a>.</p>
<div class="paragraph">
<p>If you face a problem with a community Gradle plugin, see if it is already listed at <a href="https://github.com/gradle/gradle/issues/13490">gradle/gradle#13490</a> and consider reporting the issue to the plugin&#8217;s issue tracker.</p>
</div>
<div class="paragraph">
<p>A good way to report such issues is by providing information such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a link to this very documentation,</p>
</li>
<li>
<p>the plugin version you tried,</p>
</li>
<li>
<p>the custom configuration of the plugin if any, or ideally a reproducer build,</p>
</li>
<li>
<p>a description of what fails, for example problems with a given task</p>
</li>
<li>
<p>a copy of the build failure,</p>
</li>
<li>
<p>the self-contained <code>configuration-cache-report.html</code> file.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Test, test, test</dt>
<dd>
<p>Consider adding tests for your build logic.
See the below section on <a href="#config_cache:testing">testing your build logic</a> for the configuration cache.
This will help you while iterating on the required changes and prevent future regressions.</p>
</dd>
<dt class="hdlist1">Roll it out to your team</dt>
<dd>
<p>Once you have your developer workflow working, for example running tests from the IDE, you can consider enabling it for your team.
A faster turnaround when changing code and running tests could be worth it.
You&#8217;ll probably want to do this as an opt-in first.</p>
<div class="paragraph">
<p>If needed, turn problems into warnings and set the maximum number of allowed problems in your build <code>gradle.properties</code> file.
Keep the configuration cache disabled by default.
Let your team know they can opt-in by, for example, enabling the configuration cache on their IDE run configurations for the supported workflow.</p>
</div>
<div class="paragraph">
<p>Later on, when more workflows are working, you can flip this around.
Enable the configuration cache by default, configure CI to disable it, and if required communicate the unsupported workflow(s) for which the configuration cache needs to be disabled.</p>
</div>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="config_cache:adoption:reacting"><a class="anchor" href="#config_cache:adoption:reacting"></a><a class="link" href="#config_cache:adoption:reacting">Reacting to the configuration cache in the build</a></h5>
<div class="paragraph">
<p>Build logic or plugin implementations can detect if the configuration cache is enabled for a given build, and react to it accordingly.
The <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/configuration/BuildFeature.html#getActive--">active</a> status of the configuration cache is provided in the corresponding <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/configuration/BuildFeatures.html#getConfigurationCache--">build feature</a>.
You can access it by <a href="service_injection.html#service_injection">injecting</a> the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/configuration/BuildFeatures.html"><code>BuildFeatures</code></a> service into your code.</p>
</div>
<div class="paragraph">
<p>You can use this information to configure features of your plugin differently or to disable an optional feature that is not yet compatible.
Another example involves providing additional guidance for your users, should they need to adjust their setup or be informed of temporary limitations.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:adoption:changes_in_behavior"><a class="anchor" href="#config_cache:adoption:changes_in_behavior"></a><a class="link" href="#config_cache:adoption:changes_in_behavior">Adopting changes in the configuration cache behavior</a></h5>
<div class="paragraph">
<p>Gradle releases bring enhancements to the configuration cache, making it detect more cases of configuration logic interacting with the environment.
Those changes improve the correctness of the cache by eliminating potential false cache hits.
On the other hand, they impose stricter rules that plugins and build logic need to follow to be cached as often as possible.</p>
</div>
<div class="paragraph">
<p>Some of those configuration inputs may be considered "benign" if their results do not affect the configured tasks.
Having new configuration misses because of them may be undesirable for the build users, and the suggested strategy for eliminating them is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identify the configuration inputs causing the invalidation of the configuration cache with the help of the <a href="#config_cache:troubleshooting">configuration cache report</a>.</p>
<div class="ulist">
<ul>
<li>
<p>Fix undeclared configuration inputs accessed by the build logic of the project.</p>
</li>
<li>
<p>Report issues caused by third-party plugins to the plugin maintainers, and update the plugins once they get fixed.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For some kinds of configuration inputs, it is possible to use the opt-out options that make Gradle fall back to the earlier behavior, omitting the inputs from detection.
This temporary workaround is aimed to mitigate performance issues coming from out-of-date plugins.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is possible to temporarily opt out of configuration input detection in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Since Gradle 8.1, using many APIs related to the file system is correctly tracked as configuration inputs, including the file system checks, such as <code>File.exists()</code> or <code>File.isFile()</code>.</p>
<div class="paragraph">
<p>For the input tracking to ignore these file system checks on the specific paths, the Gradle property <code>org.gradle.configuration-cache.inputs.unsafe.ignore.file-system-checks</code>, with the list of the paths, relative to the root project directory and separated by <code>;</code>, can be used.
To ignore multiple paths, use <code>*</code> to match arbitrary strings within one segment, or <code>**</code> across segments.
Paths starting with <code>~/</code> are based on the user home directory.
For example:</p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.configuration-cache.inputs.unsafe.ignore.file-system-checks=\
    ~/.third-party-plugin/*.lock;\
    ../../externalOutputDirectory/**;\
    build/analytics.json</code></pre>
</div>
</div>
</li>
<li>
<p>Before Gradle 8.4, some undeclared configuration inputs that were never used in the configuration logic could still be read when the task graph was serialized by the configuration cache.
However, their changes would not invalidate the configuration cache afterward.
Starting with Gradle 8.4, such undeclared configuration inputs are correctly tracked.</p>
<div class="paragraph">
<p>To temporarily revert to the earlier behavior, set the Gradle property <code>org.gradle.configuration-cache.inputs.unsafe.ignore.in-serialization</code> to <code>true</code>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ignore configuration inputs sparingly, and only if they do not affect the tasks produced by the configuration logic.
The support for these options will be removed in future releases.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="config_cache:testing"><a class="anchor" href="#config_cache:testing"></a><a class="link" href="#config_cache:testing">Testing your build logic</a></h4>
<div class="paragraph">
<p>The Gradle TestKit (a.k.a. just TestKit) is a library that aids in testing Gradle plugins and build logic generally.
For general guidance on how to use TestKit, see the <a href="#test_kit">dedicated chapter</a>.</p>
</div>
<div class="paragraph">
<p>To enable configuration caching in your tests, you can pass the <code>--configuration-cache</code> argument to <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/testkit/runner/GradleRunner.html">GradleRunner</a> or use one of the other methods described in <a href="#config_cache:usage:enable">Enabling the configuration cache</a>.</p>
</div>
<div class="paragraph">
<p>You need to run your tasks twice.
Once to prime the configuration cache.
Once to reuse the configuration cache.</p>
</div>
<div id="ex-testing-the-configuration-cache" class="exampleblock">
<div class="title">Example 343. <a href="#ex-testing-the-configuration-cache">Testing the configuration cache</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">src/test/kotlin/org/example/BuildLogicFunctionalTest.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@Test
fun `my task can be loaded from the configuration cache`() {

    buildFile.writeText(&quot;&quot;&quot;
        plugins {
            id 'org.example.my-plugin'
        }
    &quot;&quot;&quot;)

    runner()
        .withArguments(&quot;--configuration-cache&quot;, &quot;myTask&quot;)        // <b class="conum">(1)</b>
        .build()

    val result = runner()
        .withArguments(&quot;--configuration-cache&quot;, &quot;myTask&quot;)        // <b class="conum">(2)</b>
        .build()

    require(result.output.contains(&quot;Reusing configuration cache.&quot;)) // <b class="conum">(3)</b>
    // ... more assertions on your task behavior
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">src/test/groovy/org/example/BuildLogicFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">my task can be loaded from the configuration cache</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>:
    buildFile &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
        plugins {
            id 'org.example.my-plugin'
        }
    </span><span class="delimiter">&quot;&quot;&quot;</span></span>

    <span class="key">when</span>:
    runner()
        .withArguments(<span class="string"><span class="delimiter">'</span><span class="content">--configuration-cache</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">myTask</span><span class="delimiter">'</span></span>)    // <b class="conum">(1)</b>
        .build()

    <span class="key">and</span>:
    <span class="keyword">def</span> result = runner()
        .withArguments(<span class="string"><span class="delimiter">'</span><span class="content">--configuration-cache</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">myTask</span><span class="delimiter">'</span></span>)    // <b class="conum">(2)</b>
        .build()

    <span class="key">then</span>:
    result.output.contains(<span class="string"><span class="delimiter">'</span><span class="content">Reusing configuration cache.</span><span class="delimiter">'</span></span>)      // <b class="conum">(3)</b>
    <span class="comment">// ... more assertions on your task behavior</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>First run primes the configuration cache.</p>
</li>
<li>
<p>Second run reuses the configuration cache.</p>
</li>
<li>
<p>Assert that the configuration cache gets reused.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If problems with the configuration cache are found then Gradle will fail the build reporting the problems, and the test will fail.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>A good testing strategy for a Gradle plugin is to run its whole test suite with the configuration cache enabled.
This requires testing the plugin with a supported Gradle version.</p>
</div>
<div class="paragraph">
<p>If the plugin already supports a range of Gradle versions it might already have tests for multiple Gradle versions.
In that case we recommend enabling the configuration cache starting with the Gradle version that supports it.</p>
</div>
<div class="paragraph">
<p>If this can’t be done right away, using tests that run all tasks contributed by the plugin several times, for e.g. asserting the <code>UP_TO_DATE</code> and <code>FROM_CACHE</code> behavior, is also a good strategy.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="config_cache:requirements"><a class="anchor" href="#config_cache:requirements"></a><a class="link" href="#config_cache:requirements">Requirements</a></h4>
<div class="paragraph">
<p>In order to capture the state of the task graph to the configuration cache and reload it again in a later build, Gradle applies certain requirements to tasks and other build logic.
Each of these requirements is treated as a configuration cache "problem" and fails the build if violations are present.</p>
</div>
<div class="paragraph">
<p>For the most part these requirements are actually surfacing some undeclared inputs.
In other words, using the configuration cache is an opt-in to more strictness, correctness and reliability for all builds.</p>
</div>
<div class="paragraph">
<p>The following sections describe each of the requirements and how to change your build to fix the problems.</p>
</div>
<div class="sect4">
<h5 id="config_cache:requirements:disallowed_types"><a class="anchor" href="#config_cache:requirements:disallowed_types"></a><a class="link" href="#config_cache:requirements:disallowed_types">Certain types must not be referenced by tasks</a></h5>
<div class="paragraph">
<p>There are a number of types that task instances must not reference from their fields.
The same applies to task actions as closures such as <code>doFirst {}</code> or <code>doLast {}</code>.</p>
</div>
<div class="paragraph">
<p>These types fall into some categories as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Live JVM state types</p>
</li>
<li>
<p>Gradle model types</p>
</li>
<li>
<p>Dependency management types</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all cases the reason these types are disallowed is that their state cannot easily be stored or recreated by the configuration cache.</p>
</div>
<div class="paragraph">
<p>Live JVM state types (e.g. <code>ClassLoader</code>, <code>Thread</code>, <code>OutputStream</code>, <code>Socket</code> etc&#8230;&#8203;) are simply disallowed.
These types almost never represent a task input or output.
The only exceptions are the standard streams: <code>System.in</code>, <code>System.out</code>, and <code>System.err</code>.
These streams can be used, for example, as parameters to <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.Exec.html"><code>Exec</code></a> and <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.JavaExec.html"><code>JavaExec</code></a> tasks.</p>
</div>
<div class="paragraph">
<p>Gradle model types (e.g. <code>Gradle</code>, <code>Settings</code>, <code>Project</code>, <code>SourceSet</code>, <code>Configuration</code> etc&#8230;&#8203;) are usually used to carry some task input that should be explicitly and precisely declared instead.</p>
</div>
<div class="paragraph">
<p>For example, if you reference a <code>Project</code> in order to get the <code>project.version</code> at execution time, you should instead directly declare the <em>project version</em> as an input to your task using a <code>Property&lt;String&gt;</code>.
Another example would be to reference a <code>SourceSet</code> to later get the source files, the compilation classpath or the outputs of the source set.
You should instead declare these as a <code>FileCollection</code> input and reference just that.</p>
</div>
<div class="paragraph">
<p>The same requirement applies to dependency management types with some nuances.</p>
</div>
<div class="paragraph">
<p>Some types, such as <code>Configuration</code> or <code>SourceDirectorySet</code>, don&#8217;t make good task input parameters, as they hold a lot of irrelevant state, and it is better to model these inputs as something more precise.
We don&#8217;t intend to make these types serializable at all.
For example, if you reference a <code>Configuration</code> to later get the resolved files, you should instead declare a <code>FileCollection</code> as an input to your task.
In the same vein, if you reference a <code>SourceDirectorySet</code> you should instead declare a <code>FileTree</code> as an input to your task.</p>
</div>
<div class="paragraph">
<p>Referencing dependency resolution results is also disallowed (e.g. <code>ArtifactResolutionQuery</code>, <code>ResolvedArtifact</code>, <code>ArtifactResult</code> etc&#8230;&#8203;).
For example, if you reference some <code>ResolvedComponentResult</code> instances, you should instead declare a <code>Provider&lt;ResolvedComponentResult&gt;</code> as an input to your task.
Such a provider can be obtained by invoking <code>ResolutionResult.getRootComponent()</code>.
In the same vein, if you reference some <code>ResolvedArtifactResult</code> instances, you should instead use <code>ArtifactCollection.getResolvedArtifacts()</code> that returns a <code>Provider&lt;Set&lt;ResolvedArtifactResult&gt;&gt;</code> that can be mapped as an input to your task.
The rule of thumb is that tasks must not reference <em>resolved</em> results, but lazy specifications instead, in order to do the dependency resolution at execution time.</p>
</div>
<div class="paragraph">
<p>Some types, such as <code>Publication</code> or <code>Dependency</code> are not serializable, but could be.
We may, if necessary, allow these to be used as task inputs directly.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of a problematic task type referencing a <code>SourceSet</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class SomeTask : DefaultTask() {

    @get:Input lateinit var sourceSet: SourceSet // <b class="conum">(1)</b>

    @TaskAction
    fun action() {
        val classpathFiles = sourceSet.compileClasspath.files
        // ...
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">SomeTask</span> <span class="directive">extends</span> DefaultTask {

    <span class="annotation">@Input</span> SourceSet sourceSet // <b class="conum">(1)</b>

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> action() {
        <span class="keyword">def</span> classpathFiles = sourceSet.compileClasspath.files
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>this will be reported as a problem because referencing <code>SourceSet</code> is not allowed</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following is how it should be done instead:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class SomeTask : DefaultTask() {

    @get:InputFiles @get:Classpath
    abstract val classpath: ConfigurableFileCollection // <b class="conum">(1)</b>

    @TaskAction
    fun action() {
        val classpathFiles = classpath.files
        // ...
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">SomeTask</span> <span class="directive">extends</span> DefaultTask {

    <span class="annotation">@InputFiles</span> <span class="annotation">@Classpath</span>
    <span class="directive">abstract</span> ConfigurableFileCollection getClasspath() // <b class="conum">(1)</b>

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> action() {
        <span class="keyword">def</span> classpathFiles = classpath.files
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>no more problems reported, we now reference the supported type <code>FileCollection</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the same vein, if you encounter the same problem with an ad-hoc task declared in a script as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;someTask&quot;) {
    doLast {
        val classpathFiles = sourceSets.main.get().compileClasspath.files // <b class="conum">(1)</b>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">someTask</span><span class="delimiter">'</span></span>) {
    doLast {
        <span class="keyword">def</span> classpathFiles = sourceSets.main.compileClasspath.files // <b class="conum">(1)</b>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>this will be reported as a problem because the <code>doLast {}</code> closure is capturing a reference to the <code>SourceSet</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You still need to fulfil the same requirement, that is not referencing a disallowed type.
Here&#8217;s how the task declaration above can be fixed:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;someTask&quot;) {
    val classpath = sourceSets.main.get().compileClasspath // <b class="conum">(1)</b>
    doLast {
        val classpathFiles = classpath.files
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">someTask</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> classpath = sourceSets.main.compileClasspath // <b class="conum">(1)</b>
    doLast {
        <span class="keyword">def</span> classpathFiles = classpath.files
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>no more problems reported, the <code>doLast {}</code> closure now only captures <code>classpath</code> which is of the supported <code>FileCollection</code> type</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that sometimes the disallowed type is indirectly referenced.
For example, you could have a task reference some type from a plugin that is allowed.
That type could reference another allowed type that in turn references a disallowed type.
The hierarchical view of the object graph provided in the HTML reports for problems should help you pinpoint the offender.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:requirements:use_project_during_execution"><a class="anchor" href="#config_cache:requirements:use_project_during_execution"></a><a class="link" href="#config_cache:requirements:use_project_during_execution">Using the <code>Project</code> object</a></h5>
<div class="paragraph">
<p>A task must not use any <code>Project</code> objects at execution time.
This includes calling <code>Task.getProject()</code> while the task is running.</p>
</div>
<div class="paragraph">
<p>Some cases can be fixed in the same way as for <a href="#config_cache:requirements:disallowed_types">disallowed types</a>.</p>
</div>
<div class="paragraph">
<p>Often, similar things are available on both <code>Project</code> and <code>Task</code>.
For example if you need a <code>Logger</code> in your task actions you should use <code>Task.logger</code> instead of <code>Project.logger</code>.</p>
</div>
<div class="paragraph">
<p>Otherwise, you can use <a href="service_injection.html#service_injection">injected services</a> instead of the methods of <code>Project</code>.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of a problematic task type using the <code>Project</code> object at execution time:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class SomeTask : DefaultTask() {
    @TaskAction
    fun action() {
        project.copy { // <b class="conum">(1)</b>
            from(&quot;source&quot;)
            into(&quot;destination&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">SomeTask</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> action() {
        project.copy { // <b class="conum">(1)</b>
            from <span class="string"><span class="delimiter">'</span><span class="content">source</span><span class="delimiter">'</span></span>
            into <span class="string"><span class="delimiter">'</span><span class="content">destination</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>this will be reported as a problem because the task action is using the <code>Project</code> object at execution time</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following is how it should be done instead:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class SomeTask : DefaultTask() {

    @get:Inject abstract val fs: FileSystemOperations // <b class="conum">(1)</b>

    @TaskAction
    fun action() {
        fs.copy {
            from(&quot;source&quot;)
            into(&quot;destination&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">SomeTask</span> <span class="directive">extends</span> DefaultTask {

    <span class="annotation">@Inject</span> <span class="directive">abstract</span> FileSystemOperations getFs() // <b class="conum">(1)</b>

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> action() {
        fs.copy {
            from <span class="string"><span class="delimiter">'</span><span class="content">source</span><span class="delimiter">'</span></span>
            into <span class="string"><span class="delimiter">'</span><span class="content">destination</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>no more problem reported, the injected <code>FileSystemOperations</code> service is supported as a replacement for <code>project.copy {}</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the same vein, if you encounter the same problem with an ad-hoc task declared in a script as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;someTask&quot;) {
    doLast {
        project.copy { // <b class="conum">(1)</b>
            from(&quot;source&quot;)
            into(&quot;destination&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">someTask</span><span class="delimiter">'</span></span>) {
    doLast {
        project.copy { // <b class="conum">(1)</b>
            from <span class="string"><span class="delimiter">'</span><span class="content">source</span><span class="delimiter">'</span></span>
            into <span class="string"><span class="delimiter">'</span><span class="content">destination</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>this will be reported as a problem because the task action is using the <code>Project</code> object at execution time</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here&#8217;s how the task declaration above can be fixed:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">interface Injected {
    @get:Inject val fs: FileSystemOperations // <b class="conum">(1)</b>
}
tasks.register(&quot;someTask&quot;) {
    val injected = project.objects.newInstance&lt;Injected&gt;() // <b class="conum">(2)</b>
    doLast {
        injected.fs.copy { // <b class="conum">(3)</b>
            from(&quot;source&quot;)
            into(&quot;destination&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">interface</span> Injected {
    <span class="annotation">@Inject</span> FileSystemOperations getFs() // <b class="conum">(1)</b>
}
tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">someTask</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> injected = project.objects.newInstance(Injected) // <b class="conum">(2)</b>
    doLast {
        injected.fs.copy { // <b class="conum">(3)</b>
            from <span class="string"><span class="delimiter">'</span><span class="content">source</span><span class="delimiter">'</span></span>
            into <span class="string"><span class="delimiter">'</span><span class="content">destination</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>services can&#8217;t be injected directly in scripts, we need an extra type to convey the injection point</p>
</li>
<li>
<p>create an instance of the extra type using <code>project.object</code> outside the task action</p>
</li>
<li>
<p>no more problem reported, the task action references <code>injected</code> that provides the <code>FileSystemOperations</code> service, supported as a replacement for <code>project.copy {}</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As you can see above, fixing ad-hoc tasks declared in scripts requires quite a bit of ceremony.
It is a good time to think about extracting your task declaration as a proper task class as shown previously.</p>
</div>
<div class="paragraph">
<p>The following table shows what APIs or injected service should be used as a replacement for each of the <code>Project</code> methods.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instead of:</th>
<th class="tableblock halign-left valign-top">Use:</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.rootDir</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A task input or output property or a script variable to capture the result of using <code>project.rootDir</code> to calculate the actual parameter.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.projectDir</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A task input or output property or a script variable to capture the result of using <code>project.projectDir</code> to calculate the actual parameter.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.buildDir</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A task input or output property or a script variable to capture the result of using <code>project.buildDir</code> to calculate the actual parameter.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.name</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A task input or output property or a script variable to capture the result of using <code>project.name</code> to calculate the actual parameter.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.description</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A task input or output property or a script variable to capture the result of using <code>project.description</code> to calculate the actual parameter.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.group</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A task input or output property or a script variable to capture the result of using <code>project.group</code> to calculate the actual parameter.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.version</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A task input or output property or a script variable to capture the result of using <code>project.version</code> to calculate the actual parameter.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.properties</code>, <code>project.property(name)</code>, <code>project.hasProperty(name)</code>, <code>project.getProperty(name)</code> or <code>project.findProperty(name)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.provider.ProviderFactory.html#org.gradle.api.provider.ProviderFactory:gradleProperty(java.lang.String)">Value providers for Gradle properties</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.logger</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Task.html#getLogger--">Task.logger</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.provider {}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.provider.ProviderFactory.html#org.gradle.api.provider.ProviderFactory:provider(java.util.concurrent.Callable)">ProviderFactory.provider {}</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.file(path)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A task input or output property or a script variable to capture the result of using <code>project.file(file)</code> to calculate the actual parameter.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.uri(path)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A task input or output property or a script variable to capture the result of using <code>project.uri(path)</code> to calculate the actual parameter. Otherwise, <code>File.toURI()</code> or some other JVM API can be used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.relativePath(path)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ProjectLayout.html#getProjectDirectory--">ProjectLayout.projectDirectory</a>.<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/Directory.html#file-java.lang.String-">file(path)</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.files(paths)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#fileCollection--">ObjectFactory.fileCollection()</a>.<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ConfigurableFileCollection.html#from-java.lang.Object&#8230;&#8203;-">from(paths)</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.fileTree(paths)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/model/ObjectFactory.html#fileTree--">ObjectFactory.fileTree()</a>.<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ConfigurableFileTree.html#from-java.lang.Object-">from(dir)</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.zipTree(path)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ArchiveOperations.html#zipTree-java.lang.Object-">ArchiveOperations.zipTree(path)</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.tarTree(path)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/ArchiveOperations.html#tarTree-java.lang.Object-">ArchiveOperations.tarTree(path)</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.resources</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A task input or output property or a script variable to capture the result of using <code>project.resource</code> to calculate the actual parameter.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.copySpec {}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileSystemOperations.html#copySpec--">FileSystemOperations.copySpec {}</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.copy {}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileSystemOperations.html#copy-org.gradle.api.Action-">FileSystemOperations.copy {}</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.sync {}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileSystemOperations.html#sync-org.gradle.api.Action-">FileSystemOperations.sync {}</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.delete {}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/FileSystemOperations.html#delete-org.gradle.api.Action-">FileSystemOperations.delete {}</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.mkdir(path)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Kotlin, Groovy or Java API available to your build logic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.exec {}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/process/ExecOperations.html#exec-org.gradle.api.Action-">ExecOperations.exec {}</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.javaexec {}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/process/ExecOperations.html#javaexec-org.gradle.api.Action-">ExecOperations.javaexec {}</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.ant {}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Task.html#getAnt--">Task.ant</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>project.createAntBuilder()</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Task.html#getAnt--">Task.ant</a></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="config_cache:requirements:task_access"><a class="anchor" href="#config_cache:requirements:task_access"></a><a class="link" href="#config_cache:requirements:task_access">Accessing a task instance from another instance</a></h5>
<div class="paragraph">
<p>Tasks should not directly access the state of another task instance.
Instead, tasks should be connected using <a href="#working_with_task_dependencies_in_lazy_properties">inputs and outputs relationships</a>.</p>
</div>
<div class="paragraph">
<p>Note that this requirement makes it unsupported to write tasks that configure other tasks at execution time.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:requirements:shared_objects"><a class="anchor" href="#config_cache:requirements:shared_objects"></a><a class="link" href="#config_cache:requirements:shared_objects">Sharing mutable objects</a></h5>
<div class="paragraph">
<p>When storing a task to the configuration cache, all objects directly or indirectly referenced through the task&#8217;s fields are serialized.
In most cases, deserialization preserves reference equality: if two fields <code>a</code> and <code>b</code> reference the same instance at configuration time, then upon deserialization they will reference the same instance again, so <code>a == b</code> (or <code>a === b</code> in Groovy and Kotlin syntax) still holds.
However, for performance reasons, some classes, in particular <code>java.lang.String</code>, <code>java.io.File</code>, and many implementations of <code>java.util.Collection</code> interface, are serialized without preserving the reference equality.
Upon deserialization, fields that referred to the object of such a class can refer to different but equal objects.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a task that stores a user-defined object and an <code>ArrayList</code> in task fields.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">class StateObject {
    // ...
}

abstract class StatefulTask : DefaultTask() {
    @get:Internal
    var stateObject: StateObject? = null

    @get:Internal
    var strings: List&lt;String&gt;? = null
}


tasks.register&lt;StatefulTask&gt;(&quot;checkEquality&quot;) {
    val objectValue = StateObject()
    val stringsValue = arrayListOf(&quot;a&quot;, &quot;b&quot;)

    stateObject = objectValue
    strings = stringsValue

    doLast { // <b class="conum">(1)</b>
        println(&quot;POJO reference equality: ${stateObject === objectValue}&quot;) // <b class="conum">(2)</b>
        println(&quot;Collection reference equality: ${strings === stringsValue}&quot;) // <b class="conum">(3)</b>
        println(&quot;Collection equality: ${strings == stringsValue}&quot;) // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">StateObject</span> {
    <span class="comment">// ...</span>
}

<span class="directive">abstract</span> <span class="type">class</span> <span class="class">StatefulTask</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@Internal</span>
    StateObject stateObject

    <span class="annotation">@Internal</span>
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; strings
}


tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">checkEquality</span><span class="delimiter">&quot;</span></span>, StatefulTask) {
    <span class="keyword">def</span> objectValue = <span class="keyword">new</span> StateObject()
    <span class="keyword">def</span> stringsValue = [<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>] <span class="keyword">as</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;

    stateObject = objectValue
    strings = stringsValue

    doLast { // <b class="conum">(1)</b>
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">POJO reference equality: </span><span class="inline"><span class="inline-delimiter">${</span>stateObject === objectValue<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>) // <b class="conum">(2)</b>
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Collection reference equality: </span><span class="inline"><span class="inline-delimiter">${</span>strings === stringsValue<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>) // <b class="conum">(3)</b>
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Collection equality: </span><span class="inline"><span class="inline-delimiter">${</span>strings == stringsValue<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>) // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>doLast</code> action captures the references from the enclosing scope. These captured references are also serialized to the configuration cache.</p>
</li>
<li>
<p>Compare the reference to an object of user-defined class stored in the task field and the reference captured in the <code>doLast</code> action.</p>
</li>
<li>
<p>Compare the reference to <code>ArrayList</code> instance stored in the task field and the reference captured in the <code>doLast</code> action.</p>
</li>
<li>
<p>Check the equality of stored and captured lists.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Running the build without the configuration cache shows that reference equality is preserved in both cases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle --no-configuration-cache checkEquality
&gt; Task :checkEquality
POJO reference equality: true
Collection reference equality: true
Collection equality: true</pre>
</div>
</div>
<div class="paragraph">
<p>However, with the configuration cache enabled, only the user-defined object references are the same.
List references are different, though the referenced lists are equal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❯ gradle --configuration-cache checkEquality
&gt; Task :checkEquality
POJO reference equality: true
Collection reference equality: false
Collection equality: true</pre>
</div>
</div>
<div class="paragraph">
<p>In general, it isn&#8217;t recommended to share mutable objects between configuration and execution phases.
If you need to do this, you should always wrap the state in a class you define.
There is no guarantee that the reference equality is preserved for standard Java, Groovy, and Kotlin types, or for Gradle-defined types.</p>
</div>
<div class="paragraph">
<p>Note that no reference equality is preserved between tasks: each task is its own "realm", so it is not possible to share objects between tasks.
Instead, you can use a <a href="#build_services">build service</a> to wrap the shared state.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:requirements:task_extensions"><a class="anchor" href="#config_cache:requirements:task_extensions"></a><a class="link" href="#config_cache:requirements:task_extensions">Accessing task extensions or conventions</a></h5>
<div class="paragraph">
<p>Tasks should not access conventions and extensions, including extra properties, at execution time.
Instead, any value that&#8217;s relevant for the execution of the task should be modeled as a task property.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:requirements:build_listeners"><a class="anchor" href="#config_cache:requirements:build_listeners"></a><a class="link" href="#config_cache:requirements:build_listeners">Using build listeners</a></h5>
<div class="paragraph">
<p>Plugins and build scripts must not register any build listeners.
That is listeners registered at configuration time that get notified at execution time.
For example a <code>BuildListener</code> or a <code>TaskExecutionListener</code>.</p>
</div>
<div class="paragraph">
<p>These should be replaced by <a href="#build_services">build services</a>, registered to receive information about <a href="#operation_listener">task execution</a> if needed.
Use <a href="#dataflow_action">dataflow actions</a> to handle the build result instead of <code>buildFinished</code> listeners.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:requirements:external_processes"><a class="anchor" href="#config_cache:requirements:external_processes"></a><a class="link" href="#config_cache:requirements:external_processes">Running external processes</a></h5>
<div class="paragraph">
<p>Plugin and build scripts should avoid running external processes at configuration time.
In general, it is preferred to run external processes in tasks with properly declared inputs and outputs to avoid unnecessary work when the task is up-to-date.
If necessary, only configuration-cache-compatible APIs should be used instead of Java and Groovy standard APIs or existing <code>ExecOperations</code>,
<code>Project.exec</code>, <code>Project.javaexec</code>, and their likes in settings and init scripts.
For simpler cases, when grabbing the output of the process is enough,
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.provider.ProviderFactory.html#org.gradle.api.provider.ProviderFactory:exec(org.gradle.api.Action)">providers.exec()</a> and
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.provider.ProviderFactory.html#org.gradle.api.provider.ProviderFactory:javaexec(org.gradle.api.Action)">providers.javaexec()</a> can be used:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val gitVersion = providers.exec {
    commandLine(&quot;git&quot;, &quot;--version&quot;)
}.standardOutput.asText.get()</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> gitVersion = providers.exec {
    commandLine(<span class="string"><span class="delimiter">&quot;</span><span class="content">git</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">--version</span><span class="delimiter">&quot;</span></span>)
}.standardOutput.asText.get()</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more complex cases a custom <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/ValueSource.html">ValueSource</a> implementation with injected <code>ExecOperations</code> can be used.
This <code>ExecOperations</code> instance can be used at configuration time without restrictions.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class GitVersionValueSource : ValueSource&lt;String, ValueSourceParameters.None&gt; {
    @get:Inject
    abstract val execOperations: ExecOperations

    override fun obtain(): String {
        val output = ByteArrayOutputStream()
        execOperations.exec {
            commandLine(&quot;git&quot;, &quot;--version&quot;)
            standardOutput = output
        }
        return String(output.toByteArray(), Charset.defaultCharset())
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">GitVersionValueSource</span> <span class="directive">implements</span> ValueSource&lt;<span class="predefined-type">String</span>, ValueSourceParameters.None&gt; {
    <span class="annotation">@Inject</span>
    <span class="directive">abstract</span> ExecOperations getExecOperations()

    <span class="predefined-type">String</span> obtain() {
        <span class="predefined-type">ByteArrayOutputStream</span> output = <span class="keyword">new</span> <span class="predefined-type">ByteArrayOutputStream</span>()
        execOperations.exec {
            <span class="local-variable">it</span>.commandLine <span class="string"><span class="delimiter">&quot;</span><span class="content">git</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">--version</span><span class="delimiter">&quot;</span></span>
            <span class="local-variable">it</span>.standardOutput = output
        }
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">String</span>(output.toByteArray(), <span class="predefined-type">Charset</span>.defaultCharset())
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>ValueSource</code> implementation can then be used to create a provider with <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.provider.ProviderFactory.html#org.gradle.api.provider.ProviderFactory:of(java.lang.Class,%20org.gradle.api.Action)">providers.of</a>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val gitVersionProvider = providers.of(GitVersionValueSource::class) {}
val gitVersion = gitVersionProvider.get()</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> gitVersionProvider = providers.of(GitVersionValueSource.class) {}
<span class="keyword">def</span> gitVersion = gitVersionProvider.get()</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In both approaches, if the value of the provider is used at configuration time then it will become a build configuration input.
The external process will be executed for every build to determine if the configuration cache is up-to-date, so it is recommended to only call fast-running processes at configuration time.
If the value changes then the cache is invalidated and the process will be run again during this build as part of the configuration phase.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:requirements:reading_sys_props_and_env_vars"><a class="anchor" href="#config_cache:requirements:reading_sys_props_and_env_vars"></a><a class="link" href="#config_cache:requirements:reading_sys_props_and_env_vars">Reading system properties and environment variables</a></h5>
<div class="paragraph">
<p>Plugins and build scripts may read system properties and environment variables directly at configuration time with standard Java, Groovy, or Kotlin APIs or with the value supplier APIs.
Doing so makes such variable or property a build configuration input, so changing the value invalidates the configuration cache.
The configuration cache report includes a list of these build configuration inputs to help track them.</p>
</div>
<div class="paragraph">
<p>In general, you should avoid reading the value of system properties and environment variables at configuration time, to avoid cache misses when value changes.
Instead, you can connect the <code>Provider</code> returned by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.provider.ProviderFactory.html#org.gradle.api.provider.ProviderFactory:systemProperty(java.lang.String)">providers.systemProperty()</a> or
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.provider.ProviderFactory.html#org.gradle.api.provider.ProviderFactory:environmentVariable(java.lang.String)">providers.environmentVariable()</a> to task properties.</p>
</div>
<div class="paragraph">
<p>Some access patterns that potentially enumerate all environment variables or system properties (for example, calling <code>System.getenv().forEach()</code> or using the iterator of its <code>keySet()</code>) are
discouraged.
In this case, Gradle cannot find out what properties are actual build configuration inputs, so every available property becomes one.
Even adding a new property will invalidate the cache if this pattern is used.</p>
</div>
<div class="paragraph">
<p>Using a custom predicate to filter environment variables is an example of this discouraged pattern:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val jdkLocations = System.getenv().filterKeys {
    it.startsWith(&quot;JDK_&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> jdkLocations = <span class="predefined-type">System</span>.getenv().findAll {
    key, _ -&gt; key.startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">JDK_</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The logic in the predicate is opaque to the configuration cache, so all environment variables are considered inputs.
One way to reduce the number of inputs is to always use methods that query a concrete variable name, such as <code>getenv(String)</code>, or <code>getenv().get()</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val jdkVariables = listOf(&quot;JDK_8&quot;, &quot;JDK_11&quot;, &quot;JDK_17&quot;)
val jdkLocations = jdkVariables.filter { v -&gt;
    System.getenv(v) != null
}.associate { v -&gt;
    v to System.getenv(v)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> jdkVariables = [<span class="string"><span class="delimiter">&quot;</span><span class="content">JDK_8</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">JDK_11</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">JDK_17</span><span class="delimiter">&quot;</span></span>]
<span class="keyword">def</span> jdkLocations = jdkVariables.findAll { v -&gt;
    <span class="predefined-type">System</span>.getenv(v) != <span class="predefined-constant">null</span>
}.collectEntries { v -&gt;
    [v, <span class="predefined-type">System</span>.getenv(v)]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The fixed code above, however, is not exactly equivalent to the original as only an explicit list of variables is supported.
Prefix-based filtering is a common scenario, so there are provider-based APIs to access
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.provider.ProviderFactory.html#org.gradle.api.provider.ProviderFactory:systemPropertiesPrefixedBy(java.lang.String)">system properties</a> and
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.provider.ProviderFactory.html#org.gradle.api.provider.ProviderFactory:environmentVariablesPrefixedBy(java.lang.String)">environment variables</a>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val jdkLocationsProvider = providers.environmentVariablesPrefixedBy(&quot;JDK_&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> jdkLocationsProvider = providers.environmentVariablesPrefixedBy(<span class="string"><span class="delimiter">&quot;</span><span class="content">JDK_</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that the configuration cache would be invalidated not only when the value of the variable changes or the variable is removed but also
when another variable with the matching prefix is added to the environment.</p>
</div>
<div class="paragraph">
<p>For more complex use cases a custom <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/provider/ValueSource.html">ValueSource</a> implementation can be used.
System properties and environment variables referenced in the code of the <code>ValueSource</code> do not become build configuration inputs, so any processing can be applied.
Instead, the value of the <code>ValueSource</code> is recomputed each time the build runs and only if the value changes the configuration cache is invalidated.
For example, a <code>ValueSource</code> can be used to get all environment variables with names containing the substring <code>JDK</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class EnvVarsWithSubstringValueSource : ValueSource&lt;Map&lt;String, String&gt;, EnvVarsWithSubstringValueSource.Parameters&gt; {
    interface Parameters : ValueSourceParameters {
        val substring: Property&lt;String&gt;
    }

    override fun obtain(): Map&lt;String, String&gt; {
        return System.getenv().filterKeys { key -&gt;
            key.contains(parameters.substring.get())
        }
    }
}
val jdkLocationsProvider = providers.of(EnvVarsWithSubstringValueSource::class) {
    parameters {
        substring = &quot;JDK&quot;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">EnvVarsWithSubstringValueSource</span> <span class="directive">implements</span> ValueSource&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;, Parameters&gt; {
    <span class="type">interface</span> Parameters <span class="directive">extends</span> ValueSourceParameters {
        Property&lt;<span class="predefined-type">String</span>&gt; getSubstring()
    }

    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; obtain() {
        <span class="keyword">return</span> <span class="predefined-type">System</span>.getenv().findAll { key, _ -&gt;
            key.contains(parameters.substring.get())
        }
    }
}
<span class="keyword">def</span> jdkLocationsProvider = providers.of(EnvVarsWithSubstringValueSource.class) {
    parameters {
        substring = <span class="string"><span class="delimiter">&quot;</span><span class="content">JDK</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:requirements:undeclared_file_read"><a class="anchor" href="#config_cache:requirements:undeclared_file_read"></a><a class="link" href="#config_cache:requirements:undeclared_file_read">Undeclared reading of files</a></h5>
<div class="paragraph">
<p>Plugins and build scripts should not read files directly using the Java, Groovy or Kotlin APIs at configuration time.
Instead, declare files as potential build configuration inputs using the value supplier APIs.</p>
</div>
<div class="paragraph">
<p>This problem is caused by build logic similar to this:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val config = file(&quot;some.conf&quot;).readText()</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> config = file(<span class="string"><span class="delimiter">'</span><span class="content">some.conf</span><span class="delimiter">'</span></span>).text</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To fix this problem, read files using <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.provider.ProviderFactory.html#org.gradle.api.provider.ProviderFactory:fileContents(org.gradle.api.file.RegularFile)">providers.fileContents()</a> instead:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val config = providers.fileContents(layout.projectDirectory.file(&quot;some.conf&quot;))
    .asText</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> config = providers.fileContents(layout.projectDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">some.conf</span><span class="delimiter">'</span></span>))
    .asText</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In general, you should avoid reading files at configuration time, to avoid invalidating configuration cache entries when the file content changes.
Instead, you can connect the <code>Provider</code> returned by <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.provider.ProviderFactory.html#org.gradle.api.provider.ProviderFactory:fileContents(org.gradle.api.file.RegularFile)">providers.fileContents()</a> to task properties.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:requirements:bytecode_modifications_and_isolation"><a class="anchor" href="#config_cache:requirements:bytecode_modifications_and_isolation"></a><a class="link" href="#config_cache:requirements:bytecode_modifications_and_isolation">Bytecode modifications and Java agent</a></h5>
<div class="paragraph">
<p>To detect the configuration inputs, Gradle modifies the bytecode of classes on the build script classpath, like plugins and their dependencies.
Gradle uses a Java agent to modify the bytecode.
Integrity self-checks of some libraries may fail because of the changed bytecode or the agent&#8217;s presence.</p>
</div>
<div class="paragraph">
<p>To work around this, you can use the <a href="#tasks_parallel_worker">Worker API</a> with classloader or process isolation to encapsulate the library code.
The bytecode of the worker&#8217;s classpath is not modified, so the self-checks should pass.
When process isolation is used, the worker action is executed in a separate worker process that doesn&#8217;t have the Gradle Java agent installed.</p>
</div>
<div class="paragraph">
<p>In simple cases, when the libraries also provide command-line entry points (<code>public static void main()</code> method), you can also use the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/JavaExec.html">JavaExec</a> task to isolate the library.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="config_cache:secrets"><a class="anchor" href="#config_cache:secrets"></a><a class="link" href="#config_cache:secrets">Handling of credentials and secrets</a></h4>
<div class="paragraph">
<p>The configuration cache has currently no option to prevent storing secrets that are used as inputs, and so they might end up in the serialized configuration cache entry which, by default, is stored under <code>.gradle/configuration-cache</code> in your project directory.</p>
</div>
<div class="paragraph">
<p>To mitigate the risk of accidental exposure, Gradle encrypts the configuration cache.
Gradle transparently generates a machine-specific secret key as required, caches it under the
<code><a href="#dir:gradle_user_home">GRADLE_USER_HOME</a></code> directory and uses it to encrypt the data in the project specific caches.</p>
</div>
<div class="paragraph">
<p>To enhance security further, make sure to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>secure access to configuration cache entries;</p>
</li>
<li>
<p>leverage <code><a href="#dir:gradle_user_home">GRADLE_USER_HOME</a>/gradle.properties</code> for storing secrets.
The content of that file is not part of the configuration cache, only its fingerprint.
If you store secrets in that file, care must be taken to protect access to the file content.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/gradle/gradle/issues/22618">gradle/gradle#22618</a>.</p>
</div>
<div class="sect4">
<h5 id="config_cache:secrets:configuring_encryption_key"><a class="anchor" href="#config_cache:secrets:configuring_encryption_key"></a><a class="link" href="#config_cache:secrets:configuring_encryption_key">Providing an encryption key via <code>GRADLE_ENCRYPTION_KEY</code> environment variable</a></h5>
<div class="paragraph">
<p>By default, Gradle automatically generates and manages the encryption key as a Java keystore stored under the <code><a href="#dir:gradle_user_home">GRADLE_USER_HOME</a></code> directory.</p>
</div>
<div class="paragraph">
<p>For environments where this is undesirable (for instance, when the <code><a href="#dir:gradle_user_home">GRADLE_USER_HOME</a></code> directory is shared across machines),
you may provide Gradle with the exact encryption key to use when
reading or writing the cached configuration data via the <code>GRADLE_ENCRYPTION_KEY</code> environment variable.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>You must ensure that the same encryption key is consistently provided across multiple Gradle runs,
or else Gradle will not be able to reuse existing cached configurations.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:secrets:generating_encryption_key"><a class="anchor" href="#config_cache:secrets:generating_encryption_key"></a><a class="link" href="#config_cache:secrets:generating_encryption_key">Generating an encryption key that is compatible with GRADLE_ENCRYPTION_KEY</a></h5>
<div class="paragraph">
<p>For Gradle to encrypt the configuration cache using a user-specified encryption key,
you must run Gradle while having the GRADLE_ENCRYPTION_KEY environment variable set with a valid AES key, encoded as a Base64 string.</p>
</div>
<div class="paragraph">
<p>One way of generating a Base64-encoded AES-compatible key is by using a command like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>❯ openssl rand -base64 16</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command should work on Linux, Mac OS, or on Windows, if using a tool like Cygwin.</p>
</div>
<div class="paragraph">
<p>You can then use the Base64-encoded key produced by that command and set it as the value of the
<code>GRADLE_ENCRYPTION_KEY</code> environment variable.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="config_cache:not_yet_implemented"><a class="anchor" href="#config_cache:not_yet_implemented"></a><a class="link" href="#config_cache:not_yet_implemented">Not yet implemented</a></h4>
<div class="paragraph">
<p>Support for using configuration caching with certain Gradle features is not yet implemented.
Support for these features will be added in later Gradle releases.</p>
</div>
<div class="sect4">
<h5 id="config_cache:not_yet_implemented:sharing"><a class="anchor" href="#config_cache:not_yet_implemented:sharing"></a><a class="link" href="#config_cache:not_yet_implemented:sharing">Sharing the configuration cache</a></h5>
<div class="paragraph">
<p>The configuration cache is currently stored locally only.
It can be reused by hot or cold local Gradle daemons.
But it can&#8217;t be shared between developers or CI machines.</p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/gradle/gradle/issues/13510">gradle/gradle#13510</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:not_yet_implemented:source_dependencies"><a class="anchor" href="#config_cache:not_yet_implemented:source_dependencies"></a><a class="link" href="#config_cache:not_yet_implemented:source_dependencies">Source dependencies</a></h5>
<div class="paragraph">
<p>Support for <a href="https://blog.gradle.org/introducing-source-dependencies">source dependencies</a> is not yet implemented.
With the configuration cache enabled, no problem will be reported and the build will fail.</p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/gradle/gradle/issues/13506">gradle/gradle#13506</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:not_yet_implemented:testkit_build_with_java_agent"><a class="anchor" href="#config_cache:not_yet_implemented:testkit_build_with_java_agent"></a><a class="link" href="#config_cache:not_yet_implemented:testkit_build_with_java_agent">Using a Java agent with builds run using TestKit</a></h5>
<div class="paragraph">
<p>When running builds using <a href="#test_kit">TestKit</a>, the configuration cache can interfere with Java agents, such as the Jacoco agent, that are applied to these builds.</p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/gradle/gradle/issues/25979">gradle/gradle#25979</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:not_yet_implemented:fine_grained_tracking_of_gradle_properties"><a class="anchor" href="#config_cache:not_yet_implemented:fine_grained_tracking_of_gradle_properties"></a><a class="link" href="#config_cache:not_yet_implemented:fine_grained_tracking_of_gradle_properties">Fine-grained tracking of Gradle properties as build configuration inputs</a></h5>
<div class="paragraph">
<p>Currently, all external sources of Gradle properties (<code>gradle.properties</code> in project directories and in the <code><a href="#dir:gradle_user_home">GRADLE_USER_HOME</a></code>, environment variables and system properties that set properties, and properties specified with
command-line flags) are considered build configuration inputs regardless of what properties are actually used at configuration time. These sources, however, are not included in the configuration cache report.</p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/gradle/gradle/issues/20969">gradle/gradle#20969</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:not_yet_implemented:java_serialization"><a class="anchor" href="#config_cache:not_yet_implemented:java_serialization"></a><a class="link" href="#config_cache:not_yet_implemented:java_serialization">Java Object Serialization</a></h5>
<div class="paragraph">
<p>Gradle allows objects that support the <a href="https://docs.oracle.com/javase/8/docs/platform/serialization/spec/serialTOC.html">Java Object Serialization</a> protocol to be stored in the configuration cache.</p>
</div>
<div class="paragraph">
<p>The implementation is currently limited to serializable classes that
either implement the <code>java.io.Externalizable</code> interface, or implement the <code>java.io.Serializable</code> interface and define one of the following combination of methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>writeObject</code> method combined with a <code>readObject</code> method to control exactly which information to store;</p>
</li>
<li>
<p>a <code>writeObject</code> method with no corresponding <code>readObject</code>; <code>writeObject</code> must eventually call <code>ObjectOutputStream.defaultWriteObject</code>;</p>
</li>
<li>
<p>a <code>readObject</code> method with no corresponding <code>writeObject</code>; <code>readObject</code> must eventually call <code>ObjectInputStream.defaultReadObject</code>;</p>
</li>
<li>
<p>a <code>writeReplace</code> method to allow the class to nominate a replacement to be written;</p>
</li>
<li>
<p>a <code>readResolve</code> method to allow the class to nominate a replacement for the object just read;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following <em>Java Object Serialization</em> features are <strong>not</strong> supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>serialPersistentFields</code> member to explicitly declare which fields are serializable; the member, if present, is ignored; the configuration cache considers all but <code>transient</code> fields serializable;</p>
</li>
<li>
<p>the following methods of <code>ObjectOutputStream</code> are not supported and will throw <code>UnsupportedOperationException</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>reset()</code>, <code>writeFields()</code>, <code>putFields()</code>, <code>writeChars(String)</code>, <code>writeBytes(String)</code> and <code>writeUnshared(Any?)</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>the following methods of <code>ObjectInputStream</code> are not supported and will throw <code>UnsupportedOperationException</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>readLine()</code>, <code>readFully(ByteArray)</code>, <code>readFully(ByteArray, Int, Int)</code>, <code>readUnshared()</code>, <code>readFields()</code>, <code>transferTo(OutputStream)</code> and <code>readAllBytes()</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>validations registered via <code>ObjectInputStream.registerValidation</code> are simply ignored;</p>
</li>
<li>
<p>the <code>readObjectNoData</code> method, if present, is never invoked;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/gradle/gradle/issues/13588">gradle/gradle#13588</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:not_yet_implemented:accessing_top_level_at_execution"><a class="anchor" href="#config_cache:not_yet_implemented:accessing_top_level_at_execution"></a><a class="link" href="#config_cache:not_yet_implemented:accessing_top_level_at_execution">Accessing top-level methods and variables of a build script at execution time</a></h5>
<div class="paragraph">
<p>A common approach to reuse logic and data in a build script is to extract repeating bits into top-level methods and variables.
However, calling such methods at execution time is not currently supported if the configuration cache is enabled.</p>
</div>
<div class="paragraph">
<p>For builds scripts written in Groovy, the task fails because the method cannot be found.
The following snippet uses a top-level method in the <code>listFiles</code> task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> dir = file(<span class="string"><span class="delimiter">'</span><span class="content">data</span><span class="delimiter">'</span></span>)

<span class="keyword">def</span> <span class="function">listFiles</span>(<span class="predefined-type">File</span> dir) {
    dir.listFiles({ file -&gt; file.isFile() } <span class="keyword">as</span> <span class="predefined-type">FileFilter</span>).name.sort()
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">listFiles</span><span class="delimiter">'</span></span>) {
    doLast {
        println listFiles(dir)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Running the task with the configuration cache enabled produces the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution failed for task ':listFiles'.
&gt; Could not find method listFiles() for arguments [/home/user/gradle/samples/data] on task ':listFiles' of type org.gradle.api.DefaultTask.</pre>
</div>
</div>
<div class="paragraph">
<p>To prevent the task from failing, convert the referenced top-level method to a static method within a class:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> dir = file(<span class="string"><span class="delimiter">'</span><span class="content">data</span><span class="delimiter">'</span></span>)

<span class="type">class</span> <span class="class">Files</span> {
    <span class="directive">static</span> <span class="keyword">def</span> <span class="function">listFiles</span>(<span class="predefined-type">File</span> dir) {
        dir.listFiles({ file -&gt; file.isFile() } <span class="keyword">as</span> <span class="predefined-type">FileFilter</span>).name.sort()
    }
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">listFilesFixed</span><span class="delimiter">'</span></span>) {
    doLast {
        println Files.listFiles(dir)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Build scripts written in Kotlin cannot store tasks that reference top-level methods or variables at execution time in the configuration cache at all.
This limitation exists because the captured script object references cannot be serialized.
The first run of the Kotlin version of the <code>listFiles</code> task fails with the configuration cache problem.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val dir = file(&quot;data&quot;)

fun listFiles(dir: File): List&lt;String&gt; =
    dir.listFiles { file: File -&gt; file.isFile }.map { it.name }.sorted()

tasks.register(&quot;listFiles&quot;) {
    doLast {
        println(listFiles(dir))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To make the Kotlin version of this task compatible with the configuration cache, make the following changes:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">object Files { // <b class="conum">(1)</b>
    fun listFiles(dir: File): List&lt;String&gt; =
        dir.listFiles { file: File -&gt; file.isFile }.map { it.name }.sorted()
}

tasks.register(&quot;listFilesFixed&quot;) {
    val dir = file(&quot;data&quot;) // <b class="conum">(2)</b>
    doLast {
        println(Files.listFiles(dir))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Define the method inside an object.</p>
</li>
<li>
<p>Define the variable in a smaller scope.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/gradle/gradle/issues/22879">gradle/gradle#22879</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="config_cache:not_yet_implemented:build_services_in_fingerprint"><a class="anchor" href="#config_cache:not_yet_implemented:build_services_in_fingerprint"></a><a class="link" href="#config_cache:not_yet_implemented:build_services_in_fingerprint">Using build services to invalidate the configuration cache</a></h5>
<div class="paragraph">
<p>Currently, it is impossible to use a <code>BuildServiceProvider</code> or provider derived from it with <code>map</code> or <code>flatMap</code> as a parameter for the <code>ValueSource</code>, if the value of the <code>ValueSource</code> is accessed at configuration time.
The same applies when such a <code>ValueSource</code> is obtained in a task that executes as part of the configuration phase, for example tasks of the <code>buildSrc</code> build or included builds contributing plugins.
Note that using a <code>@ServiceReference</code> or storing <code>BuildServiceProvider</code> in an <code>@Internal</code>-annotated property of a task is safe.
Generally speaking, this limitation makes it impossible to use a <code>BuildService</code> to invalidate the configuration cache.</p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/gradle/gradle/issues/24085">gradle/gradle#24085</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="inspecting_build_scans"><a class="anchor" href="#inspecting_build_scans"></a><a class="link" href="#inspecting_build_scans">Inspecting Gradle Builds</a></h3>
<div class="badge-wrapper">
    <a class="badge" href="https://dpeuniversity.gradle.com/app/courses/b5069222-cfd0-4393-b645-7a2c713853d5/" target="_blank">
        <span class="badge-type button--blue">LEARN</span>
        <span class="badge-text">How to Use Build Scans&nbsp;&nbsp;&nbsp;&gt;</span>
    </a>
</div>
<div class="paragraph">
<p>Gradle provides multiple ways to inspect your build:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Profile with build scans</p>
</li>
<li>
<p>Local profile reports</p>
</li>
<li>
<p>Low level profiling</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="what_is_a_build_scan"><a class="anchor" href="#what_is_a_build_scan"></a><a class="link" href="#what_is_a_build_scan">What is a build scan?</a></h4>
<div class="paragraph">
<p><a href="https://scans.gradle.com/">Build scans</a> are a persistent, shareable record of what happened when running a build.
Build scans provide insights into your build that you can use to identify and fix performance bottlenecks.</p>
</div>
<div class="paragraph">
<p>In Gradle 4.3 and above, you can create a build scan using the <code>--scan</code> command line option:</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre>$ gradle build --scan</pre>
</div>
</div>
<div class="paragraph">
<p>For older Gradle versions, the
<a href="https://docs.gradle.com/build-scan-plugin/#getting_set_up">Build Scan Plugin User Manual</a>
explains how to enable build scans.</p>
</div>
<div class="paragraph">
<p>At the end of your build, Gradle displays a URL where you can find your build scan:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>BUILD SUCCESSFUL in 2s
4 actionable tasks: 4 executed

Publishing build scan...
https://gradle.com/s/e6ircx2wjbf7e</pre>
</div>
</div>
<div class="paragraph">
<p>This section explains how to profile your build with build scans.</p>
</div>
</div>
<div class="sect3">
<h4 id="profile_with_build_scans"><a class="anchor" href="#profile_with_build_scans"></a><a class="link" href="#profile_with_build_scans">Profile with build scans</a></h4>
<div class="paragraph">
<p>The performance page can help use build scans to profile a build.
To get there, click <em>"Performance"</em> in the left hand navigation menu
or follow the "Explore performance" link on the build scan home page:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/build-scan-home.png" alt="build scan home">
</div>
<div class="title">Figure 28. Performance page link on build scan home page</div>
</div>
<div class="paragraph">
<p>The performance page shows how long it took to complete different stages of a build.
This page shows how long it took to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>start up</p>
</li>
<li>
<p>configure the build&#8217;s projects</p>
</li>
<li>
<p>resolve dependencies</p>
</li>
<li>
<p>execute tasks</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You also get details about environmental properties, such as whether a daemon was used or not.</p>
</div>
<div id="build-scan-performance" class="imageblock">
<div class="content">
<img src="img/performance/build-scan-performance-page.png" alt="build scan performance page">
</div>
<div class="title">Figure 29. Build scan performance page</div>
</div>
<div class="paragraph">
<p>In the above build scan, configuration takes over 13 seconds.
Click on the <em>"Configuration"</em> tab to break this stage into component parts,
exposing the cause of the slowness.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/build-scan-configuration-breakdown.png" alt="build scan configuration breakdown">
</div>
<div class="title">Figure 30. Build scan configuration breakdown</div>
</div>
<div class="paragraph">
<p>Here you can see the scripts and plugins applied to the project in descending order of how long they took to apply.
The slowest plugin and script applications are good candidates for optimization.
For example, the script <code>script-b.gradle</code> was applied once but took 3 seconds.
Expand that row to see where the build applied this script.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/script-b-application.png" alt="script b application">
</div>
<div class="title">Figure 31. Showing the application of script-b.gradle to the build</div>
</div>
<div class="paragraph">
<p>You can see that subproject <code>:app1</code> applied the script once, from inside of that subproject&#8217;s <code>build.gradle</code> file.</p>
</div>
</div>
<div class="sect3">
<h4 id="profile_report"><a class="anchor" href="#profile_report"></a><a class="link" href="#profile_report">Profile report</a></h4>
<div class="paragraph">
<p>If you prefer not to use build scans, you can generate an HTML report in the
<code>build/reports/profile</code> directory of your root project. To generate this report,
use the <code>--profile</code> command-line option:</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre>$ gradle --profile &lt;tasks&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Each profile report has a timestamp in its name to avoid overwriting existing ones.</p>
</div>
<div class="paragraph">
<p>The report displays a breakdown of the time taken to run the build.
However, this breakdown is not as detailed as a build scan.
The following profile report shows the different categories available:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/performance/gradle-profile-report.png" alt="Sample Gradle profile report">
</div>
<div class="title">Figure 32. An example profile report</div>
</div>
</div>
<div class="sect3">
<h4 id="low_level_profiling"><a class="anchor" href="#low_level_profiling"></a><a class="link" href="#low_level_profiling">Low level profiling</a></h4>
<div class="paragraph">
<p>Sometimes your build can be slow even though your build scripts do everything right.
This often comes down to inefficiencies in plugins and custom tasks or constrained resources.
Use the <a href="https://github.com/gradle/gradle-profiler">Gradle Profiler</a> to find these kinds of bottlenecks.
With the Gradle Profiler, you can define scenarios like "Running 'assemble' after making an ABI-breaking change"
and run your build several times to collect profiling data.
Use the Profiler to produce build scans. Or combine it with method profilers like JProfiler and YourKit.
These profilers can help you find inefficient algorithms in custom plugins.
If you find that something in Gradle itself slows down your build, don&#8217;t hesitate to send a profiler snapshot to <a href="mailto:performance@gradle.com">performance@gradle.com</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="performance_categories"><a class="anchor" href="#performance_categories"></a><a class="link" href="#performance_categories">Performance categories</a></h4>
<div class="paragraph">
<p>Both build scans and local profile reports break down build execution into the same categories.
The following sections explain those categories.</p>
</div>
<div class="sect4">
<h5 id="startup"><a class="anchor" href="#startup"></a><a class="link" href="#startup">Startup</a></h5>
<div class="paragraph">
<p>This reflects Gradle’s initialization time, which consists mostly of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JVM initialization and class loading</p>
</li>
<li>
<p>Downloading the Gradle distribution if you’re using the wrapper</p>
</li>
<li>
<p>Starting the daemon if a suitable one isn’t already running</p>
</li>
<li>
<p>Executing Gradle initialization scripts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even when a build execution has a long startup time, subsequent runs
usually see a dramatic drop off in startup time.
Persistently slow build startup times are usually the result of problems in your init scripts.
Double check that the work you’re doing there is necessary and performant.</p>
</div>
</div>
<div class="sect4">
<h5 id="settings_and_buildsrc"><a class="anchor" href="#settings_and_buildsrc"></a><a class="link" href="#settings_and_buildsrc">Settings and <em>buildSrc</em></a></h5>
<div class="paragraph">
<p>After startup, Gradle initializes your project. Usually, Gradle only processes your settings file.
If you have custom build logic in a <code>buildSrc</code> directory, Gradle also processes that logic.
After building <code>buildSrc</code> once, Gradle considers it up to date. The up-to-date checks take significantly less time than logic processing.
If your <code>buildSrc</code> phase takes too much time, consider breaking it out into a separate project.
You can then add that project&#8217;s JAR artifact as a dependency.</p>
</div>
<div class="paragraph">
<p>The settings file rarely contains code with significant I/O or computation.
If you find that Gradle takes a long time to process it, use more traditional profiling methods,
like the <a href="https://github.com/gradle/gradle-profiler">the Gradle Profiler</a>, to determine the cause.</p>
</div>
</div>
<div class="sect4">
<h5 id="loading_projects"><a class="anchor" href="#loading_projects"></a><a class="link" href="#loading_projects">Loading projects</a></h5>
<div class="paragraph">
<p>It normally doesn’t take a significant amount of time to load projects, nor do you have any control over it.
The time spent here is basically a function of the number of projects you have in your build.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="config_gradle"><a class="anchor" href="#config_gradle"></a><a class="link" href="#config_gradle">Configuring Gradle</a></h4>

</div>
<div class="sect3">
<h4 id="sec:configuring_jvm_memory"><a class="anchor" href="#sec:configuring_jvm_memory"></a><a class="link" href="#sec:configuring_jvm_memory">Configuring JVM memory</a></h4>
<div class="paragraph">
<p>The <code>org.gradle.jvmargs</code> Gradle property controls the VM running the build.
It defaults to <code>-Xmx512m "-XX:MaxMetaspaceSize=384m"</code></p>
</div>
<div class="paragraph">
<p>You can adjust JVM options for Gradle in the following ways.</p>
</div>
<div class="paragraph">
<p><strong>Option 1:</strong> Changing JVM settings for the build VM:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>org.gradle.jvmargs=-Xmx2g -XX:MaxMetaspaceSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>JAVA_OPTS</code> environment variable controls the command line client, which is only used to display console output. It defaults to <code>-Xmx64m</code></p>
</div>
<div class="paragraph">
<p><strong>Option 2:</strong> Changing JVM settings for the client VM:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>JAVA_OPTS="-Xmx64m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8"</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There is one case where the client VM can also serve as the build VM:</p>
</div>
<div class="paragraph">
<p>If you deactivate the <a href="#gradle_daemon">Gradle Daemon</a> and the client VM has the same settings as required for the build VM, the client VM will run the build directly.</p>
</div>
<div class="paragraph">
<p>Otherwise, the client VM will fork a new VM to run the actual build in order to honor the different settings.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Certain tasks, like the <code>test</code> task, also fork additional JVM processes.
You can configure these through the tasks themselves.
They use <code>-Xmx512m</code> by default.</p>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong> Set compile options for Java compilation tasks:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}

tasks.withType&lt;JavaCompile&gt;().configureEach {
    options.compilerArgs = listOf(&quot;-Xdoclint:none&quot;, &quot;-Xlint:none&quot;, &quot;-nowarn&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

tasks.withType(JavaCompile).configureEach {
    options.compilerArgs += [<span class="string"><span class="delimiter">'</span><span class="content">-Xdoclint:none</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">-Xlint:none</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">-nowarn</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See other examples in the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html">Test</a> API documentation and <a href="#sec:test_execution">test execution in the Java plugin reference</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://scans.gradle.com">Build scans</a> will tell you information about the JVM that executed the build when you use the <code>--scan</code> option:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://scans.gradle.com/s/sample/cpp-parallel/infrastructure"><img src="img/build-scan-infrastructure.png" alt="Build Environment in Build Scan"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuring_task_using_project_properties"><a class="anchor" href="#sec:configuring_task_using_project_properties"></a><a class="link" href="#sec:configuring_task_using_project_properties">Configuring a task using project properties</a></h4>
<div class="paragraph">
<p>It is possible to change the behavior of a task based on project properties specified at invocation time.</p>
</div>
<div class="paragraph">
<p>Suppose you would like to ensure release builds are only triggered by CI.
A simple way to do this is using the <code>isCI</code> project property.</p>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong> Prevent releasing outside of CI:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;performRelease&quot;) {
    val isCI = providers.gradleProperty(&quot;isCI&quot;)
    doLast {
        if (isCI.isPresent) {
            println(&quot;Performing release actions&quot;)
        } else {
            throw InvalidUserDataException(&quot;Cannot perform release outside of CI&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">performRelease</span><span class="delimiter">'</span></span>) {
    <span class="keyword">def</span> isCI = providers.gradleProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">isCI</span><span class="delimiter">&quot;</span></span>)
    doLast {
        <span class="keyword">if</span> (isCI.present) {
            println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Performing release actions</span><span class="delimiter">&quot;</span></span>)
        } <span class="keyword">else</span> {
            <span class="keyword">throw</span> <span class="keyword">new</span> InvalidUserDataException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cannot perform release outside of CI</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle performRelease -PisCI=true --quiet
Performing release actions</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:project_properties"><a class="anchor" href="#sec:project_properties"></a><a class="link" href="#sec:project_properties">Project properties</a></h4>
<div class="paragraph">
<p>Project properties are available on the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html">Project</a> object.
They can be set from the command line using the <code>-P</code> / <code>--project-prop</code> <a href="#sec:environment_options">environment option</a>.</p>
</div>
<div class="paragraph">
<p>The following examples demonstrate how to set project properties in different ways.</p>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong> Setting a project property via the <strong>command line</strong>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>$ gradle -PgradlePropertiesProp=commandLineValue</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle can also set project properties when it sees specially-named system properties or environment variables.
If the environment variable name looks like <code>ORG_GRADLE_PROJECT<em>_prop</em>=somevalue</code>, then Gradle will set a <code>prop</code> property on your project object, with the value of <code>somevalue</code>.
Gradle also supports this for system properties, but with a different naming pattern, which looks like <code>org.gradle.project.<em>prop</em></code>.
Both of the following will set the <code>foo</code> property on your Project object to <code>"bar"</code>.</p>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong> Setting a project property via a <strong>system property</strong>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>org.gradle.project.foo=bar</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Example 3:</strong> Setting a project property via an <strong>environment variable</strong>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>ORG_GRADLE_PROJECT_foo=bar</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This feature is useful when you don&#8217;t have admin rights to a continuous integration server and you need to set property values that should not be easily visible.
Since you cannot use the <code>-P</code> option in that scenario nor change the system-level configuration files, the correct strategy is to change the configuration of your continuous integration build job, adding an environment variable setting that matches an expected pattern.
This won&#8217;t be visible to normal users on the system.</p>
</div>
<div class="paragraph">
<p>The following examples demonstrate how to use project properties.</p>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong> Reading project properties at configuration time:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Querying the presence of a project property
if (hasProperty(&quot;myProjectProp&quot;)) {
    // Accessing the value, throws if not present
    println(property(&quot;myProjectProp&quot;))
}

// Accessing the value of a project property, null if absent
println(findProperty(&quot;myProjectProp&quot;))

// Accessing the Map&lt;String, Any?&gt; of project properties
println(properties[&quot;myProjectProp&quot;])

// Using Kotlin delegated properties on `project`
val myProjectProp: String by project
println(myProjectProp)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Querying the presence of a project property</span>
<span class="keyword">if</span> (hasProperty(<span class="string"><span class="delimiter">'</span><span class="content">myProjectProp</span><span class="delimiter">'</span></span>)) {
    <span class="comment">// Accessing the value, throws if not present</span>
    println property(<span class="string"><span class="delimiter">'</span><span class="content">myProjectProp</span><span class="delimiter">'</span></span>)
}

<span class="comment">// Accessing the value of a project property, null if absent</span>
println findProperty(<span class="string"><span class="delimiter">'</span><span class="content">myProjectProp</span><span class="delimiter">'</span></span>)

<span class="comment">// Accessing the Map&lt;String, ?&gt; of project properties</span>
println properties[<span class="string"><span class="delimiter">'</span><span class="content">myProjectProp</span><span class="delimiter">'</span></span>]

<span class="comment">// Using Groovy dynamic names, throws if not present</span>
println myProjectProp</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>The <a href="https://kotlinlang.org/docs/delegated-properties.html">Kotlin delegated properties</a> are part of the Gradle Kotlin DSL.
You need to explicitly specify the type as <code>String</code>.
If you need to branch depending on the presence of the property, you can also use <code>String?</code> and check for <code>null</code>.</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>Note that if a Project property has a dot in its name, using the dynamic Groovy names is not possible.
You have to use the API or the dynamic array notation instead.</p>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong> Reading project properties for consumption at execution time:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;PrintValue&gt;(&quot;printValue&quot;) {
    // Eagerly accessing the value of a project property, set as a task input
    inputValue = project.property(&quot;myProjectProp&quot;).toString()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">printValue</span><span class="delimiter">'</span></span>, PrintValue) {
    <span class="comment">// Eagerly accessing the value of a project property, set as a task input</span>
    inputValue = project.property(<span class="string"><span class="delimiter">'</span><span class="content">myProjectProp</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If a project property is referenced but does not exist, an exception will be thrown, and the build will fail.
You should check for the existence of optional project properties before you access them using the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:hasProperty(java.lang.String)">Project.hasProperty(java.lang.String)</a> method.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="networking_gradle"><a class="anchor" href="#networking_gradle"></a><a class="link" href="#networking_gradle">Networking with Gradle</a></h4>

</div>
<div class="sect3">
<h4 id="sec:accessing_the_web_via_a_proxy"><a class="anchor" href="#sec:accessing_the_web_via_a_proxy"></a><a class="link" href="#sec:accessing_the_web_via_a_proxy">Accessing the web through a proxy</a></h4>
<div class="paragraph">
<p>Configuring a proxy (for downloading dependencies, for example) is done via standard JVM system properties.</p>
</div>
<div class="paragraph">
<p>These properties can be set directly in the build script.
For example, setting the HTTP proxy host would be done with <code>System.setProperty('http.proxyHost', 'www.somehost.org')</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively, the properties can be <a href="#sec:gradle_configuration_properties">specified in <code>gradle.properties</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong> Configuring an HTTP proxy using <code>gradle.properties</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>systemProp.http.proxyHost=www.somehost.org
systemProp.http.proxyPort=8080
systemProp.http.proxyUser=userid
systemProp.http.proxyPassword=password
systemProp.http.nonProxyHosts=*.nonproxyrepos.com|localhost</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are separate settings for HTTPS.</p>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong> Configuring an HTTPS proxy using <code>gradle.properties</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>systemProp.https.proxyHost=www.somehost.org
systemProp.https.proxyPort=8080
systemProp.https.proxyUser=userid
systemProp.https.proxyPassword=password
# NOTE: this is not a typo.
systemProp.http.nonProxyHosts=*.nonproxyrepos.com|localhost</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are separate settings for SOCKS.</p>
</div>
<div class="paragraph">
<p><strong>Example 3:</strong> Configuring a SOCKS proxy using <code>gradle.properties</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>systemProp.socksProxyHost=www.somehost.org
systemProp.socksProxyPort=1080
systemProp.java.net.socks.username=userid
systemProp.java.net.socks.password=password</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You may need to set other properties to access other networks.</p>
</div>
<div class="paragraph">
<p>Helpful references:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/apache/ant/blob/master/src/main/org/apache/tools/ant/util/ProxySetup.java" target="_blank" rel="noopener">ProxySetup.java in the Ant codebase</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/net/proxies.html" target="_blank" rel="noopener">JDK 8 Proxies</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ntlm_authentication"><a class="anchor" href="#ntlm_authentication"></a><a class="link" href="#ntlm_authentication">NTLM Authentication</a></h5>
<div class="paragraph">
<p>If your proxy requires NTLM authentication, you may need to provide the authentication domain as well as the username and password.</p>
</div>
<div class="paragraph">
<p>There are 2 ways that you can provide the domain for authenticating to a NTLM proxy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>http.proxyUser</code> system property to a value like <code><em>domain</em>/<em>username</em></code>.</p>
</li>
<li>
<p>Provide the authentication domain via the <code>http.auth.ntlm.domain</code> system property.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using_the_build_cache"><a class="anchor" href="#using_the_build_cache"></a><a class="link" href="#using_the_build_cache">USING THE BUILD CACHE</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="build_cache"><a class="anchor" href="#build_cache"></a><a class="link" href="#build_cache">Build Cache</a></h3>
<div class="badge-wrapper">
    <a class="badge" href="https://dpeuniversity.gradle.com/app/courses/ec69d0b8-9171-4969-ac3e-82dea16f87b0/" target="_blank">
        <span class="badge-type button--blue">LEARN</span>
        <span class="badge-text">Incremental Builds and Build Caching with Gradle&nbsp;&nbsp;&nbsp;&gt;</span>
    </a>
</div>
<div class="sect3">
<h4 id="sec:build_cache_intro"><a class="anchor" href="#sec:build_cache_intro"></a><a class="link" href="#sec:build_cache_intro">Overview</a></h4>
<div class="paragraph">
<p>The Gradle <em>build cache</em> is a cache mechanism that aims to save time by reusing outputs produced by other builds.
The build cache works by storing (locally or remotely) build outputs and allowing builds to fetch these outputs from the cache when it is determined that inputs have not changed, avoiding the expensive work of regenerating them.</p>
</div>
<div class="paragraph">
<p>A first feature using the build cache is <em>task output caching</em>.
Essentially, task output caching leverages the same intelligence as <a href="#incremental_build">up-to-date checks</a> that Gradle uses to avoid work when a previous local build has already produced a set of task outputs.
But instead of being limited to the previous build in the same workspace, task output caching allows Gradle to reuse task outputs from any earlier build in any location on the local machine.
When using a shared build cache for task output caching this even works across developer machines and build agents.</p>
</div>
<div class="paragraph">
<p>Apart from tasks, <a href="#sec:abm_artifact_transforms">artifact transforms</a> can also leverage the build cache and re-use their outputs similarly to task output caching.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
For a hands-on approach to learning how to use the build cache, start with reading through the <a href="#use_cases_cache">use cases for the build cache</a> and the follow up sections.
It covers the different scenarios that caching can improve and has detailed discussions of the different caveats you need to be aware of when enabling caching for a build.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:build_cache_enable"><a class="anchor" href="#sec:build_cache_enable"></a><a class="link" href="#sec:build_cache_enable">Enable the Build Cache</a></h4>
<div class="paragraph">
<p>By default, the build cache is not enabled. You can enable the build cache in a couple of ways:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Run with <code>--build-cache</code> on the command-line</dt>
<dd>
<p>Gradle will use the build cache for this build only.</p>
</dd>
<dt class="hdlist1">Put <code>org.gradle.caching=true</code> in your <code>gradle.properties</code></dt>
<dd>
<p>Gradle will try to reuse outputs from previous builds for all builds, unless explicitly disabled with <code>--no-build-cache</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When the build cache is enabled, it will store build outputs in the Gradle User Home.
For configuring this directory or different kinds of build caches see <a href="#sec:build_cache_configure">Configure the Build Cache</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_output_caching"><a class="anchor" href="#sec:task_output_caching"></a><a class="link" href="#sec:task_output_caching">Task Output Caching</a></h4>
<div class="paragraph">
<p>Beyond incremental builds described in <a href="#incremental_build">up-to-date checks</a>, Gradle can save time by reusing outputs from previous executions of a task by matching inputs to the task.
Task outputs can be reused between builds on one computer or even between builds running on different computers via a build cache.</p>
</div>
<div class="paragraph">
<p>We have focused on the use case where users have an organization-wide remote build cache that is populated regularly by continuous integration builds.
Developers and other continuous integration agents should load cache entries from the remote build cache.
We expect that developers will not be allowed to populate the remote build cache, and all continuous integration builds populate the build cache after running the <code>clean</code> task.</p>
</div>
<div class="paragraph">
<p>For your build to play well with task output caching it must work well with the <a href="#incremental_build">incremental build</a> feature.
For example, when running your build twice in a row all tasks with outputs should be <code>UP-TO-DATE</code>.
You cannot expect faster builds or correct builds when enabling task output caching when this prerequisite is not met.</p>
</div>
<div class="paragraph">
<p>Task output caching is automatically enabled when you enable the build cache, see <a href="#sec:build_cache_enable">Enable the Build Cache</a>.</p>
</div>
<div class="sect4">
<h5 id="sec:task_output_caching_example"><a class="anchor" href="#sec:task_output_caching_example"></a><a class="link" href="#sec:task_output_caching_example">What does it look like</a></h5>
<div class="paragraph">
<p>Let us start with a project using the Java plugin which has a few Java source files. We run the build the first time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; gradle --build-cache compileJava
:compileJava
:processResources
:classes
:jar
:assemble

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="paragraph">
<p>We see the directory used by the local build cache in the output. Apart from that the build was the same as without the build cache.
Let&#8217;s clean and run the build again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; gradle clean
:clean

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; gradle --build-cache assemble
:compileJava FROM-CACHE
:processResources
:classes
:jar
:assemble

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="paragraph">
<p>Now we see that, instead of executing the <code>:compileJava</code> task, the outputs of the task have been loaded from the build cache.
The other tasks have not been loaded from the build cache since they are not cacheable. This is due to
<code>:classes</code> and <code>:assemble</code> being <a href="organizing_tasks.html#sec:lifecycle_tasks">lifecycle tasks</a> and <code>:processResources</code>
and <code>:jar</code> being Copy-like tasks which are not cacheable since it is generally faster to execute them.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_output_caching_details"><a class="anchor" href="#sec:task_output_caching_details"></a><a class="link" href="#sec:task_output_caching_details">Cacheable tasks</a></h4>
<div class="paragraph">
<p>Since a task describes all of its inputs and outputs, Gradle can compute a <em>build cache key</em> that uniquely defines the task&#8217;s outputs based on its inputs.
That build cache key is used to request previous outputs from a build cache or store new outputs in the build cache.
If the previous build outputs have been already stored in the cache by someone else, e.g. your continuous integration server or other developers, you can avoid executing most tasks locally.</p>
</div>
<div class="paragraph">
<p>The following inputs contribute to the build cache key for a task in the same way that they do for <a href="#sec:how_does_it_work">up-to-date checks</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The task type and its classpath</p>
</li>
<li>
<p>The names of the output properties</p>
</li>
<li>
<p>The names and values of properties annotated as described in <a href="#sec:task_input_output_annotations">the section called "Custom task types"</a></p>
</li>
<li>
<p>The names and values of properties added by the DSL via <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskInputs.html">TaskInputs</a></p>
</li>
<li>
<p>The classpath of the Gradle distribution, buildSrc and plugins</p>
</li>
<li>
<p>The content of the build script when it affects execution of the task</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Task types need to opt-in to task output caching using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/CacheableTask.html">@CacheableTask</a> annotation.
Note that <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/CacheableTask.html">@CacheableTask</a> is not inherited by subclasses.
Custom task types are <em>not</em> cacheable by default.</p>
</div>
<div class="sect4">
<h5 id="sec:task_output_caching_cacheable_tasks"><a class="anchor" href="#sec:task_output_caching_cacheable_tasks"></a><a class="link" href="#sec:task_output_caching_cacheable_tasks">Built-in cacheable tasks</a></h5>
<div class="paragraph">
<p>Currently, the following built-in Gradle tasks are cacheable:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java toolchain:
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a>,
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.javadoc.Javadoc.html">Javadoc</a></p>
</li>
<li>
<p>Groovy toolchain:
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.compile.GroovyCompile.html">GroovyCompile</a>,
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.javadoc.Groovydoc.html">Groovydoc</a></p>
</li>
<li>
<p>Scala toolchain:
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.scala.ScalaCompile.html">ScalaCompile</a>,
<code>org.gradle.language.scala.tasks.PlatformScalaCompile</code> (removed),
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.scala.ScalaDoc.html">ScalaDoc</a></p>
</li>
<li>
<p>Native toolchain:
<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/language/cpp/tasks/CppCompile.html">CppCompile</a>,
<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/language/c/tasks/CCompile.html">CCompile</a>,
<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/language/swift/tasks/SwiftCompile.html">SwiftCompile</a></p>
</li>
<li>
<p>Testing:
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html">Test</a></p>
</li>
<li>
<p>Code quality tasks:
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.plugins.quality.Checkstyle.html">Checkstyle</a>,
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.plugins.quality.CodeNarc.html">CodeNarc</a>,
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.plugins.quality.Pmd.html">Pmd</a></p>
</li>
<li>
<p>JaCoCo:
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.testing.jacoco.tasks.JacocoReport.html">JacocoReport</a></p>
</li>
<li>
<p>Other tasks:
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.plugins.antlr.AntlrTask.html">AntlrTask</a>,
<a href="https://docs.gradle.org/8.9/javadoc/org/gradle/plugin/devel/tasks/ValidatePlugins.html">ValidatePlugins</a>,
<a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.WriteProperties.html">WriteProperties</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All other built-in tasks are currently not cacheable.</p>
</div>
<div class="paragraph">
<p>Some tasks, like <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.Copy.html">Copy</a> or <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar</a>, usually do not make sense to make cacheable because Gradle is only copying files from one location to another.
It also doesn&#8217;t make sense to make tasks cacheable that do not produce outputs or have no task actions.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_output_caching_cacheable_3rd_party"><a class="anchor" href="#sec:task_output_caching_cacheable_3rd_party"></a><a class="link" href="#sec:task_output_caching_cacheable_3rd_party">Third party plugins</a></h5>
<div class="paragraph">
<p>There are third party plugins that work well with the build cache.
The most prominent examples are the <a href="https://developer.android.com/studio/releases/gradle-plugin.html">Android plugin 3.1+</a> and the <a href="https://blog.gradle.org/kotlin-build-cache-use">Kotlin plugin 1.2.21+</a>.
For other third party plugins, check their documentation to find out whether they support the build cache.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_output_caching_inputs"><a class="anchor" href="#sec:task_output_caching_inputs"></a><a class="link" href="#sec:task_output_caching_inputs">Declaring task inputs and outputs</a></h5>
<div class="paragraph">
<p>It is very important that a cacheable task has a complete picture of its inputs and outputs, so that the results from one build can be safely re-used somewhere else.</p>
</div>
<div class="paragraph">
<p>Missing task inputs can cause incorrect cache hits, where different results are treated as identical because the same cache key is used by both executions.
Missing task outputs can cause build failures if Gradle does not completely capture all outputs for a given task.
Wrongly declared task inputs can lead to cache misses especially when containing volatile data or absolute paths.
(See <a href="#sec:task_inputs_outputs">the section called "Task inputs and outputs"</a> on what should be declared as inputs and outputs.)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The task path is <em>not</em> an input to the build cache key.
This means that tasks with different task paths can re-use each other&#8217;s outputs as long as Gradle determines that executing them yields the same result.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to ensure that the inputs and outputs are properly declared use integration tests (for example using TestKit) to check that a task produces the same outputs for identical inputs and captures all output files for the task.
We suggest adding tests to ensure that the task inputs are relocatable, i.e. that the task can be loaded from the cache into a different build directory (see <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/PathSensitive.html">@PathSensitive</a>).</p>
</div>
<div class="paragraph">
<p>In order to handle volatile inputs for your tasks consider <a href="#sec:configure_input_normalization">configuring input normalization</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_output_caching_disabled_by_default"><a class="anchor" href="#sec:task_output_caching_disabled_by_default"></a><a class="link" href="#sec:task_output_caching_disabled_by_default">Marking tasks as non-cacheable by default</a></h5>
<div class="paragraph">
<p>There are certain tasks that don&#8217;t benefit from using the build cache.
One example is a task that only moves data around the file system, like a <code>Copy</code> task.
You can signify that a task is not to be cached by adding the <code>@DisableCachingByDefault</code> annotation to it.
You can also give a human-readable reason for not caching the task by default.
The annotation can be used on its own, or together with <code>@CacheableTask</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This annotation is only for documenting the reason behind not caching the task by default.
Build logic can override this decision via the runtime API (see below).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable_caching_of_non_cacheable_tasks"><a class="anchor" href="#enable_caching_of_non_cacheable_tasks"></a><a class="link" href="#enable_caching_of_non_cacheable_tasks">Enable caching of non-cacheable tasks</a></h4>
<div class="paragraph">
<p>As we have seen, built-in tasks, or tasks provided by plugins, are cacheable if their class is annotated with the <code>Cacheable</code> annotation.
But what if you want to make cacheable a task whose class is not cacheable?
Let&#8217;s take a concrete example: your build script uses a generic <code>NpmTask</code> task to create a JavaScript bundle by delegating to NPM (and running <code>npm run bundle</code>).
This process is similar to a complex compilation task, but <code>NpmTask</code> is too generic to be cacheable by default: it just takes arguments and runs npm with those arguments.</p>
</div>
<div class="paragraph">
<p>The inputs and outputs of this task are simple to figure out.
The inputs are the directory containing the JavaScript files, and the NPM configuration files.
The output is the bundle file generated by this task.</p>
</div>
<div class="sect4">
<h5 id="using_annotations"><a class="anchor" href="#using_annotations"></a><a class="link" href="#using_annotations">Using annotations</a></h5>
<div class="paragraph">
<p>We create a subclass of the <code>NpmTask</code> and use <a href="#sec:task_input_output_annotations">annotations to declare the inputs and outputs</a>.</p>
</div>
<div class="paragraph">
<p>When possible, it is better to use delegation instead of creating a subclass.
That is the case for the built in <code>JavaExec</code>, <code>Exec</code>, <code>Copy</code> and <code>Sync</code> tasks, which have a method on <code>Project</code> to do the actual work.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re a modern JavaScript developer, you know that bundling can be quite long, and is worth caching.
To achieve that, we need to tell Gradle that it&#8217;s allowed to cache the output of that task, using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/CacheableTask.html">@CacheableTask</a> annotation.</p>
</div>
<div class="paragraph">
<p>This is sufficient to make the task cacheable on your own machine.
However, input files are identified by default by their absolute path.
So if the cache needs to be shared between several developers or machines using different paths, that won&#8217;t work as expected.
So we also need to set the <a href="#relocatability">path sensitivity</a>.
In this case, the relative path of the input files can be used to identify them.</p>
</div>
<div class="paragraph">
<p>Note that it is possible to override property annotations from the base class by overriding the getter of the base class and annotating that method.</p>
</div>
<div id="ex-custom-cacheable-bundletask" class="exampleblock">
<div class="title">Example 344. <a href="#ex-custom-cacheable-bundletask">Custom cacheable BundleTask</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableTask                                       // <b class="conum">(1)</b>
abstract class BundleTask : NpmTask() {

    @get:Internal                                    // <b class="conum">(2)</b>
    override val args
        get() = super.args


    @get:InputDirectory
    @get:SkipWhenEmpty
    @get:PathSensitive(PathSensitivity.RELATIVE)     // <b class="conum">(3)</b>
    abstract val scripts: DirectoryProperty

    @get:InputFiles
    @get:PathSensitive(PathSensitivity.RELATIVE)     // <b class="conum">(4)</b>
    abstract val configFiles: ConfigurableFileCollection

    @get:OutputFile
    abstract val bundle: RegularFileProperty

    init {
        args.addAll(&quot;run&quot;, &quot;bundle&quot;)
        bundle = projectLayout.buildDirectory.file(&quot;bundle.js&quot;)
        scripts = projectLayout.projectDirectory.dir(&quot;scripts&quot;)
        configFiles.from(projectLayout.projectDirectory.file(&quot;package.json&quot;))
        configFiles.from(projectLayout.projectDirectory.file(&quot;package-lock.json&quot;))
    }
}

tasks.register&lt;BundleTask&gt;(&quot;bundle&quot;)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableTask</span>                                       // <b class="conum">(1)</b>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">BundleTask</span> <span class="directive">extends</span> NpmTask {

    <span class="annotation">@Override</span> <span class="annotation">@Internal</span>                              // <b class="conum">(2)</b>
    ListProperty&lt;<span class="predefined-type">String</span>&gt; getArgs() {
        <span class="local-variable">super</span>.getArgs()
    }

    <span class="annotation">@InputDirectory</span>
    <span class="annotation">@SkipWhenEmpty</span>
    <span class="annotation">@PathSensitive</span>(PathSensitivity.RELATIVE)         // <b class="conum">(3)</b>
    <span class="directive">abstract</span> DirectoryProperty getScripts()

    <span class="annotation">@InputFiles</span>
    <span class="annotation">@PathSensitive</span>(PathSensitivity.RELATIVE)         // <b class="conum">(4)</b>
    <span class="directive">abstract</span> ConfigurableFileCollection getConfigFiles()

    <span class="annotation">@OutputFile</span>
    <span class="directive">abstract</span> RegularFileProperty getBundle()

    BundleTask() {
        args.addAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">run</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bundle</span><span class="delimiter">&quot;</span></span>)
        bundle = projectLayout.buildDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle.js</span><span class="delimiter">&quot;</span></span>)
        scripts = projectLayout.projectDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">scripts</span><span class="delimiter">&quot;</span></span>)
        configFiles.from(projectLayout.projectDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">package.json</span><span class="delimiter">&quot;</span></span>))
        configFiles.from(projectLayout.projectDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">package-lock.json</span><span class="delimiter">&quot;</span></span>))
    }
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">bundle</span><span class="delimiter">'</span></span>, BundleTask)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>(1) Add <code>@CacheableTask</code> to enable caching for the task.</p>
</li>
<li>
<p>(2) Override the getter of a property of the base class to change the input annotation to <code>@Internal</code>.</p>
</li>
<li>
<p>(3) (4) Declare the path sensitivity.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="using_the_runtime_api"><a class="anchor" href="#using_the_runtime_api"></a><a class="link" href="#using_the_runtime_api">Using the runtime API</a></h5>
<div class="paragraph">
<p>If for some reason you cannot create a new custom task class, it is also possible to make a task cacheable using the <a href="#sec:task_input_output_runtime_api">runtime API</a> to declare the inputs and outputs.</p>
</div>
<div class="paragraph">
<p>For enabling caching for the task you need to use the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/TaskOutputs.html#cacheIf-org.gradle.api.specs.Spec-">TaskOutputs.cacheIf()</a> method.</p>
</div>
<div class="paragraph">
<p>The declarations via the runtime API have the same effect as the annotations described above.
Note that you cannot override file inputs and outputs via the runtime API.
Input properties can be overridden by specifying the same property name.</p>
</div>
<div id="ex-make-the-bundle-task-cacheable" class="exampleblock">
<div class="title">Example 345. <a href="#ex-make-the-bundle-task-cacheable">Make the bundle task cacheable</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;NpmTask&gt;(&quot;bundle&quot;) {
    args = listOf(&quot;run&quot;, &quot;bundle&quot;)

    outputs.cacheIf { true }

    inputs.dir(file(&quot;scripts&quot;))
        .withPropertyName(&quot;scripts&quot;)
        .withPathSensitivity(PathSensitivity.RELATIVE)

    inputs.files(&quot;package.json&quot;, &quot;package-lock.json&quot;)
        .withPropertyName(&quot;configFiles&quot;)
        .withPathSensitivity(PathSensitivity.RELATIVE)

    outputs.file(layout.buildDirectory.file(&quot;bundle.js&quot;))
        .withPropertyName(&quot;bundle&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">bundle</span><span class="delimiter">'</span></span>, NpmTask) {
    args = [<span class="string"><span class="delimiter">'</span><span class="content">run</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">bundle</span><span class="delimiter">'</span></span>]

    outputs.cacheIf { <span class="predefined-constant">true</span> }

    inputs.dir(file(<span class="string"><span class="delimiter">&quot;</span><span class="content">scripts</span><span class="delimiter">&quot;</span></span>))
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">scripts</span><span class="delimiter">&quot;</span></span>)
        .withPathSensitivity(PathSensitivity.RELATIVE)

    inputs.files(<span class="string"><span class="delimiter">&quot;</span><span class="content">package.json</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">package-lock.json</span><span class="delimiter">&quot;</span></span>)
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">configFiles</span><span class="delimiter">&quot;</span></span>)
        .withPathSensitivity(PathSensitivity.RELATIVE)

    outputs.file(layout.buildDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle.js</span><span class="delimiter">&quot;</span></span>))
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:build_cache_configure"><a class="anchor" href="#sec:build_cache_configure"></a><a class="link" href="#sec:build_cache_configure">Configure the Build Cache</a></h4>
<div class="paragraph">
<p>You can configure the build cache by using the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.initialization.Settings.html#org.gradle.api.initialization.Settings:buildCache(org.gradle.api.Action)">Settings.buildCache(org.gradle.api.Action)</a> block in <code>settings.gradle</code>.</p>
</div>
<div class="paragraph">
<p>Gradle supports a <code>local</code> and a <code>remote</code> build cache that can be configured separately.
When both build caches are enabled, Gradle tries to load build outputs from the local build cache first, and then tries the remote build cache if no build outputs are found.
If outputs are found in the remote cache, they are also stored in the local cache, so next time they will be found locally.
Gradle stores ("pushes") build outputs in any build cache that is enabled and has <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/caching/configuration/BuildCache.html#isPush--">BuildCache.isPush()</a> set to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>By default, the local build cache has push enabled, and the remote build cache has push disabled.</p>
</div>
<div class="paragraph">
<p>The local build cache is pre-configured to be a <a href="https://docs.gradle.org/8.9/dsl/org.gradle.caching.local.DirectoryBuildCache.html">DirectoryBuildCache</a> and enabled by default.
The remote build cache can be configured by specifying the type of build cache to connect to (<a href="https://docs.gradle.org/8.9/dsl/org.gradle.caching.configuration.BuildCacheConfiguration.html#org.gradle.caching.configuration.BuildCacheConfiguration:remote(java.lang.Class)">BuildCacheConfiguration.remote(java.lang.Class)</a>).</p>
</div>
<div class="sect4">
<h5 id="sec:build_cache_configure_local"><a class="anchor" href="#sec:build_cache_configure_local"></a><a class="link" href="#sec:build_cache_configure_local">Built-in local build cache</a></h5>
<div class="paragraph">
<p>The built-in local build cache, <a href="https://docs.gradle.org/8.9/dsl/org.gradle.caching.local.DirectoryBuildCache.html">DirectoryBuildCache</a>, uses a directory to store build cache artifacts.
By default, this directory resides in the Gradle User Home, but its location is configurable.</p>
</div>
<div class="paragraph">
<p>For more details on the configuration options refer to the DSL documentation of <a href="https://docs.gradle.org/8.9/dsl/org.gradle.caching.local.DirectoryBuildCache.html">DirectoryBuildCache</a>.
Here is an example of the configuration.</p>
</div>
<div id="ex-configure-the-local-cache" class="exampleblock">
<div class="title">Example 346. <a href="#ex-configure-the-local-cache">Configure the local cache</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildCache {
    local {
        directory = File(rootDir, &quot;build-cache&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildCache {
    local {
        directory = <span class="keyword">new</span> <span class="predefined-type">File</span>(rootDir, <span class="string"><span class="delimiter">'</span><span class="content">build-cache</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle will periodically clean-up the local cache directory by removing entries that have not been used recently to conserve disk space.
How often Gradle will perform this clean-up and how long entries will be retained is configurable via an init-script as demonstrated
<a href="{userManualPath}/directory_layout.html#dir:gradle_user_home:configure_cache_cleanup">in this section</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:build_cache_configure_remote"><a class="anchor" href="#sec:build_cache_configure_remote"></a><a class="link" href="#sec:build_cache_configure_remote">Remote HTTP build cache</a></h5>
<div class="paragraph">
<p><a href="https://docs.gradle.org/8.9/dsl/org.gradle.caching.http.HttpBuildCache.html">HttpBuildCache</a> provides the ability read to and write from a remote cache via HTTP.</p>
</div>
<div class="paragraph">
<p>With the following configuration, the local build cache will be used for storing build outputs while the local and the remote build cache will be used for retrieving build outputs.</p>
</div>
<div id="ex-load-from-httpbuildcache" class="exampleblock">
<div class="title">Example 347. <a href="#ex-load-from-httpbuildcache">Load from HttpBuildCache</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildCache {
    remote&lt;HttpBuildCache&gt; {
        url = uri(&quot;https://example.com:8123/cache/&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildCache {
    remote(HttpBuildCache) {
        url = <span class="string"><span class="delimiter">'</span><span class="content">https://example.com:8123/cache/</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When attempting to load an entry, a <code>GET</code> request is made to <code>https://example.com:8123/cache/«cache-key»</code>.
The response must have a <code>2xx</code> status and the cache entry as the body, or a <code>404 Not Found</code> status if the entry does not exist.</p>
</div>
<div class="paragraph">
<p>When attempting to store an entry, a <code>PUT</code> request is made to <code>https://example.com:8123/cache/«cache-key»</code>.
Any <code>2xx</code> response status is interpreted as success.
A <code>413 Payload Too Large</code> response may be returned to indicate that the payload is larger than the server will accept, which will not be treated as an error.</p>
</div>
<div class="sect5">
<h6 id="specifying_access_credentials"><a class="anchor" href="#specifying_access_credentials"></a><a class="link" href="#specifying_access_credentials">Specifying access credentials</a></h6>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Basic_access_authentication">HTTP Basic Authentication</a> is supported, with credentials being sent preemptively.</p>
</div>
<div id="ex-specifying-access-credentials" class="exampleblock">
<div class="title">Example 348. <a href="#ex-specifying-access-credentials">Specifying access credentials</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildCache {
    remote&lt;HttpBuildCache&gt; {
        url = uri(&quot;https://example.com:8123/cache/&quot;)
        credentials {
            username = &quot;build-cache-user&quot;
            password = &quot;some-complicated-password&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildCache {
    remote(HttpBuildCache) {
        url = <span class="string"><span class="delimiter">'</span><span class="content">https://example.com:8123/cache/</span><span class="delimiter">'</span></span>
        credentials {
            username = <span class="string"><span class="delimiter">'</span><span class="content">build-cache-user</span><span class="delimiter">'</span></span>
            password = <span class="string"><span class="delimiter">'</span><span class="content">some-complicated-password</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:build_cache_redirects"><a class="anchor" href="#sec:build_cache_redirects"></a><a class="link" href="#sec:build_cache_redirects">Redirects</a></h6>
<div class="paragraph">
<p><code>3xx</code> redirecting responses will be followed automatically.</p>
</div>
<div class="paragraph">
<p>Servers must take care when redirecting <code>PUT</code> requests as only <code>307</code> and <code>308</code> redirect responses will be followed with a <code>PUT</code> request.
All other redirect responses will be followed with a <code>GET</code> request, as per <a href="https://datatracker.ietf.org/doc/html/rfc7231#page-54">RFC 7231</a>,
without the entry payload as the body.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:build_cache_error_handling"><a class="anchor" href="#sec:build_cache_error_handling"></a><a class="link" href="#sec:build_cache_error_handling">Network error handling</a></h6>
<div class="paragraph">
<p>Requests that fail during request transmission, after having established a TCP connection, will be retried automatically.</p>
</div>
<div class="paragraph">
<p>This prevents temporary problems, such as connection drops, read or write timeouts, and low level network failures such as a connection resets, causing cache operations to fail and disabling the remote cache for the remainder of the build.</p>
</div>
<div class="paragraph">
<p>Requests will be retried up to 3 times.
If the problem persists, the cache operation will fail and the remote cache will be disabled for the remainder of the build.</p>
</div>
</div>
<div class="sect5">
<h6 id="using_ssl"><a class="anchor" href="#using_ssl"></a><a class="link" href="#using_ssl">Using SSL</a></h6>
<div class="paragraph">
<p>By default, use of HTTPS requires the server to present a certificate that is trusted by the build&#8217;s Java runtime.
If your server&#8217;s certificate is not trusted, you can:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the trust store of your Java runtime to allow it to be trusted</p>
</li>
<li>
<p>Change the <a href="#build_environment">build environment</a> to use an alternative trust store for the build runtime</p>
</li>
<li>
<p>Disable the requirement for a trusted certificate</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The trust requirement can be disabled by setting <a href="https://docs.gradle.org/8.9/dsl/org.gradle.caching.http.HttpBuildCache.html#org.gradle.caching.http.HttpBuildCache:allowUntrustedServer">HttpBuildCache.isAllowUntrustedServer()</a> to <code>true</code>.
Enabling this option is a security risk, as it allows any cache server to impersonate the intended server.
It should only be used as a temporary measure or in very tightly controlled network environments.</p>
</div>
<div id="ex-allow-untrusted-cache-server" class="exampleblock">
<div class="title">Example 349. <a href="#ex-allow-untrusted-cache-server">Allow untrusted cache server</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildCache {
    remote&lt;HttpBuildCache&gt; {
        url = uri(&quot;https://example.com:8123/cache/&quot;)
        isAllowUntrustedServer = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildCache {
    remote(HttpBuildCache) {
        url = <span class="string"><span class="delimiter">'</span><span class="content">https://example.com:8123/cache/</span><span class="delimiter">'</span></span>
        allowUntrustedServer = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:build_cache_expect_continue"><a class="anchor" href="#sec:build_cache_expect_continue"></a><a class="link" href="#sec:build_cache_expect_continue">HTTP expect-continue</a></h6>
<div class="paragraph">
<p>Use of <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.2.3">HTTP Expect-Continue</a> can be enabled.
This causes upload requests to happen in two parts: first a check whether a body would be accepted, then transmission of the body if the server indicates it will accept it.</p>
</div>
<div class="paragraph">
<p>This is useful when uploading to cache servers that routinely redirect or reject upload requests,
as it avoids uploading the cache entry just to have it rejected (e.g. the cache entry is larger than the cache will allow) or redirected.
This additional check incurs extra latency when the server accepts the request, but reduces latency when the request is rejected or redirected.</p>
</div>
<div class="paragraph">
<p>Not all HTTP servers and proxies reliably implement Expect-Continue.
Be sure to check that your cache server does support it before enabling.</p>
</div>
<div class="paragraph">
<p>To enable, set <a href="https://docs.gradle.org/8.9/dsl/org.gradle.caching.http.HttpBuildCache.html#org.gradle.caching.http.HttpBuildCache:useExpectContinue">HttpBuildCache.isUseExpectContinue()</a> to <code>true</code>.</p>
</div>
<div id="ex-use-expect-continue" class="exampleblock">
<div class="title">Example 350. <a href="#ex-use-expect-continue">Use Expect-Continue</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildCache {
    remote&lt;HttpBuildCache&gt; {
        url = uri(&quot;https://example.com:8123/cache/&quot;)
        isUseExpectContinue = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildCache {
    remote(HttpBuildCache) {
        url = <span class="string"><span class="delimiter">'</span><span class="content">https://example.com:8123/cache/</span><span class="delimiter">'</span></span>
        useExpectContinue = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:build_cache_configure_use_cases"><a class="anchor" href="#sec:build_cache_configure_use_cases"></a><a class="link" href="#sec:build_cache_configure_use_cases">Configuration use cases</a></h5>
<div class="paragraph">
<p>The recommended use case for the remote build cache is that your continuous integration server populates it from clean builds while developers only load from it.
The configuration would then look as follows.</p>
</div>
<div id="ex-recommended-setup-for-ci-push-use-case" class="exampleblock">
<div class="title">Example 351. <a href="#ex-recommended-setup-for-ci-push-use-case">Recommended setup for CI push use case</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val isCiServer = System.getenv().containsKey(&quot;CI&quot;)

buildCache {
    remote&lt;HttpBuildCache&gt; {
        url = uri(&quot;https://example.com:8123/cache/&quot;)
        isPush = isCiServer
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">boolean</span> isCiServer = <span class="predefined-type">System</span>.getenv().containsKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">CI</span><span class="delimiter">&quot;</span></span>)

buildCache {
    remote(HttpBuildCache) {
        url = <span class="string"><span class="delimiter">'</span><span class="content">https://example.com:8123/cache/</span><span class="delimiter">'</span></span>
        push = isCiServer
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is also possible to configure the build cache from an <a href="#sec:using_an_init_script">init script</a>, which can be used from the command line, added to your Gradle User Home or be a part of your custom Gradle distribution.</p>
</div>
<div id="ex-init-script-to-configure-the-build-cache" class="exampleblock">
<div class="title">Example 352. <a href="#ex-init-script-to-configure-the-build-cache">Init script to configure the build cache</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">gradle.settingsEvaluated {
    buildCache {
        // vvv Your custom configuration goes here
        remote&lt;HttpBuildCache&gt; {
            url = uri(&quot;https://example.com:8123/cache/&quot;)
        }
        // ^^^ Your custom configuration goes here
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gradle.settingsEvaluated { settings -&gt;
    settings.buildCache {
        <span class="comment">// vvv Your custom configuration goes here</span>
        remote(HttpBuildCache) {
            url = <span class="string"><span class="delimiter">'</span><span class="content">https://example.com:8123/cache/</span><span class="delimiter">'</span></span>
        }
        <span class="comment">// ^^^ Your custom configuration goes here</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:build_cache_composite"><a class="anchor" href="#sec:build_cache_composite"></a><a class="link" href="#sec:build_cache_composite">Build cache, composite builds and <code>buildSrc</code></a></h5>
<div class="paragraph">
<p>Gradle&#8217;s <a href="#composite_builds">composite build feature</a> allows including other complete Gradle builds into another.
Such included builds will inherit the build cache configuration from the top level build, regardless of whether the included builds define build cache configuration themselves or not.</p>
</div>
<div class="paragraph">
<p>The build cache configuration present for any included build is effectively ignored, in favour of the top level build&#8217;s configuration.
This also applies to any <code>buildSrc</code> projects of any included builds.</p>
</div>
<div class="paragraph">
<p>The <a href="#sec:using_buildsrc"><code>buildSrc</code> directory</a> is treated as an <a href="#composite_build_intro">included build</a>, and as such it inherits the build cache configuration from the top-level build.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This configuration precedence does not apply to <a href="#included_plugin_builds">plugin builds</a> included through <code>pluginManagement</code> as these are loaded <em>before</em> the cache configuration itself.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:build_cache_setup_http_backend"><a class="anchor" href="#sec:build_cache_setup_http_backend"></a><a class="link" href="#sec:build_cache_setup_http_backend">How to set up an HTTP build cache backend</a></h4>
<div class="paragraph">
<p>Gradle provides a Docker image for a <a href="https://hub.docker.com/r/gradle/build-cache-node/">build cache node</a>, which can connect with Develocity for centralized management.
The cache node can also be used without a Develocity installation with restricted functionality.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:build_cache_implement"><a class="anchor" href="#sec:build_cache_implement"></a><a class="link" href="#sec:build_cache_implement">Implement your own Build Cache</a></h4>
<div class="paragraph">
<p>Using a different build cache backend to store build outputs (which is not covered by the built-in support for connecting to an HTTP backend) requires implementing
your own logic for connecting to your custom build cache backend.
To this end, custom build cache types can be registered via <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/caching/configuration/BuildCacheConfiguration.html#registerBuildCacheService-java.lang.Class-java.lang.Class-">BuildCacheConfiguration.registerBuildCacheService(java.lang.Class, java.lang.Class)</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://gradle.com/gradle-enterprise-solutions/build-cache/">Develocity</a> includes a high-performance, easy to install and operate, shared build cache backend.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="use_cases_cache"><a class="anchor" href="#use_cases_cache"></a><a class="link" href="#use_cases_cache">Use cases for the build cache</a></h3>
<div class="paragraph">
<p>This section covers the different use cases for Gradle’s build cache, from local-only development to caching task outputs across large teams.</p>
</div>
<div class="sect3">
<h4 id="speed_up_developer_builds_with_the_local_cache"><a class="anchor" href="#speed_up_developer_builds_with_the_local_cache"></a><a class="link" href="#speed_up_developer_builds_with_the_local_cache">Speed up developer builds with the local cache</a></h4>
<div class="paragraph">
<p>Even when used by a single developer only, the build cache can be very useful.
Gradle&#8217;s <em>incremental build</em> feature helps to avoid work that is already done, but once you re-execute a task, any previous results are forgotten.
When you are switching branches back and forth, the local results get rebuilt over and over again, even if you are building something that has already been built before.
The build cache remembers the earlier build results, and greatly reduces the need to rebuild things when they have already been built locally.
This can also extend to rebuilding different commits, like when running <code>git bisect</code>.</p>
</div>
<div class="paragraph">
<p>The local cache can also be useful when working with a project that has multiple variants, as in the case of Android projects. Each variant has a number of tasks associated with it, and some of those task variant dimensions, despite having different names, can end up producing the same output. With the local cache enabled, reuse between task variants will happen automatically when applicable.</p>
</div>
</div>
<div class="sect3">
<h4 id="share_results_between_ci_builds"><a class="anchor" href="#share_results_between_ci_builds"></a><a class="link" href="#share_results_between_ci_builds">Share results between CI builds</a></h4>
<div class="paragraph">
<p>The build cache can do more than go back-and-forth in time: it can also bridge physical distance between computers, allowing results generated on one machine to be re-used by another.
A typical first step when introducing the build cache within a team is to enable it for builds running as part of <em>continuous integration</em> only. Using a shared HTTP build cache backend (such as <a href="https://gradle.com/build-cache/">the one provided by Develocity</a>) can significantly reduce the work CI agents need to do.
This translates into faster feedback for developers, and less money spent on the CI resources.
Faster builds also mean fewer commits being part of each build, which makes debugging issues more efficient.</p>
</div>
<div class="paragraph">
<p>Beginning with the build cache on CI is a good first step as the environment on CI agents is usually more stable and predictable than developer machines.
This helps to identify any possible issues with the build that may affect cacheability.</p>
</div>
<div class="paragraph">
<p>If you are subject to audit requirements regarding the artifacts you ship to your customers you may need to disable the build cache for certain builds.
Develocity may help you with fulfilling these requirements while still using the build cache for all your builds.
It allows you to easily find out which build produced an artifact coming from the build cache via build scans.</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="img/build-cache/from-cache-origin.png" alt="from cache origin">
</div>
</div>
</div>
<div class="sect3">
<h4 id="accelerate_developer_builds_by_reusing_ci_results"><a class="anchor" href="#accelerate_developer_builds_by_reusing_ci_results"></a><a class="link" href="#accelerate_developer_builds_by_reusing_ci_results">Accelerate developer builds by reusing CI results</a></h4>
<div class="paragraph">
<p>When multiple developers work on the same project, they don&#8217;t just need to build their own changes: whenever they pull from version control, they end up having to build each other&#8217;s changes as well.
Whenever a developer is working on something independent of the pulled changes, they can safely reuse outputs already generated on CI.
Say, you&#8217;re working on module "A", and you pull in some changes to module "B" (which does not depend on your module).
If those changes were already built in CI, you can download the task outputs for module "B" from the cache instead of generating them locally.
A typical use case for this is when developers start their day, pull all changes from version control and then run their first build.</p>
</div>
<div class="paragraph">
<p>The changes don&#8217;t need to be completely independent, either; we&#8217;ll take a look at the strategies to reuse results when dependencies are involved in the section about the <a href="#normalization">different forms of normalization</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="combine_remote_results_with_local_caching"><a class="anchor" href="#combine_remote_results_with_local_caching"></a><a class="link" href="#combine_remote_results_with_local_caching">Combine remote results with local caching</a></h4>
<div class="paragraph">
<p>You can utilize both a local and a remote cache for a compound effect.
While loading results from a CI-filled remote cache helps to avoid work needed because of changes by other developers, the local cache can speed up switching branches and doing <code>git bisect</code>.
On CI machines the local cache can act as a mirror of the remote cache, significantly reducing network usage.</p>
</div>
</div>
<div class="sect3">
<h4 id="share_results_between_developers"><a class="anchor" href="#share_results_between_developers"></a><a class="link" href="#share_results_between_developers">Share results between developers</a></h4>
<div class="paragraph">
<p>Allowing developers to upload their results to a shared cache is possible, but not recommended.
Developers can make changes to task inputs or outputs while the task is executing.
They can do this unintentionally and without noticing, for example by making changes in their IDEs while a build is running.
Currently, Gradle has no good way to defend against these changes, and will simply cache whatever is in the output directory once the task is finished.
This again can lead to corrupted results being uploaded to the shared cache.
This recommendation might change when Gradle has added the necessary safeguards against unintentional modification of task inputs and outputs.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to share task output from incremental builds, i.e. non-clean builds, you have to make sure that all cacheable tasks are properly configured and implemented to deal with stale output.
There are for example annotation processors that do not clean up stale files in the corresponding classes/resources directories.
The cache is a great forcing function to fix these problems, which will also make your incremental builds much more reliable.
At the same time, until you have confidence that the incremental build behavior is flawless, only use clean builds to upload content to the cache.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build_cache_performance"><a class="anchor" href="#build_cache_performance"></a><a class="link" href="#build_cache_performance">Build cache performance</a></h3>
<div class="badge-wrapper">
    <a class="badge" href="https://dpeuniversity.gradle.com/app/courses/4fcbecbc-7cff-449a-a509-07cf70403f0c/" target="_blank">
        <span class="badge-type button--blue">LEARN</span>
        <span class="badge-text">Maintaining Optimal Gradle Build Cache Performance&nbsp;&nbsp;&nbsp;&gt;</span>
    </a>
</div>
<div class="paragraph">
<p>The sole reason to use any build cache is to make builds faster.
But how much faster can you go when using the cache?
Measuring the impact is both important and complicated, as cache performance is determined by many factors.
Performing measurements of the cache&#8217;s impact can validate the extra effort (work, infrastructure) that is required to start using the cache.
These measurements can later serve as baselines for future improvements, and to watch for signs of regressions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Proper configuration and maintenance of a build can improve caching performance in a big way.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="fully_cached_builds"><a class="anchor" href="#fully_cached_builds"></a><a class="link" href="#fully_cached_builds">Fully cached builds</a></h4>
<div class="paragraph">
<p>The most straightforward way to get a feel for what the cache can do for you is to measure the difference between a non-cached build and a <em>fully cached</em> build. This will give you the theoretical limit of how fast builds with the cache can get, if everything you&#8217;re trying to build has already been built. The easiest way to measure this is using the local cache:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clean the cache directory to avoid any hits from previous builds (<code>rm -rf $GRADLE_USER_HOME/caches/build-cache-*</code>)</p>
</li>
<li>
<p>Run the build (e.g. <code>./gradlew --build-cache clean assemble</code>), so that all the results from cacheable tasks get stored in the cache.</p>
</li>
<li>
<p>Run the build again (e.g. <code>./gradlew --build-cache clean assemble</code>); depending on your build, you should see many of the tasks being retrieved from the cache.</p>
</li>
<li>
<p>Compare the execution time for the two builds</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You may encounter a few cached tasks even in the first of the two builds, where no previously cached results should be available.
This can happen if you have tasks in your build that are configured to produce the same results from the same inputs; in such a case once one of these tasks has finished, Gradle will simply reuse its output for the rest of the tasks.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Normally, your <em>fully cached</em> build should be significantly faster than the <code>clean</code> build: this is the theoretical limit of how much time using the build cache can save on your particular build.
You usually don&#8217;t get the achievable performance gains on the first try, see <a href="#finding_problems">finding problems with task output caching</a>.
As your build logic is evolving and changing it is also important to make sure that the cache effectiveness is not regressing.
Build scans provide a detailed performance breakdown which show you how effectively your build is using the build cache:</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="img/build-cache/performance-task-execution.png" alt="performance task execution">
</div>
</div>
<div class="paragraph">
<p>Fully cached builds occur in situations when developers check out the latest from version control and then build, for example to generate the latest sources they need in their IDE.
The purpose of running most builds though is to process some new changes.
The structure of the software being built (how many modules are there, how independent are its parts etc.), and the nature of the changes themselves ("big refactor in the core of the system" vs. "small change to a unit test" etc.) strongly influence the performance gains delivered by the build cache.
As developers tend to submit different kinds of changes over time, caching performance is expected to vary with each change.
As with any cache, the impact should therefore be measured over time.</p>
</div>
<div class="paragraph">
<p>In a setup where a team uses a shared cache backend, there are two locations worth measuring cache impact at: on CI and on developer machines.</p>
</div>
</div>
<div class="sect3">
<h4 id="cache_impact_on_ci_builds"><a class="anchor" href="#cache_impact_on_ci_builds"></a><a class="link" href="#cache_impact_on_ci_builds">Cache impact on CI builds</a></h4>
<div class="paragraph">
<p>The best way to learn about the impact of caching on CI is to set up the same builds with the cache enabled and disabled, and compare the results over time. If you have a single Gradle build step that you want to enable caching for, it&#8217;s easy to compare the results using your CI system&#8217;s built-in statistical tools.</p>
</div>
<div class="paragraph">
<p>Measuring complex pipelines may require more work or external tools to collect and process measurements.
It&#8217;s important to distinguish those parts of the pipeline that caching has no effect on, for example, the time builds spend waiting in the CI system&#8217;s queue, or time taken by checking out source code from version control.</p>
</div>
<div class="paragraph">
<p>When using Develocity, you can use the <a href="https://docs.gradle.com/enterprise/export-api/">Export API</a> to access the necessary data and run your analytics.
Develocity provides much richer data compared to what can be obtained from CI servers.
For example, you can get insights into the execution of single tasks, how many tasks were retrieved from the cache, how long it took to download from the cache, the properties that were used to calculate the cache key and more.
When using your CI servers built in functions, you can use <a href="https://confluence.jetbrains.com/display/TCD10/Statistic+Charts">statistic charts</a> if you use Teamcity for your CI builds.
Most of time you will end up extracting data from your CI server via the corresponding REST API (see <a href="https://wiki.jenkins-ci.org/display/JENKINS/Remote+access+API">Jenkins remote access API</a> and <a href="https://confluence.jetbrains.com/display/TCD10/REST+API">Teamcity REST API</a>).</p>
</div>
<div class="paragraph">
<p>Typically, CI builds above a certain size include parallel sections to utilize multiple agents. With parallel pipelines you can measure the wall-clock time it takes for a set of changes to go from having been pushed to version control to being built, verified and deployed. The build cache&#8217;s effect in this case can be measured in the reduction of the time developers have to wait for feedback from CI.</p>
</div>
<div class="paragraph">
<p>You can also measure the cumulative time your build agents spent building a changeset, which will give you a sense of the amount of work the CI infrastructure has to exert. The cache&#8217;s effect here is less money spent on CI resources, as you don&#8217;t need as many CI agents to maintain the same number of changes built.</p>
</div>
<div class="paragraph">
<p>If you want to look at the measurement for the Gradle build itself you can have a look at the blog post <a href="https://blog.gradle.org/introducing-gradle-build-cache">"Introducing the build cache"</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="measuring_developer_builds"><a class="anchor" href="#measuring_developer_builds"></a><a class="link" href="#measuring_developer_builds">Measuring developer builds</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s build cache can be very useful in reducing CI infrastructure cost and feedback time, but it usually has the biggest impact when developers can reuse cached results in their local builds. This is also the hardest to quantify for a number of reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>developers run different builds</p>
</li>
<li>
<p>developers can have different hardware, or have different settings</p>
</li>
<li>
<p>developers run all kinds of other things on their machines that can slow them down</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using Develocity you can use the <a href="https://docs.gradle.com/enterprise/export-api/">Export API</a> to extract data about developer builds, too.
You can then create statistics on how many tasks were cached per developer or build.
You can even compare the times it took to execute the task vs loading it from the cache and then estimate the time saved per developer.</p>
</div>
<div class="paragraph">
<p>When using the <a href="https://gradle.com/build-cache">Develocity build cache backend</a> you should pay close attention to the hit rate in the admin UI.
A rise in the hit rate there probably indicates better usage by developers:</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="img/build-cache/cache-admin-hit-rate.png" alt="build cache hit rate">
</div>
</div>
</div>
<div class="sect3">
<h4 id="analyzing_performance_in_build_scans"><a class="anchor" href="#analyzing_performance_in_build_scans"></a><a class="link" href="#analyzing_performance_in_build_scans">Analyzing performance in build scans</a></h4>
<div class="paragraph">
<p>Build scans provide a summary of all cache operations for a build via the <em>"Build cache"</em> section of the <em>"Performance"</em> page.</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="img/build-cache/build-cache-performance.png" alt="build cache performance">
</div>
</div>
<div class="paragraph">
<p>This page details which tasks were able to be avoided by cache hits, and which missed.
It also indicates the hits and misses for the local and remote caches individually.
For remote cache operations, the time taken to transfer artifacts to and from the cache is given, along with the transfer rate.
This is particularly important for assessing the impact of network link quality on performance, as transfer times contribute to build time.</p>
</div>
</div>
<div class="sect3">
<h4 id="remote_cache_performance"><a class="anchor" href="#remote_cache_performance"></a><a class="link" href="#remote_cache_performance">Remote cache performance</a></h4>
<div class="paragraph">
<p>Improving the network link between the build and the remote cache can significantly improve build cache performance.
How to do this depends on the remote cache in use and your network environment.</p>
</div>
<div class="paragraph">
<p>The multi-node remote build cache provided by Develocity is a fast and efficient, purpose built, remote build cache.
In particular, if your development team is geographically distributed, its replication features can significantly improve performance by allowing developers to use a cache that they have a good network link to.
See the <a href="https://docs.gradle.com/enterprise/admin/current/#replication">“Build Cache Replication” section of the Develocity Admin Manual</a> for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="important_concepts"><a class="anchor" href="#important_concepts"></a><a class="link" href="#important_concepts">Important concepts</a></h3>
<div class="paragraph">
<p>How much of your build gets loaded from the cache depends on many factors.
In this section you will see some of the tools that are essential for well-cached builds.
<a href="https://gradle.com/build-scans">Build scans</a> are part of that toolchain and will be used throughout this guide.</p>
</div>
<div class="sect3">
<h4 id="build_cache_key"><a class="anchor" href="#build_cache_key"></a><a class="link" href="#build_cache_key">Build cache key</a></h4>
<div class="paragraph">
<p>Artifacts in the build cache are uniquely identified by a <a href="#sec:task_output_caching_details">build cache key</a>.
A build cache key is assigned to each cacheable task when running with the build cache enabled and is used for both loading and storing task outputs to the build cache.
The following inputs contribute to the build cache key for a task:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The task implementation</p>
</li>
<li>
<p>The task action implementations</p>
</li>
<li>
<p>The names of the output properties</p>
</li>
<li>
<p>The names and values of task inputs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Two tasks can reuse their outputs by using the build cache if their associated build cache keys are the same.</p>
</div>
</div>
<div class="sect3">
<h4 id="concepts_repeatable_task_outputs"><a class="anchor" href="#concepts_repeatable_task_outputs"></a><a class="link" href="#concepts_repeatable_task_outputs">Repeatable task outputs</a></h4>
<div class="paragraph">
<p>Assume that you have a code generator task as part of your build.
When you have a fully up to date build and you clean and re-run the code generator task on the same code base it should generate <em>exactly the same output</em>, so anything that depends on that output will stay up-to-date.</p>
</div>
<div class="paragraph">
<p>It might also be that your code generator adds some extra information to its output that doesn&#8217;t depend on its declared inputs, like a timestamp.
In such a case re-executing the task <em>will</em> result in different code being generated (because the timestamp will be updated).
Tasks that depend on the code generator&#8217;s output will need to be re-executed.</p>
</div>
<div class="paragraph">
<p>When a task is cacheable, then the very nature of task output caching makes sure that the task will have the same outputs for a given set of inputs.
Therefore, cacheable tasks should have repeatable task outputs.
If they don&#8217;t, then the result of executing the task and loading the task from the cache may be different, which can lead to hard-to-diagnose cache misses.</p>
</div>
<div class="paragraph">
<p>In some cases even well-trusted tools can produce non-repeatable outputs, and lead to cascading effects.
One example is Oracle&#8217;s Java compiler, which, <a href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=8067422">due to a bug</a>, was producing different bytecode depending on the order source files to be compiled were presented to it.
If you were using Oracle JDK 8u31 or earlier to compile code in the <code>buildSrc</code> subproject, this could lead to all of your custom tasks producing occasional cache misses, because of the difference in their classpaths (which include <code>buildSrc</code>).</p>
</div>
<div class="paragraph">
<p>The key here is that cacheable tasks should not use non-repeatable task outputs as an input.</p>
</div>
</div>
<div class="sect3">
<h4 id="stable_task_inputs"><a class="anchor" href="#stable_task_inputs"></a><a class="link" href="#stable_task_inputs">Stable task inputs</a></h4>
<div class="paragraph">
<p>Having a task repeatably produce the same output is not enough if its inputs keep changing all the time.
Such unstable inputs can be supplied directly to the task. Consider a version number that includes a timestamp being added to the jar file&#8217;s manifest:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">version = &quot;3.2-${System.currentTimeMillis()}&quot;

tasks.jar {
    manifest {
        attributes(mapOf(&quot;Implementation-Version&quot; to project.version))
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">version = <span class="string"><span class="delimiter">&quot;</span><span class="content">3.2-</span><span class="inline"><span class="inline-delimiter">${</span><span class="predefined-type">System</span>.currentTimeMillis()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>

tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>) {
    manifest {
        attributes(<span class="string"><span class="delimiter">'</span><span class="content">Implementation-Version</span><span class="delimiter">'</span></span>: project.version)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the above example the inputs for the <code>jar</code> task will be different for each build execution since this timestamp will continually change.</p>
</div>
<div class="paragraph">
<p>Another example for unstable inputs is the commit ID from version control.
Maybe your version number is generated via <code>git describe</code> (and you include it in the jar manifest as shown above).
Or maybe you include the commit hash directly in <code>version.properties</code> or a jar manifest attribute.
Either way, the outputs produced by any tasks depending on such data will only be re-usable by builds running against the exact same commit.</p>
</div>
<div class="paragraph">
<p>Another common, but less obvious source of unstable inputs is when a task consumes the output of another task which produces non-repeatable results, such as the example before of a code generator that embeds timestamps in its output.</p>
</div>
<div class="paragraph">
<p>A task can only be loaded from the cache if it has stable task inputs.
Unstable task inputs result in the task having a unique set of inputs for every build, which will always result in a cache miss.</p>
</div>
</div>
<div class="sect3">
<h4 id="normalization"><a class="anchor" href="#normalization"></a><a class="link" href="#normalization">Better reuse via input normalization</a></h4>
<div class="paragraph">
<p>Having stable inputs is crucial for cacheable tasks.
However, achieving byte for byte identical inputs for each task can be challenging.
In some cases sanitizing the output of a task to remove unnecessary information can be a good approach, but this also means that a task&#8217;s output can only be normalized for a single purpose.</p>
</div>
<div class="paragraph">
<p>This is where <a href="#sec:configure_input_normalization">input normalization</a> comes into play.
Input normalization is used by Gradle to determine if two task inputs are <em>essentially</em> the same.
Gradle uses normalized inputs when doing up-to-date checks and when determining if a cached result can be re-used instead of executing the task.
As input normalization is declared by the task <em>consuming</em> the data as input, different tasks can define different ways to normalize the same data.</p>
</div>
<div class="paragraph">
<p>When it comes to file inputs, Gradle can normalize the path of the files as well as their contents.</p>
</div>
<div class="sect4">
<h5 id="relocatability"><a class="anchor" href="#relocatability"></a><a class="link" href="#relocatability">Path sensitivity and relocatability</a></h5>
<div class="paragraph">
<p>When sharing cached results between computers, it&#8217;s rare that everyone runs the build from the exact same location on their computers.
To allow cached results to be shared even when builds are executed from different root directories, Gradle needs to understand which inputs can be relocated and which cannot.</p>
</div>
<div class="paragraph">
<p>Tasks having files as inputs can declare the parts of a file&#8217;s path what are essential to them: this is called the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/PathSensitive.html"><em>path sensitivity</em></a> of the input.
Task properties declared with <code>ABSOLUTE</code> path sensitivity are considered non-relocatable.
This is the default for properties not declaring path sensitivity, too.</p>
</div>
<div class="paragraph">
<p>For example, the class files produced by the Java compiler are dependent on the file names of the Java source files: renaming the source files with public classes in them would fail the build.
Though moving the files around wouldn&#8217;t have an effect on the result of the compilation, for incremental compilation the <code>JavaCompile</code> task relies on the relative path to find other classes in the same package.
Therefore, the path sensitivity for the sources of the <code>JavaCompile</code> task is <code>RELATIVE</code>.
Because of this only the normalized (relative) paths of the Java source files are considered as inputs to the <code>JavaCompile</code> task.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Java compiler only respects the package declaration in the Java source files, not the relative path of the sources.
As a consequence, path sensitivity for Java sources is <code>NAME_ONLY</code> and not <code>RELATIVE</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="content_normalization"><a class="anchor" href="#content_normalization"></a><a class="link" href="#content_normalization">Content normalization</a></h5>
<div class="sect5">
<h6 id="compile_avoidance"><a class="anchor" href="#compile_avoidance"></a><a class="link" href="#compile_avoidance">Compile avoidance for Java</a></h6>
<div class="paragraph">
<p>When it comes to the dependencies of a <code>JavaCompile</code> task (i.e. its <em>compile classpath),</em> only changes to the Application Binary Interface (ABI) of these dependencies require compilation to be executed.
Gradle has a deep understanding of what a compile classpath is and uses a sophisticated normalization strategy for it.
Task outputs can be re-used as long as the ABI of the classes on the compile classpath stays the same.
This enables Gradle to avoid Java compilation by using incremental builds, or load results from the cache that were produced by different (but ABI-compatible) versions of dependencies.
For more information on compile avoidance see the <a href="java_plugin.html#sec:java_compile_avoidance">corresponding section</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="runtime_classpath"><a class="anchor" href="#runtime_classpath"></a><a class="link" href="#runtime_classpath">Runtime classpath normalization</a></h6>
<div class="paragraph">
<p>Similar to compile avoidance, Gradle also understands the concept of a runtime classpath, and uses tailored input normalization to avoid running e.g. tests.
For runtime classpaths Gradle inspects the contents of jar files and ignores the timestamps and order of the entries in the jar file.
This means that a rebuilt jar file would be considered the same runtime classpath input.
For details on what level of understanding Gradle has for detecting changes to classpaths and what is considered as a classpath see <a href="#sec:task_input_using_classpath_annotations">this section</a>.</p>
</div>
<div class="sect6">
<h7 id="filter_runtime_classpath"><a class="anchor" href="#filter_runtime_classpath"></a><a class="link" href="#filter_runtime_classpath">Filtering runtime classpaths</a></h7>
<div class="paragraph">
<p>For a runtime classpath it is possible to provide better insights to Gradle which files are essential to the input by <a href="#sec:configure_input_normalization">configuring input normalization</a>.</p>
</div>
<div class="paragraph">
<p>Given that you want to add a file <code>build-info.properties</code> to all your produced jar files which contains volatile information about the build, e.g. the timestamp when the build started or some ID to identify the CI job that published the artifact.
This file is only used for auditing purposes, and has no effect on the outcome of running tests.
Nonetheless, this file is part of the runtime classpath for the <code>test</code> task. Since the file changes on every build invocation, tests cannot be cached effectively.
To fix this you can ignore <code>build-info.properties</code> on any runtime classpath by adding the following configuration to the build script in the <em>consuming</em> project:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">normalization {
    runtimeClasspath {
        ignore(&quot;build-info.properties&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">normalization {
    runtimeClasspath {
        ignore <span class="string"><span class="delimiter">'</span><span class="content">build-info.properties</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If adding such a file to your jar files is something you do for all of the projects in your build, and you want to filter this file for all consumers, you may wrap the configurations described above in an <code>allprojects {}</code> or <code>subprojects {}</code> block in the root build script.</p>
</div>
<div class="paragraph">
<p>The effect of this configuration would be that changes to <code>build-info.properties</code> would be ignored for both up-to-date checks and task output caching.
All runtime classpath inputs for all tasks in the project where this configuration has been made will be affected.
This will not change the runtime behavior of the <code>test</code> task&#8201;&#8212;&#8201;i.e. any test is still able to load <code>build-info.properties</code>, and the runtime classpath stays the same as before.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="concepts_overlapping_outputs"><a class="anchor" href="#concepts_overlapping_outputs"></a><a class="link" href="#concepts_overlapping_outputs">The case against overlapping outputs</a></h4>
<div class="paragraph">
<p>When two tasks write to the same output directory or output file, it is difficult for Gradle to determine which output belongs to which task.
There are many edge cases, and executing the tasks in parallel cannot be done safely.
For the same reason, Gradle cannot remove <a href="#sec:stale_task_outputs">stale output files</a> for these tasks.
Tasks that have discrete, non-overlapping outputs can always be handled in a safe fashion by Gradle.
For the aforementioned reasons, task output caching is automatically disabled for tasks whose output directories overlap with another task.</p>
</div>
<div class="paragraph">
<p>Build scans show tasks where caching was disabled due to overlapping outputs in the timeline:</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="img/build-cache/overlapping-outputs-timeline.png" alt="overlapping outputs timeline">
</div>
</div>
</div>
<div class="sect3">
<h4 id="reuse_of_outputs_between_different_tasks"><a class="anchor" href="#reuse_of_outputs_between_different_tasks"></a><a class="link" href="#reuse_of_outputs_between_different_tasks">Reuse of outputs between different tasks</a></h4>
<div class="paragraph">
<p>Some builds exhibit a surprising characteristic: even when executed against an empty cache, they produce tasks loaded from cache. How is this possible? Rest assured that this is completely normal.</p>
</div>
<div class="paragraph">
<p>When considering task outputs, Gradle only cares about the inputs to the task: the task type itself, input files and parameters etc., but it doesn&#8217;t care about the task&#8217;s name or which project it can be found in.
Running <code>javac</code> will produce the same output regardless of the name of the <code>JavaCompile</code> task that invoked it.
If your build includes two tasks that share every input, the one executing later will be able to reuse the output produced by the first.</p>
</div>
<div class="paragraph">
<p>Having two tasks in the same build that do the same might sound like a problem to fix, but it is not necessarily something bad.
For example, the Android plugin creates several tasks for each variant of the project; some of those tasks will potentially do the same thing.
These tasks can safely reuse each other&#8217;s outputs.</p>
</div>
<div class="paragraph">
<p>As <a href="#share_results_between_ci_builds">discussed previously</a>, you can use Develocity to diagnose the source build of these unexpected cache-hits.</p>
</div>
</div>
<div class="sect3">
<h4 id="non_cacheable_tasks"><a class="anchor" href="#non_cacheable_tasks"></a><a class="link" href="#non_cacheable_tasks">Non-cacheable tasks</a></h4>
<div class="paragraph">
<p>You&#8217;ve seen quite a bit about cacheable tasks, which implies there are non-cacheable ones, too. If caching task outputs is as awesome as it sounds, why not cache every task?</p>
</div>
<div class="paragraph">
<p>There are tasks that are definitely worth caching: tasks that do complex, repeatable processing and produce moderate amounts of output. Compilation tasks are usually ideal candidates for caching.
At the other end of the spectrum lie I/O-heavy tasks, like <code>Copy</code> and <code>Sync</code>. Moving files around locally typically cannot be sped up by copying them from a cache.
Caching those tasks would even waste good resources by storing all those redundant results in the cache.</p>
</div>
<div class="paragraph">
<p>Most tasks are either obviously worth caching, or obviously not. For those in-between a good rule of thumb is to see if downloading results would be significantly faster than producing them locally.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching_java_projects"><a class="anchor" href="#caching_java_projects"></a><a class="link" href="#caching_java_projects">Caching Java projects</a></h3>
<div class="paragraph">
<p>As of Gradle 4.0, the build tool fully supports caching plain Java projects.
Built-in tasks for compiling, testing, documenting and checking the quality of Java code support the build cache out of the box.</p>
</div>
<div class="sect3">
<h4 id="java_compilation"><a class="anchor" href="#java_compilation"></a><a class="link" href="#java_compilation">Java compilation</a></h4>
<div class="paragraph">
<p>Caching Java compilation makes use of Gradle&#8217;s deep understanding of compile classpaths.
The mechanism <a href="#compile_avoidance">avoids recompilation</a> when dependencies change in a way that doesn&#8217;t affect their application binary interfaces (ABI).
Since the cache key is only influenced by the ABI of dependencies (and not by their implementation details like private types and method bodies), task output caching can also reuse compiled classes if they were produced by the same sources and ABI-equivalent dependencies.</p>
</div>
<div class="paragraph">
<p>For example, take a project with two modules: an application depending on a library.
Suppose the latest version is already built by CI and uploaded to the shared cache.
If a developer now modifies a method&#8217;s body in the library, the library will need to be rebuilt on their computer. But they will be able to load the compiled classes for the application from the shared cache. Gradle can do this because the library used to compile the application on CI, and the modified library available locally share the same ABI.</p>
</div>
<div class="sect4">
<h5 id="annotation_processors"><a class="anchor" href="#annotation_processors"></a><a class="link" href="#annotation_processors">Annotation processors</a></h5>
<div class="paragraph">
<p>Compile avoidance works out of the box.
There is one caveat though: when using annotation processors, Gradle uses the annotation processor classpath as an input.
Unlike most compile dependencies, in which only the ABI influences compilation, the <em>implementation</em> of annotation processors must be considered as an input to the compiler. For this reason Gradle will treat annotation processors as a <em>runtime</em> classpath, meaning less <a href="#runtime_classpath">input normalization</a> is taking place there.
If Gradle detects an annotation processor on the compile classpath, the annotation processor classpath defaults to the compile classpath when not explicitly set, which in turn means the entire compile classpath is treated as a runtime classpath input.</p>
</div>
<div class="paragraph">
<p>For the example above this would mean the ABI extracted from the compile classpath would be unchanged, but the annotation processor classpath (because it&#8217;s not treated with compile avoidance) would be different. Ultimately, the developer would end up having to recompile the application.</p>
</div>
<div class="paragraph">
<p>The easiest way to avoid this performance penalty is to not use annotation processors.
However, if you need to use them, make sure you set the annotation processor classpath explicitly to include only the libraries needed for annotation processing.
The <a href="java_plugin.html#sec:java_compile_avoidance">section on Java compile avoidance</a> describes how to do this.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Some common Java dependencies (such as Log4j 2.x) come bundled with annotation processors.
If you use these dependencies, but do not leverage the features of the bundled annotation processors, it&#8217;s best to disable annotation processing entirely.
This can be done by setting the annotation processor classpath to an empty set.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="unit_test_execution"><a class="anchor" href="#unit_test_execution"></a><a class="link" href="#unit_test_execution">Unit test execution</a></h4>
<div class="paragraph">
<p>The <code>Test</code> task used for test execution for JVM languages employs <a href="#runtime_classpath">runtime classpath normalization</a> for its classpath.
This means that changes to order and timestamps in jars on the test classpath will not cause the task to be out-of-date or change the build cache key.
For achieving <a href="#stable_task_inputs">stable task inputs</a> you can also wield the power of <a href="#filter_runtime_classpath">filtering the runtime classpath</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="integration_test_execution"><a class="anchor" href="#integration_test_execution"></a><a class="link" href="#integration_test_execution">Integration test execution</a></h4>
<div class="paragraph">
<p>Unit tests are easy to cache as they normally have no external dependencies.
For integration tests the situation can be quite different, as they can depend on a variety of inputs outside of the test and production code.
These external factors can be for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>operating system type and version,</p>
</li>
<li>
<p>external tools being installed for the tests,</p>
</li>
<li>
<p>environment variables and Java system properties,</p>
</li>
<li>
<p>other services being up and running,</p>
</li>
<li>
<p>a distribution of the software under test.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You need to be careful to declare these additional inputs for your integration test in order to avoid incorrect cache hits.
For example, declaring the operating system in use by Gradle as an input to a <code>Test</code> task called <code>integTest</code> would work as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.integTest {
    inputs.property(&quot;operatingSystem&quot;) {
        System.getProperty(&quot;os.name&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">integTest</span><span class="delimiter">'</span></span>) {
    inputs.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">operatingSystem</span><span class="delimiter">&quot;</span></span>) {
        <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">os.name</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="archives_as_inputs"><a class="anchor" href="#archives_as_inputs"></a><a class="link" href="#archives_as_inputs">Archives as inputs</a></h5>
<div class="paragraph">
<p>It is common for the integration tests to depend on your packaged application.
If this happens to be a zip or tar archive, then adding it as an input to the integration test task may lead to cache misses.
This is because, as described in <a href="#concepts_repeatable_task_outputs">repeatable task outputs</a>, rebuilding an archive often changes the metadata in the archive.
You can depend on the exploded contents of the archive instead.
See also the section on dealing with <a href="#volatile_outputs">non-repeatable outputs</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="dealing_with_file_paths"><a class="anchor" href="#dealing_with_file_paths"></a><a class="link" href="#dealing_with_file_paths">Dealing with file paths</a></h5>
<div class="paragraph">
<p>You will probably pass some information from the build environment to your integration test tasks by using system properties.
Passing absolute paths will break <a href="#relocatability">relocatability</a> of the integration test task.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Don't do this! Breaks relocatability!
tasks.integTest {
    systemProperty(&quot;distribution.location&quot;, layout.buildDirectory.dir(&quot;dist&quot;).get().asFile.absolutePath)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Don't do this! Breaks relocatability!</span>
tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">integTest</span><span class="delimiter">'</span></span>) {
    systemProperty <span class="string"><span class="delimiter">&quot;</span><span class="content">distribution.location</span><span class="delimiter">&quot;</span></span>, layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">dist</span><span class="delimiter">'</span></span>).get().asFile.absolutePath
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Instead of adding the absolute path directly as a system property, it is possible to add an
annotated <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/process/CommandLineArgumentProvider.html">CommandLineArgumentProvider</a> to the <code>integTest</code> task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class DistributionLocationProvider : CommandLineArgumentProvider {  // <b class="conum">(1)</b>
    @get:InputDirectory
    @get:PathSensitive(PathSensitivity.RELATIVE)  // <b class="conum">(2)</b>
    abstract val distribution: DirectoryProperty

    override fun asArguments(): Iterable&lt;String&gt; =
        listOf(&quot;-Ddistribution.location=${distribution.get().asFile.absolutePath}&quot;)  // <b class="conum">(3)</b>
}

tasks.integTest {
    jvmArgumentProviders.add(
        objects.newInstance&lt;DistributionLocationProvider&gt;().apply {  // <b class="conum">(4)</b>
            distribution = layout.buildDirectory.dir(&quot;dist&quot;)
        }
    )
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">DistributionLocationProvider</span> <span class="directive">implements</span> CommandLineArgumentProvider {  // <b class="conum">(1)</b>
    <span class="annotation">@InputDirectory</span>
    <span class="annotation">@PathSensitive</span>(PathSensitivity.RELATIVE)  // <b class="conum">(2)</b>
    <span class="directive">abstract</span> DirectoryProperty getDistribution()

    <span class="annotation">@Override</span>
    <span class="predefined-type">Iterable</span>&lt;<span class="predefined-type">String</span>&gt; asArguments() {
        [<span class="string"><span class="delimiter">&quot;</span><span class="content">-Ddistribution.location=</span><span class="inline"><span class="inline-delimiter">${</span>distribution.get().asFile.absolutePath<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>]  // <b class="conum">(3)</b>
    }
}

tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">integTest</span><span class="delimiter">'</span></span>) {
    jvmArgumentProviders.add(
        objects.newInstance(DistributionLocationProvider).tap {  // <b class="conum">(4)</b>
            distribution = layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">dist</span><span class="delimiter">'</span></span>)
        }
    )
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Create a class implementing <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/process/CommandLineArgumentProvider.html"><code>CommandLineArgumentProvider</code></a>.</p>
</li>
<li>
<p>Declare the inputs and outputs with the corresponding path sensitivity.</p>
</li>
<li>
<p><code>asArguments</code> needs to return the JVM arguments passing the desired system properties to the test JVM.</p>
</li>
<li>
<p>Add an instance of the newly created class as JVM argument provider to the integration test task.<sup class="footnote" id="_footnote_managedTypes">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup></p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="ignoring_system_properties"><a class="anchor" href="#ignoring_system_properties"></a><a class="link" href="#ignoring_system_properties">Ignoring system properties</a></h5>
<div class="paragraph">
<p>It may be necessary to ignore some system properties as inputs as they do not influence the outcome of the integration tests.
In order to do so, add a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/process/CommandLineArgumentProvider.html">CommandLineArgumentProvider</a> to the <code>integTest</code> task:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class CiEnvironmentProvider : CommandLineArgumentProvider {
    @get:Internal  // <b class="conum">(1)</b>
    abstract val agentNumber: Property&lt;String&gt;

    override fun asArguments(): Iterable&lt;String&gt; =
        listOf(&quot;-DagentNumber=${agentNumber.get()}&quot;)  // <b class="conum">(2)</b>
}

tasks.integTest {
    jvmArgumentProviders.add(
        objects.newInstance&lt;CiEnvironmentProvider&gt;().apply {  // <b class="conum">(3)</b>
            agentNumber = providers.environmentVariable(&quot;AGENT_NUMBER&quot;).orElse(&quot;1&quot;)
        }
    )
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">CiEnvironmentProvider</span> <span class="directive">implements</span> CommandLineArgumentProvider {
    <span class="annotation">@Internal</span>  // <b class="conum">(1)</b>
    <span class="directive">abstract</span> Property&lt;<span class="predefined-type">String</span>&gt; getAgentNumber()

    <span class="annotation">@Override</span>
    <span class="predefined-type">Iterable</span>&lt;<span class="predefined-type">String</span>&gt; asArguments() {
        [<span class="string"><span class="delimiter">&quot;</span><span class="content">-DagentNumber=</span><span class="inline"><span class="inline-delimiter">${</span>agentNumber.get()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>]  // <b class="conum">(2)</b>
    }
}

tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">integTest</span><span class="delimiter">'</span></span>) {
    jvmArgumentProviders.add(
        objects.newInstance(CiEnvironmentProvider).tap {  // <b class="conum">(3)</b>
            agentNumber = providers.environmentVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">AGENT_NUMBER</span><span class="delimiter">&quot;</span></span>).orElse(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
        }
    )
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>@Internal</code> means that this property does not influence the output of the integration tests.</p>
</li>
<li>
<p>The system properties for the actual test execution.</p>
</li>
<li>
<p>Add an instance of the newly created class as JVM argument provider to the integration test task.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching_android_projects"><a class="anchor" href="#caching_android_projects"></a><a class="link" href="#caching_android_projects">Caching Android projects</a></h3>
<div class="paragraph">
<p>While it is true that Android uses the Java toolchain as its foundation, there are nevertheless some significant differences from pure Java projects; these differences impact task cacheability.
This is even more true for Android projects that include Kotlin source code (and therefore use the <code>kotlin-android</code> plugin).</p>
</div>
<div class="sect3">
<h4 id="disambiguation"><a class="anchor" href="#disambiguation"></a><a class="link" href="#disambiguation">Disambiguation</a></h4>
<div class="paragraph">
<p>This guide is about Gradle’s build cache, but you may have also heard about the <a href="https://developer.android.com/studio/build/build-cache">Android build cache</a>.
These are different things.
The Android cache is internal to certain tasks in the Android plugin, and will eventually be removed in favor of native Gradle support.</p>
</div>
</div>
<div class="sect3">
<h4 id="why_use_the_build_cache"><a class="anchor" href="#why_use_the_build_cache"></a><a class="link" href="#why_use_the_build_cache">Why use the build cache?</a></h4>
<div class="paragraph">
<p>The build cache can <em>significantly</em> improve build performance for Android projects, in many cases by 30-40%.
Many of the compilation and assembly tasks provided by the Android Gradle Plugin are cacheable, and more are made so with each new iteration.</p>
</div>
<div class="sect4">
<h5 id="faster_ci_builds"><a class="anchor" href="#faster_ci_builds"></a><a class="link" href="#faster_ci_builds">Faster CI builds</a></h5>
<div class="paragraph">
<p>CI builds benefit particularly from the build cache.
A typical CI build starts with a <code>clean</code>, which means that pre-existing build outputs are deleted and none of the tasks that make up the build will be <code>UP-TO-DATE</code>.
However, it is likely that many of those tasks will have been run with exactly the same inputs in a prior CI build, populating the build cache; the outputs from those prior runs can safely be reused, resulting in dramatic build performance improvements.</p>
</div>
</div>
<div class="sect4">
<h5 id="reusing_ci_builds_for_local_development"><a class="anchor" href="#reusing_ci_builds_for_local_development"></a><a class="link" href="#reusing_ci_builds_for_local_development">Reusing CI builds for local development</a></h5>
<div class="paragraph">
<p>When you sign into work at the start of your day, it’s not unusual for your first task to be pulling the main branch and then running a build (Android Studio will probably do the latter, whether you ask it to or not).
Assuming all merges to main are built on CI (a best practice!), you can expect this first local build of the day to enjoy a larger-than-typical benefit with Gradle’s <em>remote cache</em>.
CI already built this commit&#8201;&#8212;&#8201;why should you re-do that work?</p>
</div>
</div>
<div class="sect4">
<h5 id="switching_branches"><a class="anchor" href="#switching_branches"></a><a class="link" href="#switching_branches">Switching branches</a></h5>
<div class="paragraph">
<p>During local development, it is not uncommon to switch branches several times per day.
This defeats <a href="#incremental_build">incremental build</a> (i.e., <code>UP-TO-DATE</code> checks), but this issue is mitigated via use of the local build cache.
You might run a build on Branch A, which will populate the local cache.
You then switch to Branch B to conduct a code review, help a colleague, or address feedback on an open PR.
You then switch back to Branch A to continue your original work.
When you next build, all of the outputs previously built while working on Branch A can be reused from the cache, saving potentially a lot of time.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the_android_gradle_plugin_and_the_gradle_build_tool"><a class="anchor" href="#the_android_gradle_plugin_and_the_gradle_build_tool"></a><a class="link" href="#the_android_gradle_plugin_and_the_gradle_build_tool">The Android Gradle Plugin and the Gradle Build Tool</a></h4>
<div class="paragraph">
<p>The first thing you should always do when working to optimize your build is ensure you’re on the latest stable, supported versions of the Android Gradle Plugin and the Gradle Build Tool.
At the time of writing, they are 3.3.0 and 5.0, respectively.
Each new version of these tools includes many performance improvements, not least of which is to the build cache.</p>
</div>
</div>
<div class="sect3">
<h4 id="java_and_kotlin_compilation"><a class="anchor" href="#java_and_kotlin_compilation"></a><a class="link" href="#java_and_kotlin_compilation">Java and Kotlin compilation</a></h4>
<div class="paragraph">
<p>The <a href="#java_compilation">discussion</a> above in “Caching Java projects” is equally relevant here, with the caveat that, for projects that include Kotlin source code, the Kotlin compiler does not currently support <a href="java_plugin.html#sec:java_compile_avoidance">compile avoidance</a> in the way that the Java compiler does.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotation_processors_and_kotlin"><a class="anchor" href="#annotation_processors_and_kotlin"></a><a class="link" href="#annotation_processors_and_kotlin">Annotation processors and Kotlin</a></h4>
<div class="paragraph">
<p>The <a href="#annotation_processors">advice above</a> for pure Java projects also applies to Android projects.
However, if you are using annotation processors (such as Dagger2 or Butterknife) in conjunction with Kotlin and the kotlin-kapt plugin, you should know that before Kotlin 1.3.30 kapt <a href="https://youtrack.jetbrains.com/issue/KT-27675">was not cached by default</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://blog.jetbrains.com/kotlin/2018/01/kotlin-1-2-20-is-out/">You can opt into it</a> (which is recommended) by adding the following to build scripts:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManager.withPlugin(&quot;kotlin-kapt&quot;) {
    configure&lt;KaptExtension&gt; { useBuildCache = true }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins.withId(<span class="string"><span class="delimiter">&quot;</span><span class="content">kotlin-kapt</span><span class="delimiter">&quot;</span></span>) {
    kapt.useBuildCache = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="unit_test_execution_2"><a class="anchor" href="#unit_test_execution_2"></a><a class="link" href="#unit_test_execution_2">Unit test execution</a></h4>
<div class="paragraph">
<p>Like unit tests in a pure Java project, the equivalent test task in an Android project (<code>AndroidUnitTest</code>) is also cacheable since Android Gradle Plugin 3.6.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="instrumented_test_execution_i_e_espresso_tests"><a class="anchor" href="#instrumented_test_execution_i_e_espresso_tests"></a><a class="link" href="#instrumented_test_execution_i_e_espresso_tests">Instrumented test execution (i.e., Espresso tests)</a></h4>
<div class="paragraph">
<p>Android instrumented tests (<code>DeviceProviderInstrumentTestTask</code>), often referred to as “Espresso” tests, are also not cacheable.
The Google Android team is also working to make such tests cacheable.
Please see <a href="https://issuetracker.google.com/issues/115873051">this issue</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="lint"><a class="anchor" href="#lint"></a><a class="link" href="#lint">Lint</a></h4>
<div class="paragraph">
<p>Users of Android’s <code>Lint</code> task are well aware of the heavy performance penalty they pay for using it, but also know that it is indispensable for finding common issues in Android projects.
Currently, this task is not cacheable.
This task is planned to be cacheable with the release of Android Gradle Plugin 3.5.
This is another reason to always use the latest version of the Android plugin!</p>
</div>
</div>
<div class="sect3">
<h4 id="the_fabric_plugin_and_crashlytics"><a class="anchor" href="#the_fabric_plugin_and_crashlytics"></a><a class="link" href="#the_fabric_plugin_and_crashlytics">The Fabric Plugin and Crashlytics</a></h4>
<div class="paragraph">
<p>The <a href="https://docs.fabric.io/android/fabric/overview.html">Fabric</a> plugin, which is used to integrate the Crashlytics crash-reporting tool (among others), is very popular, yet imposes some hefty performance penalties during the build process.
This is due to the need for each version of your app to have a unique identifier so that it can be identified in the Crashlytics dashboard.
In practice, the default behavior of Crashlytics is to treat “each version” as synonymous with “each build”.
This defeats <a href="#incremental_build">incremental build</a>, because each build will be unique.
It also breaks the cacheability of certain tasks in the build, and for the same reason.
This can be fixed by simply disabling Crashlytics in “debug” builds.
You may find instructions for that in the <a href="https://docs.fabric.io/android/crashlytics/build-tools.html">Crashlytics documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The fix described in the referenced documentation does not work directly if you are using the Kotlin DSL; see below for the workaround.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="kotlin_dsl"><a class="anchor" href="#kotlin_dsl"></a><a class="link" href="#kotlin_dsl">Kotlin DSL</a></h5>
<div class="paragraph">
<p>The fix described in the referenced documentation does not work directly if you are using the Kotlin DSL; this is due to incompatibilities between that Kotlin DSL and the Fabric plugin.
There is a simple workaround for this, based on <a href="#using_a_groovy_script">this advice</a> from the Kotlin DSL primer.</p>
</div>
<div class="paragraph">
<p>Create a file, <code>fabric.gradle</code>, in the module where you apply the <code>io.fabric</code> plugin. This file (known as a script plugin), should have the following contents:</p>
</div>
<div class="listingblock">
<div class="title">fabric.gradle</div>
<div class="content">
<pre>plugins.withId("com.android.application") { // or "com.android.library"
    android.buildTypes.debug.ext.enableCrashlytics = false
}</pre>
</div>
</div>
<div class="paragraph">
<p>And then, in the module’s <code>build.gradle.kts</code> file, apply this script plugin:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre>apply(from = "fabric.gradle")</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="debugging_and_diagnosing_cache_misses"><a class="anchor" href="#debugging_and_diagnosing_cache_misses"></a><a class="link" href="#debugging_and_diagnosing_cache_misses">Debugging and diagnosing cache misses</a></h3>
<div class="paragraph">
<p>To make the most of task output caching, it is important that any necessary inputs to your tasks are specified correctly, while at the same time avoiding unneeded inputs.
Failing to specify an input that affects the task&#8217;s outputs can result in incorrect builds, while needlessly specifying inputs that do not affect the task&#8217;s output can cause cache misses.</p>
</div>
<div class="paragraph">
<p>This chapter is about finding out why a cache miss happened.
If you have a cache hit which you didn&#8217;t expect we suggest to declare whatever change you expected to trigger the cache miss as an input to the task.</p>
</div>
<div class="sect3">
<h4 id="finding_problems"><a class="anchor" href="#finding_problems"></a><a class="link" href="#finding_problems">Finding problems with task output caching</a></h4>
<div class="paragraph">
<p>Below we describe a step-by-step process that should help shake out any problems with caching in your build.</p>
</div>
<div class="sect4">
<h5 id="ensure_incremental_build_works"><a class="anchor" href="#ensure_incremental_build_works"></a><a class="link" href="#ensure_incremental_build_works">Ensure incremental build works</a></h5>
<div class="paragraph">
<p>First, make sure your build does the right thing without the cache.
Run a build twice without enabling the Gradle build cache.
The expected outcome is that all actionable tasks that produce file outputs are up-to-date.
You should see something like this on the command-line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew clean --quiet <b class="conum">(1)</b>
$ ./gradlew assemble <b class="conum">(2)</b>

BUILD SUCCESSFUL
4 actionable tasks: 4 executed

$ ./gradlew assemble <b class="conum">(3)</b>

BUILD SUCCESSFUL
4 actionable tasks: 4 up-to-date</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Make sure we start without any leftover results by running <code>clean</code> first.</p>
</li>
<li>
<p>We are assuming your build is represented by running the <code>assemble</code> task in these examples, but you can substitute whatever tasks make sense for your build.</p>
</li>
<li>
<p>Run the build again without running <code>clean</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Tasks that have no outputs or no inputs will always be executed, but that shouldn&#8217;t be a problem.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the methods as described below to <a href="#diagnosing_cache_miss">diagnose</a> and <a href="#common-problems">fix</a> tasks that should be up-to-date but aren&#8217;t.
If you find a task which is out of date, but no cacheable tasks depends on its outcome, then you don&#8217;t have to do anything about it.
The goal is to achieve <a href="#stable_task_inputs">stable task inputs</a> for cacheable tasks.</p>
</div>
</div>
<div class="sect4">
<h5 id="in-place_caching_test"><a class="anchor" href="#in-place_caching_test"></a><a class="link" href="#in-place_caching_test">In-place caching with the local cache</a></h5>
<div class="paragraph">
<p>When you are happy with the up-to-date performance then you can repeat the experiment above, but this time with a clean build, and the build cache turned on.
The goal with clean builds and the build cache turned on is to retrieve all cacheable tasks from the cache.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
When running this test make sure that you have no <code>remote</code> cache configured, and storing in the <code>local</code> cache is enabled.
These are the default settings.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This would look something like this on the command-line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ rm -rf ~/.gradle/caches/build-cache-1 <b class="conum">(1)</b>
$ ./gradlew clean --quiet <b class="conum">(2)</b>
$ ./gradlew assemble --build-cache <b class="conum">(3)</b>

BUILD SUCCESSFUL
4 actionable tasks: 4 executed

$ ./gradlew clean --quiet <b class="conum">(4)</b>
$ ./gradlew assemble --build-cache <b class="conum">(5)</b>

BUILD SUCCESSFUL
4 actionable tasks: 1 executed, 3 from cache</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We want to start with an empty local cache.</p>
</li>
<li>
<p>Clean the project to remove any unwanted leftovers from previous builds.</p>
</li>
<li>
<p>Build it once to let it populate the cache.</p>
</li>
<li>
<p>Clean the project again.</p>
</li>
<li>
<p>Build it again: this time everything cacheable should load from the just populated cache.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You should see all cacheable tasks loaded from cache, while non-cacheable tasks should be executed.</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="img/build-cache/fully-cached-task-execution.png" alt="fully cached task execution">
</div>
</div>
<div class="paragraph">
<p>Again, use the below methods to <a href="#diagnosing_cache_miss">diagnose</a> and <a href="#common-problems">fix</a> cacheability issues.</p>
</div>
</div>
<div class="sect4">
<h5 id="caching_relocation_test"><a class="anchor" href="#caching_relocation_test"></a><a class="link" href="#caching_relocation_test">Testing cache relocatability</a></h5>
<div class="paragraph">
<p>Once everything loads properly while building the same checkout with the local cache enabled, it&#8217;s time to see if there are any <em>relocation problems.</em>
A task is considered <em>relocatable</em> if its output can be reused when the task is executed in a different location.
(More on this in <a href="#relocatability">path sensitivity and relocatability</a>.)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Tasks that should be relocatable but aren&#8217;t are usually a result of absolute paths being present among the task&#8217;s inputs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To discover these problems, first check out the same commit of your project in two different directories on your machine.
For the following example let&#8217;s assume we have a checkout in <code>\~/checkout-1</code> and <code>\~/checkout-2</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Like with the previous test, you should have no <code>remote</code> cache configured, and storing in the <code>local</code> cache should be enabled.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>$ rm -rf ~/.gradle/caches/build-cache-1 <b class="conum">(1)</b>
$ cd ~/checkout-1 <b class="conum">(2)</b>
$ ./gradlew clean --quiet <b class="conum">(3)</b>
$ ./gradlew assemble --build-cache <b class="conum">(4)</b>

BUILD SUCCESSFUL
4 actionable tasks: 4 executed

$ cd ~/checkout-2 <b class="conum">(5)</b>
$ ./gradlew clean --quiet <b class="conum">(6)</b>
$ ./gradlew clean assemble --build-cache <b class="conum">(7)</b>

BUILD SUCCESSFUL
4 actionable tasks: 1 executed, 3 from cache</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Remove all entries in the local cache first.</p>
</li>
<li>
<p>Go to the first checkout directory.</p>
</li>
<li>
<p>Clean the project to remove any unwanted leftovers from previous builds.</p>
</li>
<li>
<p>Run a build to populate the cache.</p>
</li>
<li>
<p>Go to the other checkout directory.</p>
</li>
<li>
<p>Clean the project again.</p>
</li>
<li>
<p>Run a build again.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You should see the exact same results as you saw with the previous <a href="#in-place_caching_test">in place caching test</a> step.</p>
</div>
</div>
<div class="sect4">
<h5 id="cross_platform_tests"><a class="anchor" href="#cross_platform_tests"></a><a class="link" href="#cross_platform_tests">Cross-platform tests</a></h5>
<div class="paragraph">
<p>If your build passes the <a href="#caching_relocation_test">relocation test</a>, it is in good shape already.
If your build requires support for multiple platforms, it is best to see if the required tasks get reused between platforms, too.
A typical example of cross-platform builds is when CI runs on Linux VMs, while developers use macOS or Windows, or a different variety or version of Linux.</p>
</div>
<div class="paragraph">
<p>To test cross-platform cache reuse, set up a <code>remote</code> cache (see <a href="#share_results_between_ci_builds">share results between CI builds</a>) and populate it from one platform and consume it from the other.</p>
</div>
</div>
<div class="sect4">
<h5 id="incremental_cache_usage"><a class="anchor" href="#incremental_cache_usage"></a><a class="link" href="#incremental_cache_usage">Incremental cache usage</a></h5>
<div class="paragraph">
<p>After these experiments with fully cached builds, you can go on and try to make typical changes to your project and see if enough tasks are still cached.
If the results are not satisfactory, you can think about restructuring your project to reduce dependencies between different tasks.</p>
</div>
</div>
<div class="sect4">
<h5 id="evaluating_cache_performance_over_time"><a class="anchor" href="#evaluating_cache_performance_over_time"></a><a class="link" href="#evaluating_cache_performance_over_time">Evaluating cache performance over time</a></h5>
<div class="paragraph">
<p>Consider recording execution times of your builds, generating graphs, and analyzing the results.
Keep an eye out for certain patterns, like a build recompiling everything even though you expected compilation to be cached.</p>
</div>
<div class="paragraph">
<p>You can also make changes to your code base manually or automatically and check that the expected set of tasks is cached.</p>
</div>
<div class="paragraph">
<p>If you have tasks that are re-executing instead of loading their outputs from the cache, then it may point to a problem in your build.
Techniques for debugging a cache miss are explained in the following section.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="helpful_data_for_diagnosing_a_cache_miss"><a class="anchor" href="#helpful_data_for_diagnosing_a_cache_miss"></a><a class="link" href="#helpful_data_for_diagnosing_a_cache_miss">Helpful data for diagnosing a cache miss</a></h4>
<div class="paragraph">
<p>A cache miss happens when Gradle calculates a build cache key for a task which is different from any existing build cache key in the cache.
Only comparing the build cache key on its own does not give much information, so we need to look at some finer grained data to be able to diagnose the cache miss.
A list of all inputs to the computed build cache key can be found in the <a href="#sec:task_output_caching_details">section on cacheable tasks</a>.</p>
</div>
<div class="paragraph">
<p>From most coarse grained to most fine grained, the items we will use to compare two tasks are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Build cache keys</p>
</li>
<li>
<p>Task and Task action implementations</p>
<div class="ulist">
<ul>
<li>
<p>classloader hash</p>
</li>
<li>
<p>class name</p>
</li>
</ul>
</div>
</li>
<li>
<p>Task output property names</p>
</li>
<li>
<p>Individual task property input hashes</p>
</li>
<li>
<p>Hashes of files which are part of task input properties</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want information about the build cache key and individual input property hashes, use <a href="#sec:gradle_configuration_properties"><code>-Dorg.gradle.caching.debug=true</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew :compileJava --build-cache -Dorg.gradle.caching.debug=true

.
.
.
Appending implementation to build cache key: org.gradle.api.tasks.compile.JavaCompile_Decorated@470c67ec713775576db4e818e7a4c75d
Appending additional implementation to build cache key: org.gradle.api.tasks.compile.JavaCompile_Decorated@470c67ec713775576db4e818e7a4c75d
Appending input value fingerprint for 'options' to build cache key: e4eaee32137a6a587e57eea660d7f85d
Appending input value fingerprint for 'options.compilerArgs' to build cache key: 8222d82255460164427051d7537fa305
Appending input value fingerprint for 'options.debug' to build cache key: f6d7ed39fe24031e22d54f3fe65b901c
Appending input value fingerprint for 'options.debugOptions' to build cache key: a91a8430ae47b11a17f6318b53f5ce9c
Appending input value fingerprint for 'options.debugOptions.debugLevel' to build cache key: f6bd6b3389b872033d462029172c8612
Appending input value fingerprint for 'options.encoding' to build cache key: f6bd6b3389b872033d462029172c8612
.
.
.
Appending input file fingerprints for 'options.sourcepath' to build cache key: 5fd1e7396e8de4cb5c23dc6aadd7787a - RELATIVE_PATH{EMPTY}
Appending input file fingerprints for 'stableSources' to build cache key: f305ada95aeae858c233f46fc1ec4d01 - RELATIVE_PATH{.../src/main/java=IGNORED / DIR, .../src/main/java/Hello.java='Hello.java' / 9c306ba203d618dfbe1be83354ec211d}
Appending output property name to build cache key: destinationDir
Appending output property name to build cache key: options.annotationProcessorGeneratedSourcesDirectory
Build cache key for task ':compileJava' is 8ebf682168823f662b9be34d27afdf77</pre>
</div>
</div>
<div class="paragraph">
<p>The log shows e.g. which source files constitute the <code>stableSources</code> for the <code>compileJava</code> task.
To find the actual differences between two builds you need to resort to matching up and comparing those hashes yourself.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<a href="https://docs.gradle.com/enterprise/tutorials/task-inputs-comparison/">Develocity</a> already takes care of this for you; it lets you quickly diagnose a cache miss with the Build Scan&#8482; Comparison tool.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="diagnosing_cache_miss"><a class="anchor" href="#diagnosing_cache_miss"></a><a class="link" href="#diagnosing_cache_miss">Diagnosing the reasons for a cache miss</a></h4>
<div class="paragraph">
<p>Having the data from the last section at hand, you should be able to diagnose why the outputs of a certain task were not found in the build cache.
Since you were expecting more tasks to be cached, you should be able to pinpoint a build which would have produced the artifact under question.</p>
</div>
<div class="paragraph">
<p>Before diving into how to find out why one task has not been loaded from the cache we should first look into which task caused the cache misses.
There is a cascade effect which causes dependent tasks to be executed if one of the tasks earlier in the build is not loaded from the cache and has different outputs.
Therefore, you should locate the first cacheable task which was executed and continue investigating from there.
This can be done from the timeline view in a Build Scan&#8482;:</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="img/build-cache/first-non-cached-task.png" alt="first non cached task">
</div>
</div>
<div class="paragraph">
<p>At first, you should check if the implementation of the task changed. This would mean checking the class names and classloader hashes
for the task class itself and for each of its actions. If there is a change, this means that the build script, <code>buildSrc</code> or the Gradle version has changed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A change in the output of <code>buildSrc</code> also marks all the logic added by your build as changed.
Especially, custom actions added to cacheable tasks will be marked as changed.
This can be problematic, see <a href="#custom_actions">section about <code>doFirst</code> and <code>doLast</code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the implementation is the same, then you need to start comparing inputs between the two builds.
There should be at least one different input hash. If it is a simple value property, then the configuration of the task changed.
This can happen for example by</p>
</div>
<div class="ulist">
<ul>
<li>
<p>changing the build script,</p>
</li>
<li>
<p>conditionally configuring the task differently for CI or the developer builds,</p>
</li>
<li>
<p>depending on a system property or an environment variable for the task configuration,</p>
</li>
<li>
<p>or having an absolute path which is part of the input.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the changed property is a file property, then the reasons can be the same as for the change of a value property.
Most probably though a file on the filesystem changed in a way that Gradle detects a difference for this input.
The most common case will be that the source code was changed by a check in.
It is also possible that a file generated by a task changed, e.g. since it includes a timestamp.
As described in <a href="#java_version_tracking">Java version tracking</a>, the Java version can also influence the output of the Java compiler.
If you did not expect the file to be an input to the task, then it is possible that you should alter the configuration of the task to not include it.
For example, having your integration test configuration including all the unit test classes as a dependency has the effect that all integration tests
are re-executed when a unit test changes.
Another option is that the task tracks absolute paths instead of relative paths and the location of the project directory changed on disk.</p>
</div>
</div>
<div class="sect3">
<h4 id="example_3"><a class="anchor" href="#example_3"></a><a class="link" href="#example_3">Example</a></h4>
<div class="paragraph">
<p>We will walk you through the process of diagnosing a cache miss.
Let&#8217;s say we have build <code>A</code> and build <code>B</code> and we expected all the test tasks for a sub-project <code>sub1</code> to be cached in build <code>B</code> since only a unit test for another sub-project <code>sub2</code> changed.
Instead, all the tests for the sub-project have been executed.
Since we have the cascading effect when we have cache misses, we need to find the task which caused the caching chain to fail.
This can easily be done by filtering for all cacheable tasks which have been executed and then select the first one.
In our case, it turns out that the tests for the sub-project <code>internal-testing</code> were executed even though there was no code change to this project.
This means that the property <code>classpath</code> changed and some file on the runtime classpath actually did change.
Looking deeper into this, we actually see that the inputs for the task <code>processResources</code> changed in that project, too.
Finally, we find this in our build file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val currentVersionInfo = tasks.register&lt;CurrentVersionInfo&gt;(&quot;currentVersionInfo&quot;) {
    version = project.version as String
    versionInfoFile = layout.buildDirectory.file(&quot;generated-resources/currentVersion.properties&quot;)
}

sourceSets.main.get().output.dir(currentVersionInfo.map { it.versionInfoFile.get().asFile.parentFile })

abstract class CurrentVersionInfo : DefaultTask() {
    @get:Input
    abstract val version: Property&lt;String&gt;

    @get:OutputFile
    abstract val versionInfoFile: RegularFileProperty

    @TaskAction
    fun writeVersionInfo() {
        val properties = Properties()
        properties.setProperty(&quot;latestMilestone&quot;, version.get())
        versionInfoFile.get().asFile.outputStream().use { out -&gt;
            properties.store(out, null)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> currentVersionInfo = tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">currentVersionInfo</span><span class="delimiter">'</span></span>, CurrentVersionInfo) {
    version = project.version
    versionInfoFile = layout.buildDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">generated-resources/currentVersion.properties</span><span class="delimiter">'</span></span>)
}

sourceSets.main.output.dir(currentVersionInfo.map { <span class="local-variable">it</span>.versionInfoFile.get().asFile.parentFile })

<span class="directive">abstract</span> <span class="type">class</span> <span class="class">CurrentVersionInfo</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@Input</span>
    <span class="directive">abstract</span> Property&lt;<span class="predefined-type">String</span>&gt; getVersion()

    <span class="annotation">@OutputFile</span>
    <span class="directive">abstract</span> RegularFileProperty getVersionInfoFile()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> writeVersionInfo() {
        <span class="keyword">def</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>()
        properties.setProperty(<span class="string"><span class="delimiter">'</span><span class="content">latestMilestone</span><span class="delimiter">'</span></span>, version.get())
        versionInfoFile.get().asFile.withOutputStream { out -&gt;
            properties.store(out, <span class="predefined-constant">null</span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Since properties files stored by Java&#8217;s <code>Properties.store</code> method contain a timestamp, this will cause a change to the runtime classpath every time the build runs.
In order to solve this problem see <a href="#volatile_outputs">non-repeatable task outputs</a> or use <a href="#normalization">input normalization</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The compile classpath is not affected since compile avoidance ignores non-class files on the classpath.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common-problems"><a class="anchor" href="#common-problems"></a><a class="link" href="#common-problems">Solving common problems</a></h3>
<div class="paragraph">
<p>Small problems in a build, like forgetting to declare a configuration file as an input to your task, can be easily overlooked.
The configuration file might change infrequently, or only change when some other (correctly tracked) input changes as well.
The worst that could happen is that your task doesn&#8217;t execute when it should.
Developers can always re-run the build with <code>clean</code>, and "fix" their builds for the price of a slow rebuild.
In the end nobody gets blocked in their work, and the incident is chalked up to "Gradle acting up again."</p>
</div>
<div class="paragraph">
<p>With cacheable tasks incorrect results are stored permanently, and can come back to haunt you later; re-running with <code>clean</code> won&#8217;t help in this situation either. When using a shared cache, these problems even cross machine boundaries. In the example above, Gradle might end up loading a result for your task that was produced with a different configuration. Resolving these problems with the build therefore becomes even more important when task output caching is enabled.</p>
</div>
<div class="paragraph">
<p>Other issues with the build won&#8217;t cause it to produce incorrect results, but will lead to unnecessary cache misses.
In this chapter you will learn about some typical problems and ways to avoid them.
Fixing these issues will have the added benefit that your build will stop "acting up," and developers can forget about running builds with <code>clean</code> altogether.</p>
</div>
<div class="sect3">
<h4 id="system_file_encoding"><a class="anchor" href="#system_file_encoding"></a><a class="link" href="#system_file_encoding">System file encoding</a></h4>
<div class="paragraph">
<p>Most Java tools use the system file encoding when no specific encoding is specified.
This means that running the same build on machines with different file encoding can yield different outputs.
Currently Gradle only tracks on a per-task basis that no file encoding has been specified, but it does not track the system encoding of the JVM in use.
This can cause incorrect builds. You should always set the file system encoding to avoid these kind of problems.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Build scripts are compiled with the file encoding of the Gradle daemon.
By default, the daemon uses the system file encoding, too.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Setting the file encoding for the Gradle daemon mitigates both above problems by making sure that the encoding is the same across builds.
You can do so in your <code>gradle.properties</code>:</p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.gradle.jvmargs=-Dfile.encoding=UTF-8</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="environment_variable_tracking"><a class="anchor" href="#environment_variable_tracking"></a><a class="link" href="#environment_variable_tracking">Environment variable tracking</a></h4>
<div class="paragraph">
<p>Gradle does not track changes in environment variables for tasks.
For example for <code>Test</code> tasks it is completely possible that the outcome depends on a few environment variables.
To ensure that only the right artifacts are re-used between builds, you need to add environment variables as inputs to tasks depending on them.</p>
</div>
<div class="paragraph">
<p>Absolute paths are often passed as environment variables, too.
You need to pay attention what you add as an input to the task in this case.
You would need to ensure that the absolute path is the same between machines. Most times it makes sense to track the file or the contents of the directory the absolute path points to.
If the absolute path represents a tool being used it probably makes sense to track the tool version as an input instead.</p>
</div>
<div class="paragraph">
<p>For example, if you are using tools in your <code>Test</code> task called <code>integTest</code> which depend on the contents of the <code>LANG</code> variable you should do this:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.integTest {
    inputs.property(&quot;langEnvironment&quot;) {
        System.getenv(&quot;LANG&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">integTest</span><span class="delimiter">'</span></span>) {
    inputs.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">langEnvironment</span><span class="delimiter">&quot;</span></span>) {
        <span class="predefined-type">System</span>.getenv(<span class="string"><span class="delimiter">&quot;</span><span class="content">LANG</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you add conditional logic to distinguish CI builds from local development builds, you have to ensure that this does not break the loading of task outputs from CI onto developer machines.
For example, the following setup would break caching of <code>Test</code> tasks, since Gradle always detects the differences in custom task actions.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">if (&quot;CI&quot; in System.getenv()) {
    tasks.withType&lt;Test&gt;().configureEach {
        doFirst {
            println(&quot;Running test on CI&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">if</span> (<span class="predefined-type">System</span>.getenv().containsKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">CI</span><span class="delimiter">&quot;</span></span>)) {
    tasks.withType(Test).configureEach {
        doFirst {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">Running test on CI</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You should always add the action unconditionally:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;Test&gt;().configureEach {
    doFirst {
        if (&quot;CI&quot; in System.getenv()) {
            println(&quot;Running test on CI&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(Test).configureEach {
    doFirst {
        <span class="keyword">if</span> (<span class="predefined-type">System</span>.getenv().containsKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">CI</span><span class="delimiter">&quot;</span></span>)) {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">Running test on CI</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This way, the task has the same custom action on CI and on developer builds and its outputs can be re-used if the remaining inputs are the same.</p>
</div>
</div>
<div class="sect3">
<h4 id="line_endings"><a class="anchor" href="#line_endings"></a><a class="link" href="#line_endings">Line endings</a></h4>
<div class="paragraph">
<p>If you are building on different operating systems be aware that some version control systems convert line endings on check-out.
For example, Git on Windows uses <code>autocrlf=true</code> by default which converts all line endings to <code>\r\n</code>.
As a consequence, compilation outputs can&#8217;t be re-used on Windows since the input sources are different.
If sharing the build cache across multiple operating systems is important in your environment, then setting <code>autocrlf=false</code> across your build machines is crucial for optimal build cache usage.</p>
</div>
</div>
<div class="sect3">
<h4 id="symbolic_links"><a class="anchor" href="#symbolic_links"></a><a class="link" href="#symbolic_links">Symbolic links</a></h4>
<div class="paragraph">
<p>When using symbolic links, Gradle does not store the link in the build cache but the actual file contents of the destination of the link.
As a consequence you might have a hard time when trying to reuse outputs which heavily use symbolic links.
There currently is no workaround for this behavior.</p>
</div>
<div class="paragraph">
<p>For operating systems supporting symbolic links, the content of the destination of the symbolic link will be added as an input.
If the operating system does not support symbolic links, the actual symbolic link file is added as an input.
Therefore, tasks which have symbolic links as input files, e.g. <code>Test</code> tasks having symbolic link as part of its runtime classpath, will not be cached between Windows and Linux.
If caching between operating systems is desired, symbolic links should not be checked into version control.</p>
</div>
</div>
<div class="sect3">
<h4 id="java_version_tracking"><a class="anchor" href="#java_version_tracking"></a><a class="link" href="#java_version_tracking">Java version tracking</a></h4>
<div class="paragraph">
<p>Gradle tracks only the major version of Java as an input for compilation and test execution.
Currently, it does <em>not</em> track the vendor nor the minor version.
Still, the vendor and the minor version may influence the bytecode produced by compilation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you&#8217;re using <a href="#toolchains">Java Toolchains</a>, the Java major version, the vendor (if specified) and implementation (if specified) will be tracked automatically as an input for compilation and test execution.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you use different JVM vendors for compiling or running Java we strongly suggest that you add the vendor as an input to the corresponding tasks.
This can be achieved by using the <a href="#sec:task_input_output_runtime_api">runtime API</a> as shown in the following snippet.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;AbstractCompile&gt;().configureEach {
    inputs.property(&quot;java.vendor&quot;) {
        System.getProperty(&quot;java.vendor&quot;)
    }
}

tasks.withType&lt;Test&gt;().configureEach {
    inputs.property(&quot;java.vendor&quot;) {
        System.getProperty(&quot;java.vendor&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(AbstractCompile).configureEach {
    inputs.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">java.vendor</span><span class="delimiter">&quot;</span></span>) {
        <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">java.vendor</span><span class="delimiter">&quot;</span></span>)
    }
}

tasks.withType(Test).configureEach {
    inputs.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">java.vendor</span><span class="delimiter">&quot;</span></span>) {
        <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">java.vendor</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With respect to tracking the Java minor version there are different competing aspects: developers having cache hits and "perfect" results on CI.
There are basically two situations when you may want to track the minor version of Java: for compilation and for runtime.
In the case of compilation, there can sometimes be differences in the produced bytecode for different minor versions.
However, the bytecode should still result in the same runtime behavior.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<a href="java_plugin.html#sec:java_compile_avoidance">Java compile avoidance</a> will treat this bytecode the same since it extracts the ABI.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Treating the minor number as an input can decrease the likelihood of a cache hit for developer builds.
Depending on how standard development environments are across your team, it&#8217;s common for many different Java minor version to be in use.</p>
</div>
<div class="paragraph">
<p>Even without tracking the Java minor version you may have cache misses for developers due to some locally compiled class files which constitute an input to test execution.
If these outputs made it into the local build cache on this developers machine even a clean will not solve the situation.
Therefore, the choice for tracking the Java minor version is between sometimes or never re-using outputs between different Java minor versions for test execution.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The compiler infrastructure provided by the JVM used to run Gradle is also used by the Groovy compiler.
Therefore, you can expect differences in the bytecode of compiled Groovy classes for the same reasons as above and the same suggestions apply.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="avoid_changing_inputs_external_to_your_build"><a class="anchor" href="#avoid_changing_inputs_external_to_your_build"></a><a class="link" href="#avoid_changing_inputs_external_to_your_build">Avoid changing inputs external to your build</a></h4>
<div class="paragraph">
<p>If your build is dependent on external dependencies like binary artifacts or dynamic data from a web page you need to make sure that these inputs are consistent throughout your infrastructure.
Any variations across machines will result in cache misses.</p>
</div>
<div class="paragraph">
<p>Never re-release a non-changing binary dependency with the same version number but different contents: if this happens with a plugin dependency, you will never be able to explain why you don’t see cache reuse between machines (it’s because they have different versions of that artifact).</p>
</div>
<div class="paragraph">
<p>Using <code>SNAPSHOT</code>s or other changing dependencies in your build by design violates the <a href="#stable_task_inputs">stable task inputs</a> principle.
To use the build cache effectively, you should depend on fixed dependencies.
You may want to look into <a href="#dependency-locking">dependency locking</a> or switch to using <a href="#composite_builds">composite builds</a> instead.</p>
</div>
<div class="paragraph">
<p>The same is true for depending on volatile external resources, for example a list of released versions.
One way of locking the changes would be to check the volatile resource into source control whenever it changes so that the builds only depend on the state in source control and not on the volatile resource itself.</p>
</div>
</div>
<div class="sect3">
<h4 id="suggestions_for_authoring_your_build"><a class="anchor" href="#suggestions_for_authoring_your_build"></a><a class="link" href="#suggestions_for_authoring_your_build">Suggestions for authoring your build</a></h4>
<div class="sect4">
<h5 id="custom_actions"><a class="anchor" href="#custom_actions"></a><a class="link" href="#custom_actions">Review usages of <code>doFirst</code> and <code>doLast</code></a></h5>
<div class="paragraph">
<p>Using <code>doFirst</code> and <code>doLast</code> from a build script on a cacheable task ties you to build script changes since the implementation of the closure comes from the build script.
If possible, you should use separate tasks instead.</p>
</div>
<div class="paragraph">
<p>Modifying input or output properties via the runtime API in <code>doFirst</code> is discouraged since these changes will not be detected for up-to-date checks and the build cache.
Even worse, when the task does not execute, then the configuration of the task is actually different from when it executes.
Instead of using <code>doFirst</code> for modifying the inputs consider using a separate task to configure the task under question - a so called configure task.
E.g., instead of doing</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.jar {
    val runtimeClasspath: FileCollection = configurations.runtimeClasspath.get()
    doFirst {
        manifest {
            val classPath = runtimeClasspath.map { it.name }.joinToString(&quot; &quot;)
            attributes(&quot;Class-Path&quot; to classPath)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>) {
    FileCollection runtimeClasspath = configurations.runtimeClasspath
    doFirst {
        manifest {
            <span class="keyword">def</span> classPath = runtimeClasspath.collect { <span class="local-variable">it</span>.name }.join(<span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>)
            attributes(<span class="string"><span class="delimiter">'</span><span class="content">Class-Path</span><span class="delimiter">'</span></span>: classPath)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>do</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val configureJar = tasks.register(&quot;configureJar&quot;) {
    doLast {
        tasks.jar.get().manifest {
            val classPath = configurations.runtimeClasspath.get().map { it.name }.joinToString(&quot; &quot;)
            attributes(&quot;Class-Path&quot; to classPath)
        }
    }
}
tasks.jar { dependsOn(configureJar) }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> configureJar = tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">configureJar</span><span class="delimiter">'</span></span>) {
    doLast {
        tasks.jar.manifest {
            <span class="keyword">def</span> classPath = configurations.runtimeClasspath.collect { <span class="local-variable">it</span>.name }.join(<span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>)
            attributes(<span class="string"><span class="delimiter">'</span><span class="content">Class-Path</span><span class="delimiter">'</span></span>: classPath)
        }
    }
}

tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>) { dependsOn(configureJar) }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Note that configuring a task from other task is not supported when using the <a href="#config_cache:requirements:task_access">configuration cache</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="logic_based_on_task_outcome"><a class="anchor" href="#logic_based_on_task_outcome"></a><a class="link" href="#logic_based_on_task_outcome">Build logic based on the outcome of a task</a></h5>
<div class="paragraph">
<p>Do not base build logic on whether a task has been <em>executed</em>.
In particular you should not assume that the output of a task can only change if it actually executed.
Actually, loading the outputs from the build cache would also change them.
Instead of relying on custom logic to deal with changes to input or output files you should leverage Gradle&#8217;s built-in support by declaring the correct inputs and outputs for your tasks and leave it to Gradle to decide if the task actions should be executed.
For the very same reason using <code>outputs.upToDateWhen</code> is discouraged and should be replaced by properly declaring the task&#8217;s inputs.</p>
</div>
</div>
<div class="sect4">
<h5 id="overlapping_outputs"><a class="anchor" href="#overlapping_outputs"></a><a class="link" href="#overlapping_outputs">Overlapping outputs</a></h5>
<div class="paragraph">
<p>You already saw that <a href="#concepts_overlapping_outputs">overlapping outputs are a problem for task output caching</a>.
When you add new tasks to your build or re-configure built-in tasks make sure you do not create overlapping outputs for cacheable tasks.
If you must you can add a <code>Sync</code> task which then would sync the merged outputs into the target directory while the original tasks remain cacheable.</p>
</div>
<div class="paragraph">
<p>Develocity will show tasks where caching was disabled for overlapping outputs in the timeline and in the task input comparison:</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="img/build-cache/overlapping-outputs-input-comparison.png" alt="overlapping outputs input comparison">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="achieving_stable_task_inputs"><a class="anchor" href="#achieving_stable_task_inputs"></a><a class="link" href="#achieving_stable_task_inputs">Achieving stable task inputs</a></h4>
<div class="paragraph">
<p>It is crucial to have <a href="#stable_task_inputs">stable task inputs</a> for every cacheable task.
In the following section you will learn about different situations which violate stable task inputs and look at possible solutions.</p>
</div>
<div class="sect4">
<h5 id="volatile_inputs"><a class="anchor" href="#volatile_inputs"></a><a class="link" href="#volatile_inputs">Volatile task inputs</a></h5>
<div class="paragraph">
<p>If you use a volatile input like a timestamp as an input property for a task, then there is nothing Gradle can do to make the task cacheable.
You should really think hard if the volatile data is really essential to the output or if it is only there for e.g. auditing purposes.</p>
</div>
<div class="paragraph">
<p>If the volatile input is essential to the output then you can try to make the task using the volatile input cheaper to execute.
You can do this by splitting the task into two tasks - the first task doing the expensive work which is cacheable and the second task adding the volatile data to the output.
In this way the output stays the same and the build cache can be used to avoid doing the expensive work.
For example, for building a jar file the expensive part - Java compilation - is already a different task while the jar task itself, which is not cacheable, is cheap.</p>
</div>
<div class="paragraph">
<p>If it is not an essential part of the output, then you should not declare it as an input.
As long as the volatile input does not influence the output then there is nothing else to do.
Most times though, the input will be part of the output.</p>
</div>
</div>
<div class="sect4">
<h5 id="volatile_outputs"><a class="anchor" href="#volatile_outputs"></a><a class="link" href="#volatile_outputs">Non-repeatable task outputs</a></h5>
<div class="paragraph">
<p>Having tasks which generate different outputs for the same inputs can pose a challenge for the effective use of task output caching as seen in <a href="#concepts_repeatable_task_outputs">repeatable task outputs</a>.
If the non-repeatable task output is not used by any other task then the effect is very limited.
It basically means that loading the task from the cache might produce a different result than executing the same task locally.
If the only difference between the outputs is a timestamp, then you can either accept the effect of the build cache or decide that the task is not cacheable after all.</p>
</div>
<div class="paragraph">
<p>Non-repeatable task outputs lead to non-stable task inputs as soon as another task depends on the non-repeatable output.
For example, re-creating a jar file from the files with the same contents but different modification times yields a different jar file.
Any other task depending on this jar file as an input file cannot be loaded from the cache when the jar file is rebuilt locally.
This can lead to hard-to-diagnose cache misses when the consuming build is not a clean build or when a cacheable task depends on the output of a non-cacheable task.
For example, when doing incremental builds it is possible that the artifact on disk which is considered up-to-date and the artifact in the build cache are different even though they are essentially the same.
A task depending on this task output would then not be able to load outputs from the build cache since the inputs are not exactly the same.</p>
</div>
<div class="paragraph">
<p>As described in the <a href="#stable_task_inputs">stable task inputs section</a>, you can either make the task outputs repeatable or use input normalization.
You already learned about the possibilities with <a href="#filter_runtime_classpath">configurable input normalization</a>.</p>
</div>
<div class="paragraph">
<p>Gradle includes some support for creating repeatable output for archive tasks.
For tar and zip files Gradle can be configured to create <a href="#sec:reproducible_archives">reproducible archives</a>.
This is done by configuring e.g. the <code>Zip</code> task via the following snippet.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Zip&gt;(&quot;createZip&quot;) {
    isPreserveFileTimestamps = false
    isReproducibleFileOrder = true
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">createZip</span><span class="delimiter">'</span></span>, Zip) {
    preserveFileTimestamps = <span class="predefined-constant">false</span>
    reproducibleFileOrder = <span class="predefined-constant">true</span>
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Another way to make the outputs repeatable is to activate caching for a task with non-repeatable outputs.
If you can make sure that the same build cache is used for all builds then the task will always have the same outputs for the same inputs by design of the build cache.
Going down this road can lead to different problems with cache misses for incremental builds as described above.
Moreover, race conditions between different builds trying to store the same outputs in the build cache in parallel can lead to hard-to-diagnose cache misses.
If possible, you should avoid going down that route.</p>
</div>
</div>
<div class="sect4">
<h5 id="limit_the_effect_of_volatile_data"><a class="anchor" href="#limit_the_effect_of_volatile_data"></a><a class="link" href="#limit_the_effect_of_volatile_data">Limit the effect of volatile data</a></h5>
<div class="paragraph">
<p>If none of the described solutions for dealing with volatile data work for you, you should still be able to limit the effect of volatile data on effective use of the build cache.
This can be done by adding the volatile data later to the outputs as described in the <a href="#volatile_inputs">volatile task inputs section</a>.
Another option would be to move the volatile data so it affects fewer tasks.
For example moving the dependency from the <code>compile</code> to the <code>runtime</code> configuration may already have quite an impact.</p>
</div>
<div class="paragraph">
<p>Sometimes it is also possible to build two artifacts, one containing the volatile data and another one containing a constant representation of the volatile data.
The non-volatile output would be used e.g. for testing while the volatile one would be published to an external repository.
While this conflicts with the Continuous Delivery "build artifacts once" principle it can sometimes be the only option.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom_and_third_party_tasks"><a class="anchor" href="#custom_and_third_party_tasks"></a><a class="link" href="#custom_and_third_party_tasks">Custom and third party tasks</a></h4>
<div class="paragraph">
<p>If your build contains custom or third party tasks, you should take special care that these don&#8217;t influence the effectiveness of the build cache.
Special care should also be taken for code generation tasks which may not have <a href="#concepts_repeatable_task_outputs">repeatable task outputs</a>.
This can happen if the code generator includes e.g. a timestamp in the generated files or depends on the order of the input files.
Other pitfalls can be the use of <code>HashMap</code>s or other data structures without order guarantees in the task&#8217;s code.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Some third party plugins can even influence cacheability of Gradle&#8217;s built-in tasks.
This can happen if they add inputs like absolute paths or volatile data to tasks via the runtime API.
In the worst case this can lead to incorrect builds when the plugins try to depend on the <a href="#logic_based_on_task_outcome">outcome of a task</a> and do not take <code>FROM-CACHE</code> into account.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:reference"><a class="anchor" href="#part:reference"></a><a class="link" href="#part:reference"><strong>REFERENCE</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="command_line_interface"><a class="anchor" href="#command_line_interface"></a><a class="link" href="#command_line_interface">Command-Line Interface Reference</a></h3>
<div class="paragraph">
<p>The command-line interface is the <strong>primary method of interacting with Gradle</strong>.</p>
</div>
<div class="paragraph">
<p>The following is a reference for executing and customizing the Gradle command-line.
It also serves as a reference when writing scripts or configuring continuous integration.</p>
</div>
<div class="paragraph">
<p><strong>Use of the <a href="#gradle_wrapper_reference">Gradle Wrapper</a> is highly encouraged</strong>.
Substitute <code>./gradlew</code> (in macOS / Linux) or <code>gradlew.bat</code> (in Windows) for <code>gradle</code> in the following examples.</p>
</div>
<div class="paragraph">
<p>Executing Gradle on the command-line conforms to the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle [taskName...] [--option-name...]</pre>
</div>
</div>
<div class="paragraph">
<p>Options are allowed <em>before</em> and <em>after</em> task names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle [--option-name...] [taskName...]</pre>
</div>
</div>
<div class="paragraph">
<p>If multiple tasks are specified, you should separate them with a space.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle [taskName1 taskName2...] [--option-name...]</pre>
</div>
</div>
<div class="paragraph">
<p>Options that accept values can be specified with or without <code>=</code> between the option and argument. The use of <code>=</code> is recommended.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle [...] --console=plain</pre>
</div>
</div>
<div class="paragraph">
<p>Options that enable behavior have long-form options with inverses specified with <code>--no-</code>. The following are opposites.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle [...] --build-cache
gradle [...] --no-build-cache</pre>
</div>
</div>
<div class="paragraph">
<p>Many long-form options have short-option equivalents. The following are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle --help
gradle -h</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Many command-line flags can be specified in <code>gradle.properties</code> to avoid needing to be typed.
See the <a href="#sec:gradle_configuration_properties">Configuring build environment guide</a> for details.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="command_line_usage_2"><a class="anchor" href="#command_line_usage_2"></a><a class="link" href="#command_line_usage_2">Command-line usage</a></h4>
<div class="paragraph">
<p>The following sections describe the use of the Gradle command-line interface.</p>
</div>
<div class="paragraph">
<p>Some plugins also add their own command line options.
For example, <code>--tests</code>, which is added by <a href="#test_filtering">Java test filtering</a>.
For more information on exposing command line options for your own tasks, see <a href="#sec:declaring_and_using_command_line_options">Declaring command-line options</a>.</p>
</div>
<div class="sect4">
<h5 id="sec:command_line_executing_tasks"><a class="anchor" href="#sec:command_line_executing_tasks"></a><a class="link" href="#sec:command_line_executing_tasks">Executing tasks</a></h5>
<div class="paragraph">
<p>You can learn about what projects and tasks are available in the <a href="#sec:command_line_project_reporting">project reporting section</a>.</p>
</div>
<div class="paragraph">
<p>Most builds support a common set of tasks known as <a href="organizing_tasks.html#sec:lifecycle_tasks"><em>lifecycle tasks</em></a>. These include the <code>build</code>, <code>assemble</code>, and <code>check</code> tasks.</p>
</div>
<div class="paragraph">
<p>To execute a task called <code>myTask</code> on the root project, type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle :myTask</pre>
</div>
</div>
<div class="paragraph">
<p>This will run the single <code>myTask</code> and all of its <a href="#sec:task_dependencies">dependencies</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:disambiguate_task_options_from_built_in_options"><a class="anchor" href="#sec:disambiguate_task_options_from_built_in_options"></a><a class="link" href="#sec:disambiguate_task_options_from_built_in_options">Specify options for tasks</a></h5>
<div class="paragraph">
<p>To pass an option to a task, prefix the option name with <code>--</code> after the task name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle exampleTask --exampleOption=exampleValue</pre>
</div>
</div>
<div class="sect5">
<h6 id="disambiguate_task_options_from_built_in_options_2"><a class="anchor" href="#disambiguate_task_options_from_built_in_options_2"></a><a class="link" href="#disambiguate_task_options_from_built_in_options_2">Disambiguate task options from built-in options</a></h6>
<div class="paragraph">
<p>Gradle does not prevent tasks from registering options that conflict with Gradle&#8217;s built-in options, like <code>--profile</code> or <code>--help</code>.</p>
</div>
<div class="paragraph">
<p>You can fix conflicting task options from Gradle&#8217;s built-in options with a <code>--</code> delimiter before the task name in the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle [--built-in-option-name...] -- [taskName...] [--task-option-name...]</pre>
</div>
</div>
<div class="paragraph">
<p>Consider a task named <code>mytask</code> that accepts an option named <code>profile</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In <code>gradle mytask --profile</code>, Gradle accepts <code>--profile</code> as the built-in Gradle option.</p>
</li>
<li>
<p>In <code>gradle -- mytask --profile=value</code>, Gradle passes <code>--profile</code> as a task option.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="executing_tasks_in_multi_project_builds"><a class="anchor" href="#executing_tasks_in_multi_project_builds"></a><a class="link" href="#executing_tasks_in_multi_project_builds">Executing tasks in multi-project builds</a></h5>
<div class="paragraph">
<p>In a <a href="#intro_multi_project_builds">multi-project build</a>, subproject tasks can be executed with <code>:</code> separating the subproject name and task name.
The following are equivalent when <em>run from the root project</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle :subproject:taskName</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle subproject:taskName</pre>
</div>
</div>
<div class="paragraph">
<p>You can also run a task for <em>all</em> subprojects using a task <em>selector</em> that consists of only the task name.</p>
</div>
<div class="paragraph">
<p>The following command runs the <code>test</code> task for all subprojects when invoked from the <em>root project directory</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle test</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Some tasks selectors, like <code>help</code> or <code>dependencies</code>, will only run the task on the project they are invoked on and not on all the subprojects.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When invoking Gradle from within a subproject, the project name should be omitted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cd subproject</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle taskName</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When executing the Gradle Wrapper from a subproject directory, reference <code>gradlew</code> relatively. For example: <code>../gradlew taskName</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="executing_multiple_tasks"><a class="anchor" href="#executing_multiple_tasks"></a><a class="link" href="#executing_multiple_tasks">Executing multiple tasks</a></h5>
<div class="paragraph">
<p>You can also specify multiple tasks.
The tasks' dependencies determine the precise order of execution, and a task having no dependencies may execute earlier than it is listed on the command-line.</p>
</div>
<div class="paragraph">
<p>For example, the following will execute the <code>test</code> and <code>deploy</code> tasks in the order that they are listed on the command-line and will also execute the dependencies for each task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle test deploy</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="command_line_order_safety"><a class="anchor" href="#command_line_order_safety"></a><a class="link" href="#command_line_order_safety">Command line order safety</a></h5>
<div class="paragraph">
<p>Although Gradle will always attempt to execute the build quickly, command line ordering safety will also be honored.</p>
</div>
<div class="paragraph">
<p>For example, the following will
execute <code>clean</code> and <code>build</code> along with their dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle clean build</pre>
</div>
</div>
<div class="paragraph">
<p>However, the intention implied in the command line order is that <code>clean</code> should run first and then <code>build</code>. It would be incorrect to execute <code>clean</code> <em>after</em> <code>build</code>, even if doing so would cause the build to execute faster since <code>clean</code> would remove what <code>build</code> created.</p>
</div>
<div class="paragraph">
<p>Conversely, if the command line order was <code>build</code> followed by <code>clean</code>, it would not be correct to execute <code>clean</code> before <code>build</code>. Although Gradle will execute the build as quickly as possible, it will also respect the safety of the order of tasks specified on the command line and ensure that <code>clean</code> runs before <code>build</code> when specified in that order.</p>
</div>
<div class="paragraph">
<p>Note that <a href="#incremental_build">command line order safety</a> relies on tasks properly declaring what they create, consume, or remove.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:excluding_tasks_from_the_command_line"><a class="anchor" href="#sec:excluding_tasks_from_the_command_line"></a><a class="link" href="#sec:excluding_tasks_from_the_command_line">Excluding tasks from execution</a></h5>
<div class="paragraph">
<p>You can exclude a task from being executed using the <code>-x</code> or <code>--exclude-task</code> command-line option and providing the name of the task to exclude:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle dist --exclude-task test</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Task :compile
compiling source

&gt; Task :dist
building the distribution

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="img/commandLineTutorialTasks.png" alt="commandLineTutorialTasks">
</div>
<div class="title">Figure 33. Simple Task Graph</div>
</div>
<div class="paragraph">
<p>You can see that the <code>test</code> task is not executed, even though the <code>dist</code> task depends on it.
The <code>test</code> task’s dependencies, such as <code>compileTest</code>, are not executed either.
The dependencies of <code>test</code> that other tasks depend on, such as <code>compile</code>, are still executed.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:rerun_tasks"><a class="anchor" href="#sec:rerun_tasks"></a><a class="link" href="#sec:rerun_tasks">Forcing tasks to execute</a></h5>
<div class="paragraph">
<p>You can force Gradle to execute all tasks ignoring <a href="#incremental_build">up-to-date checks</a> using the <code>--rerun-tasks</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle test --rerun-tasks</pre>
</div>
</div>
<div class="paragraph">
<p>This will force <code>test</code> and <em>all</em> task dependencies of <code>test</code> to execute. It is similar to running <code>gradle clean test</code>, but without the build&#8217;s generated output being deleted.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can tell Gradle to rerun a specific task using the <code>--rerun</code> built-in <a href="#sec:task_options">task option</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:continue_build_on_failure"><a class="anchor" href="#sec:continue_build_on_failure"></a><a class="link" href="#sec:continue_build_on_failure">Continue the build after a task failure</a></h5>
<div class="paragraph">
<p>By default, Gradle aborts execution and fails the build when any task fails.
This allows the build to complete sooner and prevents cascading failures from obfuscating the root cause of an error.</p>
</div>
<div class="paragraph">
<p>You can use the <code>--continue</code> option to force Gradle to execute every task when a failure occurs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle test --continue</pre>
</div>
</div>
<div class="paragraph">
<p>When executed with <code>--continue</code>, Gradle executes <em>every</em> task in the build if all the dependencies for that task are completed without failure.</p>
</div>
<div class="paragraph">
<p>For example, tests do not run if there is a compilation error in the code under test because the <code>test</code> task depends on the <code>compilation</code> task.
Gradle outputs each of the encountered failures at the end of the build.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If any tests fail, many test suites fail the entire <code>test</code> task.
Code coverage and reporting tools frequently run after the test task, so "fail fast" behavior may halt execution before those tools run.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:name_abbreviation"><a class="anchor" href="#sec:name_abbreviation"></a><a class="link" href="#sec:name_abbreviation">Name abbreviation</a></h5>
<div class="paragraph">
<p>When you specify tasks on the command-line, you don&#8217;t have to provide the full name of the task.
You can provide enough of the task name to identify the task uniquely.
For example, it is likely <code>gradle che</code> is enough for Gradle to identify the <code>check</code> task.</p>
</div>
<div class="paragraph">
<p>The same applies to project names. You can execute the <code>check</code> task in the <code>library</code> subproject with the <code>gradle lib:che</code> command.</p>
</div>
<div class="paragraph">
<p>You can use <a href="https://en.wikipedia.org/wiki/Camel_case">camel case</a> patterns for more complex abbreviations. These patterns are expanded to match camel case and <a href="https://en.wikipedia.org/wiki/Kebab_case">kebab case</a> names.
For example, the pattern <code>foBa</code> (or <code>fB</code>) matches <code>fooBar</code> and <code>foo-bar</code>.</p>
</div>
<div class="paragraph">
<p>More concretely, you can run the <code>compileTest</code> task in the <code>my-awesome-library</code> subproject with the command <code>gradle mAL:cT</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle mAL:cT</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Task :my-awesome-library:compileTest
compiling unit tests

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Abbreviations can also be used with the <code>-x</code> command-line option.</p>
</div>
</div>
<div class="sect4">
<h5 id="tracing_name_expansion"><a class="anchor" href="#tracing_name_expansion"></a><a class="link" href="#tracing_name_expansion">Tracing name expansion</a></h5>
<div class="paragraph">
<p>For complex projects, it might be ambiguous if the intended tasks were executed. When using abbreviated names, a single typo can lead to the execution of unexpected tasks.</p>
</div>
<div class="paragraph">
<p>When <code>INFO</code>, or more <a href="#logLevels">verbose logging</a> is enabled, the output will contain extra information about the project and task name expansion.</p>
</div>
<div class="paragraph">
<p>For example, when executing the <code>mAL:cT</code> command on the previous example, the following log messages will be visible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>No exact project with name ':mAL' has been found. Checking for abbreviated names.
Found exactly one project that matches the abbreviated name ':mAL': ':my-awesome-library'.
No exact task with name ':cT' has been found. Checking for abbreviated names.
Found exactly one task name, that matches the abbreviated name ':cT': ':compileTest'.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="common_tasks"><a class="anchor" href="#common_tasks"></a><a class="link" href="#common_tasks">Common tasks</a></h4>
<div class="paragraph">
<p>The following are task conventions applied by built-in and most major Gradle plugins.</p>
</div>
<div class="sect4">
<h5 id="computing_all_outputs"><a class="anchor" href="#computing_all_outputs"></a><a class="link" href="#computing_all_outputs">Computing all outputs</a></h5>
<div class="paragraph">
<p>It is common in Gradle builds for the <code>build</code> task to designate assembling all outputs and running all checks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle build</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="running_applications"><a class="anchor" href="#running_applications"></a><a class="link" href="#running_applications">Running applications</a></h5>
<div class="paragraph">
<p>It is common for applications to run with the <code>run</code> task, which assembles the application and executes some script or binary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle run</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="running_all_checks"><a class="anchor" href="#running_all_checks"></a><a class="link" href="#running_all_checks">Running all checks</a></h5>
<div class="paragraph">
<p>It is common for <em>all</em> verification tasks, including tests and linting, to be executed using the <code>check</code> task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle check</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cleaning_outputs"><a class="anchor" href="#cleaning_outputs"></a><a class="link" href="#cleaning_outputs">Cleaning outputs</a></h5>
<div class="paragraph">
<p>You can delete the contents of the build directory using the <code>clean</code> task. Doing so will cause pre-computed outputs to be lost, causing significant additional build time for the subsequent task execution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle clean</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_project_reporting"><a class="anchor" href="#sec:command_line_project_reporting"></a><a class="link" href="#sec:command_line_project_reporting">Project reporting</a></h4>
<div class="paragraph">
<p>Gradle provides several built-in tasks which show particular details of your build.
This can be useful for understanding your build&#8217;s structure and dependencies, as well as debugging problems.</p>
</div>
<div class="sect4">
<h5 id="listing_projects"><a class="anchor" href="#listing_projects"></a><a class="link" href="#listing_projects">Listing projects</a></h5>
<div class="paragraph">
<p>Running the <code>projects</code> task gives you a list of the subprojects of the selected project, displayed in a hierarchy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle projects</pre>
</div>
</div>
<div class="paragraph">
<p>You also get a project report within <a href="https://scans.gradle.com/">Build Scans</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:listing_tasks"><a class="anchor" href="#sec:listing_tasks"></a><a class="link" href="#sec:listing_tasks">Listing tasks</a></h5>
<div class="paragraph">
<p>Running <code>gradle tasks</code> gives you a list of the main tasks of the selected project. This report shows the default tasks for the project, if any, and a description for each task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle tasks</pre>
</div>
</div>
<div class="paragraph">
<p>By default, this report shows only those tasks assigned to a task group.</p>
</div>
<div class="paragraph">
<p>Groups (such as verification, publishing, help, build&#8230;&#8203;) are available as the header of each section when listing tasks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Task :tasks

Build tasks
-----------
assemble - Assembles the outputs of this project.

Build Setup tasks
-----------------
init - Initializes a new Gradle build.

Distribution tasks
------------------
assembleDist - Assembles the main distributions

Documentation tasks
-------------------
javadoc - Generates Javadoc API documentation for the main source code.</pre>
</div>
</div>
<div class="paragraph">
<p>You can obtain more information in the task listing using the <code>--all</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle tasks --all</pre>
</div>
</div>
<div class="paragraph">
<p>The option <code>--no-all</code> can limit the report to tasks assigned to a task group.</p>
</div>
<div class="paragraph">
<p>If you need to be more precise, you can display only the tasks from a specific group using the <code>--group</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle tasks --group="build setup"</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:show_task_details"><a class="anchor" href="#sec:show_task_details"></a><a class="link" href="#sec:show_task_details">Show task usage details</a></h5>
<div class="paragraph">
<p>Running <code>gradle help --task someTask</code> gives you detailed information about a specific task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q help --task libs</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Detailed task information for libs

Paths
     :api:libs
     :webapp:libs

Type
     Task (org.gradle.api.Task)

Options
     --rerun     Causes the task to be re-run even if up-to-date.

Description
     Builds the JAR

Group
     build</pre>
</div>
</div>
<div class="paragraph">
<p>This information includes the full task path, the task type, possible <a href="#sec:task_options">task-specific command line options</a>, and the description of the given task.</p>
</div>
<div class="paragraph">
<p>You can get detailed information about the task class types using the <code>--types</code> option or using <code>--no-types</code> to hide this information.</p>
</div>
</div>
<div class="sect4">
<h5 id="reporting_dependencies"><a class="anchor" href="#reporting_dependencies"></a><a class="link" href="#reporting_dependencies">Reporting dependencies</a></h5>
<div class="paragraph">
<p><a href="https://scans.gradle.com/">Build Scans</a> give a full, visual report of what dependencies exist on which configurations, transitive dependencies, and dependency version selection.
They can be invoked using the <code>--scan</code> options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle myTask --scan</pre>
</div>
</div>
<div class="paragraph">
<p>This will give you a link to a web-based report, where you can find <a href="#sec:debugging-build-scans">dependency information</a> like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-core-test-build-scan-dependencies.png" alt="Build Scan dependencies report">
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:listing_project_dependencies"><a class="anchor" href="#sec:listing_project_dependencies"></a><a class="link" href="#sec:listing_project_dependencies">Listing project dependencies</a></h5>
<div class="paragraph">
<p>Running the <code>dependencies</code> task gives you a list of the dependencies of the selected project, broken down by configuration. For each configuration, the direct and transitive dependencies of that configuration are shown in a tree.</p>
</div>
<div class="paragraph">
<p>Below is an example of this report:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle dependencies</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Task :app:dependencies

------------------------------------------------------------
Project ':app'
------------------------------------------------------------

compileClasspath - Compile classpath for source set 'main'.
+--- project :model
|    \--- org.json:json:20220924
+--- com.google.inject:guice:5.1.0
|    +--- javax.inject:javax.inject:1
|    +--- aopalliance:aopalliance:1.0
|    \--- com.google.guava:guava:30.1-jre -&gt; 28.2-jre
|         +--- com.google.guava:failureaccess:1.0.1
|         +--- com.google.guava:listenablefuture:9999.0-empty-to-avoid-conflict-with-guava
|         +--- com.google.code.findbugs:jsr305:3.0.2
|         +--- org.checkerframework:checker-qual:2.10.0 -&gt; 3.28.0
|         +--- com.google.errorprone:error_prone_annotations:2.3.4
|         \--- com.google.j2objc:j2objc-annotations:1.3
+--- com.google.inject:guice:{strictly 5.1.0} -&gt; 5.1.0 (c)
+--- org.json:json:{strictly 20220924} -&gt; 20220924 (c)
+--- javax.inject:javax.inject:{strictly 1} -&gt; 1 (c)
+--- aopalliance:aopalliance:{strictly 1.0} -&gt; 1.0 (c)
+--- com.google.guava:guava:{strictly [28.0-jre, 28.5-jre]} -&gt; 28.2-jre (c)
+--- com.google.guava:guava:{strictly 28.2-jre} -&gt; 28.2-jre (c)
+--- com.google.guava:failureaccess:{strictly 1.0.1} -&gt; 1.0.1 (c)
+--- com.google.guava:listenablefuture:{strictly 9999.0-empty-to-avoid-conflict-with-guava} -&gt; 9999.0-empty-to-avoid-conflict-with-guava (c)
+--- com.google.code.findbugs:jsr305:{strictly 3.0.2} -&gt; 3.0.2 (c)
+--- org.checkerframework:checker-qual:{strictly 3.28.0} -&gt; 3.28.0 (c)
+--- com.google.errorprone:error_prone_annotations:{strictly 2.3.4} -&gt; 2.3.4 (c)
\--- com.google.j2objc:j2objc-annotations:{strictly 1.3} -&gt; 1.3 (c)</pre>
</div>
</div>
<div class="paragraph">
<p>Concrete examples of build scripts and output available in <a href="#sec:debugging-build-scans">Viewing and debugging dependencies</a>.</p>
</div>
<div class="paragraph">
<p>Running the <code>buildEnvironment</code> task visualises the buildscript dependencies of the selected project, similarly to how <code>gradle dependencies</code> visualizes the dependencies of the software being built:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle buildEnvironment</pre>
</div>
</div>
<div class="paragraph">
<p>Running the <code>dependencyInsight</code> task gives you an insight into a particular dependency (or dependencies) that match specified input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle dependencyInsight --dependency [...] --configuration [...]</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--configuration</code> parameter restricts the report to a particular configuration such as <code>compileClasspath</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:listing_properties"><a class="anchor" href="#sec:listing_properties"></a><a class="link" href="#sec:listing_properties">Listing project properties</a></h5>
<div class="paragraph">
<p>Running the <code>properties</code> task gives you a list of the properties of the selected project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q api:properties</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>------------------------------------------------------------
Project ':api' - The shared API for the application
------------------------------------------------------------

allprojects: [project ':api']
ant: org.gradle.api.internal.project.DefaultAntBuilder@12345
antBuilderFactory: org.gradle.api.internal.project.DefaultAntBuilderFactory@12345
artifacts: org.gradle.api.internal.artifacts.dsl.DefaultArtifactHandler_Decorated@12345
asDynamicObject: DynamicObject for project ':api'
baseClassLoaderScope: org.gradle.api.internal.initialization.DefaultClassLoaderScope@12345</pre>
</div>
</div>
<div class="paragraph">
<p>You can also query a single property with the optional <code>--property</code> argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q api:properties --property allprojects</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>------------------------------------------------------------
Project ':api' - The shared API for the application
------------------------------------------------------------

allprojects: [project ':api']</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_completion"><a class="anchor" href="#sec:command_line_completion"></a><a class="link" href="#sec:command_line_completion">Command-line completion</a></h4>
<div class="paragraph">
<p>Gradle provides <code>bash</code> and <code>zsh</code> tab completion support for tasks, options, and Gradle properties through <a href="https://github.com/gradle/gradle-completion">gradle-completion</a> (installed separately):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-completion-4.0.gif" alt="gradle completion 4.0">
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_debugging"><a class="anchor" href="#sec:command_line_debugging"></a><a class="link" href="#sec:command_line_debugging">Debugging options</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-?</code>, <code>-h</code>, <code>--help</code></dt>
<dd>
<p>Shows a help message with the built-in CLI options.
To show project-contextual options, including help on a specific task, see the <code>help</code> task.</p>
</dd>
<dt class="hdlist1"><code>-v</code>, <code>--version</code></dt>
<dd>
<p>Prints Gradle, Groovy, Ant, Launcher &amp; Daemon JVM, and operating system version information and exit without executing any tasks.</p>
</dd>
<dt class="hdlist1"><code>-V</code>, <code>--show-version</code></dt>
<dd>
<p>Prints Gradle, Groovy, Ant, Launcher &amp; Daemon JVM, and operating system version information and continue execution of specified tasks.</p>
</dd>
<dt class="hdlist1"><code>-S</code>, <code>--full-stacktrace</code></dt>
<dd>
<p>Print out the full (very verbose) stacktrace for any exceptions. See also <a href="#sec:command_line_logging">logging options</a>.</p>
</dd>
<dt class="hdlist1"><code>-s</code>, <code>--stacktrace</code></dt>
<dd>
<p>Print out the stacktrace also for user exceptions (e.g. compile error). See also <a href="#sec:command_line_logging">logging options</a>.</p>
</dd>
<dt class="hdlist1"><code>--scan</code></dt>
<dd>
<p>Create a <a href="https://gradle.com/build-scans">Build Scan</a> with fine-grained information about all aspects of your Gradle build.</p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.debug=true</code></dt>
<dd>
<p>A <a href="#sec:gradle_configuration_properties">Gradle property</a> that debugs the <a href="#gradle_daemon">Gradle Daemon</a> process. Gradle will wait for you to attach a debugger at <code>localhost:5005</code> by default.</p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.debug.host=(host address)</code></dt>
<dd>
<p>A <a href="#sec:gradle_configuration_properties">Gradle property</a> that specifies the host address to listen on or connect to when debug is enabled.
In the server mode on Java 9 and above, passing <code>*</code> for the host will make the server listen on all network interfaces.
By default, no host address is passed to JDWP, so on Java 9 and above, the loopback address is used, while earlier versions listen on all interfaces.</p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.debug.port=(port number)</code></dt>
<dd>
<p>A <a href="#sec:gradle_configuration_properties">Gradle property</a> that specifies the port number to listen on when debug is enabled. <em>Default is <code>5005</code>.</em></p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.debug.server=(true,false)</code></dt>
<dd>
<p>A <a href="#sec:gradle_configuration_properties">Gradle property</a> that if set to <code>true</code> and debugging is enabled, will cause Gradle to run the build with the socket-attach mode of the debugger. Otherwise, the socket-listen mode is used. <em>Default is <code>true</code>.</em></p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.debug.suspend=(true,false)</code></dt>
<dd>
<p>A <a href="#sec:gradle_configuration_properties">Gradle property</a> that if set to <code>true</code> and debugging is enabled, the JVM running Gradle will suspend until a debugger is attached. <em>Default is <code>true</code>.</em></p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.daemon.debug=true</code></dt>
<dd>
<p>A <a href="#sec:gradle_configuration_properties">Gradle property</a> that debugs the <a href="#gradle_daemon">Gradle Daemon</a> process. (duplicate of <code>-Dorg.gradle.debug</code>)</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_performance"><a class="anchor" href="#sec:command_line_performance"></a><a class="link" href="#sec:command_line_performance">Performance options</a></h4>
<div class="paragraph">
<p>Try these options when optimizing and <a href="#performance_gradle">improving</a> build performance.</p>
</div>
<div class="paragraph">
<p>Many of these options can be <a href="#sec:gradle_configuration_properties">specified</a> in the <code>gradle.properties</code> file, so command-line flags are unnecessary.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--build-cache</code>, <code>--no-build-cache</code></dt>
<dd>
<p>Toggles the <a href="#build_cache">Gradle Build Cache</a>. Gradle will try to reuse outputs from previous builds. <em>Default is off</em>.</p>
</dd>
<dt class="hdlist1"><code>--configuration-cache</code>, <code>--no-configuration-cache</code></dt>
<dd>
<p>Toggles the <a href="#config_cache">Configuration Cache</a>. Gradle will try to reuse the build configuration from previous builds. <em>Default is off</em>.</p>
</dd>
<dt class="hdlist1"><code>--configuration-cache-problems=(fail,warn)</code></dt>
<dd>
<p>Configures how the configuration cache handles problems. Default is <code>fail</code>.</p>
<div class="paragraph">
<p>Set to <code>warn</code> to report problems without failing the build.</p>
</div>
<div class="paragraph">
<p>Set to <code>fail</code> to report problems and fail the build if there are any problems.</p>
</div>
</dd>
<dt class="hdlist1"><code>--configure-on-demand</code>, <code>--no-configure-on-demand</code></dt>
<dd>
<p>Toggles configure-on-demand. Only relevant projects are configured in this build run. <em>Default is off</em>.</p>
</dd>
<dt class="hdlist1"><code>--max-workers</code></dt>
<dd>
<p>Sets the maximum number of workers that Gradle may use. <em>Default is number of processors</em>.</p>
</dd>
<dt class="hdlist1"><code>--parallel</code>, <code>--no-parallel</code></dt>
<dd>
<p>Build projects in parallel. For limitations of this option, see <a href="#parallel_execution">Parallel Project Execution</a>. <em>Default is off</em>.</p>
</dd>
<dt class="hdlist1"><code>--priority</code></dt>
<dd>
<p>Specifies the scheduling priority for the Gradle daemon and all processes launched by it. Values are <code>normal</code> or <code>low</code>. <em>Default is normal</em>.</p>
</dd>
<dt class="hdlist1"><code>--profile</code></dt>
<dd>
<p>Generates a high-level performance report in the <code>layout.buildDirectory.dir("reports/profile")</code> directory. <code>--scan</code> is preferred.</p>
</dd>
<dt class="hdlist1"><code>--scan</code></dt>
<dd>
<p>Generate a build scan with detailed performance diagnostics.</p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-core-test-build-scan-performance.png" alt="Build Scan performance report">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--watch-fs</code>, <code>--no-watch-fs</code></dt>
<dd>
<p>Toggles <a href="#sec:daemon_watch_fs">watching the file system</a>.
When enabled, Gradle reuses information it collects about the file system between builds.
<em>Enabled by default on operating systems where Gradle supports this feature.</em></p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="gradle_daemon_options"><a class="anchor" href="#gradle_daemon_options"></a><a class="link" href="#gradle_daemon_options">Gradle daemon options</a></h5>
<div class="paragraph">
<p>You can manage the <a href="#gradle_daemon">Gradle Daemon</a> through the following command line options.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--daemon</code>, <code>--no-daemon</code></dt>
<dd>
<p>Use the <a href="#gradle_daemon">Gradle Daemon</a> to run the build. Starts the daemon if not running or the existing daemon is busy. <em>Default is on</em>.</p>
</dd>
<dt class="hdlist1"><code>--foreground</code></dt>
<dd>
<p>Starts the Gradle Daemon in a foreground process.</p>
</dd>
<dt class="hdlist1"><code>--status</code> (Standalone command)</dt>
<dd>
<p>Run <code>gradle --status</code> to list running and recently stopped Gradle daemons. It only displays daemons of the same Gradle version.</p>
</dd>
<dt class="hdlist1"><code>--stop</code> (Standalone command)</dt>
<dd>
<p>Run <code>gradle --stop</code> to stop all Gradle Daemons of the same version.</p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.daemon.idletimeout=(number of milliseconds)</code></dt>
<dd>
<p>A <a href="#sec:gradle_configuration_properties">Gradle property</a> wherein the Gradle Daemon will stop itself after this number of milliseconds of idle time. <em>Default is 10800000</em> (3 hours).</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_logging"><a class="anchor" href="#sec:command_line_logging"></a><a class="link" href="#sec:command_line_logging">Logging options</a></h4>
<div class="sect4">
<h5 id="setting_log_level"><a class="anchor" href="#setting_log_level"></a><a class="link" href="#setting_log_level">Setting log level</a></h5>
<div class="paragraph">
<p>You can customize the <a href="#logging">verbosity</a> of Gradle logging with the following options, ordered from least verbose to most verbose.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-Dorg.gradle.logging.level=(quiet,warn,lifecycle,info,debug)</code></dt>
<dd>
<p>A <a href="#sec:gradle_configuration_properties">Gradle property</a> that sets the logging level.</p>
</dd>
<dt class="hdlist1"><code>-q</code>, <code>--quiet</code></dt>
<dd>
<p>Log errors only.</p>
</dd>
<dt class="hdlist1"><code>-w</code>, <code>--warn</code></dt>
<dd>
<p>Set log level to warn.</p>
</dd>
<dt class="hdlist1"><code>-i</code>, <code>--info</code></dt>
<dd>
<p>Set log level to info.</p>
</dd>
<dt class="hdlist1"><code>-d</code>, <code>--debug</code></dt>
<dd>
<p>Log in debug mode (includes normal stacktrace).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Lifecycle</em> is the default log level.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:command_line_customizing_log_format"><a class="anchor" href="#sec:command_line_customizing_log_format"></a><a class="link" href="#sec:command_line_customizing_log_format">Customizing log format</a></h5>
<div class="paragraph">
<p>You can control the use of rich output (colors and font variants) by specifying the console mode in the following ways:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-Dorg.gradle.console=(auto,plain,rich,verbose)</code></dt>
<dd>
<p>A <a href="#sec:gradle_configuration_properties">Gradle property</a> that specifies the console mode. Different modes are described immediately below.</p>
</dd>
<dt class="hdlist1"><code>--console=(auto,plain,rich,verbose)</code></dt>
<dd>
<p>Specifies which type of console output to generate.</p>
<div class="paragraph">
<p>Set to <code>plain</code> to generate plain text only. This option disables all color and other rich output in the console output. This is the default when Gradle is <em>not</em> attached to a terminal.</p>
</div>
<div class="paragraph">
<p>Set to <code>auto</code> (the default) to enable color and other rich output in the console output when the build process is attached to a console or to generate plain text only when not attached to a console. <em>This is the default when Gradle is attached to a terminal.</em></p>
</div>
<div class="paragraph">
<p>Set to <code>rich</code> to enable color and other rich output in the console output, regardless of whether the build process is not attached to a console. When not attached to a console, the build output will use ANSI control characters to generate the rich output.</p>
</div>
<div class="paragraph">
<p>Set to <code>verbose</code> to enable color and other rich output like <code>rich</code> with output task names and outcomes at the lifecycle log level, (as is done by default in Gradle 3.5 and earlier).</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sec:command_line_warnings"><a class="anchor" href="#sec:command_line_warnings"></a><a class="link" href="#sec:command_line_warnings">Showing or hiding warnings</a></h5>
<div class="paragraph">
<p>By default, Gradle won&#8217;t display all warnings (e.g. deprecation warnings). Instead, Gradle will collect them and render a summary at the end of the build like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Deprecated Gradle features were used in this build, making it incompatible with Gradle 5.0.</pre>
</div>
</div>
<div class="paragraph">
<p>You can control the verbosity of warnings on the console with the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-Dorg.gradle.warning.mode=(all,fail,none,summary)</code></dt>
<dd>
<p>A <a href="#sec:gradle_configuration_properties">Gradle property</a> that specifies the warning mode. Different modes are described immediately below.</p>
</dd>
<dt class="hdlist1"><code>--warning-mode=(all,fail,none,summary)</code></dt>
<dd>
<p>Specifies how to log warnings. Default is <code>summary</code>.</p>
<div class="paragraph">
<p>Set to <code>all</code> to log all warnings.</p>
</div>
<div class="paragraph">
<p>Set to <code>fail</code> to log all warnings and fail the build if there are any warnings.</p>
</div>
<div class="paragraph">
<p>Set to <code>summary</code> to suppress all warnings and log a summary at the end of the build.</p>
</div>
<div class="paragraph">
<p>Set to <code>none</code> to suppress all warnings, including the summary at the end of the build.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sec:rich_console"><a class="anchor" href="#sec:rich_console"></a><a class="link" href="#sec:rich_console">Rich console</a></h5>
<div class="paragraph">
<p>Gradle&#8217;s rich console displays extra information while builds are running.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/rich-cli.png" alt="Gradle Rich Console">
</div>
</div>
<div class="paragraph">
<p>Features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Progress bar and timer visually describe the overall status</p>
</li>
<li>
<p>Parallel work-in-progress lines below describe what is happening now</p>
</li>
<li>
<p>Colors and fonts are used to highlight significant output and errors</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_execution_options"><a class="anchor" href="#sec:command_line_execution_options"></a><a class="link" href="#sec:command_line_execution_options">Execution options</a></h4>
<div class="paragraph">
<p>The following options affect how builds are executed by changing what is built or how dependencies are resolved.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--include-build</code></dt>
<dd>
<p>Run the build as a <a href="#composite_builds">composite</a>, including the specified build.</p>
</dd>
<dt class="hdlist1"><code>--offline</code></dt>
<dd>
<p>Specifies that the build should operate <a href="#sec:controlling_dependency_caching_command_line">without accessing network resources</a>.</p>
</dd>
<dt class="hdlist1"><code>-U</code>, <code>--refresh-dependencies</code></dt>
<dd>
<p>Refresh the <a href="#sec:controlling_dependency_caching_command_line">state of dependencies</a>.</p>
</dd>
<dt class="hdlist1"><code>--continue</code></dt>
<dd>
<p><a href="#sec:continue_build_on_failure">Continue task execution</a> after a task failure.</p>
</dd>
<dt class="hdlist1"><code>-m</code>, <code>--dry-run</code></dt>
<dd>
<p>Run Gradle with all task actions disabled. Use this to show which task would have executed.</p>
</dd>
<dt class="hdlist1"><code>-t</code>, <code>--continuous</code></dt>
<dd>
<p>Enables <a href="#sec:continuous_build">continuous build</a>. Gradle does not exit and will re-execute tasks when task file inputs change.</p>
</dd>
<dt class="hdlist1"><code>--write-locks</code></dt>
<dd>
<p>Indicates that all resolved configurations that are <em>lockable</em> should have their <a href="#dependency-locking">lock state</a> persisted.</p>
</dd>
<dt class="hdlist1"><code>--update-locks &lt;group:name&gt;[,&lt;group:name&gt;]*</code></dt>
<dd>
<p>Indicates that versions for the specified modules have to be updated in the <a href="#dependency-locking">lock file</a>.</p>
<div class="paragraph">
<p>This flag also implies <code>--write-locks</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>-a</code>, <code>--no-rebuild</code></dt>
<dd>
<p>Do not rebuild project dependencies.
Useful for <a href="#sec:using_buildsrc">debugging and fine-tuning <code>buildSrc</code></a>, but can lead to wrong results. Use with caution!</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:dependency_verification_options"><a class="anchor" href="#sec:dependency_verification_options"></a><a class="link" href="#sec:dependency_verification_options">Dependency verification options</a></h4>
<div class="paragraph">
<p>Learn more about this in <a href="#verifying-dependencies">dependency verification</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-F=(strict,lenient,off)</code>, <code>--dependency-verification=(strict,lenient,off)</code></dt>
<dd>
<p>Configures the <a href="#sec:disabling-verification">dependency verification mode</a>.</p>
<div class="paragraph">
<p>The default mode is <code>strict</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>-M</code>, <code>--write-verification-metadata</code></dt>
<dd>
<p>Generates checksums for dependencies used in the project (comma-separated list) for <a href="#sec:bootstrapping-verification">dependency verification</a>.</p>
</dd>
<dt class="hdlist1"><code>--refresh-keys</code></dt>
<dd>
<p>Refresh the public keys used for dependency verification.</p>
</dd>
<dt class="hdlist1"><code>--export-keys</code></dt>
<dd>
<p>Exports the public keys used for dependency verification.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:environment_options"><a class="anchor" href="#sec:environment_options"></a><a class="link" href="#sec:environment_options">Environment options</a></h4>
<div class="paragraph">
<p>You can <a href="#build_environment">customize</a> many aspects of build scripts, settings, caches, and so on through the options below.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-b</code>, <code>--build-file</code> (deprecated)</dt>
<dd>
<p>Specifies the build file. For example: <code>gradle --build-file=foo.gradle</code>. The default is <code>build.gradle</code>, then <code>build.gradle.kts</code>.</p>
</dd>
<dt class="hdlist1"><code>-c</code>, <code>--settings-file</code> (deprecated)</dt>
<dd>
<p>Specifies the settings file. For example: <code>gradle --settings-file=somewhere/else/settings.gradle</code></p>
</dd>
<dt class="hdlist1"><code>-g</code>, <code>--gradle-user-home</code></dt>
<dd>
<p>Specifies the Gradle User Home directory. The default is the <code>.gradle</code> directory in the user&#8217;s home directory.</p>
</dd>
<dt class="hdlist1"><code>-p</code>, <code>--project-dir</code></dt>
<dd>
<p>Specifies the start directory for Gradle. Defaults to current directory.</p>
</dd>
<dt class="hdlist1"><code>--project-cache-dir</code></dt>
<dd>
<p>Specifies the project-specific cache directory. Default value is <code>.gradle</code> in the root project directory.</p>
</dd>
<dt class="hdlist1"><code>-D</code>, <code>--system-prop</code></dt>
<dd>
<p>Sets a <a href="#sec:gradle_system_properties">system property</a> of the JVM, for example <code>-Dmyprop=myvalue</code>.</p>
</dd>
<dt class="hdlist1"><code>-I</code>, <code>--init-script</code></dt>
<dd>
<p>Specifies an <a href="#init_scripts">initialization script</a>.</p>
</dd>
<dt class="hdlist1"><code>-P</code>, <code>--project-prop</code></dt>
<dd>
<p>Sets a <a href="#sec:project_properties">project property</a> of the root project, for example <code>-Pmyprop=myvalue</code>.</p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.jvmargs</code></dt>
<dd>
<p>A <a href="#sec:gradle_configuration_properties">Gradle property</a> that sets JVM arguments.</p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.java.home</code></dt>
<dd>
<p>A <a href="#sec:gradle_configuration_properties">Gradle property</a> that sets the JDK home dir.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_options"><a class="anchor" href="#sec:task_options"></a><a class="link" href="#sec:task_options">Task options</a></h4>
<div class="paragraph">
<p>Tasks may define task-specific options which are different from most of the global options described in the sections above (which are interpreted by Gradle itself, can appear anywhere in the command line, and can be listed using the <code>--help</code> option).</p>
</div>
<div class="paragraph">
<p>Task options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Are consumed and interpreted by the tasks themselves;</p>
</li>
<li>
<p><strong>Must</strong> be specified immediately after the task in the command-line;</p>
</li>
<li>
<p>May be listed using <code>gradle help --task someTask</code> (see <a href="#sec:show_task_details">Show task usage details</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To learn how to declare command-line options for your own tasks, see <a href="#sec:declaring_and_using_command_line_options">Declaring and Using Command Line Options</a>.</p>
</div>
<div class="sect4">
<h5 id="sec:builtin_task_options"><a class="anchor" href="#sec:builtin_task_options"></a><a class="link" href="#sec:builtin_task_options">Built-in task options</a></h5>
<div class="paragraph">
<p>Built-in task options are options available as task options for all tasks. At this time, the following built-in task options exist:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--rerun</code></dt>
<dd>
<p>Causes the task to be rerun even if up-to-date. Similar to <code><a href="#sec:rerun_tasks">--rerun-tasks</a></code>, but for a specific task.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_bootstrapping_projects"><a class="anchor" href="#sec:command_line_bootstrapping_projects"></a><a class="link" href="#sec:command_line_bootstrapping_projects">Bootstrapping new projects</a></h4>
<div class="sect4">
<h5 id="creating_new_gradle_builds"><a class="anchor" href="#creating_new_gradle_builds"></a><a class="link" href="#creating_new_gradle_builds">Creating new Gradle builds</a></h5>
<div class="paragraph">
<p>Use the built-in <code>gradle init</code> task to create a new Gradle build, with new or existing projects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle init</pre>
</div>
</div>
<div class="paragraph">
<p>Most of the time, a project type is specified.
Available types include <code>basic</code> (default), <code>java-library</code>, <code>java-application</code>, and more.
See <a href="build_init_plugin.html#build_init_plugin">init plugin documentation</a> for details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle init --type java-library</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="standardize_and_provision_gradle"><a class="anchor" href="#standardize_and_provision_gradle"></a><a class="link" href="#standardize_and_provision_gradle">Standardize and provision Gradle</a></h5>
<div class="paragraph">
<p>The built-in <code>gradle wrapper</code> task generates a script, <code>gradlew</code>, that invokes a declared version of Gradle, downloading it beforehand if necessary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle wrapper --gradle-version=8.1</pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify <code>--distribution-type=(bin|all)</code>, <code>--gradle-distribution-url</code>, <code>--gradle-distribution-sha256-sum</code> in addition to <code>--gradle-version</code>.<br>
Full details on using these options are documented in the <a href="#gradle_wrapper_reference">Gradle wrapper section</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:continuous_build"><a class="anchor" href="#sec:continuous_build"></a><a class="link" href="#sec:continuous_build">Continuous build</a></h4>
<div class="paragraph">
<p>Continuous Build allows you to automatically re-execute the requested tasks when file inputs change.
You can execute the build in this mode using the <code>-t</code> or <code>--continuous</code> command-line option.</p>
</div>
<div class="paragraph">
<p>For example, you can continuously run the <code>test</code> task and all dependent tasks by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle test --continuous</pre>
</div>
</div>
<div class="paragraph">
<p>Gradle will behave as if you ran <code>gradle test</code> after a change to sources or tests that contribute to the requested tasks.
This means unrelated changes (such as changes to build scripts) will not trigger a rebuild.
To incorporate build logic changes, the continuous build must be restarted manually.</p>
</div>
<div class="paragraph">
<p>Continuous build uses <a href="#sec:daemon_watch_fs">file system watching</a> to detect changes to the inputs.
If file system watching does not work on your system, then continuous build won&#8217;t work either.
In particular, continuous build does not work when using <code>--no-daemon</code>.</p>
</div>
<div class="paragraph">
<p>When Gradle detects a change to the inputs, it will not trigger the build immediately.
Instead, it will wait until no additional changes are detected for a certain period of time - the quiet period.
You can configure the quiet period in milliseconds by the Gradle property <code><a href="#sec:gradle_configuration_properties">org.gradle.continuous.quietperiod</a></code>.</p>
</div>
<div class="sect4">
<h5 id="terminating_continuous_build_2"><a class="anchor" href="#terminating_continuous_build_2"></a><a class="link" href="#terminating_continuous_build_2">Terminating Continuous Build</a></h5>
<div class="paragraph">
<p>If Gradle is attached to an interactive input source, such as a terminal, the continuous build can be exited by pressing <code>CTRL-D</code> (On Microsoft Windows, it is required to also press <code>ENTER</code> or <code>RETURN</code> after <code>CTRL-D</code>).</p>
</div>
<div class="paragraph">
<p>If Gradle is not attached to an interactive input source (e.g. is running as part of a script), the build process must be terminated (e.g. using the <code>kill</code> command or similar).</p>
</div>
<div class="paragraph">
<p>If the build is being executed via the Tooling API, the build can be cancelled using the Tooling API&#8217;s cancellation mechanism.</p>
</div>
<div class="paragraph">
<p>Learn more in <a href="#continuous_builds">Continuous Builds</a> Continuous Builds.</p>
</div>
<div class="sect5">
<h6 id="sec:changes_to_symbolic_links"><a class="anchor" href="#sec:changes_to_symbolic_links"></a><a class="link" href="#sec:changes_to_symbolic_links">Changes to symbolic links</a></h6>
<div class="paragraph">
<p>In general, Gradle will not detect changes to symbolic links or to files referenced via symbolic links.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:changes_to_build_logic_are_not_considered"><a class="anchor" href="#sec:changes_to_build_logic_are_not_considered"></a><a class="link" href="#sec:changes_to_build_logic_are_not_considered">Changes to build logic are not considered</a></h6>
<div class="paragraph">
<p>The current implementation does not recalculate the build model on subsequent builds.
This means that changes to task configuration, or any other change to the build model, are effectively ignored.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gradle_wrapper_reference"><a class="anchor" href="#gradle_wrapper_reference"></a><a class="link" href="#gradle_wrapper_reference">Gradle Wrapper Reference</a></h3>
<div class="paragraph">
<p>The <strong>recommended way to execute any Gradle build</strong> is with the help of the Gradle Wrapper (referred to as "Wrapper").</p>
</div>
<div class="paragraph">
<p>The Wrapper is a script that invokes a declared version of Gradle, downloading it beforehand if necessary.
As a result, developers can get up and running with a Gradle project quickly.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/wrapper-workflow.png" alt="wrapper workflow">
</div>
</div>
<div class="paragraph">
<p>In a nutshell, you gain the following benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Standardizes a project on a given Gradle version for more reliable and robust builds.</p>
</li>
<li>
<p>Provisioning the Gradle version for different users is done with a simple Wrapper definition change.</p>
</li>
<li>
<p>Provisioning the Gradle version for different execution environments (e.g., IDEs or Continuous Integration servers) is done with a simple Wrapper definition change.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are three ways to use the Wrapper:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You set up a new Gradle project and <a href="#sec:adding_wrapper">add the Wrapper</a> to it.</p>
</li>
<li>
<p>You <a href="#sec:using_wrapper">run a project with the Wrapper</a> that already provides it.</p>
</li>
<li>
<p>You <a href="#sec:upgrading_wrapper">upgrade the Wrapper</a> to a new version of Gradle.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following sections explain each of these use cases in more detail.</p>
</div>
<div class="sect3">
<h4 id="sec:adding_wrapper"><a class="anchor" href="#sec:adding_wrapper"></a><a class="link" href="#sec:adding_wrapper">Adding the Gradle Wrapper</a></h4>
<div class="paragraph">
<p>Generating the Wrapper files requires an installed version of the Gradle runtime on your machine as described in <a href="#installation">Installation</a>.
Thankfully, generating the initial Wrapper files is a one-time process.</p>
</div>
<div class="paragraph">
<p>Every vanilla Gradle build comes with a built-in task called <code>wrapper</code>.
The task is listed under the group "Build Setup tasks" when <a href="#sec:listing_tasks">listing the tasks</a>.</p>
</div>
<div class="paragraph">
<p>Executing the <code>wrapper</code> task generates the necessary Wrapper files in the project directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle wrapper</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Task :wrapper

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>To make the Wrapper files available to other developers and execution environments, you need to check them into version control.
Wrapper files, including the JAR file, are small.
Adding the JAR file to version control is expected.
Some organizations do not allow projects to submit binary files to version control, and there is no workaround available.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The generated Wrapper properties file, <code>gradle/wrapper/gradle-wrapper.properties</code>, stores the information about the Gradle distribution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>server hosting</strong> the Gradle distribution.</p>
</li>
<li>
<p>The <strong>type of Gradle distribution</strong>. By default, the <code>-bin</code> distribution contains only the runtime but no sample code and documentation.</p>
</li>
<li>
<p>The <strong>Gradle version</strong> used for executing the build. By default, the <code>wrapper</code> task picks the same Gradle version used to generate the Wrapper files.</p>
</li>
<li>
<p>Optionally, a <strong>timeout</strong> in ms used when downloading the Gradle distribution.</p>
</li>
<li>
<p>Optionally, a <strong>boolean</strong> to set the <strong>validation of the distribution</strong> URL.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example of the generated distribution URL in <code>gradle/wrapper/gradle-wrapper.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">distributionUrl=https\://services.gradle.org/distributions/gradle-8.9-bin.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>All of those aspects are configurable at the time of generating the Wrapper files with the help of the following command line options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--gradle-version</code></dt>
<dd>
<p>The Gradle version used for downloading and executing the Wrapper.
The resulting distribution URL is validated before it is written to the properties file.</p>
<div class="paragraph">
<p>The following labels are allowed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="https://gradle.org/releases">latest</a></code></p>
</li>
<li>
<p><code><a href="https://gradle.org/release-candidate">release-candidate</a></code></p>
</li>
<li>
<p><code><a href="https://gradle.org/nightly">nightly</a></code></p>
</li>
<li>
<p><code><a href="https://gradle.org/release-nightly">release-nightly</a></code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>--distribution-type</code></dt>
<dd>
<p>The Gradle distribution type used for the Wrapper.
Available options are <code>bin</code> and <code>all</code>.
The default value is <code>bin</code>.</p>
</dd>
<dt class="hdlist1"><code>--gradle-distribution-url</code></dt>
<dd>
<p>The full URL pointing to the Gradle distribution ZIP file.
This option makes <code>--gradle-version</code> and <code>--distribution-type</code> obsolete, as the URL already contains this information.
This option is valuable if you want to host the Gradle distribution inside your company&#8217;s network.
The URL is validated before it is written to the properties file.</p>
</dd>
<dt class="hdlist1"><code>--gradle-distribution-sha256-sum</code></dt>
<dd>
<p>The SHA256 hash sum used for <a href="#sec:verification">verifying the downloaded Gradle distribution</a>.</p>
</dd>
<dt class="hdlist1"><code>--network-timeout</code></dt>
<dd>
<p>The network timeout to use when downloading the Gradle distribution, in ms. The default value is <code>10000</code>.</p>
</dd>
<dt class="hdlist1"><code>--no-validate-url</code></dt>
<dd>
<p>Disables the validation of the configured distribution URL.</p>
</dd>
<dt class="hdlist1"><code>--validate-url</code></dt>
<dd>
<p>Enables the validation of the configured distribution URL. Enabled by default.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If the distribution URL is configured with <code>--gradle-version</code> or <code>--gradle-distribution-url</code>, the URL is validated by sending a HEAD request in the case of the <code>https</code> scheme or by checking the existence of the file in the case of the <code>file</code> scheme.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume the following use-case to illustrate the use of the command line options.
You would like to generate the Wrapper with version 8.9 and use the <code>-all</code> distribution to enable your IDE to enable code-completion and being able to navigate to the Gradle source code.</p>
</div>
<div class="paragraph">
<p>The following command-line execution captures those requirements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle wrapper --gradle-version 8.9 --distribution-type all
&gt; Task :wrapper

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>As a result, you can find the desired information (the generated distribution URL) in the Wrapper properties file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">distributionUrl=https\://services.gradle.org/distributions/gradle-8.9-all.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the following project layout to illustrate the expected Wrapper files:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
├── a-subproject
│   └── build.gradle.kts
├── settings.gradle.kts
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew
└── gradlew.bat</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error">├</span><span class="error">─</span><span class="error">─</span> a-subproject
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> build.gradle
<span class="error">├</span><span class="error">─</span><span class="error">─</span> settings.gradle
<span class="error">├</span><span class="error">─</span><span class="error">─</span> gradle
<span class="error">│</span>   <span class="error">└</span><span class="error">─</span><span class="error">─</span> wrapper
<span class="error">│</span>       <span class="error">├</span><span class="error">─</span><span class="error">─</span> gradle-wrapper.jar
<span class="error">│</span>       <span class="error">└</span><span class="error">─</span><span class="error">─</span> gradle-wrapper.properties
<span class="error">├</span><span class="error">─</span><span class="error">─</span> gradlew
<span class="error">└</span><span class="error">─</span><span class="error">─</span> gradlew.bat</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A Gradle project typically provides a <code>settings.gradle(.kts)</code> file and one <code>build.gradle(.kts)</code> file for each subproject.
The Wrapper files live alongside in the <code>gradle</code> directory and the root directory of the project.</p>
</div>
<div class="paragraph">
<p>The following list explains their purpose:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>gradle-wrapper.jar</code></dt>
<dd>
<p>The Wrapper JAR file containing code for downloading the Gradle distribution.</p>
</dd>
<dt class="hdlist1"><code>gradle-wrapper.properties</code></dt>
<dd>
<p>A properties file responsible for configuring the Wrapper runtime behavior e.g. the Gradle version compatible with this version. Note that more generic settings, like <a href="#sec:accessing_the_web_via_a_proxy">configuring the Wrapper to use a proxy</a>, need to go into a <a href="#sec:gradle_configuration_properties">different file</a>.</p>
</dd>
<dt class="hdlist1"><code>gradlew</code>, <code>gradlew.bat</code></dt>
<dd>
<p>A shell script and a Windows batch script for executing the build with the Wrapper.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can go ahead and <a href="#sec:using_wrapper">execute the build with the Wrapper</a> without installing the Gradle runtime.
If the project you are working on does not contain those Wrapper files, you will need to <a href="#sec:adding_wrapper">generate them</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:using_wrapper"><a class="anchor" href="#sec:using_wrapper"></a><a class="link" href="#sec:using_wrapper">Using the Gradle Wrapper</a></h4>
<div class="paragraph">
<p>It is always recommended to execute a build with the Wrapper to ensure a reliable, controlled, and standardized execution of the build.
Using the Wrapper looks like running the build with a Gradle installation.
Depending on the operating system you either run <code>gradlew</code> or <code>gradlew.bat</code> instead of the <code>gradle</code> command.</p>
</div>
<div class="paragraph">
<p>The following console output demonstrates the use of the Wrapper on a Windows machine for a Java-based project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradlew.bat build
Downloading https://services.gradle.org/distributions/gradle-5.0-all.zip
.....................................................................................
Unzipping C:\Documents and Settings\Claudia\.gradle\wrapper\dists\gradle-5.0-all\ac27o8rbd0ic8ih41or9l32mv\gradle-5.0-all.zip to C:\Documents and Settings\Claudia\.gradle\wrapper\dists\gradle-5.0-al\ac27o8rbd0ic8ih41or9l32mv
Set executable permissions for: C:\Documents and Settings\Claudia\.gradle\wrapper\dists\gradle-5.0-all\ac27o8rbd0ic8ih41or9l32mv\gradle-5.0\bin\gradle

BUILD SUCCESSFUL in 12s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>If the Gradle distribution is unavailable on the machine, the Wrapper will download it and store it in the local file system.
Any subsequent build invocation will reuse the existing local distribution as long as the distribution URL in the Gradle properties doesn&#8217;t change.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Wrapper shell script and batch file reside in the root directory of a single or multi-project Gradle build. You will need to reference the correct path to those files in case you want to execute the build from a subproject directory e.g. <code>../../gradlew tasks</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:upgrading_wrapper"><a class="anchor" href="#sec:upgrading_wrapper"></a><a class="link" href="#sec:upgrading_wrapper">Upgrading the Gradle Wrapper</a></h4>
<div class="paragraph">
<p>Projects typically want to keep up with the times and upgrade their Gradle version to benefit from new features and improvements.</p>
</div>
<div class="paragraph">
<p>One way to upgrade the Gradle version is by manually changing the <code>distributionUrl</code> property in the Wrapper&#8217;s <code>gradle-wrapper.properties</code> file.</p>
</div>
<div class="paragraph">
<p>The better and recommended option is to run the <code>wrapper</code> task and provide the target Gradle version as described in <a href="#sec:adding_wrapper">Adding the Gradle Wrapper</a>.
Using the <code>wrapper</code> task ensures that any optimizations made to the Wrapper shell script or batch file with that specific Gradle version are applied to the project.</p>
</div>
<div class="paragraph">
<p>As usual, you should commit the changes to the Wrapper files to version control.</p>
</div>
<div class="paragraph">
<p>Note that running the wrapper task once will update <code>gradle-wrapper.properties</code> only, but leave the wrapper itself in <code>gradle-wrapper.jar</code> untouched.
This is usually fine as new versions of Gradle can be run even with older wrapper files.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you want <strong>all</strong> the wrapper files to be completely up-to-date, you will need to run the <code>wrapper</code> task a second time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following command upgrades the Wrapper to the <code>latest</code> version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew wrapper --gradle-version latest

BUILD SUCCESSFUL in 4s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>The following command upgrades the Wrapper to a specific version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew wrapper --gradle-version 8.9

BUILD SUCCESSFUL in 4s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Once you have upgraded the wrapper, you can check that it&#8217;s the version you expected by executing <code>./gradlew --version</code>.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t forget to run the <code>wrapper</code> task again to download the Gradle distribution binaries (if needed) and update the <code>gradlew</code> and <code>gradlew.bat</code> files.</p>
</div>
</div>
<div class="sect3">
<h4 id="customizing_wrapper"><a class="anchor" href="#customizing_wrapper"></a><a class="link" href="#customizing_wrapper">Customizing the Gradle Wrapper</a></h4>
<div class="paragraph">
<p>Most users of Gradle are happy with the default runtime behavior of the Wrapper.
However, organizational policies, security constraints or personal preferences might require you to dive deeper into customizing the Wrapper.</p>
</div>
<div class="paragraph">
<p>Thankfully, the built-in <code>wrapper</code> task exposes numerous options to bend the runtime behavior to your needs.
Most configuration options are exposed by the underlying task type <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.wrapper.Wrapper.html">Wrapper</a>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume you grew tired of defining the <code>-all</code> distribution type on the command line every time you upgrade the Wrapper.
You can save yourself some keyboard strokes by re-configuring the <code>wrapper</code> task.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.wrapper {
    distributionType = Wrapper.DistributionType.ALL
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">wrapper</span><span class="delimiter">'</span></span>) {
    distributionType = Wrapper.DistributionType.ALL
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the configuration in place, running <code>./gradlew wrapper --gradle-version 8.9</code> is enough to produce a <code>distributionUrl</code> value in the Wrapper properties file that will request the <code>-all</code> distribution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>distributionUrl=https\://services.gradle.org/distributions/gradle-8.9-all.zip</pre>
</div>
</div>
<div class="paragraph">
<p>Check out the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/package-summary.html">API documentation</a> for a more detailed description of the available configuration options. You can also find <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/tasks/wrapper/Wrapper.html">various samples for configuring the Wrapper</a> in the Gradle distribution.</p>
</div>
<div class="sect4">
<h5 id="sec:authenticated_download"><a class="anchor" href="#sec:authenticated_download"></a><a class="link" href="#sec:authenticated_download">Authenticated Gradle distribution download</a></h5>
<div class="paragraph">
<p>The Gradle <code>Wrapper</code> can download Gradle distributions from servers using HTTP Basic Authentication.
This enables you to host the Gradle distribution on a private protected server.</p>
</div>
<div class="paragraph">
<p>You can specify a username and password in two different ways depending on your use case: as system properties or directly embedded in the <code>distributionUrl</code>.
Credentials in system properties take precedence over the ones embedded in <code>distributionUrl</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>HTTP Basic Authentication should only be used with <code>HTTPS</code> URLs and not plain <code>HTTP</code> ones.
With Basic Authentication, the user credentials are sent in clear text.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>System properties can be specified in the <code>.gradle/gradle.properties</code> file in the user&#8217;s home directory or by other <a href="#sec:gradle_configuration_properties">means</a>.</p>
</div>
<div class="paragraph">
<p>To specify the HTTP Basic Authentication credentials, add the following lines to the system properties file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">systemProp.gradle.wrapperUser=username
systemProp.gradle.wrapperPassword=password</code></pre>
</div>
</div>
<div class="paragraph">
<p>Embedding credentials in the <code>distributionUrl</code> in the <code>gradle/wrapper/gradle-wrapper.properties</code> file also works.
Please note that this file is to be committed into your source control system.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Shared credentials embedded in <code>distributionUrl</code> should only be used in a controlled environment.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To specify the HTTP Basic Authentication credentials in <code>distributionUrl</code>, add the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>distributionUrl=https://username:password@somehost/path/to/gradle-distribution.zip</pre>
</div>
</div>
<div class="paragraph">
<p>This can be used in conjunction with a proxy, authenticated or not.
See <a href="#sec:accessing_the_web_via_a_proxy">Accessing the web via a proxy</a> for more information on how to configure the <code>Wrapper</code> to use a proxy.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:verification"><a class="anchor" href="#sec:verification"></a><a class="link" href="#sec:verification">Verification of downloaded Gradle distributions</a></h5>
<div class="paragraph">
<p>The Gradle Wrapper allows for verification of the downloaded Gradle distribution via SHA-256 hash sum comparison.
This increases security against targeted attacks by preventing a man-in-the-middle attacker from tampering with the downloaded Gradle distribution.</p>
</div>
<div class="paragraph">
<p>To enable this feature, download the <code>.sha256</code> file associated with the Gradle distribution you want to verify.</p>
</div>
<div class="sect5">
<h6 id="downloading_the_sha_256_file"><a class="anchor" href="#downloading_the_sha_256_file"></a><a class="link" href="#downloading_the_sha_256_file">Downloading the SHA-256 file</a></h6>
<div class="paragraph">
<p>You can download the <code>.sha256</code> file from the <a href="https://services.gradle.org/distributions/">stable releases</a> or <a href="https://services.gradle.org/distributions-snapshots/">release candidate and nightly releases</a>.
The format of the file is a single line of text that is the SHA-256 hash of the corresponding zip file.</p>
</div>
<div class="paragraph">
<p>You can also reference the <a href="https://gradle.org/release-checksums/">list of Gradle distribution checksums</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="configuring_checksum_verification"><a class="anchor" href="#configuring_checksum_verification"></a><a class="link" href="#configuring_checksum_verification">Configuring checksum verification</a></h6>
<div class="paragraph">
<p>Add the downloaded (SHA-256 checksum) hash sum to <code>gradle-wrapper.properties</code> using the <code>distributionSha256Sum</code> property or use <code>--gradle-distribution-sha256-sum</code> on the command-line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">distributionSha256Sum=371cb9fbebbe9880d147f59bab36d61eee122854ef8c9ee1ecf12b82368bcf10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle will report a build failure if the configured checksum does not match the checksum found on the server hosting the distribution.
Checksum verification is only performed if the configured Wrapper distribution hasn&#8217;t been downloaded yet.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>Wrapper</code> task fails if <code>gradle-wrapper.properties</code> contains <code>distributionSha256Sum</code>, but the task configuration does not define a sum.
Executing the <code>Wrapper</code> task preserves the <code>distributionSha256Sum</code> configuration when the Gradle version does not change.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="wrapper_checksum_verification"><a class="anchor" href="#wrapper_checksum_verification"></a><a class="link" href="#wrapper_checksum_verification">Verifying the integrity of the Gradle Wrapper JAR</a></h4>
<div class="paragraph">
<p>The Wrapper JAR is a binary file that will be executed on the computers of developers and build servers.
As with all such files, you should ensure it&#8217;s trustworthy before executing it.</p>
</div>
<div class="paragraph">
<p>Since the Wrapper JAR is usually checked into a project&#8217;s version control system, there is the potential for a malicious actor to replace the original JAR with a modified one by submitting a pull request that only upgrades the Gradle version.</p>
</div>
<div class="paragraph">
<p>To verify the integrity of the Wrapper JAR, Gradle has created a <a href="https://github.com/marketplace/actions/gradle-wrapper-validation">GitHub Action</a> that automatically checks Wrapper JARs in pull requests against a list of known good checksums.</p>
</div>
<div class="paragraph">
<p>Gradle also publishes the <a href="https://gradle.org/release-checksums/">checksums of all releases</a> (except for version 3.3 to 4.0.2, which did not generate reproducible JARs), so you can manually verify the integrity of the Wrapper JAR.</p>
</div>
<div class="sect4">
<h5 id="automatically_verifying_the_gradle_wrapper_jar_on_github"><a class="anchor" href="#automatically_verifying_the_gradle_wrapper_jar_on_github"></a><a class="link" href="#automatically_verifying_the_gradle_wrapper_jar_on_github">Automatically verifying the Gradle Wrapper JAR on GitHub</a></h5>
<div class="paragraph">
<p>The <a href="https://github.com/marketplace/actions/gradle-wrapper-validation">GitHub Action</a> is released separately from Gradle, so please check its documentation for how to apply it to your project.</p>
</div>
</div>
<div class="sect4">
<h5 id="manually_verifying_the_gradle_wrapper_jar"><a class="anchor" href="#manually_verifying_the_gradle_wrapper_jar"></a><a class="link" href="#manually_verifying_the_gradle_wrapper_jar">Manually verifying the Gradle Wrapper JAR</a></h5>
<div class="paragraph">
<p>You can manually verify the checksum of the Wrapper JAR to ensure that it has not been tampered with by running the following commands on one of the major operating systems.</p>
</div>
<div class="paragraph">
<p>Manually verifying the checksum of the Wrapper JAR on Linux:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd gradle/wrapper</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl --location --output gradle-wrapper.jar.sha256 \
       https://services.gradle.org/distributions/gradle-{gradleVersion}-wrapper.jar.sha256</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ echo " gradle-wrapper.jar" &gt;&gt; gradle-wrapper.jar.sha256</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ sha256sum --check gradle-wrapper.jar.sha256</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle-wrapper.jar: OK</pre>
</div>
</div>
<div class="paragraph">
<p>Manually verifying the checksum of the Wrapper JAR on macOS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd gradle/wrapper</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl --location --output gradle-wrapper.jar.sha256 \
       https://services.gradle.org/distributions/gradle-{gradleVersion}-wrapper.jar.sha256</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ echo " gradle-wrapper.jar" &gt;&gt; gradle-wrapper.jar.sha256</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ shasum --check gradle-wrapper.jar.sha256</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle-wrapper.jar: OK</pre>
</div>
</div>
<div class="paragraph">
<p>Manually verifying the checksum of the Wrapper JAR on Windows (using PowerShell):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="powershell">&gt; $expected = Invoke-RestMethod -Uri https://services.gradle.org/distributions/gradle-8.9-wrapper.jar.sha256</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; $actual = (Get-FileHash gradle\wrapper\gradle-wrapper.jar -Algorithm SHA256).Hash.ToLower()</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; @{$true = 'OK: Checksum match'; $false = "ERROR: Checksum mismatch!`nExpected: $expected`nActual:   $actual"}[$actual -eq $expected]</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>OK: Checksum match</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="troubleshooting_a_checksum_mismatch"><a class="anchor" href="#troubleshooting_a_checksum_mismatch"></a><a class="link" href="#troubleshooting_a_checksum_mismatch">Troubleshooting a checksum mismatch</a></h5>
<div class="paragraph">
<p>If the checksum does not match the one you expected, chances are the <code>wrapper</code> task wasn&#8217;t executed with the upgraded Gradle distribution.</p>
</div>
<div class="paragraph">
<p>You should first check whether the actual checksum matches a different Gradle version.</p>
</div>
<div class="paragraph">
<p>Here are the commands you can run on the major operating systems to generate the actual checksum of the Wrapper JAR.</p>
</div>
<div class="paragraph">
<p>Generating the checksum of the Wrapper JAR on Linux:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ sha256sum gradle/wrapper/gradle-wrapper.jar
d81e0f23ade952b35e55333dd5f1821585e887c6d24305aeea2fbc8dad564b95 gradle/wrapper/gradle-wrapper.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generating the actual checksum of the Wrapper JAR on macOS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shasum --algorithm=256 gradle/wrapper/gradle-wrapper.jar
d81e0f23ade952b35e55333dd5f1821585e887c6d24305aeea2fbc8dad564b95 gradle/wrapper/gradle-wrapper.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generating the actual checksum of the Wrapper JAR on Windows (using PowerShell):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="powershell">&gt; (Get-FileHash gradle\wrapper\gradle-wrapper.jar -Algorithm SHA256).Hash.ToLower()
d81e0f23ade952b35e55333dd5f1821585e887c6d24305aeea2fbc8dad564b95</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you know the actual checksum, check whether it&#8217;s listed on <a href="https://gradle.org/release-checksums/" class="bare">https://gradle.org/release-checksums/</a>.
If it is listed, you have verified the integrity of the Wrapper JAR.
If the version of Gradle that generated the Wrapper JAR doesn&#8217;t match the version in <code>gradle/wrapper/gradle-wrapper.properties</code>, it&#8217;s safe to run the <code>wrapper</code> task again to update the Wrapper JAR.</p>
</div>
<div class="paragraph">
<p>If the checksum is not listed on the page, the Wrapper JAR might be from a milestone, release candidate, or nightly build or may have been generated by Gradle 3.3 to 4.0.2.
Try to find out how it was generated but treat it as untrustworthy until proven otherwise.
If you think the Wrapper JAR was compromised, please let the Gradle team know by sending an email to <a href="mailto:security@gradle.com">security@gradle.com</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="plugin_reference"><a class="anchor" href="#plugin_reference"></a><a class="link" href="#plugin_reference">Gradle Plugin Reference</a></h3>
<div class="paragraph">
<p>This page contains links and short descriptions for all the core plugins provided by Gradle itself.</p>
</div>
<div class="sect3">
<h4 id="jvm_languages_and_frameworks"><a class="anchor" href="#jvm_languages_and_frameworks"></a><a class="link" href="#jvm_languages_and_frameworks">JVM languages and frameworks</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="java_plugin.html#java_plugin">Java</a></dt>
<dd>
<p>Provides support for building any type of Java project.</p>
</dd>
<dt class="hdlist1"><a href="#java_library_plugin">Java Library</a></dt>
<dd>
<p>Provides support for building a Java library.</p>
</dd>
<dt class="hdlist1"><a href="#java_platform_plugin">Java Platform</a></dt>
<dd>
<p>Provides support for building a Java platform.</p>
</dd>
<dt class="hdlist1"><a href="#groovy_plugin">Groovy</a></dt>
<dd>
<p>Provides support for building any type of <a href="https://groovy-lang.org/">Groovy</a> project.</p>
</dd>
<dt class="hdlist1"><a href="#scala_plugin">Scala</a></dt>
<dd>
<p>Provides support for building any type of <a href="https://www.scala-lang.org/">Scala</a> project.</p>
</dd>
<dt class="hdlist1"><a href="antlr_plugin.html#antlr_plugin">ANTLR</a></dt>
<dd>
<p>Provides support for generating parsers using <a href="http://www.antlr.org/">ANTLR</a>.</p>
</dd>
<dt class="hdlist1"><a href="jvm_test_suite_plugin.html#jvm_test_suite_plugin">JVM Test Suite</a></dt>
<dd>
<p>Provides support for modeling and configuring multiple test suite invocations.</p>
</dd>
<dt class="hdlist1"><a href="test_report_aggregation_plugin.html#test_report_aggregation_plugin">Test Report Aggregation</a></dt>
<dd>
<p>Aggregates the results of multiple <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.tasks.testing.Test.html">Test</a> task invocations (potentially spanning multiple Gradle projects) into a single HTML report.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="native_languages"><a class="anchor" href="#native_languages"></a><a class="link" href="#native_languages">Native languages</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="cpp_application_plugin.html#cpp_application_plugin">C++ Application</a></dt>
<dd>
<p>Provides support for building C++ applications on Windows, Linux, and macOS.</p>
</dd>
<dt class="hdlist1"><a href="cpp_library_plugin.html#cpp_library_plugin">C++ Library</a></dt>
<dd>
<p>Provides support for building C++ libraries on Windows, Linux, and macOS.</p>
</dd>
<dt class="hdlist1"><a href="cpp_unit_test_plugin.html#cpp_unit_test_plugin">C++ Unit Test</a></dt>
<dd>
<p>Provides support for building and running C++ executable-based tests on Windows, Linux, and macOS.</p>
</dd>
<dt class="hdlist1"><a href="swift_application_plugin.html#swift_application_plugin">Swift Application</a></dt>
<dd>
<p>Provides support for building Swift applications on Linux and macOS.</p>
</dd>
<dt class="hdlist1"><a href="swift_library_plugin.html#swift_library_plugin">Swift Library</a></dt>
<dd>
<p>Provides support for building Swift libraries on Linux and macOS.</p>
</dd>
<dt class="hdlist1"><a href="xctest_plugin.html#xctest_plugin">XCTest</a></dt>
<dd>
<p>Provides support for building and running XCTest-based tests on Linux and macOS.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="packaging_and_distribution"><a class="anchor" href="#packaging_and_distribution"></a><a class="link" href="#packaging_and_distribution">Packaging and distribution</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#application_plugin">Application</a></dt>
<dd>
<p>Provides support for building JVM-based, runnable applications.</p>
</dd>
<dt class="hdlist1"><a href="war_plugin.html#war_plugin">WAR</a></dt>
<dd>
<p>Provides support for building and packaging WAR-based Java web applications.</p>
</dd>
<dt class="hdlist1"><a href="ear_plugin.html#ear_plugin">EAR</a></dt>
<dd>
<p>Provides support for building and packaging Java EE applications.</p>
</dd>
<dt class="hdlist1"><a href="#publishing_maven">Maven Publish</a></dt>
<dd>
<p>Provides support for <a href="#publishing_components">publishing artifacts</a> to Maven-compatible repositories.</p>
</dd>
<dt class="hdlist1"><a href="#publishing_ivy">Ivy Publish</a></dt>
<dd>
<p>Provides support for <a href="#publishing_components">publishing artifacts</a> to Ivy-compatible repositories.</p>
</dd>
<dt class="hdlist1"><a href="distribution_plugin.html#distribution_plugin">Distribution</a></dt>
<dd>
<p>Makes it easy to create ZIP and tarball distributions of your project.</p>
</dd>
<dt class="hdlist1"><a href="java_library_distribution_plugin.html#java_library_distribution_plugin">Java Library Distribution</a></dt>
<dd>
<p>Provides support for creating a ZIP distribution of a Java library project that includes its runtime dependencies.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="code_analysis"><a class="anchor" href="#code_analysis"></a><a class="link" href="#code_analysis">Code analysis</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="checkstyle_plugin.html#checkstyle_plugin">Checkstyle</a></dt>
<dd>
<p>Performs quality checks on your project’s Java source files using <a href="https://checkstyle.org/index.html">Checkstyle</a> and generates associated reports.</p>
</dd>
<dt class="hdlist1"><a href="pmd_plugin.html#pmd_plugin">PMD</a></dt>
<dd>
<p>Performs quality checks on your project’s Java source files using <a href="http://pmd.github.io/">PMD</a> and generates associated reports.</p>
</dd>
<dt class="hdlist1"><a href="jacoco_plugin.html#jacoco_plugin">JaCoCo</a></dt>
<dd>
<p>Provides code coverage metrics for your Java project using <a href="http://www.eclemma.org/jacoco/">JaCoCo</a>.</p>
</dd>
<dt class="hdlist1"><a href="jacoco_report_aggregation_plugin.html#jacoco_report_aggregation_plugin">JaCoCo Report Aggregation</a></dt>
<dd>
<p>Aggregates the results of multiple JaCoCo code coverage reports (potentially spanning multiple Gradle projects) into a single HTML report.</p>
</dd>
<dt class="hdlist1"><a href="codenarc_plugin.html#codenarc_plugin">CodeNarc</a></dt>
<dd>
<p>Performs quality checks on your Groovy source files using <a href="https://codenarc.org/">CodeNarc</a> and generates associated reports.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ide_integration_2"><a class="anchor" href="#ide_integration_2"></a><a class="link" href="#ide_integration_2">IDE integration</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="eclipse_plugin.html#eclipse_plugin">Eclipse</a></dt>
<dd>
<p>Generates Eclipse project files for the build that can be opened by the IDE. This set of plugins can also be used to fine tune <a href="http://projects.eclipse.org/projects/tools.buildship">Buildship&#8217;s</a> import process for Gradle builds.</p>
</dd>
<dt class="hdlist1"><a href="idea_plugin.html#idea_plugin">IntelliJ IDEA</a></dt>
<dd>
<p>Generates IDEA project files for the build that can be opened by the IDE. It can also be used to fine tune IDEA&#8217;s import process for Gradle builds.</p>
</dd>
<dt class="hdlist1"><a href="visual_studio_plugin.html#visual_studio_plugin">Visual Studio</a></dt>
<dd>
<p>Generates Visual Studio solution and project files for build that can be opened by the IDE.</p>
</dd>
<dt class="hdlist1"><a href="xcode_plugin.html#xcode_plugin">Xcode</a></dt>
<dd>
<p>Generates Xcode workspace and project files for the build that can be opened by the IDE.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="utility"><a class="anchor" href="#utility"></a><a class="link" href="#utility">Utility</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="base_plugin.html#base_plugin">Base</a></dt>
<dd>
<p>Provides common lifecycle tasks, such as <code>clean</code>, and other features common to most builds.</p>
</dd>
<dt class="hdlist1"><a href="build_init_plugin.html#build_init_plugin">Build Init</a></dt>
<dd>
<p>Generates a new Gradle build of a specified type, such as a Java library. It can also generate a build script from a Maven POM — see <a href="migrating_from_maven.html#migrating_from_maven">Migrating from Maven to Gradle</a> for more details.</p>
</dd>
<dt class="hdlist1"><a href="signing_plugin.html#signing_plugin">Signing</a></dt>
<dd>
<p>Provides support for digitally signing generated files and artifacts.</p>
</dd>
<dt class="hdlist1"><a href="java_gradle_plugin.html#java_gradle_plugin">Plugin Development</a></dt>
<dd>
<p>Makes it easier to develop and publish a Gradle plugin.</p>
</dd>
<dt class="hdlist1"><a href="project_report_plugin.html#project_report_plugin">Project Report Plugin</a></dt>
<dd>
<p>Helps to generate reports containing useful information about your build.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="third_party_integration"><a class="anchor" href="#third_party_integration"></a><a class="link" href="#third_party_integration">Gradle &amp; Third-party Tools</a></h3>
<div class="paragraph">
<p>Gradle can be integrated with many different third-party tools such as IDEs and continuous integration platforms. Here we look at some of the more common ones as well as how to integrate your own tool with Gradle.</p>
</div>
<div class="sect3">
<h4 id="ides"><a class="anchor" href="#ides"></a><a class="link" href="#ides">IDEs</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Android Studio</dt>
<dd>
<p>As a variant of IntelliJ IDEA, <a href="https://developer.android.com/studio/">Android Studio</a> has built-in support for importing and building Gradle projects.
You can also use the <a href="idea_plugin.html#idea_plugin">IDEA Plugin for Gradle</a> to fine-tune the import process if that&#8217;s necessary.</p>
<div class="paragraph">
<p>This IDE also has an <a href="https://developer.android.com/studio/intro/">extensive user guide</a> to help you get the most out of the IDE and Gradle.</p>
</div>
</dd>
<dt class="hdlist1">Eclipse</dt>
<dd>
<p>If you want to work on a project within Eclipse that has a Gradle build, you should use the <a href="https://projects.eclipse.org/projects/tools.buildship">Eclipse Buildship plugin</a>.
This will allow you to import and run Gradle builds.
If you need to fine tune the import process so that the project loads correctly, you can use the <a href="eclipse_plugin.html#eclipse_plugin">Eclipse Plugins for Gradle</a>.
See <a href="https://discuss.gradle.org/t/buildship-1-0-18-is-now-available/19012">the associated release announcement</a> for details on what fine tuning you can do.</p>
</dd>
<dt class="hdlist1">IntelliJ IDEA</dt>
<dd>
<p>IDEA has built-in support for importing Gradle projects.
If you need to fine tune the import process so that the project loads correctly, you can use the <a href="idea_plugin.html#idea_plugin">IDEA Plugin for Gradle</a>.</p>
</dd>
<dt class="hdlist1">NetBeans</dt>
<dd>
<p>Built-in support for Gradle in <a href="https://netbeans.apache.org/">Apache NetBeans</a></p>
</dd>
<dt class="hdlist1">Visual Studio</dt>
<dd>
<p>For developing C++ projects, Gradle comes with a <a href="visual_studio_plugin.html#visual_studio_plugin">Visual Studio plugin</a>.</p>
</dd>
<dt class="hdlist1">Xcode</dt>
<dd>
<p>For developing C++ projects, Gradle comes with a <a href="xcode_plugin.html#xcode_plugin">Xcode plugin</a>.</p>
</dd>
<dt class="hdlist1">CLion</dt>
<dd>
<p>JetBrains supports building <a href="https://blog.jetbrains.com/clion/2018/05/clion-starts-2018-2-eap-sanitizers-gradle-db-performance/">C++ projects with Gradle</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="continuous_integration_2"><a class="anchor" href="#continuous_integration_2"></a><a class="link" href="#continuous_integration_2">Continuous integration</a></h4>
<div class="paragraph">
<p>We have <a href="https://community.gradle.org/cookbook/ci/">dedicated guides</a> showing you how to integrate a Gradle project with several CI platforms.</p>
</div>
</div>
<div class="sect3">
<h4 id="how_to_integrate_with_gradle"><a class="anchor" href="#how_to_integrate_with_gradle"></a><a class="link" href="#how_to_integrate_with_gradle">How to integrate with Gradle</a></h4>
<div class="paragraph">
<p>There are two main ways to integrate a tool with Gradle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Gradle build uses the tool</p>
</li>
<li>
<p>The tool executes the Gradle build</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The former case is typically <a href="#custom_plugins">implemented as a Gradle plugin</a>. The latter can be accomplished by embedding Gradle through the Tooling API as described below.</p>
</div>
</div>
<div class="sect3">
<h4 id="embedding"><a class="anchor" href="#embedding"></a><a class="link" href="#embedding">Embedding Gradle using the Tooling API</a></h4>
<div class="sect4">
<h5 id="sec:embedding_introduction"><a class="anchor" href="#sec:embedding_introduction"></a><a class="link" href="#sec:embedding_introduction">Introduction to the Tooling API</a></h5>
<div class="paragraph">
<p>Gradle provides a programmatic API called the Tooling API, which you can use for embedding Gradle into your own software. This API allows you to execute and monitor builds and to query Gradle about the details of a build. The main audience for this API is IDE, CI server, other UI authors; however, the API is open for anyone who needs to embed Gradle in their application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#test_kit">Gradle TestKit</a> uses the Tooling API for functional testing of your Gradle plugins.</p>
</li>
<li>
<p><a href="http://projects.eclipse.org/projects/tools.buildship">Eclipse Buildship</a> uses the Tooling API for importing your Gradle project and running tasks.</p>
</li>
<li>
<p><a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a> uses the Tooling API for importing your Gradle project and running tasks.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:embedding_features"><a class="anchor" href="#sec:embedding_features"></a><a class="link" href="#sec:embedding_features">Tooling API Features</a></h5>
<div class="paragraph">
<p>A fundamental characteristic of the Tooling API is that it operates in a version independent way.
This means that you can use the same API to work with builds that use different versions of Gradle, including versions that are newer or older than the version of the Tooling API that you are using.
The Tooling API is Gradle wrapper aware and, by default, uses the same Gradle version as that used by the wrapper-powered build.</p>
</div>
<div class="paragraph">
<p>Some features that the Tooling API provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Query the details of a build, including the project hierarchy and the project dependencies, external dependencies (including source and Javadoc jars), source directories and tasks of each project.</p>
</li>
<li>
<p>Execute a build and listen to stdout and stderr logging and progress messages (e.g. the messages shown in the 'status bar' when you run on the command line).</p>
</li>
<li>
<p>Execute a specific test class or test method.</p>
</li>
<li>
<p>Receive interesting events as a build executes, such as project configuration, task execution or test execution.</p>
</li>
<li>
<p>Cancel a build that is running.</p>
</li>
<li>
<p>Combine multiple separate Gradle builds into a single composite build.</p>
</li>
<li>
<p>The Tooling API can download and install the appropriate Gradle version, similar to the wrapper.</p>
</li>
<li>
<p>The implementation is lightweight, with only a small number of dependencies.
It is also a well-behaved library, and makes no assumptions about your classloader structure or logging configuration.
This makes the API easy to embed in your application.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:embedding_daemon"><a class="anchor" href="#sec:embedding_daemon"></a><a class="link" href="#sec:embedding_daemon">Tooling API and the Gradle Build Daemon</a></h5>
<div class="paragraph">
<p>The Tooling API always uses the Gradle daemon.
This means that subsequent calls to the Tooling API, be it model building requests or task executing requests will be executed in the same long-living process.
<a href="#gradle_daemon">Gradle Daemon</a> contains more details about the daemon, specifically information on situations when new daemons are forked.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:embedding_quickstart"><a class="anchor" href="#sec:embedding_quickstart"></a><a class="link" href="#sec:embedding_quickstart">Quickstart</a></h5>
<div class="paragraph">
<p>As the Tooling API is an interface for developers, the Javadoc is the main documentation for it.</p>
</div>
<div class="paragraph">
<p>To use the Tooling API, add the following repository and dependency declarations to your build script:</p>
</div>
<div id="ex-using-the-tooling-api" class="exampleblock">
<div class="title">Example 353. <a href="#ex-using-the-tooling-api">Using the tooling API</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven { url = uri(&quot;https://repo.gradle.org/gradle/libs-releases&quot;) }
}

dependencies {
    implementation(&quot;org.gradle:gradle-tooling-api:$toolingApiVersion&quot;)
    // The tooling API need an SLF4J implementation available at runtime, replace this with any other implementation
    runtimeOnly(&quot;org.slf4j:slf4j-simple:1.7.10&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven { url <span class="string"><span class="delimiter">'</span><span class="content">https://repo.gradle.org/gradle/libs-releases</span><span class="delimiter">'</span></span> }
}

dependencies {
    implementation <span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle:gradle-tooling-api:</span><span class="inline"><span class="inline-delimiter">$</span>toolingApiVersion</span><span class="delimiter">&quot;</span></span>
    <span class="comment">// The tooling API need an SLF4J implementation available at runtime, replace this with any other implementation</span>
    runtimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-simple:1.7.10</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The main entry point to the Tooling API is the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/tooling/GradleConnector.html">GradleConnector</a>.
You can navigate from there to find code samples and explore the available Tooling API models.
You can use <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/tooling/GradleConnector.html#connect--">GradleConnector.connect()</a> to create a <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/tooling/ProjectConnection.html">ProjectConnection</a>.
A <code>ProjectConnection</code> connects to a single Gradle project.
Using the connection you can execute tasks, tests and retrieve models relative to this project.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:embedding_compatibility"><a class="anchor" href="#sec:embedding_compatibility"></a><a class="link" href="#sec:embedding_compatibility">Compatibility of Java and Gradle versions</a></h5>
<div class="paragraph">
<p>The following components should be considered when implementing Gradle integration: the Tooling API version, The JVM running the Tooling API client (i.e. the IDE process), the JVM running the Gradle daemon, and the Gradle version.</p>
</div>
<div class="paragraph">
<p>The Tooling API itself is a Java library published as part of the Gradle release.
Each Gradle release has a corresponding Tooling API version with the same version number.</p>
</div>
<div class="paragraph">
<p>The Tooling API classes are loaded into the client&#8217;s JVM, so they should have a matching version.
The current version of the Tooling API library is compiled with Java 8 compatibility.</p>
</div>
<div class="paragraph">
<p>The JVM running the Tooling API client and the one running the daemon can be different.
At the same time, classes that are sent to the build via custom build actions need to be targeted to the lowest supported Java version.
The JVM versions supported by Gradle is version-specific.
The upper bound is defined in the <a href="#compatibility">compatibility matrix</a>.
The rule for the lower bound is the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle 3.x and 4.x require a minimum version of Java 7.</p>
</li>
<li>
<p>Gradle 5 and above require a minimum version of Java 8.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Tooling API version is guaranteed to support running builds with all Gradle versions for the last five major releases.
For example, the Tooling API 8.0 release is compatible with Gradle versions &gt;= 3.0.
Besides, the Tooling API is guaranteed to be compatible with future Gradle releases for the current and the next major.
This means, for example, that the 8.1 version of the Tooling API will be able to run Gradle 9.x builds and <em>might</em> break with Gradle 10.0.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gradle_dsls_and_api"><a class="anchor" href="#gradle_dsls_and_api"></a><a class="link" href="#gradle_dsls_and_api">GRADLE DSLs and API</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="groovy_build_script_primer"><a class="anchor" href="#groovy_build_script_primer"></a><a class="link" href="#groovy_build_script_primer">A Groovy Build Script Primer</a></h3>
<div class="paragraph">
<p>Ideally, a Groovy build script looks mostly like configuration: setting some properties of the project, configuring dependencies, declaring tasks, and so on. That configuration is based on Groovy language constructs. This primer aims to explain what those constructs are and — most importantly — how they relate to Gradle&#8217;s API documentation.</p>
</div>
<div class="sect3">
<h4 id="groovy:project_object"><a class="anchor" href="#groovy:project_object"></a><a class="link" href="#groovy:project_object">The <code>Project</code> object</a></h4>
<div class="paragraph">
<p>As Groovy is an object-oriented language based on Java, its properties and methods apply to objects. In some cases, the object is implicit — particularly at the top level of a build script, i.e. not nested inside a <code>{}</code> block.</p>
</div>
<div class="paragraph">
<p>Consider this fragment of build script, which contains an unqualified property and block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">version = <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.GA</span><span class="delimiter">'</span></span>

configurations {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>version</code> and <code>configurations {}</code> are part of <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html">org.gradle.api.Project</a>.</p>
</div>
<div class="paragraph">
<p>This example reflects how every Groovy build script is backed by an implicit instance of <code>Project</code>. If you see an unqualified element and you don&#8217;t know where it&#8217;s defined, always check the <code>Project</code> API documentation to see if that&#8217;s where it&#8217;s coming from.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>Avoid using <a href="https://groovy-lang.org/metaprogramming.html#_metaclasses">Groovy MetaClass</a> programming techniques in your build scripts. Gradle provides its own API for adding <a href="#sec:extra_properties">dynamic runtime properties</a>.</p>
</div>
<div class="paragraph">
<p>Use of Groovy-specific metaprogramming can cause builds to retain large amounts of memory between builds that will eventually cause the Gradle daemon to run out-of-memory.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="groovy:properties"><a class="anchor" href="#groovy:properties"></a><a class="link" href="#groovy:properties">Properties</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;obj&gt;.&lt;name&gt;                <span class="comment">// Get a property value</span>
&lt;obj&gt;.&lt;name&gt; = &lt;value&gt;      <span class="comment">// Set a property to a new value</span>
<span class="string"><span class="delimiter">&quot;</span><span class="content">$</span><span class="content">&lt;name&gt;</span><span class="delimiter">&quot;</span></span>                   <span class="comment">// Embed a property value in a string</span>
<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>&lt;obj&gt;.&lt;name&gt;<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>           <span class="comment">// Same as previous (embedded value)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">version = <span class="string"><span class="delimiter">'</span><span class="content">1.0.1</span><span class="delimiter">'</span></span>
myCopyTask.description = <span class="string"><span class="delimiter">'</span><span class="content">Copies some files</span><span class="delimiter">'</span></span>

file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>projectDir</span><span class="content">/src</span><span class="delimiter">&quot;</span></span>)
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Destination: </span><span class="inline"><span class="inline-delimiter">${</span>myCopyTask.destinationDir<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A property represents some state of an object. The presence of an <code>=</code> sign is a clear indicator that you&#8217;re looking at a property. Otherwise, a qualified name — it begins with <code>&lt;obj&gt;.</code> — without any other decoration is also a property.</p>
</div>
<div class="paragraph">
<p>If the name is unqualified, then it may be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A task instance with that name.</p>
</li>
<li>
<p>A property on <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html">Project</a>.</p>
</li>
<li>
<p>An <a href="#sec:extra_properties">extra property</a> defined elsewhere in the project.</p>
</li>
<li>
<p>A property of an implicit object within a <a href="#groovy:blocks">block</a>.</p>
</li>
<li>
<p>A <a href="#groovy:local_variables">local variable</a> defined earlier in the build script.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that plugins can add their own properties to the <code>Project</code> object. The <a href="https://docs.gradle.org/8.9/dsl/">API documentation</a> lists all the properties added by core plugins. If you&#8217;re struggling to find where a property comes from, check the documentation for the plugins that the build uses.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When referencing a project property in your build script that is added by a non-core plugin, consider prefixing it with <code>project.</code> — it&#8217;s clear then that the property belongs to the project object.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="properties_in_the_api_documentation"><a class="anchor" href="#properties_in_the_api_documentation"></a><a class="link" href="#properties_in_the_api_documentation">Properties in the API documentation</a></h5>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/8.9/dsl/">Groovy DSL reference</a> shows properties as they are used in your build scripts, but the Javadocs only display methods. That&#8217;s because properties are implemented as methods behind the scenes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A property can be <em>read</em> if there is a method named <code>get&lt;PropertyName&gt;</code> with zero arguments that returns the same type as the property.</p>
</li>
<li>
<p>A property can be <em>modified</em> if there is a method named <code>set&lt;PropertyName&gt;</code> with one argument that has the same type as the property and a return type of <code>void</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that property names usually start with a lower-case letter, but that letter is upper case in the method names. So the getter method <code>getProjectVersion()</code> corresponds to the property <code>projectVersion</code>. This convention does not apply when the name begins with at least two upper-case letters, in which case there is not change in case. For example, <code>getRAM()</code> corresponds to the property <code>RAM</code>.</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">project.getVersion()
project.version

project.setVersion(<span class="string"><span class="delimiter">'</span><span class="content">1.0.1</span><span class="delimiter">'</span></span>)
project.version = <span class="string"><span class="delimiter">'</span><span class="content">1.0.1</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="groovy:methods"><a class="anchor" href="#groovy:methods"></a><a class="link" href="#groovy:methods">Methods</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;obj&gt;.&lt;name&gt;()              <span class="comment">// Method call with no arguments</span>
&lt;obj&gt;.&lt;name&gt;(&lt;arg&gt;, &lt;arg&gt;)  <span class="comment">// Method call with multiple arguments</span>
&lt;obj&gt;.&lt;name&gt; &lt;arg&gt;, &lt;arg&gt;   <span class="comment">// Method call with multiple args (no parentheses)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">myCopyTask.include <span class="string"><span class="delimiter">'</span><span class="content">**/*.xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.properties</span><span class="delimiter">'</span></span>

ext.resourceSpec = copySpec()   <span class="comment">// `copySpec()` comes from `Project`</span>

file(<span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>)
println <span class="string"><span class="delimiter">'</span><span class="content">Hello, World!</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A method represents some behavior of an object, although Gradle often uses methods to configure the state of objects as well. Methods are identifiable by their arguments or empty parentheses. Note that parentheses are sometimes required, such as when a method has zero arguments, so you may find it simplest to always use parentheses.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Gradle has a convention whereby if a method has the same name as a collection-based property, then the method <em>appends</em> its values to that collection.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="groovy:blocks"><a class="anchor" href="#groovy:blocks"></a><a class="link" href="#groovy:blocks">Blocks</a></h4>
<div class="paragraph">
<p>Blocks are also <a href="#groovy:methods">methods</a>, just with specific types for the last argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;obj&gt;.&lt;name&gt; {
     ...
}

&lt;obj&gt;.&lt;name&gt;(&lt;arg&gt;, &lt;arg&gt;) {
     ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

configurations {
    assets
}

sourceSets {
    main {
        java {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>]
        }
    }
}

dependencies {
    implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:util</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Blocks are a mechanism for configuring multiple aspects of a build element in one go. They also provide a way to nest configuration, leading to a form of structured data.</p>
</div>
<div class="paragraph">
<p>There are two important aspects of blocks that you should understand:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>They are implemented as methods with specific signatures.</p>
</li>
<li>
<p>They can change the target ("delegate") of unqualified methods and properties.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both are based on Groovy language features and we explain them in the following sections.</p>
</div>
<div class="sect4">
<h5 id="block_method_signatures"><a class="anchor" href="#block_method_signatures"></a><a class="link" href="#block_method_signatures">Block method signatures</a></h5>
<div class="paragraph">
<p>You can easily identify a method as the implementation behind a block by its signature, or more specifically, its argument types. If a method corresponds to a block:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It must have at least one argument.</p>
</li>
<li>
<p>The <em>last</em> argument must be of type <a href="https://docs.groovy-lang.org/latest/html/gapi/groovy/lang/Closure.html"><code>groovy.lang.Closure</code></a> or <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/Action.html">org.gradle.api.Action</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:copy(org.gradle.api.Action)">Project.copy(Action)</a> matches these requirements, so you can use the syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">copy {
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">tmp</span><span class="delimiter">&quot;</span></span>)
    from <span class="string"><span class="delimiter">'</span><span class="content">custom-resources</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That leads to the question of how <code>into()</code> and <code>from()</code> work. They&#8217;re clearly methods, but where would you find them in the API documentation? The answer comes from understanding object <em>delegation</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="delegation"><a class="anchor" href="#delegation"></a><a class="link" href="#delegation">Delegation</a></h5>
<div class="paragraph">
<p>The <a href="#groovy:properties">section on properties</a> lists where unqualified properties might be found. One common place is on the <code>Project</code> object. But there is an alternative source for those unqualified properties and methods inside a block: the block&#8217;s <em>delegate object</em>.</p>
</div>
<div class="paragraph">
<p>To help explain this concept, consider the last example from the previous section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">copy {
    into layout.buildDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">tmp</span><span class="delimiter">&quot;</span></span>)
    from <span class="string"><span class="delimiter">'</span><span class="content">custom-resources</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the methods and properties in this example are unqualified. You can easily find <code>copy()</code> and <code>layout</code> in the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html"><code>Project</code> API documentation</a>, but what about <code>into()</code> and <code>from()</code>? These are resolved against the delegate of the <code>copy {}</code> block. What is the type of that delegate? You&#8217;ll need to <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html#org.gradle.api.Project:copy(org.gradle.api.Action)">check the API documentation for that</a>.</p>
</div>
<div class="paragraph">
<p>There are two ways to determine the delegate type, depending on the signature of the block method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For <code>Action</code> arguments, look at the type&#8217;s parameter.</p>
<div class="paragraph">
<p>In the example above, the method signature is <code>copy(Action&lt;? super CopySpec&gt;)</code> and it&#8217;s the bit inside the angle brackets that tells you the delegate type — <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopySpec.html">CopySpec</a> in this case.</p>
</div>
</li>
<li>
<p>For <code>Closure</code> arguments, the documentation will explicitly say in the description what type is being configured or what type the delegate it (different terminology for the same thing).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hence you can find both <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopySpec.html#into-java.lang.Object-">into()</a> and <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/file/CopySpec.html#from-java.lang.Object...-">from()</a> on <code>CopySpec</code>. You might even notice that both of those methods have variants that take an <code>Action</code> as their last argument, which means you can use block syntax with them.</p>
</div>
<div class="paragraph">
<p>All new Gradle APIs declare an <code>Action</code> argument type rather than <code>Closure</code>, which makes it very easy to pick out the delegate type. Even older APIs have an <code>Action</code> variant in addition to the old <code>Closure</code> one.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="groovy:local_variables"><a class="anchor" href="#groovy:local_variables"></a><a class="link" href="#groovy:local_variables">Local variables</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> &lt;name&gt; = &lt;value&gt;        <span class="comment">// Untyped variable</span>
&lt;type&gt; &lt;name&gt; = &lt;value&gt;     <span class="comment">// Typed variable</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> i = <span class="integer">1</span>
<span class="predefined-type">String</span> errorMsg = <span class="string"><span class="delimiter">'</span><span class="content">Failed, because reasons</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Local variables are a Groovy construct — unlike <a href="#sec:extra_properties">extra properties</a> — that can be used to share values within a build script.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>Avoid using local variables in the root of the project, i.e. as pseudo project properties. They cannot be read outside of the build script and Gradle has no knowledge of them.</p>
</div>
<div class="paragraph">
<p>Within a narrower context — such as configuring a task — local variables can occasionally be helpful.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kotlin_dsl"><a class="anchor" href="#kotlin_dsl"></a><a class="link" href="#kotlin_dsl">Gradle Kotlin DSL Primer</a></h3>
<div class="paragraph">
<p>Gradle&#8217;s Kotlin DSL provides an alternative syntax to the traditional Groovy DSL with an enhanced editing experience in supported IDEs, with superior content assist, refactoring, documentation, and more.
This chapter provides details of the main Kotlin DSL constructs and how to use it to interact with the Gradle API.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you are interested in migrating an existing Gradle build to the Kotlin DSL, please also check out the dedicated <a href="migrating_from_groovy_to_kotlin_dsl.html#migrating_groovy_kotlin">migration section</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="kotdsl:prerequisites"><a class="anchor" href="#kotdsl:prerequisites"></a><a class="link" href="#kotdsl:prerequisites">Prerequisites</a></h4>
<div class="ulist">
<ul>
<li>
<p>The embedded Kotlin compiler is known to work on Linux, macOS, Windows, Cygwin, FreeBSD and Solaris on x86-64 architectures.</p>
</li>
<li>
<p>Knowledge of Kotlin syntax and basic language features is very helpful. The <a href="https://kotlinlang.org/docs/reference/">Kotlin reference documentation</a> and <a href="https://kotlinlang.org/docs/tutorials/koans.html">Kotlin Koans</a> will help you to learn the basics.</p>
</li>
<li>
<p>Use of the <a href="#sec:plugins_block">plugins {}</a> block to declare Gradle plugins significantly improves the editing experience and is highly recommended.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sec:ide_support"><a class="anchor" href="#sec:ide_support"></a><a class="link" href="#sec:ide_support">IDE support</a></h4>
<div class="paragraph">
<p>The Kotlin DSL is fully supported by IntelliJ IDEA and Android Studio. Other IDEs do not yet provide helpful tools for editing Kotlin DSL files, but you can still import Kotlin-DSL-based builds and work with them as usual.</p>
</div>
<table class="tableblock frame-none grid-rows stretch">
<caption class="title">Table 29. IDE support matrix</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-middle"></th>
<th class="tableblock halign-center valign-middle">Build import</th>
<th class="tableblock halign-center valign-middle">Syntax highlighting <sup>1</sup></th>
<th class="tableblock halign-center valign-middle">Semantic editor <sup>2</sup></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">IntelliJ IDEA</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">Android Studio</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">Eclipse IDE</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="red">✖</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">CLion</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="red">✖</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">Apache NetBeans</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="red">✖</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">Visual Studio Code <sup>(LSP)</sup></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="red">✖</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">Visual Studio</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong>✓</strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="red">✖</span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="red">✖</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><sup>1</sup> <sup>Kotlin</sup> <sup>syntax</sup> <sup>highlighting</sup> <sup>in</sup> <sup>Gradle</sup> <sup>Kotlin</sup> <sup>DSL</sup> <sup>scripts</sup><br>
<sup>2</sup> <sup>code</sup> <sup>completion,</sup> <sup>navigation</sup> <sup>to</sup> <sup>sources,</sup> <sup>documentation,</sup> <sup>refactorings</sup> <sup>etc&#8230;&#8203;</sup> <sup>in</sup> <sup>Gradle</sup> <sup>Kotlin</sup> <sup>DSL</sup> <sup>scripts</sup></p>
</div>
<div class="paragraph">
<p>As mentioned in the limitations, you must <a href="https://www.jetbrains.com/help/idea/gradle.html#gradle_import">import your project from the Gradle model</a> to get content-assist and refactoring tools for Kotlin DSL scripts in IntelliJ IDEA.</p>
</div>
<div class="paragraph">
<p>Builds with slow configuration time might affect the IDE responsiveness, so please check out the <a href="#performance_gradle">performance section</a> to help resolve such issues.</p>
</div>
<div class="sect4">
<h5 id="automatic_build_import_vs_automatic_reloading_of_script_dependencies"><a class="anchor" href="#automatic_build_import_vs_automatic_reloading_of_script_dependencies"></a><a class="link" href="#automatic_build_import_vs_automatic_reloading_of_script_dependencies">Automatic build import vs. automatic reloading of script dependencies</a></h5>
<div class="paragraph">
<p>Both IntelliJ IDEA and Android Studio — which is derived from IntelliJ IDEA — will detect when you make changes to your build logic and offer two suggestions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Import the whole build again</p>
<div class="imageblock">
<div class="content">
<img src="img/intellij-build-import-popup.png" alt="IntelliJ IDEA" width="300">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="img/android-studio-build-sync-popup.png" alt="IntelliJ IDEA">
</div>
</div>
</li>
<li>
<p>Reload script dependencies when editing a build script</p>
<div class="imageblock">
<div class="content">
<img src="img/intellij-script-dependencies-reload.png" alt="Reload script dependencies">
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>We recommend that you <em>disable automatic build import</em>, but <em>enable automatic reloading of script dependencies</em>.
That way you get early feedback while editing Gradle scripts and control over when the whole build setup gets synchronized with your IDE.</p>
</div>
</div>
<div class="sect4">
<h5 id="troubleshooting_2"><a class="anchor" href="#troubleshooting_2"></a><a class="link" href="#troubleshooting_2">Troubleshooting</a></h5>
<div class="paragraph">
<p>The IDE support is provided by two components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Kotlin Plugin used by IntelliJ IDEA/Android Studio</p>
</li>
<li>
<p>Gradle</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The level of support varies based on the versions of each.</p>
</div>
<div class="paragraph">
<p>If you run into trouble, the first thing you should try is running <code>./gradlew tasks</code> from the command line to see whether your issue is limited to the IDE. If you encounter the same problem from the command line, then the issue is with the build rather than the IDE integration.</p>
</div>
<div class="paragraph">
<p>If you can run the build successfully from the command line but your script editor is complaining, then you should try restarting your IDE and invalidating its caches.</p>
</div>
<div class="paragraph">
<p>If the above doesn&#8217;t work and you suspect an issue with the Kotlin DSL script editor, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run <code>./gradle tasks</code> to get more details</p>
</li>
<li>
<p>Check the logs in one of these locations:</p>
<div class="ulist">
<ul>
<li>
<p><code>$HOME/Library/Logs/gradle-kotlin-dsl</code> on Mac OS X</p>
</li>
<li>
<p><code>$HOME/.gradle-kotlin-dsl/log</code> on Linux</p>
</li>
<li>
<p><code>$HOME/AppData/Local/gradle-kotlin-dsl/log</code> on Windows</p>
</li>
</ul>
</div>
</li>
<li>
<p>Open an issue on the <a href="https://github.com/gradle/gradle/issues/">Gradle issue tracker</a>, including as much detail as you can.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From version 5.1 onwards, the log directory is cleaned up automatically.
It is checked periodically (at most every 24 hours) and log files are deleted if they haven’t been used for 7 days.</p>
</div>
<div class="paragraph">
<p>If the above isn&#8217;t enough to pinpoint the problem, you can enable the <code>org.gradle.kotlin.dsl.logging.tapi</code> system property in your IDE. This will cause the Gradle Daemon to log extra information in its log file located in <code>$HOME/.gradle/daemon</code>. In IntelliJ IDEA this can be done by opening <code>Help &gt; Edit Custom VM Options&#8230;&#8203;</code> and adding <code>-Dorg.gradle.kotlin.dsl.logging.tapi=true</code>.</p>
</div>
<div class="paragraph">
<p>For IDE problems outside of the Kotlin DSL script editor, please open issues in the corresponding IDE&#8217;s issue tracker:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="">JetBrains&#8217;s IDEA issue tracker</a>,</p>
</li>
<li>
<p><a href="">Google&#8217;s Android Studio issue tracker</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lastly, if you face problems with Gradle itself or with the Kotlin DSL, please open issues on the <a href="https://github.com/gradle/gradle/issues/">Gradle issue tracker</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:scripts"><a class="anchor" href="#sec:scripts"></a><a class="link" href="#sec:scripts">Kotlin DSL scripts</a></h4>
<div class="paragraph">
<p>Just like the Groovy-based equivalent, the Kotlin DSL is implemented on top of Gradle&#8217;s Java API.
Everything you can read in a Kotlin DSL script is Kotlin code compiled and executed by Gradle.
Many of the objects, functions and properties you use in your build scripts come from the Gradle API and the APIs of the applied plugins.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can use the <a href="https://docs.gradle.org/8.9/kotlin-dsl/">Kotlin DSL reference</a> search functionality to drill through the available members.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="script_file_names"><a class="anchor" href="#script_file_names"></a><a class="link" href="#script_file_names">Script file names</a></h5>
<div class="ulist">
<ul>
<li>
<p>Groovy DSL script files use the <code>.gradle</code> file name extension.</p>
</li>
<li>
<p>Kotlin DSL script files use the <code>.gradle.kts</code> file name extension.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To activate the Kotlin DSL, simply use the <code>.gradle.kts</code> extension for your build scripts in place of <code>.gradle</code>. That also applies to the <a href="#sec:settings_file_script">settings file</a> — for example <code>settings.gradle.kts</code> — and <a href="#init_scripts">initialization scripts</a>.</p>
</div>
<div class="paragraph">
<p>Note that you can mix Groovy DSL build scripts with Kotlin DSL ones, i.e. a Kotlin DSL build script can apply a Groovy DSL one and each project in a multi-project build can use either one.</p>
</div>
<div class="paragraph">
<p>We recommend that you apply the following conventions to get better IDE support:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name settings scripts (or any script that is backed by a Gradle <code>Settings</code> object) according to the pattern <code>*.settings.gradle.kts</code> — this includes script plugins that are applied from settings scripts</p>
</li>
<li>
<p>Name <a href="#init_scripts">initialization scripts</a> according to the pattern <code>*.init.gradle.kts</code> or simply <code>init.gradle.kts</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is so that the IDE knows what type of object "backs" the script, be it <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.Project.html">Project</a>, <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.initialization.Settings.html">Settings</a> or <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.invocation.Gradle.html">Gradle</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:implicit_imports"><a class="anchor" href="#sec:implicit_imports"></a><a class="link" href="#sec:implicit_imports">Implicit imports</a></h5>
<div class="paragraph">
<p>All Kotlin DSL build scripts have implicit imports consisting of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="#script-default-imports">default Gradle API imports</a></p>
</li>
<li>
<p>The Kotlin DSL API, which is all types within the following packages:</p>
<div class="ulist">
<ul>
<li>
<p><code>org.gradle.kotlin.dsl</code></p>
</li>
<li>
<p><code>org.gradle.kotlin.dsl.plugins.dsl</code></p>
</li>
<li>
<p><code>org.gradle.kotlin.dsl.precompile</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="openblock">
<div class="title">Avoid using internal Kotlin DSL APIs</div>
<div class="content">
<div class="paragraph">
<p>Use of internal Kotlin DSL APIs in plugins and build scripts has the potential to break builds when either Gradle or plugins change.
The <a href="https://docs.gradle.org/8.9/kotlin-dsl/">Kotlin DSL API</a> extends the Gradle public API with the types listed in the <a href="https://docs.gradle.org/8.9/kotlin-dsl/">corresponding API docs</a> that are in the packages listed above (but not subpackages of those).</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:compilation_warnings"><a class="anchor" href="#sec:compilation_warnings"></a><a class="link" href="#sec:compilation_warnings">Compilation warnings</a></h5>
<div class="paragraph">
<p>Gradle Kotlin DSL scripts are compiled by Gradle during the configuration phase of your build.
Deprecation warnings found by the Kotlin compiler are reported on the console when compiling the scripts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; Configure project :
w: build.gradle.kts:4:5: 'getter for uploadTaskName: String!' is deprecated. Deprecated in Java</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to configure your build to fail on any warning emitted during script compilation by <a href="#sec:gradle_configuration_properties">setting</a> the <code>org.gradle.kotlin.dsl.allWarningsAsErrors</code> Gradle property to <code>true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># gradle.properties
org.gradle.kotlin.dsl.allWarningsAsErrors=true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="type-safe-accessors"><a class="anchor" href="#type-safe-accessors"></a><a class="link" href="#type-safe-accessors">Type-safe model accessors</a></h4>
<div class="paragraph">
<p>The Groovy DSL allows you to reference many elements of the build model by name, even when they are defined at runtime. Think named configurations, named source sets, and so on. For example, you can get hold of the <code>implementation</code> configuration via <code>configurations.implementation</code>.</p>
</div>
<div class="paragraph">
<p>The Kotlin DSL replaces such dynamic resolution with type-safe model accessors that work with model elements contributed by plugins.</p>
</div>
<div class="sect4">
<h5 id="kotdsl:accessor_applicability"><a class="anchor" href="#kotdsl:accessor_applicability"></a><a class="link" href="#kotdsl:accessor_applicability">Understanding when type-safe model accessors are available</a></h5>
<div class="paragraph">
<p>The Kotlin DSL currently provides various sets of type-safe model accessors, each tailored to different scopes.</p>
</div>
<div class="paragraph">
<p>For the main project build scripts and precompiled project script plugins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dependency and artifact configurations (such as <code>implementation</code> and <code>runtimeOnly</code> contributed by the Java Plugin)</p>
</li>
<li>
<p>Project extensions and conventions (such as <code>sourceSets</code>), and extensions on them</p>
</li>
<li>
<p>Extensions on the <code>dependencies</code> and <code>repositories</code> containers, and extensions on them</p>
</li>
<li>
<p>Elements in the <code>tasks</code> and <code>configurations</code> containers</p>
</li>
<li>
<p>Elements in <a href="#kotdsl:containers">project-extension containers</a> (for example the source sets contributed by the Java Plugin that are added to the <code>sourceSets</code> container)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the main project settings script:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Project extensions and conventions, contributed by <code>Settings</code> plugins, and extensions on them</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Initialization scripts and script plugins do not have type-safe model accessors.
These limitations will be removed in a future Gradle release.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The set of type-safe model accessors available is calculated right before evaluating the script body, immediately after the <code>plugins {}</code> block.
Any model elements contributed after that point do not work with type-safe model accessors.
For example, this includes any configurations you might define in your own build script.
However, this approach does mean that you can use type-safe accessors for any model elements that are contributed by plugins that are <em>applied by parent projects</em>.</p>
</div>
<div class="paragraph">
<p>The following project build script demonstrates how you can access various configurations, extensions and other elements using type-safe accessors:</p>
</div>
<div id="ex-using-type-safe-model-accessors" class="exampleblock">
<div class="title">Example 354. <a href="#ex-using-type-safe-model-accessors">Using type-safe model accessors</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

dependencies {                              // <b class="conum">(1)</b>
    api(&quot;junit:junit:4.13&quot;)
    implementation(&quot;junit:junit:4.13&quot;)
    testImplementation(&quot;junit:junit:4.13&quot;)
}

configurations {                            // <b class="conum">(1)</b>
    implementation {
        resolutionStrategy.failOnVersionConflict()
    }
}

sourceSets {                                // <b class="conum">(2)</b>
    main {                                  // <b class="conum">(3)</b>
        java.srcDir(&quot;src/core/java&quot;)
    }
}

java {                                      // <b class="conum">(4)</b>
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

tasks {
    test {                                  // <b class="conum">(5)</b>
        testLogging.showExceptions = true
        useJUnit()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Uses type-safe accessors for the <code>api</code>, <code>implementation</code> and <code>testImplementation</code> dependency configurations contributed by the <a href="#java_library_plugin">Java Library Plugin</a></p>
</li>
<li>
<p>Uses an accessor to configure the <code>sourceSets</code> project extension</p>
</li>
<li>
<p>Uses an accessor to configure the <code>main</code> source set</p>
</li>
<li>
<p>Uses an accessor to configure the <code>java</code> source for the <code>main</code> source set</p>
</li>
<li>
<p>Uses an accessor to configure the <code>test</code> task</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Your IDE knows about the type-safe accessors, so it will include them in its suggestions.</p>
</div>
<div class="paragraph">
<p>This will happen both at the top level of your build scripts — most plugin extensions are added to the <code>Project</code> object — and within the blocks that configure an extension.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that accessors for elements of containers such as <code>configurations</code>, <code>tasks</code> and <code>sourceSets</code> leverage Gradle&#8217;s <a href="#lazy_configuration">configuration avoidance APIs</a>.
For example, on <code>tasks</code> they are of type <code>TaskProvider&lt;T&gt;</code> and provide a lazy reference and lazy configuration of the underlying task.
Here are some examples that illustrate the situations in which configuration avoidance applies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    // lazy configuration
}

// Lazy reference
val testProvider: TaskProvider&lt;Test&gt; = tasks.test

testProvider {
    // lazy configuration
}

// Eagerly realized Test task, defeat configuration avoidance if done out of a lazy context
val test: Test = tasks.test.get()</code></pre>
</div>
</div>
<div class="paragraph">
<p>For all other containers than <code>tasks</code>, accessors for elements are of type <code>NamedDomainObjectProvider&lt;T&gt;</code> and provide the same behavior.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:kotlin_using_standard_api"><a class="anchor" href="#sec:kotlin_using_standard_api"></a><a class="link" href="#sec:kotlin_using_standard_api">Understanding what to do when type-safe model accessors are not available</a></h5>
<div class="paragraph">
<p>Consider the sample build script shown above that demonstrates the use of type-safe accessors.
The following sample is exactly the same except that is uses the <code>apply()</code> method to apply the plugin.
The build script can not use type-safe accessors in this case because the <code>apply()</code> call happens in the body of the build script.
You have to use other techniques instead, as demonstrated here:</p>
</div>
<div id="ex-configuring-plugins-without-type-safe-accessors" class="exampleblock">
<div class="title">Example 355. <a href="#ex-configuring-plugins-without-type-safe-accessors">Configuring plugins without type-safe accessors</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(plugin = &quot;java-library&quot;)

dependencies {
    &quot;api&quot;(&quot;junit:junit:4.13&quot;)
    &quot;implementation&quot;(&quot;junit:junit:4.13&quot;)
    &quot;testImplementation&quot;(&quot;junit:junit:4.13&quot;)
}

configurations {
    &quot;implementation&quot; {
        resolutionStrategy.failOnVersionConflict()
    }
}

configure&lt;SourceSetContainer&gt; {
    named(&quot;main&quot;) {
        java.srcDir(&quot;src/core/java&quot;)
    }
}

configure&lt;JavaPluginExtension&gt; {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

tasks {
    named&lt;Test&gt;(&quot;test&quot;) {
        testLogging.showExceptions = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Type-safe accessors are unavailable for model elements contributed by the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Plugins applied via the <code>apply(plugin = "id")</code> method</p>
</li>
<li>
<p>The project build script</p>
</li>
<li>
<p>Script plugins, via <code>apply(from = "script-plugin.gradle.kts")</code></p>
</li>
<li>
<p>Plugins applied via <a href="#sec:kotlin_cross_project_configuration">cross-project configuration</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You also can not use type-safe accessors in Binary Gradle plugins implemented in Kotlin.</p>
</div>
<div class="paragraph">
<p>If you can&#8217;t find a type-safe accessor, <em>fall back to using the normal API</em> for the corresponding types.
To do that, you need to know the names and/or types of the configured model elements.
We&#8217;ll now show you how those can be discovered by looking at the above script in detail.</p>
</div>
<div class="sect5">
<h6 id="artifact_configurations"><a class="anchor" href="#artifact_configurations"></a><a class="link" href="#artifact_configurations">Artifact configurations</a></h6>
<div class="paragraph">
<p>The following sample demonstrates how to reference and configure artifact configurations without type accessors:</p>
</div>
<div id="ex-artifact-configurations" class="exampleblock">
<div class="title">Example 356. <a href="#ex-artifact-configurations">Artifact configurations</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(plugin = &quot;java-library&quot;)

dependencies {
    &quot;api&quot;(&quot;junit:junit:4.13&quot;)
    &quot;implementation&quot;(&quot;junit:junit:4.13&quot;)
    &quot;testImplementation&quot;(&quot;junit:junit:4.13&quot;)
}

configurations {
    &quot;implementation&quot; {
        resolutionStrategy.failOnVersionConflict()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The code looks similar to that for the type-safe accessors, except that the configuration names are string literals in this case.
You can use string literals for configuration names in dependency declarations and within the <code>configurations {}</code> block.</p>
</div>
<div class="paragraph">
<p>The IDE won&#8217;t be able to help you discover the available configurations in this situation, but you can look them up either in the corresponding plugin&#8217;s documentation or by running <code>gradle dependencies</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="project_extensions_and_conventions"><a class="anchor" href="#project_extensions_and_conventions"></a><a class="link" href="#project_extensions_and_conventions">Project extensions and conventions</a></h6>
<div class="paragraph">
<p>Project extensions and <a href="#sec:kotlin_dsl_about_conventions">conventions</a> have both a name and a unique type, but the Kotlin DSL only needs to know the type in order to configure them.
As the following sample shows for the <code>sourceSets {}</code> and <code>java {}</code> blocks from the original example build script, you can use the <a href="https://docs.gradle.org/8.9/kotlin-dsl/gradle/org.gradle.kotlin.dsl/configure.html"><code>configure&lt;T&gt;()</code></a> function with the corresponding type to do that:</p>
</div>
<div id="ex-project-extensions-and-conventions" class="exampleblock">
<div class="title">Example 357. <a href="#ex-project-extensions-and-conventions">Project extensions and conventions</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(plugin = &quot;java-library&quot;)

configure&lt;SourceSetContainer&gt; {
    named(&quot;main&quot;) {
        java.srcDir(&quot;src/core/java&quot;)
    }
}

configure&lt;JavaPluginExtension&gt; {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that <code>sourceSets</code> is a Gradle extension on <code>Project</code> of type <code>SourceSetContainer</code> and <code>java</code> is an extension on <code>Project</code> of type <code>JavaPluginExtension</code>.</p>
</div>
<div class="paragraph">
<p>You can discover what extensions and conventions are available either by looking at the documentation for the applied plugins or by running <code>gradle kotlinDslAccessorsReport</code>, which prints the Kotlin code necessary to access the model elements contributed by all the applied plugins.
The report provides both names and types.
As a last resort, you can also check a plugin&#8217;s source code, but that shouldn&#8217;t be necessary in the majority of cases.</p>
</div>
<div class="paragraph">
<p>Note that you can also use the <a href="https://docs.gradle.org/8.9/kotlin-dsl/gradle/org.gradle.kotlin.dsl/the.html"><code>the&lt;T&gt;()</code></a> function if you only need a reference to the extension or convention without configuring it, or if you want to perform a one-line configuration, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">the&lt;SourceSetContainer&gt;()[&quot;main&quot;].srcDir(&quot;src/core/java&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippet above also demonstrates one way of configuring the elements of a project extension that is a container.</p>
</div>
</div>
<div class="sect5">
<h6 id="elements_in_project_extension_containers"><a class="anchor" href="#elements_in_project_extension_containers"></a><a class="link" href="#elements_in_project_extension_containers">Elements in project-extension containers</a></h6>
<div class="paragraph">
<p>Container-based project extensions, such as <code>SourceSetContainer</code>, also allow you to configure the elements held by them.
In our sample build script, we want to configure a source set named <code>main</code> within the source set container, which we can do by using the <a href="https://docs.gradle.org/8.9/javadoc/org/gradle/api/NamedDomainObjectCollection.html#named-java.lang.String-">named()</a> method in place of an accessor, like so:</p>
</div>
<div id="ex-elements-of-project-extensions-that-are-containers" class="exampleblock">
<div class="title">Example 358. <a href="#ex-elements-of-project-extensions-that-are-containers">Elements of project extensions that are containers</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(plugin = &quot;java-library&quot;)

configure&lt;SourceSetContainer&gt; {
    named(&quot;main&quot;) {
        java.srcDir(&quot;src/core/java&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>All elements within a container-based project extension have a name, so you can use this technique in all such cases.</p>
</div>
<div class="paragraph">
<p>As for project extensions and conventions themselves, you can discover what elements are present in any container by either looking at the documentation of the applied plugins or by running <code>gradle kotlinDslAccessorsReport</code>.
And as a last resort, you may be able to view the plugin&#8217;s source code to find out what it does, but that shouldn&#8217;t be necessary in the majority of cases.</p>
</div>
</div>
<div class="sect5">
<h6 id="tasks_2"><a class="anchor" href="#tasks_2"></a><a class="link" href="#tasks_2">Tasks</a></h6>
<div class="paragraph">
<p>Tasks are not managed through a container-based project extension, but they are part of a container that behaves in a similar way.
This means that you can configure tasks in the same way as you do for source sets, as you can see in this example:</p>
</div>
<div id="ex-tasks" class="exampleblock">
<div class="title">Example 359. <a href="#ex-tasks">Tasks</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(plugin = &quot;java-library&quot;)

tasks {
    named&lt;Test&gt;(&quot;test&quot;) {
        testLogging.showExceptions = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We are using the Gradle API to refer to the tasks by name and type, rather than using accessors.
Note that it&#8217;s necessary to specify the type of the task explicitly, otherwise the script won&#8217;t compile because the inferred type will be <code>Task</code>, not <code>Test</code>, and the <code>testLogging</code> property is specific to the <code>Test</code> task type.
You can, however, omit the type if you only need to configure properties or to call methods that are common to all tasks, i.e. they are declared on the <code>Task</code> interface.</p>
</div>
<div class="paragraph">
<p>One can discover what tasks are available by running <code>gradle tasks</code>. You can then find out the type of a given task by running <code>gradle help --task &lt;taskName&gt;</code>, as demonstrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">❯ ./gradlew help --task test
...
Type
     Test (org.gradle.api.tasks.testing.Test)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the IDE can assist you with the required imports, so you only need the simple names of the types, i.e. without the package name part.
In this case, there&#8217;s no need to import the <code>Test</code> task type as it is part of the Gradle API and is therefore <a href="#sec:implicit_imports">imported implicitly</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:kotlin_dsl_about_conventions"><a class="anchor" href="#sec:kotlin_dsl_about_conventions"></a><a class="link" href="#sec:kotlin_dsl_about_conventions">About conventions</a></h5>
<div class="paragraph">
<p>Some of the Gradle core plugins expose configurability with the help of a so-called <em>convention</em> object.
These serve a similar purpose to — and have now been superseded by — <em>extensions</em>.
Conventions are deprecated.
Please avoid using convention objects when writing new plugins.</p>
</div>
<div class="paragraph">
<p>As seen above, the Kotlin DSL provides accessors only for convention objects on <code>Project</code>.
There are situations that require you to interact with a Gradle plugin that uses convention objects on other types.
The Kotlin DSL provides the <code>withConvention(T::class) {}</code> extension function to do this:</p>
</div>
<div id="ex-configuring-source-set-conventions" class="exampleblock">
<div class="title">Example 360. <a href="#ex-configuring-source-set-conventions">Configuring source set conventions</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    main {
        withConvention(CustomSourceSetConvention::class) {
            someOption = &quot;some value&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This technique is primarily necessary for source sets added by language plugins that have yet to be migrated to extensions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:multi_project_builds"><a class="anchor" href="#sec:multi_project_builds"></a><a class="link" href="#sec:multi_project_builds">Multi-project builds</a></h4>
<div class="paragraph">
<p>As with single-project builds, you should try to use the <code>plugins {}</code> block in your multi-project builds so that you can use the type-safe accessors. Another consideration with multi-project builds is that you won&#8217;t be able to use type-safe accessors when configuring subprojects within the root build script or with other forms of cross configuration between projects. We discuss both topics in more detail in the following sections.</p>
</div>
<div class="sect4">
<h5 id="sec:multi_project_builds_applying_plugins"><a class="anchor" href="#sec:multi_project_builds_applying_plugins"></a><a class="link" href="#sec:multi_project_builds_applying_plugins">Applying plugins</a></h5>
<div class="paragraph">
<p>You can declare your plugins within the subprojects to which they apply, but we recommend that you also declare them within the root project build script. This makes it easier to keep plugin versions consistent across projects within a build. The approach also improves the performance of the build.</p>
</div>
<div class="paragraph">
<p>The <a href="#sec:subprojects_plugins_dsl">Using Gradle plugins</a> chapter explains how you can declare plugins in the root project build script with a version and then apply them to the appropriate subprojects' build scripts. What follows is an example of this approach using three subprojects and three plugins. Note how the root build script only declares the community plugins as the Java Library Plugin is tied to the version of Gradle you are using:</p>
</div>
<div id="ex:multi_project_ratpack" class="exampleblock">
<div class="title">Example 361. <a href="#ex:multi_project_ratpack">Declare plugin dependencies in the root build script using the <code>plugins {}</code> block</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;multi-project-build&quot;
include(&quot;domain&quot;, &quot;infra&quot;, &quot;http&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.github.johnrengelman.shadow&quot;) version &quot;7.1.2&quot; apply false
    id(&quot;io.ratpack.ratpack-java&quot;) version &quot;1.8.2&quot; apply false
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">domain/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

dependencies {
    api(&quot;javax.measure:unit-api:1.0&quot;)
    implementation(&quot;tec.units:unit-ri:1.0.3&quot;)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">infra/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
    id(&quot;com.github.johnrengelman.shadow&quot;)
}

shadow {
    applicationDistribution.from(&quot;src/dist&quot;)
}

tasks.shadowJar {
    minimize()
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">http/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
    id(&quot;io.ratpack.ratpack-java&quot;)
}

dependencies {
    implementation(project(&quot;:domain&quot;))
    implementation(project(&quot;:infra&quot;))
    implementation(ratpack.dependency(&quot;dropwizard-metrics&quot;))
}

application {
    mainClass = &quot;example.App&quot;
}

ratpack.baseDir = file(&quot;src/ratpack/baseDir&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If your build requires additional plugin repositories on top of the Gradle Plugin Portal, you should declare them in the <code>pluginManagement {}</code> block in your <code>settings.gradle.kts</code> file, like so:</p>
</div>
<div id="ex-declare-additional-plugin-repositories" class="exampleblock">
<div class="title">Example 362. <a href="#ex-declare-additional-plugin-repositories">Declare additional plugin repositories</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    repositories {
        mavenCentral()
        gradlePluginPortal()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Plugins fetched from a source other than the <a href="https://plugins.gradle.org/">Gradle Plugin Portal</a> can only be declared via the <code>plugins {}</code> block if they are published with their <a href="#sec:plugin_markers">plugin marker artifacts</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
At the time of writing, all versions of the Android Plugin for Gradle up to 3.2.0 present in the <code>google()</code> repository lack plugin marker artifacts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If those artifacts are missing, then you can&#8217;t use the <code>plugins {}</code> block. You must instead fall back to declaring your plugin dependencies using the <code>buildscript {}</code> block in the root project build script. Here&#8217;s an example of doing that for the Android Plugin:</p>
</div>
<div id="ex-declare-plugin-dependencies-in-the-root-build-script-using-the-buildscript-block" class="exampleblock">
<div class="title">Example 363. <a href="#ex-declare-plugin-dependencies-in-the-root-build-script-using-the-buildscript-block">Declare plugin dependencies in the root build script using the <code>buildscript {}</code> block</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;lib&quot;, &quot;app&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildscript {
    repositories {
        google()
        gradlePluginPortal()
    }
    dependencies {
        classpath(&quot;com.android.tools.build:gradle:7.3.0&quot;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">lib/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.android.library&quot;)
}

android {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.android.application&quot;)
}

android {
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This technique is not that different from what Android Studio produces when creating a new build.
The main difference is that the subprojects' build scripts in the above sample declare their plugins using the <code>plugins {}</code> block. This means that you can use type-safe accessors for the model elements that they contribute.</p>
</div>
<div class="paragraph">
<p>Note that you can&#8217;t use this technique if you want to apply such a plugin either to the root project build script of a multi-project build (rather than solely to its subprojects) or to a single-project build. You&#8217;ll need to use a different approach in those cases that we detail in <a href="#sec:plugins_resolution_strategy">another section</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:kotlin_cross_project_configuration"><a class="anchor" href="#sec:kotlin_cross_project_configuration"></a><a class="link" href="#sec:kotlin_cross_project_configuration">Cross-configuring projects</a></h5>
<div class="paragraph">
<p><a href="#sec:convention_plugins_vs_cross_configuration">Cross project configuration</a> is a mechanism by which you can configure a project from another project&#8217;s build script. A common example is when you configure subprojects in the root project build script.</p>
</div>
<div class="paragraph">
<p>Taking this approach means that you won&#8217;t be able to use type-safe accessors for model elements contributed by the plugins. You will instead have to rely on string literals and the standard Gradle APIs.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s modify the <a href="#ex:multi_project_ratpack">Java/Ratpack sample build</a> to fully configure its subprojects from the root project build script:</p>
</div>
<div id="ex-cross-configuring-projects" class="exampleblock">
<div class="title">Example 364. <a href="#ex-cross-configuring-projects">Cross-configuring projects</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;multi-project-build&quot;
include(&quot;domain&quot;, &quot;infra&quot;, &quot;http&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import com.github.jengelman.gradle.plugins.shadow.ShadowExtension
import com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar
import ratpack.gradle.RatpackExtension

plugins {
    id(&quot;com.github.johnrengelman.shadow&quot;) version &quot;7.1.2&quot; apply false
    id(&quot;io.ratpack.ratpack-java&quot;) version &quot;1.8.2&quot; apply false
}

project(&quot;:domain&quot;) {
    apply(plugin = &quot;java-library&quot;)
    repositories { mavenCentral() }
    dependencies {
        &quot;api&quot;(&quot;javax.measure:unit-api:1.0&quot;)
        &quot;implementation&quot;(&quot;tec.units:unit-ri:1.0.3&quot;)
    }
}

project(&quot;:infra&quot;) {
    apply(plugin = &quot;java-library&quot;)
    apply(plugin = &quot;com.github.johnrengelman.shadow&quot;)
    configure&lt;ShadowExtension&gt; {
        applicationDistribution.from(&quot;src/dist&quot;)
    }
    tasks.named&lt;ShadowJar&gt;(&quot;shadowJar&quot;) {
        minimize()
    }
}

project(&quot;:http&quot;) {
    apply(plugin = &quot;java&quot;)
    apply(plugin = &quot;io.ratpack.ratpack-java&quot;)
    repositories { mavenCentral() }
    val ratpack = the&lt;RatpackExtension&gt;()
    dependencies {
        &quot;implementation&quot;(project(&quot;:domain&quot;))
        &quot;implementation&quot;(project(&quot;:infra&quot;))
        &quot;implementation&quot;(ratpack.dependency(&quot;dropwizard-metrics&quot;))
        &quot;runtimeOnly&quot;(&quot;org.slf4j:slf4j-simple:1.7.25&quot;)
    }
    configure&lt;JavaApplication&gt; {
        mainClass = &quot;example.App&quot;
    }
    ratpack.baseDir = file(&quot;src/ratpack/baseDir&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note how we&#8217;re using the <code>apply()</code> method to apply the plugins since the <code>plugins {}</code> block doesn&#8217;t work in this context.
We are also using standard APIs instead of type-safe accessors to configure tasks, extensions and conventions — an approach that we discussed in <a href="#sec:kotlin_using_standard_api">more detail elsewhere</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:plugins_resolution_strategy"><a class="anchor" href="#sec:plugins_resolution_strategy"></a><a class="link" href="#sec:plugins_resolution_strategy">When you can&#8217;t use the <code>plugins {}</code> block</a></h4>
<div class="paragraph">
<p>Plugins fetched from a source other than the <a href="https://plugins.gradle.org/">Gradle Plugin Portal</a> may or may not be usable with the <code>plugins {}</code> block.
It depends on how they have been published and, specifically, whether they have been published with the necessary <a href="#sec:plugin_markers">plugin marker artifacts</a>.</p>
</div>
<div class="paragraph">
<p>For example, the Android Plugin for Gradle is not published to the Gradle Plugin Portal and — at least up to version 3.2.0 of the plugin — the metadata required to resolve the artifacts for a given plugin identifier is not published to the Google repository.</p>
</div>
<div class="paragraph">
<p>If your build is a multi-project build and you don&#8217;t need to apply such a plugin to your <em>root</em> project, then you can get round this issue using the technique <a href="#sec:multi_project_builds_applying_plugins">described above</a>.
For any other situation, keep reading.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>When publishing plugins, please use Gradle&#8217;s built-in <a href="java_gradle_plugin.html#java_gradle_plugin">Gradle Plugin Development Plugin</a>.</p>
</div>
<div class="paragraph">
<p>It automates the publication of the metadata necessary to make your plugins usable with the <code>plugins {}</code> block.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will show you in this section how to apply the Android Plugin to a single-project build or the root project of a multi-project build.
The goal is to instruct your build on how to map the <code>com.android.application</code> plugin identifier to a resolvable artifact.
This is done in two steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a plugin repository to the build&#8217;s settings script</p>
</li>
<li>
<p>Map the plugin ID to the corresponding artifact coordinates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You accomplish both steps by configuring a <code>pluginManagement {}</code> block in the build&#8217;s settings script.
To demonstrate, the following sample adds the <code>google()</code> repository — where the Android plugin is published — to the repository search list, and uses a <code>resolutionStrategy {}</code> block to map the <code>com.android.application</code> plugin ID to the <code>com.android.tools.build:gradle:&lt;version&gt;</code> artifact available in the <code>google()</code> repository:</p>
</div>
<div id="ex-mapping-plugin-ids-to-dependency-coordinates" class="exampleblock">
<div class="title">Example 365. <a href="#ex-mapping-plugin-ids-to-dependency-coordinates">Mapping plugin IDs to dependency coordinates</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    repositories {
        google()
        gradlePluginPortal()
    }
    resolutionStrategy {
        eachPlugin {
            if(requested.id.namespace == &quot;com.android&quot;) {
                useModule(&quot;com.android.tools.build:gradle:${requested.version}&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.android.application&quot;) version &quot;7.3.0&quot;
}

android {
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In fact, the above sample will work for all <code>com.android.*</code> plugins that are provided by the specified module. That&#8217;s because the packaged module contains the details of which plugin ID maps to which plugin implementation class, using the properties-file mechanism described in the <a href="#sec:custom_plugins_standalone_project">Writing Custom Plugins</a> chapter.</p>
</div>
<div class="paragraph">
<p>See the <a href="#sec:plugin_management">Plugin Management</a> section of the Gradle user manual for more information on the <code>pluginManagement {}</code> block and what it can be used for.</p>
</div>
</div>
<div class="sect3">
<h4 id="kotdsl:containers"><a class="anchor" href="#kotdsl:containers"></a><a class="link" href="#kotdsl:containers">Working with container objects</a></h4>
<div class="paragraph">
<p>The Gradle build model makes heavy use of container objects (or just "containers").
For example, both <code>configurations</code> and <code>tasks</code> are container objects that contain <code>Configuration</code> and <code>Task</code> objects respectively.
Community plugins also contribute containers, like the <code>android.buildTypes</code> container contributed by the Android Plugin.</p>
</div>
<div class="paragraph">
<p>The Kotlin DSL provides several ways for build authors to interact with containers.
We look at each of those ways next, using the <code>tasks</code> container as an example.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Note that you can leverage the type-safe accessors described in <a href="#kotdsl:accessor_applicability">another section</a> if you are configuring existing elements on supported containers. That section also describes which containers support type-safe accessors.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="using_the_container_api"><a class="anchor" href="#using_the_container_api"></a><a class="link" href="#using_the_container_api">Using the container API</a></h5>
<div class="paragraph">
<p>All containers in Gradle implement <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.NamedDomainObjectContainer.html#org.gradle.api.NamedDomainObjectContainer">NamedDomainObjectContainer&lt;DomainObjectType&gt;</a>.
Some of them can contain objects of different types and implement <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.PolymorphicDomainObjectContainer.html#org.gradle.api.PolymorphicDomainObjectContainer">PolymorphicDomainObjectContainer&lt;BaseType&gt;</a>.
The simplest way to interact with containers is through these interfaces.</p>
</div>
<div class="paragraph">
<p>The following sample demonstrates how you can use the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.NamedDomainObjectContainer.html#org.gradle.api.NamedDomainObjectContainer:named(java.lang.String)">named()</a> method to configure existing tasks and the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.NamedDomainObjectContainer.html#org.gradle.api.NamedDomainObjectContainer:register(java.lang.String)">register()</a> method to create new ones.</p>
</div>
<div id="ex-using-the-container-api" class="exampleblock">
<div class="title">Example 366. <a href="#ex-using-the-container-api">Using the container API</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named(&quot;check&quot;)                    // <b class="conum">(1)</b>
tasks.register(&quot;myTask1&quot;)               // <b class="conum">(2)</b>

tasks.named&lt;JavaCompile&gt;(&quot;compileJava&quot;) // <b class="conum">(3)</b>
tasks.register&lt;Copy&gt;(&quot;myCopy1&quot;)         // <b class="conum">(4)</b>

tasks.named(&quot;assemble&quot;) {               // <b class="conum">(5)</b>
    dependsOn(&quot;:myTask1&quot;)
}
tasks.register(&quot;myTask2&quot;) {             // <b class="conum">(6)</b>
    description = &quot;Some meaningful words&quot;
}

tasks.named&lt;Test&gt;(&quot;test&quot;) {             // <b class="conum">(7)</b>
    testLogging.showStackTraces = true
}
tasks.register&lt;Copy&gt;(&quot;myCopy2&quot;) {       // <b class="conum">(8)</b>
    from(&quot;source&quot;)
    into(&quot;destination&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Gets a reference of type <code>Task</code> to the existing task named <code>check</code></p>
</li>
<li>
<p>Registers a new untyped task named <code>myTask1</code></p>
</li>
<li>
<p>Gets a reference to the existing task named <code>compileJava</code> of type <code>JavaCompile</code></p>
</li>
<li>
<p>Registers a new task named <code>myCopy1</code> of type <code>Copy</code></p>
</li>
<li>
<p>Gets a reference to the existing (untyped) task named <code>assemble</code> and configures it — you can only configure properties and methods that are available on <code>Task</code> with this syntax</p>
</li>
<li>
<p>Registers a new untyped task named <code>myTask2</code> and configures it — you can only configure properties and methods that are available on <code>Task</code> in this case</p>
</li>
<li>
<p>Gets a reference to the existing task named <code>test</code> of type <code>Test</code> and configures it — in this case you have access to the properties and methods of the specified type</p>
</li>
<li>
<p>Registers a new task named <code>myCopy2</code> of type <code>Copy</code> and configures it</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The above sample relies on the configuration avoidance APIs. If you need or want to eagerly configure or register container elements, simply replace <code>named()</code> with <code>getByName()</code> and <code>register()</code> with <code>create()</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="using_kotlin_delegated_properties"><a class="anchor" href="#using_kotlin_delegated_properties"></a><a class="link" href="#using_kotlin_delegated_properties">Using Kotlin delegated properties</a></h5>
<div class="paragraph">
<p>Another way to interact with containers is via Kotlin delegated properties.
These are particularly useful if you need a reference to a container element that you can use elsewhere in the build.
In addition, Kotlin delegated properties can easily be renamed via IDE refactoring.</p>
</div>
<div class="paragraph">
<p>The following sample does the exact same things as the one in the previous section, but it uses delegated properties and reuses those references in place of string-literal task paths:</p>
</div>
<div id="ex-using-kotlin-delegated-properties" class="exampleblock">
<div class="title">Example 367. <a href="#ex-using-kotlin-delegated-properties">Using Kotlin delegated properties</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val check by tasks.existing
val myTask1 by tasks.registering

val compileJava by tasks.existing(JavaCompile::class)
val myCopy1 by tasks.registering(Copy::class)

val assemble by tasks.existing {
    dependsOn(myTask1)  // <b class="conum">(1)</b>
}
val myTask2 by tasks.registering {
    description = &quot;Some meaningful words&quot;
}

val test by tasks.existing(Test::class) {
    testLogging.showStackTraces = true
}
val myCopy2 by tasks.registering(Copy::class) {
    from(&quot;source&quot;)
    into(&quot;destination&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Uses the reference to the <code>myTask1</code> task rather than a task path</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The above rely on configuration avoidance APIs.
If you need to eagerly configure or register container elements simply replace <a href="https://docs.gradle.org/8.9/kotlin-dsl/gradle/org.gradle.kotlin.dsl/existing.html"><code>existing()</code></a> with <a href="https://docs.gradle.org/8.9/kotlin-dsl/gradle/org.gradle.kotlin.dsl/getting.html"><code>getting()</code></a> and <a href="https://docs.gradle.org/8.9/kotlin-dsl/gradle/org.gradle.kotlin.dsl/registering.html"><code>registering()</code></a> with <a href="https://docs.gradle.org/8.9/kotlin-dsl/gradle/org.gradle.kotlin.dsl/creating.html"><code>creating()</code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="configuring_multiple_container_elements_together"><a class="anchor" href="#configuring_multiple_container_elements_together"></a><a class="link" href="#configuring_multiple_container_elements_together">Configuring multiple container elements together</a></h5>
<div class="paragraph">
<p>When configuring several elements of a container one can group interactions in a block in order to avoid repeating the container&#8217;s name on each interaction.
The following example uses a combination of type-safe accessors, the container API and Kotlin delegated properties:</p>
</div>
<div id="ex-container-scope" class="exampleblock">
<div class="title">Example 368. <a href="#ex-container-scope">Container scope</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks {
    test {
        testLogging.showStackTraces = true
    }
    val myCheck by registering {
        doLast { /* assert on something meaningful */ }
    }
    check {
        dependsOn(myCheck)
    }
    register(&quot;myHelp&quot;) {
        doLast { /* do something helpful */ }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kotdsl:properties"><a class="anchor" href="#kotdsl:properties"></a><a class="link" href="#kotdsl:properties">Working with runtime properties</a></h4>
<div class="paragraph">
<p>Gradle has two main sources of properties that are defined at runtime: <a href="#sec:project_properties"><em>project properties</em></a> and <a href="#sec:extra_properties"><em>extra properties</em></a>.
The Kotlin DSL provides specific syntax for working with these types of properties, which we look at in the following sections.</p>
</div>
<div class="sect4">
<h5 id="project_properties"><a class="anchor" href="#project_properties"></a><a class="link" href="#project_properties">Project properties</a></h5>
<div class="paragraph">
<p>The Kotlin DSL allows you to access project properties by binding them via Kotlin delegated properties.
Here&#8217;s a sample snippet that demonstrates the technique for a couple of project properties, one of which <em>must</em> be defined:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val myProperty: String by project  // <b class="conum">(1)</b>
val myNullableProperty: String? by project // <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Makes the <code>myProperty</code> project property available via a <code>myProperty</code> delegated property — the project property must exist in this case, otherwise the build will fail when the build script attempts to use the <code>myProperty</code> value</p>
</li>
<li>
<p>Does the same for the <code>myNullableProperty</code> project property, but the build won&#8217;t fail on using the <code>myNullableProperty</code> value as long as you check for null (standard <a href="https://kotlinlang.org/docs/reference/null-safety.html">Kotlin rules for null safety</a> apply)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The same approach works in both settings and initialization scripts, except you use <code>by settings</code> and <code>by gradle</code> respectively in place of <code>by project</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="extra_properties"><a class="anchor" href="#extra_properties"></a><a class="link" href="#extra_properties">Extra properties</a></h5>
<div class="paragraph">
<p>Extra properties are available on any object that implements the <a href="https://docs.gradle.org/8.9/dsl/org.gradle.api.plugins.ExtensionAware.html#org.gradle.api.plugins.ExtensionAware">ExtensionAware</a> interface.
Kotlin DSL allows you to access extra properties and create new ones via delegated properties, using any of the <code>by extra</code> forms demonstrated in the following sample:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val myNewProperty by extra(&quot;initial value&quot;)  // <b class="conum">(1)</b>
val myOtherNewProperty by extra { &quot;calculated initial value&quot; }  // <b class="conum">(2)</b>

val myProperty: String by extra  // <b class="conum">(3)</b>
val myNullableProperty: String? by extra  // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Creates a new extra property called <code>myNewProperty</code> in the current context (the project in this case) and initializes it with the value <code>"initial value"</code>, which also determines the property&#8217;s <em>type</em></p>
</li>
<li>
<p>Create a new extra property whose initial value is calculated by the provided lambda</p>
</li>
<li>
<p>Binds an existing extra property from the current context (the project in this case) to a <code>myProperty</code> reference</p>
</li>
<li>
<p>Does the same as the previous line but allows the property to have a null value</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This approach works for all Gradle scripts: project build scripts, script plugins, settings scripts and initialization scripts.</p>
</div>
<div class="paragraph">
<p>You can also access extra properties on a root project from a subproject using the following syntax:</p>
</div>
<div class="listingblock">
<div class="title">my-sub-project/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val myNewProperty: String by rootProject.extra  // <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Binds the root project&#8217;s <code>myNewProperty</code> extra property to a reference of the same name</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Extra properties aren&#8217;t just limited to projects.
For example, <code>Task</code> extends <code>ExtensionAware</code>, so you can attach extra properties to tasks as well.
Here&#8217;s an example that defines a new <code>myNewTaskProperty</code> on the <code>test</code> task and then uses that property to initialize another task:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks {
    test {
        val reportType by extra(&quot;dev&quot;)  // <b class="conum">(1)</b>
        doLast {
            // Use 'suffix' for post processing of reports
        }
    }

    register&lt;Zip&gt;(&quot;archiveTestReports&quot;) {
        val reportType: String by test.get().extra  // <b class="conum">(2)</b>
        archiveAppendix = reportType
        from(test.get().reports.html.destination)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Creates a new <code>reportType</code> extra property on the <code>test</code> task</p>
</li>
<li>
<p>Makes the <code>test</code> task&#8217;s <code>reportType</code> extra property available to configure the <code>archiveTestReports</code> task</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you&#8217;re happy to use eager configuration rather than the configuration avoidance APIs, you could use a single, "global" property for the report type, like this:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test.doLast { ... }

val testReportType by tasks.test.get().extra(&quot;dev&quot;)  // <b class="conum">(1)</b>

tasks.create&lt;Zip&gt;(&quot;archiveTestReports&quot;) {
    archiveAppendix = testReportType  // <b class="conum">(2)</b>
    from(test.get().reports.html.destination)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Creates and initializes an extra property on the <code>test</code> task, binding it to a "global" property</p>
</li>
<li>
<p>Uses the "global" property to initialize the <code>archiveTestReports</code> task</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There is one last syntax for extra properties that we should cover, one that treats <code>extra</code> as a map.
We recommend against using this in general as you lose the benefits of Kotlin&#8217;s type checking and it prevents IDEs from providing as much support as they could.
However, it is more succinct than the delegated properties syntax and can reasonably be used if you only need to set the value of an extra property without referencing it later.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple example demonstrating how to set and read extra properties using the map syntax:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">extra[&quot;myNewProperty&quot;] = &quot;initial value&quot;  // <b class="conum">(1)</b>

tasks.create(&quot;myTask&quot;) {
    doLast {
        println(&quot;Property: ${project.extra[&quot;myNewProperty&quot;]}&quot;)  // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Creates a new project extra property called <code>myNewProperty</code> and sets its value</p>
</li>
<li>
<p>Reads the value from the project extra property we created — note the <code>project.</code> qualifier on <code>extra[&#8230;&#8203;]</code>, otherwise Gradle will assume we want to read an extra property from the <em>task</em></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kotdsl:assignment"><a class="anchor" href="#kotdsl:assignment"></a><a class="link" href="#kotdsl:assignment">Kotlin lazy property assignment</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s Kotlin DSL supports lazy property assignment using the <code>=</code> operator .
Lazy property assignment reduces the verbosity for Kotlin DSL when <a href="#lazy_properties">lazy properties</a> are used.
It works for properties that are publicly seen as <code>final</code> (without a setter) and have type <code>Property</code> or <code>ConfigurableFileCollection</code>.
Since properties have to be <code>final</code>, our general recommendation is not to implement custom setters for properties with lazy types and, if possible, implement such properties via an abstract getter.</p>
</div>
<div class="paragraph">
<p>Using the <code>=</code> operator is the preferred way to call <code>set()</code> in the Kotlin DSL.</p>
</div>
<div id="ex-kotlin-lazy-property-assignment" class="exampleblock">
<div class="title">Example 369. <a href="#ex-kotlin-lazy-property-assignment">Kotlin lazy property assignment</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)
    }
}

abstract class WriteJavaVersionTask : DefaultTask() {
    @get:Input
    abstract val javaVersion: Property&lt;String&gt;
    @get:OutputFile
    abstract val output: RegularFileProperty

    @TaskAction
    fun execute() {
        output.get().asFile.writeText(&quot;Java version: ${javaVersion.get()}&quot;)
    }
}

tasks.register&lt;WriteJavaVersionTask&gt;(&quot;writeJavaVersion&quot;) {
    javaVersion.set(&quot;17&quot;) // <b class="conum">(1)</b>
    javaVersion = &quot;17&quot; // <b class="conum">(2)</b>
    javaVersion = java.toolchain.languageVersion.map { it.toString() } // <b class="conum">(3)</b>
    output = layout.buildDirectory.file(&quot;writeJavaVersion/javaVersion.txt&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Set value with the <code>.set()</code> method</p>
</li>
<li>
<p>Set value with lazy property assignment using the <code>=</code> operator</p>
</li>
<li>
<p>The <code>=</code> operator can be used also for assigning lazy values</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="ide_support"><a class="anchor" href="#ide_support"></a><a class="link" href="#ide_support">IDE support</a></h5>
<div class="paragraph">
<p>Lazy property assignment is supported from IntelliJ 2022.3 and from Android Studio Giraffe.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:kotlin-dsl_plugin"><a class="anchor" href="#sec:kotlin-dsl_plugin"></a><a class="link" href="#sec:kotlin-dsl_plugin">The Kotlin DSL Plugin</a></h4>
<div class="paragraph">
<p>The Kotlin DSL Plugin provides a convenient way to develop Kotlin-based projects that contribute build logic.
That includes <a href="#sec:using_buildsrc">buildSrc projects</a>, <a href="#composite_builds">included builds</a> and <a href="#custom_plugins">Gradle plugins</a>.</p>
</div>
<div class="paragraph">
<p>The plugin achieves this by doing the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Applies the <a href="https://kotlinlang.org/docs/reference/using-gradle.html#targeting-the-jvm">Kotlin Plugin</a>, which adds support for compiling Kotlin source files.</p>
</li>
<li>
<p>Adds the <code>kotlin-stdlib</code>, <code>kotlin-reflect</code> and <code>gradleKotlinDsl()</code> dependencies to the <code>compileOnly</code> and <code>testImplementation</code> configurations, which allows you to make use of those Kotlin libraries and the Gradle API in your Kotlin code.</p>
</li>
<li>
<p>Configures the Kotlin compiler with the same settings that are used for Kotlin DSL scripts, ensuring consistency between your build logic and those scripts:</p>
<div class="ulist">
<ul>
<li>
<p>adds <a href="#sec:kotlin_compiler_arguments">Kotlin compiler arguments</a>,</p>
</li>
<li>
<p>registers the <a href="https://kotlinlang.org/docs/sam-with-receiver-plugin.html">SAM-with-receiver Kotlin compiler plugin</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enables support for <a href="#sec:precompile_script_plugin">precompiled script plugins</a>.</p>
</li>
</ul>
</div>
<div class="openblock">
<div class="title">Avoid specifying a version for the <code>kotlin-dsl</code> plugin</div>
<div class="content">
<div class="paragraph">
<p>Each Gradle release is meant to be used with a specific version of the <code>kotlin-dsl</code> plugin and compatibility between arbitrary Gradle releases and <code>kotlin-dsl</code> plugin versions is not guaranteed. Using an unexpected version of the <code>kotlin-dsl</code> plugin in a build will emit a warning and can cause hard to diagnose problems.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is the basic configuration you need to use the plugin:</p>
</div>
<div id="ex-applying-the-kotlin-dsl-plugin-to-a-buildsrc-project" class="exampleblock">
<div class="title">Example 370. <a href="#ex-applying-the-kotlin-dsl-plugin-to-a-buildsrc-project">Applying the Kotlin DSL Plugin to a <code>buildSrc</code> project</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `kotlin-dsl`
}

repositories {
    // The org.jetbrains.kotlin.jvm plugin requires a repository
    // where to download the Kotlin compiler dependencies from.
    mavenCentral()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Kotlin DSL Plugin leverages <a href="#toolchains">Java Toolchains</a>.
By default the code will target Java 8.
You can change that by defining a Java toolchain to be used by the project:</p>
</div>
<div id="ex-changing-the-jvm-target-using-toolchains" class="exampleblock">
<div class="title">Example 371. <a href="#ex-changing-the-jvm-target-using-toolchains">Changing the JVM target using toolchains</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/myproject.java-conventions.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(11)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/myproject.java-conventions.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(<span class="integer">11</span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:kotlin"><a class="anchor" href="#sec:kotlin"></a><a class="link" href="#sec:kotlin">The embedded Kotlin</a></h4>
<div class="paragraph">
<p>Gradle embeds Kotlin in order to provide support for Kotlin-based scripts.</p>
</div>
<div class="sect4">
<h5 id="kotlin_versions"><a class="anchor" href="#kotlin_versions"></a><a class="link" href="#kotlin_versions">Kotlin versions</a></h5>
<div class="paragraph">
<p>Gradle ships with <code>kotlin-compiler-embeddable</code> plus matching versions of <code>kotlin-stdlib</code> and <code>kotlin-reflect</code> libraries. For details see the Kotlin section of Gradle&#8217;s <a href="#kotlin">compatibility matrix</a>. The <code>kotlin</code> package from those modules is visible through the Gradle classpath.</p>
</div>
<div class="paragraph">
<p>The <a href="https://kotlinlang.org/docs/reference/compatibility.html">compatibility guarantees</a> provided by Kotlin apply for both backward and forward compatibility.</p>
</div>
<div class="sect5">
<h6 id="backward_compatibility"><a class="anchor" href="#backward_compatibility"></a><a class="link" href="#backward_compatibility">Backward compatibility</a></h6>
<div class="paragraph">
<p>Our approach is to only do backwards-breaking Kotlin upgrades on a major Gradle release. We will always clearly document which Kotlin version we ship and announce upgrade plans before a major release.</p>
</div>
<div class="paragraph">
<p>Plugin authors who want to stay compatible with older Gradle versions need to limit their API usage to a subset that is compatible with these old versions. It’s not really different from any other new API in Gradle. E.g. if we introduce a new API for dependency resolution and a plugin wants to use that API, then they either need to drop support for older Gradle versions or they need to do some clever organization of their code to only execute the new code path on newer versions.</p>
</div>
</div>
<div class="sect5">
<h6 id="forward_compatibility"><a class="anchor" href="#forward_compatibility"></a><a class="link" href="#forward_compatibility">Forward compatibility</a></h6>
<div class="paragraph">
<p>The biggest issue is the compatibility between the external <code>kotlin-gradle-plugin</code> version and the <code>kotlin-stdlib</code> version shipped with Gradle. More generally, between any plugin that transitively depends on <code>kotlin-stdlib</code> and its version shipped with Gradle. As long as the combination is compatible everything should work. This will become less of an issue as the language matures.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:kotlin_compiler_arguments"><a class="anchor" href="#sec:kotlin_compiler_arguments"></a><a class="link" href="#sec:kotlin_compiler_arguments">Kotlin compiler arguments</a></h5>
<div class="paragraph">
<p>These are the Kotlin compiler arguments used for compiling Kotlin DSL scripts and Kotlin sources and scripts in a project that has the <code>kotlin-dsl</code> plugin applied:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-java-parameters</code></dt>
<dd>
<p>Generate metadata for Java &gt;= 1.8 reflection on method parameters.
See <a href="https://kotlinlang.org/docs/compiler-reference.html#kotlin-jvm-compiler-options">Kotlin/JVM compiler options</a> in the Kotlin documentation for more information.</p>
</dd>
<dt class="hdlist1"><code>-Xjvm-default=all</code></dt>
<dd>
<p>Makes all non-abstract members of Kotlin interfaces default for the Java classes implementing them.
This is to provide a better interoperability with Java and Groovy for plugins written in Kotlin.
See <a href="https://kotlinlang.org/docs/java-to-kotlin-interop.html#default-methods-in-interfaces">Default methods in interfaces</a> in the Kotlin documentation for more information.</p>
</dd>
<dt class="hdlist1"><code>-Xsam-conversions=class</code></dt>
<dd>
<p>Sets up the implementation strategy for SAM (single abstract method) conversion to always generate anonymous classes, instead of using the <code>invokedynamic</code> JVM instruction.
This is to provide a better support for configuration cache and incremental build.
See <a href="https://youtrack.jetbrains.com/issue/KT-44912">KT-44912</a> in the Kotlin issue tracker for more information.</p>
</dd>
<dt class="hdlist1"><code>-Xjsr305=strict</code></dt>
<dd>
<p>Sets up Kotlin&#8217;s Java interoperability to strictly follow JSR-305 annotations for increased null safety.
See <a href="https://kotlinlang.org/docs/reference/java-interop.html#compiler-configuration">Calling Java code from Kotlin</a> in the Kotlin documentation for more information.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:interoperability"><a class="anchor" href="#sec:interoperability"></a><a class="link" href="#sec:interoperability">Interoperability</a></h4>
<div class="paragraph">
<p>When mixing languages in your build logic, you may have to cross language boundaries.
An extreme example would be a build that uses tasks and plugins that are implemented in Java, Groovy and Kotlin, while also using both Kotlin DSL and Groovy DSL build scripts.</p>
</div>
<div class="paragraph">
<p>Quoting the Kotlin reference documentation:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Kotlin is designed with Java Interoperability in mind. Existing Java code can be called from Kotlin in a natural way, and Kotlin code can be used from Java rather smoothly as well.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Both <a href="https://kotlinlang.org/docs/reference/java-interop.html">calling Java from Kotlin</a> and <a href="https://kotlinlang.org/docs/reference/java-to-kotlin-interop.html">calling Kotlin from Java</a> are very well covered in the Kotlin reference documentation.</p>
</div>
<div class="paragraph">
<p>The same mostly applies to interoperability with Groovy code.
In addition, the Kotlin DSL provides several ways to opt into Groovy semantics, which we look at next.</p>
</div>
<div class="sect4">
<h5 id="static_extensions"><a class="anchor" href="#static_extensions"></a><a class="link" href="#static_extensions">Static extensions</a></h5>
<div class="paragraph">
<p>Both the Groovy and Kotlin languages support extending existing classes via <a href="https://groovy-lang.org/metaprogramming.html#_extension_modules">Groovy Extension modules</a> and <a href="https://kotlinlang.org/docs/reference/extensions.html">Kotlin extensions</a>.</p>
</div>
<div class="paragraph">
<p>To call a Kotlin extension function from Groovy, call it as a static function, passing the receiver as the first parameter:</p>
</div>
<div id="ex-calling-a-kotlin-extension-from-groovy" class="exampleblock">
<div class="title">Example 372. <a href="#ex-calling-a-kotlin-extension-from-groovy">Calling a Kotlin extension from Groovy</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">TheTargetTypeKt.kotlinExtensionFunction(receiver, <span class="string"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>, aReference)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Kotlin extension functions are package-level functions and you can learn how to locate the name of the type declaring a given Kotlin extension in the <a href="https://kotlinlang.org/docs/reference/java-to-kotlin-interop.html#package-level-functions">Package-Level Functions</a> section of the Kotlin reference documentation.</p>
</div>
<div class="paragraph">
<p>To call a Groovy extension method from Kotlin, the same approach applies: call it as a static function passing the receiver as the first parameter.
Here&#8217;s an example:</p>
</div>
<div id="ex-calling-a-groovy-extension-from-kotlin" class="exampleblock">
<div class="title">Example 373. <a href="#ex-calling-a-groovy-extension-from-kotlin">Calling a Groovy extension from Kotlin</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">TheTargetTypeGroovyExtension.groovyExtensionMethod(receiver, &quot;parameters&quot;, 42, aReference)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="named_parameters_and_default_arguments"><a class="anchor" href="#named_parameters_and_default_arguments"></a><a class="link" href="#named_parameters_and_default_arguments">Named parameters and default arguments</a></h5>
<div class="paragraph">
<p>Both the Groovy and Kotlin languages support named function parameters and default arguments, although they are implemented very differently.
Kotlin has fully-fledged support for both, as described in the Kotlin language reference under <a href="https://kotlinlang.org/docs/reference/functions.html#named-arguments">named arguments</a> and <a href="https://kotlinlang.org/docs/reference/functions.html#default-arguments">default arguments</a>.
Groovy implements <a href="https://groovy-lang.org/objectorientation.html#_named_arguments">named arguments</a> in a non-type-safe way based on a <code>Map&lt;String, ?&gt;</code> parameter, which means they cannot be combined with <a href="https://groovy-lang.org/objectorientation.html#_default_arguments">default arguments</a>.
In other words, you can only use one or the other in Groovy for any given method.</p>
</div>
<div class="sect5">
<h6 id="calling_kotlin_from_groovy"><a class="anchor" href="#calling_kotlin_from_groovy"></a><a class="link" href="#calling_kotlin_from_groovy">Calling Kotlin from Groovy</a></h6>
<div class="paragraph">
<p>To call a Kotlin function that has named arguments from Groovy, just use a normal method call with positional parameters.
There is no way to provide values by argument name.</p>
</div>
<div class="paragraph">
<p>To call a Kotlin function that has default arguments from Groovy, always pass values for all the function parameters.</p>
</div>
</div>
<div class="sect5">
<h6 id="calling_groovy_from_kotlin"><a class="anchor" href="#calling_groovy_from_kotlin"></a><a class="link" href="#calling_groovy_from_kotlin">Calling Groovy from Kotlin</a></h6>
<div class="paragraph">
<p>To call a Groovy function with named arguments from Kotlin, you need to pass a <code>Map&lt;String, ?&gt;</code>, as shown in this example:</p>
</div>
<div id="ex-call-groovy-function-with-named-arguments-from-kotlin" class="exampleblock multi-language-sample">
<div class="title">Example 374. <a href="#ex-call-groovy-function-with-named-arguments-from-kotlin">Call Groovy function with named arguments from Kotlin</a></div>
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">groovyNamedArgumentTakingMethod(mapOf(
    &quot;parameterName&quot; to &quot;value&quot;,
    &quot;other&quot; to 42,
    &quot;and&quot; to aReference))</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To call a Groovy function with default arguments from Kotlin, always pass values for all the parameters.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="groovy_closures_from_kotlin"><a class="anchor" href="#groovy_closures_from_kotlin"></a><a class="link" href="#groovy_closures_from_kotlin">Groovy closures from Kotlin</a></h5>
<div class="paragraph">
<p>You may sometimes have to call Groovy methods that take <a href="https://groovy-lang.org/closures.html">Closure</a> arguments from Kotlin code.
For example, some third-party plugins written in Groovy expect closure arguments.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Gradle plugins written in any language should prefer the type <code>Action&lt;T&gt;</code> type in place of closures. Groovy closures and Kotlin lambdas are automatically mapped to arguments of that type.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to provide a way to construct closures while preserving Kotlin&#8217;s strong typing, two helper methods exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>closureOf&lt;T&gt; {}</code></p>
</li>
<li>
<p><code>delegateClosureOf&lt;T&gt; {}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both methods are useful in different circumstances and depend upon the method you are passing the <code>Closure</code> instance into.</p>
</div>
<div class="paragraph">
<p>Some plugins expect simple closures, as with the <a href="https://plugins.gradle.org/plugin/com.jfrog.bintray">Bintray</a> plugin:</p>
</div>
<div id="ex-use-closureof" class="exampleblock">
<div class="title">Example 375. <a href="#ex-use-closureof">Use <code>closureOf&lt;T&gt; {}</code></a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">bintray {
    pkg(closureOf&lt;PackageConfig&gt; {
        // Config for the package here
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In other cases, like with the <a href="https://plugins.gradle.org/plugin/org.gretty">Gretty Plugin</a> when configuring farms, the plugin expects a delegate closure:</p>
</div>
<div id="ex-use-delegateclosureof" class="exampleblock">
<div class="title">Example 376. <a href="#ex-use-delegateclosureof">Use <code>delegateClosureOf&lt;T&gt; {}</code></a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">farms {
    farm(&quot;OldCoreWar&quot;, delegateClosureOf&lt;FarmExtension&gt; {
        // Config for the war here
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There sometimes isn&#8217;t a good way to tell, from looking at the source code, which version to use.
Usually, if you get a <code>NullPointerException</code> with <code>closureOf&lt;T&gt; {}</code>, using <code>delegateClosureOf&lt;T&gt; {}</code>
will resolve the problem.</p>
</div>
<div class="paragraph">
<p>These two utility functions are useful for <em>configuration closures</em>, but some plugins might expect Groovy closures for other purposes.
The <code>KotlinClosure0</code> to <code>KotlinClosure2</code> types allows adapting Kotlin functions to Groovy closures with more flexibility.</p>
</div>
<div id="ex-use-kotlinclosurex-types" class="exampleblock">
<div class="title">Example 377. <a href="#ex-use-kotlinclosurex-types">Use <code>KotlinClosureX</code> types</a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">somePlugin {

    // Adapt parameter-less function
    takingParameterLessClosure(KotlinClosure0({
        &quot;result&quot;
    }))

    // Adapt unary function
    takingUnaryClosure(KotlinClosure1&lt;String, String&gt;({
        &quot;result from single parameter $this&quot;
    }))

    // Adapt binary function
    takingBinaryClosure(KotlinClosure2&lt;String, String, String&gt;({ a, b -&gt;
        &quot;result from parameters $a and $b&quot;
    }))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the_kotlin_dsl_groovy_builder"><a class="anchor" href="#the_kotlin_dsl_groovy_builder"></a><a class="link" href="#the_kotlin_dsl_groovy_builder">The Kotlin DSL Groovy Builder</a></h5>
<div class="paragraph">
<p>If some plugin makes heavy use of <a href="https://groovy-lang.org/metaprogramming.html">Groovy metaprogramming</a>, then using it from Kotlin or Java or any statically-compiled language can be very cumbersome.</p>
</div>
<div class="paragraph">
<p>The Kotlin DSL provides a <code>withGroovyBuilder {}</code> utility extension that attaches the Groovy metaprogramming semantics to objects of type <code>Any</code>.
The following example demonstrates several features of the method on the object <code>target</code>:</p>
</div>
<div id="ex-use-withgroovybuilder" class="exampleblock">
<div class="title">Example 378. <a href="#ex-use-withgroovybuilder">Use <code>withGroovyBuilder {}</code></a></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">target.withGroovyBuilder {                                          // <b class="conum">(1)</b>

    // GroovyObject methods available                               // <b class="conum">(2)</b>
    if (hasProperty(&quot;foo&quot;)) { /*...*/ }
    val foo = getProperty(&quot;foo&quot;)
    setProperty(&quot;foo&quot;, &quot;bar&quot;)
    invokeMethod(&quot;name&quot;, arrayOf(&quot;parameters&quot;, 42, aReference))

    // Kotlin DSL utilities
    &quot;name&quot;(&quot;parameters&quot;, 42, aReference)                            // <b class="conum">(3)</b>
        &quot;blockName&quot; {                                               // <b class="conum">(4)</b>
            // Same Groovy Builder semantics on `blockName`
        }
    &quot;another&quot;(&quot;name&quot; to &quot;example&quot;, &quot;url&quot; to &quot;https://example.com/&quot;) // <b class="conum">(5)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The receiver is a <a href="https://docs.groovy-lang.org/latest/html/api/groovy/lang/GroovyObject.html">GroovyObject</a> and provides Kotlin helpers</p>
</li>
<li>
<p>The <code>GroovyObject</code> API is available</p>
</li>
<li>
<p>Invoke the <code>methodName</code> method, passing some parameters</p>
</li>
<li>
<p>Configure the <code>blockName</code> property, maps to a <code>Closure</code> taking method invocation</p>
</li>
<li>
<p>Invoke <code>another</code> method taking named arguments, maps to a Groovy named arguments <code>Map&lt;String, ?&gt;</code> taking method invocation</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="using_a_groovy_script"><a class="anchor" href="#using_a_groovy_script"></a><a class="link" href="#using_a_groovy_script">Using a Groovy script</a></h5>
<div class="paragraph">
<p>Another option when dealing with problematic plugins that assume a Groovy DSL build script is to configure them in a Groovy DSL build script that is applied from the main Kotlin DSL build script:</p>
</div>
<div id="ex-using-a-groovy-script" class="exampleblock">
<div class="title">Example 379. <a href="#ex-using-a-groovy-script">Using a Groovy script</a></div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">dynamic-groovy-plugin-configuration.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">native</span> {                                                    <b class="conum">(1)</b>
    dynamic {
        groovy <span class="keyword">as</span> Usual
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;dynamic-groovy-plugin&quot;) version &quot;1.0&quot;               <b class="conum">(2)</b>
}
apply(from = &quot;dynamic-groovy-plugin-configuration.gradle&quot;)  <b class="conum">(3)</b></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The Groovy script uses dynamic Groovy to configure plugin</p>
</li>
<li>
<p>The Kotlin build script requests and applies the plugin</p>
</li>
<li>
<p>The Kotlin build script applies the Groovy script</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kotdsl:limitations"><a class="anchor" href="#kotdsl:limitations"></a><a class="link" href="#kotdsl:limitations">Limitations</a></h4>
<div class="ulist">
<ul>
<li>
<p>The Kotlin DSL is <a href="https://github.com/gradle/gradle/issues/15886">known to be slower than the Groovy DSL</a> on first use, for example with clean checkouts or on ephemeral continuous integration agents.
Changing something in the <em>buildSrc</em> directory also has an impact as it invalidates build-script caching.
The main reason for this is the slower script compilation for Kotlin DSL.</p>
</li>
<li>
<p>In IntelliJ IDEA, you must <a href="https://www.jetbrains.com/help/idea/gradle.html#gradle_import">import your project from the Gradle model</a> in order to get content assist and refactoring support for your Kotlin DSL build scripts.</p>
</li>
<li>
<p>Kotlin DSL script compilation avoidance has known issues.
If you encounter problems, it can be disabled by <a href="#sec:gradle_system_properties">setting</a> the <code>org.gradle.kotlin.dsl.scriptCompilationAvoidance</code> system property to <code>false</code>.</p>
</li>
<li>
<p>The Kotlin DSL will not support the <code>model {}</code> block, which is part of the <a href="https://blog.gradle.org/state-and-future-of-the-gradle-software-model">discontinued Gradle Software Model</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you run into trouble or discover a suspected bug, please report the issue in the <a href="https://github.com/gradle/gradle/issues/">Gradle issue tracker</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license_information"><a class="anchor" href="#license_information"></a><a class="link" href="#license_information"><strong>LICENSE INFORMATION</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="license"><a class="anchor" href="#license"></a><a class="link" href="#license">License Information</a></h3>
<div class="sect3">
<h4 id="sec:gradle_documentation"><a class="anchor" href="#sec:gradle_documentation"></a><a class="link" href="#sec:gradle_documentation">Gradle Documentation</a></h4>
<div class="paragraph">
<p><em>Copyright © 2007-2023 Gradle, Inc.</em></p>
</div>
<div class="paragraph">
<p>Gradle build tool source code is open-source and licensed under the <a href="https://github.com/gradle/gradle/blob/master/LICENSE">Apache License 2.0</a>.</p>
</div>
<div class="paragraph">
<p>Gradle user manual and DSL reference manual are licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="licenses:build_scan_plugin"><a class="anchor" href="#licenses:build_scan_plugin"></a><a class="link" href="#licenses:build_scan_plugin">Gradle Build Scan Plugin</a></h4>
<div class="paragraph">
<p>Use of the <a href="https://scans.gradle.com/plugin/">build scan plugin</a> is subject to <a href="https://gradle.com/legal/terms-of-service/">Gradle&#8217;s Terms of Service</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. <a href="#sec:build_script_plugins"><strong>Script plugins</strong></a> are hard to maintain. Do not use script plugins <code>apply from:</code>, they are not recommended.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. It is recommended to use a statically-typed language like <strong>Java</strong> or <strong>Kotlin</strong> for implementing plugins to reduce the likelihood of binary incompatibilities. If using Groovy, consider using <strong>statically compiled Groovy</strong>.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. Not compatible with the configuration cache.
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. In Groovy you can execute Strings.
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. The JUnit wiki contains a detailed description on how to work with JUnit categories: <a href="https://github.com/junit-team/junit/wiki/Categories" class="bare">https://github.com/junit-team/junit/wiki/Categories</a>.
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. The TestNG documentation contains more details about test groups: <a href="http://testng.org/doc/documentation-main.html#test-groups" class="bare">http://testng.org/doc/documentation-main.html#test-groups</a>.
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. The TestNG documentation contains more details about test ordering when working with <code>testng.xml</code> files: <a href="http://testng.org/doc/documentation-main.html#testng-xml" class="bare">http://testng.org/doc/documentation-main.html#testng-xml</a>.
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. Gradle uses the same conventions as introduced by Russel Winder&#8217;s <a href="https://gant.github.io/">Gant tool</a>.
</div>
<div class="footnote" id="_footnotedef_9">
<a href="#_footnoteref_9">9</a>. See <a href="#sec:configure_scala_classpath">Automatic configuration of Scala classpath</a>.
</div>
<div class="footnote" id="_footnotedef_10">
<a href="#_footnoteref_10">10</a>. The <code>CommandLineArgumentProvider</code> in this example is implemented as a <a href="properties_providers.html#managed_types">managed type</a>.
</div>
</div>
</div>
<!-- end div class="chapter" -->

<footer class="site-layout__footer site-footer" itemscope="itemscope" itemtype="https://schema.org/WPFooter">
    <nav class="site-footer__navigation" itemtype="https://schema.org/SiteNavigationElement">
        <section class="site-footer__links">
            <div class="site-footer__link-group">
                <header><strong>Docs</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="/release-notes.html" itemprop="url">Release Notes</a></li>
                    <li itemprop="name"><a href="/dsl/" itemprop="url">Groovy DSL</a></li>
                    <li itemprop="name"><a href="/kotlin-dsl/" itemprop="url">Kotlin DSL</a></li>
                    <li itemprop="name"><a href="/javadoc/" itemprop="url">Javadoc</a></li>
                </ul>
            </div>
            <div class="site-footer__link-group">
                <header><strong>News</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="https://blog.gradle.org/" itemprop="url">Blog</a></li>
                    <li itemprop="name"><a href="https://newsletter.gradle.org/" itemprop="url">Newsletter</a></li>
                    <li itemprop="name"><a href="https://twitter.com/gradle" itemprop="url">Twitter</a></li>
                    <li itemprop="name"><a href="https://status.gradle.com/" itemprop="url">Status</a></li>
                </ul>
            </div>
            <div class="site-footer__link-group">
                <header><strong>Products</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="https://gradle.com/develocity/" itemprop="url">Develocity</a></li>
                    <li itemprop="name"><a href="https://gradle.com/build-scans/" itemprop="url">Build Scan™</a></li>
                    <li itemprop="name"><a href="https://gradle.com/build-cache/" itemprop="url">Build Cache</a></li>
                    <li itemprop="name"><a href="https://gradle.org/services/" itemprop="url">Services</a></li>
                </ul>
            </div>
            <div class="site-footer__link-group">
                <header><strong>Get Help</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="https://discuss.gradle.org/c/help-discuss" itemprop="url">Forums</a></li>
                    <li itemprop="name"><a href="https://github.com/gradle/" itemprop="url">GitHub</a></li>
                    <li itemprop="name"><a href="https://gradle.org/training/" itemprop="url">Events</a></li>
                    <li itemprop="name"><a href="https://dpeuniversity.gradle.com/" itemprop="url">DPE University</a></li>
                </ul>
            </div>
        </section>
        <section class="site-footer__subscribe-newsletter" id="newsletter-form-container">
            <header class="newsletter-form__header"><h5>Stay <code>UP-TO-DATE</code> on new features and news</h5></header>
            <p class="disclaimer">By entering your email, you agree to our <a href="https://gradle.com/legal/terms-of-service/">Terms</a> and <a href="https://gradle.com/legal/privacy/">Privacy Policy</a>, including receipt of emails. You can unsubscribe at any time.</p>
            <div class="newsletter-form__container">
                <form id="newsletter-form" class="newsletter-form" action="https://go.gradle.com/l/68052/2018-09-07/bk6wml" method="post">
                    <input id="email" class="email" name="email" type="email" placeholder="name@email.com" pattern="[^@\s]+@[^@\s]+\.[^@\s]+" maxlength="255" required=""/>
                    <button id="submit" class="submit" type="submit">Subscribe</button>
                </form>
            </div>
        </section>
    </nav>
</footer>

</div>
<!-- end div class="content" -->


</main>

<div class="site-footer-secondary">
    <div class="site-footer-secondary__contents">
        <div class="site-footer__copy">© <a href="https://gradle.com">Gradle Inc.</a>
            <time>2023</time>
            All rights reserved.
        </div>
        <div class="site-footer__logo"><a href="/">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90 66.06">
                <title>Gradle</title>
                <path class="cls-1"
                      d="M85.11,4.18a14.27,14.27,0,0,0-19.83-.34,1.38,1.38,0,0,0,0,2L67,7.6a1.36,1.36,0,0,0,1.78.12A8.18,8.18,0,0,1,79.5,20.06C68.17,31.38,53.05-.36,18.73,16a4.65,4.65,0,0,0-2,6.54l5.89,10.17a4.64,4.64,0,0,0,6.3,1.73l.14-.08-.11.08L31.53,33a60.29,60.29,0,0,0,8.22-6.13,1.44,1.44,0,0,1,1.87-.06h0a1.34,1.34,0,0,1,.06,2A61.61,61.61,0,0,1,33,35.34l-.09,0-2.61,1.46a7.34,7.34,0,0,1-3.61.94,7.45,7.45,0,0,1-6.47-3.71l-5.57-9.61C4,32-2.54,46.56,1,65a1.36,1.36,0,0,0,1.33,1.11H8.61A1.36,1.36,0,0,0,10,64.87a9.29,9.29,0,0,1,18.42,0,1.35,1.35,0,0,0,1.34,1.19H35.9a1.36,1.36,0,0,0,1.34-1.19,9.29,9.29,0,0,1,18.42,0A1.36,1.36,0,0,0,57,66.06H63.1a1.36,1.36,0,0,0,1.36-1.34c.14-8.6,2.46-18.48,9.07-23.43C96.43,24.16,90.41,9.48,85.11,4.18ZM61.76,30.05l-4.37-2.19h0a2.74,2.74,0,1,1,4.37,2.2Z"/>
            </svg>
        </a></div>
        <div class="site-footer-secondary__links">
            <a href="https://gradle.com/careers/">Careers</a> |
            <a href="https://gradle.com/legal/privacy/">Privacy</a> |
            <a href="https://gradle.com/legal/terms-of-service/">Terms of Service</a> |
            <a href="https://gradle.org/contact/">Contact</a>
        </div>
    </div>
</div>

</div>
<!-- end div class="layout" -->

<script type="text/javascript">
    // Polyfill Element.matches()
    if (!Element.prototype.matches) {
        Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;
    }
    // Polyfill Element.closest()
    if (!Element.prototype.closest) {
        Element.prototype.closest = function (s) {
            var el = this;
            if (!document.documentElement.contains(el)) return null;
            do {
                if (typeof el.matches === "function" && el.matches(s)) return el;
                el = el.parentElement || el.parentNode;
            } while (el !== null);
            return null;
        };
    }

    function getCurrentChapterFileName(givenUrl) {
        var currentChapterFileName = givenUrl.substr(givenUrl.lastIndexOf("/") + 1);
        if (currentChapterFileName === "index.html" || currentChapterFileName === "") {
            currentChapterFileName = givenUrl.substr(0, givenUrl.lastIndexOf("/"));
            currentChapterFileName = currentChapterFileName.substr(currentChapterFileName.lastIndexOf("/") + 1) + "/index.html";
        }
        return currentChapterFileName;
    }

    // The media query indicating that a device is a desktop.
    // The `min-width: 64rem` definition should be aligned to
    // the one of `css/manual.css`.
    const desktopMediaQuery = window.matchMedia("screen and (min-width: 64rem)");

    [].forEach.call(document.querySelectorAll(".docs-navigation a[href$='/" + getCurrentChapterFileName(window.location.pathname) + "']"), function (link) {
        // Add "active" to all links same as current URL
        link.classList.add("active");

        // Expand all parent navigation
        var parentListEl = link.closest("li");
        while (parentListEl !== null) {
            var dropDownEl = parentListEl.querySelector(".nav-dropdown");
            if (dropDownEl !== null) {
                dropDownEl.classList.add("expanded");
            }
            parentListEl = parentListEl.parentNode.closest("li");
        }

        // Only scroll if the device is a desktop.
        //
        // Mobile's `docs-navigation` is always at bottom of `content`,
        // so we should not slide down to where `docs-navigation` lays.
        if (desktopMediaQuery.matches) {
            // Scroll to center of the page
            link.scrollIntoView({behavior: 'auto', block: 'center', inline: 'center'})
        }
    });

    // Expand/contract multi-level side navigation
    [].forEach.call(document.querySelectorAll(".docs-navigation .nav-dropdown"), function registerSideNavActions(collapsibleElement) {
        collapsibleElement.addEventListener("click", function toggleExpandedSideNav(evt) {
            evt.preventDefault();
            evt.target.classList.toggle("expanded");
            evt.target.setAttribute("aria-expanded", evt.target.classList.contains("expanded").toString());
            return false;
        }, false);
    });

    // Fix a weird issue making the initial screen always at the bottom.
    document.querySelector(".content").scrollIntoView(true);
</script>

</body>
</html>